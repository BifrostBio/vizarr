var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},s=(e,a)=>t(e,n(a));import{X as c,C as m,p as u,S as d,T as p,Q as h,o as f,a as g,b as y,Z as w,M as x,H as E,c as b,G as v,D as _,d as P,I as A,e as I,s as S,w as C,f as k,u as O,R as z,g as F,r as j,h as M,O as $,i as L,V,j as R,k as N,A as T,l as B,m as D,N as q,n as W,P as U,q as G,t as H,v as J,x as Z,y as X,z as Y,L as K,B as Q,E as ee,F as te,J as ne,K as ae,U as re,W as oe,Y as le,_ as ie,$ as se,a0 as ce,a1 as me}from"./vendor.d370befd.js";let ue;const de={},pe=function(e,t){if(!t||0===t.length)return e();if(void 0===ue){const e=document.createElement("link").relList;ue=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if((e=`./${e}`)in de)return;de[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":ue,t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("error",t)})):void 0}))).then((()=>e()))},he=s(i({},c.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function fe(e,t,n=[0,0],a=1){const[r,o]=n;return[r,t*a+o,e*a+r,o]}function ge(e){const{loaders:t,loaderSelection:n=[]}=e;let{concurrency:a}=e;a&&n.length>0&&(a=Math.ceil(a/n.length));return u(t,(async e=>{const t=n.map((t=>e.loader.getRaster({selection:t}))),a=await Promise.all(t);return s(i({},e),{data:{data:a.map((e=>e.data)),width:a[0].width,height:a[0].height}})}),{concurrency:a})}class ye extends m{initializeState(){this.state={gridData:[],width:0,height:0},ge(this.props).then((e=>{const{width:t,height:n}=function(e){const[t]=e,{width:n,height:a}=t.data;return e.forEach((({data:e})=>{if((null==e?void 0:e.width)!==n||(null==e?void 0:e.height)!==a)throw new Error("Grid data is not same shape.")})),{width:n,height:a}}(e);this.setState({gridData:e,width:t,height:n})}))}updateState({props:e,oldProps:t,changeFlags:n}){const{propsChanged:a}=n,r="string"==typeof a&&a.includes("props.loaders"),o=e.loaderSelection!==t.loaderSelection;(r||o)&&ge(this.props).then((e=>{this.setState({gridData:e})}))}getPickingInfo({info:e}){if(!e.coordinate)return e;const t=this.props.spacer||0,{width:n,height:a}=this.state,[r,o]=e.coordinate,l=Math.floor(o/(a+t)),i=Math.floor(r/(n+t));return e.gridCoord={row:l,column:i},e}renderLayers(){const{gridData:e,width:t,height:n}=this.state;if(0===t||0===n)return null;const{rows:a,columns:r,spacer:o=0,id:l=""}=this.props,s=e.map((e=>{const a=e.row*(n+o),r=e.col*(t+o),s={channelData:e.data,bounds:fe(t,n,[r,a]),id:`${l}-GridLayer-${e.row}-${e.col}`,dtype:e.loader.dtype||"Uint16",pickable:!1};return new c(i(i({},this.props),s))}));if(this.props.pickable){const[e,c]=[0,0],m=a*(n+o),u=r*(t+o),p={data:[{polygon:[[c,e],[u,e],[u,m],[c,m]]}],getPolygon:e=>e.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${l}-GridLayer-picking`},h=new d(i(i({},this.props),p));s.push(h)}if(this.props.text){const a=new p({id:`${l}-GridLayer-text`,data:e,getPosition:e=>[e.col*(t+o),e.row*(n+o)],getText:e=>e.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});s.push(a)}return s}}ye.layerName="GridLayer",ye.defaultProps=he;class we{constructor(e,t=100){this.store=e,this.cache=new h({maxSize:t})}getItem(...e){const[t,n]=e;if(this.cache.has(t))return this.cache.get(t);const a=this.store.getItem(t,n).catch((e=>{throw this.cache.delete(t),e}));return this.cache.set(t,a),a}async containsItem(e){return this.cache.has(e)||this.store.containsItem(e)}keys(){return this.store.keys()}deleteItem(e){throw new Error("deleteItem not implemented")}setItem(e,t){throw new Error("setItem not implemented")}}const xe={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},Ee=[xe.magenta,xe.green],be=[xe.red,xe.green,xe.blue],ve=Object.values(xe).slice(0,-2);async function _e(e){const t=await async function(e){if("string"==typeof e){let t;if(e.endsWith(".json")){const[{ReferenceStore:n},a]=await Promise.all([pe((()=>import("./index.3f096eb8.js")),[]),fetch(e).then((e=>e.json()))]);t=new n(a)}else t=new E(e);return new we(t)}return e}(e);return f(t).catch((e=>{if(e instanceof g)return y({store:t});throw e}))}async function Pe(e,t){const{datasets:n}=t[0]||[{path:"0"}],a=await Promise.all(n.map((({path:t})=>e.getItem(t))));if(a.every((e=>e instanceof w)))return a;throw Error("Multiscales metadata included a path to a group.")}function Ae(e){e.startsWith("#")&&(e=e.slice(1));return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Ie(e){return Array.from({length:e},((e,t)=>t))}function Se(...e){return e.filter(Boolean).map((e=>function(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}(e,"/"))).join("/")}function Ce(e){const t=e[e.length-1];return 3===t||4===t}function ke(e){const t=Ce(e.shape),[n,a]=e.chunks.slice(t?-3:-2),r=Math.min(n,a);return 2**Math.floor(Math.log2(r))}function Oe(e){if(!e)return new x;const t=new x;try{const a="string"==typeof e?JSON.parse(e):e;if(n=a,!Array.isArray(n)||16!==n.length||!n.every((e=>"number"==typeof e)))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...a)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(t)}var n;return t}async function ze(e,t,n){var a,r;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const o=n.rows.map((e=>e.name)),l=n.columns.map((e=>e.name)),c=n.wells.map((e=>e.path)),m=await t.getItem(c[0]).then((e=>e.attrs.asObject()));if(!("well"in m))throw Error("Path for image is not valid, not a well.");const d=m.well.images[0].path,p=await t.getItem(Se(c[0],d)).then((e=>e.attrs.asObject()));if(!("omero"in p))throw Error("Path for image is not valid.");const{datasets:h}=p.multiscales[0],f=h[h.length-1].path,g=await u(c.map((e=>[e,Se(e,d,f)])),(([e,n])=>t.getItem(n).then((t=>[e,t]))),{concurrency:10}),y=Fe(p.omero),w=await Promise.all(g),x=ke(w[0][1]),v=w.map((e=>{const[t,n]=e[0].split("/");return{name:`${t}${n}`,row:o.indexOf(t),col:l.indexOf(n),loader:new b(e[1],y.axis_labels,x)}})),_=s(i({loaders:v},y),{loader:[v[0].loader],model_matrix:Oe(e.model_matrix),defaults:{selection:y.defaultSelection,colormap:null!=(a=e.colormap)?a:"",opacity:null!=(r=e.opacity)?r:1},name:n.name||"Plate",rows:o.length,columns:l.length});return _.onClick=n=>{let a=n.gridCoord;if(!a)return;const{row:r,column:i}=a;let s;t.store instanceof E&&!isNaN(r)&&!isNaN(i)&&(s=Se(t.store.url,o[r],l[i])),e.onClick?(delete n.layer,n.imageSource=s,e.onClick(n)):s&&window.open(window.location.origin+window.location.pathname+"?source="+s)},_}function Fe({rdefs:e,channels:t,name:n}){var a,r;const o=null!=(a=e.defaultT)?a:0,l=null!=(r=e.defaultZ)?r:0,i=[],s=[],c=[],m=[];return t.forEach((e=>{i.push(e.color),s.push([e.window.start,e.window.end]),c.push(e.active),m.push(e.label)})),{name:n,names:m,colors:i,contrast_limits:s,visibilities:c,channel_axis:1,defaultSelection:[o,0,l,0,0],axis_labels:["t","c","z","y","x"]}}function je(e){const{loader:t,channel_axis:n,colors:a,visibilities:r,contrast_limits:o,model_matrix:l,defaults:i,loaders:s,rows:c,columns:m,onClick:u}=e,{selection:d,opacity:p,colormap:h}=i,f=function(e){return e.loaders?ye:e.loader.length>1?P:A}(e),g=[],y=[],w=[],x=[],E=r.flatMap(((e,t)=>e?t:[]));for(const v of E){if(Number.isInteger(n)){const e=[...d];e[n]=v,g.push(e)}else g.push(d);y.push(Ae(a[v])),w.push(o[v]),x.push(!0)}const b=[...w];if(!(t[0].dtype in _))throw Error(`Dtype not supported, must be ${JSON.stringify(Object.keys(_))}`);return{Layer:f,layerProps:{loader:1===t.length?t[0]:t,loaders:s,rows:c,columns:m,loaderSelection:g,colorValues:y,sliderValues:b,contrastLimits:w,channelIsOn:x,opacity:p,colormap:h,modelMatrix:l,onClick:u},on:!0}}var Me=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:async function(e){const t=await _e(e.source);let n;if(t instanceof v){const a=await t.attrs.asObject();if("plate"in a)return ze(e,t,a.plate);if("well"in a)return async function(e,t,n){var a,r,o,l;const c=e.acquisition?parseInt(e.acquisition):void 0;let m=[];if(!(null==n?void 0:n.images))throw Error("Well .zattrs missing images");if(!(t.store instanceof E))throw Error("Store must be an HTTPStore to open well.");const[u,d]=t.store.url.split("/").filter(Boolean).slice(-2);let{images:p}=n;const h=p.flatMap((e=>e.acquisition?[e.acquisition]:[]));if(h.length>1){const e=t.store.url.replace(`${u}/${d}`,""),n=await f(new E(e)),o=await n.attrs.asObject();m=null!=(r=null==(a=null==o?void 0:o.plate)?void 0:a.acquisitions)?r:[],c&&h.includes(c)&&(p=p.filter((e=>e.acquisition===c)))}const g=p.map((e=>e.path)),y=Math.ceil(Math.sqrt(g.length)),w=Math.ceil(g.length/y),x=await t.getItem(g[0]).then((e=>e.attrs.asObject()));if(!("omero"in x))throw Error("Path for image is not valid.");let v=x.multiscales[0].datasets[0].path;const _=g.map((e=>t.getItem(Se(e,v)))),P=Fe(x.omero),A=await Promise.all(_),I=ke(A[0]),S=Ie(w).flatMap((e=>Ie(y).map((t=>{const n=t+e*y;return{name:String(n),row:e,col:t,loader:new b(A[n],P.axis_labels,I)}})))),C=s(i({loaders:S},P),{loader:[S[0].loader],model_matrix:Oe(e.model_matrix),defaults:{selection:P.defaultSelection,colormap:null!=(o=e.colormap)?o:"",opacity:null!=(l=e.opacity)?l:1},name:`Well ${u}${d}`});return m.length>0&&(C.acquisitions=m,C.acquisitionId=c||-1),C.rows=w,C.columns=y,C.onClick=n=>{let a=n.gridCoord;if(!a)return;const{row:r,column:o}=a;let l;if(t.store instanceof E&&!isNaN(r)&&!isNaN(o)){const e=r*y+o;l=Se(t.store.url,g[e])}e.onClick?(delete n.layer,n.imageSource=l,e.onClick(n)):l&&window.open(window.location.origin+window.location.pathname+"?source="+l)},C}(e,t,a.well);if("omero"in a)return async function(e,t,n){var a;const{name:r,opacity:o=1,colormap:l=""}=e,s=await Pe(t,n.multiscales),c=Fe(n.omero),m=ke(s[0]),u=s.map((e=>new b(e,c.axis_labels,m)));return i({loader:u,name:null!=(a=c.name)?a:r,model_matrix:Oe(e.model_matrix),defaults:{selection:c.defaultSelection,colormap:l,opacity:o}},c)}(e,t,a);if(0===Object.keys(a).length&&t.store instanceof E){const n=t.store.url.slice(0,t.store.url.lastIndexOf("/")),a=await f(new E(n)),r=await a.attrs.asObject();if("plate"in r)return ze(e,a,r.plate)}if(!("multiscales"in a))throw Error("Group is missing multiscales specification.");n=await Pe(t,a.multiscales)}else n=[t];const a=function(e,t,n){t&&t.length==e.shape.length||(t=e.shape.slice(0,-2).map(((e,t)=>""+t)).concat(["y","x"]));return n&&(t[n]="c"),t}(n[0],e.axis_labels),r=ke(n[0]),o=n.map((e=>new b(e,a,r))),[l]=o,c="Float32"===l.dtype?1:_[l.dtype].max;if("channel_axis"in e)return function(e,t,n){const{names:a,channel_axis:r,name:o,model_matrix:l,opacity:i=1,colormap:s=""}=e;let{contrast_limits:c,visibilities:m,colors:u}=e;const d=t[0].shape[r];for(const p of[c,m,a,u])if(p&&p.length!==d){const e=Object.keys({channelProp:p})[0];throw Error(`channel_axis is length ${d} and provided channel_axis property ${e} is different size.`)}if(m||(m=d<=6?Array(d).fill(!0):[...Array(6).fill(!0),...Array(d-6).fill(!1)]),!u)if(1==d)u=[xe.white];else if(2==d)u=Ee;else if(3===d)u=be;else if(d<=6)u=ve.slice(0,d);else{u=Array(d).fill(xe.white);const e=m.flatMap(((e,t)=>e?t:[]));for(const[t,n]of e.entries())u[n]=ve[t]}return{loader:t,name:o,channel_axis:Number(r),colors:u,names:null!=a?a:Ie(d).map((e=>`channel_${e}`)),contrast_limits:null!=c?c:Array(d).fill([0,n]),visibilities:m,model_matrix:Oe(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:s,opacity:i},axis_labels:t[0].labels}}(e,o,c);if(2===l.shape.length||!("channel_axis"in e))return function(e,t,n){const{color:a,contrast_limits:r,visibility:o,name:l,colormap:i="",opacity:s=1}=e;return{loader:t,name:l,channel_axis:null,colors:[null!=a?a:xe.white],names:["channel_0"],contrast_limits:[null!=r?r:[0,n]],visibilities:[null==o||o],model_matrix:Oe(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:i,opacity:s},axis_labels:t[0].labels}}(e,o,c);throw Error("Failed to load image.")},initLayerStateFromSource:je});const $e=I([]),Le=I({zoom:0,target:[0,0,0],default:!0}),Ve=S($e),Re=k((e=>I(s(i({},je(e)),{id:e.id}))),((e,t)=>e.id===t.id)),Ne=I((e=>{const t=e(Ve);if(0===t.length)return[];const n=t.map((t=>Re(e(t))));return e(C(n))}));function Te({layers:e}){var t,n;const[a,r]=F(Le),o=j.exports.useRef(null);if(o.current&&(null==a?void 0:a.default)&&(null==(n=null==(t=e[0])?void 0:t.props)?void 0:n.loader)){const{deck:t}=o.current,{width:n,height:a,maxZoom:l}=function(e){const{loader:t,rows:n,columns:a}=e,[r,o]=Array.isArray(t)?[t[0],t.length]:[t,0],l=Ce(r.shape);let[i,s]=r.shape.slice(l?-3:-2);if(n&&a){const e=5;i=(i+e)*n,s=(s+e)*a}return{height:i,width:s,maxZoom:o}}(e[0].props),i=t.width<400?10:t.width<600?30:50,{zoom:s,target:c}=function([e,t],[n,a],r,o){const l=(n-2*o)/e,i=(a-2*o)/t;return{zoom:Math.min(r,Math.log2(Math.min(l,i))),target:[e/2,t/2,0]}}([n,a],[t.width,t.height],l,i);r({zoom:s,target:c})}return z.createElement(M,{ref:o,layers:e,viewState:a,onViewStateChange:e=>r(e.viewState),views:[new $({id:"ortho",controller:!0})]})}function Be(){const e=O(Ne).map((e=>e.on?new e.Layer(e.layerProps):null));return z.createElement(Te,{layers:e})}function De({sourceAtom:e,layerAtom:t}){const n=O(e),[a,r]=F(t);return z.createElement(L,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:e=>{e.stopPropagation(),r((e=>{const t=!e.on;return s(i({},e),{on:t})}))},style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${a.on?1:.5})`}},a.on?z.createElement(V,null):z.createElement(R,null))}const qe=N({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(T);function We({sourceAtom:e,layerAtom:t,name:n}){const a=`layer-controller-${O(e).id}`;return z.createElement(qe,{"aria-controls":a,id:a},z.createElement("div",{style:{display:"flex",flexDirection:"row"}},z.createElement(De,{sourceAtom:e,layerAtom:t}),z.createElement(B,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2"},n)))}function Ue({sourceAtom:e}){const t=O(e),{acquisitionId:n,acquisitions:a}=t;if(!a)return null;return z.createElement(z.Fragment,null,z.createElement(D,null,z.createElement(q,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:e=>{let t=e.target.value;const n=new URL(window.location.href);"-1"===t?n.searchParams.delete("acquisition"):n.searchParams.set("acquisition",t),window.location.href=decodeURIComponent(n.href)},value:n},z.createElement("option",{value:"-1",key:"-1"},"Filter by Acquisition"),a.map((e=>(e=e,z.createElement("option",{value:e.id,key:e.id},"Acquisition: ",e.name)))))))}function Ge({sourceAtom:e,layerAtom:t}){const n=O(e),[a,r]=F(t),[o,l]=j.exports.useState(null),c=()=>{l(null)},{names:m}=n,u=Boolean(o),d=u?`layer-${n.id}-add-channel`:void 0;return z.createElement(z.Fragment,null,z.createElement(L,{onClick:e=>{l(e.currentTarget)},"aria-describedby":d,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:6===a.layerProps.loaderSelection.length},z.createElement(W,null)),z.createElement(U,{id:d,open:u,anchorEl:o,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},z.createElement(G,{style:{padding:"0px 4px",marginBottom:4,width:"8em"}},z.createElement(B,{variant:"caption"},"selection: "),z.createElement(H,null),z.createElement(q,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:e=>{const{defaults:{selection:t},channel_axis:a,colors:o,contrast_limits:l}=n;c();const m=+e.target.value,u=[...t];a&&(u[a]=m),r((e=>{const{layerProps:t}=e,n=[...t.loaderSelection,u],a=[...t.colorValues,Ae(o[m])],r=[...t.sliderValues,l[m]],c=[...r],d=[...t.channelIsOn,!0];return s(i({},e),{layerProps:s(i({},t),{loaderSelection:n,colorValues:a,sliderValues:r,contrastLimits:c,channelIsOn:d})})}))}},z.createElement("option",{"aria-label":"None",value:""},"None"),m.map(((e,t)=>z.createElement("option",{value:t,key:e},e)))))))}const He=N({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(J);function Je({layerAtom:e}){const[t,n]=F(e);return z.createElement(He,{value:t.layerProps.opacity,onChange:(e,t)=>{const a=t;n((e=>s(i({},e),{layerProps:s(i({},e.layerProps),{opacity:a})})))},min:0,max:1,step:.01})}const Ze=N({root:{width:"5.5em",fontSize:"0.7em"}})(Z);function Xe({sourceAtom:e,layerAtom:t,axisIndex:n,max:a}){const r=O(e),[o,l]=F(t),[c,m]=j.exports.useState(null),u=Boolean(c),d=u?`${n}-index-${r.id}-options`:void 0,p=o.layerProps.loaderSelection[0]?o.layerProps.loaderSelection[0][n]:1;return z.createElement(z.Fragment,null,z.createElement(L,{onClick:e=>{m(e.currentTarget)},"aria-describedby":d,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"}},z.createElement(X,null)),z.createElement(U,{id:d,open:u,anchorEl:c,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},z.createElement(G,{style:{padding:"0px 4px",marginBottom:4}},z.createElement(B,{variant:"caption"},"Index:"),z.createElement(H,null),z.createElement(Ze,{value:p,onChange:e=>{let t=+e.target.value;t<0&&(t=0),t>a&&(t=a),l((e=>{let a=i({},e.layerProps);return a.loaderSelection=a.loaderSelection.map((e=>{let a=[...e];return a[n]=t,a})),s(i({},e),{layerProps:a})}))},type:"number",id:"max",fullWidth:!1}),z.createElement(H,null))))}const Ye=N({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(J);function Ke({sourceAtom:e,layerAtom:t,axisIndex:n,max:a}){const[r,o]=F(t),l=O(e),{axis_labels:c}=l;let m=c[n];"t"!==m&&"z"!==m||(m=m.toUpperCase());const[u,d]=j.exports.useState(0);j.exports.useEffect((()=>{d(r.layerProps.loaderSelection[0]?r.layerProps.loaderSelection[0][n]:1)}),[r.layerProps.loaderSelection]);return z.createElement(z.Fragment,null,z.createElement(D,null,z.createElement(D,{container:!0,justify:"space-between"},z.createElement(D,{item:!0,xs:10},z.createElement("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"}},z.createElement(B,{variant:"caption",noWrap:!0},m,": ",u,"/",a))),z.createElement(D,{item:!0,xs:1},z.createElement(Xe,{sourceAtom:e,layerAtom:t,axisIndex:n,max:a}))),z.createElement(D,{container:!0,justify:"space-between"},z.createElement(D,{item:!0,xs:12},z.createElement(Ye,{value:u,onChange:(e,t)=>{d(t)},onChangeCommitted:()=>{o((e=>{let t=i({},e.layerProps);return t.loaderSelection=t.loaderSelection.map((e=>{let t=[...e];return t[n]=u,t})),s(i({},e),{layerProps:t})}))},min:0,max:a,step:1})))),z.createElement(H,null))}function Qe({sourceAtom:e,layerAtom:t}){const n=O(e),{axis_labels:a,channel_axis:r,loader:o}=n,l=a.slice(0,-2).map(((e,t)=>[e,t,o[0].shape[t]])).filter((e=>e[1]!==r&&e[2]>1)).map((([n,a,r])=>z.createElement(Ke,{key:n,sourceAtom:e,layerAtom:t,axisIndex:a,max:r-1})));return 0===l.length?null:z.createElement(z.Fragment,null,z.createElement(D,null,l),z.createElement(H,null))}const et=Y((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}}))),tt=Object.entries(xe).map((([e,t])=>[e,Ae(t)]));function nt({handleChange:e}){const t=et();return z.createElement("div",{className:t.container,"aria-label":"color-swatch"},tt.map((([n,a])=>z.createElement(L,{className:t.button,key:n,onClick:()=>e(a)},z.createElement(K,{fontSize:"small",style:{color:`rgb(${a})`}})))))}const at=N({root:{width:"5.5em",fontSize:"0.7em"}})(Z);function rt({sourceAtom:e,layerAtom:t,channelIndex:n}){const a=O(e),[r,o]=F(t),[l,c]=j.exports.useState(null),{channel_axis:m,names:u}=a,d=e=>{const t=e.target.id;let a=+e.target.value;a<0&&(a=0),o((e=>{const r=[...e.layerProps.contrastLimits],o=[...e.layerProps.sliderValues],[l,c]=r[n],[m,u]=o[n],[d,p]="min"===t?[a,c]:[l,a];return d>m&&(o[n]=[d,u]),p<u&&(o[n]=[m,p]),r[n]=[d,p],s(i({},e),{layerProps:s(i({},e.layerProps),{sliderValues:o,contrastLimits:r})})}))},p=Boolean(l),h=p?`channel-${n}-${a.name}-options`:void 0,[f,g]=r.layerProps.contrastLimits[n];return z.createElement(z.Fragment,null,z.createElement(L,{onClick:e=>{c(e.currentTarget)},"aria-describedby":h,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"}},z.createElement(X,null)),z.createElement(U,{id:h,open:p,anchorEl:l,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},z.createElement(G,{style:{padding:"0px 4px",marginBottom:4}},z.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},z.createElement(B,{variant:"caption"},"remove:"),z.createElement(L,{onClick:()=>{o((e=>{const{layerProps:t}=e,a=[...t.colorValues],r=[...t.sliderValues],o=[...t.contrastLimits],l=[...t.loaderSelection],c=[...t.channelIsOn];return a.splice(n,1),r.splice(n,1),o.splice(n,1),l.splice(n,1),c.splice(n,1),s(i({},e),{layerProps:s(i({},t),{colorValues:a,sliderValues:r,loaderSelection:l,channelIsOn:c,contrastLimits:o})})}))}},z.createElement(Q,null))),z.createElement(H,null),z.createElement(B,{variant:"caption"},"selection:"),z.createElement(H,null),z.createElement(q,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${a.name}-channel-select`,onChange:e=>{o((t=>{const a=[...t.layerProps.loaderSelection],r=[...a[n]];return Number.isInteger(m)&&(r[m]=+e.target.value,a[n]=r),s(i({},t),{layerProps:s(i({},t.layerProps),{loaderSelection:a})})}))},value:r.layerProps.loaderSelection[n][m]},u.map(((e,t)=>z.createElement("option",{value:t,key:e},"(",t,") ",e)))),z.createElement(H,null),z.createElement(B,{variant:"caption"},"contrast limits:"),z.createElement(H,null),z.createElement(at,{value:f,onChange:d,type:"number",id:"min",fullWidth:!1}),z.createElement(at,{value:g,onChange:d,type:"number",id:"max",fullWidth:!1}),z.createElement(H,null),z.createElement(B,{variant:"caption"},"color:"),z.createElement(H,null),z.createElement("div",{style:{display:"flex",justifyContent:"center"}},z.createElement(nt,{handleChange:e=>{o((t=>{const a=[...t.layerProps.colorValues];return a[n]=e,s(i({},t),{layerProps:s(i({},t.layerProps),{colorValues:a})})}))}})))))}function ot({sourceAtom:e,layerAtom:t,channelIndex:n}){const a=O(e),[r,o]=F(t),{sliderValues:l,colorValues:c,contrastLimits:m,channelIsOn:u,colormap:d,loaderSelection:p}=r.layerProps,h=[...l[n]],f=`rgb(${d?[255,255,255]:c[n]})`,g=u[n],[y,w]=m[n],{channel_axis:x,names:E}=a,b=p[n],v=E[Number.isInteger(x)?b[x]:0];return z.createElement(z.Fragment,null,z.createElement(D,{container:!0,justify:"space-between",wrap:"nowrap"},z.createElement(D,{item:!0,xs:10},z.createElement("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"}},z.createElement(B,{variant:"caption",noWrap:!0},v))),z.createElement(D,{item:!0,xs:1},z.createElement(rt,{sourceAtom:e,layerAtom:t,channelIndex:n}))),z.createElement(D,{container:!0,justify:"space-between"},z.createElement(D,{item:!0,xs:2},z.createElement(L,{style:{color:f,backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{o((e=>{const t=[...e.layerProps.channelIsOn];return t[n]=!t[n],s(i({},e),{layerProps:s(i({},e.layerProps),{channelIsOn:t})})}))}},g?z.createElement(ee,null):z.createElement(te,null))),z.createElement(D,{item:!0,xs:10},z.createElement(J,{value:h,onChange:(e,t)=>{o((e=>{const a=[...e.layerProps.sliderValues];return a[n]=t,s(i({},e),{layerProps:s(i({},e.layerProps),{sliderValues:a})})}))},min:y,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:f}}))))}const lt=N({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(ne);function it({sourceAtom:e,layerAtom:t}){const n=O(t).layerProps.loaderSelection.length;return z.createElement(lt,null,z.createElement(D,{container:!0,direction:"column"},z.createElement(Ue,{sourceAtom:e,layerAtom:t}),z.createElement(D,null,z.createElement(D,{container:!0,justify:"space-between"},z.createElement(D,{item:!0,xs:3},z.createElement(B,{variant:"caption"},"opacity:")),z.createElement(D,{item:!0,xs:8},z.createElement(Je,{sourceAtom:e,layerAtom:t})))),z.createElement(H,null),z.createElement(Qe,{sourceAtom:e,layerAtom:t}),z.createElement(D,{container:!0,justify:"space-between"},z.createElement(D,{item:!0,xs:3},z.createElement(B,{variant:"caption"},"channels:")),z.createElement(D,{item:!0,xs:1},z.createElement(Ge,{sourceAtom:e,layerAtom:t}))),z.createElement(H,null),z.createElement(D,null,Ie(n).map((n=>z.createElement(ot,{sourceAtom:e,layerAtom:t,channelIndex:n,key:n}))))))}const st=N({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(ae);function ct({sourceAtom:e}){const t=O(e),n=Re(t),{name:a=""}=t;return z.createElement(st,{defaultExpanded:!0},z.createElement(We,{sourceAtom:e,layerAtom:n,name:a}),z.createElement(it,{sourceAtom:e,layerAtom:n}))}const mt=Y({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function ut(){const e=O(Ve),[t,n]=j.exports.useReducer((e=>!e),!1),a=mt();return z.createElement("div",{className:a.root,style:{padding:`0px 5px ${t?0:5}px 5px`}},z.createElement(D,{container:!0,direction:"column",alignItems:"flex-start"},z.createElement(L,{style:{backgroundColor:"transparent",padding:0},onClick:n},t?z.createElement(W,null):z.createElement(Q,null)),z.createElement("div",{className:a.scroll,style:{display:t?"none":"flex"}},e.map((e=>z.createElement(ct,{key:`${e}`,sourceAtom:e}))))))}function dt(){const e=re($e),t=re(Le);async function n(t){const{createSourceData:n}=await pe((()=>Promise.resolve().then((function(){return Me}))),void 0),a=Math.random().toString(36).slice(2),r=await n(t);e((e=>(r.name||(r.name=`image_${Object.keys(e).length}`),[...e,i({id:a},r)])))}return j.exports.useEffect((()=>{const e=new URLSearchParams(window.location.search);if(e.has("source")){const t={};for(const[n,o]of e)t[n]=o;t.source=decodeURIComponent(t.source),n(t);const a=new URL(window.location.href);a.searchParams.set("source",t.source);const r=decodeURIComponent(a.toString());window.location.href!==r&&window.history.pushState(null,"",r)}}),[]),j.exports.useEffect((()=>{window.self!==window.top&&async function(){const{default:e}=await pe((()=>import("./index.fd4c7316.js").then((function(e){return e.i}))),[]);(await e.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:"0.2.1"})).export({add_image:async e=>n(e),set_view_state:async e=>t(e)})}()}),[]),z.createElement(z.Fragment,null,z.createElement(ut,null),z.createElement(Be,null))}var pt=oe({palette:{type:"dark",primary:le,secondary:le},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const ht=new Map;function ft(e,t){ie(e,(()=>{if(!ht.has(e)){const n=t().then((e=>e.default)).catch((t=>{throw ht.delete(e),t}));ht.set(e,n)}return ht.get(e)}))}ft("lz4",(()=>pe((()=>import("./lz4.46eda458.js")),["assets/lz4.46eda458.js","assets/utils-6b0080f1.ae2431cc.js"]))),ft("gzip",(()=>pe((()=>import("./gzip.1e85efe8.js")),["assets/gzip.1e85efe8.js","assets/pako.esm-9240ff4b.1ad7aec0.js"]))),ft("zlib",(()=>pe((()=>import("./zlib.9b262c0b.js")),["assets/zlib.9b262c0b.js","assets/pako.esm-9240ff4b.1ad7aec0.js"]))),ft("zstd",(()=>pe((()=>import("./zstd.b8e7f151.js")),["assets/zstd.b8e7f151.js","assets/utils-6b0080f1.ae2431cc.js"]))),ft("blosc",(()=>pe((()=>import("./blosc.55ec6bdf.js")),["assets/blosc.55ec6bdf.js","assets/utils-6b0080f1.ae2431cc.js"]))),se.render(z.createElement(ce,{theme:pt},z.createElement(me,null,z.createElement(dt,null))),document.getElementById("root"));
