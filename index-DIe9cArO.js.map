{"version":3,"file":"index-DIe9cArO.js","sources":["../main.ts"],"sourcesContent":["import debounce from \"just-debounce-it\";\nimport * as vizarr from \"./src/index\";\n\nasync function main() {\n  console.log(`vizarr v${vizarr.version}: https://github.com/hms-dbmi/vizarr`);\n  // biome-ignore lint/style/noNonNullAssertion: We know the element exists\n  const viewer = await vizarr.createViewer(document.querySelector(\"#root\")!);\n  const url = new URL(window.location.href);\n\n  if (!url.searchParams.has(\"source\")) {\n    return;\n  }\n\n  // see if we have initial viewState\n  const viewStateString = url.searchParams.get(\"viewState\");\n  if (viewStateString) {\n    const viewState = JSON.parse(viewStateString);\n    viewer.setViewState(viewState);\n  }\n\n  // Add event listener to sync viewState as query param.\n  // Debounce to limit how quickly we are pushing to browser history\n  // viewer.on(\n  //   \"viewStateChange\",\n  //   debounce((update: vizarr.ViewState) => {\n  //     const url = new URL(window.location.href);\n  //     url.searchParams.set(\"viewState\", JSON.stringify(update));\n  //     window.history.pushState({}, \"\", decodeURIComponent(url.href));\n  //   }, 200),\n  // );\n\n  // parse image config\n  // @ts-expect-error - TODO: validate config\n  const config: vizarr.ImageLayerConfig = {};\n\n  for (const [key, value] of url.searchParams) {\n    // @ts-expect-error - TODO: validate config\n    config[key] = value;\n  }\n\n  // Make sure the source URL is decoded.\n  viewer.addImage(config);\n\n  const newLocation = decodeURIComponent(url.href);\n\n  // Only update history if the new loacation is different from the current\n  if (window.location.href !== newLocation) {\n    window.history.pushState(null, \"\", newLocation);\n  }\n}\n\nmain();\n"],"names":["main","vizarr.version","viewer","vizarr.createViewer","url","viewStateString","viewState","config","key","value","newLocation"],"mappings":"uwBAGA,eAAeA,GAAO,CACpB,QAAQ,IAAI,WAAWC,CAAc,sCAAsC,EAE3E,MAAMC,EAAS,MAAMC,EAAoB,SAAS,cAAc,OAAO,CAAE,EACnEC,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EAExC,GAAI,CAACA,EAAI,aAAa,IAAI,QAAQ,EAChC,OAIF,MAAMC,EAAkBD,EAAI,aAAa,IAAI,WAAW,EACxD,GAAIC,EAAiB,CACb,MAAAC,EAAY,KAAK,MAAMD,CAAe,EAC5CH,EAAO,aAAaI,CAAS,CAAA,CAgB/B,MAAMC,EAAkC,CAAC,EAEzC,SAAW,CAACC,EAAKC,CAAK,IAAKL,EAAI,aAE7BG,EAAOC,CAAG,EAAIC,EAIhBP,EAAO,SAASK,CAAM,EAEhB,MAAAG,EAAc,mBAAmBN,EAAI,IAAI,EAG3C,OAAO,SAAS,OAASM,GAC3B,OAAO,QAAQ,UAAU,KAAM,GAAIA,CAAW,CAElD,CAEAV,EAAK"}