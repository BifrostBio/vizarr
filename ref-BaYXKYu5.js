var v=t=>{throw TypeError(t)};var A=(t,r,n)=>r.has(t)||v("Cannot "+n);var m=(t,r,n)=>(A(t,r,"read from private field"),n?n.call(t):r.get(t)),p=(t,r,n)=>r.has(t)?v("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,n),g=(t,r,n,e)=>(A(t,r,"write to private field"),e?e.call(t,n):r.set(t,n),n);function E(t,r=/{{(.*?)}}/){let n=r.exec(t);const e=[];let o;for(;n;)o=n.index,o!==0&&(e.push({match:!1,str:t.substring(0,o)}),t=t.slice(o)),e.push({match:!0,str:n[0]}),t=t.slice(n[0].length),n=r.exec(t);return t&&e.push({match:!1,str:t}),e}function C(t){const r=t.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(r!=null&&r.groups))return;const{fname:n,args:e}=r.groups,o=Object.fromEntries(e.split(",").map(f=>{var a;const{key:i,num:s,str:c}=((a=f.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:a.groups)??{};if(!i||!(s||c))throw Error(`Failed to match fn kwarg: ${f}`);return[i,s?Number(s):c]}));return{fname:n,ctx:o}}const x="abcdefghijklmnopqrstuvwxyz",j="01234569789",k="()*/+-",U=" ",O=new Set(x+x.toUpperCase()+j+k+U);function _(t){for(let r=0;r<t.length;r++)if(!O.has(t.charAt(r)))return;return E(t,/[A-Za-z_][A-Za-z0-9_]*/gi)}function z(t,r){return E(t).map(e=>{if(!e.match)return e.str;let o=e.str.split(/{{|}}/).filter(Boolean)[0].trim();if(o in r)return r[o];const f=C(o);if(f){const{fname:s,ctx:c}=f,a=r[s];if(typeof a=="function")return a(c);throw Error(`Cannot find function named ${s} in rendering context.`)}const i=_(o);if(i){const s=i.map(c=>{if(!c.match)return c.str;const a=r[c.str];if(a==null)throw Error(`Cannot find number named ${c.str} in rendering context.`);if(typeof a!="number")throw Error(`The provided value for ${c.str} must be a number.`);return a});return Function('"use strict";return ('+s.join("")+")")()}throw new Error(`Unable to match ${e.str}`)}).join("")}function M(t,r=z){return"version"in t?P(t,r):N(t)}function N(t){return new Map(Object.entries(t))}function P(t,r){var f;const n={};for(const[i,s]of Object.entries(t.templates??{}))s.includes("{{")?n[i]=c=>r(s,c):n[i]=s;const e=(i,s)=>r(i,{...n,...s}),o=new Map;for(const[i,s]of Object.entries(t.refs??{}))if(typeof s=="string")o.set(i,s);else{const c=(f=s[0])!=null&&f.includes("{{")?e(s[0]):s[0];o.set(i,s.length===1?[c]:[c,s[1],s[2]])}for(const i of t.gen??[])for(const s of S(i.dimensions)){const c=e(i.key,s),a=e(i.url,s);if("offset"in i&&"length"in i){const w=e(i.offset,s),$=e(i.length,s);o.set(c,[a,parseInt(w),parseInt($)])}else o.set(c,[a])}return o}function*S(t){const r=Object.keys(t),n=Object.values(t).map(e=>Array.isArray(e)?e:[...F(e)]);for(const e of Z(...n))yield Object.fromEntries(r.map((o,f)=>[o,e[f]]))}function*Z(...t){if(t.length===0)return;const r=t.map(e=>e[Symbol.iterator]()),n=r.map(e=>e.next());if(n.some(e=>e.done))throw new Error("Input contains an empty iterator.");for(let e=0;;){if(n[e].done){if(r[e]=t[e][Symbol.iterator](),n[e]=r[e].next(),++e>=r.length)return}else yield n.map(({value:o})=>o),e=0;n[e]=r[e].next()}}function*F({stop:t,start:r=0,step:n=1}){for(let e=r;e<t;e+=n)yield e}(()=>{for(var t=new Uint8Array(128),r=0;r<64;r++)t[r<26?r+65:r<52?r+71:r<62?r-4:r*4-205]=r;return n=>{for(var e=n.length,o=new Uint8Array((e-(n[e-1]=="=")-(n[e-2]=="="))*3/4|0),f=0,i=0;f<e;){var s=t[n.charCodeAt(f++)],c=t[n.charCodeAt(f++)],a=t[n.charCodeAt(f++)],w=t[n.charCodeAt(f++)];o[i++]=s<<2|c>>4,o[i++]=c<<4|a>>2,o[i++]=a<<6|w}return o}})();new TextEncoder;function I(t){return t.slice(1)}function T(t){let[r,n]=(typeof t=="string"?t:t.href).split("://");if(r==="https"||r==="http")return t;if(r==="gc")return`https://storage.googleapis.com/${n}`;if(r==="s3")return`https://s3.amazonaws.com/${n}`;throw Error(`Protocol not supported, got: ${JSON.stringify(r)}`)}function B(t,r,n,e={}){return r!==void 0&&n!==void 0&&(e={...e,headers:{...e.headers,Range:`bytes=${r}-${r+n-1}`}}),fetch(t,e)}function R(t,r){return{...t,...r,headers:{...t.headers,...r.headers}}}let u=new Uint8Array(128);for(let t=0;t<64;t++)u[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;function V(t){const r=t.length,n=new Uint8Array((r-(t[r-1]==="=")-(t[r-2]==="="))*3/4|0);for(let e=0,o=0;e<r;){const f=u[t.charCodeAt(e++)],i=u[t.charCodeAt(e++)],s=u[t.charCodeAt(e++)],c=u[t.charCodeAt(e++)];n[o++]=f<<2|i>>4,n[o++]=i<<4|s>>2,n[o++]=s<<6|c}return n}var l,h,d;const y=class y{constructor(r,n={}){p(this,l);p(this,h);p(this,d);g(this,l,Promise.resolve(r)),g(this,h,n),g(this,d,n.overrides||{})}async get(r,n={}){let e=(await m(this,l)).get(I(r));if(!e)return;if(typeof e=="string")return e.startsWith("base64:")?V(e.slice(7)):new TextEncoder().encode(e);let[o,f,i]=e,s=o??m(this,h).target;if(!s)throw Error(`No url for key ${r}, and no target url provided.`);let c=await B(T(s),f,i,R(m(this,d),n));if(c.status===200||c.status===206)return new Uint8Array(await c.arrayBuffer());throw new Error(`Request unsuccessful for key ${r}. Response status: ${c.status}.`)}static fromSpec(r,n){let e=Promise.resolve(r).then(o=>M(o));return new y(e,n)}static fromUrl(r,n){let e=fetch(r,n==null?void 0:n.overrides).then(o=>o.json());return y.fromSpec(e,n)}};l=new WeakMap,h=new WeakMap,d=new WeakMap;let b=y;export{b as default,V as to_binary};
//# sourceMappingURL=ref-BaYXKYu5.js.map
