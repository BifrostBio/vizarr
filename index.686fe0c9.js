var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&i(e,n,t[n]);if(o)for(var n of o(t))a.call(t,n)&&i(e,n,t[n]);return e},s=(e,o)=>t(e,n(o));import{X as c,C as d,p as u,S as p,T as h,Q as m,o as f,a as g,b as y,Z as w,M as x,H as b,c as v,G as _,D as P,d as A,I,e as S,s as C,w as O,f as k,u as z,j as E,g as j,r as L,h as M,O as $,i as F,V as R,k as V,l as N,A as D,m as B,n as T,F as q,q as W,N as U,t as G,P as J,v as H,x as Z,y as K,z as X,B as Y,E as Q,L as ee,R as te,J as ne,K as oe,U as re,W as ae,Y as ie,_ as le,$ as se,a0 as ce,a1 as de,a2 as ue,a3 as pe}from"./vendor.b01c47f0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const he={},me=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in he)return;he[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e())):e()},fe=s(l({},c.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function ge(e,t,n=[0,0],o=1){const[r,a]=n;return[r,t*o+a,e*o+r,a]}function ye(e){const{loaders:t,loaderSelection:n=[]}=e;let{concurrency:o}=e;o&&n.length>0&&(o=Math.ceil(o/n.length));return u(t,(async e=>{const t=n.map((t=>e.loader.getRaster({selection:t}))),o=await Promise.all(t);return s(l({},e),{data:{data:o.map((e=>e.data)),width:o[0].width,height:o[0].height}})}),{concurrency:o})}class we extends d{initializeState(){this.state={gridData:[],width:0,height:0},ye(this.props).then((e=>{const{width:t,height:n}=function(e){const[t]=e,{width:n,height:o}=t.data;return e.forEach((({data:e})=>{if((null==e?void 0:e.width)!==n||(null==e?void 0:e.height)!==o)throw new Error("Grid data is not same shape.")})),{width:n,height:o}}(e);this.setState({gridData:e,width:t,height:n})}))}updateState({props:e,oldProps:t,changeFlags:n}){const{propsChanged:o}=n,r="string"==typeof o&&o.includes("props.loaders"),a=e.loaderSelection!==t.loaderSelection;(r||a)&&ye(this.props).then((e=>{this.setState({gridData:e})}))}getPickingInfo({info:e}){if(!e.coordinate)return e;const t=this.props.spacer||0,{width:n,height:o}=this.state,[r,a]=e.coordinate,i=Math.floor(a/(o+t)),l=Math.floor(r/(n+t));return e.gridCoord={row:i,column:l},e}renderLayers(){const{gridData:e,width:t,height:n}=this.state;if(0===t||0===n)return null;const{rows:o,columns:r,spacer:a=0,id:i=""}=this.props,s=e.map((e=>{const o=e.row*(n+a),r=e.col*(t+a),s={channelData:e.data,bounds:ge(t,n,[r,o]),id:`${i}-GridLayer-${e.row}-${e.col}`,dtype:e.loader.dtype||"Uint16",pickable:!1};return new c(l(l({},this.props),s))}));if(this.props.pickable){const[e,c]=[0,0],d=o*(n+a),u=r*(t+a),h={data:[{polygon:[[c,e],[u,e],[u,d],[c,d]]}],getPolygon:e=>e.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${i}-GridLayer-picking`},m=new p(l(l({},this.props),h));s.push(m)}if(this.props.text){const o=new h({id:`${i}-GridLayer-text`,data:e,getPosition:e=>[e.col*(t+a),e.row*(n+a)],getText:e=>e.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});s.push(o)}return s}}we.layerName="GridLayer",we.defaultProps=fe;class xe{constructor(e,t=100){var n,o;i(this,"symbol"!=typeof(n="cache")?n+"":n,o),this.store=e,this.cache=new m({maxSize:t})}getItem(...e){const[t,n]=e;if(this.cache.has(t))return this.cache.get(t);const o=this.store.getItem(t,n).catch((e=>{throw this.cache.delete(t),e}));return this.cache.set(t,o),o}async containsItem(e){return this.cache.has(e)||this.store.containsItem(e)}keys(){return this.store.keys()}deleteItem(e){throw new Error("deleteItem not implemented")}setItem(e,t){throw new Error("setItem not implemented")}}const be={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},ve=[be.magenta,be.green],_e=[be.red,be.green,be.blue],Pe=Object.values(be).slice(0,-2);async function Ae(e){const{store:t,path:n}=await async function(e){let t;if("string"==typeof e){let n;if(e.endsWith(".json")){const[{ReferenceStore:t},o]=await Promise.all([me((()=>import("./index.157d23f4.js")),[]),fetch(e).then((e=>e.json()))]);n=t.fromJSON(o)}else{const o=new URL(e);n=new b(o.origin),t=o.pathname.slice(1)}return{store:new xe(n),path:t}}return{store:e,path:t}}(e);return f(t,n).catch((e=>{if(e instanceof g)return y({store:t});throw e}))}const Ie=new TextDecoder;function Se(e,t){return e.store.getItem(ze(e.path,t,".zattrs")).then((e=>Ie.decode(e))).then((e=>JSON.parse(e)))}async function Ce(e,t){const{datasets:n}=t[0]||[{path:"0"}],o=await Promise.all(n.map((({path:t})=>e.getItem(t))));if(o.every((e=>e instanceof w)))return o;throw Error("Multiscales metadata included a path to a group.")}function Oe(e){e.startsWith("#")&&(e=e.slice(1));return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function ke(e){return Array.from({length:e},((e,t)=>t))}function ze(...e){return e.filter(Boolean).map((e=>function(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}(e,"/"))).join("/")}function Ee(e){const t=e[e.length-1];return 3===t||4===t}function je(e){const t=Ee(e.shape),[n,o]=e.chunks.slice(t?-3:-2),r=Math.min(n,o);return 2**Math.floor(Math.log2(r))}function Le(e){if(!e)return new x;const t=new x;try{const o="string"==typeof e?JSON.parse(e):e;if(n=o,!Array.isArray(n)||16!==n.length||!n.every((e=>"number"==typeof e)))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...o)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(t)}var n;return t}async function Me(e,t,n){var o,r;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const a=n.rows.map((e=>e.name)),i=n.columns.map((e=>e.name)),c=n.wells.map((e=>e.path)),d=await Se(t,c[0]);if(!("well"in d))throw Error("Path for image is not valid, not a well.");const p=d.well.images[0].path,h=await t.getItem(ze(c[0],p)).then((e=>e.attrs.asObject()));if(!("omero"in h))throw Error("Path for image is not valid.");const{datasets:m}=h.multiscales[0],f=m[m.length-1].path;const g=await Promise.all(c.map((async function(e){return ze(e,(await Se(t,e)).well.images[0].path)}))),y=await u(g.map((e=>[e,ze(e,f)])),(([e,n])=>t.getItem(n).then((t=>[e,t]))),{concurrency:10}),w=await Promise.all(y),x=Fe(h.multiscales),b=$e(h.omero,x),_=je(w[0][1]),P=w.map((e=>{const[t,n]=e[0].split("/");return{name:`${t}${n}`,row:a.indexOf(t),col:i.indexOf(n),loader:new v(e[1],x,_)}})),A=s(l({loaders:P},b),{axis_labels:x,loader:[P[0].loader],model_matrix:Le(e.model_matrix),defaults:{selection:b.defaultSelection,colormap:null!=(o=e.colormap)?o:"",opacity:null!=(r=e.opacity)?r:1},name:n.name||"Plate",rows:a.length,columns:i.length});return A.onClick=n=>{let o=n.gridCoord;if(!o)return;const{row:r,column:l}=o;let s;"string"!=typeof e.source||!t.path||isNaN(r)||isNaN(l)||(s=ze(e.source,a[r],i[l])),e.onClick?(delete n.layer,n.imageSource=s,e.onClick(n)):s&&window.open(window.location.origin+window.location.pathname+"?source="+s)},A}function $e({rdefs:e,channels:t,name:n},o){var r,a;const i=null!=(r=e.defaultT)?r:0,l=null!=(a=e.defaultZ)?a:0,s=[],c=[],d=[],u=[];t.forEach((e=>{s.push(e.color),c.push([e.window.start,e.window.end]),d.push(e.active),u.push(e.label)}));const p=o.map((e=>"t"==e?i:"z"==e?l:0));return{name:n,names:u,colors:s,contrast_limits:c,visibilities:d,channel_axis:o.includes("c")?o.indexOf("c"):null,defaultSelection:p}}function Fe(e){return e[0].axes||["t","c","z","y","x"]}function Re(e){const{loader:t,channel_axis:n,colors:o,visibilities:r,contrast_limits:a,model_matrix:i,defaults:l,loaders:s,rows:c,columns:d,onClick:u}=e,{selection:p,opacity:h,colormap:m}=l,f=function(e){return e.loaders?we:e.loader.length>1?A:I}(e),g=[],y=[],w=[],x=[],b=r.flatMap(((e,t)=>e?t:[]));for(const _ of b){if(Number.isInteger(n)){const e=[...p];e[n]=_,g.push(e)}else g.push(p);y.push(Oe(o[_])),w.push(a[_]),x.push(!0)}const v=[...w];if(!(t[0].dtype in P))throw Error(`Dtype not supported, must be ${JSON.stringify(Object.keys(P))}`);return{Layer:f,layerProps:{loader:1===t.length?t[0]:t,loaders:s,rows:c,columns:d,loaderSelection:g,colorValues:y,sliderValues:v,contrastLimits:w,channelIsOn:x,opacity:h,colormap:m,modelMatrix:i,onClick:u},on:!0}}var Ve=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:async function(e){var t;const n=await Ae(e.source);let o;if(n instanceof _){const t=await n.attrs.asObject();if("plate"in t)return Me(e,n,t.plate);if("well"in t)return async function(e,t,n){var o,r,a,i;const c=e.acquisition?parseInt(e.acquisition):void 0;let d=[];if(!(null==n?void 0:n.images))throw Error("Well .zattrs missing images");if(!t.path)throw Error("Cannot inspect zarr path to open well.");const[u,p]=t.path.split("/").filter(Boolean).slice(-2);let{images:h}=n;const m=h.flatMap((e=>e.acquisition?[e.acquisition]:[]));if(m.length>1){const e=t.path.replace(`${u}/${p}`,""),n=await f(t.store,e),a=await n.attrs.asObject();d=null!=(r=null==(o=null==a?void 0:a.plate)?void 0:o.acquisitions)?r:[],c&&m.includes(c)&&(h=h.filter((e=>e.acquisition===c)))}const g=h.map((e=>e.path)),y=Math.ceil(Math.sqrt(g.length)),w=Math.ceil(g.length/y),x=await t.getItem(g[0]).then((e=>e.attrs.asObject()));if(!("omero"in x))throw Error("Path for image is not valid.");let b=x.multiscales[0].datasets[0].path;const _=g.map((e=>t.getItem(ze(e,b)))),P=await Promise.all(_),A=Fe(x.multiscales),I=$e(x.omero,A),S=je(P[0]),C=ke(w).flatMap((e=>ke(y).map((t=>{const n=t+e*y;return{name:String(n),row:e,col:t,loader:new v(P[n],A,S)}})))),O=s(l({loaders:C},I),{axis_labels:A,loader:[C[0].loader],model_matrix:Le(e.model_matrix),defaults:{selection:I.defaultSelection,colormap:null!=(a=e.colormap)?a:"",opacity:null!=(i=e.opacity)?i:1},name:`Well ${u}${p}`});return d.length>0&&(O.acquisitions=d,O.acquisitionId=c||-1),O.rows=w,O.columns=y,O.onClick=n=>{let o=n.gridCoord;if(!o)return;const{row:r,column:a}=o;let i;if("string"==typeof e.source&&t.path&&!isNaN(r)&&!isNaN(a)){const t=r*y+a;i=ze(e.source,g[t])}e.onClick?(delete n.layer,n.imageSource=i,e.onClick(n)):i&&window.open(window.location.origin+window.location.pathname+"?source="+i)},O}(e,n,t.well);if("omero"in t)return async function(e,t,n){var o;const{name:r,opacity:a=1,colormap:i=""}=e,c=await Ce(t,n.multiscales),d=Fe(n.multiscales),u=$e(n.omero,d),p=je(c[0]),h=c.map((e=>new v(e,d,p)));return s(l({loader:h,axis_labels:d,model_matrix:Le(e.model_matrix),defaults:{selection:u.defaultSelection,colormap:i,opacity:a}},u),{name:null!=(o=u.name)?o:r})}(e,n,t);if(0===Object.keys(t).length&&n.path){const t=n.path.slice(0,n.path.lastIndexOf("/")),o=await f(n.store,t),r=await o.attrs.asObject();if("plate"in r)return Me(e,o,r.plate)}if(!("multiscales"in t))throw Error("Group is missing multiscales specification.");o=await Ce(n,t.multiscales),e.axis_labels||(e.axis_labels=t.multiscales[0].axes)}else o=[n];const r=function(e,t){t&&t.length==e.shape.length||(t=e.shape.slice(0,-2).map(((e,t)=>""+t)).concat(["y","x"]));return t}(o[0],e.axis_labels),a=je(o[0]),i=o.map((e=>new v(e,r,a))),[c]=i,d="Float32"===c.dtype?1:P[c.dtype].max;if("channel_axis"in e||r.includes("c"))return(e=e).channel_axis=null!=(t=e.channel_axis)?t:r.indexOf("c"),function(e,t,n){const{names:o,channel_axis:r,name:a,model_matrix:i,opacity:l=1,colormap:s=""}=e;let{contrast_limits:c,visibilities:d,colors:u}=e;const p=t[0].shape[r];for(const h of[c,d,o,u])if(h&&h.length!==p){const e=Object.keys({channelProp:h})[0];throw Error(`channel_axis is length ${p} and provided channel_axis property ${e} is different size.`)}if(d||(d=p<=6?Array(p).fill(!0):[...Array(6).fill(!0),...Array(p-6).fill(!1)]),!u)if(1==p)u=[be.white];else if(2==p)u=ve;else if(3===p)u=_e;else if(p<=6)u=Pe.slice(0,p);else{u=Array(p).fill(be.white);const e=d.flatMap(((e,t)=>e?t:[]));for(const[t,n]of e.entries())u[n]=Pe[t]}return{loader:t,name:a,channel_axis:Number(r),colors:u,names:null!=o?o:ke(p).map((e=>`channel_${e}`)),contrast_limits:null!=c?c:Array(p).fill([0,n]),visibilities:d,model_matrix:Le(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:s,opacity:l},axis_labels:t[0].labels}}(e,i,d);if(2===c.shape.length||!("channel_axis"in e))return function(e,t,n){const{color:o,contrast_limits:r,visibility:a,name:i,colormap:l="",opacity:s=1}=e;return{loader:t,name:i,channel_axis:null,colors:[null!=o?o:be.white],names:["channel_0"],contrast_limits:[null!=r?r:[0,n]],visibilities:[null==a||a],model_matrix:Le(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:l,opacity:s},axis_labels:t[0].labels}}(e,i,d);throw Error("Failed to load image.")},initLayerStateFromSource:Re});const Ne=S([]),De=S({zoom:0,target:[0,0,0],default:!0}),Be=C(Ne),Te=k((e=>S(s(l({},Re(e)),{id:e.id}))),((e,t)=>e.id===t.id)),qe=S((e=>{const t=e(Be);if(0===t.length)return[];const n=t.map((t=>Te(e(t))));return e(O(n))}));function We({layers:e}){var t,n;const[o,r]=j(De),a=L.exports.useRef(null);if(a.current&&(null==o?void 0:o.default)&&(null==(n=null==(t=e[0])?void 0:t.props)?void 0:n.loader)){const{deck:t}=a.current,{width:n,height:o,maxZoom:i}=function(e){const{loader:t,rows:n,columns:o}=e,[r,a]=Array.isArray(t)?[t[0],t.length]:[t,0],i=Ee(r.shape);let[l,s]=r.shape.slice(i?-3:-2);if(n&&o){const e=5;l=(l+e)*n,s=(s+e)*o}return{height:l,width:s,maxZoom:a}}(e[0].props),l=t.width<400?10:t.width<600?30:50,{zoom:s,target:c}=function([e,t],[n,o],r,a){const i=(n-2*a)/e,l=(o-2*a)/t;return{zoom:Math.min(r,Math.log2(Math.min(i,l))),target:[e/2,t/2,0]}}([n,o],[t.width,t.height],i,l);r({zoom:s,target:c})}return E(M,{ref:a,layers:e,viewState:o,onViewStateChange:e=>r(e.viewState),views:[new $({id:"ortho",controller:!0})]})}function Ue(){const e=z(qe).map((e=>e.on?new e.Layer(e.layerProps):null));return E(We,{layers:e})}function Ge({sourceAtom:e,layerAtom:t}){const n=z(e),[o,r]=j(t);return E(F,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:e=>{e.stopPropagation(),r((e=>{const t=!e.on;return s(l({},e),{on:t})}))},style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${o.on?1:.5})`},children:o.on?E(R,{}):E(V,{})})}const Je=N({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(D);function He({sourceAtom:e,layerAtom:t,name:n}){const o=`layer-controller-${z(e).id}`;return E(Je,{"aria-controls":o,id:o,children:B("div",{style:{display:"flex",flexDirection:"row"},children:[E(Ge,{sourceAtom:e,layerAtom:t}),E(T,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function Ze({sourceAtom:e}){const t=z(e),{acquisitionId:n,acquisitions:o}=t;if(!o)return null;return E(q,{children:E(W,{children:B(U,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:e=>{let t=e.target.value;const n=new URL(window.location.href);"-1"===t?n.searchParams.delete("acquisition"):n.searchParams.set("acquisition",t),window.location.href=decodeURIComponent(n.href)},value:n,children:[E("option",{value:"-1",children:"Filter by Acquisition"},"-1"),o.map((e=>B("option",{value:(e=e).id,children:["Acquisition: ",e.name]},e.id)))]})})})}function Ke({sourceAtom:e,layerAtom:t}){const n=z(e),[o,r]=j(t),[a,i]=L.exports.useState(null),c=()=>{i(null)},{names:d}=n,u=Boolean(a),p=u?`layer-${n.id}-add-channel`:void 0;return B(q,{children:[E(F,{onClick:e=>{i(e.currentTarget)},"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:6===o.layerProps.loaderSelection.length,children:E(G,{})}),E(J,{id:p,open:u,anchorEl:a,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:B(H,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[E(T,{variant:"caption",children:"selection: "}),E(Z,{}),B(U,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:e=>{const{defaults:{selection:t},channel_axis:o,colors:a,contrast_limits:i}=n;c();const d=+e.target.value,u=[...t];o&&(u[o]=d),r((e=>{const{layerProps:t}=e,n=[...t.loaderSelection,u],o=[...t.colorValues,Oe(a[d])],r=[...t.sliderValues,i[d]],c=[...r],p=[...t.channelIsOn,!0];return s(l({},e),{layerProps:s(l({},t),{loaderSelection:n,colorValues:o,sliderValues:r,contrastLimits:c,channelIsOn:p})})}))},children:[E("option",{"aria-label":"None",value:"",children:"None"}),d.map(((e,t)=>E("option",{value:t,children:e},e)))]})]})})]})}const Xe=N({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(K);function Ye({layerAtom:e}){const[t,n]=j(e);return E(Xe,{value:t.layerProps.opacity,onChange:(e,t)=>{const o=t;n((e=>s(l({},e),{layerProps:s(l({},e.layerProps),{opacity:o})})))},min:0,max:1,step:.01})}const Qe=N({root:{width:"5.5em",fontSize:"0.7em"}})(X);function et({sourceAtom:e,layerAtom:t,axisIndex:n,max:o}){const r=z(e),[a,i]=j(t),[c,d]=L.exports.useState(null),u=Boolean(c),p=u?`${n}-index-${r.id}-options`:void 0,h=a.layerProps.loaderSelection[0]?a.layerProps.loaderSelection[0][n]:1;return B(q,{children:[E(F,{onClick:e=>{d(e.currentTarget)},"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(Y,{})}),E(J,{id:p,open:u,anchorEl:c,onClose:()=>{d(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:B(H,{style:{padding:"0px 4px",marginBottom:4},children:[E(T,{variant:"caption",children:"Index:"}),E(Z,{}),E(Qe,{value:h,onChange:e=>{let t=+e.target.value;t<0&&(t=0),t>o&&(t=o),i((e=>{let o=l({},e.layerProps);return o.loaderSelection=o.loaderSelection.map((e=>{let o=[...e];return o[n]=t,o})),s(l({},e),{layerProps:o})}))},type:"number",id:"max",fullWidth:!1}),E(Z,{})]})})]})}const tt=N({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(K);function nt({sourceAtom:e,layerAtom:t,axisIndex:n,max:o}){const[r,a]=j(t),i=z(e),{axis_labels:c}=i;let d=c[n];"t"!==d&&"z"!==d||(d=d.toUpperCase());const[u,p]=L.exports.useState(0);L.exports.useEffect((()=>{p(r.layerProps.loaderSelection[0]?r.layerProps.loaderSelection[0][n]:1)}),[r.layerProps.loaderSelection]);return B(q,{children:[B(W,{children:[B(W,{container:!0,justifyContent:"space-between",children:[E(W,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:B(T,{variant:"caption",noWrap:!0,children:[d,": ",u,"/",o]})})}),E(W,{item:!0,xs:1,children:E(et,{sourceAtom:e,layerAtom:t,axisIndex:n,max:o})})]}),E(W,{container:!0,justifyContent:"space-between",children:E(W,{item:!0,xs:12,children:E(tt,{value:u,onChange:(e,t)=>{p(t)},onChangeCommitted:()=>{a((e=>{let t=l({},e.layerProps);return t.loaderSelection=t.loaderSelection.map((e=>{let t=[...e];return t[n]=u,t})),s(l({},e),{layerProps:t})}))},min:0,max:o,step:1})})})]}),E(Z,{})]})}function ot({sourceAtom:e,layerAtom:t}){const n=z(e),{axis_labels:o,channel_axis:r,loader:a}=n,i=o.slice(0,-2).map(((e,t)=>[e,t,a[0].shape[t]])).filter((e=>e[1]!==r&&e[2]>1)).map((([n,o,r])=>E(nt,{sourceAtom:e,layerAtom:t,axisIndex:o,max:r-1},n)));return 0===i.length?null:B(q,{children:[E(W,{children:i}),E(Z,{})]})}const rt=Q((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}}))),at=Object.entries(be).map((([e,t])=>[e,Oe(t)]));function it({handleChange:e}){const t=rt();return E("div",{className:t.container,"aria-label":"color-swatch",children:at.map((([n,o])=>E(F,{className:t.button,onClick:()=>e(o),children:E(ee,{fontSize:"small",style:{color:`rgb(${o})`}})},n)))})}const lt=N({root:{width:"5.5em",fontSize:"0.7em"}})(X);function st({sourceAtom:e,layerAtom:t,channelIndex:n}){const o=z(e),[r,a]=j(t),[i,c]=L.exports.useState(null),{channel_axis:d,names:u}=o,p=e=>{const t=e.target.id;let o=+e.target.value;o<0&&(o=0),a((e=>{const r=[...e.layerProps.contrastLimits],a=[...e.layerProps.sliderValues],[i,c]=r[n],[d,u]=a[n],[p,h]="min"===t?[o,c]:[i,o];return p>d&&(a[n]=[p,u]),h<u&&(a[n]=[d,h]),r[n]=[p,h],s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:a,contrastLimits:r})})}))},h=Boolean(i),m=h?`channel-${n}-${o.name}-options`:void 0,[f,g]=r.layerProps.contrastLimits[n];return B(q,{children:[E(F,{onClick:e=>{c(e.currentTarget)},"aria-describedby":m,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(Y,{})}),E(J,{id:m,open:h,anchorEl:i,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:B(H,{style:{padding:"0px 4px",marginBottom:4},children:[B("div",{style:{display:"flex",justifyContent:"space-between"},children:[E(T,{variant:"caption",children:"remove:"}),E(F,{onClick:()=>{a((e=>{const{layerProps:t}=e,o=[...t.colorValues],r=[...t.sliderValues],a=[...t.contrastLimits],i=[...t.loaderSelection],c=[...t.channelIsOn];return o.splice(n,1),r.splice(n,1),a.splice(n,1),i.splice(n,1),c.splice(n,1),s(l({},e),{layerProps:s(l({},t),{colorValues:o,sliderValues:r,loaderSelection:i,channelIsOn:c,contrastLimits:a})})}))},children:E(te,{})})]}),E(Z,{}),E(T,{variant:"caption",children:"selection:"}),E(Z,{}),E(U,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${o.name}-channel-select`,onChange:e=>{a((t=>{const o=[...t.layerProps.loaderSelection],r=[...o[n]];return Number.isInteger(d)&&(r[d]=+e.target.value,o[n]=r),s(l({},t),{layerProps:s(l({},t.layerProps),{loaderSelection:o})})}))},value:r.layerProps.loaderSelection[n][d],children:u.map(((e,t)=>B("option",{value:t,children:["(",t,") ",e]},e)))}),E(Z,{}),E(T,{variant:"caption",children:"contrast limits:"}),E(Z,{}),E(lt,{value:f,onChange:p,type:"number",id:"min",fullWidth:!1}),E(lt,{value:g,onChange:p,type:"number",id:"max",fullWidth:!1}),E(Z,{}),E(T,{variant:"caption",children:"color:"}),E(Z,{}),E("div",{style:{display:"flex",justifyContent:"center"},children:E(it,{handleChange:e=>{a((t=>{const o=[...t.layerProps.colorValues];return o[n]=e,s(l({},t),{layerProps:s(l({},t.layerProps),{colorValues:o})})}))}})})]})})]})}function ct({sourceAtom:e,layerAtom:t,channelIndex:n}){const o=z(e),[r,a]=j(t),{sliderValues:i,colorValues:c,contrastLimits:d,channelIsOn:u,colormap:p,loaderSelection:h}=r.layerProps,m=[...i[n]],f=`rgb(${p?[255,255,255]:c[n]})`,g=u[n],[y,w]=d[n],{channel_axis:x,names:b}=o,v=h[n],_=b[Number.isInteger(x)?v[x]:0];return B(q,{children:[B(W,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[E(W,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:E(T,{variant:"caption",noWrap:!0,children:_})})}),E(W,{item:!0,xs:1,children:E(st,{sourceAtom:e,layerAtom:t,channelIndex:n})})]}),B(W,{container:!0,justifyContent:"space-between",children:[E(W,{item:!0,xs:2,children:E(F,{style:{color:f,backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{a((e=>{const t=[...e.layerProps.channelIsOn];return t[n]=!t[n],s(l({},e),{layerProps:s(l({},e.layerProps),{channelIsOn:t})})}))},children:E(g?ne:oe,{})})}),E(W,{item:!0,xs:10,children:E(K,{value:m,onChange:(e,t)=>{a((e=>{const o=[...e.layerProps.sliderValues];return o[n]=t,s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:o})})}))},min:y,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:f}})})]})]})}const dt=N({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(re);function ut({sourceAtom:e,layerAtom:t}){const n=z(t).layerProps.loaderSelection.length;return E(dt,{children:B(W,{container:!0,direction:"column",children:[E(Ze,{sourceAtom:e,layerAtom:t}),E(W,{children:B(W,{container:!0,justifyContent:"space-between",children:[E(W,{item:!0,xs:3,children:E(T,{variant:"caption",children:"opacity:"})}),E(W,{item:!0,xs:8,children:E(Ye,{sourceAtom:e,layerAtom:t})})]})}),E(Z,{}),E(ot,{sourceAtom:e,layerAtom:t}),B(W,{container:!0,justifyContent:"space-between",children:[E(W,{item:!0,xs:3,children:E(T,{variant:"caption",children:"channels:"})}),E(W,{item:!0,xs:1,children:E(Ke,{sourceAtom:e,layerAtom:t})})]}),E(Z,{}),E(W,{children:ke(n).map((n=>E(ct,{sourceAtom:e,layerAtom:t,channelIndex:n},n)))})]})})}const pt=N({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(ae);function ht({sourceAtom:e}){const t=z(e),n=Te(t),{name:o=""}=t;return B(pt,{defaultExpanded:!0,children:[E(He,{sourceAtom:e,layerAtom:n,name:o}),E(ut,{sourceAtom:e,layerAtom:n})]})}const mt=Q({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function ft(){const e=z(Be),[t,n]=L.exports.useReducer((e=>!e),!1),o=mt();return E("div",{className:o.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:B(W,{container:!0,direction:"column",alignItems:"flex-start",children:[E(F,{style:{backgroundColor:"transparent",padding:0},onClick:n,children:E(t?G:te,{})}),E("div",{className:o.scroll,style:{display:t?"none":"flex"},children:e.map((e=>E(ht,{sourceAtom:e},`${e}`)))})]})})}function gt(){const e=ie(Ne),t=ie(De);async function n(t){const{createSourceData:n}=await me((()=>Promise.resolve().then((function(){return Ve}))),void 0),o=Math.random().toString(36).slice(2),r=await n(t);e((e=>(r.name||(r.name=`image_${Object.keys(e).length}`),[...e,l({id:o},r)])))}return L.exports.useEffect((()=>{const e=new URLSearchParams(window.location.search);if(e.has("source")){const t={};for(const[n,a]of e)t[n]=a;t.source=decodeURIComponent(t.source),n(t);const o=new URL(window.location.href);o.searchParams.set("source",t.source);const r=decodeURIComponent(o.toString());window.location.href!==r&&window.history.pushState(null,"",r)}}),[]),L.exports.useEffect((()=>{window.self!==window.top&&async function(){const{imjoyRPC:e}=await me((()=>import("./index.ecf68b74.js").then((function(e){return e.i}))),[]);(await e.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:"0.3.0"})).export({add_image:async e=>n(e),set_view_state:async e=>t(e)})}()}),[]),B(q,{children:[E(ft,{}),E(Ue,{})]})}var yt=le({palette:{type:"dark",primary:se,secondary:se},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const wt=new Map;function xt(e,t){ce(e,(()=>{if(!wt.has(e)){const n=t().then((e=>e.default)).catch((t=>{throw wt.delete(e),t}));wt.set(e,n)}return wt.get(e)}))}xt("lz4",(()=>me((()=>import("./lz4.90bd37fe.js")),["lz4.90bd37fe.js","utils-6b0080f1.f4680ab2.js"]))),xt("gzip",(()=>me((()=>import("./gzip.2d512667.js")),["gzip.2d512667.js","pako.esm-9240ff4b.6c52ac68.js"]))),xt("zlib",(()=>me((()=>import("./zlib.3b3d5619.js")),["zlib.3b3d5619.js","pako.esm-9240ff4b.6c52ac68.js"]))),xt("zstd",(()=>me((()=>import("./zstd.73353642.js")),["zstd.73353642.js","utils-6b0080f1.f4680ab2.js"]))),xt("blosc",(()=>me((()=>import("./blosc.0f249b18.js")),["blosc.0f249b18.js","utils-6b0080f1.f4680ab2.js"]))),console.log("vizarr v0.3.0: https://github.com/hms-dbmi/vizarr"),de.render(E(ue,{theme:yt,children:E(pe,{children:E(gt,{})})}),document.getElementById("root"));
