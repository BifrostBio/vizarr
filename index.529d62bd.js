var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&i(e,n,t[n]);if(r)for(var n of r(t))a.call(t,n)&&i(e,n,t[n]);return e},s=(e,r)=>t(e,n(r));import{X as c,C as d,p as u,S as p,T as h,Q as m,o as f,a as g,b as y,Z as w,H as x,M as b,c as v,G as _,d as P,I,e as A,s as S,w as C,f as O,u as k,j as E,g as z,r as j,D as L,O as M,h as $,V as F,i as R,k as V,A as N,l as D,m as T,F as B,n as q,N as W,q as U,P as G,t as H,v as J,x as Z,y as K,z as X,B as Y,L as Q,R as ee,E as te,J as ne,K as re,U as oe,W as ae,Y as ie,_ as le,$ as se,a0 as ce,a1 as de,a2 as ue}from"./vendor.c0a62344.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const pe={},he=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in pe)return;pe[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise(((e,t)=>{r.addEventListener("load",e),r.addEventListener("error",t)})):void 0}))).then((()=>e())):e()},me=s(l({},c.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function fe(e,t,n=[0,0],r=1){const[o,a]=n;return[o,t*r+a,e*r+o,a]}function ge(e){const{loaders:t,loaderSelection:n=[]}=e;let{concurrency:r}=e;r&&n.length>0&&(r=Math.ceil(r/n.length));return u(t,(async e=>{const t=n.map((t=>e.loader.getRaster({selection:t}))),r=await Promise.all(t);return s(l({},e),{data:{data:r.map((e=>e.data)),width:r[0].width,height:r[0].height}})}),{concurrency:r})}class ye extends d{initializeState(){this.state={gridData:[],width:0,height:0},ge(this.props).then((e=>{const{width:t,height:n}=function(e){const[t]=e,{width:n,height:r}=t.data;return e.forEach((({data:e})=>{if((null==e?void 0:e.width)!==n||(null==e?void 0:e.height)!==r)throw new Error("Grid data is not same shape.")})),{width:n,height:r}}(e);this.setState({gridData:e,width:t,height:n})}))}updateState({props:e,oldProps:t,changeFlags:n}){const{propsChanged:r}=n,o="string"==typeof r&&r.includes("props.loaders"),a=e.loaderSelection!==t.loaderSelection;(o||a)&&ge(this.props).then((e=>{this.setState({gridData:e})}))}getPickingInfo({info:e}){if(!e.coordinate)return e;const t=this.props.spacer||0,{width:n,height:r}=this.state,[o,a]=e.coordinate,i=Math.floor(a/(r+t)),l=Math.floor(o/(n+t));return e.gridCoord={row:i,column:l},e}renderLayers(){const{gridData:e,width:t,height:n}=this.state;if(0===t||0===n)return null;const{rows:r,columns:o,spacer:a=0,id:i=""}=this.props,s=e.map((e=>{const r=e.row*(n+a),o=e.col*(t+a),s={channelData:e.data,bounds:fe(t,n,[o,r]),id:`${i}-GridLayer-${e.row}-${e.col}`,dtype:e.loader.dtype||"Uint16",pickable:!1};return new c(l(l({},this.props),s))}));if(this.props.pickable){const[e,c]=[0,0],d=r*(n+a),u=o*(t+a),h={data:[{polygon:[[c,e],[u,e],[u,d],[c,d]]}],getPolygon:e=>e.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${i}-GridLayer-picking`},m=new p(l(l({},this.props),h));s.push(m)}if(this.props.text){const r=new h({id:`${i}-GridLayer-text`,data:e,getPosition:e=>[e.col*(t+a),e.row*(n+a)],getText:e=>e.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});s.push(r)}return s}}ye.layerName="GridLayer",ye.defaultProps=me;class we{constructor(e,t=100){var n,r;i(this,"symbol"!=typeof(n="cache")?n+"":n,r),this.store=e,this.cache=new m({maxSize:t})}getItem(...e){const[t,n]=e;if(this.cache.has(t))return this.cache.get(t);const r=this.store.getItem(t,n).catch((e=>{throw this.cache.delete(t),e}));return this.cache.set(t,r),r}async containsItem(e){return this.cache.has(e)||this.store.containsItem(e)}keys(){return this.store.keys()}deleteItem(e){throw new Error("deleteItem not implemented")}setItem(e,t){throw new Error("setItem not implemented")}}const xe={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},be=[xe.magenta,xe.green],ve=[xe.red,xe.green,xe.blue],_e=Object.values(xe).slice(0,-2);async function Pe(e){const{store:t,path:n}=await async function(e){let t;if("string"==typeof e){let n;if(e.endsWith(".json")){const[{ReferenceStore:t},r]=await Promise.all([he((()=>import("./index.157d23f4.js")),[]),fetch(e).then((e=>e.json()))]);n=t.fromJSON(r)}else{const r=new URL(e);n=new x(r.origin),t=r.pathname.slice(1)}return{store:new we(n),path:t}}return{store:e,path:t}}(e);return f(t,n).catch((e=>{if(e instanceof g)return y({store:t});throw e}))}const Ie=new TextDecoder;function Ae(e,t){return e.store.getItem(ke(e.path,t,".zattrs")).then((e=>Ie.decode(e))).then((e=>JSON.parse(e)))}async function Se(e,t){const{datasets:n}=t[0]||[{path:"0"}],r=await Promise.all(n.map((({path:t})=>e.getItem(t))));if(r.every((e=>e instanceof w)))return r;throw Error("Multiscales metadata included a path to a group.")}function Ce(e){e.startsWith("#")&&(e=e.slice(1));return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Oe(e){return Array.from({length:e},((e,t)=>t))}function ke(...e){return e.filter(Boolean).map((e=>function(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}(e,"/"))).join("/")}function Ee(e){function t(e){return"t"===e?"time":"c"===e?"channel":"space"}let n=[{type:"time",name:"t"},{type:"channel",name:"c"},{type:"space",name:"z"},{type:"space",name:"y"},{type:"space",name:"x"}];return e[0].axes&&(n=e[0].axes.map((e=>{if("string"==typeof e)return{name:e,type:t(e)};const{name:n,type:r}=e;return{name:n,type:null!=r?r:t(n)}}))),n}function ze(e){return e.map((e=>e.name))}function je(e,t){return t||(t=e<=6?Array(e).fill(!0):[...Array(6).fill(!0),...Array(e-6).fill(!1)]),t}function Le(e,t){let n=[];if(1==e)n=[xe.white];else if(2==e)n=be;else if(3===e)n=ve;else if(e<=6)n=_e.slice(0,e);else{n=Array(e).fill(xe.white);const r=t.flatMap(((e,t)=>e?t:[]));for(const[e,t]of r.entries())n[t]=_e[e]}return n}function Me(e){const t=e[e.length-1];return 3===t||4===t}function $e(e){const t=Me(e.shape),[n,r]=e.chunks.slice(t?-3:-2),o=Math.min(n,r);return 2**Math.floor(Math.log2(o))}function Fe(e){if(!e)return new b;const t=new b;try{const r="string"==typeof e?JSON.parse(e):e;if(n=r,!Array.isArray(n)||16!==n.length||!n.every((e=>"number"==typeof e)))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...r)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(t)}var n;return t}async function Re(e,t){if("Uint8"===e.dtype)return[0,255];const{data:n}=await e.getRaster({selection:t});let r=1/0,o=-1/0;for(let a=0;a<n.length;a++)n[a]>o&&(o=n[a]),n[a]<r&&(r=n[a]);return r===o&&(r=0,o=1),[r,o]}async function Ve(e,t,n,r){const o=null!=r?r:e.shape.map((()=>0));if(e.shape[t]!==n.length)throw new Error("provided visibilities don't match number of channels");return Promise.all(n.map((async(n,r)=>{if(!n)return;const a=[...o];return a[t]=r,Re(e,a)})))}async function Ne(e,t,n){var r,o;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const a=n.rows.map((e=>e.name)),i=n.columns.map((e=>e.name)),c=n.wells.map((e=>e.path)),d=await Ae(t,c[0]);if(!("well"in d))throw Error("Path for image is not valid, not a well.");const p=d.well.images[0].path,h=await t.getItem(ke(c[0],p)).then((e=>e.attrs.asObject()));if(!("multiscales"in h))throw Error("Path for image is not valid.");const{datasets:m}=h.multiscales[0],f=m[m.length-1].path;const g=await Promise.all(c.map((async function(e){return ke(e,(await Ae(t,e)).well.images[0].path)}))),y=await u(g.map((e=>[e,ke(e,f)])),(([e,n])=>t.getItem(n).then((t=>[e,t]))),{concurrency:10}),w=await Promise.all(y),x=Ee(h.multiscales),b=ze(x),_=$e(w[0][1]),P=w.map((e=>{const[t,n]=e[0].split("/");return{name:`${t}${n}`,row:a.indexOf(t),col:i.indexOf(n),loader:new v(e[1],b,_)}}));let I;I="omero"in h?Te(h.omero,x):await De(P[0].loader,b);const A=s(l({loaders:P},I),{axis_labels:b,loader:[P[0].loader],model_matrix:Fe(e.model_matrix),defaults:{selection:I.defaultSelection,colormap:null!=(r=e.colormap)?r:"",opacity:null!=(o=e.opacity)?o:1},name:n.name||"Plate",rows:a.length,columns:i.length});return A.onClick=n=>{let r=n.gridCoord;if(!r)return;const{row:o,column:l}=r;let s;"string"!=typeof e.source||!t.path||isNaN(o)||isNaN(l)||(s=ke(e.source,a[o],i[l])),e.onClick?(delete n.layer,n.imageSource=s,e.onClick(n)):s&&window.open(window.location.origin+window.location.pathname+"?source="+s)},A}async function De(e,t){const n=t.indexOf("c"),r=e.shape[n],o=je(r),a=await Ve(e,n,o),i=Le(r,o);return{name:"Image",names:Oe(r).map((e=>`channel_${e}`)),colors:i,contrast_limits:a,visibilities:o,channel_axis:t.includes("c")?t.indexOf("c"):null,defaultSelection:t.map((()=>0))}}function Te({rdefs:e,channels:t,name:n},r){var o,a;const i=null!=(o=e.defaultT)?o:0,l=null!=(a=e.defaultZ)?a:0,s=[],c=[],d=[],u=[];t.forEach((e=>{s.push(e.color),c.push([e.window.start,e.window.end]),d.push(e.active),u.push(e.label)}));const p=r.map((e=>"time"==e.type?i:"z"==e.name?l:0)),h=r.findIndex((e=>"channel"===e.type));return{name:n,names:u,colors:s,contrast_limits:c,visibilities:d,channel_axis:h,defaultSelection:p}}function Be(e){var t;const{loader:n,channel_axis:r,colors:o,visibilities:a,contrast_limits:i,model_matrix:l,defaults:s,loaders:c,rows:d,columns:u,onClick:p}=e,{selection:h,opacity:m,colormap:f}=s,g=function(e){return e.loaders?ye:e.loader.length>1?P:I}(e),y=[],w=[],x=[],b=[],v=a.flatMap(((e,t)=>e?t:[]));for(const P of v){const e=[...h];Number.isInteger(r)&&(e[r]=P),y.push(e),w.push(Ce(o[P])),x.push(null!=(t=i[P])?t:[0,255]),b.push(!0)}const _=[...x];return{Layer:g,layerProps:{loader:1===n.length?n[0]:n,loaders:c,rows:d,columns:u,loaderSelection:y,colorValues:w,sliderValues:_,contrastLimits:x,channelIsOn:b,opacity:m,colormap:f,modelMatrix:l,onClick:p},on:!0}}var qe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:async function(e){var t;const n=await Pe(e.source);let r,o;if(n instanceof _){const t=await n.attrs.asObject();if("plate"in t)return Ne(e,n,t.plate);if("well"in t)return async function(e,t,n){var r,o,a,i;const c=e.acquisition?parseInt(e.acquisition):void 0;let d=[];if(!(null==n?void 0:n.images))throw Error("Well .zattrs missing images");if(!t.path)throw Error("Cannot inspect zarr path to open well.");const[u,p]=t.path.split("/").filter(Boolean).slice(-2);let{images:h}=n;const m=h.flatMap((e=>e.acquisition?[e.acquisition]:[]));if(m.length>1){const e=t.path.replace(`${u}/${p}`,""),n=await f(t.store,e),a=await n.attrs.asObject();d=null!=(o=null==(r=null==a?void 0:a.plate)?void 0:r.acquisitions)?o:[],c&&m.includes(c)&&(h=h.filter((e=>e.acquisition===c)))}const g=h.map((e=>e.path)),y=Math.ceil(Math.sqrt(g.length)),w=Math.ceil(g.length/y),x=await t.getItem(g[0]).then((e=>e.attrs.asObject()));if(!("multiscales"in x))throw Error("Path for image is not valid.");let b=x.multiscales[0].datasets[0].path;const _=g.map((e=>t.getItem(ke(e,b)))),P=await Promise.all(_),I=Ee(x.multiscales),A=ze(I),S=$e(P[0]),C=Oe(w).flatMap((e=>Oe(y).map((t=>{const n=t+e*y;return{name:String(n),row:e,col:t,loader:new v(P[n],A,S)}}))));let O;O="omero"in x?Te(x.omero,I):await De(C[0].loader,A);const k=s(l({loaders:C},O),{axis_labels:A,loader:[C[0].loader],model_matrix:Fe(e.model_matrix),defaults:{selection:O.defaultSelection,colormap:null!=(a=e.colormap)?a:"",opacity:null!=(i=e.opacity)?i:1},name:`Well ${u}${p}`});return d.length>0&&(k.acquisitions=d,k.acquisitionId=c||-1),k.rows=w,k.columns=y,k.onClick=n=>{let r=n.gridCoord;if(!r)return;const{row:o,column:a}=r;let i;if("string"==typeof e.source&&t.path&&!isNaN(o)&&!isNaN(a)){const t=o*y+a;i=ke(e.source,g[t])}e.onClick?(delete n.layer,n.imageSource=i,e.onClick(n)):i&&window.open(window.location.origin+window.location.pathname+"?source="+i)},k}(e,n,t.well);if("omero"in t)return async function(e,t,n){var r;const{name:o,opacity:a=1,colormap:i=""}=e,c=await Se(t,n.multiscales),d=Ee(n.multiscales),u=ze(d),p=Te(n.omero,d),h=$e(c[0]),m=c.map((e=>new v(e,u,h)));return s(l({loader:m,axis_labels:u,model_matrix:Fe(e.model_matrix),defaults:{selection:p.defaultSelection,colormap:i,opacity:a}},p),{name:null!=(r=p.name)?r:o})}(e,n,t);if(0===Object.keys(t).length&&n.path){const t=n.path.slice(0,n.path.lastIndexOf("/")),r=await f(n.store,t),o=await r.attrs.asObject();if("plate"in o)return Ne(e,r,o.plate)}if(!("multiscales"in t))throw Error("Group is missing multiscales specification.");r=await Se(n,t.multiscales),t.multiscales[0].axes&&(o=Ee(t.multiscales))}else r=[n];const{channel_axis:a,labels:i}=function(e,t,n){const r=e.axis_labels,o="channel_axis"in e?Number(e.channel_axis):void 0;if(t){return{labels:null!=r?r:ze(t),channel_axis:null!=o?o:t.findIndex((e=>"channel"===e.type))}}const a=null!=r?r:function(e,t){t&&t.length==e.shape.length||(t=e.shape.slice(0,-2).map(((e,t)=>""+t)).concat(["y","x"]));return t}(n),i=null!=o?o:a.indexOf("c");return{labels:a,channel_axis:i}}(e,o,r[0]),c=$e(r[0]),d=r.map((e=>new v(e,i,c))),[u]=d;if("channel_axis"in e||a>-1)return async function(e,t,n){const{names:r,contrast_limits:o,name:a,model_matrix:i,opacity:l=1,colormap:s=""}=e;let{visibilities:c,colors:d}=e;const u=t[0].shape[n];for(const h of[o,c,r,d])if(h&&h.length!==u){const e=Object.keys({channelProp:h})[0];throw Error(`channel_axis is length ${u} and provided channel_axis property ${e} is different size.`)}c=c||je(u),d=d||Le(u,c);const p=null!=o?o:await Ve(t[t.length-1],n,c);return{loader:t,name:a,channel_axis:n,colors:d,names:null!=r?r:Oe(u).map((e=>`channel_${e}`)),contrast_limits:p,visibilities:c,model_matrix:Fe(i),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:s,opacity:l},axis_labels:t[0].labels}}(e=e,d,Number(null!=(t=e.channel_axis)?t:a));if(2===u.shape.length||!("channel_axis"in e))return async function(e,t){const{color:n,contrast_limits:r,visibility:o,name:a,colormap:i="",opacity:l=1}=e,s=null!=r?r:await Re(t[t.length-1],[0,0,0]);return{loader:t,name:a,channel_axis:null,colors:[null!=n?n:xe.white],names:["channel_0"],contrast_limits:[s],visibilities:[null==o||o],model_matrix:Fe(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:i,opacity:l},axis_labels:t[0].labels}}(e,d);throw Error("Failed to load image.")},initLayerStateFromSource:Be});const We=A([]),Ue=A({zoom:0,target:[0,0,0],default:!0}),Ge=S(We),He=O((e=>A(s(l({},Be(e)),{id:e.id}))),((e,t)=>e.id===t.id)),Je=A((e=>{const t=e(Ge);if(0===t.length)return[];const n=t.map((t=>He(e(t))));return e(C(n))}));function Ze({layers:e}){var t,n;const[r,o]=z(Ue),a=j.exports.useRef(null);if(a.current&&(null==r?void 0:r.default)&&(null==(n=null==(t=e[0])?void 0:t.props)?void 0:n.loader)){const{deck:t}=a.current,{width:n,height:r,maxZoom:i}=function(e){const{loader:t,rows:n,columns:r}=e,[o,a]=Array.isArray(t)?[t[0],t.length]:[t,0],i=Me(o.shape);let[l,s]=o.shape.slice(i?-3:-2);if(n&&r){const e=5;l=(l+e)*n,s=(s+e)*r}return{height:l,width:s,maxZoom:a}}(e[0].props),l=t.width<400?10:t.width<600?30:50,{zoom:s,target:c}=function([e,t],[n,r],o,a){const i=(n-2*a)/e,l=(r-2*a)/t;return{zoom:Math.min(o,Math.log2(Math.min(i,l))),target:[e/2,t/2,0]}}([n,r],[t.width,t.height],i,l);o({zoom:s,target:c})}return E(L,{ref:a,layers:e,viewState:r,onViewStateChange:e=>o(e.viewState),views:[new M({id:"ortho",controller:!0})]})}function Ke(){const e=k(Je).map((e=>e.on?new e.Layer(e.layerProps):null));return E(Ze,{layers:e})}function Xe({sourceAtom:e,layerAtom:t}){const n=k(e),[r,o]=z(t);return E($,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:e=>{e.stopPropagation(),o((e=>{const t=!e.on;return s(l({},e),{on:t})}))},style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${r.on?1:.5})`},children:r.on?E(F,{}):E(R,{})})}const Ye=V({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(N);function Qe({sourceAtom:e,layerAtom:t,name:n}){const r=`layer-controller-${k(e).id}`;return E(Ye,{"aria-controls":r,id:r,children:D("div",{style:{display:"flex",flexDirection:"row"},children:[E(Xe,{sourceAtom:e,layerAtom:t}),E(T,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function et({sourceAtom:e}){const t=k(e),{acquisitionId:n,acquisitions:r}=t;if(!r)return null;return E(B,{children:E(q,{children:D(W,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:e=>{let t=e.target.value;const n=new URL(window.location.href);"-1"===t?n.searchParams.delete("acquisition"):n.searchParams.set("acquisition",t),window.location.href=decodeURIComponent(n.href)},value:n,children:[E("option",{value:"-1",children:"Filter by Acquisition"},"-1"),r.map((e=>D("option",{value:(e=e).id,children:["Acquisition: ",e.name]},e.id)))]})})})}function tt({sourceAtom:e,layerAtom:t}){const[n,r]=z(e),[o,a]=z(t),[i,c]=j.exports.useState(null),d=()=>{c(null)},{names:u}=n,p=Boolean(i),h=p?`layer-${n.id}-add-channel`:void 0;return D(B,{children:[E($,{onClick:e=>{c(e.currentTarget)},"aria-describedby":h,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:6===o.layerProps.loaderSelection.length,children:E(U,{})}),E(G,{id:h,open:p,anchorEl:i,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[E(T,{variant:"caption",children:"selection: "}),E(J,{}),D(W,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:async e=>{const{defaults:{selection:t},channel_axis:i,colors:c,contrast_limits:u}=n;d();const p=+e.target.value,h=[...t];let m;if(i&&(h[i]=p),u[p])m=u[p];else{const{loader:e}=o.layerProps,t=Array.isArray(e)?e[e.length-1]:e;m=await Re(t,h),r((e=>{const t=[...e.contrast_limits];return t[p]=m,s(l({},e),{contrast_limits:t})}))}a((e=>{const{layerProps:t}=e,n=[...t.loaderSelection,h],r=[...t.colorValues,Ce(c[p])],o=[...t.sliderValues,m],a=[...o],i=[...t.channelIsOn,!0];return s(l({},e),{layerProps:s(l({},t),{loaderSelection:n,colorValues:r,sliderValues:o,contrastLimits:a,channelIsOn:i})})}))},children:[E("option",{"aria-label":"None",value:"",children:"None"}),u.map(((e,t)=>E("option",{value:t,children:e},e)))]})]})})]})}const nt=V({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Z);function rt({layerAtom:e}){const[t,n]=z(e);return E(nt,{value:t.layerProps.opacity,onChange:(e,t)=>{const r=t;n((e=>s(l({},e),{layerProps:s(l({},e.layerProps),{opacity:r})})))},min:0,max:1,step:.01})}const ot=V({root:{width:"5.5em",fontSize:"0.7em"}})(K);function at({sourceAtom:e,layerAtom:t,axisIndex:n,max:r}){const o=k(e),[a,i]=z(t),[c,d]=j.exports.useState(null),u=Boolean(c),p=u?`${n}-index-${o.id}-options`:void 0,h=a.layerProps.loaderSelection[0]?a.layerProps.loaderSelection[0][n]:1;return D(B,{children:[E($,{onClick:e=>{d(e.currentTarget)},"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(X,{})}),E(G,{id:p,open:u,anchorEl:c,onClose:()=>{d(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4},children:[E(T,{variant:"caption",children:"Index:"}),E(J,{}),E(ot,{value:h,onChange:e=>{let t=+e.target.value;t<0&&(t=0),t>r&&(t=r),i((e=>{let r=l({},e.layerProps);return r.loaderSelection=r.loaderSelection.map((e=>{let r=[...e];return r[n]=t,r})),s(l({},e),{layerProps:r})}))},type:"number",id:"max",fullWidth:!1}),E(J,{})]})})]})}const it=V({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Z);function lt({sourceAtom:e,layerAtom:t,axisIndex:n,max:r}){const[o,a]=z(t),i=k(e),{axis_labels:c}=i;let d=c[n];"t"!==d&&"z"!==d||(d=d.toUpperCase());const[u,p]=j.exports.useState(0);j.exports.useEffect((()=>{p(o.layerProps.loaderSelection[0]?o.layerProps.loaderSelection[0][n]:1)}),[o.layerProps.loaderSelection]);return D(B,{children:[D(q,{children:[D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:D(T,{variant:"caption",noWrap:!0,children:[d,": ",u,"/",r]})})}),E(q,{item:!0,xs:1,children:E(at,{sourceAtom:e,layerAtom:t,axisIndex:n,max:r})})]}),E(q,{container:!0,justifyContent:"space-between",children:E(q,{item:!0,xs:12,children:E(it,{value:u,onChange:(e,t)=>{p(t)},onChangeCommitted:()=>{a((e=>{let t=l({},e.layerProps);return t.loaderSelection=t.loaderSelection.map((e=>{let t=[...e];return t[n]=u,t})),s(l({},e),{layerProps:t})}))},min:0,max:r,step:1})})})]}),E(J,{})]})}function st({sourceAtom:e,layerAtom:t}){const n=k(e),{axis_labels:r,channel_axis:o,loader:a}=n,i=r.slice(0,-2).map(((e,t)=>[e,t,a[0].shape[t]])).filter((e=>e[1]!==o&&e[2]>1)).map((([n,r,o])=>E(lt,{sourceAtom:e,layerAtom:t,axisIndex:r,max:o-1},n)));return 0===i.length?null:D(B,{children:[E(q,{children:i}),E(J,{})]})}const ct=Y((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}}))),dt=Object.entries(xe).map((([e,t])=>[e,Ce(t)]));function ut({handleChange:e}){const t=ct();return E("div",{className:t.container,"aria-label":"color-swatch",children:dt.map((([n,r])=>E($,{className:t.button,onClick:()=>e(r),children:E(Q,{fontSize:"small",style:{color:`rgb(${r})`}})},n)))})}const pt=V({root:{width:"5.5em",fontSize:"0.7em"}})(K);function ht({sourceAtom:e,layerAtom:t,channelIndex:n}){const r=k(e),[o,a]=z(t),[i,c]=j.exports.useState(null),{channel_axis:d,names:u}=r,p=e=>{const t=e.target.id;let r=+e.target.value;r<0&&(r=0),a((e=>{const o=[...e.layerProps.contrastLimits],a=[...e.layerProps.sliderValues],[i,c]=o[n],[d,u]=a[n],[p,h]="min"===t?[r,c]:[i,r];return p>d&&(a[n]=[p,u]),h<u&&(a[n]=[d,h]),o[n]=[p,h],s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:a,contrastLimits:o})})}))},h=Boolean(i),m=h?`channel-${n}-${r.name}-options`:void 0,[f,g]=o.layerProps.contrastLimits[n];return D(B,{children:[E($,{onClick:e=>{c(e.currentTarget)},"aria-describedby":m,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(X,{})}),E(G,{id:m,open:h,anchorEl:i,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4},children:[D("div",{style:{display:"flex",justifyContent:"space-between"},children:[E(T,{variant:"caption",children:"remove:"}),E($,{onClick:()=>{a((e=>{const{layerProps:t}=e,r=[...t.colorValues],o=[...t.sliderValues],a=[...t.contrastLimits],i=[...t.loaderSelection],c=[...t.channelIsOn];return r.splice(n,1),o.splice(n,1),a.splice(n,1),i.splice(n,1),c.splice(n,1),s(l({},e),{layerProps:s(l({},t),{colorValues:r,sliderValues:o,loaderSelection:i,channelIsOn:c,contrastLimits:a})})}))},children:E(ee,{})})]}),E(J,{}),E(T,{variant:"caption",children:"selection:"}),E(J,{}),E(W,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${r.name}-channel-select`,onChange:e=>{a((t=>{const r=[...t.layerProps.loaderSelection],o=[...r[n]];return Number.isInteger(d)&&(o[d]=+e.target.value,r[n]=o),s(l({},t),{layerProps:s(l({},t.layerProps),{loaderSelection:r})})}))},value:o.layerProps.loaderSelection[n][d],children:u.map(((e,t)=>D("option",{value:t,children:["(",t,") ",e]},e)))}),E(J,{}),E(T,{variant:"caption",children:"contrast limits:"}),E(J,{}),E(pt,{value:f,onChange:p,type:"number",id:"min",fullWidth:!1}),E(pt,{value:g,onChange:p,type:"number",id:"max",fullWidth:!1}),E(J,{}),E(T,{variant:"caption",children:"color:"}),E(J,{}),E("div",{style:{display:"flex",justifyContent:"center"},children:E(ut,{handleChange:e=>{a((t=>{const r=[...t.layerProps.colorValues];return r[n]=e,s(l({},t),{layerProps:s(l({},t.layerProps),{colorValues:r})})}))}})})]})})]})}function mt({sourceAtom:e,layerAtom:t,channelIndex:n}){const r=k(e),[o,a]=z(t),{sliderValues:i,colorValues:c,contrastLimits:d,channelIsOn:u,colormap:p,loaderSelection:h}=o.layerProps,m=[...i[n]],f=`rgb(${p?[255,255,255]:c[n]})`,g=u[n],[y,w]=d[n],{channel_axis:x,names:b}=r,v=h[n],_=b[Number.isInteger(x)?v[x]:0];return D(B,{children:[D(q,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[E(q,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:E(T,{variant:"caption",noWrap:!0,children:_})})}),E(q,{item:!0,xs:1,children:E(ht,{sourceAtom:e,layerAtom:t,channelIndex:n})})]}),D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:2,children:E($,{style:{color:f,backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{a((e=>{const t=[...e.layerProps.channelIsOn];return t[n]=!t[n],s(l({},e),{layerProps:s(l({},e.layerProps),{channelIsOn:t})})}))},children:E(g?te:ne,{})})}),E(q,{item:!0,xs:10,children:E(Z,{value:m,onChange:(e,t)=>{a((e=>{const r=[...e.layerProps.sliderValues];return r[n]=t,s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:r})})}))},min:y,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:f}})})]})]})}const ft=V({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(re);function gt({sourceAtom:e,layerAtom:t}){const n=k(t).layerProps.loaderSelection.length;return E(ft,{children:D(q,{container:!0,direction:"column",children:[E(et,{sourceAtom:e,layerAtom:t}),E(q,{children:D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:3,children:E(T,{variant:"caption",children:"opacity:"})}),E(q,{item:!0,xs:8,children:E(rt,{sourceAtom:e,layerAtom:t})})]})}),E(J,{}),E(st,{sourceAtom:e,layerAtom:t}),D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:3,children:E(T,{variant:"caption",children:"channels:"})}),E(q,{item:!0,xs:1,children:E(tt,{sourceAtom:e,layerAtom:t})})]}),E(J,{}),E(q,{children:Oe(n).map((n=>E(mt,{sourceAtom:e,layerAtom:t,channelIndex:n},n)))})]})})}const yt=V({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(oe);function wt({sourceAtom:e}){const t=k(e),n=He(t),{name:r=""}=t;return D(yt,{defaultExpanded:!0,children:[E(Qe,{sourceAtom:e,layerAtom:n,name:r}),E(gt,{sourceAtom:e,layerAtom:n})]})}const xt=Y({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function bt(){const e=k(Ge),[t,n]=j.exports.useReducer((e=>!e),!1),r=xt();return E("div",{className:r.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:D(q,{container:!0,direction:"column",alignItems:"flex-start",children:[E($,{style:{backgroundColor:"transparent",padding:0},onClick:n,children:E(t?U:ee,{})}),E("div",{className:r.scroll,style:{display:t?"none":"flex"},children:e.map((e=>E(wt,{sourceAtom:e},`${e}`)))})]})})}function vt(){const e=ae(We),t=ae(Ue);async function n(t){const{createSourceData:n}=await he((()=>Promise.resolve().then((function(){return qe}))),void 0),r=Math.random().toString(36).slice(2),o=await n(t);e((e=>(o.name||(o.name=`image_${Object.keys(e).length}`),[...e,l({id:r},o)])))}return j.exports.useEffect((()=>{const e=new URLSearchParams(window.location.search);if(e.has("source")){const t={};for(const[n,a]of e)t[n]=a;t.source=decodeURIComponent(t.source),n(t);const r=new URL(window.location.href);r.searchParams.set("source",t.source);const o=decodeURIComponent(r.toString());window.location.href!==o&&window.history.pushState(null,"",o)}}),[]),j.exports.useEffect((()=>{window.self!==window.top&&async function(){const{imjoyRPC:e}=await he((()=>import("./index.ecf68b74.js").then((function(e){return e.i}))),[]);(await e.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:"0.3.0"})).export({add_image:async e=>n(e),set_view_state:async e=>t(e)})}()}),[]),D(B,{children:[E(bt,{}),E(Ke,{})]})}var _t=ie({palette:{type:"dark",primary:le,secondary:le},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const Pt=new Map;function It(e,t){se(e,(()=>{if(!Pt.has(e)){const n=t().then((e=>e.default)).catch((t=>{throw Pt.delete(e),t}));Pt.set(e,n)}return Pt.get(e)}))}It("lz4",(()=>he((()=>import("./lz4.90bd37fe.js")),["lz4.90bd37fe.js","utils-6b0080f1.f4680ab2.js"]))),It("gzip",(()=>he((()=>import("./gzip.2d512667.js")),["gzip.2d512667.js","pako.esm-9240ff4b.6c52ac68.js"]))),It("zlib",(()=>he((()=>import("./zlib.3b3d5619.js")),["zlib.3b3d5619.js","pako.esm-9240ff4b.6c52ac68.js"]))),It("zstd",(()=>he((()=>import("./zstd.73353642.js")),["zstd.73353642.js","utils-6b0080f1.f4680ab2.js"]))),It("blosc",(()=>he((()=>import("./blosc.0f249b18.js")),["blosc.0f249b18.js","utils-6b0080f1.f4680ab2.js"]))),It("jpeg2k",(()=>he((()=>import("./jpeg2k.effd323e.js")),[]))),console.log("vizarr v0.3.0: https://github.com/hms-dbmi/vizarr"),ce.render(E(de,{theme:_t,children:E(ue,{children:E(vt,{})})}),document.getElementById("root"));
