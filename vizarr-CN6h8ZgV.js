const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./blosc-CAH7LpMT.js","./chunk-INHXZS53-BwBC_UMW.js","./gzip-BamaTLWd.js","./browser-BeA5E5X3.js","./lz4-CQc_tcCf.js","./zlib-B21wBxKw.js","./zstd-CIO_1wnt.js","./deflate-DXrZzV2C.js","./pako.esm-CpTEATNv.js","./lerc-BirfXWYY.js"])))=>i.map(i=>d[i]);
var DP=Object.defineProperty;var t3=n=>{throw TypeError(n)};var LP=(n,e,t)=>e in n?DP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var S=(n,e,t)=>LP(n,typeof e!="symbol"?e+"":e,t),$m=(n,e,t)=>e.has(n)||t3("Cannot "+t);var be=(n,e,t)=>($m(n,e,"read from private field"),t?t.call(n):e.get(n)),vt=(n,e,t)=>e.has(n)?t3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),nt=(n,e,t,r)=>($m(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Mt=(n,e,t)=>($m(n,e,"access private method"),t);var jm=(n,e,t,r)=>({set _(s){nt(n,e,s,t)},get _(){return be(n,e,r)}});function FP(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function Ea(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wm={exports:{}},jc={},Hm={exports:{}},ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n3;function BP(){if(n3)return ct;n3=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;function m(b){return b===null||typeof b!="object"?null:(b=p&&b[p]||b["@@iterator"],typeof b=="function"?b:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,w={};function T(b,O,W){this.props=b,this.context=O,this.refs=w,this.updater=W||v}T.prototype.isReactComponent={},T.prototype.setState=function(b,O){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,O,"setState")},T.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function E(){}E.prototype=T.prototype;function C(b,O,W){this.props=b,this.context=O,this.refs=w,this.updater=W||v}var P=C.prototype=new E;P.constructor=C,x(P,T.prototype),P.isPureReactComponent=!0;var L=Array.isArray,I=Object.prototype.hasOwnProperty,F={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function q(b,O,W){var K,ee={},te=null,ce=null;if(O!=null)for(K in O.ref!==void 0&&(ce=O.ref),O.key!==void 0&&(te=""+O.key),O)I.call(O,K)&&!j.hasOwnProperty(K)&&(ee[K]=O[K]);var me=arguments.length-2;if(me===1)ee.children=W;else if(1<me){for(var xe=Array(me),Pe=0;Pe<me;Pe++)xe[Pe]=arguments[Pe+2];ee.children=xe}if(b&&b.defaultProps)for(K in me=b.defaultProps,me)ee[K]===void 0&&(ee[K]=me[K]);return{$$typeof:n,type:b,key:te,ref:ce,props:ee,_owner:F.current}}function Q(b,O){return{$$typeof:n,type:b.type,key:O,ref:b.ref,props:b.props,_owner:b._owner}}function le(b){return typeof b=="object"&&b!==null&&b.$$typeof===n}function he(b){var O={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(W){return O[W]})}var pe=/\/+/g;function ne(b,O){return typeof b=="object"&&b!==null&&b.key!=null?he(""+b.key):O.toString(36)}function ve(b,O,W,K,ee){var te=typeof b;(te==="undefined"||te==="boolean")&&(b=null);var ce=!1;if(b===null)ce=!0;else switch(te){case"string":case"number":ce=!0;break;case"object":switch(b.$$typeof){case n:case e:ce=!0}}if(ce)return ce=b,ee=ee(ce),b=K===""?"."+ne(ce,0):K,L(ee)?(W="",b!=null&&(W=b.replace(pe,"$&/")+"/"),ve(ee,O,W,"",function(Pe){return Pe})):ee!=null&&(le(ee)&&(ee=Q(ee,W+(!ee.key||ce&&ce.key===ee.key?"":(""+ee.key).replace(pe,"$&/")+"/")+b)),O.push(ee)),1;if(ce=0,K=K===""?".":K+":",L(b))for(var me=0;me<b.length;me++){te=b[me];var xe=K+ne(te,me);ce+=ve(te,O,W,xe,ee)}else if(xe=m(b),typeof xe=="function")for(b=xe.call(b),me=0;!(te=b.next()).done;)te=te.value,xe=K+ne(te,me++),ce+=ve(te,O,W,xe,ee);else if(te==="object")throw O=String(b),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.");return ce}function Me(b,O,W){if(b==null)return b;var K=[],ee=0;return ve(b,K,"","",function(te){return O.call(W,te,ee++)}),K}function U(b){if(b._status===-1){var O=b._result;O=O(),O.then(function(W){(b._status===0||b._status===-1)&&(b._status=1,b._result=W)},function(W){(b._status===0||b._status===-1)&&(b._status=2,b._result=W)}),b._status===-1&&(b._status=0,b._result=O)}if(b._status===1)return b._result.default;throw b._result}var H={current:null},N={transition:null},Y={ReactCurrentDispatcher:H,ReactCurrentBatchConfig:N,ReactCurrentOwner:F};function k(){throw Error("act(...) is not supported in production builds of React.")}return ct.Children={map:Me,forEach:function(b,O,W){Me(b,function(){O.apply(this,arguments)},W)},count:function(b){var O=0;return Me(b,function(){O++}),O},toArray:function(b){return Me(b,function(O){return O})||[]},only:function(b){if(!le(b))throw Error("React.Children.only expected to receive a single React element child.");return b}},ct.Component=T,ct.Fragment=t,ct.Profiler=s,ct.PureComponent=C,ct.StrictMode=r,ct.Suspense=u,ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y,ct.act=k,ct.cloneElement=function(b,O,W){if(b==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+b+".");var K=x({},b.props),ee=b.key,te=b.ref,ce=b._owner;if(O!=null){if(O.ref!==void 0&&(te=O.ref,ce=F.current),O.key!==void 0&&(ee=""+O.key),b.type&&b.type.defaultProps)var me=b.type.defaultProps;for(xe in O)I.call(O,xe)&&!j.hasOwnProperty(xe)&&(K[xe]=O[xe]===void 0&&me!==void 0?me[xe]:O[xe])}var xe=arguments.length-2;if(xe===1)K.children=W;else if(1<xe){me=Array(xe);for(var Pe=0;Pe<xe;Pe++)me[Pe]=arguments[Pe+2];K.children=me}return{$$typeof:n,type:b.type,key:ee,ref:te,props:K,_owner:ce}},ct.createContext=function(b){return b={$$typeof:o,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},b.Provider={$$typeof:i,_context:b},b.Consumer=b},ct.createElement=q,ct.createFactory=function(b){var O=q.bind(null,b);return O.type=b,O},ct.createRef=function(){return{current:null}},ct.forwardRef=function(b){return{$$typeof:a,render:b}},ct.isValidElement=le,ct.lazy=function(b){return{$$typeof:h,_payload:{_status:-1,_result:b},_init:U}},ct.memo=function(b,O){return{$$typeof:f,type:b,compare:O===void 0?null:O}},ct.startTransition=function(b){var O=N.transition;N.transition={};try{b()}finally{N.transition=O}},ct.unstable_act=k,ct.useCallback=function(b,O){return H.current.useCallback(b,O)},ct.useContext=function(b){return H.current.useContext(b)},ct.useDebugValue=function(){},ct.useDeferredValue=function(b){return H.current.useDeferredValue(b)},ct.useEffect=function(b,O){return H.current.useEffect(b,O)},ct.useId=function(){return H.current.useId()},ct.useImperativeHandle=function(b,O,W){return H.current.useImperativeHandle(b,O,W)},ct.useInsertionEffect=function(b,O){return H.current.useInsertionEffect(b,O)},ct.useLayoutEffect=function(b,O){return H.current.useLayoutEffect(b,O)},ct.useMemo=function(b,O){return H.current.useMemo(b,O)},ct.useReducer=function(b,O,W){return H.current.useReducer(b,O,W)},ct.useRef=function(b){return H.current.useRef(b)},ct.useState=function(b){return H.current.useState(b)},ct.useSyncExternalStore=function(b,O,W){return H.current.useSyncExternalStore(b,O,W)},ct.useTransition=function(){return H.current.useTransition()},ct.version="18.3.1",ct}var r3;function sy(){return r3||(r3=1,Hm.exports=BP()),Hm.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s3;function UP(){if(s3)return jc;s3=1;var n=sy(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,u,f){var h,p={},m=null,v=null;f!==void 0&&(m=""+f),u.key!==void 0&&(m=""+u.key),u.ref!==void 0&&(v=u.ref);for(h in u)r.call(u,h)&&!i.hasOwnProperty(h)&&(p[h]=u[h]);if(a&&a.defaultProps)for(h in u=a.defaultProps,u)p[h]===void 0&&(p[h]=u[h]);return{$$typeof:e,type:a,key:m,ref:v,props:p,_owner:s.current}}return jc.Fragment=t,jc.jsx=o,jc.jsxs=o,jc}var i3;function VP(){return i3||(i3=1,Wm.exports=UP()),Wm.exports}var oe=VP(),bd={black:"#000",white:"#fff"},Xm={300:"#e57373",500:"#f44336",700:"#d32f2f"},Ym={A200:"#ff4081",A400:"#f50057",A700:"#c51162"},qm={300:"#7986cb",500:"#3f51b5",700:"#303f9f"},Km={300:"#64b5f6",500:"#2196f3",700:"#1976d2"},Zm={300:"#81c784",500:"#4caf50",700:"#388e3c"},Qm={300:"#ffb74d",500:"#ff9800",700:"#f57c00"},iy={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"};function Ee(){return Ee=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ee.apply(null,arguments)}function jl(n){"@babel/helpers - typeof";return jl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jl(n)}function Gm(n){return n&&jl(n)==="object"&&n.constructor===Object}function Wl(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{clone:!0},r=t.clone?Ee({},n):n;return Gm(n)&&Gm(e)&&Object.keys(e).forEach(function(s){s!=="__proto__"&&(Gm(e[s])&&s in n?r[s]=Wl(n[s],e[s],t):r[s]=e[s])}),r}function zP(n,e){if(jl(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(jl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function xS(n){var e=zP(n,"string");return jl(e)=="symbol"?e:e+""}function Jm(n,e,t){return(e=xS(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Pu(n){for(var e="https://mui.com/production-error/?code="+n,t=1;t<arguments.length;t+=1)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified Material-UI error #"+n+"; visit "+e+" for the full message."}var e0={exports:{}},kt={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o3;function $P(){if(o3)return kt;o3=1;var n=60103,e=60106,t=60107,r=60108,s=60114,i=60109,o=60110,a=60112,u=60113,f=60120,h=60115,p=60116,m=60121,v=60122,x=60117,w=60129,T=60131;if(typeof Symbol=="function"&&Symbol.for){var E=Symbol.for;n=E("react.element"),e=E("react.portal"),t=E("react.fragment"),r=E("react.strict_mode"),s=E("react.profiler"),i=E("react.provider"),o=E("react.context"),a=E("react.forward_ref"),u=E("react.suspense"),f=E("react.suspense_list"),h=E("react.memo"),p=E("react.lazy"),m=E("react.block"),v=E("react.server.block"),x=E("react.fundamental"),w=E("react.debug_trace_mode"),T=E("react.legacy_hidden")}function C(ne){if(typeof ne=="object"&&ne!==null){var ve=ne.$$typeof;switch(ve){case n:switch(ne=ne.type,ne){case t:case s:case r:case u:case f:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case o:case a:case p:case h:case i:return ne;default:return ve}}case e:return ve}}}var P=i,L=n,I=a,F=t,j=p,q=h,Q=e,le=s,he=r,pe=u;return kt.ContextConsumer=o,kt.ContextProvider=P,kt.Element=L,kt.ForwardRef=I,kt.Fragment=F,kt.Lazy=j,kt.Memo=q,kt.Portal=Q,kt.Profiler=le,kt.StrictMode=he,kt.Suspense=pe,kt.isAsyncMode=function(){return!1},kt.isConcurrentMode=function(){return!1},kt.isContextConsumer=function(ne){return C(ne)===o},kt.isContextProvider=function(ne){return C(ne)===i},kt.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===n},kt.isForwardRef=function(ne){return C(ne)===a},kt.isFragment=function(ne){return C(ne)===t},kt.isLazy=function(ne){return C(ne)===p},kt.isMemo=function(ne){return C(ne)===h},kt.isPortal=function(ne){return C(ne)===e},kt.isProfiler=function(ne){return C(ne)===s},kt.isStrictMode=function(ne){return C(ne)===r},kt.isSuspense=function(ne){return C(ne)===u},kt.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===t||ne===s||ne===w||ne===r||ne===u||ne===f||ne===T||typeof ne=="object"&&ne!==null&&(ne.$$typeof===p||ne.$$typeof===h||ne.$$typeof===i||ne.$$typeof===o||ne.$$typeof===a||ne.$$typeof===x||ne.$$typeof===m||ne[0]===v)},kt.typeOf=C,kt}var a3;function jP(){return a3||(a3=1,e0.exports=$P()),e0.exports}jP();function oy(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(e,n),t)}function WP(n){n=n.substr(1);var e=new RegExp(".{1,".concat(n.length>=6?2:1,"}"),"g"),t=n.match(e);return t&&t[0].length===1&&(t=t.map(function(r){return r+r})),t?"rgb".concat(t.length===4?"a":"","(").concat(t.map(function(r,s){return s<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3}).join(", "),")"):""}function HP(n){n=ha(n);var e=n,t=e.values,r=t[0],s=t[1]/100,i=t[2]/100,o=s*Math.min(i,1-i),a=function(p){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(p+r/30)%12;return i-o*Math.max(Math.min(m-3,9-m,1),-1)},u="rgb",f=[Math.round(a(0)*255),Math.round(a(8)*255),Math.round(a(4)*255)];return n.type==="hsla"&&(u+="a",f.push(t[3])),Lp({type:u,values:f})}function ha(n){if(n.type)return n;if(n.charAt(0)==="#")return ha(WP(n));var e=n.indexOf("("),t=n.substring(0,e);if(["rgb","rgba","hsl","hsla"].indexOf(t)===-1)throw new Error(Pu(3,n));var r=n.substring(e+1,n.length-1).split(",");return r=r.map(function(s){return parseFloat(s)}),{type:t,values:r}}function Lp(n){var e=n.type,t=n.values;return e.indexOf("rgb")!==-1?t=t.map(function(r,s){return s<3?parseInt(r,10):r}):e.indexOf("hsl")!==-1&&(t[1]="".concat(t[1],"%"),t[2]="".concat(t[2],"%")),"".concat(e,"(").concat(t.join(", "),")")}function XP(n,e){var t=l3(n),r=l3(e);return(Math.max(t,r)+.05)/(Math.min(t,r)+.05)}function l3(n){n=ha(n);var e=n.type==="hsl"?ha(HP(n)).values:n.values;return e=e.map(function(t){return t/=255,t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function ro(n,e){return n=ha(n),e=oy(e),(n.type==="rgb"||n.type==="hsl")&&(n.type+="a"),n.values[3]=e,Lp(n)}function wS(n,e){if(n=ha(n),e=oy(e),n.type.indexOf("hsl")!==-1)n.values[2]*=1-e;else if(n.type.indexOf("rgb")!==-1)for(var t=0;t<3;t+=1)n.values[t]*=1-e;return Lp(n)}function bS(n,e){if(n=ha(n),e=oy(e),n.type.indexOf("hsl")!==-1)n.values[2]+=(100-n.values[2])*e;else if(n.type.indexOf("rgb")!==-1)for(var t=0;t<3;t+=1)n.values[t]+=(255-n.values[t])*e;return Lp(n)}function Fp(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function Et(n,e){if(n==null)return{};var t,r,s=Fp(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(s[t]=n[t])}return s}var $i=["xs","sm","md","lg","xl"];function YP(n){var e=n.values,t=e===void 0?{xs:0,sm:600,md:960,lg:1280,xl:1920}:e,r=n.unit,s=r===void 0?"px":r,i=n.step,o=i===void 0?5:i,a=Et(n,["values","unit","step"]);function u(v){var x=typeof t[v]=="number"?t[v]:v;return"@media (min-width:".concat(x).concat(s,")")}function f(v){var x=$i.indexOf(v)+1,w=t[$i[x]];if(x===$i.length)return u("xs");var T=typeof w=="number"&&x>0?w:v;return"@media (max-width:".concat(T-o/100).concat(s,")")}function h(v,x){var w=$i.indexOf(x);return w===$i.length-1?u(v):"@media (min-width:".concat(typeof t[v]=="number"?t[v]:v).concat(s,") and ")+"(max-width:".concat((w!==-1&&typeof t[$i[w+1]]=="number"?t[$i[w+1]]:x)-o/100).concat(s,")")}function p(v){return h(v,v)}function m(v){return t[v]}return Ee({keys:$i,values:t,up:u,down:f,between:h,only:p,width:m},a)}function qP(n,e,t){var r;return Ee({gutters:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return console.warn(["Material-UI: theme.mixins.gutters() is deprecated.","You can use the source of the mixin directly:",`
      paddingLeft: theme.spacing(2),
      paddingRight: theme.spacing(2),
      [theme.breakpoints.up('sm')]: {
        paddingLeft: theme.spacing(3),
        paddingRight: theme.spacing(3),
      },
      `].join(`
`)),Ee({paddingLeft:e(2),paddingRight:e(2)},i,Jm({},n.up("sm"),Ee({paddingLeft:e(3),paddingRight:e(3)},i[n.up("sm")])))},toolbar:(r={minHeight:56},Jm(r,"".concat(n.up("xs")," and (orientation: landscape)"),{minHeight:48}),Jm(r,n.up("sm"),{minHeight:64}),r)},t)}var c3={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:bd.white,default:iy[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},t0={text:{primary:bd.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:iy[800],default:"#303030"},action:{active:bd.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function u3(n,e,t,r){var s=r.light||r,i=r.dark||r*1.5;n[e]||(n.hasOwnProperty(t)?n[e]=n[t]:e==="light"?n.light=bS(n.main,s):e==="dark"&&(n.dark=wS(n.main,i)))}function KP(n){var e=n.primary,t=e===void 0?{light:qm[300],main:qm[500],dark:qm[700]}:e,r=n.secondary,s=r===void 0?{light:Ym.A200,main:Ym.A400,dark:Ym.A700}:r,i=n.error,o=i===void 0?{light:Xm[300],main:Xm[500],dark:Xm[700]}:i,a=n.warning,u=a===void 0?{light:Qm[300],main:Qm[500],dark:Qm[700]}:a,f=n.info,h=f===void 0?{light:Km[300],main:Km[500],dark:Km[700]}:f,p=n.success,m=p===void 0?{light:Zm[300],main:Zm[500],dark:Zm[700]}:p,v=n.type,x=v===void 0?"light":v,w=n.contrastThreshold,T=w===void 0?3:w,E=n.tonalOffset,C=E===void 0?.2:E,P=Et(n,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function L(q){var Q=XP(q,t0.text.primary)>=T?t0.text.primary:c3.text.primary;return Q}var I=function(Q){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500,he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,pe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:700;if(Q=Ee({},Q),!Q.main&&Q[le]&&(Q.main=Q[le]),!Q.main)throw new Error(Pu(4,le));if(typeof Q.main!="string")throw new Error(Pu(5,JSON.stringify(Q.main)));return u3(Q,"light",he,C),u3(Q,"dark",pe,C),Q.contrastText||(Q.contrastText=L(Q.main)),Q},F={dark:t0,light:c3},j=Wl(Ee({common:bd,type:x,primary:I(t),secondary:I(s,"A400","A200","A700"),error:I(o),warning:I(u),info:I(h),success:I(m),grey:iy,contrastThreshold:T,getContrastText:L,augmentColor:I,tonalOffset:C},F[x]),P);return j}function TS(n){return Math.round(n*1e5)/1e5}function ZP(n){return TS(n)}var f3={textTransform:"uppercase"},h3='"Roboto", "Helvetica", "Arial", sans-serif';function QP(n,e){var t=typeof e=="function"?e(n):e,r=t.fontFamily,s=r===void 0?h3:r,i=t.fontSize,o=i===void 0?14:i,a=t.fontWeightLight,u=a===void 0?300:a,f=t.fontWeightRegular,h=f===void 0?400:f,p=t.fontWeightMedium,m=p===void 0?500:p,v=t.fontWeightBold,x=v===void 0?700:v,w=t.htmlFontSize,T=w===void 0?16:w,E=t.allVariants,C=t.pxToRem,P=Et(t,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]),L=o/14,I=C||function(q){return"".concat(q/T*L,"rem")},F=function(Q,le,he,pe,ne){return Ee({fontFamily:s,fontWeight:Q,fontSize:I(le),lineHeight:he},s===h3?{letterSpacing:"".concat(TS(pe/le),"em")}:{},ne,E)},j={h1:F(u,96,1.167,-1.5),h2:F(u,60,1.2,-.5),h3:F(h,48,1.167,0),h4:F(h,34,1.235,.25),h5:F(h,24,1.334,0),h6:F(m,20,1.6,.15),subtitle1:F(h,16,1.75,.15),subtitle2:F(m,14,1.57,.1),body1:F(h,16,1.5,.15),body2:F(h,14,1.43,.15),button:F(m,14,1.75,.4,f3),caption:F(h,12,1.66,.4),overline:F(h,12,2.66,1,f3)};return Wl(Ee({htmlFontSize:T,pxToRem:I,round:ZP,fontFamily:s,fontSize:o,fontWeightLight:u,fontWeightRegular:h,fontWeightMedium:m,fontWeightBold:x},j),P,{clone:!1})}var GP=.2,JP=.14,eI=.12;function Qt(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(GP,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(JP,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(eI,")")].join(",")}var tI=["none",Qt(0,2,1,-1,0,1,1,0,0,1,3,0),Qt(0,3,1,-2,0,2,2,0,0,1,5,0),Qt(0,3,3,-2,0,3,4,0,0,1,8,0),Qt(0,2,4,-1,0,4,5,0,0,1,10,0),Qt(0,3,5,-1,0,5,8,0,0,1,14,0),Qt(0,3,5,-1,0,6,10,0,0,1,18,0),Qt(0,4,5,-2,0,7,10,1,0,2,16,1),Qt(0,5,5,-3,0,8,10,1,0,3,14,2),Qt(0,5,6,-3,0,9,12,1,0,3,16,2),Qt(0,6,6,-3,0,10,14,1,0,4,18,3),Qt(0,6,7,-4,0,11,15,1,0,4,20,3),Qt(0,7,8,-4,0,12,17,2,0,5,22,4),Qt(0,7,8,-4,0,13,19,2,0,5,24,4),Qt(0,7,9,-4,0,14,21,2,0,5,26,4),Qt(0,8,9,-5,0,15,22,2,0,6,28,5),Qt(0,8,10,-5,0,16,24,2,0,6,30,5),Qt(0,8,11,-5,0,17,26,2,0,6,32,5),Qt(0,9,11,-5,0,18,28,2,0,7,34,6),Qt(0,9,12,-6,0,19,29,2,0,7,36,6),Qt(0,10,13,-6,0,20,31,3,0,8,38,7),Qt(0,10,13,-6,0,21,33,3,0,8,40,7),Qt(0,10,14,-6,0,22,35,3,0,8,42,7),Qt(0,11,14,-7,0,23,36,3,0,9,44,8),Qt(0,11,15,-7,0,24,38,3,0,9,46,8)],nI={borderRadius:4};function pv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function rI(n){if(Array.isArray(n))return pv(n)}function SS(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ay(n,e){if(n){if(typeof n=="string")return pv(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?pv(n,e):void 0}}function sI(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bp(n){return rI(n)||SS(n)||ay(n)||sI()}function ES(n){if(Array.isArray(n))return n}function iI(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],u=!0,f=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(u=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(h){f=!0,s=h}finally{try{if(!u&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw s}}return a}}function AS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Up(n,e){return ES(n)||iI(n,e)||ay(n,e)||AS()}function oI(n){var e=n.spacing||8;return typeof e=="number"?function(t){return e*t}:Array.isArray(e)?function(t){return e[t]}:typeof e=="function"?e:function(){}}function aI(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:8;if(n.mui)return n;var e=oI({spacing:n}),t=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return i.length===0?e(1):i.length===1?e(i[0]):i.map(function(a){if(typeof a=="string")return a;var u=e(a);return typeof u=="number"?"".concat(u,"px"):u}).join(" ")};return Object.defineProperty(t,"unit",{get:function(){return n}}),t.mui=!0,t}var d3={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},gv={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function p3(n){return"".concat(Math.round(n),"ms")}const lI={easing:d3,duration:gv,create:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["all"],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.duration,s=r===void 0?gv.standard:r,i=t.easing,o=i===void 0?d3.easeInOut:i,a=t.delay,u=a===void 0?0:a;return Et(t,["duration","easing","delay"]),(Array.isArray(e)?e:[e]).map(function(f){return"".concat(f," ").concat(typeof s=="string"?s:p3(s)," ").concat(o," ").concat(typeof u=="string"?u:p3(u))}).join(",")},getAutoHeightDuration:function(e){if(!e)return 0;var t=e/36;return Math.round((4+15*Math.pow(t,.25)+t/5)*10)}};var RS={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function CS(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=n.breakpoints,t=e===void 0?{}:e,r=n.mixins,s=r===void 0?{}:r,i=n.palette,o=i===void 0?{}:i,a=n.spacing,u=n.typography,f=u===void 0?{}:u,h=Et(n,["breakpoints","mixins","palette","spacing","typography"]),p=KP(o),m=YP(t),v=aI(a),x=Wl({breakpoints:m,direction:"ltr",mixins:qP(m,v,s),overrides:{},palette:p,props:{},shadows:tI,typography:QP(p,f),spacing:v,shape:nI,transitions:lI,zIndex:RS},h),w=arguments.length,T=new Array(w>1?w-1:0),E=1;E<w;E++)T[E-1]=arguments[E];return x=T.reduce(function(C,P){return Wl(C,P)},x),x}var cI=typeof Symbol=="function"&&Symbol.for;const PS=cI?Symbol.for("mui.nested"):"__THEME_NESTED__";var uI=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];function fI(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=n.disableGlobal,t=e===void 0?!1:e,r=n.productionPrefix,s=r===void 0?"jss":r,i=n.seed,o=i===void 0?"":i,a=o===""?"":"".concat(o,"-"),u=0,f=function(){return u+=1,u};return function(h,p){var m=p.options.name;if(m&&m.indexOf("Mui")===0&&!p.options.link&&!t){if(uI.indexOf(h.key)!==-1)return"Mui-".concat(h.key);var v="".concat(a).concat(m,"-").concat(h.key);return!p.options.theme[PS]||o!==""?v:"".concat(v,"-").concat(f())}return"".concat(a).concat(s).concat(f())}}function IS(n){var e=n.theme,t=n.name,r=n.props;if(!e||!e.props||!e.props[t])return r;var s=e.props[t],i;for(i in s)r[i]===void 0&&(r[i]=s[i]);return r}var g3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rf=(typeof window>"u"?"undefined":g3(window))==="object"&&(typeof document>"u"?"undefined":g3(document))==="object"&&document.nodeType===9;function hI(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,xS(r.key),r)}}function ly(n,e,t){return e&&hI(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function mv(n,e){return mv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},mv(n,e)}function Vp(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,mv(n,e)}function vv(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var dI={}.constructor;function _v(n){if(n==null||typeof n!="object")return n;if(Array.isArray(n))return n.map(_v);if(n.constructor!==dI)return n;var e={};for(var t in n)e[t]=_v(n[t]);return e}function cy(n,e,t){n===void 0&&(n="unnamed");var r=t.jss,s=_v(e),i=r.plugins.onCreateRule(n,s,t);return i||(n[0],null)}var m3=function(e,t){for(var r="",s=0;s<e.length&&e[s]!=="!important";s++)r&&(r+=t),r+=e[s];return r},sa=function(e){if(!Array.isArray(e))return e;var t="";if(Array.isArray(e[0]))for(var r=0;r<e.length&&e[r]!=="!important";r++)t&&(t+=", "),t+=m3(e[r]," ");else t=m3(e,", ");return e[e.length-1]==="!important"&&(t+=" !important"),t};function rc(n){return n&&n.format===!1?{linebreak:"",space:""}:{linebreak:`
`,space:" "}}function Wc(n,e){for(var t="",r=0;r<e;r++)t+="  ";return t+n}function Iu(n,e,t){t===void 0&&(t={});var r="";if(!e)return r;var s=t,i=s.indent,o=i===void 0?0:i,a=e.fallbacks;t.format===!1&&(o=-1/0);var u=rc(t),f=u.linebreak,h=u.space;if(n&&o++,a)if(Array.isArray(a))for(var p=0;p<a.length;p++){var m=a[p];for(var v in m){var x=m[v];x!=null&&(r&&(r+=f),r+=Wc(v+":"+h+sa(x)+";",o))}}else for(var w in a){var T=a[w];T!=null&&(r&&(r+=f),r+=Wc(w+":"+h+sa(T)+";",o))}for(var E in e){var C=e[E];C!=null&&E!=="fallbacks"&&(r&&(r+=f),r+=Wc(E+":"+h+sa(C)+";",o))}return!r&&!t.allowEmpty||!n?r:(o--,r&&(r=""+f+r+f),Wc(""+n+h+"{"+r,o)+Wc("}",o))}var pI=/([[\].#*$><+~=|^:(),"'`\s])/g,v3=typeof CSS<"u"&&CSS.escape,uy=function(n){return v3?v3(n):n.replace(pI,"\\$1")},MS=function(){function n(t,r,s){this.type="style",this.isProcessed=!1;var i=s.sheet,o=s.Renderer;this.key=t,this.options=s,this.style=r,i?this.renderer=i.renderer:o&&(this.renderer=new o)}var e=n.prototype;return e.prop=function(r,s,i){if(s===void 0)return this.style[r];var o=i?i.force:!1;if(!o&&this.style[r]===s)return this;var a=s;(!i||i.process!==!1)&&(a=this.options.jss.plugins.onChangeValue(s,r,this));var u=a==null||a===!1,f=r in this.style;if(u&&!f&&!o)return this;var h=u&&f;if(h?delete this.style[r]:this.style[r]=a,this.renderable&&this.renderer)return h?this.renderer.removeProperty(this.renderable,r):this.renderer.setProperty(this.renderable,r,a),this;var p=this.options.sheet;return p&&p.attached,this},n}(),yv=function(n){Vp(e,n);function e(r,s,i){var o;o=n.call(this,r,s,i)||this;var a=i.selector,u=i.scoped,f=i.sheet,h=i.generateId;return a?o.selectorText=a:u!==!1&&(o.id=h(vv(vv(o)),f),o.selectorText="."+uy(o.id)),o}var t=e.prototype;return t.applyTo=function(s){var i=this.renderer;if(i){var o=this.toJSON();for(var a in o)i.setProperty(s,a,o[a])}return this},t.toJSON=function(){var s={};for(var i in this.style){var o=this.style[i];typeof o!="object"?s[i]=o:Array.isArray(o)&&(s[i]=sa(o))}return s},t.toString=function(s){var i=this.options.sheet,o=i?i.options.link:!1,a=o?Ee({},s,{allowEmpty:!0}):s;return Iu(this.selectorText,this.style,a)},ly(e,[{key:"selector",set:function(s){if(s!==this.selectorText){this.selectorText=s;var i=this.renderer,o=this.renderable;if(!(!o||!i)){var a=i.setSelector(o,s);a||i.replaceRule(o,this)}}},get:function(){return this.selectorText}}]),e}(MS),gI={onCreateRule:function(e,t,r){return e[0]==="@"||r.parent&&r.parent.type==="keyframes"?null:new yv(e,t,r)}},n0={indent:1,children:!0},mI=/@([\w-]+)/,vI=function(){function n(t,r,s){this.type="conditional",this.isProcessed=!1,this.key=t;var i=t.match(mI);this.at=i?i[1]:"unknown",this.query=s.name||"@"+this.at,this.options=s,this.rules=new zp(Ee({},s,{parent:this}));for(var o in r)this.rules.add(o,r[o]);this.rules.process()}var e=n.prototype;return e.getRule=function(r){return this.rules.get(r)},e.indexOf=function(r){return this.rules.indexOf(r)},e.addRule=function(r,s,i){var o=this.rules.add(r,s,i);return o?(this.options.jss.plugins.onProcessRule(o),o):null},e.replaceRule=function(r,s,i){var o=this.rules.replace(r,s,i);return o&&this.options.jss.plugins.onProcessRule(o),o},e.toString=function(r){r===void 0&&(r=n0);var s=rc(r),i=s.linebreak;if(r.indent==null&&(r.indent=n0.indent),r.children==null&&(r.children=n0.children),r.children===!1)return this.query+" {}";var o=this.rules.toString(r);return o?this.query+" {"+i+o+i+"}":""},n}(),_I=/@container|@media|@supports\s+/,yI={onCreateRule:function(e,t,r){return _I.test(e)?new vI(e,t,r):null}},r0={indent:1,children:!0},xI=/@keyframes\s+([\w-]+)/,xv=function(){function n(t,r,s){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var i=t.match(xI);i&&i[1]?this.name=i[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=s;var o=s.scoped,a=s.sheet,u=s.generateId;this.id=o===!1?this.name:uy(u(this,a)),this.rules=new zp(Ee({},s,{parent:this}));for(var f in r)this.rules.add(f,r[f],Ee({},s,{parent:this}));this.rules.process()}var e=n.prototype;return e.toString=function(r){r===void 0&&(r=r0);var s=rc(r),i=s.linebreak;if(r.indent==null&&(r.indent=r0.indent),r.children==null&&(r.children=r0.children),r.children===!1)return this.at+" "+this.id+" {}";var o=this.rules.toString(r);return o&&(o=""+i+o+i),this.at+" "+this.id+" {"+o+"}"},n}(),wI=/@keyframes\s+/,bI=/\$([\w-]+)/g,wv=function(e,t){return typeof e=="string"?e.replace(bI,function(r,s){return s in t?t[s]:r}):e},_3=function(e,t,r){var s=e[t],i=wv(s,r);i!==s&&(e[t]=i)},TI={onCreateRule:function(e,t,r){return typeof e=="string"&&wI.test(e)?new xv(e,t,r):null},onProcessStyle:function(e,t,r){return t.type!=="style"||!r||("animation-name"in e&&_3(e,"animation-name",r.keyframes),"animation"in e&&_3(e,"animation",r.keyframes)),e},onChangeValue:function(e,t,r){var s=r.options.sheet;if(!s)return e;switch(t){case"animation":return wv(e,s.keyframes);case"animation-name":return wv(e,s.keyframes);default:return e}}},SI=function(n){Vp(e,n);function e(){return n.apply(this,arguments)||this}var t=e.prototype;return t.toString=function(s){var i=this.options.sheet,o=i?i.options.link:!1,a=o?Ee({},s,{allowEmpty:!0}):s;return Iu(this.key,this.style,a)},e}(MS),EI={onCreateRule:function(e,t,r){return r.parent&&r.parent.type==="keyframes"?new SI(e,t,r):null}},AI=function(){function n(t,r,s){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=t,this.style=r,this.options=s}var e=n.prototype;return e.toString=function(r){var s=rc(r),i=s.linebreak;if(Array.isArray(this.style)){for(var o="",a=0;a<this.style.length;a++)o+=Iu(this.at,this.style[a]),this.style[a+1]&&(o+=i);return o}return Iu(this.at,this.style,r)},n}(),RI=/@font-face/,CI={onCreateRule:function(e,t,r){return RI.test(e)?new AI(e,t,r):null}},PI=function(){function n(t,r,s){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=t,this.style=r,this.options=s}var e=n.prototype;return e.toString=function(r){return Iu(this.key,this.style,r)},n}(),II={onCreateRule:function(e,t,r){return e==="@viewport"||e==="@-ms-viewport"?new PI(e,t,r):null}},MI=function(){function n(t,r,s){this.type="simple",this.isProcessed=!1,this.key=t,this.value=r,this.options=s}var e=n.prototype;return e.toString=function(r){if(Array.isArray(this.value)){for(var s="",i=0;i<this.value.length;i++)s+=this.key+" "+this.value[i]+";",this.value[i+1]&&(s+=`
`);return s}return this.key+" "+this.value+";"},n}(),kI={"@charset":!0,"@import":!0,"@namespace":!0},OI={onCreateRule:function(e,t,r){return e in kI?new MI(e,t,r):null}},y3=[gI,yI,TI,EI,CI,II,OI],NI={process:!0},x3={force:!0,process:!0},zp=function(){function n(t){this.map={},this.raw={},this.index=[],this.counter=0,this.options=t,this.classes=t.classes,this.keyframes=t.keyframes}var e=n.prototype;return e.add=function(r,s,i){var o=this.options,a=o.parent,u=o.sheet,f=o.jss,h=o.Renderer,p=o.generateId,m=o.scoped,v=Ee({classes:this.classes,parent:a,sheet:u,jss:f,Renderer:h,generateId:p,scoped:m,name:r,keyframes:this.keyframes,selector:void 0},i),x=r;r in this.raw&&(x=r+"-d"+this.counter++),this.raw[x]=s,x in this.classes&&(v.selector="."+uy(this.classes[x]));var w=cy(x,s,v);if(!w)return null;this.register(w);var T=v.index===void 0?this.index.length:v.index;return this.index.splice(T,0,w),w},e.replace=function(r,s,i){var o=this.get(r),a=this.index.indexOf(o);o&&this.remove(o);var u=i;return a!==-1&&(u=Ee({},i,{index:a})),this.add(r,s,u)},e.get=function(r){return this.map[r]},e.remove=function(r){this.unregister(r),delete this.raw[r.key],this.index.splice(this.index.indexOf(r),1)},e.indexOf=function(r){return this.index.indexOf(r)},e.process=function(){var r=this.options.jss.plugins;this.index.slice(0).forEach(r.onProcessRule,r)},e.register=function(r){this.map[r.key]=r,r instanceof yv?(this.map[r.selector]=r,r.id&&(this.classes[r.key]=r.id)):r instanceof xv&&this.keyframes&&(this.keyframes[r.name]=r.id)},e.unregister=function(r){delete this.map[r.key],r instanceof yv?(delete this.map[r.selector],delete this.classes[r.key]):r instanceof xv&&delete this.keyframes[r.name]},e.update=function(){var r,s,i;if(typeof(arguments.length<=0?void 0:arguments[0])=="string"?(r=arguments.length<=0?void 0:arguments[0],s=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2]):(s=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],r=null),r)this.updateOne(this.get(r),s,i);else for(var o=0;o<this.index.length;o++)this.updateOne(this.index[o],s,i)},e.updateOne=function(r,s,i){i===void 0&&(i=NI);var o=this.options,a=o.jss.plugins,u=o.sheet;if(r.rules instanceof n){r.rules.update(s,i);return}var f=r.style;if(a.onUpdate(s,r,u,i),i.process&&f&&f!==r.style){a.onProcessStyle(r.style,r,u);for(var h in r.style){var p=r.style[h],m=f[h];p!==m&&r.prop(h,p,x3)}for(var v in f){var x=r.style[v],w=f[v];x==null&&x!==w&&r.prop(v,null,x3)}}},e.toString=function(r){for(var s="",i=this.options.sheet,o=i?i.options.link:!1,a=rc(r),u=a.linebreak,f=0;f<this.index.length;f++){var h=this.index[f],p=h.toString(r);!p&&!o||(s&&(s+=u),s+=p)}return s},n}(),kS=function(){function n(t,r){this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=Ee({},r,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),r.Renderer&&(this.renderer=new r.Renderer(this)),this.rules=new zp(this.options);for(var s in t)this.rules.add(s,t[s]);this.rules.process()}var e=n.prototype;return e.attach=function(){return this.attached?this:(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy(),this)},e.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},e.addRule=function(r,s,i){var o=this.queue;this.attached&&!o&&(this.queue=[]);var a=this.rules.add(r,s,i);return a?(this.options.jss.plugins.onProcessRule(a),this.attached?(this.deployed&&(o?o.push(a):(this.insertRule(a),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0))),a):(this.deployed=!1,a)):null},e.replaceRule=function(r,s,i){var o=this.rules.get(r);if(!o)return this.addRule(r,s,i);var a=this.rules.replace(r,s,i);return a&&this.options.jss.plugins.onProcessRule(a),this.attached?(this.deployed&&this.renderer&&(a?o.renderable&&this.renderer.replaceRule(o.renderable,a):this.renderer.deleteRule(o)),a):(this.deployed=!1,a)},e.insertRule=function(r){this.renderer&&this.renderer.insertRule(r)},e.addRules=function(r,s){var i=[];for(var o in r){var a=this.addRule(o,r[o],s);a&&i.push(a)}return i},e.getRule=function(r){return this.rules.get(r)},e.deleteRule=function(r){var s=typeof r=="object"?r:this.rules.get(r);return!s||this.attached&&!s.renderable?!1:(this.rules.remove(s),this.attached&&s.renderable&&this.renderer?this.renderer.deleteRule(s.renderable):!0)},e.indexOf=function(r){return this.rules.indexOf(r)},e.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},e.update=function(){var r;return(r=this.rules).update.apply(r,arguments),this},e.updateOne=function(r,s,i){return this.rules.updateOne(r,s,i),this},e.toString=function(r){return this.rules.toString(r)},n}(),DI=function(){function n(){this.plugins={internal:[],external:[]},this.registry={}}var e=n.prototype;return e.onCreateRule=function(r,s,i){for(var o=0;o<this.registry.onCreateRule.length;o++){var a=this.registry.onCreateRule[o](r,s,i);if(a)return a}return null},e.onProcessRule=function(r){if(!r.isProcessed){for(var s=r.options.sheet,i=0;i<this.registry.onProcessRule.length;i++)this.registry.onProcessRule[i](r,s);r.style&&this.onProcessStyle(r.style,r,s),r.isProcessed=!0}},e.onProcessStyle=function(r,s,i){for(var o=0;o<this.registry.onProcessStyle.length;o++)s.style=this.registry.onProcessStyle[o](s.style,s,i)},e.onProcessSheet=function(r){for(var s=0;s<this.registry.onProcessSheet.length;s++)this.registry.onProcessSheet[s](r)},e.onUpdate=function(r,s,i,o){for(var a=0;a<this.registry.onUpdate.length;a++)this.registry.onUpdate[a](r,s,i,o)},e.onChangeValue=function(r,s,i){for(var o=r,a=0;a<this.registry.onChangeValue.length;a++)o=this.registry.onChangeValue[a](o,s,i);return o},e.use=function(r,s){s===void 0&&(s={queue:"external"});var i=this.plugins[s.queue];i.indexOf(r)===-1&&(i.push(r),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce(function(o,a){for(var u in a)u in o&&o[u].push(a[u]);return o},{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},n}(),LI=function(){function n(){this.registry=[]}var e=n.prototype;return e.add=function(r){var s=this.registry,i=r.options.index;if(s.indexOf(r)===-1){if(s.length===0||i>=this.index){s.push(r);return}for(var o=0;o<s.length;o++)if(s[o].options.index>i){s.splice(o,0,r);return}}},e.reset=function(){this.registry=[]},e.remove=function(r){var s=this.registry.indexOf(r);this.registry.splice(s,1)},e.toString=function(r){for(var s=r===void 0?{}:r,i=s.attached,o=Fp(s,["attached"]),a=rc(o),u=a.linebreak,f="",h=0;h<this.registry.length;h++){var p=this.registry[h];i!=null&&p.attached!==i||(f&&(f+=u),f+=p.toString(o))}return f},ly(n,[{key:"index",get:function(){return this.registry.length===0?0:this.registry[this.registry.length-1].options.index}}]),n}(),gu=new LI,bv=typeof globalThis<"u"?globalThis:typeof window<"u"&&window.Math===Math?window:typeof self<"u"&&self.Math===Math?self:Function("return this")(),Tv="2f1acc6c3a606b082e5eef5e54414ffb";bv[Tv]==null&&(bv[Tv]=0);var w3=bv[Tv]++,b3=function(e){e===void 0&&(e={});var t=0,r=function(i,o){t+=1;var a="",u="";return o&&(o.options.classNamePrefix&&(u=o.options.classNamePrefix),o.options.jss.id!=null&&(a=String(o.options.jss.id))),e.minify?""+(u||"c")+w3+a+t:u+i.key+"-"+w3+(a?"-"+a:"")+"-"+t};return r},OS=function(e){var t;return function(){return t||(t=e()),t}},FI=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch{return""}},BI=function(e,t,r){try{var s=r;if(Array.isArray(r)&&(s=sa(r)),e.attributeStyleMap)e.attributeStyleMap.set(t,s);else{var i=s?s.indexOf("!important"):-1,o=i>-1?s.substr(0,i-1):s;e.style.setProperty(t,o,i>-1?"important":"")}}catch{return!1}return!0},UI=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch{}},VI=function(e,t){return e.selectorText=t,e.selectorText===t},NS=OS(function(){return document.querySelector("head")});function zI(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.attached&&r.options.index>e.index&&r.options.insertionPoint===e.insertionPoint)return r}return null}function $I(n,e){for(var t=n.length-1;t>=0;t--){var r=n[t];if(r.attached&&r.options.insertionPoint===e.insertionPoint)return r}return null}function jI(n){for(var e=NS(),t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(r.nodeType===8&&r.nodeValue.trim()===n)return r}return null}function WI(n){var e=gu.registry;if(e.length>0){var t=zI(e,n);if(t&&t.renderer)return{parent:t.renderer.element.parentNode,node:t.renderer.element};if(t=$I(e,n),t&&t.renderer)return{parent:t.renderer.element.parentNode,node:t.renderer.element.nextSibling}}var r=n.insertionPoint;if(r&&typeof r=="string"){var s=jI(r);if(s)return{parent:s.parentNode,node:s.nextSibling}}return!1}function HI(n,e){var t=e.insertionPoint,r=WI(e);if(r!==!1&&r.parent){r.parent.insertBefore(n,r.node);return}if(t&&typeof t.nodeType=="number"){var s=t,i=s.parentNode;i&&i.insertBefore(n,s.nextSibling);return}NS().appendChild(n)}var XI=OS(function(){var n=document.querySelector('meta[property="csp-nonce"]');return n?n.getAttribute("content"):null}),T3=function(e,t,r){try{"insertRule"in e?e.insertRule(t,r):"appendRule"in e&&e.appendRule(t)}catch{return!1}return e.cssRules[r]},S3=function(e,t){var r=e.cssRules.length;return t===void 0||t>r?r:t},YI=function(){var e=document.createElement("style");return e.textContent=`
`,e},qI=function(){function n(t){this.getPropertyValue=FI,this.setProperty=BI,this.removeProperty=UI,this.setSelector=VI,this.hasInsertedRules=!1,this.cssRules=[],t&&gu.add(t),this.sheet=t;var r=this.sheet?this.sheet.options:{},s=r.media,i=r.meta,o=r.element;this.element=o||YI(),this.element.setAttribute("data-jss",""),s&&this.element.setAttribute("media",s),i&&this.element.setAttribute("data-meta",i);var a=XI();a&&this.element.setAttribute("nonce",a)}var e=n.prototype;return e.attach=function(){if(!(this.element.parentNode||!this.sheet)){HI(this.element,this.sheet.options);var r=!!(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&r&&(this.hasInsertedRules=!1,this.deploy())}},e.detach=function(){if(this.sheet){var r=this.element.parentNode;r&&r.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent=`
`)}},e.deploy=function(){var r=this.sheet;if(r){if(r.options.link){this.insertRules(r.rules);return}this.element.textContent=`
`+r.toString()+`
`}},e.insertRules=function(r,s){for(var i=0;i<r.index.length;i++)this.insertRule(r.index[i],i,s)},e.insertRule=function(r,s,i){if(i===void 0&&(i=this.element.sheet),r.rules){var o=r,a=i;if(r.type==="conditional"||r.type==="keyframes"){var u=S3(i,s);if(a=T3(i,o.toString({children:!1}),u),a===!1)return!1;this.refCssRule(r,u,a)}return this.insertRules(o.rules,a),a}var f=r.toString();if(!f)return!1;var h=S3(i,s),p=T3(i,f,h);return p===!1?!1:(this.hasInsertedRules=!0,this.refCssRule(r,h,p),p)},e.refCssRule=function(r,s,i){r.renderable=i,r.options.parent instanceof kS&&this.cssRules.splice(s,0,i)},e.deleteRule=function(r){var s=this.element.sheet,i=this.indexOf(r);return i===-1?!1:(s.deleteRule(i),this.cssRules.splice(i,1),!0)},e.indexOf=function(r){return this.cssRules.indexOf(r)},e.replaceRule=function(r,s){var i=this.indexOf(r);return i===-1?!1:(this.element.sheet.deleteRule(i),this.cssRules.splice(i,1),this.insertRule(s,i))},e.getRules=function(){return this.element.sheet.cssRules},n}(),KI=0,ZI=function(){function n(t){this.id=KI++,this.version="10.10.0",this.plugins=new DI,this.options={id:{minify:!1},createGenerateId:b3,Renderer:rf?qI:null,plugins:[]},this.generateId=b3({minify:!1});for(var r=0;r<y3.length;r++)this.plugins.use(y3[r],{queue:"internal"});this.setup(t)}var e=n.prototype;return e.setup=function(r){return r===void 0&&(r={}),r.createGenerateId&&(this.options.createGenerateId=r.createGenerateId),r.id&&(this.options.id=Ee({},this.options.id,r.id)),(r.createGenerateId||r.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),r.insertionPoint!=null&&(this.options.insertionPoint=r.insertionPoint),"Renderer"in r&&(this.options.Renderer=r.Renderer),r.plugins&&this.use.apply(this,r.plugins),this},e.createStyleSheet=function(r,s){s===void 0&&(s={});var i=s,o=i.index;typeof o!="number"&&(o=gu.index===0?0:gu.index+1);var a=new kS(r,Ee({},s,{jss:this,generateId:s.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:o}));return this.plugins.onProcessSheet(a),a},e.removeStyleSheet=function(r){return r.detach(),gu.remove(r),this},e.createRule=function(r,s,i){if(s===void 0&&(s={}),i===void 0&&(i={}),typeof r=="object")return this.createRule(void 0,r,s);var o=Ee({},i,{name:r,jss:this,Renderer:this.options.Renderer});o.generateId||(o.generateId=this.generateId),o.classes||(o.classes={}),o.keyframes||(o.keyframes={});var a=cy(r,s,o);return a&&this.plugins.onProcessRule(a),a},e.use=function(){for(var r=this,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return i.forEach(function(a){r.plugins.use(a)}),this},n}(),DS=function(e){return new ZI(e)},fy=typeof CSS=="object"&&CSS!=null&&"number"in CSS;function LS(n){var e=null;for(var t in n){var r=n[t],s=typeof r;if(s==="function")e||(e={}),e[t]=r;else if(s==="object"&&r!==null&&!Array.isArray(r)){var i=LS(r);i&&(e||(e={}),e[t]=i)}}return e}/**
 * A better abstraction over CSS.
 *
 * @copyright Oleg Isonen (Slobodskoi) / Isonen 2014-present
 * @website https://github.com/cssinjs/jss
 * @license MIT
 */DS();var FS=Date.now(),s0="fnValues"+FS,i0="fnStyle"+ ++FS,QI=function(){return{onCreateRule:function(t,r,s){if(typeof r!="function")return null;var i=cy(t,{},s);return i[i0]=r,i},onProcessStyle:function(t,r){if(s0 in r||i0 in r)return t;var s={};for(var i in t){var o=t[i];typeof o=="function"&&(delete t[i],s[i]=o)}return r[s0]=s,t},onUpdate:function(t,r,s,i){var o=r,a=o[i0];a&&(o.style=a(t)||{});var u=o[s0];if(u)for(var f in u)o.prop(f,u[f](t),i)}}},lo="@global",Sv="@global ",GI=function(){function n(t,r,s){this.type="global",this.at=lo,this.isProcessed=!1,this.key=t,this.options=s,this.rules=new zp(Ee({},s,{parent:this}));for(var i in r)this.rules.add(i,r[i]);this.rules.process()}var e=n.prototype;return e.getRule=function(r){return this.rules.get(r)},e.addRule=function(r,s,i){var o=this.rules.add(r,s,i);return o&&this.options.jss.plugins.onProcessRule(o),o},e.replaceRule=function(r,s,i){var o=this.rules.replace(r,s,i);return o&&this.options.jss.plugins.onProcessRule(o),o},e.indexOf=function(r){return this.rules.indexOf(r)},e.toString=function(r){return this.rules.toString(r)},n}(),JI=function(){function n(t,r,s){this.type="global",this.at=lo,this.isProcessed=!1,this.key=t,this.options=s;var i=t.substr(Sv.length);this.rule=s.jss.createRule(i,r,Ee({},s,{parent:this}))}var e=n.prototype;return e.toString=function(r){return this.rule?this.rule.toString(r):""},n}(),e6=/\s*,\s*/g;function BS(n,e){for(var t=n.split(e6),r="",s=0;s<t.length;s++)r+=e+" "+t[s].trim(),t[s+1]&&(r+=", ");return r}function t6(n,e){var t=n.options,r=n.style,s=r?r[lo]:null;if(s){for(var i in s)e.addRule(i,s[i],Ee({},t,{selector:BS(i,n.selector)}));delete r[lo]}}function n6(n,e){var t=n.options,r=n.style;for(var s in r)if(!(s[0]!=="@"||s.substr(0,lo.length)!==lo)){var i=BS(s.substr(lo.length),n.selector);e.addRule(i,r[s],Ee({},t,{selector:i})),delete r[s]}}function r6(){function n(t,r,s){if(!t)return null;if(t===lo)return new GI(t,r,s);if(t[0]==="@"&&t.substr(0,Sv.length)===Sv)return new JI(t,r,s);var i=s.parent;return i&&(i.type==="global"||i.options.parent&&i.options.parent.type==="global")&&(s.scoped=!1),!s.selector&&s.scoped===!1&&(s.selector=t),null}function e(t,r){t.type!=="style"||!r||(t6(t,r),n6(t,r))}return{onCreateRule:n,onProcessRule:e}}var E3=/\s*,\s*/g,s6=/&/g,i6=/\$([\w-]+)/g;function o6(){function n(s,i){return function(o,a){var u=s.getRule(a)||i&&i.getRule(a);return u?u.selector:a}}function e(s,i){for(var o=i.split(E3),a=s.split(E3),u="",f=0;f<o.length;f++)for(var h=o[f],p=0;p<a.length;p++){var m=a[p];u&&(u+=", "),u+=m.indexOf("&")!==-1?m.replace(s6,h):h+" "+m}return u}function t(s,i,o){if(o)return Ee({},o,{index:o.index+1});var a=s.options.nestingLevel;a=a===void 0?1:a+1;var u=Ee({},s.options,{nestingLevel:a,index:i.indexOf(s)+1});return delete u.name,u}function r(s,i,o){if(i.type!=="style")return s;var a=i,u=a.options.parent,f,h;for(var p in s){var m=p.indexOf("&")!==-1,v=p[0]==="@";if(!(!m&&!v)){if(f=t(a,u,f),m){var x=e(p,a.selector);h||(h=n(u,o)),x=x.replace(i6,h);var w=a.key+"-"+p;"replaceRule"in u?u.replaceRule(w,s[p],Ee({},f,{selector:x})):u.addRule(w,s[p],Ee({},f,{selector:x}))}else v&&u.addRule(p,{},f).addRule(a.key,s[p],{selector:a.selector});delete s[p]}}return s}return{onProcessStyle:r}}var a6=/[A-Z]/g,l6=/^ms-/,o0={};function c6(n){return"-"+n.toLowerCase()}function US(n){if(o0.hasOwnProperty(n))return o0[n];var e=n.replace(a6,c6);return o0[n]=l6.test(e)?"-"+e:e}function Td(n){var e={};for(var t in n){var r=t.indexOf("--")===0?t:US(t);e[r]=n[t]}return n.fallbacks&&(Array.isArray(n.fallbacks)?e.fallbacks=n.fallbacks.map(Td):e.fallbacks=Td(n.fallbacks)),e}function u6(){function n(t){if(Array.isArray(t)){for(var r=0;r<t.length;r++)t[r]=Td(t[r]);return t}return Td(t)}function e(t,r,s){if(r.indexOf("--")===0)return t;var i=US(r);return r===i?t:(s.prop(i,t),null)}return{onProcessStyle:n,onChangeValue:e}}var ge=fy&&CSS?CSS.px:"px",Ah=fy&&CSS?CSS.ms:"ms",ol=fy&&CSS?CSS.percent:"%",f6={"animation-delay":Ah,"animation-duration":Ah,"background-position":ge,"background-position-x":ge,"background-position-y":ge,"background-size":ge,border:ge,"border-bottom":ge,"border-bottom-left-radius":ge,"border-bottom-right-radius":ge,"border-bottom-width":ge,"border-left":ge,"border-left-width":ge,"border-radius":ge,"border-right":ge,"border-right-width":ge,"border-top":ge,"border-top-left-radius":ge,"border-top-right-radius":ge,"border-top-width":ge,"border-width":ge,"border-block":ge,"border-block-end":ge,"border-block-end-width":ge,"border-block-start":ge,"border-block-start-width":ge,"border-block-width":ge,"border-inline":ge,"border-inline-end":ge,"border-inline-end-width":ge,"border-inline-start":ge,"border-inline-start-width":ge,"border-inline-width":ge,"border-start-start-radius":ge,"border-start-end-radius":ge,"border-end-start-radius":ge,"border-end-end-radius":ge,margin:ge,"margin-bottom":ge,"margin-left":ge,"margin-right":ge,"margin-top":ge,"margin-block":ge,"margin-block-end":ge,"margin-block-start":ge,"margin-inline":ge,"margin-inline-end":ge,"margin-inline-start":ge,padding:ge,"padding-bottom":ge,"padding-left":ge,"padding-right":ge,"padding-top":ge,"padding-block":ge,"padding-block-end":ge,"padding-block-start":ge,"padding-inline":ge,"padding-inline-end":ge,"padding-inline-start":ge,"mask-position-x":ge,"mask-position-y":ge,"mask-size":ge,height:ge,width:ge,"min-height":ge,"max-height":ge,"min-width":ge,"max-width":ge,bottom:ge,left:ge,top:ge,right:ge,inset:ge,"inset-block":ge,"inset-block-end":ge,"inset-block-start":ge,"inset-inline":ge,"inset-inline-end":ge,"inset-inline-start":ge,"box-shadow":ge,"text-shadow":ge,"column-gap":ge,"column-rule":ge,"column-rule-width":ge,"column-width":ge,"font-size":ge,"font-size-delta":ge,"letter-spacing":ge,"text-decoration-thickness":ge,"text-indent":ge,"text-stroke":ge,"text-stroke-width":ge,"word-spacing":ge,motion:ge,"motion-offset":ge,outline:ge,"outline-offset":ge,"outline-width":ge,perspective:ge,"perspective-origin-x":ol,"perspective-origin-y":ol,"transform-origin":ol,"transform-origin-x":ol,"transform-origin-y":ol,"transform-origin-z":ol,"transition-delay":Ah,"transition-duration":Ah,"vertical-align":ge,"flex-basis":ge,"shape-margin":ge,size:ge,gap:ge,grid:ge,"grid-gap":ge,"row-gap":ge,"grid-row-gap":ge,"grid-column-gap":ge,"grid-template-rows":ge,"grid-template-columns":ge,"grid-auto-rows":ge,"grid-auto-columns":ge,"box-shadow-x":ge,"box-shadow-y":ge,"box-shadow-blur":ge,"box-shadow-spread":ge,"font-line-height":ge,"text-shadow-x":ge,"text-shadow-y":ge,"text-shadow-blur":ge};function VS(n){var e=/(-[a-z])/g,t=function(o){return o[1].toUpperCase()},r={};for(var s in n)r[s]=n[s],r[s.replace(e,t)]=n[s];return r}var h6=VS(f6);function mu(n,e,t){if(e==null)return e;if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=mu(n,e[r],t);else if(typeof e=="object")if(n==="fallbacks")for(var s in e)e[s]=mu(s,e[s],t);else for(var i in e)e[i]=mu(n+"-"+i,e[i],t);else if(typeof e=="number"&&isNaN(e)===!1){var o=t[n]||h6[n];return o&&!(e===0&&o===ge)?typeof o=="function"?o(e).toString():""+e+o:e.toString()}return e}function d6(n){n===void 0&&(n={});var e=VS(n);function t(s,i){if(i.type!=="style")return s;for(var o in s)s[o]=mu(o,s[o],e);return s}function r(s,i){return mu(i,s,e)}return{onProcessStyle:t,onChangeValue:r}}var nu="",Ev="",zS="",$S="",p6=rf&&"ontouchstart"in document.documentElement;if(rf){var a0={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},g6=document.createElement("p"),l0=g6.style,m6="Transform";for(var c0 in a0)if(c0+m6 in l0){nu=c0,Ev=a0[c0];break}nu==="Webkit"&&"msHyphens"in l0&&(nu="ms",Ev=a0.ms,$S="edge"),nu==="Webkit"&&"-apple-trailing-word"in l0&&(zS="apple")}var st={js:nu,css:Ev,vendor:zS,browser:$S,isTouch:p6};function v6(n){return n[1]==="-"||st.js==="ms"?n:"@"+st.css+"keyframes"+n.substr(10)}var _6={noPrefill:["appearance"],supportedProperty:function(e){return e!=="appearance"?!1:st.js==="ms"?"-webkit-"+e:st.css+e}},y6={noPrefill:["color-adjust"],supportedProperty:function(e){return e!=="color-adjust"?!1:st.js==="Webkit"?st.css+"print-"+e:e}},x6=/[-\s]+(.)?/g;function w6(n,e){return e?e.toUpperCase():""}function hy(n){return n.replace(x6,w6)}function ho(n){return hy("-"+n)}var b6={noPrefill:["mask"],supportedProperty:function(e,t){if(!/^mask/.test(e))return!1;if(st.js==="Webkit"){var r="mask-image";if(hy(r)in t)return e;if(st.js+ho(r)in t)return st.css+e}return e}},T6={noPrefill:["text-orientation"],supportedProperty:function(e){return e!=="text-orientation"?!1:st.vendor==="apple"&&!st.isTouch?st.css+e:e}},S6={noPrefill:["transform"],supportedProperty:function(e,t,r){return e!=="transform"?!1:r.transform?e:st.css+e}},E6={noPrefill:["transition"],supportedProperty:function(e,t,r){return e!=="transition"?!1:r.transition?e:st.css+e}},A6={noPrefill:["writing-mode"],supportedProperty:function(e){return e!=="writing-mode"?!1:st.js==="Webkit"||st.js==="ms"&&st.browser!=="edge"?st.css+e:e}},R6={noPrefill:["user-select"],supportedProperty:function(e){return e!=="user-select"?!1:st.js==="Moz"||st.js==="ms"||st.vendor==="apple"?st.css+e:e}},C6={supportedProperty:function(e,t){if(!/^break-/.test(e))return!1;if(st.js==="Webkit"){var r="WebkitColumn"+ho(e);return r in t?st.css+"column-"+e:!1}if(st.js==="Moz"){var s="page"+ho(e);return s in t?"page-"+e:!1}return!1}},P6={supportedProperty:function(e,t){if(!/^(border|margin|padding)-inline/.test(e))return!1;if(st.js==="Moz")return e;var r=e.replace("-inline","");return st.js+ho(r)in t?st.css+r:!1}},I6={supportedProperty:function(e,t){return hy(e)in t?e:!1}},M6={supportedProperty:function(e,t){var r=ho(e);return e[0]==="-"||e[0]==="-"&&e[1]==="-"?e:st.js+r in t?st.css+e:st.js!=="Webkit"&&"Webkit"+r in t?"-webkit-"+e:!1}},k6={supportedProperty:function(e){return e.substring(0,11)!=="scroll-snap"?!1:st.js==="ms"?""+st.css+e:e}},O6={supportedProperty:function(e){return e!=="overscroll-behavior"?!1:st.js==="ms"?st.css+"scroll-chaining":e}},N6={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},D6={supportedProperty:function(e,t){var r=N6[e];return r&&st.js+ho(r)in t?st.css+r:!1}},jS={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},L6=Object.keys(jS),F6=function(e){return st.css+e},B6={supportedProperty:function(e,t,r){var s=r.multiple;if(L6.indexOf(e)>-1){var i=jS[e];if(!Array.isArray(i))return st.js+ho(i)in t?st.css+i:!1;if(!s)return!1;for(var o=0;o<i.length;o++)if(!(st.js+ho(i[0])in t))return!1;return i.map(F6)}return!1}},WS=[_6,y6,b6,T6,S6,E6,A6,R6,C6,P6,I6,M6,k6,O6,D6,B6],A3=WS.filter(function(n){return n.supportedProperty}).map(function(n){return n.supportedProperty}),U6=WS.filter(function(n){return n.noPrefill}).reduce(function(n,e){return n.push.apply(n,Bp(e.noPrefill)),n},[]),ru,qo={};if(rf){ru=document.createElement("p");var u0=window.getComputedStyle(document.documentElement,"");for(var f0 in u0)isNaN(f0)||(qo[u0[f0]]=u0[f0]);U6.forEach(function(n){return delete qo[n]})}function Av(n,e){if(e===void 0&&(e={}),!ru)return n;if(qo[n]!=null)return qo[n];(n==="transition"||n==="transform")&&(e[n]=n in ru.style);for(var t=0;t<A3.length&&(qo[n]=A3[t](n,ru.style,e),!qo[n]);t++);try{ru.style[n]=""}catch{return!1}return qo[n]}var al={},V6={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},z6=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g,qi;function $6(n,e,t){if(e==="var")return"var";if(e==="all")return"all";if(t==="all")return", all";var r=e?Av(e):", "+Av(t);return r||e||t}rf&&(qi=document.createElement("p"));function R3(n,e){var t=e;if(!qi||n==="content")return e;if(typeof t!="string"||!isNaN(parseInt(t,10)))return t;var r=n+t;if(al[r]!=null)return al[r];try{qi.style[n]=t}catch{return al[r]=!1,!1}if(V6[n])t=t.replace(z6,$6);else if(qi.style[n]===""&&(t=st.css+t,t==="-ms-flex"&&(qi.style[n]="-ms-flexbox"),qi.style[n]=t,qi.style[n]===""))return al[r]=!1,!1;return qi.style[n]="",al[r]=t,al[r]}function j6(){function n(s){if(s.type==="keyframes"){var i=s;i.at=v6(i.at)}}function e(s){for(var i in s){var o=s[i];if(i==="fallbacks"&&Array.isArray(o)){s[i]=o.map(e);continue}var a=!1,u=Av(i);u&&u!==i&&(a=!0);var f=!1,h=R3(u,sa(o));h&&h!==o&&(f=!0),(a||f)&&(a&&delete s[i],s[u||i]=h||o)}return s}function t(s,i){return i.type!=="style"?s:e(s)}function r(s,i){return R3(i,sa(s))||s}return{onProcessRule:n,onProcessStyle:t,onChangeValue:r}}function W6(){var n=function(t,r){return t.length===r.length?t>r?1:-1:t.length-r.length};return{onProcessStyle:function(t,r){if(r.type!=="style")return t;for(var s={},i=Object.keys(t).sort(n),o=0;o<i.length;o++)s[i[o]]=t[i[o]];return s}}}function H6(){return{plugins:[QI(),r6(),o6(),u6(),d6(),typeof window>"u"?null:j6(),W6()]}}var B=sy();const Wt=Ea(B);function HS(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=n.baseClasses,t=n.newClasses;if(n.Component,!t)return e;var r=Ee({},e);return Object.keys(t).forEach(function(s){t[s]&&(r[s]="".concat(e[s]," ").concat(t[s]))}),r}var xl={set:function(e,t,r,s){var i=e.get(t);i||(i=new Map,e.set(t,i)),i.set(r,s)},get:function(e,t,r){var s=e.get(t);return s?s.get(r):void 0},delete:function(e,t,r){var s=e.get(t);s.delete(r)}},XS=Wt.createContext(null);function sf(){var n=Wt.useContext(XS);return n}var X6=DS(H6()),Y6=fI(),q6=new Map,K6={disableGeneration:!1,generateClassName:Y6,jss:X6,sheetsCache:null,sheetsManager:q6,sheetsRegistry:null},Z6=Wt.createContext(K6),C3=-1e9;function Q6(){return C3+=1,C3}var G6={};function J6(n){var e=typeof n=="function";return{create:function(r,s){var i;try{i=e?n(r):n}catch(u){throw u}if(!s||!r.overrides||!r.overrides[s])return i;var o=r.overrides[s],a=Ee({},i);return Object.keys(o).forEach(function(u){a[u]=Wl(a[u],o[u])}),a},options:{}}}function eM(n,e,t){var r=n.state,s=n.stylesOptions;if(s.disableGeneration)return e||{};r.cacheClasses||(r.cacheClasses={value:null,lastProp:null,lastJSS:{}});var i=!1;return r.classes!==r.cacheClasses.lastJSS&&(r.cacheClasses.lastJSS=r.classes,i=!0),e!==r.cacheClasses.lastProp&&(r.cacheClasses.lastProp=e,i=!0),i&&(r.cacheClasses.value=HS({baseClasses:r.cacheClasses.lastJSS,newClasses:e,Component:t})),r.cacheClasses.value}function tM(n,e){var t=n.state,r=n.theme,s=n.stylesOptions,i=n.stylesCreator,o=n.name;if(!s.disableGeneration){var a=xl.get(s.sheetsManager,i,r);a||(a={refs:0,staticSheet:null,dynamicStyles:null},xl.set(s.sheetsManager,i,r,a));var u=Ee({},i.options,s,{theme:r,flip:typeof s.flip=="boolean"?s.flip:r.direction==="rtl"});u.generateId=u.serverGenerateClassName||u.generateClassName;var f=s.sheetsRegistry;if(a.refs===0){var h;s.sheetsCache&&(h=xl.get(s.sheetsCache,i,r));var p=i.create(r,o);h||(h=s.jss.createStyleSheet(p,Ee({link:!1},u)),h.attach(),s.sheetsCache&&xl.set(s.sheetsCache,i,r,h)),f&&f.add(h),a.staticSheet=h,a.dynamicStyles=LS(p)}if(a.dynamicStyles){var m=s.jss.createStyleSheet(a.dynamicStyles,Ee({link:!0},u));m.update(e),m.attach(),t.dynamicSheet=m,t.classes=HS({baseClasses:a.staticSheet.classes,newClasses:m.classes}),f&&f.add(m)}else t.classes=a.staticSheet.classes;a.refs+=1}}function nM(n,e){var t=n.state;t.dynamicSheet&&t.dynamicSheet.update(e)}function rM(n){var e=n.state,t=n.theme,r=n.stylesOptions,s=n.stylesCreator;if(!r.disableGeneration){var i=xl.get(r.sheetsManager,s,t);i.refs-=1;var o=r.sheetsRegistry;i.refs===0&&(xl.delete(r.sheetsManager,s,t),r.jss.removeStyleSheet(i.staticSheet),o&&o.remove(i.staticSheet)),e.dynamicSheet&&(r.jss.removeStyleSheet(e.dynamicSheet),o&&o.remove(e.dynamicSheet))}}function sM(n,e){var t=Wt.useRef([]),r,s=Wt.useMemo(function(){return{}},e);t.current!==s&&(t.current=s,r=n()),Wt.useEffect(function(){return function(){r&&r()}},[s])}function $p(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.name,r=e.classNamePrefix,s=e.Component,i=e.defaultTheme,o=i===void 0?G6:i,a=Et(e,["name","classNamePrefix","Component","defaultTheme"]),u=J6(n),f=t||r||"makeStyles";u.options={index:Q6(),name:t,meta:f,classNamePrefix:f};var h=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=sf()||o,x=Ee({},Wt.useContext(Z6),a),w=Wt.useRef(),T=Wt.useRef();sM(function(){var C={name:t,state:{},stylesCreator:u,stylesOptions:x,theme:v};return tM(C,m),T.current=!1,w.current=C,function(){rM(C)}},[v,u]),Wt.useEffect(function(){T.current&&nM(w.current,m),T.current=!0});var E=eM(w.current,m.classes,s);return E};return h}function iM(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function YS(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n))for(e=0;e<n.length;e++)n[e]&&(t=YS(n[e]))&&(r&&(r+=" "),r+=t);else for(e in n)n[e]&&(r&&(r+=" "),r+=e);return r}function Tt(){for(var n,e,t=0,r="";t<arguments.length;)(n=arguments[t++])&&(e=YS(n))&&(r&&(r+=" "),r+=e);return r}var h0={exports:{}},Rt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P3;function oM(){if(P3)return Rt;P3=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,t=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,i=n?Symbol.for("react.profiler"):60114,o=n?Symbol.for("react.provider"):60109,a=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,f=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,x=n?Symbol.for("react.lazy"):60116,w=n?Symbol.for("react.block"):60121,T=n?Symbol.for("react.fundamental"):60117,E=n?Symbol.for("react.responder"):60118,C=n?Symbol.for("react.scope"):60119;function P(I){if(typeof I=="object"&&I!==null){var F=I.$$typeof;switch(F){case e:switch(I=I.type,I){case u:case f:case r:case i:case s:case p:return I;default:switch(I=I&&I.$$typeof,I){case a:case h:case x:case v:case o:return I;default:return F}}case t:return F}}}function L(I){return P(I)===f}return Rt.AsyncMode=u,Rt.ConcurrentMode=f,Rt.ContextConsumer=a,Rt.ContextProvider=o,Rt.Element=e,Rt.ForwardRef=h,Rt.Fragment=r,Rt.Lazy=x,Rt.Memo=v,Rt.Portal=t,Rt.Profiler=i,Rt.StrictMode=s,Rt.Suspense=p,Rt.isAsyncMode=function(I){return L(I)||P(I)===u},Rt.isConcurrentMode=L,Rt.isContextConsumer=function(I){return P(I)===a},Rt.isContextProvider=function(I){return P(I)===o},Rt.isElement=function(I){return typeof I=="object"&&I!==null&&I.$$typeof===e},Rt.isForwardRef=function(I){return P(I)===h},Rt.isFragment=function(I){return P(I)===r},Rt.isLazy=function(I){return P(I)===x},Rt.isMemo=function(I){return P(I)===v},Rt.isPortal=function(I){return P(I)===t},Rt.isProfiler=function(I){return P(I)===i},Rt.isStrictMode=function(I){return P(I)===s},Rt.isSuspense=function(I){return P(I)===p},Rt.isValidElementType=function(I){return typeof I=="string"||typeof I=="function"||I===r||I===f||I===i||I===s||I===p||I===m||typeof I=="object"&&I!==null&&(I.$$typeof===x||I.$$typeof===v||I.$$typeof===o||I.$$typeof===a||I.$$typeof===h||I.$$typeof===T||I.$$typeof===E||I.$$typeof===C||I.$$typeof===w)},Rt.typeOf=P,Rt}var I3;function aM(){return I3||(I3=1,h0.exports=oM()),h0.exports}var d0,M3;function lM(){if(M3)return d0;M3=1;var n=aM(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};i[n.ForwardRef]=r,i[n.Memo]=s;function o(x){return n.isMemo(x)?s:i[x.$$typeof]||e}var a=Object.defineProperty,u=Object.getOwnPropertyNames,f=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,m=Object.prototype;function v(x,w,T){if(typeof w!="string"){if(m){var E=p(w);E&&E!==m&&v(x,E,T)}var C=u(w);f&&(C=C.concat(f(w)));for(var P=o(x),L=o(w),I=0;I<C.length;++I){var F=C[I];if(!t[F]&&!(T&&T[F])&&!(L&&L[F])&&!(P&&P[F])){var j=h(w,F);try{a(x,F,j)}catch{}}}}return x}return d0=v,d0}var cM=lM();const uM=Ea(cM);function fM(n,e){if(typeof e=="function"){var t=e(n);return t}return Ee({},n,e)}function hM(n){var e=n.children,t=n.theme,r=sf(),s=Wt.useMemo(function(){var i=r===null?t:fM(r,t);return i!=null&&(i[PS]=r!==null),i},[t,r]);return Wt.createElement(XS.Provider,{value:s},e)}var bo=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(r){var s=t.defaultTheme,i=t.withTheme,o=i===void 0?!1:i,a=t.name,u=Et(t,["defaultTheme","withTheme","name"]),f=a,h=$p(e,Ee({defaultTheme:s,Component:r,name:a||r.displayName,classNamePrefix:f},u)),p=Wt.forwardRef(function(v,x){v.classes;var w=v.innerRef,T=Et(v,["classes","innerRef"]),E=h(Ee({},r.defaultProps,v)),C,P=T;return(typeof a=="string"||o)&&(C=sf()||s,a&&(P=IS({theme:C,name:a,props:T})),o&&!P.theme&&(P.theme=C)),Wt.createElement(r,Ee({ref:w||x,classes:E},P))});return uM(p,r),p}},qS=CS();function dy(){var n=sf()||qS;return n}function En(n,e){return bo(n,Ee({defaultTheme:qS},e))}function Yr(n){if(typeof n!="string")throw new Error(Pu(7));return n.charAt(0).toUpperCase()+n.slice(1)}function Rv(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.reduce(function(r,s){return s==null?r:function(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];r.apply(this,a),s.apply(this,a)}},function(){})}var dM=function(e){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:e.typography.pxToRem(24),transition:e.transitions.create("fill",{duration:e.transitions.duration.shorter})},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorAction:{color:e.palette.action.active},colorError:{color:e.palette.error.main},colorDisabled:{color:e.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:e.typography.pxToRem(20)},fontSizeLarge:{fontSize:e.typography.pxToRem(35)}}},KS=B.forwardRef(function(e,t){var r=e.children,s=e.classes,i=e.className,o=e.color,a=o===void 0?"inherit":o,u=e.component,f=u===void 0?"svg":u,h=e.fontSize,p=h===void 0?"medium":h,m=e.htmlColor,v=e.titleAccess,x=e.viewBox,w=x===void 0?"0 0 24 24":x,T=Et(e,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return B.createElement(f,Ee({className:Tt(s.root,i,a!=="inherit"&&s["color".concat(Yr(a))],p!=="default"&&p!=="medium"&&s["fontSize".concat(Yr(p))]),focusable:"false",viewBox:w,color:m,"aria-hidden":v?void 0:!0,role:v?"img":void 0,ref:t},T),r,v?B.createElement("title",null,v):null)});KS.muiName="SvgIcon";const k3=En(dM,{name:"MuiSvgIcon"})(KS);function di(n,e){var t=function(s,i){return Wt.createElement(k3,Ee({ref:i},s),n)};return t.muiName=k3.muiName,Wt.memo(Wt.forwardRef(t))}function ZS(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:166,t;function r(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];var a=this,u=function(){n.apply(a,i)};clearTimeout(t),t=setTimeout(u,e)}return r.clear=function(){clearTimeout(t)},r}function cs(n){return n&&n.ownerDocument||document}function QS(n){var e=cs(n);return e.defaultView||window}function Sd(n,e){typeof n=="function"?n(e):n&&(n.current=e)}function GS(n){var e=n.controlled,t=n.default;n.name,n.state;var r=B.useRef(e!==void 0),s=r.current,i=B.useState(t),o=i[0],a=i[1],u=s?e:o,f=B.useCallback(function(h){s||a(h)},[]);return[u,f]}var pM=typeof window<"u"?B.useLayoutEffect:B.useEffect;function qn(n){var e=B.useRef(n);return pM(function(){e.current=n}),B.useCallback(function(){return e.current.apply(void 0,arguments)},[])}function Gn(n,e){return B.useMemo(function(){return n==null&&e==null?null:function(t){Sd(n,t),Sd(e,t)}},[n,e])}var p0={exports:{}},vr={},g0={exports:{}},m0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O3;function gM(){return O3||(O3=1,function(n){function e(N,Y){var k=N.length;N.push(Y);e:for(;0<k;){var b=k-1>>>1,O=N[b];if(0<s(O,Y))N[b]=Y,N[k]=O,k=b;else break e}}function t(N){return N.length===0?null:N[0]}function r(N){if(N.length===0)return null;var Y=N[0],k=N.pop();if(k!==Y){N[0]=k;e:for(var b=0,O=N.length,W=O>>>1;b<W;){var K=2*(b+1)-1,ee=N[K],te=K+1,ce=N[te];if(0>s(ee,k))te<O&&0>s(ce,ee)?(N[b]=ce,N[te]=k,b=te):(N[b]=ee,N[K]=k,b=K);else if(te<O&&0>s(ce,k))N[b]=ce,N[te]=k,b=te;else break e}}return Y}function s(N,Y){var k=N.sortIndex-Y.sortIndex;return k!==0?k:N.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var u=[],f=[],h=1,p=null,m=3,v=!1,x=!1,w=!1,T=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function P(N){for(var Y=t(f);Y!==null;){if(Y.callback===null)r(f);else if(Y.startTime<=N)r(f),Y.sortIndex=Y.expirationTime,e(u,Y);else break;Y=t(f)}}function L(N){if(w=!1,P(N),!x)if(t(u)!==null)x=!0,U(I);else{var Y=t(f);Y!==null&&H(L,Y.startTime-N)}}function I(N,Y){x=!1,w&&(w=!1,E(q),q=-1),v=!0;var k=m;try{for(P(Y),p=t(u);p!==null&&(!(p.expirationTime>Y)||N&&!he());){var b=p.callback;if(typeof b=="function"){p.callback=null,m=p.priorityLevel;var O=b(p.expirationTime<=Y);Y=n.unstable_now(),typeof O=="function"?p.callback=O:p===t(u)&&r(u),P(Y)}else r(u);p=t(u)}if(p!==null)var W=!0;else{var K=t(f);K!==null&&H(L,K.startTime-Y),W=!1}return W}finally{p=null,m=k,v=!1}}var F=!1,j=null,q=-1,Q=5,le=-1;function he(){return!(n.unstable_now()-le<Q)}function pe(){if(j!==null){var N=n.unstable_now();le=N;var Y=!0;try{Y=j(!0,N)}finally{Y?ne():(F=!1,j=null)}}else F=!1}var ne;if(typeof C=="function")ne=function(){C(pe)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,Me=ve.port2;ve.port1.onmessage=pe,ne=function(){Me.postMessage(null)}}else ne=function(){T(pe,0)};function U(N){j=N,F||(F=!0,ne())}function H(N,Y){q=T(function(){N(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(N){N.callback=null},n.unstable_continueExecution=function(){x||v||(x=!0,U(I))},n.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<N?Math.floor(1e3/N):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(N){switch(m){case 1:case 2:case 3:var Y=3;break;default:Y=m}var k=m;m=Y;try{return N()}finally{m=k}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(N,Y){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var k=m;m=N;try{return Y()}finally{m=k}},n.unstable_scheduleCallback=function(N,Y,k){var b=n.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?b+k:b):k=b,N){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=k+O,N={id:h++,callback:Y,priorityLevel:N,startTime:k,expirationTime:O,sortIndex:-1},k>b?(N.sortIndex=k,e(f,N),t(u)===null&&N===t(f)&&(w?(E(q),q=-1):w=!0,H(L,k-b))):(N.sortIndex=O,e(u,N),x||v||(x=!0,U(I))),N},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(N){var Y=m;return function(){var k=m;m=Y;try{return N.apply(this,arguments)}finally{m=k}}}}(m0)),m0}var N3;function mM(){return N3||(N3=1,g0.exports=gM()),g0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D3;function vM(){if(D3)return vr;D3=1;var n=sy(),e=mM();function t(l){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+l,d=1;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function i(l,c){o(l,c),o(l+"Capture",c)}function o(l,c){for(s[l]=c,l=0;l<c.length;l++)r.add(c[l])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function m(l){return u.call(p,l)?!0:u.call(h,l)?!1:f.test(l)?p[l]=!0:(h[l]=!0,!1)}function v(l,c,d,g){if(d!==null&&d.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return g?!1:d!==null?!d.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function x(l,c,d,g){if(c===null||typeof c>"u"||v(l,c,d,g))return!0;if(g)return!1;if(d!==null)switch(d.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function w(l,c,d,g,_,y,A){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=g,this.attributeNamespace=_,this.mustUseProperty=d,this.propertyName=l,this.type=c,this.sanitizeURL=y,this.removeEmptyString=A}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){T[l]=new w(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var c=l[0];T[c]=new w(c,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){T[l]=new w(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){T[l]=new w(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){T[l]=new w(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){T[l]=new w(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){T[l]=new w(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){T[l]=new w(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){T[l]=new w(l,5,!1,l.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function C(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var c=l.replace(E,C);T[c]=new w(c,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var c=l.replace(E,C);T[c]=new w(c,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var c=l.replace(E,C);T[c]=new w(c,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){T[l]=new w(l,1,!1,l.toLowerCase(),null,!1,!1)}),T.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){T[l]=new w(l,1,!1,l.toLowerCase(),null,!0,!0)});function P(l,c,d,g){var _=T.hasOwnProperty(c)?T[c]:null;(_!==null?_.type!==0:g||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(x(c,d,_,g)&&(d=null),g||_===null?m(c)&&(d===null?l.removeAttribute(c):l.setAttribute(c,""+d)):_.mustUseProperty?l[_.propertyName]=d===null?_.type===3?!1:"":d:(c=_.attributeName,g=_.attributeNamespace,d===null?l.removeAttribute(c):(_=_.type,d=_===3||_===4&&d===!0?"":""+d,g?l.setAttributeNS(g,c,d):l.setAttribute(c,d))))}var L=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=Symbol.for("react.element"),F=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),le=Symbol.for("react.provider"),he=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),ne=Symbol.for("react.suspense"),ve=Symbol.for("react.suspense_list"),Me=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),H=Symbol.for("react.offscreen"),N=Symbol.iterator;function Y(l){return l===null||typeof l!="object"?null:(l=N&&l[N]||l["@@iterator"],typeof l=="function"?l:null)}var k=Object.assign,b;function O(l){if(b===void 0)try{throw Error()}catch(d){var c=d.stack.trim().match(/\n( *(at )?)/);b=c&&c[1]||""}return`
`+b+l}var W=!1;function K(l,c){if(!l||W)return"";W=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(fe){var g=fe}Reflect.construct(l,[],c)}else{try{c.call()}catch(fe){g=fe}l.call(c.prototype)}else{try{throw Error()}catch(fe){g=fe}l()}}catch(fe){if(fe&&g&&typeof fe.stack=="string"){for(var _=fe.stack.split(`
`),y=g.stack.split(`
`),A=_.length-1,z=y.length-1;1<=A&&0<=z&&_[A]!==y[z];)z--;for(;1<=A&&0<=z;A--,z--)if(_[A]!==y[z]){if(A!==1||z!==1)do if(A--,z--,0>z||_[A]!==y[z]){var X=`
`+_[A].replace(" at new "," at ");return l.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",l.displayName)),X}while(1<=A&&0<=z);break}}}finally{W=!1,Error.prepareStackTrace=d}return(l=l?l.displayName||l.name:"")?O(l):""}function ee(l){switch(l.tag){case 5:return O(l.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return l=K(l.type,!1),l;case 11:return l=K(l.type.render,!1),l;case 1:return l=K(l.type,!0),l;default:return""}}function te(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case j:return"Fragment";case F:return"Portal";case Q:return"Profiler";case q:return"StrictMode";case ne:return"Suspense";case ve:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case he:return(l.displayName||"Context")+".Consumer";case le:return(l._context.displayName||"Context")+".Provider";case pe:var c=l.render;return l=l.displayName,l||(l=c.displayName||c.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case Me:return c=l.displayName||null,c!==null?c:te(l.type)||"Memo";case U:c=l._payload,l=l._init;try{return te(l(c))}catch{}}return null}function ce(l){var c=l.type;switch(l.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=c.render,l=l.displayName||l.name||"",c.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return te(c);case 8:return c===q?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function me(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function xe(l){var c=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Pe(l){var c=xe(l)?"checked":"value",d=Object.getOwnPropertyDescriptor(l.constructor.prototype,c),g=""+l[c];if(!l.hasOwnProperty(c)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var _=d.get,y=d.set;return Object.defineProperty(l,c,{configurable:!0,get:function(){return _.call(this)},set:function(A){g=""+A,y.call(this,A)}}),Object.defineProperty(l,c,{enumerable:d.enumerable}),{getValue:function(){return g},setValue:function(A){g=""+A},stopTracking:function(){l._valueTracker=null,delete l[c]}}}}function Ue(l){l._valueTracker||(l._valueTracker=Pe(l))}function Ke(l){if(!l)return!1;var c=l._valueTracker;if(!c)return!0;var d=c.getValue(),g="";return l&&(g=xe(l)?l.checked?"true":"false":l.value),l=g,l!==d?(c.setValue(l),!0):!1}function tt(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function Qe(l,c){var d=c.checked;return k({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??l._wrapperState.initialChecked})}function He(l,c){var d=c.defaultValue==null?"":c.defaultValue,g=c.checked!=null?c.checked:c.defaultChecked;d=me(c.value!=null?c.value:d),l._wrapperState={initialChecked:g,initialValue:d,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function Ie(l,c){c=c.checked,c!=null&&P(l,"checked",c,!1)}function lt(l,c){Ie(l,c);var d=me(c.value),g=c.type;if(d!=null)g==="number"?(d===0&&l.value===""||l.value!=d)&&(l.value=""+d):l.value!==""+d&&(l.value=""+d);else if(g==="submit"||g==="reset"){l.removeAttribute("value");return}c.hasOwnProperty("value")?Vt(l,c.type,d):c.hasOwnProperty("defaultValue")&&Vt(l,c.type,me(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(l.defaultChecked=!!c.defaultChecked)}function _n(l,c,d){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var g=c.type;if(!(g!=="submit"&&g!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+l._wrapperState.initialValue,d||c===l.value||(l.value=c),l.defaultValue=c}d=l.name,d!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,d!==""&&(l.name=d)}function Vt(l,c,d){(c!=="number"||tt(l.ownerDocument)!==l)&&(d==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+d&&(l.defaultValue=""+d))}var It=Array.isArray;function ht(l,c,d,g){if(l=l.options,c){c={};for(var _=0;_<d.length;_++)c["$"+d[_]]=!0;for(d=0;d<l.length;d++)_=c.hasOwnProperty("$"+l[d].value),l[d].selected!==_&&(l[d].selected=_),_&&g&&(l[d].defaultSelected=!0)}else{for(d=""+me(d),c=null,_=0;_<l.length;_++){if(l[_].value===d){l[_].selected=!0,g&&(l[_].defaultSelected=!0);return}c!==null||l[_].disabled||(c=l[_])}c!==null&&(c.selected=!0)}}function ot(l,c){if(c.dangerouslySetInnerHTML!=null)throw Error(t(91));return k({},c,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function Pt(l,c){var d=c.value;if(d==null){if(d=c.children,c=c.defaultValue,d!=null){if(c!=null)throw Error(t(92));if(It(d)){if(1<d.length)throw Error(t(93));d=d[0]}c=d}c==null&&(c=""),d=c}l._wrapperState={initialValue:me(d)}}function Ft(l,c){var d=me(c.value),g=me(c.defaultValue);d!=null&&(d=""+d,d!==l.value&&(l.value=d),c.defaultValue==null&&l.defaultValue!==d&&(l.defaultValue=d)),g!=null&&(l.defaultValue=""+g)}function An(l){var c=l.textContent;c===l._wrapperState.initialValue&&c!==""&&c!==null&&(l.value=c)}function yn(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nr(l,c){return l==null||l==="http://www.w3.org/1999/xhtml"?yn(c):l==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var Kt,gt=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,d,g,_){MSApp.execUnsafeLocalFunction(function(){return l(c,d,g,_)})}:l}(function(l,c){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=c;else{for(Kt=Kt||document.createElement("div"),Kt.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=Kt.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;c.firstChild;)l.appendChild(c.firstChild)}});function On(l,c){if(c){var d=l.firstChild;if(d&&d===l.lastChild&&d.nodeType===3){d.nodeValue=c;return}}l.textContent=c}var Bt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xr=["Webkit","ms","Moz","O"];Object.keys(Bt).forEach(function(l){xr.forEach(function(c){c=c+l.charAt(0).toUpperCase()+l.substring(1),Bt[c]=Bt[l]})});function ir(l,c,d){return c==null||typeof c=="boolean"||c===""?"":d||typeof c!="number"||c===0||Bt.hasOwnProperty(l)&&Bt[l]?(""+c).trim():c+"px"}function mi(l,c){l=l.style;for(var d in c)if(c.hasOwnProperty(d)){var g=d.indexOf("--")===0,_=ir(d,c[d],g);d==="float"&&(d="cssFloat"),g?l.setProperty(d,_):l[d]=_}}var Co=k({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $s(l,c){if(c){if(Co[l]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(t(137,l));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(t(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(t(61))}if(c.style!=null&&typeof c.style!="object")throw Error(t(62))}}function Ze(l,c){if(l.indexOf("-")===-1)return typeof c.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rn=null;function js(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Gr=null,xn=null,or=null;function ar(l){if(l=Cc(l)){if(typeof Gr!="function")throw Error(t(280));var c=l.stateNode;c&&(c=zf(c),Gr(l.stateNode,l.type,c))}}function Dr(l){xn?or?or.push(l):or=[l]:xn=l}function vi(){if(xn){var l=xn,c=or;if(or=xn=null,ar(l),c)for(l=0;l<c.length;l++)ar(c[l])}}function ka(l,c){return l(c)}function _i(){}var Po=!1;function Oa(l,c,d){if(Po)return l(c,d);Po=!0;try{return ka(l,c,d)}finally{Po=!1,(xn!==null||or!==null)&&(_i(),vi())}}function ze(l,c){var d=l.stateNode;if(d===null)return null;var g=zf(d);if(g===null)return null;d=g[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(l=l.type,g=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!g;break e;default:l=!1}if(l)return null;if(d&&typeof d!="function")throw Error(t(231,c,typeof d));return d}var Xe=!1;if(a)try{var At={};Object.defineProperty(At,"passive",{get:function(){Xe=!0}}),window.addEventListener("test",At,At),window.removeEventListener("test",At,At)}catch{Xe=!1}function Ht(l,c,d,g,_,y,A,z,X){var fe=Array.prototype.slice.call(arguments,3);try{c.apply(d,fe)}catch(we){this.onError(we)}}var dt=!1,wn=null,bt=!1,ys=null,xs={onError:function(l){dt=!0,wn=l}};function yi(l,c,d,g,_,y,A,z,X){dt=!1,wn=null,Ht.apply(xs,arguments)}function xi(l,c,d,g,_,y,A,z,X){if(yi.apply(this,arguments),dt){if(dt){var fe=wn;dt=!1,wn=null}else throw Error(t(198));bt||(bt=!0,ys=fe)}}function Lr(l){var c=l,d=l;if(l.alternate)for(;c.return;)c=c.return;else{l=c;do c=l,(c.flags&4098)!==0&&(d=c.return),l=c.return;while(l)}return c.tag===3?d:null}function Io(l){if(l.tag===13){var c=l.memoizedState;if(c===null&&(l=l.alternate,l!==null&&(c=l.memoizedState)),c!==null)return c.dehydrated}return null}function Fr(l){if(Lr(l)!==l)throw Error(t(188))}function Jt(l){var c=l.alternate;if(!c){if(c=Lr(l),c===null)throw Error(t(188));return c!==l?null:l}for(var d=l,g=c;;){var _=d.return;if(_===null)break;var y=_.alternate;if(y===null){if(g=_.return,g!==null){d=g;continue}break}if(_.child===y.child){for(y=_.child;y;){if(y===d)return Fr(_),l;if(y===g)return Fr(_),c;y=y.sibling}throw Error(t(188))}if(d.return!==g.return)d=_,g=y;else{for(var A=!1,z=_.child;z;){if(z===d){A=!0,d=_,g=y;break}if(z===g){A=!0,g=_,d=y;break}z=z.sibling}if(!A){for(z=y.child;z;){if(z===d){A=!0,d=y,g=_;break}if(z===g){A=!0,g=y,d=_;break}z=z.sibling}if(!A)throw Error(t(189))}}if(d.alternate!==g)throw Error(t(190))}if(d.tag!==3)throw Error(t(188));return d.stateNode.current===d?l:c}function Jr(l){return l=Jt(l),l!==null?ws(l):null}function ws(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var c=ws(l);if(c!==null)return c;l=l.sibling}return null}var lr=e.unstable_scheduleCallback,wi=e.unstable_cancelCallback,uc=e.unstable_shouldYield,fg=e.unstable_requestPaint,zt=e.unstable_now,cr=e.unstable_getCurrentPriorityLevel,bs=e.unstable_ImmediatePriority,es=e.unstable_UserBlockingPriority,ur=e.unstable_NormalPriority,Mo=e.unstable_LowPriority,wr=e.unstable_IdlePriority,fr=null,br=null;function Af(l){if(br&&typeof br.onCommitFiberRoot=="function")try{br.onCommitFiberRoot(fr,l,void 0,(l.current.flags&128)===128)}catch{}}var Vn=Math.clz32?Math.clz32:fc,Tr=Math.log,Na=Math.LN2;function fc(l){return l>>>=0,l===0?32:31-(Tr(l)/Na|0)|0}var bi=64,Ti=4194304;function Ws(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function Hs(l,c){var d=l.pendingLanes;if(d===0)return 0;var g=0,_=l.suspendedLanes,y=l.pingedLanes,A=d&268435455;if(A!==0){var z=A&~_;z!==0?g=Ws(z):(y&=A,y!==0&&(g=Ws(y)))}else A=d&~_,A!==0?g=Ws(A):y!==0&&(g=Ws(y));if(g===0)return 0;if(c!==0&&c!==g&&(c&_)===0&&(_=g&-g,y=c&-c,_>=y||_===16&&(y&4194240)!==0))return c;if((g&4)!==0&&(g|=d&16),c=l.entangledLanes,c!==0)for(l=l.entanglements,c&=g;0<c;)d=31-Vn(c),_=1<<d,g|=l[d],c&=~_;return g}function Ts(l,c){switch(l){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hg(l,c){for(var d=l.suspendedLanes,g=l.pingedLanes,_=l.expirationTimes,y=l.pendingLanes;0<y;){var A=31-Vn(y),z=1<<A,X=_[A];X===-1?((z&d)===0||(z&g)!==0)&&(_[A]=Ts(z,c)):X<=c&&(l.expiredLanes|=z),y&=~z}}function Da(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function La(){var l=bi;return bi<<=1,(bi&4194240)===0&&(bi=64),l}function Fa(l){for(var c=[],d=0;31>d;d++)c.push(l);return c}function ko(l,c,d){l.pendingLanes|=c,c!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,c=31-Vn(c),l[c]=d}function dg(l,c){var d=l.pendingLanes&~c;l.pendingLanes=c,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=c,l.mutableReadLanes&=c,l.entangledLanes&=c,c=l.entanglements;var g=l.eventTimes;for(l=l.expirationTimes;0<d;){var _=31-Vn(d),y=1<<_;c[_]=0,g[_]=-1,l[_]=-1,d&=~y}}function R(l,c){var d=l.entangledLanes|=c;for(l=l.entanglements;d;){var g=31-Vn(d),_=1<<g;_&c|l[g]&c&&(l[g]|=c),d&=~_}}var M=0;function $(l){return l&=-l,1<l?4<l?(l&268435455)!==0?16:536870912:4:1}var ue,ye,Ne,at,fn,hn=!1,pn=[],bn=null,Si=null,Ei=null,hc=new Map,dc=new Map,Ai=[],rC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function B1(l,c){switch(l){case"focusin":case"focusout":bn=null;break;case"dragenter":case"dragleave":Si=null;break;case"mouseover":case"mouseout":Ei=null;break;case"pointerover":case"pointerout":hc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":dc.delete(c.pointerId)}}function pc(l,c,d,g,_,y){return l===null||l.nativeEvent!==y?(l={blockedOn:c,domEventName:d,eventSystemFlags:g,nativeEvent:y,targetContainers:[_]},c!==null&&(c=Cc(c),c!==null&&ye(c)),l):(l.eventSystemFlags|=g,c=l.targetContainers,_!==null&&c.indexOf(_)===-1&&c.push(_),l)}function sC(l,c,d,g,_){switch(c){case"focusin":return bn=pc(bn,l,c,d,g,_),!0;case"dragenter":return Si=pc(Si,l,c,d,g,_),!0;case"mouseover":return Ei=pc(Ei,l,c,d,g,_),!0;case"pointerover":var y=_.pointerId;return hc.set(y,pc(hc.get(y)||null,l,c,d,g,_)),!0;case"gotpointercapture":return y=_.pointerId,dc.set(y,pc(dc.get(y)||null,l,c,d,g,_)),!0}return!1}function U1(l){var c=Oo(l.target);if(c!==null){var d=Lr(c);if(d!==null){if(c=d.tag,c===13){if(c=Io(d),c!==null){l.blockedOn=c,fn(l.priority,function(){Ne(d)});return}}else if(c===3&&d.stateNode.current.memoizedState.isDehydrated){l.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Rf(l){if(l.blockedOn!==null)return!1;for(var c=l.targetContainers;0<c.length;){var d=gg(l.domEventName,l.eventSystemFlags,c[0],l.nativeEvent);if(d===null){d=l.nativeEvent;var g=new d.constructor(d.type,d);Rn=g,d.target.dispatchEvent(g),Rn=null}else return c=Cc(d),c!==null&&ye(c),l.blockedOn=d,!1;c.shift()}return!0}function V1(l,c,d){Rf(l)&&d.delete(c)}function iC(){hn=!1,bn!==null&&Rf(bn)&&(bn=null),Si!==null&&Rf(Si)&&(Si=null),Ei!==null&&Rf(Ei)&&(Ei=null),hc.forEach(V1),dc.forEach(V1)}function gc(l,c){l.blockedOn===c&&(l.blockedOn=null,hn||(hn=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,iC)))}function mc(l){function c(_){return gc(_,l)}if(0<pn.length){gc(pn[0],l);for(var d=1;d<pn.length;d++){var g=pn[d];g.blockedOn===l&&(g.blockedOn=null)}}for(bn!==null&&gc(bn,l),Si!==null&&gc(Si,l),Ei!==null&&gc(Ei,l),hc.forEach(c),dc.forEach(c),d=0;d<Ai.length;d++)g=Ai[d],g.blockedOn===l&&(g.blockedOn=null);for(;0<Ai.length&&(d=Ai[0],d.blockedOn===null);)U1(d),d.blockedOn===null&&Ai.shift()}var Ba=L.ReactCurrentBatchConfig,Cf=!0;function oC(l,c,d,g){var _=M,y=Ba.transition;Ba.transition=null;try{M=1,pg(l,c,d,g)}finally{M=_,Ba.transition=y}}function aC(l,c,d,g){var _=M,y=Ba.transition;Ba.transition=null;try{M=4,pg(l,c,d,g)}finally{M=_,Ba.transition=y}}function pg(l,c,d,g){if(Cf){var _=gg(l,c,d,g);if(_===null)kg(l,c,g,Pf,d),B1(l,g);else if(sC(_,l,c,d,g))g.stopPropagation();else if(B1(l,g),c&4&&-1<rC.indexOf(l)){for(;_!==null;){var y=Cc(_);if(y!==null&&ue(y),y=gg(l,c,d,g),y===null&&kg(l,c,g,Pf,d),y===_)break;_=y}_!==null&&g.stopPropagation()}else kg(l,c,g,null,d)}}var Pf=null;function gg(l,c,d,g){if(Pf=null,l=js(g),l=Oo(l),l!==null)if(c=Lr(l),c===null)l=null;else if(d=c.tag,d===13){if(l=Io(c),l!==null)return l;l=null}else if(d===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;l=null}else c!==l&&(l=null);return Pf=l,null}function z1(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cr()){case bs:return 1;case es:return 4;case ur:case Mo:return 16;case wr:return 536870912;default:return 16}default:return 16}}var Ri=null,mg=null,If=null;function $1(){if(If)return If;var l,c=mg,d=c.length,g,_="value"in Ri?Ri.value:Ri.textContent,y=_.length;for(l=0;l<d&&c[l]===_[l];l++);var A=d-l;for(g=1;g<=A&&c[d-g]===_[y-g];g++);return If=_.slice(l,1<g?1-g:void 0)}function Mf(l){var c=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&c===13&&(l=13)):l=c,l===10&&(l=13),32<=l||l===13?l:0}function kf(){return!0}function j1(){return!1}function Sr(l){function c(d,g,_,y,A){this._reactName=d,this._targetInst=_,this.type=g,this.nativeEvent=y,this.target=A,this.currentTarget=null;for(var z in l)l.hasOwnProperty(z)&&(d=l[z],this[z]=d?d(y):y[z]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?kf:j1,this.isPropagationStopped=j1,this}return k(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=kf)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=kf)},persist:function(){},isPersistent:kf}),c}var Ua={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vg=Sr(Ua),vc=k({},Ua,{view:0,detail:0}),lC=Sr(vc),_g,yg,_c,Of=k({},vc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wg,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==_c&&(_c&&l.type==="mousemove"?(_g=l.screenX-_c.screenX,yg=l.screenY-_c.screenY):yg=_g=0,_c=l),_g)},movementY:function(l){return"movementY"in l?l.movementY:yg}}),W1=Sr(Of),cC=k({},Of,{dataTransfer:0}),uC=Sr(cC),fC=k({},vc,{relatedTarget:0}),xg=Sr(fC),hC=k({},Ua,{animationName:0,elapsedTime:0,pseudoElement:0}),dC=Sr(hC),pC=k({},Ua,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),gC=Sr(pC),mC=k({},Ua,{data:0}),H1=Sr(mC),vC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_C={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xC(l){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(l):(l=yC[l])?!!c[l]:!1}function wg(){return xC}var wC=k({},vc,{key:function(l){if(l.key){var c=vC[l.key]||l.key;if(c!=="Unidentified")return c}return l.type==="keypress"?(l=Mf(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?_C[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wg,charCode:function(l){return l.type==="keypress"?Mf(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Mf(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),bC=Sr(wC),TC=k({},Of,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),X1=Sr(TC),SC=k({},vc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wg}),EC=Sr(SC),AC=k({},Ua,{propertyName:0,elapsedTime:0,pseudoElement:0}),RC=Sr(AC),CC=k({},Of,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),PC=Sr(CC),IC=[9,13,27,32],bg=a&&"CompositionEvent"in window,yc=null;a&&"documentMode"in document&&(yc=document.documentMode);var MC=a&&"TextEvent"in window&&!yc,Y1=a&&(!bg||yc&&8<yc&&11>=yc),q1=" ",K1=!1;function Z1(l,c){switch(l){case"keyup":return IC.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Q1(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Va=!1;function kC(l,c){switch(l){case"compositionend":return Q1(c);case"keypress":return c.which!==32?null:(K1=!0,q1);case"textInput":return l=c.data,l===q1&&K1?null:l;default:return null}}function OC(l,c){if(Va)return l==="compositionend"||!bg&&Z1(l,c)?(l=$1(),If=mg=Ri=null,Va=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Y1&&c.locale!=="ko"?null:c.data;default:return null}}var NC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function G1(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c==="input"?!!NC[l.type]:c==="textarea"}function J1(l,c,d,g){Dr(g),c=Bf(c,"onChange"),0<c.length&&(d=new vg("onChange","change",null,d,g),l.push({event:d,listeners:c}))}var xc=null,wc=null;function DC(l){vx(l,0)}function Nf(l){var c=Ha(l);if(Ke(c))return l}function LC(l,c){if(l==="change")return c}var ex=!1;if(a){var Tg;if(a){var Sg="oninput"in document;if(!Sg){var tx=document.createElement("div");tx.setAttribute("oninput","return;"),Sg=typeof tx.oninput=="function"}Tg=Sg}else Tg=!1;ex=Tg&&(!document.documentMode||9<document.documentMode)}function nx(){xc&&(xc.detachEvent("onpropertychange",rx),wc=xc=null)}function rx(l){if(l.propertyName==="value"&&Nf(wc)){var c=[];J1(c,wc,l,js(l)),Oa(DC,c)}}function FC(l,c,d){l==="focusin"?(nx(),xc=c,wc=d,xc.attachEvent("onpropertychange",rx)):l==="focusout"&&nx()}function BC(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Nf(wc)}function UC(l,c){if(l==="click")return Nf(c)}function VC(l,c){if(l==="input"||l==="change")return Nf(c)}function zC(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var ts=typeof Object.is=="function"?Object.is:zC;function bc(l,c){if(ts(l,c))return!0;if(typeof l!="object"||l===null||typeof c!="object"||c===null)return!1;var d=Object.keys(l),g=Object.keys(c);if(d.length!==g.length)return!1;for(g=0;g<d.length;g++){var _=d[g];if(!u.call(c,_)||!ts(l[_],c[_]))return!1}return!0}function sx(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function ix(l,c){var d=sx(l);l=0;for(var g;d;){if(d.nodeType===3){if(g=l+d.textContent.length,l<=c&&g>=c)return{node:d,offset:c-l};l=g}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=sx(d)}}function ox(l,c){return l&&c?l===c?!0:l&&l.nodeType===3?!1:c&&c.nodeType===3?ox(l,c.parentNode):"contains"in l?l.contains(c):l.compareDocumentPosition?!!(l.compareDocumentPosition(c)&16):!1:!1}function ax(){for(var l=window,c=tt();c instanceof l.HTMLIFrameElement;){try{var d=typeof c.contentWindow.location.href=="string"}catch{d=!1}if(d)l=c.contentWindow;else break;c=tt(l.document)}return c}function Eg(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c&&(c==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||c==="textarea"||l.contentEditable==="true")}function $C(l){var c=ax(),d=l.focusedElem,g=l.selectionRange;if(c!==d&&d&&d.ownerDocument&&ox(d.ownerDocument.documentElement,d)){if(g!==null&&Eg(d)){if(c=g.start,l=g.end,l===void 0&&(l=c),"selectionStart"in d)d.selectionStart=c,d.selectionEnd=Math.min(l,d.value.length);else if(l=(c=d.ownerDocument||document)&&c.defaultView||window,l.getSelection){l=l.getSelection();var _=d.textContent.length,y=Math.min(g.start,_);g=g.end===void 0?y:Math.min(g.end,_),!l.extend&&y>g&&(_=g,g=y,y=_),_=ix(d,y);var A=ix(d,g);_&&A&&(l.rangeCount!==1||l.anchorNode!==_.node||l.anchorOffset!==_.offset||l.focusNode!==A.node||l.focusOffset!==A.offset)&&(c=c.createRange(),c.setStart(_.node,_.offset),l.removeAllRanges(),y>g?(l.addRange(c),l.extend(A.node,A.offset)):(c.setEnd(A.node,A.offset),l.addRange(c)))}}for(c=[],l=d;l=l.parentNode;)l.nodeType===1&&c.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<c.length;d++)l=c[d],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var jC=a&&"documentMode"in document&&11>=document.documentMode,za=null,Ag=null,Tc=null,Rg=!1;function lx(l,c,d){var g=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Rg||za==null||za!==tt(g)||(g=za,"selectionStart"in g&&Eg(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Tc&&bc(Tc,g)||(Tc=g,g=Bf(Ag,"onSelect"),0<g.length&&(c=new vg("onSelect","select",null,c,d),l.push({event:c,listeners:g}),c.target=za)))}function Df(l,c){var d={};return d[l.toLowerCase()]=c.toLowerCase(),d["Webkit"+l]="webkit"+c,d["Moz"+l]="moz"+c,d}var $a={animationend:Df("Animation","AnimationEnd"),animationiteration:Df("Animation","AnimationIteration"),animationstart:Df("Animation","AnimationStart"),transitionend:Df("Transition","TransitionEnd")},Cg={},cx={};a&&(cx=document.createElement("div").style,"AnimationEvent"in window||(delete $a.animationend.animation,delete $a.animationiteration.animation,delete $a.animationstart.animation),"TransitionEvent"in window||delete $a.transitionend.transition);function Lf(l){if(Cg[l])return Cg[l];if(!$a[l])return l;var c=$a[l],d;for(d in c)if(c.hasOwnProperty(d)&&d in cx)return Cg[l]=c[d];return l}var ux=Lf("animationend"),fx=Lf("animationiteration"),hx=Lf("animationstart"),dx=Lf("transitionend"),px=new Map,gx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ci(l,c){px.set(l,c),i(c,[l])}for(var Pg=0;Pg<gx.length;Pg++){var Ig=gx[Pg],WC=Ig.toLowerCase(),HC=Ig[0].toUpperCase()+Ig.slice(1);Ci(WC,"on"+HC)}Ci(ux,"onAnimationEnd"),Ci(fx,"onAnimationIteration"),Ci(hx,"onAnimationStart"),Ci("dblclick","onDoubleClick"),Ci("focusin","onFocus"),Ci("focusout","onBlur"),Ci(dx,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sc));function mx(l,c,d){var g=l.type||"unknown-event";l.currentTarget=d,xi(g,c,void 0,l),l.currentTarget=null}function vx(l,c){c=(c&4)!==0;for(var d=0;d<l.length;d++){var g=l[d],_=g.event;g=g.listeners;e:{var y=void 0;if(c)for(var A=g.length-1;0<=A;A--){var z=g[A],X=z.instance,fe=z.currentTarget;if(z=z.listener,X!==y&&_.isPropagationStopped())break e;mx(_,z,fe),y=X}else for(A=0;A<g.length;A++){if(z=g[A],X=z.instance,fe=z.currentTarget,z=z.listener,X!==y&&_.isPropagationStopped())break e;mx(_,z,fe),y=X}}}if(bt)throw l=ys,bt=!1,ys=null,l}function Xt(l,c){var d=c[Bg];d===void 0&&(d=c[Bg]=new Set);var g=l+"__bubble";d.has(g)||(_x(c,l,2,!1),d.add(g))}function Mg(l,c,d){var g=0;c&&(g|=4),_x(d,l,g,c)}var Ff="_reactListening"+Math.random().toString(36).slice(2);function Ec(l){if(!l[Ff]){l[Ff]=!0,r.forEach(function(d){d!=="selectionchange"&&(XC.has(d)||Mg(d,!1,l),Mg(d,!0,l))});var c=l.nodeType===9?l:l.ownerDocument;c===null||c[Ff]||(c[Ff]=!0,Mg("selectionchange",!1,c))}}function _x(l,c,d,g){switch(z1(c)){case 1:var _=oC;break;case 4:_=aC;break;default:_=pg}d=_.bind(null,c,d,l),_=void 0,!Xe||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(_=!0),g?_!==void 0?l.addEventListener(c,d,{capture:!0,passive:_}):l.addEventListener(c,d,!0):_!==void 0?l.addEventListener(c,d,{passive:_}):l.addEventListener(c,d,!1)}function kg(l,c,d,g,_){var y=g;if((c&1)===0&&(c&2)===0&&g!==null)e:for(;;){if(g===null)return;var A=g.tag;if(A===3||A===4){var z=g.stateNode.containerInfo;if(z===_||z.nodeType===8&&z.parentNode===_)break;if(A===4)for(A=g.return;A!==null;){var X=A.tag;if((X===3||X===4)&&(X=A.stateNode.containerInfo,X===_||X.nodeType===8&&X.parentNode===_))return;A=A.return}for(;z!==null;){if(A=Oo(z),A===null)return;if(X=A.tag,X===5||X===6){g=y=A;continue e}z=z.parentNode}}g=g.return}Oa(function(){var fe=y,we=js(d),Te=[];e:{var _e=px.get(l);if(_e!==void 0){var De=vg,Ve=l;switch(l){case"keypress":if(Mf(d)===0)break e;case"keydown":case"keyup":De=bC;break;case"focusin":Ve="focus",De=xg;break;case"focusout":Ve="blur",De=xg;break;case"beforeblur":case"afterblur":De=xg;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=W1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=uC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=EC;break;case ux:case fx:case hx:De=dC;break;case dx:De=RC;break;case"scroll":De=lC;break;case"wheel":De=PC;break;case"copy":case"cut":case"paste":De=gC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=X1}var $e=(c&4)!==0,dn=!$e&&l==="scroll",ie=$e?_e!==null?_e+"Capture":null:_e;$e=[];for(var Z=fe,ae;Z!==null;){ae=Z;var Re=ae.stateNode;if(ae.tag===5&&Re!==null&&(ae=Re,ie!==null&&(Re=ze(Z,ie),Re!=null&&$e.push(Ac(Z,Re,ae)))),dn)break;Z=Z.return}0<$e.length&&(_e=new De(_e,Ve,null,d,we),Te.push({event:_e,listeners:$e}))}}if((c&7)===0){e:{if(_e=l==="mouseover"||l==="pointerover",De=l==="mouseout"||l==="pointerout",_e&&d!==Rn&&(Ve=d.relatedTarget||d.fromElement)&&(Oo(Ve)||Ve[Xs]))break e;if((De||_e)&&(_e=we.window===we?we:(_e=we.ownerDocument)?_e.defaultView||_e.parentWindow:window,De?(Ve=d.relatedTarget||d.toElement,De=fe,Ve=Ve?Oo(Ve):null,Ve!==null&&(dn=Lr(Ve),Ve!==dn||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(De=null,Ve=fe),De!==Ve)){if($e=W1,Re="onMouseLeave",ie="onMouseEnter",Z="mouse",(l==="pointerout"||l==="pointerover")&&($e=X1,Re="onPointerLeave",ie="onPointerEnter",Z="pointer"),dn=De==null?_e:Ha(De),ae=Ve==null?_e:Ha(Ve),_e=new $e(Re,Z+"leave",De,d,we),_e.target=dn,_e.relatedTarget=ae,Re=null,Oo(we)===fe&&($e=new $e(ie,Z+"enter",Ve,d,we),$e.target=ae,$e.relatedTarget=dn,Re=$e),dn=Re,De&&Ve)t:{for($e=De,ie=Ve,Z=0,ae=$e;ae;ae=ja(ae))Z++;for(ae=0,Re=ie;Re;Re=ja(Re))ae++;for(;0<Z-ae;)$e=ja($e),Z--;for(;0<ae-Z;)ie=ja(ie),ae--;for(;Z--;){if($e===ie||ie!==null&&$e===ie.alternate)break t;$e=ja($e),ie=ja(ie)}$e=null}else $e=null;De!==null&&yx(Te,_e,De,$e,!1),Ve!==null&&dn!==null&&yx(Te,dn,Ve,$e,!0)}}e:{if(_e=fe?Ha(fe):window,De=_e.nodeName&&_e.nodeName.toLowerCase(),De==="select"||De==="input"&&_e.type==="file")var je=LC;else if(G1(_e))if(ex)je=VC;else{je=BC;var Ye=FC}else(De=_e.nodeName)&&De.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(je=UC);if(je&&(je=je(l,fe))){J1(Te,je,d,we);break e}Ye&&Ye(l,_e,fe),l==="focusout"&&(Ye=_e._wrapperState)&&Ye.controlled&&_e.type==="number"&&Vt(_e,"number",_e.value)}switch(Ye=fe?Ha(fe):window,l){case"focusin":(G1(Ye)||Ye.contentEditable==="true")&&(za=Ye,Ag=fe,Tc=null);break;case"focusout":Tc=Ag=za=null;break;case"mousedown":Rg=!0;break;case"contextmenu":case"mouseup":case"dragend":Rg=!1,lx(Te,d,we);break;case"selectionchange":if(jC)break;case"keydown":case"keyup":lx(Te,d,we)}var qe;if(bg)e:{switch(l){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Va?Z1(l,d)&&(Je="onCompositionEnd"):l==="keydown"&&d.keyCode===229&&(Je="onCompositionStart");Je&&(Y1&&d.locale!=="ko"&&(Va||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Va&&(qe=$1()):(Ri=we,mg="value"in Ri?Ri.value:Ri.textContent,Va=!0)),Ye=Bf(fe,Je),0<Ye.length&&(Je=new H1(Je,l,null,d,we),Te.push({event:Je,listeners:Ye}),qe?Je.data=qe:(qe=Q1(d),qe!==null&&(Je.data=qe)))),(qe=MC?kC(l,d):OC(l,d))&&(fe=Bf(fe,"onBeforeInput"),0<fe.length&&(we=new H1("onBeforeInput","beforeinput",null,d,we),Te.push({event:we,listeners:fe}),we.data=qe))}vx(Te,c)})}function Ac(l,c,d){return{instance:l,listener:c,currentTarget:d}}function Bf(l,c){for(var d=c+"Capture",g=[];l!==null;){var _=l,y=_.stateNode;_.tag===5&&y!==null&&(_=y,y=ze(l,d),y!=null&&g.unshift(Ac(l,y,_)),y=ze(l,c),y!=null&&g.push(Ac(l,y,_))),l=l.return}return g}function ja(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function yx(l,c,d,g,_){for(var y=c._reactName,A=[];d!==null&&d!==g;){var z=d,X=z.alternate,fe=z.stateNode;if(X!==null&&X===g)break;z.tag===5&&fe!==null&&(z=fe,_?(X=ze(d,y),X!=null&&A.unshift(Ac(d,X,z))):_||(X=ze(d,y),X!=null&&A.push(Ac(d,X,z)))),d=d.return}A.length!==0&&l.push({event:c,listeners:A})}var YC=/\r\n?/g,qC=/\u0000|\uFFFD/g;function xx(l){return(typeof l=="string"?l:""+l).replace(YC,`
`).replace(qC,"")}function Uf(l,c,d){if(c=xx(c),xx(l)!==c&&d)throw Error(t(425))}function Vf(){}var Og=null,Ng=null;function Dg(l,c){return l==="textarea"||l==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Lg=typeof setTimeout=="function"?setTimeout:void 0,KC=typeof clearTimeout=="function"?clearTimeout:void 0,wx=typeof Promise=="function"?Promise:void 0,ZC=typeof queueMicrotask=="function"?queueMicrotask:typeof wx<"u"?function(l){return wx.resolve(null).then(l).catch(QC)}:Lg;function QC(l){setTimeout(function(){throw l})}function Fg(l,c){var d=c,g=0;do{var _=d.nextSibling;if(l.removeChild(d),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(g===0){l.removeChild(_),mc(c);return}g--}else d!=="$"&&d!=="$?"&&d!=="$!"||g++;d=_}while(d);mc(c)}function Pi(l){for(;l!=null;l=l.nextSibling){var c=l.nodeType;if(c===1||c===3)break;if(c===8){if(c=l.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return l}function bx(l){l=l.previousSibling;for(var c=0;l;){if(l.nodeType===8){var d=l.data;if(d==="$"||d==="$!"||d==="$?"){if(c===0)return l;c--}else d==="/$"&&c++}l=l.previousSibling}return null}var Wa=Math.random().toString(36).slice(2),Ss="__reactFiber$"+Wa,Rc="__reactProps$"+Wa,Xs="__reactContainer$"+Wa,Bg="__reactEvents$"+Wa,GC="__reactListeners$"+Wa,JC="__reactHandles$"+Wa;function Oo(l){var c=l[Ss];if(c)return c;for(var d=l.parentNode;d;){if(c=d[Xs]||d[Ss]){if(d=c.alternate,c.child!==null||d!==null&&d.child!==null)for(l=bx(l);l!==null;){if(d=l[Ss])return d;l=bx(l)}return c}l=d,d=l.parentNode}return null}function Cc(l){return l=l[Ss]||l[Xs],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Ha(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(t(33))}function zf(l){return l[Rc]||null}var Ug=[],Xa=-1;function Ii(l){return{current:l}}function Yt(l){0>Xa||(l.current=Ug[Xa],Ug[Xa]=null,Xa--)}function $t(l,c){Xa++,Ug[Xa]=l.current,l.current=c}var Mi={},zn=Ii(Mi),hr=Ii(!1),No=Mi;function Ya(l,c){var d=l.type.contextTypes;if(!d)return Mi;var g=l.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===c)return g.__reactInternalMemoizedMaskedChildContext;var _={},y;for(y in d)_[y]=c[y];return g&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=c,l.__reactInternalMemoizedMaskedChildContext=_),_}function dr(l){return l=l.childContextTypes,l!=null}function $f(){Yt(hr),Yt(zn)}function Tx(l,c,d){if(zn.current!==Mi)throw Error(t(168));$t(zn,c),$t(hr,d)}function Sx(l,c,d){var g=l.stateNode;if(c=c.childContextTypes,typeof g.getChildContext!="function")return d;g=g.getChildContext();for(var _ in g)if(!(_ in c))throw Error(t(108,ce(l)||"Unknown",_));return k({},d,g)}function jf(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Mi,No=zn.current,$t(zn,l),$t(hr,hr.current),!0}function Ex(l,c,d){var g=l.stateNode;if(!g)throw Error(t(169));d?(l=Sx(l,c,No),g.__reactInternalMemoizedMergedChildContext=l,Yt(hr),Yt(zn),$t(zn,l)):Yt(hr),$t(hr,d)}var Ys=null,Wf=!1,Vg=!1;function Ax(l){Ys===null?Ys=[l]:Ys.push(l)}function eP(l){Wf=!0,Ax(l)}function ki(){if(!Vg&&Ys!==null){Vg=!0;var l=0,c=M;try{var d=Ys;for(M=1;l<d.length;l++){var g=d[l];do g=g(!0);while(g!==null)}Ys=null,Wf=!1}catch(_){throw Ys!==null&&(Ys=Ys.slice(l+1)),lr(bs,ki),_}finally{M=c,Vg=!1}}return null}var qa=[],Ka=0,Hf=null,Xf=0,Br=[],Ur=0,Do=null,qs=1,Ks="";function Lo(l,c){qa[Ka++]=Xf,qa[Ka++]=Hf,Hf=l,Xf=c}function Rx(l,c,d){Br[Ur++]=qs,Br[Ur++]=Ks,Br[Ur++]=Do,Do=l;var g=qs;l=Ks;var _=32-Vn(g)-1;g&=~(1<<_),d+=1;var y=32-Vn(c)+_;if(30<y){var A=_-_%5;y=(g&(1<<A)-1).toString(32),g>>=A,_-=A,qs=1<<32-Vn(c)+_|d<<_|g,Ks=y+l}else qs=1<<y|d<<_|g,Ks=l}function zg(l){l.return!==null&&(Lo(l,1),Rx(l,1,0))}function $g(l){for(;l===Hf;)Hf=qa[--Ka],qa[Ka]=null,Xf=qa[--Ka],qa[Ka]=null;for(;l===Do;)Do=Br[--Ur],Br[Ur]=null,Ks=Br[--Ur],Br[Ur]=null,qs=Br[--Ur],Br[Ur]=null}var Er=null,Ar=null,Zt=!1,ns=null;function Cx(l,c){var d=jr(5,null,null,0);d.elementType="DELETED",d.stateNode=c,d.return=l,c=l.deletions,c===null?(l.deletions=[d],l.flags|=16):c.push(d)}function Px(l,c){switch(l.tag){case 5:var d=l.type;return c=c.nodeType!==1||d.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(l.stateNode=c,Er=l,Ar=Pi(c.firstChild),!0):!1;case 6:return c=l.pendingProps===""||c.nodeType!==3?null:c,c!==null?(l.stateNode=c,Er=l,Ar=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(d=Do!==null?{id:qs,overflow:Ks}:null,l.memoizedState={dehydrated:c,treeContext:d,retryLane:1073741824},d=jr(18,null,null,0),d.stateNode=c,d.return=l,l.child=d,Er=l,Ar=null,!0):!1;default:return!1}}function jg(l){return(l.mode&1)!==0&&(l.flags&128)===0}function Wg(l){if(Zt){var c=Ar;if(c){var d=c;if(!Px(l,c)){if(jg(l))throw Error(t(418));c=Pi(d.nextSibling);var g=Er;c&&Px(l,c)?Cx(g,d):(l.flags=l.flags&-4097|2,Zt=!1,Er=l)}}else{if(jg(l))throw Error(t(418));l.flags=l.flags&-4097|2,Zt=!1,Er=l}}}function Ix(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;Er=l}function Yf(l){if(l!==Er)return!1;if(!Zt)return Ix(l),Zt=!0,!1;var c;if((c=l.tag!==3)&&!(c=l.tag!==5)&&(c=l.type,c=c!=="head"&&c!=="body"&&!Dg(l.type,l.memoizedProps)),c&&(c=Ar)){if(jg(l))throw Mx(),Error(t(418));for(;c;)Cx(l,c),c=Pi(c.nextSibling)}if(Ix(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(t(317));e:{for(l=l.nextSibling,c=0;l;){if(l.nodeType===8){var d=l.data;if(d==="/$"){if(c===0){Ar=Pi(l.nextSibling);break e}c--}else d!=="$"&&d!=="$!"&&d!=="$?"||c++}l=l.nextSibling}Ar=null}}else Ar=Er?Pi(l.stateNode.nextSibling):null;return!0}function Mx(){for(var l=Ar;l;)l=Pi(l.nextSibling)}function Za(){Ar=Er=null,Zt=!1}function Hg(l){ns===null?ns=[l]:ns.push(l)}var tP=L.ReactCurrentBatchConfig;function Pc(l,c,d){if(l=d.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(t(309));var g=d.stateNode}if(!g)throw Error(t(147,l));var _=g,y=""+l;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===y?c.ref:(c=function(A){var z=_.refs;A===null?delete z[y]:z[y]=A},c._stringRef=y,c)}if(typeof l!="string")throw Error(t(284));if(!d._owner)throw Error(t(290,l))}return l}function qf(l,c){throw l=Object.prototype.toString.call(c),Error(t(31,l==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":l))}function kx(l){var c=l._init;return c(l._payload)}function Ox(l){function c(ie,Z){if(l){var ae=ie.deletions;ae===null?(ie.deletions=[Z],ie.flags|=16):ae.push(Z)}}function d(ie,Z){if(!l)return null;for(;Z!==null;)c(ie,Z),Z=Z.sibling;return null}function g(ie,Z){for(ie=new Map;Z!==null;)Z.key!==null?ie.set(Z.key,Z):ie.set(Z.index,Z),Z=Z.sibling;return ie}function _(ie,Z){return ie=Vi(ie,Z),ie.index=0,ie.sibling=null,ie}function y(ie,Z,ae){return ie.index=ae,l?(ae=ie.alternate,ae!==null?(ae=ae.index,ae<Z?(ie.flags|=2,Z):ae):(ie.flags|=2,Z)):(ie.flags|=1048576,Z)}function A(ie){return l&&ie.alternate===null&&(ie.flags|=2),ie}function z(ie,Z,ae,Re){return Z===null||Z.tag!==6?(Z=Lm(ae,ie.mode,Re),Z.return=ie,Z):(Z=_(Z,ae),Z.return=ie,Z)}function X(ie,Z,ae,Re){var je=ae.type;return je===j?we(ie,Z,ae.props.children,Re,ae.key):Z!==null&&(Z.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===U&&kx(je)===Z.type)?(Re=_(Z,ae.props),Re.ref=Pc(ie,Z,ae),Re.return=ie,Re):(Re=_h(ae.type,ae.key,ae.props,null,ie.mode,Re),Re.ref=Pc(ie,Z,ae),Re.return=ie,Re)}function fe(ie,Z,ae,Re){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==ae.containerInfo||Z.stateNode.implementation!==ae.implementation?(Z=Fm(ae,ie.mode,Re),Z.return=ie,Z):(Z=_(Z,ae.children||[]),Z.return=ie,Z)}function we(ie,Z,ae,Re,je){return Z===null||Z.tag!==7?(Z=Wo(ae,ie.mode,Re,je),Z.return=ie,Z):(Z=_(Z,ae),Z.return=ie,Z)}function Te(ie,Z,ae){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Z=Lm(""+Z,ie.mode,ae),Z.return=ie,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case I:return ae=_h(Z.type,Z.key,Z.props,null,ie.mode,ae),ae.ref=Pc(ie,null,Z),ae.return=ie,ae;case F:return Z=Fm(Z,ie.mode,ae),Z.return=ie,Z;case U:var Re=Z._init;return Te(ie,Re(Z._payload),ae)}if(It(Z)||Y(Z))return Z=Wo(Z,ie.mode,ae,null),Z.return=ie,Z;qf(ie,Z)}return null}function _e(ie,Z,ae,Re){var je=Z!==null?Z.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number")return je!==null?null:z(ie,Z,""+ae,Re);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case I:return ae.key===je?X(ie,Z,ae,Re):null;case F:return ae.key===je?fe(ie,Z,ae,Re):null;case U:return je=ae._init,_e(ie,Z,je(ae._payload),Re)}if(It(ae)||Y(ae))return je!==null?null:we(ie,Z,ae,Re,null);qf(ie,ae)}return null}function De(ie,Z,ae,Re,je){if(typeof Re=="string"&&Re!==""||typeof Re=="number")return ie=ie.get(ae)||null,z(Z,ie,""+Re,je);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case I:return ie=ie.get(Re.key===null?ae:Re.key)||null,X(Z,ie,Re,je);case F:return ie=ie.get(Re.key===null?ae:Re.key)||null,fe(Z,ie,Re,je);case U:var Ye=Re._init;return De(ie,Z,ae,Ye(Re._payload),je)}if(It(Re)||Y(Re))return ie=ie.get(ae)||null,we(Z,ie,Re,je,null);qf(Z,Re)}return null}function Ve(ie,Z,ae,Re){for(var je=null,Ye=null,qe=Z,Je=Z=0,In=null;qe!==null&&Je<ae.length;Je++){qe.index>Je?(In=qe,qe=null):In=qe.sibling;var yt=_e(ie,qe,ae[Je],Re);if(yt===null){qe===null&&(qe=In);break}l&&qe&&yt.alternate===null&&c(ie,qe),Z=y(yt,Z,Je),Ye===null?je=yt:Ye.sibling=yt,Ye=yt,qe=In}if(Je===ae.length)return d(ie,qe),Zt&&Lo(ie,Je),je;if(qe===null){for(;Je<ae.length;Je++)qe=Te(ie,ae[Je],Re),qe!==null&&(Z=y(qe,Z,Je),Ye===null?je=qe:Ye.sibling=qe,Ye=qe);return Zt&&Lo(ie,Je),je}for(qe=g(ie,qe);Je<ae.length;Je++)In=De(qe,ie,Je,ae[Je],Re),In!==null&&(l&&In.alternate!==null&&qe.delete(In.key===null?Je:In.key),Z=y(In,Z,Je),Ye===null?je=In:Ye.sibling=In,Ye=In);return l&&qe.forEach(function(zi){return c(ie,zi)}),Zt&&Lo(ie,Je),je}function $e(ie,Z,ae,Re){var je=Y(ae);if(typeof je!="function")throw Error(t(150));if(ae=je.call(ae),ae==null)throw Error(t(151));for(var Ye=je=null,qe=Z,Je=Z=0,In=null,yt=ae.next();qe!==null&&!yt.done;Je++,yt=ae.next()){qe.index>Je?(In=qe,qe=null):In=qe.sibling;var zi=_e(ie,qe,yt.value,Re);if(zi===null){qe===null&&(qe=In);break}l&&qe&&zi.alternate===null&&c(ie,qe),Z=y(zi,Z,Je),Ye===null?je=zi:Ye.sibling=zi,Ye=zi,qe=In}if(yt.done)return d(ie,qe),Zt&&Lo(ie,Je),je;if(qe===null){for(;!yt.done;Je++,yt=ae.next())yt=Te(ie,yt.value,Re),yt!==null&&(Z=y(yt,Z,Je),Ye===null?je=yt:Ye.sibling=yt,Ye=yt);return Zt&&Lo(ie,Je),je}for(qe=g(ie,qe);!yt.done;Je++,yt=ae.next())yt=De(qe,ie,Je,yt.value,Re),yt!==null&&(l&&yt.alternate!==null&&qe.delete(yt.key===null?Je:yt.key),Z=y(yt,Z,Je),Ye===null?je=yt:Ye.sibling=yt,Ye=yt);return l&&qe.forEach(function(NP){return c(ie,NP)}),Zt&&Lo(ie,Je),je}function dn(ie,Z,ae,Re){if(typeof ae=="object"&&ae!==null&&ae.type===j&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case I:e:{for(var je=ae.key,Ye=Z;Ye!==null;){if(Ye.key===je){if(je=ae.type,je===j){if(Ye.tag===7){d(ie,Ye.sibling),Z=_(Ye,ae.props.children),Z.return=ie,ie=Z;break e}}else if(Ye.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===U&&kx(je)===Ye.type){d(ie,Ye.sibling),Z=_(Ye,ae.props),Z.ref=Pc(ie,Ye,ae),Z.return=ie,ie=Z;break e}d(ie,Ye);break}else c(ie,Ye);Ye=Ye.sibling}ae.type===j?(Z=Wo(ae.props.children,ie.mode,Re,ae.key),Z.return=ie,ie=Z):(Re=_h(ae.type,ae.key,ae.props,null,ie.mode,Re),Re.ref=Pc(ie,Z,ae),Re.return=ie,ie=Re)}return A(ie);case F:e:{for(Ye=ae.key;Z!==null;){if(Z.key===Ye)if(Z.tag===4&&Z.stateNode.containerInfo===ae.containerInfo&&Z.stateNode.implementation===ae.implementation){d(ie,Z.sibling),Z=_(Z,ae.children||[]),Z.return=ie,ie=Z;break e}else{d(ie,Z);break}else c(ie,Z);Z=Z.sibling}Z=Fm(ae,ie.mode,Re),Z.return=ie,ie=Z}return A(ie);case U:return Ye=ae._init,dn(ie,Z,Ye(ae._payload),Re)}if(It(ae))return Ve(ie,Z,ae,Re);if(Y(ae))return $e(ie,Z,ae,Re);qf(ie,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"?(ae=""+ae,Z!==null&&Z.tag===6?(d(ie,Z.sibling),Z=_(Z,ae),Z.return=ie,ie=Z):(d(ie,Z),Z=Lm(ae,ie.mode,Re),Z.return=ie,ie=Z),A(ie)):d(ie,Z)}return dn}var Qa=Ox(!0),Nx=Ox(!1),Kf=Ii(null),Zf=null,Ga=null,Xg=null;function Yg(){Xg=Ga=Zf=null}function qg(l){var c=Kf.current;Yt(Kf),l._currentValue=c}function Kg(l,c,d){for(;l!==null;){var g=l.alternate;if((l.childLanes&c)!==c?(l.childLanes|=c,g!==null&&(g.childLanes|=c)):g!==null&&(g.childLanes&c)!==c&&(g.childLanes|=c),l===d)break;l=l.return}}function Ja(l,c){Zf=l,Xg=Ga=null,l=l.dependencies,l!==null&&l.firstContext!==null&&((l.lanes&c)!==0&&(pr=!0),l.firstContext=null)}function Vr(l){var c=l._currentValue;if(Xg!==l)if(l={context:l,memoizedValue:c,next:null},Ga===null){if(Zf===null)throw Error(t(308));Ga=l,Zf.dependencies={lanes:0,firstContext:l}}else Ga=Ga.next=l;return c}var Fo=null;function Zg(l){Fo===null?Fo=[l]:Fo.push(l)}function Dx(l,c,d,g){var _=c.interleaved;return _===null?(d.next=d,Zg(c)):(d.next=_.next,_.next=d),c.interleaved=d,Zs(l,g)}function Zs(l,c){l.lanes|=c;var d=l.alternate;for(d!==null&&(d.lanes|=c),d=l,l=l.return;l!==null;)l.childLanes|=c,d=l.alternate,d!==null&&(d.childLanes|=c),d=l,l=l.return;return d.tag===3?d.stateNode:null}var Oi=!1;function Qg(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lx(l,c){l=l.updateQueue,c.updateQueue===l&&(c.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function Qs(l,c){return{eventTime:l,lane:c,tag:0,payload:null,callback:null,next:null}}function Ni(l,c,d){var g=l.updateQueue;if(g===null)return null;if(g=g.shared,(mt&2)!==0){var _=g.pending;return _===null?c.next=c:(c.next=_.next,_.next=c),g.pending=c,Zs(l,d)}return _=g.interleaved,_===null?(c.next=c,Zg(g)):(c.next=_.next,_.next=c),g.interleaved=c,Zs(l,d)}function Qf(l,c,d){if(c=c.updateQueue,c!==null&&(c=c.shared,(d&4194240)!==0)){var g=c.lanes;g&=l.pendingLanes,d|=g,c.lanes=d,R(l,d)}}function Fx(l,c){var d=l.updateQueue,g=l.alternate;if(g!==null&&(g=g.updateQueue,d===g)){var _=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var A={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?_=y=A:y=y.next=A,d=d.next}while(d!==null);y===null?_=y=c:y=y.next=c}else _=y=c;d={baseState:g.baseState,firstBaseUpdate:_,lastBaseUpdate:y,shared:g.shared,effects:g.effects},l.updateQueue=d;return}l=d.lastBaseUpdate,l===null?d.firstBaseUpdate=c:l.next=c,d.lastBaseUpdate=c}function Gf(l,c,d,g){var _=l.updateQueue;Oi=!1;var y=_.firstBaseUpdate,A=_.lastBaseUpdate,z=_.shared.pending;if(z!==null){_.shared.pending=null;var X=z,fe=X.next;X.next=null,A===null?y=fe:A.next=fe,A=X;var we=l.alternate;we!==null&&(we=we.updateQueue,z=we.lastBaseUpdate,z!==A&&(z===null?we.firstBaseUpdate=fe:z.next=fe,we.lastBaseUpdate=X))}if(y!==null){var Te=_.baseState;A=0,we=fe=X=null,z=y;do{var _e=z.lane,De=z.eventTime;if((g&_e)===_e){we!==null&&(we=we.next={eventTime:De,lane:0,tag:z.tag,payload:z.payload,callback:z.callback,next:null});e:{var Ve=l,$e=z;switch(_e=c,De=d,$e.tag){case 1:if(Ve=$e.payload,typeof Ve=="function"){Te=Ve.call(De,Te,_e);break e}Te=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=$e.payload,_e=typeof Ve=="function"?Ve.call(De,Te,_e):Ve,_e==null)break e;Te=k({},Te,_e);break e;case 2:Oi=!0}}z.callback!==null&&z.lane!==0&&(l.flags|=64,_e=_.effects,_e===null?_.effects=[z]:_e.push(z))}else De={eventTime:De,lane:_e,tag:z.tag,payload:z.payload,callback:z.callback,next:null},we===null?(fe=we=De,X=Te):we=we.next=De,A|=_e;if(z=z.next,z===null){if(z=_.shared.pending,z===null)break;_e=z,z=_e.next,_e.next=null,_.lastBaseUpdate=_e,_.shared.pending=null}}while(!0);if(we===null&&(X=Te),_.baseState=X,_.firstBaseUpdate=fe,_.lastBaseUpdate=we,c=_.shared.interleaved,c!==null){_=c;do A|=_.lane,_=_.next;while(_!==c)}else y===null&&(_.shared.lanes=0);Vo|=A,l.lanes=A,l.memoizedState=Te}}function Bx(l,c,d){if(l=c.effects,c.effects=null,l!==null)for(c=0;c<l.length;c++){var g=l[c],_=g.callback;if(_!==null){if(g.callback=null,g=d,typeof _!="function")throw Error(t(191,_));_.call(g)}}}var Ic={},Es=Ii(Ic),Mc=Ii(Ic),kc=Ii(Ic);function Bo(l){if(l===Ic)throw Error(t(174));return l}function Gg(l,c){switch($t(kc,c),$t(Mc,l),$t(Es,Ic),l=c.nodeType,l){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:Nr(null,"");break;default:l=l===8?c.parentNode:c,c=l.namespaceURI||null,l=l.tagName,c=Nr(c,l)}Yt(Es),$t(Es,c)}function el(){Yt(Es),Yt(Mc),Yt(kc)}function Ux(l){Bo(kc.current);var c=Bo(Es.current),d=Nr(c,l.type);c!==d&&($t(Mc,l),$t(Es,d))}function Jg(l){Mc.current===l&&(Yt(Es),Yt(Mc))}var en=Ii(0);function Jf(l){for(var c=l;c!==null;){if(c.tag===13){var d=c.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var em=[];function tm(){for(var l=0;l<em.length;l++)em[l]._workInProgressVersionPrimary=null;em.length=0}var eh=L.ReactCurrentDispatcher,nm=L.ReactCurrentBatchConfig,Uo=0,tn=null,Tn=null,Cn=null,th=!1,Oc=!1,Nc=0,nP=0;function $n(){throw Error(t(321))}function rm(l,c){if(c===null)return!1;for(var d=0;d<c.length&&d<l.length;d++)if(!ts(l[d],c[d]))return!1;return!0}function sm(l,c,d,g,_,y){if(Uo=y,tn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,eh.current=l===null||l.memoizedState===null?oP:aP,l=d(g,_),Oc){y=0;do{if(Oc=!1,Nc=0,25<=y)throw Error(t(301));y+=1,Cn=Tn=null,c.updateQueue=null,eh.current=lP,l=d(g,_)}while(Oc)}if(eh.current=sh,c=Tn!==null&&Tn.next!==null,Uo=0,Cn=Tn=tn=null,th=!1,c)throw Error(t(300));return l}function im(){var l=Nc!==0;return Nc=0,l}function As(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cn===null?tn.memoizedState=Cn=l:Cn=Cn.next=l,Cn}function zr(){if(Tn===null){var l=tn.alternate;l=l!==null?l.memoizedState:null}else l=Tn.next;var c=Cn===null?tn.memoizedState:Cn.next;if(c!==null)Cn=c,Tn=l;else{if(l===null)throw Error(t(310));Tn=l,l={memoizedState:Tn.memoizedState,baseState:Tn.baseState,baseQueue:Tn.baseQueue,queue:Tn.queue,next:null},Cn===null?tn.memoizedState=Cn=l:Cn=Cn.next=l}return Cn}function Dc(l,c){return typeof c=="function"?c(l):c}function om(l){var c=zr(),d=c.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=l;var g=Tn,_=g.baseQueue,y=d.pending;if(y!==null){if(_!==null){var A=_.next;_.next=y.next,y.next=A}g.baseQueue=_=y,d.pending=null}if(_!==null){y=_.next,g=g.baseState;var z=A=null,X=null,fe=y;do{var we=fe.lane;if((Uo&we)===we)X!==null&&(X=X.next={lane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),g=fe.hasEagerState?fe.eagerState:l(g,fe.action);else{var Te={lane:we,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null};X===null?(z=X=Te,A=g):X=X.next=Te,tn.lanes|=we,Vo|=we}fe=fe.next}while(fe!==null&&fe!==y);X===null?A=g:X.next=z,ts(g,c.memoizedState)||(pr=!0),c.memoizedState=g,c.baseState=A,c.baseQueue=X,d.lastRenderedState=g}if(l=d.interleaved,l!==null){_=l;do y=_.lane,tn.lanes|=y,Vo|=y,_=_.next;while(_!==l)}else _===null&&(d.lanes=0);return[c.memoizedState,d.dispatch]}function am(l){var c=zr(),d=c.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=l;var g=d.dispatch,_=d.pending,y=c.memoizedState;if(_!==null){d.pending=null;var A=_=_.next;do y=l(y,A.action),A=A.next;while(A!==_);ts(y,c.memoizedState)||(pr=!0),c.memoizedState=y,c.baseQueue===null&&(c.baseState=y),d.lastRenderedState=y}return[y,g]}function Vx(){}function zx(l,c){var d=tn,g=zr(),_=c(),y=!ts(g.memoizedState,_);if(y&&(g.memoizedState=_,pr=!0),g=g.queue,lm(Wx.bind(null,d,g,l),[l]),g.getSnapshot!==c||y||Cn!==null&&Cn.memoizedState.tag&1){if(d.flags|=2048,Lc(9,jx.bind(null,d,g,_,c),void 0,null),Pn===null)throw Error(t(349));(Uo&30)!==0||$x(d,c,_)}return _}function $x(l,c,d){l.flags|=16384,l={getSnapshot:c,value:d},c=tn.updateQueue,c===null?(c={lastEffect:null,stores:null},tn.updateQueue=c,c.stores=[l]):(d=c.stores,d===null?c.stores=[l]:d.push(l))}function jx(l,c,d,g){c.value=d,c.getSnapshot=g,Hx(c)&&Xx(l)}function Wx(l,c,d){return d(function(){Hx(c)&&Xx(l)})}function Hx(l){var c=l.getSnapshot;l=l.value;try{var d=c();return!ts(l,d)}catch{return!0}}function Xx(l){var c=Zs(l,1);c!==null&&os(c,l,1,-1)}function Yx(l){var c=As();return typeof l=="function"&&(l=l()),c.memoizedState=c.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dc,lastRenderedState:l},c.queue=l,l=l.dispatch=iP.bind(null,tn,l),[c.memoizedState,l]}function Lc(l,c,d,g){return l={tag:l,create:c,destroy:d,deps:g,next:null},c=tn.updateQueue,c===null?(c={lastEffect:null,stores:null},tn.updateQueue=c,c.lastEffect=l.next=l):(d=c.lastEffect,d===null?c.lastEffect=l.next=l:(g=d.next,d.next=l,l.next=g,c.lastEffect=l)),l}function qx(){return zr().memoizedState}function nh(l,c,d,g){var _=As();tn.flags|=l,_.memoizedState=Lc(1|c,d,void 0,g===void 0?null:g)}function rh(l,c,d,g){var _=zr();g=g===void 0?null:g;var y=void 0;if(Tn!==null){var A=Tn.memoizedState;if(y=A.destroy,g!==null&&rm(g,A.deps)){_.memoizedState=Lc(c,d,y,g);return}}tn.flags|=l,_.memoizedState=Lc(1|c,d,y,g)}function Kx(l,c){return nh(8390656,8,l,c)}function lm(l,c){return rh(2048,8,l,c)}function Zx(l,c){return rh(4,2,l,c)}function Qx(l,c){return rh(4,4,l,c)}function Gx(l,c){if(typeof c=="function")return l=l(),c(l),function(){c(null)};if(c!=null)return l=l(),c.current=l,function(){c.current=null}}function Jx(l,c,d){return d=d!=null?d.concat([l]):null,rh(4,4,Gx.bind(null,c,l),d)}function cm(){}function e2(l,c){var d=zr();c=c===void 0?null:c;var g=d.memoizedState;return g!==null&&c!==null&&rm(c,g[1])?g[0]:(d.memoizedState=[l,c],l)}function t2(l,c){var d=zr();c=c===void 0?null:c;var g=d.memoizedState;return g!==null&&c!==null&&rm(c,g[1])?g[0]:(l=l(),d.memoizedState=[l,c],l)}function n2(l,c,d){return(Uo&21)===0?(l.baseState&&(l.baseState=!1,pr=!0),l.memoizedState=d):(ts(d,c)||(d=La(),tn.lanes|=d,Vo|=d,l.baseState=!0),c)}function rP(l,c){var d=M;M=d!==0&&4>d?d:4,l(!0);var g=nm.transition;nm.transition={};try{l(!1),c()}finally{M=d,nm.transition=g}}function r2(){return zr().memoizedState}function sP(l,c,d){var g=Bi(l);if(d={lane:g,action:d,hasEagerState:!1,eagerState:null,next:null},s2(l))i2(c,d);else if(d=Dx(l,c,d,g),d!==null){var _=tr();os(d,l,g,_),o2(d,c,g)}}function iP(l,c,d){var g=Bi(l),_={lane:g,action:d,hasEagerState:!1,eagerState:null,next:null};if(s2(l))i2(c,_);else{var y=l.alternate;if(l.lanes===0&&(y===null||y.lanes===0)&&(y=c.lastRenderedReducer,y!==null))try{var A=c.lastRenderedState,z=y(A,d);if(_.hasEagerState=!0,_.eagerState=z,ts(z,A)){var X=c.interleaved;X===null?(_.next=_,Zg(c)):(_.next=X.next,X.next=_),c.interleaved=_;return}}catch{}finally{}d=Dx(l,c,_,g),d!==null&&(_=tr(),os(d,l,g,_),o2(d,c,g))}}function s2(l){var c=l.alternate;return l===tn||c!==null&&c===tn}function i2(l,c){Oc=th=!0;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}function o2(l,c,d){if((d&4194240)!==0){var g=c.lanes;g&=l.pendingLanes,d|=g,c.lanes=d,R(l,d)}}var sh={readContext:Vr,useCallback:$n,useContext:$n,useEffect:$n,useImperativeHandle:$n,useInsertionEffect:$n,useLayoutEffect:$n,useMemo:$n,useReducer:$n,useRef:$n,useState:$n,useDebugValue:$n,useDeferredValue:$n,useTransition:$n,useMutableSource:$n,useSyncExternalStore:$n,useId:$n,unstable_isNewReconciler:!1},oP={readContext:Vr,useCallback:function(l,c){return As().memoizedState=[l,c===void 0?null:c],l},useContext:Vr,useEffect:Kx,useImperativeHandle:function(l,c,d){return d=d!=null?d.concat([l]):null,nh(4194308,4,Gx.bind(null,c,l),d)},useLayoutEffect:function(l,c){return nh(4194308,4,l,c)},useInsertionEffect:function(l,c){return nh(4,2,l,c)},useMemo:function(l,c){var d=As();return c=c===void 0?null:c,l=l(),d.memoizedState=[l,c],l},useReducer:function(l,c,d){var g=As();return c=d!==void 0?d(c):c,g.memoizedState=g.baseState=c,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:c},g.queue=l,l=l.dispatch=sP.bind(null,tn,l),[g.memoizedState,l]},useRef:function(l){var c=As();return l={current:l},c.memoizedState=l},useState:Yx,useDebugValue:cm,useDeferredValue:function(l){return As().memoizedState=l},useTransition:function(){var l=Yx(!1),c=l[0];return l=rP.bind(null,l[1]),As().memoizedState=l,[c,l]},useMutableSource:function(){},useSyncExternalStore:function(l,c,d){var g=tn,_=As();if(Zt){if(d===void 0)throw Error(t(407));d=d()}else{if(d=c(),Pn===null)throw Error(t(349));(Uo&30)!==0||$x(g,c,d)}_.memoizedState=d;var y={value:d,getSnapshot:c};return _.queue=y,Kx(Wx.bind(null,g,y,l),[l]),g.flags|=2048,Lc(9,jx.bind(null,g,y,d,c),void 0,null),d},useId:function(){var l=As(),c=Pn.identifierPrefix;if(Zt){var d=Ks,g=qs;d=(g&~(1<<32-Vn(g)-1)).toString(32)+d,c=":"+c+"R"+d,d=Nc++,0<d&&(c+="H"+d.toString(32)),c+=":"}else d=nP++,c=":"+c+"r"+d.toString(32)+":";return l.memoizedState=c},unstable_isNewReconciler:!1},aP={readContext:Vr,useCallback:e2,useContext:Vr,useEffect:lm,useImperativeHandle:Jx,useInsertionEffect:Zx,useLayoutEffect:Qx,useMemo:t2,useReducer:om,useRef:qx,useState:function(){return om(Dc)},useDebugValue:cm,useDeferredValue:function(l){var c=zr();return n2(c,Tn.memoizedState,l)},useTransition:function(){var l=om(Dc)[0],c=zr().memoizedState;return[l,c]},useMutableSource:Vx,useSyncExternalStore:zx,useId:r2,unstable_isNewReconciler:!1},lP={readContext:Vr,useCallback:e2,useContext:Vr,useEffect:lm,useImperativeHandle:Jx,useInsertionEffect:Zx,useLayoutEffect:Qx,useMemo:t2,useReducer:am,useRef:qx,useState:function(){return am(Dc)},useDebugValue:cm,useDeferredValue:function(l){var c=zr();return Tn===null?c.memoizedState=l:n2(c,Tn.memoizedState,l)},useTransition:function(){var l=am(Dc)[0],c=zr().memoizedState;return[l,c]},useMutableSource:Vx,useSyncExternalStore:zx,useId:r2,unstable_isNewReconciler:!1};function rs(l,c){if(l&&l.defaultProps){c=k({},c),l=l.defaultProps;for(var d in l)c[d]===void 0&&(c[d]=l[d]);return c}return c}function um(l,c,d,g){c=l.memoizedState,d=d(g,c),d=d==null?c:k({},c,d),l.memoizedState=d,l.lanes===0&&(l.updateQueue.baseState=d)}var ih={isMounted:function(l){return(l=l._reactInternals)?Lr(l)===l:!1},enqueueSetState:function(l,c,d){l=l._reactInternals;var g=tr(),_=Bi(l),y=Qs(g,_);y.payload=c,d!=null&&(y.callback=d),c=Ni(l,y,_),c!==null&&(os(c,l,_,g),Qf(c,l,_))},enqueueReplaceState:function(l,c,d){l=l._reactInternals;var g=tr(),_=Bi(l),y=Qs(g,_);y.tag=1,y.payload=c,d!=null&&(y.callback=d),c=Ni(l,y,_),c!==null&&(os(c,l,_,g),Qf(c,l,_))},enqueueForceUpdate:function(l,c){l=l._reactInternals;var d=tr(),g=Bi(l),_=Qs(d,g);_.tag=2,c!=null&&(_.callback=c),c=Ni(l,_,g),c!==null&&(os(c,l,g,d),Qf(c,l,g))}};function a2(l,c,d,g,_,y,A){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(g,y,A):c.prototype&&c.prototype.isPureReactComponent?!bc(d,g)||!bc(_,y):!0}function l2(l,c,d){var g=!1,_=Mi,y=c.contextType;return typeof y=="object"&&y!==null?y=Vr(y):(_=dr(c)?No:zn.current,g=c.contextTypes,y=(g=g!=null)?Ya(l,_):Mi),c=new c(d,y),l.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=ih,l.stateNode=c,c._reactInternals=l,g&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=_,l.__reactInternalMemoizedMaskedChildContext=y),c}function c2(l,c,d,g){l=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(d,g),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(d,g),c.state!==l&&ih.enqueueReplaceState(c,c.state,null)}function fm(l,c,d,g){var _=l.stateNode;_.props=d,_.state=l.memoizedState,_.refs={},Qg(l);var y=c.contextType;typeof y=="object"&&y!==null?_.context=Vr(y):(y=dr(c)?No:zn.current,_.context=Ya(l,y)),_.state=l.memoizedState,y=c.getDerivedStateFromProps,typeof y=="function"&&(um(l,c,y,d),_.state=l.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(c=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),c!==_.state&&ih.enqueueReplaceState(_,_.state,null),Gf(l,d,_,g),_.state=l.memoizedState),typeof _.componentDidMount=="function"&&(l.flags|=4194308)}function tl(l,c){try{var d="",g=c;do d+=ee(g),g=g.return;while(g);var _=d}catch(y){_=`
Error generating stack: `+y.message+`
`+y.stack}return{value:l,source:c,stack:_,digest:null}}function hm(l,c,d){return{value:l,source:null,stack:d??null,digest:c??null}}function dm(l,c){try{console.error(c.value)}catch(d){setTimeout(function(){throw d})}}var cP=typeof WeakMap=="function"?WeakMap:Map;function u2(l,c,d){d=Qs(-1,d),d.tag=3,d.payload={element:null};var g=c.value;return d.callback=function(){hh||(hh=!0,Cm=g),dm(l,c)},d}function f2(l,c,d){d=Qs(-1,d),d.tag=3;var g=l.type.getDerivedStateFromError;if(typeof g=="function"){var _=c.value;d.payload=function(){return g(_)},d.callback=function(){dm(l,c)}}var y=l.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){dm(l,c),typeof g!="function"&&(Li===null?Li=new Set([this]):Li.add(this));var A=c.stack;this.componentDidCatch(c.value,{componentStack:A!==null?A:""})}),d}function h2(l,c,d){var g=l.pingCache;if(g===null){g=l.pingCache=new cP;var _=new Set;g.set(c,_)}else _=g.get(c),_===void 0&&(_=new Set,g.set(c,_));_.has(d)||(_.add(d),l=TP.bind(null,l,c,d),c.then(l,l))}function d2(l){do{var c;if((c=l.tag===13)&&(c=l.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return l;l=l.return}while(l!==null);return null}function p2(l,c,d,g,_){return(l.mode&1)===0?(l===c?l.flags|=65536:(l.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(c=Qs(-1,1),c.tag=2,Ni(d,c,1))),d.lanes|=1),l):(l.flags|=65536,l.lanes=_,l)}var uP=L.ReactCurrentOwner,pr=!1;function er(l,c,d,g){c.child=l===null?Nx(c,null,d,g):Qa(c,l.child,d,g)}function g2(l,c,d,g,_){d=d.render;var y=c.ref;return Ja(c,_),g=sm(l,c,d,g,y,_),d=im(),l!==null&&!pr?(c.updateQueue=l.updateQueue,c.flags&=-2053,l.lanes&=~_,Gs(l,c,_)):(Zt&&d&&zg(c),c.flags|=1,er(l,c,g,_),c.child)}function m2(l,c,d,g,_){if(l===null){var y=d.type;return typeof y=="function"&&!Dm(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(c.tag=15,c.type=y,v2(l,c,y,g,_)):(l=_h(d.type,null,g,c,c.mode,_),l.ref=c.ref,l.return=c,c.child=l)}if(y=l.child,(l.lanes&_)===0){var A=y.memoizedProps;if(d=d.compare,d=d!==null?d:bc,d(A,g)&&l.ref===c.ref)return Gs(l,c,_)}return c.flags|=1,l=Vi(y,g),l.ref=c.ref,l.return=c,c.child=l}function v2(l,c,d,g,_){if(l!==null){var y=l.memoizedProps;if(bc(y,g)&&l.ref===c.ref)if(pr=!1,c.pendingProps=g=y,(l.lanes&_)!==0)(l.flags&131072)!==0&&(pr=!0);else return c.lanes=l.lanes,Gs(l,c,_)}return pm(l,c,d,g,_)}function _2(l,c,d){var g=c.pendingProps,_=g.children,y=l!==null?l.memoizedState:null;if(g.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},$t(rl,Rr),Rr|=d;else{if((d&1073741824)===0)return l=y!==null?y.baseLanes|d:d,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:l,cachePool:null,transitions:null},c.updateQueue=null,$t(rl,Rr),Rr|=l,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=y!==null?y.baseLanes:d,$t(rl,Rr),Rr|=g}else y!==null?(g=y.baseLanes|d,c.memoizedState=null):g=d,$t(rl,Rr),Rr|=g;return er(l,c,_,d),c.child}function y2(l,c){var d=c.ref;(l===null&&d!==null||l!==null&&l.ref!==d)&&(c.flags|=512,c.flags|=2097152)}function pm(l,c,d,g,_){var y=dr(d)?No:zn.current;return y=Ya(c,y),Ja(c,_),d=sm(l,c,d,g,y,_),g=im(),l!==null&&!pr?(c.updateQueue=l.updateQueue,c.flags&=-2053,l.lanes&=~_,Gs(l,c,_)):(Zt&&g&&zg(c),c.flags|=1,er(l,c,d,_),c.child)}function x2(l,c,d,g,_){if(dr(d)){var y=!0;jf(c)}else y=!1;if(Ja(c,_),c.stateNode===null)ah(l,c),l2(c,d,g),fm(c,d,g,_),g=!0;else if(l===null){var A=c.stateNode,z=c.memoizedProps;A.props=z;var X=A.context,fe=d.contextType;typeof fe=="object"&&fe!==null?fe=Vr(fe):(fe=dr(d)?No:zn.current,fe=Ya(c,fe));var we=d.getDerivedStateFromProps,Te=typeof we=="function"||typeof A.getSnapshotBeforeUpdate=="function";Te||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(z!==g||X!==fe)&&c2(c,A,g,fe),Oi=!1;var _e=c.memoizedState;A.state=_e,Gf(c,g,A,_),X=c.memoizedState,z!==g||_e!==X||hr.current||Oi?(typeof we=="function"&&(um(c,d,we,g),X=c.memoizedState),(z=Oi||a2(c,d,z,g,_e,X,fe))?(Te||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(c.flags|=4194308)):(typeof A.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=g,c.memoizedState=X),A.props=g,A.state=X,A.context=fe,g=z):(typeof A.componentDidMount=="function"&&(c.flags|=4194308),g=!1)}else{A=c.stateNode,Lx(l,c),z=c.memoizedProps,fe=c.type===c.elementType?z:rs(c.type,z),A.props=fe,Te=c.pendingProps,_e=A.context,X=d.contextType,typeof X=="object"&&X!==null?X=Vr(X):(X=dr(d)?No:zn.current,X=Ya(c,X));var De=d.getDerivedStateFromProps;(we=typeof De=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(z!==Te||_e!==X)&&c2(c,A,g,X),Oi=!1,_e=c.memoizedState,A.state=_e,Gf(c,g,A,_);var Ve=c.memoizedState;z!==Te||_e!==Ve||hr.current||Oi?(typeof De=="function"&&(um(c,d,De,g),Ve=c.memoizedState),(fe=Oi||a2(c,d,fe,g,_e,Ve,X)||!1)?(we||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(g,Ve,X),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(g,Ve,X)),typeof A.componentDidUpdate=="function"&&(c.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof A.componentDidUpdate!="function"||z===l.memoizedProps&&_e===l.memoizedState||(c.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||z===l.memoizedProps&&_e===l.memoizedState||(c.flags|=1024),c.memoizedProps=g,c.memoizedState=Ve),A.props=g,A.state=Ve,A.context=X,g=fe):(typeof A.componentDidUpdate!="function"||z===l.memoizedProps&&_e===l.memoizedState||(c.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||z===l.memoizedProps&&_e===l.memoizedState||(c.flags|=1024),g=!1)}return gm(l,c,d,g,y,_)}function gm(l,c,d,g,_,y){y2(l,c);var A=(c.flags&128)!==0;if(!g&&!A)return _&&Ex(c,d,!1),Gs(l,c,y);g=c.stateNode,uP.current=c;var z=A&&typeof d.getDerivedStateFromError!="function"?null:g.render();return c.flags|=1,l!==null&&A?(c.child=Qa(c,l.child,null,y),c.child=Qa(c,null,z,y)):er(l,c,z,y),c.memoizedState=g.state,_&&Ex(c,d,!0),c.child}function w2(l){var c=l.stateNode;c.pendingContext?Tx(l,c.pendingContext,c.pendingContext!==c.context):c.context&&Tx(l,c.context,!1),Gg(l,c.containerInfo)}function b2(l,c,d,g,_){return Za(),Hg(_),c.flags|=256,er(l,c,d,g),c.child}var mm={dehydrated:null,treeContext:null,retryLane:0};function vm(l){return{baseLanes:l,cachePool:null,transitions:null}}function T2(l,c,d){var g=c.pendingProps,_=en.current,y=!1,A=(c.flags&128)!==0,z;if((z=A)||(z=l!==null&&l.memoizedState===null?!1:(_&2)!==0),z?(y=!0,c.flags&=-129):(l===null||l.memoizedState!==null)&&(_|=1),$t(en,_&1),l===null)return Wg(c),l=c.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?((c.mode&1)===0?c.lanes=1:l.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(A=g.children,l=g.fallback,y?(g=c.mode,y=c.child,A={mode:"hidden",children:A},(g&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=A):y=yh(A,g,0,null),l=Wo(l,g,d,null),y.return=c,l.return=c,y.sibling=l,c.child=y,c.child.memoizedState=vm(d),c.memoizedState=mm,l):_m(c,A));if(_=l.memoizedState,_!==null&&(z=_.dehydrated,z!==null))return fP(l,c,A,g,z,_,d);if(y){y=g.fallback,A=c.mode,_=l.child,z=_.sibling;var X={mode:"hidden",children:g.children};return(A&1)===0&&c.child!==_?(g=c.child,g.childLanes=0,g.pendingProps=X,c.deletions=null):(g=Vi(_,X),g.subtreeFlags=_.subtreeFlags&14680064),z!==null?y=Vi(z,y):(y=Wo(y,A,d,null),y.flags|=2),y.return=c,g.return=c,g.sibling=y,c.child=g,g=y,y=c.child,A=l.child.memoizedState,A=A===null?vm(d):{baseLanes:A.baseLanes|d,cachePool:null,transitions:A.transitions},y.memoizedState=A,y.childLanes=l.childLanes&~d,c.memoizedState=mm,g}return y=l.child,l=y.sibling,g=Vi(y,{mode:"visible",children:g.children}),(c.mode&1)===0&&(g.lanes=d),g.return=c,g.sibling=null,l!==null&&(d=c.deletions,d===null?(c.deletions=[l],c.flags|=16):d.push(l)),c.child=g,c.memoizedState=null,g}function _m(l,c){return c=yh({mode:"visible",children:c},l.mode,0,null),c.return=l,l.child=c}function oh(l,c,d,g){return g!==null&&Hg(g),Qa(c,l.child,null,d),l=_m(c,c.pendingProps.children),l.flags|=2,c.memoizedState=null,l}function fP(l,c,d,g,_,y,A){if(d)return c.flags&256?(c.flags&=-257,g=hm(Error(t(422))),oh(l,c,A,g)):c.memoizedState!==null?(c.child=l.child,c.flags|=128,null):(y=g.fallback,_=c.mode,g=yh({mode:"visible",children:g.children},_,0,null),y=Wo(y,_,A,null),y.flags|=2,g.return=c,y.return=c,g.sibling=y,c.child=g,(c.mode&1)!==0&&Qa(c,l.child,null,A),c.child.memoizedState=vm(A),c.memoizedState=mm,y);if((c.mode&1)===0)return oh(l,c,A,null);if(_.data==="$!"){if(g=_.nextSibling&&_.nextSibling.dataset,g)var z=g.dgst;return g=z,y=Error(t(419)),g=hm(y,g,void 0),oh(l,c,A,g)}if(z=(A&l.childLanes)!==0,pr||z){if(g=Pn,g!==null){switch(A&-A){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=(_&(g.suspendedLanes|A))!==0?0:_,_!==0&&_!==y.retryLane&&(y.retryLane=_,Zs(l,_),os(g,l,_,-1))}return Nm(),g=hm(Error(t(421))),oh(l,c,A,g)}return _.data==="$?"?(c.flags|=128,c.child=l.child,c=SP.bind(null,l),_._reactRetry=c,null):(l=y.treeContext,Ar=Pi(_.nextSibling),Er=c,Zt=!0,ns=null,l!==null&&(Br[Ur++]=qs,Br[Ur++]=Ks,Br[Ur++]=Do,qs=l.id,Ks=l.overflow,Do=c),c=_m(c,g.children),c.flags|=4096,c)}function S2(l,c,d){l.lanes|=c;var g=l.alternate;g!==null&&(g.lanes|=c),Kg(l.return,c,d)}function ym(l,c,d,g,_){var y=l.memoizedState;y===null?l.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:g,tail:d,tailMode:_}:(y.isBackwards=c,y.rendering=null,y.renderingStartTime=0,y.last=g,y.tail=d,y.tailMode=_)}function E2(l,c,d){var g=c.pendingProps,_=g.revealOrder,y=g.tail;if(er(l,c,g.children,d),g=en.current,(g&2)!==0)g=g&1|2,c.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=c.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&S2(l,d,c);else if(l.tag===19)S2(l,d,c);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===c)break e;for(;l.sibling===null;){if(l.return===null||l.return===c)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}g&=1}if($t(en,g),(c.mode&1)===0)c.memoizedState=null;else switch(_){case"forwards":for(d=c.child,_=null;d!==null;)l=d.alternate,l!==null&&Jf(l)===null&&(_=d),d=d.sibling;d=_,d===null?(_=c.child,c.child=null):(_=d.sibling,d.sibling=null),ym(c,!1,_,d,y);break;case"backwards":for(d=null,_=c.child,c.child=null;_!==null;){if(l=_.alternate,l!==null&&Jf(l)===null){c.child=_;break}l=_.sibling,_.sibling=d,d=_,_=l}ym(c,!0,d,null,y);break;case"together":ym(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ah(l,c){(c.mode&1)===0&&l!==null&&(l.alternate=null,c.alternate=null,c.flags|=2)}function Gs(l,c,d){if(l!==null&&(c.dependencies=l.dependencies),Vo|=c.lanes,(d&c.childLanes)===0)return null;if(l!==null&&c.child!==l.child)throw Error(t(153));if(c.child!==null){for(l=c.child,d=Vi(l,l.pendingProps),c.child=d,d.return=c;l.sibling!==null;)l=l.sibling,d=d.sibling=Vi(l,l.pendingProps),d.return=c;d.sibling=null}return c.child}function hP(l,c,d){switch(c.tag){case 3:w2(c),Za();break;case 5:Ux(c);break;case 1:dr(c.type)&&jf(c);break;case 4:Gg(c,c.stateNode.containerInfo);break;case 10:var g=c.type._context,_=c.memoizedProps.value;$t(Kf,g._currentValue),g._currentValue=_;break;case 13:if(g=c.memoizedState,g!==null)return g.dehydrated!==null?($t(en,en.current&1),c.flags|=128,null):(d&c.child.childLanes)!==0?T2(l,c,d):($t(en,en.current&1),l=Gs(l,c,d),l!==null?l.sibling:null);$t(en,en.current&1);break;case 19:if(g=(d&c.childLanes)!==0,(l.flags&128)!==0){if(g)return E2(l,c,d);c.flags|=128}if(_=c.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),$t(en,en.current),g)break;return null;case 22:case 23:return c.lanes=0,_2(l,c,d)}return Gs(l,c,d)}var A2,xm,R2,C2;A2=function(l,c){for(var d=c.child;d!==null;){if(d.tag===5||d.tag===6)l.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},xm=function(){},R2=function(l,c,d,g){var _=l.memoizedProps;if(_!==g){l=c.stateNode,Bo(Es.current);var y=null;switch(d){case"input":_=Qe(l,_),g=Qe(l,g),y=[];break;case"select":_=k({},_,{value:void 0}),g=k({},g,{value:void 0}),y=[];break;case"textarea":_=ot(l,_),g=ot(l,g),y=[];break;default:typeof _.onClick!="function"&&typeof g.onClick=="function"&&(l.onclick=Vf)}$s(d,g);var A;d=null;for(fe in _)if(!g.hasOwnProperty(fe)&&_.hasOwnProperty(fe)&&_[fe]!=null)if(fe==="style"){var z=_[fe];for(A in z)z.hasOwnProperty(A)&&(d||(d={}),d[A]="")}else fe!=="dangerouslySetInnerHTML"&&fe!=="children"&&fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&fe!=="autoFocus"&&(s.hasOwnProperty(fe)?y||(y=[]):(y=y||[]).push(fe,null));for(fe in g){var X=g[fe];if(z=_!=null?_[fe]:void 0,g.hasOwnProperty(fe)&&X!==z&&(X!=null||z!=null))if(fe==="style")if(z){for(A in z)!z.hasOwnProperty(A)||X&&X.hasOwnProperty(A)||(d||(d={}),d[A]="");for(A in X)X.hasOwnProperty(A)&&z[A]!==X[A]&&(d||(d={}),d[A]=X[A])}else d||(y||(y=[]),y.push(fe,d)),d=X;else fe==="dangerouslySetInnerHTML"?(X=X?X.__html:void 0,z=z?z.__html:void 0,X!=null&&z!==X&&(y=y||[]).push(fe,X)):fe==="children"?typeof X!="string"&&typeof X!="number"||(y=y||[]).push(fe,""+X):fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&(s.hasOwnProperty(fe)?(X!=null&&fe==="onScroll"&&Xt("scroll",l),y||z===X||(y=[])):(y=y||[]).push(fe,X))}d&&(y=y||[]).push("style",d);var fe=y;(c.updateQueue=fe)&&(c.flags|=4)}},C2=function(l,c,d,g){d!==g&&(c.flags|=4)};function Fc(l,c){if(!Zt)switch(l.tailMode){case"hidden":c=l.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?l.tail=null:d.sibling=null;break;case"collapsed":d=l.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?c||l.tail===null?l.tail=null:l.tail.sibling=null:g.sibling=null}}function jn(l){var c=l.alternate!==null&&l.alternate.child===l.child,d=0,g=0;if(c)for(var _=l.child;_!==null;)d|=_.lanes|_.childLanes,g|=_.subtreeFlags&14680064,g|=_.flags&14680064,_.return=l,_=_.sibling;else for(_=l.child;_!==null;)d|=_.lanes|_.childLanes,g|=_.subtreeFlags,g|=_.flags,_.return=l,_=_.sibling;return l.subtreeFlags|=g,l.childLanes=d,c}function dP(l,c,d){var g=c.pendingProps;switch($g(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jn(c),null;case 1:return dr(c.type)&&$f(),jn(c),null;case 3:return g=c.stateNode,el(),Yt(hr),Yt(zn),tm(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(l===null||l.child===null)&&(Yf(c)?c.flags|=4:l===null||l.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,ns!==null&&(Mm(ns),ns=null))),xm(l,c),jn(c),null;case 5:Jg(c);var _=Bo(kc.current);if(d=c.type,l!==null&&c.stateNode!=null)R2(l,c,d,g,_),l.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!g){if(c.stateNode===null)throw Error(t(166));return jn(c),null}if(l=Bo(Es.current),Yf(c)){g=c.stateNode,d=c.type;var y=c.memoizedProps;switch(g[Ss]=c,g[Rc]=y,l=(c.mode&1)!==0,d){case"dialog":Xt("cancel",g),Xt("close",g);break;case"iframe":case"object":case"embed":Xt("load",g);break;case"video":case"audio":for(_=0;_<Sc.length;_++)Xt(Sc[_],g);break;case"source":Xt("error",g);break;case"img":case"image":case"link":Xt("error",g),Xt("load",g);break;case"details":Xt("toggle",g);break;case"input":He(g,y),Xt("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!y.multiple},Xt("invalid",g);break;case"textarea":Pt(g,y),Xt("invalid",g)}$s(d,y),_=null;for(var A in y)if(y.hasOwnProperty(A)){var z=y[A];A==="children"?typeof z=="string"?g.textContent!==z&&(y.suppressHydrationWarning!==!0&&Uf(g.textContent,z,l),_=["children",z]):typeof z=="number"&&g.textContent!==""+z&&(y.suppressHydrationWarning!==!0&&Uf(g.textContent,z,l),_=["children",""+z]):s.hasOwnProperty(A)&&z!=null&&A==="onScroll"&&Xt("scroll",g)}switch(d){case"input":Ue(g),_n(g,y,!0);break;case"textarea":Ue(g),An(g);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(g.onclick=Vf)}g=_,c.updateQueue=g,g!==null&&(c.flags|=4)}else{A=_.nodeType===9?_:_.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=yn(d)),l==="http://www.w3.org/1999/xhtml"?d==="script"?(l=A.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof g.is=="string"?l=A.createElement(d,{is:g.is}):(l=A.createElement(d),d==="select"&&(A=l,g.multiple?A.multiple=!0:g.size&&(A.size=g.size))):l=A.createElementNS(l,d),l[Ss]=c,l[Rc]=g,A2(l,c,!1,!1),c.stateNode=l;e:{switch(A=Ze(d,g),d){case"dialog":Xt("cancel",l),Xt("close",l),_=g;break;case"iframe":case"object":case"embed":Xt("load",l),_=g;break;case"video":case"audio":for(_=0;_<Sc.length;_++)Xt(Sc[_],l);_=g;break;case"source":Xt("error",l),_=g;break;case"img":case"image":case"link":Xt("error",l),Xt("load",l),_=g;break;case"details":Xt("toggle",l),_=g;break;case"input":He(l,g),_=Qe(l,g),Xt("invalid",l);break;case"option":_=g;break;case"select":l._wrapperState={wasMultiple:!!g.multiple},_=k({},g,{value:void 0}),Xt("invalid",l);break;case"textarea":Pt(l,g),_=ot(l,g),Xt("invalid",l);break;default:_=g}$s(d,_),z=_;for(y in z)if(z.hasOwnProperty(y)){var X=z[y];y==="style"?mi(l,X):y==="dangerouslySetInnerHTML"?(X=X?X.__html:void 0,X!=null&&gt(l,X)):y==="children"?typeof X=="string"?(d!=="textarea"||X!=="")&&On(l,X):typeof X=="number"&&On(l,""+X):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?X!=null&&y==="onScroll"&&Xt("scroll",l):X!=null&&P(l,y,X,A))}switch(d){case"input":Ue(l),_n(l,g,!1);break;case"textarea":Ue(l),An(l);break;case"option":g.value!=null&&l.setAttribute("value",""+me(g.value));break;case"select":l.multiple=!!g.multiple,y=g.value,y!=null?ht(l,!!g.multiple,y,!1):g.defaultValue!=null&&ht(l,!!g.multiple,g.defaultValue,!0);break;default:typeof _.onClick=="function"&&(l.onclick=Vf)}switch(d){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return jn(c),null;case 6:if(l&&c.stateNode!=null)C2(l,c,l.memoizedProps,g);else{if(typeof g!="string"&&c.stateNode===null)throw Error(t(166));if(d=Bo(kc.current),Bo(Es.current),Yf(c)){if(g=c.stateNode,d=c.memoizedProps,g[Ss]=c,(y=g.nodeValue!==d)&&(l=Er,l!==null))switch(l.tag){case 3:Uf(g.nodeValue,d,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Uf(g.nodeValue,d,(l.mode&1)!==0)}y&&(c.flags|=4)}else g=(d.nodeType===9?d:d.ownerDocument).createTextNode(g),g[Ss]=c,c.stateNode=g}return jn(c),null;case 13:if(Yt(en),g=c.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(Zt&&Ar!==null&&(c.mode&1)!==0&&(c.flags&128)===0)Mx(),Za(),c.flags|=98560,y=!1;else if(y=Yf(c),g!==null&&g.dehydrated!==null){if(l===null){if(!y)throw Error(t(318));if(y=c.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(t(317));y[Ss]=c}else Za(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;jn(c),y=!1}else ns!==null&&(Mm(ns),ns=null),y=!0;if(!y)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=d,c):(g=g!==null,g!==(l!==null&&l.memoizedState!==null)&&g&&(c.child.flags|=8192,(c.mode&1)!==0&&(l===null||(en.current&1)!==0?Sn===0&&(Sn=3):Nm())),c.updateQueue!==null&&(c.flags|=4),jn(c),null);case 4:return el(),xm(l,c),l===null&&Ec(c.stateNode.containerInfo),jn(c),null;case 10:return qg(c.type._context),jn(c),null;case 17:return dr(c.type)&&$f(),jn(c),null;case 19:if(Yt(en),y=c.memoizedState,y===null)return jn(c),null;if(g=(c.flags&128)!==0,A=y.rendering,A===null)if(g)Fc(y,!1);else{if(Sn!==0||l!==null&&(l.flags&128)!==0)for(l=c.child;l!==null;){if(A=Jf(l),A!==null){for(c.flags|=128,Fc(y,!1),g=A.updateQueue,g!==null&&(c.updateQueue=g,c.flags|=4),c.subtreeFlags=0,g=d,d=c.child;d!==null;)y=d,l=g,y.flags&=14680066,A=y.alternate,A===null?(y.childLanes=0,y.lanes=l,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=A.childLanes,y.lanes=A.lanes,y.child=A.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=A.memoizedProps,y.memoizedState=A.memoizedState,y.updateQueue=A.updateQueue,y.type=A.type,l=A.dependencies,y.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),d=d.sibling;return $t(en,en.current&1|2),c.child}l=l.sibling}y.tail!==null&&zt()>sl&&(c.flags|=128,g=!0,Fc(y,!1),c.lanes=4194304)}else{if(!g)if(l=Jf(A),l!==null){if(c.flags|=128,g=!0,d=l.updateQueue,d!==null&&(c.updateQueue=d,c.flags|=4),Fc(y,!0),y.tail===null&&y.tailMode==="hidden"&&!A.alternate&&!Zt)return jn(c),null}else 2*zt()-y.renderingStartTime>sl&&d!==1073741824&&(c.flags|=128,g=!0,Fc(y,!1),c.lanes=4194304);y.isBackwards?(A.sibling=c.child,c.child=A):(d=y.last,d!==null?d.sibling=A:c.child=A,y.last=A)}return y.tail!==null?(c=y.tail,y.rendering=c,y.tail=c.sibling,y.renderingStartTime=zt(),c.sibling=null,d=en.current,$t(en,g?d&1|2:d&1),c):(jn(c),null);case 22:case 23:return Om(),g=c.memoizedState!==null,l!==null&&l.memoizedState!==null!==g&&(c.flags|=8192),g&&(c.mode&1)!==0?(Rr&1073741824)!==0&&(jn(c),c.subtreeFlags&6&&(c.flags|=8192)):jn(c),null;case 24:return null;case 25:return null}throw Error(t(156,c.tag))}function pP(l,c){switch($g(c),c.tag){case 1:return dr(c.type)&&$f(),l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 3:return el(),Yt(hr),Yt(zn),tm(),l=c.flags,(l&65536)!==0&&(l&128)===0?(c.flags=l&-65537|128,c):null;case 5:return Jg(c),null;case 13:if(Yt(en),l=c.memoizedState,l!==null&&l.dehydrated!==null){if(c.alternate===null)throw Error(t(340));Za()}return l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 19:return Yt(en),null;case 4:return el(),null;case 10:return qg(c.type._context),null;case 22:case 23:return Om(),null;case 24:return null;default:return null}}var lh=!1,Wn=!1,gP=typeof WeakSet=="function"?WeakSet:Set,Be=null;function nl(l,c){var d=l.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(g){nn(l,c,g)}else d.current=null}function wm(l,c,d){try{d()}catch(g){nn(l,c,g)}}var P2=!1;function mP(l,c){if(Og=Cf,l=ax(),Eg(l)){if("selectionStart"in l)var d={start:l.selectionStart,end:l.selectionEnd};else e:{d=(d=l.ownerDocument)&&d.defaultView||window;var g=d.getSelection&&d.getSelection();if(g&&g.rangeCount!==0){d=g.anchorNode;var _=g.anchorOffset,y=g.focusNode;g=g.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var A=0,z=-1,X=-1,fe=0,we=0,Te=l,_e=null;t:for(;;){for(var De;Te!==d||_!==0&&Te.nodeType!==3||(z=A+_),Te!==y||g!==0&&Te.nodeType!==3||(X=A+g),Te.nodeType===3&&(A+=Te.nodeValue.length),(De=Te.firstChild)!==null;)_e=Te,Te=De;for(;;){if(Te===l)break t;if(_e===d&&++fe===_&&(z=A),_e===y&&++we===g&&(X=A),(De=Te.nextSibling)!==null)break;Te=_e,_e=Te.parentNode}Te=De}d=z===-1||X===-1?null:{start:z,end:X}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ng={focusedElem:l,selectionRange:d},Cf=!1,Be=c;Be!==null;)if(c=Be,l=c.child,(c.subtreeFlags&1028)!==0&&l!==null)l.return=c,Be=l;else for(;Be!==null;){c=Be;try{var Ve=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var $e=Ve.memoizedProps,dn=Ve.memoizedState,ie=c.stateNode,Z=ie.getSnapshotBeforeUpdate(c.elementType===c.type?$e:rs(c.type,$e),dn);ie.__reactInternalSnapshotBeforeUpdate=Z}break;case 3:var ae=c.stateNode.containerInfo;ae.nodeType===1?ae.textContent="":ae.nodeType===9&&ae.documentElement&&ae.removeChild(ae.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Re){nn(c,c.return,Re)}if(l=c.sibling,l!==null){l.return=c.return,Be=l;break}Be=c.return}return Ve=P2,P2=!1,Ve}function Bc(l,c,d){var g=c.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var _=g=g.next;do{if((_.tag&l)===l){var y=_.destroy;_.destroy=void 0,y!==void 0&&wm(c,d,y)}_=_.next}while(_!==g)}}function ch(l,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var d=c=c.next;do{if((d.tag&l)===l){var g=d.create;d.destroy=g()}d=d.next}while(d!==c)}}function bm(l){var c=l.ref;if(c!==null){var d=l.stateNode;switch(l.tag){case 5:l=d;break;default:l=d}typeof c=="function"?c(l):c.current=l}}function I2(l){var c=l.alternate;c!==null&&(l.alternate=null,I2(c)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(c=l.stateNode,c!==null&&(delete c[Ss],delete c[Rc],delete c[Bg],delete c[GC],delete c[JC])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function M2(l){return l.tag===5||l.tag===3||l.tag===4}function k2(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||M2(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Tm(l,c,d){var g=l.tag;if(g===5||g===6)l=l.stateNode,c?d.nodeType===8?d.parentNode.insertBefore(l,c):d.insertBefore(l,c):(d.nodeType===8?(c=d.parentNode,c.insertBefore(l,d)):(c=d,c.appendChild(l)),d=d._reactRootContainer,d!=null||c.onclick!==null||(c.onclick=Vf));else if(g!==4&&(l=l.child,l!==null))for(Tm(l,c,d),l=l.sibling;l!==null;)Tm(l,c,d),l=l.sibling}function Sm(l,c,d){var g=l.tag;if(g===5||g===6)l=l.stateNode,c?d.insertBefore(l,c):d.appendChild(l);else if(g!==4&&(l=l.child,l!==null))for(Sm(l,c,d),l=l.sibling;l!==null;)Sm(l,c,d),l=l.sibling}var Nn=null,ss=!1;function Di(l,c,d){for(d=d.child;d!==null;)O2(l,c,d),d=d.sibling}function O2(l,c,d){if(br&&typeof br.onCommitFiberUnmount=="function")try{br.onCommitFiberUnmount(fr,d)}catch{}switch(d.tag){case 5:Wn||nl(d,c);case 6:var g=Nn,_=ss;Nn=null,Di(l,c,d),Nn=g,ss=_,Nn!==null&&(ss?(l=Nn,d=d.stateNode,l.nodeType===8?l.parentNode.removeChild(d):l.removeChild(d)):Nn.removeChild(d.stateNode));break;case 18:Nn!==null&&(ss?(l=Nn,d=d.stateNode,l.nodeType===8?Fg(l.parentNode,d):l.nodeType===1&&Fg(l,d),mc(l)):Fg(Nn,d.stateNode));break;case 4:g=Nn,_=ss,Nn=d.stateNode.containerInfo,ss=!0,Di(l,c,d),Nn=g,ss=_;break;case 0:case 11:case 14:case 15:if(!Wn&&(g=d.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){_=g=g.next;do{var y=_,A=y.destroy;y=y.tag,A!==void 0&&((y&2)!==0||(y&4)!==0)&&wm(d,c,A),_=_.next}while(_!==g)}Di(l,c,d);break;case 1:if(!Wn&&(nl(d,c),g=d.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=d.memoizedProps,g.state=d.memoizedState,g.componentWillUnmount()}catch(z){nn(d,c,z)}Di(l,c,d);break;case 21:Di(l,c,d);break;case 22:d.mode&1?(Wn=(g=Wn)||d.memoizedState!==null,Di(l,c,d),Wn=g):Di(l,c,d);break;default:Di(l,c,d)}}function N2(l){var c=l.updateQueue;if(c!==null){l.updateQueue=null;var d=l.stateNode;d===null&&(d=l.stateNode=new gP),c.forEach(function(g){var _=EP.bind(null,l,g);d.has(g)||(d.add(g),g.then(_,_))})}}function is(l,c){var d=c.deletions;if(d!==null)for(var g=0;g<d.length;g++){var _=d[g];try{var y=l,A=c,z=A;e:for(;z!==null;){switch(z.tag){case 5:Nn=z.stateNode,ss=!1;break e;case 3:Nn=z.stateNode.containerInfo,ss=!0;break e;case 4:Nn=z.stateNode.containerInfo,ss=!0;break e}z=z.return}if(Nn===null)throw Error(t(160));O2(y,A,_),Nn=null,ss=!1;var X=_.alternate;X!==null&&(X.return=null),_.return=null}catch(fe){nn(_,c,fe)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)D2(c,l),c=c.sibling}function D2(l,c){var d=l.alternate,g=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(is(c,l),Rs(l),g&4){try{Bc(3,l,l.return),ch(3,l)}catch($e){nn(l,l.return,$e)}try{Bc(5,l,l.return)}catch($e){nn(l,l.return,$e)}}break;case 1:is(c,l),Rs(l),g&512&&d!==null&&nl(d,d.return);break;case 5:if(is(c,l),Rs(l),g&512&&d!==null&&nl(d,d.return),l.flags&32){var _=l.stateNode;try{On(_,"")}catch($e){nn(l,l.return,$e)}}if(g&4&&(_=l.stateNode,_!=null)){var y=l.memoizedProps,A=d!==null?d.memoizedProps:y,z=l.type,X=l.updateQueue;if(l.updateQueue=null,X!==null)try{z==="input"&&y.type==="radio"&&y.name!=null&&Ie(_,y),Ze(z,A);var fe=Ze(z,y);for(A=0;A<X.length;A+=2){var we=X[A],Te=X[A+1];we==="style"?mi(_,Te):we==="dangerouslySetInnerHTML"?gt(_,Te):we==="children"?On(_,Te):P(_,we,Te,fe)}switch(z){case"input":lt(_,y);break;case"textarea":Ft(_,y);break;case"select":var _e=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!y.multiple;var De=y.value;De!=null?ht(_,!!y.multiple,De,!1):_e!==!!y.multiple&&(y.defaultValue!=null?ht(_,!!y.multiple,y.defaultValue,!0):ht(_,!!y.multiple,y.multiple?[]:"",!1))}_[Rc]=y}catch($e){nn(l,l.return,$e)}}break;case 6:if(is(c,l),Rs(l),g&4){if(l.stateNode===null)throw Error(t(162));_=l.stateNode,y=l.memoizedProps;try{_.nodeValue=y}catch($e){nn(l,l.return,$e)}}break;case 3:if(is(c,l),Rs(l),g&4&&d!==null&&d.memoizedState.isDehydrated)try{mc(c.containerInfo)}catch($e){nn(l,l.return,$e)}break;case 4:is(c,l),Rs(l);break;case 13:is(c,l),Rs(l),_=l.child,_.flags&8192&&(y=_.memoizedState!==null,_.stateNode.isHidden=y,!y||_.alternate!==null&&_.alternate.memoizedState!==null||(Rm=zt())),g&4&&N2(l);break;case 22:if(we=d!==null&&d.memoizedState!==null,l.mode&1?(Wn=(fe=Wn)||we,is(c,l),Wn=fe):is(c,l),Rs(l),g&8192){if(fe=l.memoizedState!==null,(l.stateNode.isHidden=fe)&&!we&&(l.mode&1)!==0)for(Be=l,we=l.child;we!==null;){for(Te=Be=we;Be!==null;){switch(_e=Be,De=_e.child,_e.tag){case 0:case 11:case 14:case 15:Bc(4,_e,_e.return);break;case 1:nl(_e,_e.return);var Ve=_e.stateNode;if(typeof Ve.componentWillUnmount=="function"){g=_e,d=_e.return;try{c=g,Ve.props=c.memoizedProps,Ve.state=c.memoizedState,Ve.componentWillUnmount()}catch($e){nn(g,d,$e)}}break;case 5:nl(_e,_e.return);break;case 22:if(_e.memoizedState!==null){B2(Te);continue}}De!==null?(De.return=_e,Be=De):B2(Te)}we=we.sibling}e:for(we=null,Te=l;;){if(Te.tag===5){if(we===null){we=Te;try{_=Te.stateNode,fe?(y=_.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(z=Te.stateNode,X=Te.memoizedProps.style,A=X!=null&&X.hasOwnProperty("display")?X.display:null,z.style.display=ir("display",A))}catch($e){nn(l,l.return,$e)}}}else if(Te.tag===6){if(we===null)try{Te.stateNode.nodeValue=fe?"":Te.memoizedProps}catch($e){nn(l,l.return,$e)}}else if((Te.tag!==22&&Te.tag!==23||Te.memoizedState===null||Te===l)&&Te.child!==null){Te.child.return=Te,Te=Te.child;continue}if(Te===l)break e;for(;Te.sibling===null;){if(Te.return===null||Te.return===l)break e;we===Te&&(we=null),Te=Te.return}we===Te&&(we=null),Te.sibling.return=Te.return,Te=Te.sibling}}break;case 19:is(c,l),Rs(l),g&4&&N2(l);break;case 21:break;default:is(c,l),Rs(l)}}function Rs(l){var c=l.flags;if(c&2){try{e:{for(var d=l.return;d!==null;){if(M2(d)){var g=d;break e}d=d.return}throw Error(t(160))}switch(g.tag){case 5:var _=g.stateNode;g.flags&32&&(On(_,""),g.flags&=-33);var y=k2(l);Sm(l,y,_);break;case 3:case 4:var A=g.stateNode.containerInfo,z=k2(l);Tm(l,z,A);break;default:throw Error(t(161))}}catch(X){nn(l,l.return,X)}l.flags&=-3}c&4096&&(l.flags&=-4097)}function vP(l,c,d){Be=l,L2(l)}function L2(l,c,d){for(var g=(l.mode&1)!==0;Be!==null;){var _=Be,y=_.child;if(_.tag===22&&g){var A=_.memoizedState!==null||lh;if(!A){var z=_.alternate,X=z!==null&&z.memoizedState!==null||Wn;z=lh;var fe=Wn;if(lh=A,(Wn=X)&&!fe)for(Be=_;Be!==null;)A=Be,X=A.child,A.tag===22&&A.memoizedState!==null?U2(_):X!==null?(X.return=A,Be=X):U2(_);for(;y!==null;)Be=y,L2(y),y=y.sibling;Be=_,lh=z,Wn=fe}F2(l)}else(_.subtreeFlags&8772)!==0&&y!==null?(y.return=_,Be=y):F2(l)}}function F2(l){for(;Be!==null;){var c=Be;if((c.flags&8772)!==0){var d=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:Wn||ch(5,c);break;case 1:var g=c.stateNode;if(c.flags&4&&!Wn)if(d===null)g.componentDidMount();else{var _=c.elementType===c.type?d.memoizedProps:rs(c.type,d.memoizedProps);g.componentDidUpdate(_,d.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var y=c.updateQueue;y!==null&&Bx(c,y,g);break;case 3:var A=c.updateQueue;if(A!==null){if(d=null,c.child!==null)switch(c.child.tag){case 5:d=c.child.stateNode;break;case 1:d=c.child.stateNode}Bx(c,A,d)}break;case 5:var z=c.stateNode;if(d===null&&c.flags&4){d=z;var X=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":X.autoFocus&&d.focus();break;case"img":X.src&&(d.src=X.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var fe=c.alternate;if(fe!==null){var we=fe.memoizedState;if(we!==null){var Te=we.dehydrated;Te!==null&&mc(Te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Wn||c.flags&512&&bm(c)}catch(_e){nn(c,c.return,_e)}}if(c===l){Be=null;break}if(d=c.sibling,d!==null){d.return=c.return,Be=d;break}Be=c.return}}function B2(l){for(;Be!==null;){var c=Be;if(c===l){Be=null;break}var d=c.sibling;if(d!==null){d.return=c.return,Be=d;break}Be=c.return}}function U2(l){for(;Be!==null;){var c=Be;try{switch(c.tag){case 0:case 11:case 15:var d=c.return;try{ch(4,c)}catch(X){nn(c,d,X)}break;case 1:var g=c.stateNode;if(typeof g.componentDidMount=="function"){var _=c.return;try{g.componentDidMount()}catch(X){nn(c,_,X)}}var y=c.return;try{bm(c)}catch(X){nn(c,y,X)}break;case 5:var A=c.return;try{bm(c)}catch(X){nn(c,A,X)}}}catch(X){nn(c,c.return,X)}if(c===l){Be=null;break}var z=c.sibling;if(z!==null){z.return=c.return,Be=z;break}Be=c.return}}var _P=Math.ceil,uh=L.ReactCurrentDispatcher,Em=L.ReactCurrentOwner,$r=L.ReactCurrentBatchConfig,mt=0,Pn=null,gn=null,Dn=0,Rr=0,rl=Ii(0),Sn=0,Uc=null,Vo=0,fh=0,Am=0,Vc=null,gr=null,Rm=0,sl=1/0,Js=null,hh=!1,Cm=null,Li=null,dh=!1,Fi=null,ph=0,zc=0,Pm=null,gh=-1,mh=0;function tr(){return(mt&6)!==0?zt():gh!==-1?gh:gh=zt()}function Bi(l){return(l.mode&1)===0?1:(mt&2)!==0&&Dn!==0?Dn&-Dn:tP.transition!==null?(mh===0&&(mh=La()),mh):(l=M,l!==0||(l=window.event,l=l===void 0?16:z1(l.type)),l)}function os(l,c,d,g){if(50<zc)throw zc=0,Pm=null,Error(t(185));ko(l,d,g),((mt&2)===0||l!==Pn)&&(l===Pn&&((mt&2)===0&&(fh|=d),Sn===4&&Ui(l,Dn)),mr(l,g),d===1&&mt===0&&(c.mode&1)===0&&(sl=zt()+500,Wf&&ki()))}function mr(l,c){var d=l.callbackNode;hg(l,c);var g=Hs(l,l===Pn?Dn:0);if(g===0)d!==null&&wi(d),l.callbackNode=null,l.callbackPriority=0;else if(c=g&-g,l.callbackPriority!==c){if(d!=null&&wi(d),c===1)l.tag===0?eP(z2.bind(null,l)):Ax(z2.bind(null,l)),ZC(function(){(mt&6)===0&&ki()}),d=null;else{switch($(g)){case 1:d=bs;break;case 4:d=es;break;case 16:d=ur;break;case 536870912:d=wr;break;default:d=ur}d=K2(d,V2.bind(null,l))}l.callbackPriority=c,l.callbackNode=d}}function V2(l,c){if(gh=-1,mh=0,(mt&6)!==0)throw Error(t(327));var d=l.callbackNode;if(il()&&l.callbackNode!==d)return null;var g=Hs(l,l===Pn?Dn:0);if(g===0)return null;if((g&30)!==0||(g&l.expiredLanes)!==0||c)c=vh(l,g);else{c=g;var _=mt;mt|=2;var y=j2();(Pn!==l||Dn!==c)&&(Js=null,sl=zt()+500,$o(l,c));do try{wP();break}catch(z){$2(l,z)}while(!0);Yg(),uh.current=y,mt=_,gn!==null?c=0:(Pn=null,Dn=0,c=Sn)}if(c!==0){if(c===2&&(_=Da(l),_!==0&&(g=_,c=Im(l,_))),c===1)throw d=Uc,$o(l,0),Ui(l,g),mr(l,zt()),d;if(c===6)Ui(l,g);else{if(_=l.current.alternate,(g&30)===0&&!yP(_)&&(c=vh(l,g),c===2&&(y=Da(l),y!==0&&(g=y,c=Im(l,y))),c===1))throw d=Uc,$o(l,0),Ui(l,g),mr(l,zt()),d;switch(l.finishedWork=_,l.finishedLanes=g,c){case 0:case 1:throw Error(t(345));case 2:jo(l,gr,Js);break;case 3:if(Ui(l,g),(g&130023424)===g&&(c=Rm+500-zt(),10<c)){if(Hs(l,0)!==0)break;if(_=l.suspendedLanes,(_&g)!==g){tr(),l.pingedLanes|=l.suspendedLanes&_;break}l.timeoutHandle=Lg(jo.bind(null,l,gr,Js),c);break}jo(l,gr,Js);break;case 4:if(Ui(l,g),(g&4194240)===g)break;for(c=l.eventTimes,_=-1;0<g;){var A=31-Vn(g);y=1<<A,A=c[A],A>_&&(_=A),g&=~y}if(g=_,g=zt()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*_P(g/1960))-g,10<g){l.timeoutHandle=Lg(jo.bind(null,l,gr,Js),g);break}jo(l,gr,Js);break;case 5:jo(l,gr,Js);break;default:throw Error(t(329))}}}return mr(l,zt()),l.callbackNode===d?V2.bind(null,l):null}function Im(l,c){var d=Vc;return l.current.memoizedState.isDehydrated&&($o(l,c).flags|=256),l=vh(l,c),l!==2&&(c=gr,gr=d,c!==null&&Mm(c)),l}function Mm(l){gr===null?gr=l:gr.push.apply(gr,l)}function yP(l){for(var c=l;;){if(c.flags&16384){var d=c.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var g=0;g<d.length;g++){var _=d[g],y=_.getSnapshot;_=_.value;try{if(!ts(y(),_))return!1}catch{return!1}}}if(d=c.child,c.subtreeFlags&16384&&d!==null)d.return=c,c=d;else{if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Ui(l,c){for(c&=~Am,c&=~fh,l.suspendedLanes|=c,l.pingedLanes&=~c,l=l.expirationTimes;0<c;){var d=31-Vn(c),g=1<<d;l[d]=-1,c&=~g}}function z2(l){if((mt&6)!==0)throw Error(t(327));il();var c=Hs(l,0);if((c&1)===0)return mr(l,zt()),null;var d=vh(l,c);if(l.tag!==0&&d===2){var g=Da(l);g!==0&&(c=g,d=Im(l,g))}if(d===1)throw d=Uc,$o(l,0),Ui(l,c),mr(l,zt()),d;if(d===6)throw Error(t(345));return l.finishedWork=l.current.alternate,l.finishedLanes=c,jo(l,gr,Js),mr(l,zt()),null}function km(l,c){var d=mt;mt|=1;try{return l(c)}finally{mt=d,mt===0&&(sl=zt()+500,Wf&&ki())}}function zo(l){Fi!==null&&Fi.tag===0&&(mt&6)===0&&il();var c=mt;mt|=1;var d=$r.transition,g=M;try{if($r.transition=null,M=1,l)return l()}finally{M=g,$r.transition=d,mt=c,(mt&6)===0&&ki()}}function Om(){Rr=rl.current,Yt(rl)}function $o(l,c){l.finishedWork=null,l.finishedLanes=0;var d=l.timeoutHandle;if(d!==-1&&(l.timeoutHandle=-1,KC(d)),gn!==null)for(d=gn.return;d!==null;){var g=d;switch($g(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&$f();break;case 3:el(),Yt(hr),Yt(zn),tm();break;case 5:Jg(g);break;case 4:el();break;case 13:Yt(en);break;case 19:Yt(en);break;case 10:qg(g.type._context);break;case 22:case 23:Om()}d=d.return}if(Pn=l,gn=l=Vi(l.current,null),Dn=Rr=c,Sn=0,Uc=null,Am=fh=Vo=0,gr=Vc=null,Fo!==null){for(c=0;c<Fo.length;c++)if(d=Fo[c],g=d.interleaved,g!==null){d.interleaved=null;var _=g.next,y=d.pending;if(y!==null){var A=y.next;y.next=_,g.next=A}d.pending=g}Fo=null}return l}function $2(l,c){do{var d=gn;try{if(Yg(),eh.current=sh,th){for(var g=tn.memoizedState;g!==null;){var _=g.queue;_!==null&&(_.pending=null),g=g.next}th=!1}if(Uo=0,Cn=Tn=tn=null,Oc=!1,Nc=0,Em.current=null,d===null||d.return===null){Sn=1,Uc=c,gn=null;break}e:{var y=l,A=d.return,z=d,X=c;if(c=Dn,z.flags|=32768,X!==null&&typeof X=="object"&&typeof X.then=="function"){var fe=X,we=z,Te=we.tag;if((we.mode&1)===0&&(Te===0||Te===11||Te===15)){var _e=we.alternate;_e?(we.updateQueue=_e.updateQueue,we.memoizedState=_e.memoizedState,we.lanes=_e.lanes):(we.updateQueue=null,we.memoizedState=null)}var De=d2(A);if(De!==null){De.flags&=-257,p2(De,A,z,y,c),De.mode&1&&h2(y,fe,c),c=De,X=fe;var Ve=c.updateQueue;if(Ve===null){var $e=new Set;$e.add(X),c.updateQueue=$e}else Ve.add(X);break e}else{if((c&1)===0){h2(y,fe,c),Nm();break e}X=Error(t(426))}}else if(Zt&&z.mode&1){var dn=d2(A);if(dn!==null){(dn.flags&65536)===0&&(dn.flags|=256),p2(dn,A,z,y,c),Hg(tl(X,z));break e}}y=X=tl(X,z),Sn!==4&&(Sn=2),Vc===null?Vc=[y]:Vc.push(y),y=A;do{switch(y.tag){case 3:y.flags|=65536,c&=-c,y.lanes|=c;var ie=u2(y,X,c);Fx(y,ie);break e;case 1:z=X;var Z=y.type,ae=y.stateNode;if((y.flags&128)===0&&(typeof Z.getDerivedStateFromError=="function"||ae!==null&&typeof ae.componentDidCatch=="function"&&(Li===null||!Li.has(ae)))){y.flags|=65536,c&=-c,y.lanes|=c;var Re=f2(y,z,c);Fx(y,Re);break e}}y=y.return}while(y!==null)}H2(d)}catch(je){c=je,gn===d&&d!==null&&(gn=d=d.return);continue}break}while(!0)}function j2(){var l=uh.current;return uh.current=sh,l===null?sh:l}function Nm(){(Sn===0||Sn===3||Sn===2)&&(Sn=4),Pn===null||(Vo&268435455)===0&&(fh&268435455)===0||Ui(Pn,Dn)}function vh(l,c){var d=mt;mt|=2;var g=j2();(Pn!==l||Dn!==c)&&(Js=null,$o(l,c));do try{xP();break}catch(_){$2(l,_)}while(!0);if(Yg(),mt=d,uh.current=g,gn!==null)throw Error(t(261));return Pn=null,Dn=0,Sn}function xP(){for(;gn!==null;)W2(gn)}function wP(){for(;gn!==null&&!uc();)W2(gn)}function W2(l){var c=q2(l.alternate,l,Rr);l.memoizedProps=l.pendingProps,c===null?H2(l):gn=c,Em.current=null}function H2(l){var c=l;do{var d=c.alternate;if(l=c.return,(c.flags&32768)===0){if(d=dP(d,c,Rr),d!==null){gn=d;return}}else{if(d=pP(d,c),d!==null){d.flags&=32767,gn=d;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{Sn=6,gn=null;return}}if(c=c.sibling,c!==null){gn=c;return}gn=c=l}while(c!==null);Sn===0&&(Sn=5)}function jo(l,c,d){var g=M,_=$r.transition;try{$r.transition=null,M=1,bP(l,c,d,g)}finally{$r.transition=_,M=g}return null}function bP(l,c,d,g){do il();while(Fi!==null);if((mt&6)!==0)throw Error(t(327));d=l.finishedWork;var _=l.finishedLanes;if(d===null)return null;if(l.finishedWork=null,l.finishedLanes=0,d===l.current)throw Error(t(177));l.callbackNode=null,l.callbackPriority=0;var y=d.lanes|d.childLanes;if(dg(l,y),l===Pn&&(gn=Pn=null,Dn=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||dh||(dh=!0,K2(ur,function(){return il(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=$r.transition,$r.transition=null;var A=M;M=1;var z=mt;mt|=4,Em.current=null,mP(l,d),D2(d,l),$C(Ng),Cf=!!Og,Ng=Og=null,l.current=d,vP(d),fg(),mt=z,M=A,$r.transition=y}else l.current=d;if(dh&&(dh=!1,Fi=l,ph=_),y=l.pendingLanes,y===0&&(Li=null),Af(d.stateNode),mr(l,zt()),c!==null)for(g=l.onRecoverableError,d=0;d<c.length;d++)_=c[d],g(_.value,{componentStack:_.stack,digest:_.digest});if(hh)throw hh=!1,l=Cm,Cm=null,l;return(ph&1)!==0&&l.tag!==0&&il(),y=l.pendingLanes,(y&1)!==0?l===Pm?zc++:(zc=0,Pm=l):zc=0,ki(),null}function il(){if(Fi!==null){var l=$(ph),c=$r.transition,d=M;try{if($r.transition=null,M=16>l?16:l,Fi===null)var g=!1;else{if(l=Fi,Fi=null,ph=0,(mt&6)!==0)throw Error(t(331));var _=mt;for(mt|=4,Be=l.current;Be!==null;){var y=Be,A=y.child;if((Be.flags&16)!==0){var z=y.deletions;if(z!==null){for(var X=0;X<z.length;X++){var fe=z[X];for(Be=fe;Be!==null;){var we=Be;switch(we.tag){case 0:case 11:case 15:Bc(8,we,y)}var Te=we.child;if(Te!==null)Te.return=we,Be=Te;else for(;Be!==null;){we=Be;var _e=we.sibling,De=we.return;if(I2(we),we===fe){Be=null;break}if(_e!==null){_e.return=De,Be=_e;break}Be=De}}}var Ve=y.alternate;if(Ve!==null){var $e=Ve.child;if($e!==null){Ve.child=null;do{var dn=$e.sibling;$e.sibling=null,$e=dn}while($e!==null)}}Be=y}}if((y.subtreeFlags&2064)!==0&&A!==null)A.return=y,Be=A;else e:for(;Be!==null;){if(y=Be,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Bc(9,y,y.return)}var ie=y.sibling;if(ie!==null){ie.return=y.return,Be=ie;break e}Be=y.return}}var Z=l.current;for(Be=Z;Be!==null;){A=Be;var ae=A.child;if((A.subtreeFlags&2064)!==0&&ae!==null)ae.return=A,Be=ae;else e:for(A=Z;Be!==null;){if(z=Be,(z.flags&2048)!==0)try{switch(z.tag){case 0:case 11:case 15:ch(9,z)}}catch(je){nn(z,z.return,je)}if(z===A){Be=null;break e}var Re=z.sibling;if(Re!==null){Re.return=z.return,Be=Re;break e}Be=z.return}}if(mt=_,ki(),br&&typeof br.onPostCommitFiberRoot=="function")try{br.onPostCommitFiberRoot(fr,l)}catch{}g=!0}return g}finally{M=d,$r.transition=c}}return!1}function X2(l,c,d){c=tl(d,c),c=u2(l,c,1),l=Ni(l,c,1),c=tr(),l!==null&&(ko(l,1,c),mr(l,c))}function nn(l,c,d){if(l.tag===3)X2(l,l,d);else for(;c!==null;){if(c.tag===3){X2(c,l,d);break}else if(c.tag===1){var g=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Li===null||!Li.has(g))){l=tl(d,l),l=f2(c,l,1),c=Ni(c,l,1),l=tr(),c!==null&&(ko(c,1,l),mr(c,l));break}}c=c.return}}function TP(l,c,d){var g=l.pingCache;g!==null&&g.delete(c),c=tr(),l.pingedLanes|=l.suspendedLanes&d,Pn===l&&(Dn&d)===d&&(Sn===4||Sn===3&&(Dn&130023424)===Dn&&500>zt()-Rm?$o(l,0):Am|=d),mr(l,c)}function Y2(l,c){c===0&&((l.mode&1)===0?c=1:(c=Ti,Ti<<=1,(Ti&130023424)===0&&(Ti=4194304)));var d=tr();l=Zs(l,c),l!==null&&(ko(l,c,d),mr(l,d))}function SP(l){var c=l.memoizedState,d=0;c!==null&&(d=c.retryLane),Y2(l,d)}function EP(l,c){var d=0;switch(l.tag){case 13:var g=l.stateNode,_=l.memoizedState;_!==null&&(d=_.retryLane);break;case 19:g=l.stateNode;break;default:throw Error(t(314))}g!==null&&g.delete(c),Y2(l,d)}var q2;q2=function(l,c,d){if(l!==null)if(l.memoizedProps!==c.pendingProps||hr.current)pr=!0;else{if((l.lanes&d)===0&&(c.flags&128)===0)return pr=!1,hP(l,c,d);pr=(l.flags&131072)!==0}else pr=!1,Zt&&(c.flags&1048576)!==0&&Rx(c,Xf,c.index);switch(c.lanes=0,c.tag){case 2:var g=c.type;ah(l,c),l=c.pendingProps;var _=Ya(c,zn.current);Ja(c,d),_=sm(null,c,g,l,_,d);var y=im();return c.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,dr(g)?(y=!0,jf(c)):y=!1,c.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Qg(c),_.updater=ih,c.stateNode=_,_._reactInternals=c,fm(c,g,l,d),c=gm(null,c,g,!0,y,d)):(c.tag=0,Zt&&y&&zg(c),er(null,c,_,d),c=c.child),c;case 16:g=c.elementType;e:{switch(ah(l,c),l=c.pendingProps,_=g._init,g=_(g._payload),c.type=g,_=c.tag=RP(g),l=rs(g,l),_){case 0:c=pm(null,c,g,l,d);break e;case 1:c=x2(null,c,g,l,d);break e;case 11:c=g2(null,c,g,l,d);break e;case 14:c=m2(null,c,g,rs(g.type,l),d);break e}throw Error(t(306,g,""))}return c;case 0:return g=c.type,_=c.pendingProps,_=c.elementType===g?_:rs(g,_),pm(l,c,g,_,d);case 1:return g=c.type,_=c.pendingProps,_=c.elementType===g?_:rs(g,_),x2(l,c,g,_,d);case 3:e:{if(w2(c),l===null)throw Error(t(387));g=c.pendingProps,y=c.memoizedState,_=y.element,Lx(l,c),Gf(c,g,null,d);var A=c.memoizedState;if(g=A.element,y.isDehydrated)if(y={element:g,isDehydrated:!1,cache:A.cache,pendingSuspenseBoundaries:A.pendingSuspenseBoundaries,transitions:A.transitions},c.updateQueue.baseState=y,c.memoizedState=y,c.flags&256){_=tl(Error(t(423)),c),c=b2(l,c,g,d,_);break e}else if(g!==_){_=tl(Error(t(424)),c),c=b2(l,c,g,d,_);break e}else for(Ar=Pi(c.stateNode.containerInfo.firstChild),Er=c,Zt=!0,ns=null,d=Nx(c,null,g,d),c.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Za(),g===_){c=Gs(l,c,d);break e}er(l,c,g,d)}c=c.child}return c;case 5:return Ux(c),l===null&&Wg(c),g=c.type,_=c.pendingProps,y=l!==null?l.memoizedProps:null,A=_.children,Dg(g,_)?A=null:y!==null&&Dg(g,y)&&(c.flags|=32),y2(l,c),er(l,c,A,d),c.child;case 6:return l===null&&Wg(c),null;case 13:return T2(l,c,d);case 4:return Gg(c,c.stateNode.containerInfo),g=c.pendingProps,l===null?c.child=Qa(c,null,g,d):er(l,c,g,d),c.child;case 11:return g=c.type,_=c.pendingProps,_=c.elementType===g?_:rs(g,_),g2(l,c,g,_,d);case 7:return er(l,c,c.pendingProps,d),c.child;case 8:return er(l,c,c.pendingProps.children,d),c.child;case 12:return er(l,c,c.pendingProps.children,d),c.child;case 10:e:{if(g=c.type._context,_=c.pendingProps,y=c.memoizedProps,A=_.value,$t(Kf,g._currentValue),g._currentValue=A,y!==null)if(ts(y.value,A)){if(y.children===_.children&&!hr.current){c=Gs(l,c,d);break e}}else for(y=c.child,y!==null&&(y.return=c);y!==null;){var z=y.dependencies;if(z!==null){A=y.child;for(var X=z.firstContext;X!==null;){if(X.context===g){if(y.tag===1){X=Qs(-1,d&-d),X.tag=2;var fe=y.updateQueue;if(fe!==null){fe=fe.shared;var we=fe.pending;we===null?X.next=X:(X.next=we.next,we.next=X),fe.pending=X}}y.lanes|=d,X=y.alternate,X!==null&&(X.lanes|=d),Kg(y.return,d,c),z.lanes|=d;break}X=X.next}}else if(y.tag===10)A=y.type===c.type?null:y.child;else if(y.tag===18){if(A=y.return,A===null)throw Error(t(341));A.lanes|=d,z=A.alternate,z!==null&&(z.lanes|=d),Kg(A,d,c),A=y.sibling}else A=y.child;if(A!==null)A.return=y;else for(A=y;A!==null;){if(A===c){A=null;break}if(y=A.sibling,y!==null){y.return=A.return,A=y;break}A=A.return}y=A}er(l,c,_.children,d),c=c.child}return c;case 9:return _=c.type,g=c.pendingProps.children,Ja(c,d),_=Vr(_),g=g(_),c.flags|=1,er(l,c,g,d),c.child;case 14:return g=c.type,_=rs(g,c.pendingProps),_=rs(g.type,_),m2(l,c,g,_,d);case 15:return v2(l,c,c.type,c.pendingProps,d);case 17:return g=c.type,_=c.pendingProps,_=c.elementType===g?_:rs(g,_),ah(l,c),c.tag=1,dr(g)?(l=!0,jf(c)):l=!1,Ja(c,d),l2(c,g,_),fm(c,g,_,d),gm(null,c,g,!0,l,d);case 19:return E2(l,c,d);case 22:return _2(l,c,d)}throw Error(t(156,c.tag))};function K2(l,c){return lr(l,c)}function AP(l,c,d,g){this.tag=l,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jr(l,c,d,g){return new AP(l,c,d,g)}function Dm(l){return l=l.prototype,!(!l||!l.isReactComponent)}function RP(l){if(typeof l=="function")return Dm(l)?1:0;if(l!=null){if(l=l.$$typeof,l===pe)return 11;if(l===Me)return 14}return 2}function Vi(l,c){var d=l.alternate;return d===null?(d=jr(l.tag,c,l.key,l.mode),d.elementType=l.elementType,d.type=l.type,d.stateNode=l.stateNode,d.alternate=l,l.alternate=d):(d.pendingProps=c,d.type=l.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=l.flags&14680064,d.childLanes=l.childLanes,d.lanes=l.lanes,d.child=l.child,d.memoizedProps=l.memoizedProps,d.memoizedState=l.memoizedState,d.updateQueue=l.updateQueue,c=l.dependencies,d.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},d.sibling=l.sibling,d.index=l.index,d.ref=l.ref,d}function _h(l,c,d,g,_,y){var A=2;if(g=l,typeof l=="function")Dm(l)&&(A=1);else if(typeof l=="string")A=5;else e:switch(l){case j:return Wo(d.children,_,y,c);case q:A=8,_|=8;break;case Q:return l=jr(12,d,c,_|2),l.elementType=Q,l.lanes=y,l;case ne:return l=jr(13,d,c,_),l.elementType=ne,l.lanes=y,l;case ve:return l=jr(19,d,c,_),l.elementType=ve,l.lanes=y,l;case H:return yh(d,_,y,c);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case le:A=10;break e;case he:A=9;break e;case pe:A=11;break e;case Me:A=14;break e;case U:A=16,g=null;break e}throw Error(t(130,l==null?l:typeof l,""))}return c=jr(A,d,c,_),c.elementType=l,c.type=g,c.lanes=y,c}function Wo(l,c,d,g){return l=jr(7,l,g,c),l.lanes=d,l}function yh(l,c,d,g){return l=jr(22,l,g,c),l.elementType=H,l.lanes=d,l.stateNode={isHidden:!1},l}function Lm(l,c,d){return l=jr(6,l,null,c),l.lanes=d,l}function Fm(l,c,d){return c=jr(4,l.children!==null?l.children:[],l.key,c),c.lanes=d,c.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},c}function CP(l,c,d,g,_){this.tag=c,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fa(0),this.expirationTimes=Fa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fa(0),this.identifierPrefix=g,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Bm(l,c,d,g,_,y,A,z,X){return l=new CP(l,c,d,z,X),c===1?(c=1,y===!0&&(c|=8)):c=0,y=jr(3,null,null,c),l.current=y,y.stateNode=l,y.memoizedState={element:g,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qg(y),l}function PP(l,c,d){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:F,key:g==null?null:""+g,children:l,containerInfo:c,implementation:d}}function Z2(l){if(!l)return Mi;l=l._reactInternals;e:{if(Lr(l)!==l||l.tag!==1)throw Error(t(170));var c=l;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(dr(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(t(171))}if(l.tag===1){var d=l.type;if(dr(d))return Sx(l,d,c)}return c}function Q2(l,c,d,g,_,y,A,z,X){return l=Bm(d,g,!0,l,_,y,A,z,X),l.context=Z2(null),d=l.current,g=tr(),_=Bi(d),y=Qs(g,_),y.callback=c??null,Ni(d,y,_),l.current.lanes=_,ko(l,_,g),mr(l,g),l}function xh(l,c,d,g){var _=c.current,y=tr(),A=Bi(_);return d=Z2(d),c.context===null?c.context=d:c.pendingContext=d,c=Qs(y,A),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=Ni(_,c,A),l!==null&&(os(l,_,A,y),Qf(l,_,A)),A}function wh(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function G2(l,c){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var d=l.retryLane;l.retryLane=d!==0&&d<c?d:c}}function Um(l,c){G2(l,c),(l=l.alternate)&&G2(l,c)}function IP(){return null}var J2=typeof reportError=="function"?reportError:function(l){console.error(l)};function Vm(l){this._internalRoot=l}bh.prototype.render=Vm.prototype.render=function(l){var c=this._internalRoot;if(c===null)throw Error(t(409));xh(l,c,null,null)},bh.prototype.unmount=Vm.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var c=l.containerInfo;zo(function(){xh(null,l,null,null)}),c[Xs]=null}};function bh(l){this._internalRoot=l}bh.prototype.unstable_scheduleHydration=function(l){if(l){var c=at();l={blockedOn:null,target:l,priority:c};for(var d=0;d<Ai.length&&c!==0&&c<Ai[d].priority;d++);Ai.splice(d,0,l),d===0&&U1(l)}};function zm(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function Th(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function e3(){}function MP(l,c,d,g,_){if(_){if(typeof g=="function"){var y=g;g=function(){var fe=wh(A);y.call(fe)}}var A=Q2(c,g,l,0,null,!1,!1,"",e3);return l._reactRootContainer=A,l[Xs]=A.current,Ec(l.nodeType===8?l.parentNode:l),zo(),A}for(;_=l.lastChild;)l.removeChild(_);if(typeof g=="function"){var z=g;g=function(){var fe=wh(X);z.call(fe)}}var X=Bm(l,0,!1,null,null,!1,!1,"",e3);return l._reactRootContainer=X,l[Xs]=X.current,Ec(l.nodeType===8?l.parentNode:l),zo(function(){xh(c,X,d,g)}),X}function Sh(l,c,d,g,_){var y=d._reactRootContainer;if(y){var A=y;if(typeof _=="function"){var z=_;_=function(){var X=wh(A);z.call(X)}}xh(c,A,l,_)}else A=MP(d,c,l,_,g);return wh(A)}ue=function(l){switch(l.tag){case 3:var c=l.stateNode;if(c.current.memoizedState.isDehydrated){var d=Ws(c.pendingLanes);d!==0&&(R(c,d|1),mr(c,zt()),(mt&6)===0&&(sl=zt()+500,ki()))}break;case 13:zo(function(){var g=Zs(l,1);if(g!==null){var _=tr();os(g,l,1,_)}}),Um(l,1)}},ye=function(l){if(l.tag===13){var c=Zs(l,134217728);if(c!==null){var d=tr();os(c,l,134217728,d)}Um(l,134217728)}},Ne=function(l){if(l.tag===13){var c=Bi(l),d=Zs(l,c);if(d!==null){var g=tr();os(d,l,c,g)}Um(l,c)}},at=function(){return M},fn=function(l,c){var d=M;try{return M=l,c()}finally{M=d}},Gr=function(l,c,d){switch(c){case"input":if(lt(l,d),c=d.name,d.type==="radio"&&c!=null){for(d=l;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<d.length;c++){var g=d[c];if(g!==l&&g.form===l.form){var _=zf(g);if(!_)throw Error(t(90));Ke(g),lt(g,_)}}}break;case"textarea":Ft(l,d);break;case"select":c=d.value,c!=null&&ht(l,!!d.multiple,c,!1)}},ka=km,_i=zo;var kP={usingClientEntryPoint:!1,Events:[Cc,Ha,zf,Dr,vi,km]},$c={findFiberByHostInstance:Oo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},OP={bundleType:$c.bundleType,version:$c.version,rendererPackageName:$c.rendererPackageName,rendererConfig:$c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:L.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=Jr(l),l===null?null:l.stateNode},findFiberByHostInstance:$c.findFiberByHostInstance||IP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Eh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Eh.isDisabled&&Eh.supportsFiber)try{fr=Eh.inject(OP),br=Eh}catch{}}return vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kP,vr.createPortal=function(l,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zm(c))throw Error(t(200));return PP(l,c,null,d)},vr.createRoot=function(l,c){if(!zm(l))throw Error(t(299));var d=!1,g="",_=J2;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onRecoverableError!==void 0&&(_=c.onRecoverableError)),c=Bm(l,1,!1,null,null,d,!1,g,_),l[Xs]=c.current,Ec(l.nodeType===8?l.parentNode:l),new Vm(c)},vr.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var c=l._reactInternals;if(c===void 0)throw typeof l.render=="function"?Error(t(188)):(l=Object.keys(l).join(","),Error(t(268,l)));return l=Jr(c),l=l===null?null:l.stateNode,l},vr.flushSync=function(l){return zo(l)},vr.hydrate=function(l,c,d){if(!Th(c))throw Error(t(200));return Sh(null,l,c,!0,d)},vr.hydrateRoot=function(l,c,d){if(!zm(l))throw Error(t(405));var g=d!=null&&d.hydratedSources||null,_=!1,y="",A=J2;if(d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(A=d.onRecoverableError)),c=Q2(c,null,l,1,d??null,_,!1,y,A),l[Xs]=c.current,Ec(l),g)for(l=0;l<g.length;l++)d=g[l],_=d._getVersion,_=_(d._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[d,_]:c.mutableSourceEagerHydrationData.push(d,_);return new bh(c)},vr.render=function(l,c,d){if(!Th(c))throw Error(t(200));return Sh(null,l,c,!1,d)},vr.unmountComponentAtNode=function(l){if(!Th(l))throw Error(t(40));return l._reactRootContainer?(zo(function(){Sh(null,null,l,!1,function(){l._reactRootContainer=null,l[Xs]=null})}),!0):!1},vr.unstable_batchedUpdates=km,vr.unstable_renderSubtreeIntoContainer=function(l,c,d,g){if(!Th(d))throw Error(t(200));if(l==null||l._reactInternals===void 0)throw Error(t(38));return Sh(l,c,d,!1,g)},vr.version="18.3.1-next-f1338f8080-20240426",vr}var L3;function JS(){if(L3)return p0.exports;L3=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),p0.exports=vM(),p0.exports}var To=JS();const Rh=Ea(To);var jp=!0,Cv=!1,F3=null,_M={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function yM(n){var e=n.type,t=n.tagName;return!!(t==="INPUT"&&_M[e]&&!n.readOnly||t==="TEXTAREA"&&!n.readOnly||n.isContentEditable)}function xM(n){n.metaKey||n.altKey||n.ctrlKey||(jp=!0)}function v0(){jp=!1}function wM(){this.visibilityState==="hidden"&&Cv&&(jp=!0)}function bM(n){n.addEventListener("keydown",xM,!0),n.addEventListener("mousedown",v0,!0),n.addEventListener("pointerdown",v0,!0),n.addEventListener("touchstart",v0,!0),n.addEventListener("visibilitychange",wM,!0)}function TM(n){var e=n.target;try{return e.matches(":focus-visible")}catch{}return jp||yM(e)}function SM(){Cv=!0,window.clearTimeout(F3),F3=window.setTimeout(function(){Cv=!1},100)}function py(){var n=B.useCallback(function(e){var t=To.findDOMNode(e);t!=null&&bM(t.ownerDocument)},[]);return{isFocusVisible:TM,onBlurVisible:SM,ref:n}}function EM(n){return ES(n)||SS(n)||ay(n)||AS()}const B3={disabled:!1},Ed=Wt.createContext(null);var AM=function(e){return e.scrollTop},su="unmounted",Xo="exited",Yo="entering",ml="entered",Pv="exiting",zs=function(n){Vp(e,n);function e(r,s){var i;i=n.call(this,r,s)||this;var o=s,a=o&&!o.isMounting?r.enter:r.appear,u;return i.appearStatus=null,r.in?a?(u=Xo,i.appearStatus=Yo):u=ml:r.unmountOnExit||r.mountOnEnter?u=su:u=Xo,i.state={status:u},i.nextCallback=null,i}e.getDerivedStateFromProps=function(s,i){var o=s.in;return o&&i.status===su?{status:Xo}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(s){var i=null;if(s!==this.props){var o=this.state.status;this.props.in?o!==Yo&&o!==ml&&(i=Yo):(o===Yo||o===ml)&&(i=Pv)}this.updateStatus(!1,i)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var s=this.props.timeout,i,o,a;return i=o=a=s,s!=null&&typeof s!="number"&&(i=s.exit,o=s.enter,a=s.appear!==void 0?s.appear:o),{exit:i,enter:o,appear:a}},t.updateStatus=function(s,i){if(s===void 0&&(s=!1),i!==null)if(this.cancelNextCallback(),i===Yo){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:Rh.findDOMNode(this);o&&AM(o)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Xo&&this.setState({status:su})},t.performEnter=function(s){var i=this,o=this.props.enter,a=this.context?this.context.isMounting:s,u=this.props.nodeRef?[a]:[Rh.findDOMNode(this),a],f=u[0],h=u[1],p=this.getTimeouts(),m=a?p.appear:p.enter;if(!s&&!o||B3.disabled){this.safeSetState({status:ml},function(){i.props.onEntered(f)});return}this.props.onEnter(f,h),this.safeSetState({status:Yo},function(){i.props.onEntering(f,h),i.onTransitionEnd(m,function(){i.safeSetState({status:ml},function(){i.props.onEntered(f,h)})})})},t.performExit=function(){var s=this,i=this.props.exit,o=this.getTimeouts(),a=this.props.nodeRef?void 0:Rh.findDOMNode(this);if(!i||B3.disabled){this.safeSetState({status:Xo},function(){s.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:Pv},function(){s.props.onExiting(a),s.onTransitionEnd(o.exit,function(){s.safeSetState({status:Xo},function(){s.props.onExited(a)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(s,i){i=this.setNextCallback(i),this.setState(s,i)},t.setNextCallback=function(s){var i=this,o=!0;return this.nextCallback=function(a){o&&(o=!1,i.nextCallback=null,s(a))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},t.onTransitionEnd=function(s,i){this.setNextCallback(i);var o=this.props.nodeRef?this.props.nodeRef.current:Rh.findDOMNode(this),a=s==null&&!this.props.addEndListener;if(!o||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var u=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],f=u[0],h=u[1];this.props.addEndListener(f,h)}s!=null&&setTimeout(this.nextCallback,s)},t.render=function(){var s=this.state.status;if(s===su)return null;var i=this.props,o=i.children;i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef;var a=Fp(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Wt.createElement(Ed.Provider,{value:null},typeof o=="function"?o(s,a):Wt.cloneElement(Wt.Children.only(o),a))},e}(Wt.Component);zs.contextType=Ed;zs.propTypes={};function ll(){}zs.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:ll,onEntering:ll,onEntered:ll,onExit:ll,onExiting:ll,onExited:ll};zs.UNMOUNTED=su;zs.EXITED=Xo;zs.ENTERING=Yo;zs.ENTERED=ml;zs.EXITING=Pv;function gy(n,e){var t=function(i){return e&&B.isValidElement(i)?e(i):i},r=Object.create(null);return n&&B.Children.map(n,function(s){return s}).forEach(function(s){r[s.key]=t(s)}),r}function RM(n,e){n=n||{},e=e||{};function t(h){return h in e?e[h]:n[h]}var r=Object.create(null),s=[];for(var i in n)i in e?s.length&&(r[i]=s,s=[]):s.push(i);var o,a={};for(var u in e){if(r[u])for(o=0;o<r[u].length;o++){var f=r[u][o];a[r[u][o]]=t(f)}a[u]=t(u)}for(o=0;o<s.length;o++)a[s[o]]=t(s[o]);return a}function Qo(n,e,t){return t[e]!=null?t[e]:n.props[e]}function CM(n,e){return gy(n.children,function(t){return B.cloneElement(t,{onExited:e.bind(null,t),in:!0,appear:Qo(t,"appear",n),enter:Qo(t,"enter",n),exit:Qo(t,"exit",n)})})}function PM(n,e,t){var r=gy(n.children),s=RM(e,r);return Object.keys(s).forEach(function(i){var o=s[i];if(B.isValidElement(o)){var a=i in e,u=i in r,f=e[i],h=B.isValidElement(f)&&!f.props.in;u&&(!a||h)?s[i]=B.cloneElement(o,{onExited:t.bind(null,o),in:!0,exit:Qo(o,"exit",n),enter:Qo(o,"enter",n)}):!u&&a&&!h?s[i]=B.cloneElement(o,{in:!1}):u&&a&&B.isValidElement(f)&&(s[i]=B.cloneElement(o,{onExited:t.bind(null,o),in:f.props.in,exit:Qo(o,"exit",n),enter:Qo(o,"enter",n)}))}}),s}var IM=Object.values||function(n){return Object.keys(n).map(function(e){return n[e]})},MM={component:"div",childFactory:function(e){return e}},my=function(n){Vp(e,n);function e(r,s){var i;i=n.call(this,r,s)||this;var o=i.handleExited.bind(vv(i));return i.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},i}var t=e.prototype;return t.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},t.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(s,i){var o=i.children,a=i.handleExited,u=i.firstRender;return{children:u?CM(s,a):PM(s,o,a),firstRender:!1}},t.handleExited=function(s,i){var o=gy(this.props.children);s.key in o||(s.props.onExited&&s.props.onExited(i),this.mounted&&this.setState(function(a){var u=Ee({},a.children);return delete u[s.key],{children:u}}))},t.render=function(){var s=this.props,i=s.component,o=s.childFactory,a=Fp(s,["component","childFactory"]),u=this.state.contextValue,f=IM(this.state.children).map(o);return delete a.appear,delete a.enter,delete a.exit,i===null?Wt.createElement(Ed.Provider,{value:u},f):Wt.createElement(Ed.Provider,{value:u},Wt.createElement(i,a,f))},e}(Wt.Component);my.propTypes={};my.defaultProps=MM;var kM=function(e){return e.scrollTop};function Ad(n,e){var t=n.timeout,r=n.style,s=r===void 0?{}:r;return{duration:s.transitionDuration||typeof t=="number"?t:t[e.mode]||0,delay:s.transitionDelay}}var OM=function(e){return{root:{height:0,overflow:"hidden",transition:e.transitions.create("height")},entered:{height:"auto",overflow:"visible"},hidden:{visibility:"hidden"},wrapper:{display:"flex"},wrapperInner:{width:"100%"}}},eE=B.forwardRef(function(e,t){var r=e.children,s=e.classes,i=e.className,o=e.collapsedHeight,a=e.collapsedSize,u=a===void 0?"0px":a,f=e.component,h=f===void 0?"div":f,p=e.disableStrictModeCompat,m=p===void 0?!1:p,v=e.in,x=e.onEnter,w=e.onEntered,T=e.onEntering,E=e.onExit,C=e.onExited,P=e.onExiting,L=e.style,I=e.timeout,F=I===void 0?gv.standard:I,j=e.TransitionComponent,q=j===void 0?zs:j,Q=Et(e,["children","classes","className","collapsedHeight","collapsedSize","component","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),le=dy(),he=B.useRef(),pe=B.useRef(null),ne=B.useRef(),ve=typeof(o||u)=="number"?"".concat(o||u,"px"):o||u;B.useEffect(function(){return function(){clearTimeout(he.current)}},[]);var Me=le.unstable_strictMode&&!m,U=B.useRef(null),H=Gn(t,Me?U:void 0),N=function(ce){return function(me,xe){if(ce){var Pe=Me?[U.current,me]:[me,xe],Ue=Up(Pe,2),Ke=Ue[0],tt=Ue[1];tt===void 0?ce(Ke):ce(Ke,tt)}}},Y=N(function(te,ce){te.style.height=ve,x&&x(te,ce)}),k=N(function(te,ce){var me=pe.current?pe.current.clientHeight:0,xe=Ad({style:L,timeout:F},{mode:"enter"}),Pe=xe.duration;if(F==="auto"){var Ue=le.transitions.getAutoHeightDuration(me);te.style.transitionDuration="".concat(Ue,"ms"),ne.current=Ue}else te.style.transitionDuration=typeof Pe=="string"?Pe:"".concat(Pe,"ms");te.style.height="".concat(me,"px"),T&&T(te,ce)}),b=N(function(te,ce){te.style.height="auto",w&&w(te,ce)}),O=N(function(te){var ce=pe.current?pe.current.clientHeight:0;te.style.height="".concat(ce,"px"),E&&E(te)}),W=N(C),K=N(function(te){var ce=pe.current?pe.current.clientHeight:0,me=Ad({style:L,timeout:F},{mode:"exit"}),xe=me.duration;if(F==="auto"){var Pe=le.transitions.getAutoHeightDuration(ce);te.style.transitionDuration="".concat(Pe,"ms"),ne.current=Pe}else te.style.transitionDuration=typeof xe=="string"?xe:"".concat(xe,"ms");te.style.height=ve,P&&P(te)}),ee=function(ce,me){var xe=Me?ce:me;F==="auto"&&(he.current=setTimeout(xe,ne.current||0))};return B.createElement(q,Ee({in:v,onEnter:Y,onEntered:b,onEntering:k,onExit:O,onExited:W,onExiting:K,addEndListener:ee,nodeRef:Me?U:void 0,timeout:F==="auto"?null:F},Q),function(te,ce){return B.createElement(h,Ee({className:Tt(s.root,s.container,i,{entered:s.entered,exited:!v&&ve==="0px"&&s.hidden}[te]),style:Ee({minHeight:ve},L),ref:H},ce),B.createElement("div",{className:s.wrapper,ref:pe},B.createElement("div",{className:s.wrapperInner},r)))})});eE.muiSupportAuto=!0;const NM=En(OM,{name:"MuiCollapse"})(eE);var DM=function(e){var t={};return e.shadows.forEach(function(r,s){t["elevation".concat(s)]={boxShadow:r}}),Ee({root:{backgroundColor:e.palette.background.paper,color:e.palette.text.primary,transition:e.transitions.create("box-shadow")},rounded:{borderRadius:e.shape.borderRadius},outlined:{border:"1px solid ".concat(e.palette.divider)}},t)},LM=B.forwardRef(function(e,t){var r=e.classes,s=e.className,i=e.component,o=i===void 0?"div":i,a=e.square,u=a===void 0?!1:a,f=e.elevation,h=f===void 0?1:f,p=e.variant,m=p===void 0?"elevation":p,v=Et(e,["classes","className","component","square","elevation","variant"]);return B.createElement(o,Ee({className:Tt(r.root,s,m==="outlined"?r.outlined:r["elevation".concat(h)],!u&&r.rounded),ref:t},v))});const of=En(DM,{name:"MuiPaper"})(LM);var tE=B.createContext({}),FM=function(e){var t={duration:e.transitions.duration.shortest};return{root:{position:"relative",transition:e.transitions.create(["margin"],t),"&:before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:e.palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-child":{"&:before":{display:"none"}},"&$expanded":{margin:"16px 0","&:first-child":{marginTop:0},"&:last-child":{marginBottom:0},"&:before":{opacity:0}},"&$expanded + &":{"&:before":{display:"none"}},"&$disabled":{backgroundColor:e.palette.action.disabledBackground}},rounded:{borderRadius:0,"&:first-child":{borderTopLeftRadius:e.shape.borderRadius,borderTopRightRadius:e.shape.borderRadius},"&:last-child":{borderBottomLeftRadius:e.shape.borderRadius,borderBottomRightRadius:e.shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},expanded:{},disabled:{}}},BM=B.forwardRef(function(e,t){var r=e.children,s=e.classes,i=e.className,o=e.defaultExpanded,a=o===void 0?!1:o,u=e.disabled,f=u===void 0?!1:u,h=e.expanded,p=e.onChange,m=e.square,v=m===void 0?!1:m,x=e.TransitionComponent,w=x===void 0?NM:x,T=e.TransitionProps,E=Et(e,["children","classes","className","defaultExpanded","disabled","expanded","onChange","square","TransitionComponent","TransitionProps"]),C=GS({controlled:h,default:a,name:"Accordion",state:"expanded"}),P=Up(C,2),L=P[0],I=P[1],F=B.useCallback(function(pe){I(!L),p&&p(pe,!L)},[L,p,I]),j=B.Children.toArray(r),q=EM(j),Q=q[0],le=q.slice(1),he=B.useMemo(function(){return{expanded:L,disabled:f,toggle:F}},[L,f,F]);return B.createElement(of,Ee({className:Tt(s.root,i,L&&s.expanded,f&&s.disabled,!v&&s.rounded),ref:t,square:v},E),B.createElement(tE.Provider,{value:he},Q),B.createElement(w,Ee({in:L,timeout:"auto"},T),B.createElement("div",{"aria-labelledby":Q.props.id,id:Q.props["aria-controls"],role:"region"},le)))});const UM=En(FM,{name:"MuiAccordion"})(BM);var VM=function(e){return{root:{display:"flex",padding:e.spacing(1,2,2)}}},zM=B.forwardRef(function(e,t){var r=e.classes,s=e.className,i=Et(e,["classes","className"]);return B.createElement("div",Ee({className:Tt(r.root,s),ref:t},i))});const $M=En(VM,{name:"MuiAccordionDetails"})(zM);var jM=typeof window>"u"?B.useEffect:B.useLayoutEffect;function WM(n){var e=n.classes,t=n.pulsate,r=t===void 0?!1:t,s=n.rippleX,i=n.rippleY,o=n.rippleSize,a=n.in,u=n.onExited,f=u===void 0?function(){}:u,h=n.timeout,p=B.useState(!1),m=p[0],v=p[1],x=Tt(e.ripple,e.rippleVisible,r&&e.ripplePulsate),w={width:o,height:o,top:-(o/2)+i,left:-(o/2)+s},T=Tt(e.child,m&&e.childLeaving,r&&e.childPulsate),E=qn(f);return jM(function(){if(!a){v(!0);var C=setTimeout(E,h);return function(){clearTimeout(C)}}},[E,a,h]),B.createElement("span",{className:x,style:w},B.createElement("span",{className:T}))}var Iv=550,HM=80,XM=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(Iv,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(Iv,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}},YM=B.forwardRef(function(e,t){var r=e.center,s=r===void 0?!1:r,i=e.classes,o=e.className,a=Et(e,["center","classes","className"]),u=B.useState([]),f=u[0],h=u[1],p=B.useRef(0),m=B.useRef(null);B.useEffect(function(){m.current&&(m.current(),m.current=null)},[f]);var v=B.useRef(!1),x=B.useRef(null),w=B.useRef(null),T=B.useRef(null);B.useEffect(function(){return function(){clearTimeout(x.current)}},[]);var E=B.useCallback(function(I){var F=I.pulsate,j=I.rippleX,q=I.rippleY,Q=I.rippleSize,le=I.cb;h(function(he){return[].concat(Bp(he),[B.createElement(WM,{key:p.current,classes:i,timeout:Iv,pulsate:F,rippleX:j,rippleY:q,rippleSize:Q})])}),p.current+=1,m.current=le},[i]),C=B.useCallback(function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0,q=F.pulsate,Q=q===void 0?!1:q,le=F.center,he=le===void 0?s||F.pulsate:le,pe=F.fakeElement,ne=pe===void 0?!1:pe;if(I.type==="mousedown"&&v.current){v.current=!1;return}I.type==="touchstart"&&(v.current=!0);var ve=ne?null:T.current,Me=ve?ve.getBoundingClientRect():{width:0,height:0,left:0,top:0},U,H,N;if(he||I.clientX===0&&I.clientY===0||!I.clientX&&!I.touches)U=Math.round(Me.width/2),H=Math.round(Me.height/2);else{var Y=I.touches?I.touches[0]:I,k=Y.clientX,b=Y.clientY;U=Math.round(k-Me.left),H=Math.round(b-Me.top)}if(he)N=Math.sqrt((2*Math.pow(Me.width,2)+Math.pow(Me.height,2))/3),N%2===0&&(N+=1);else{var O=Math.max(Math.abs((ve?ve.clientWidth:0)-U),U)*2+2,W=Math.max(Math.abs((ve?ve.clientHeight:0)-H),H)*2+2;N=Math.sqrt(Math.pow(O,2)+Math.pow(W,2))}I.touches?w.current===null&&(w.current=function(){E({pulsate:Q,rippleX:U,rippleY:H,rippleSize:N,cb:j})},x.current=setTimeout(function(){w.current&&(w.current(),w.current=null)},HM)):E({pulsate:Q,rippleX:U,rippleY:H,rippleSize:N,cb:j})},[s,E]),P=B.useCallback(function(){C({},{pulsate:!0})},[C]),L=B.useCallback(function(I,F){if(clearTimeout(x.current),I.type==="touchend"&&w.current){I.persist(),w.current(),w.current=null,x.current=setTimeout(function(){L(I,F)});return}w.current=null,h(function(j){return j.length>0?j.slice(1):j}),m.current=F},[]);return B.useImperativeHandle(t,function(){return{pulsate:P,start:C,stop:L}},[P,C,L]),B.createElement("span",Ee({className:Tt(i.root,o),ref:T},a),B.createElement(my,{component:null,exit:!0},f))});const qM=En(XM,{flip:!1,name:"MuiTouchRipple"})(B.memo(YM));var KM={root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},ZM=B.forwardRef(function(e,t){var r=e.action,s=e.buttonRef,i=e.centerRipple,o=i===void 0?!1:i,a=e.children,u=e.classes,f=e.className,h=e.component,p=h===void 0?"button":h,m=e.disabled,v=m===void 0?!1:m,x=e.disableRipple,w=x===void 0?!1:x,T=e.disableTouchRipple,E=T===void 0?!1:T,C=e.focusRipple,P=C===void 0?!1:C,L=e.focusVisibleClassName,I=e.onBlur,F=e.onClick,j=e.onFocus,q=e.onFocusVisible,Q=e.onKeyDown,le=e.onKeyUp,he=e.onMouseDown,pe=e.onMouseLeave,ne=e.onMouseUp,ve=e.onTouchEnd,Me=e.onTouchMove,U=e.onTouchStart,H=e.onDragLeave,N=e.tabIndex,Y=N===void 0?0:N,k=e.TouchRippleProps,b=e.type,O=b===void 0?"button":b,W=Et(e,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),K=B.useRef(null);function ee(){return To.findDOMNode(K.current)}var te=B.useRef(null),ce=B.useState(!1),me=ce[0],xe=ce[1];v&&me&&xe(!1);var Pe=py(),Ue=Pe.isFocusVisible,Ke=Pe.onBlurVisible,tt=Pe.ref;B.useImperativeHandle(r,function(){return{focusVisible:function(){xe(!0),K.current.focus()}}},[]),B.useEffect(function(){me&&P&&!w&&te.current.pulsate()},[w,P,me]);function Qe(Ze,Rn){var js=arguments.length>2&&arguments[2]!==void 0?arguments[2]:E;return qn(function(Gr){Rn&&Rn(Gr);var xn=js;return!xn&&te.current&&te.current[Ze](Gr),!0})}var He=Qe("start",he),Ie=Qe("stop",H),lt=Qe("stop",ne),_n=Qe("stop",function(Ze){me&&Ze.preventDefault(),pe&&pe(Ze)}),Vt=Qe("start",U),It=Qe("stop",ve),ht=Qe("stop",Me),ot=Qe("stop",function(Ze){me&&(Ke(Ze),xe(!1)),I&&I(Ze)},!1),Pt=qn(function(Ze){K.current||(K.current=Ze.currentTarget),Ue(Ze)&&(xe(!0),q&&q(Ze)),j&&j(Ze)}),Ft=function(){var Rn=ee();return p&&p!=="button"&&!(Rn.tagName==="A"&&Rn.href)},An=B.useRef(!1),yn=qn(function(Ze){P&&!An.current&&me&&te.current&&Ze.key===" "&&(An.current=!0,Ze.persist(),te.current.stop(Ze,function(){te.current.start(Ze)})),Ze.target===Ze.currentTarget&&Ft()&&Ze.key===" "&&Ze.preventDefault(),Q&&Q(Ze),Ze.target===Ze.currentTarget&&Ft()&&Ze.key==="Enter"&&!v&&(Ze.preventDefault(),F&&F(Ze))}),Nr=qn(function(Ze){P&&Ze.key===" "&&te.current&&me&&!Ze.defaultPrevented&&(An.current=!1,Ze.persist(),te.current.stop(Ze,function(){te.current.pulsate(Ze)})),le&&le(Ze),F&&Ze.target===Ze.currentTarget&&Ft()&&Ze.key===" "&&!Ze.defaultPrevented&&F(Ze)}),Kt=p;Kt==="button"&&W.href&&(Kt="a");var gt={};Kt==="button"?(gt.type=O,gt.disabled=v):((Kt!=="a"||!W.href)&&(gt.role="button"),gt["aria-disabled"]=v);var On=Gn(s,t),Bt=Gn(tt,K),xr=Gn(On,Bt),ir=B.useState(!1),mi=ir[0],Co=ir[1];B.useEffect(function(){Co(!0)},[]);var $s=mi&&!w&&!v;return B.createElement(Kt,Ee({className:Tt(u.root,f,me&&[u.focusVisible,L],v&&u.disabled),onBlur:ot,onClick:F,onFocus:Pt,onKeyDown:yn,onKeyUp:Nr,onMouseDown:He,onMouseLeave:_n,onMouseUp:lt,onDragLeave:Ie,onTouchEnd:It,onTouchMove:ht,onTouchStart:Vt,ref:xr,tabIndex:v?-1:Y},gt,W),a,$s?B.createElement(qM,Ee({ref:te,center:o},k)):null)});const nE=En(KM,{name:"MuiButtonBase"})(ZM);var QM=function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:ro(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:ro(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:ro(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}},GM=B.forwardRef(function(e,t){var r=e.edge,s=r===void 0?!1:r,i=e.children,o=e.classes,a=e.className,u=e.color,f=u===void 0?"default":u,h=e.disabled,p=h===void 0?!1:h,m=e.disableFocusRipple,v=m===void 0?!1:m,x=e.size,w=x===void 0?"medium":x,T=Et(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return B.createElement(nE,Ee({className:Tt(o.root,a,f!=="default"&&o["color".concat(Yr(f))],p&&o.disabled,w==="small"&&o["size".concat(Yr(w))],{start:o.edgeStart,end:o.edgeEnd}[s]),centerRipple:!0,focusRipple:!v,disabled:p,ref:t},T),B.createElement("span",{className:o.label},i))});const Us=En(QM,{name:"MuiIconButton"})(GM);var JM=function(e){var t={duration:e.transitions.duration.shortest};return{root:{display:"flex",minHeight:8*6,transition:e.transitions.create(["min-height","background-color"],t),padding:e.spacing(0,2),"&:hover:not($disabled)":{cursor:"pointer"},"&$expanded":{minHeight:64},"&$focused, &$focusVisible":{backgroundColor:e.palette.action.focus},"&$disabled":{opacity:e.palette.action.disabledOpacity}},expanded:{},focused:{},focusVisible:{},disabled:{},content:{display:"flex",flexGrow:1,transition:e.transitions.create(["margin"],t),margin:"12px 0","&$expanded":{margin:"20px 0"}},expandIcon:{transform:"rotate(0deg)",transition:e.transitions.create("transform",t),"&:hover":{backgroundColor:"transparent"},"&$expanded":{transform:"rotate(180deg)"}}}},ek=B.forwardRef(function(e,t){var r=e.children,s=e.classes,i=e.className,o=e.expandIcon,a=e.focusVisibleClassName,u=e.IconButtonProps,f=u===void 0?{}:u,h=e.onClick,p=Et(e,["children","classes","className","expandIcon","focusVisibleClassName","IconButtonProps","onClick"]),m=B.useContext(tE),v=m.disabled,x=v===void 0?!1:v,w=m.expanded,T=m.toggle,E=function(P){T&&T(P),h&&h(P)};return B.createElement(nE,Ee({focusRipple:!1,disableRipple:!0,disabled:x,component:"div","aria-expanded":w,className:Tt(s.root,i,x&&s.disabled,w&&s.expanded),focusVisibleClassName:Tt(s.focusVisible,s.focused,a),onClick:E,ref:t},p),B.createElement("div",{className:Tt(s.content,w&&s.expanded)},r),o&&B.createElement(Us,Ee({className:Tt(s.expandIcon,w&&s.expanded),edge:"end",component:"div",tabIndex:null,role:null,"aria-hidden":!0},f),o))});const tk=En(JM,{name:"MuiAccordionSummary"})(ek);var nk=function(e){return{root:{margin:0},body2:e.typography.body2,body1:e.typography.body1,caption:e.typography.caption,button:e.typography.button,h1:e.typography.h1,h2:e.typography.h2,h3:e.typography.h3,h4:e.typography.h4,h5:e.typography.h5,h6:e.typography.h6,subtitle1:e.typography.subtitle1,subtitle2:e.typography.subtitle2,overline:e.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorTextPrimary:{color:e.palette.text.primary},colorTextSecondary:{color:e.palette.text.secondary},colorError:{color:e.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}},U3={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},rk=B.forwardRef(function(e,t){var r=e.align,s=r===void 0?"inherit":r,i=e.classes,o=e.className,a=e.color,u=a===void 0?"initial":a,f=e.component,h=e.display,p=h===void 0?"initial":h,m=e.gutterBottom,v=m===void 0?!1:m,x=e.noWrap,w=x===void 0?!1:x,T=e.paragraph,E=T===void 0?!1:T,C=e.variant,P=C===void 0?"body1":C,L=e.variantMapping,I=L===void 0?U3:L,F=Et(e,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),j=f||(E?"p":I[P]||U3[P])||"span";return B.createElement(j,Ee({className:Tt(i.root,o,P!=="inherit"&&i[P],u!=="initial"&&i["color".concat(Yr(u))],w&&i.noWrap,v&&i.gutterBottom,E&&i.paragraph,s!=="inherit"&&i["align".concat(Yr(s))],p!=="initial"&&i["display".concat(Yr(p))]),ref:t},F))});const rr=En(nk,{name:"MuiTypography"})(rk);var vy=B.createContext();function sk(){return B.useContext(vy)}function ik(){return B.useContext(vy)}function ok(n){return n=typeof n=="function"?n():n,To.findDOMNode(n)}var _0=typeof window<"u"?B.useLayoutEffect:B.useEffect,ak=B.forwardRef(function(e,t){var r=e.children,s=e.container,i=e.disablePortal,o=i===void 0?!1:i,a=e.onRendered,u=B.useState(null),f=u[0],h=u[1],p=Gn(B.isValidElement(r)?r.ref:null,t);return _0(function(){o||h(ok(s)||document.body)},[s,o]),_0(function(){if(f&&!o)return Sd(t,f),function(){Sd(t,null)}},[t,f,o]),_0(function(){a&&(f||o)&&a()},[a,f,o]),o?B.isValidElement(r)?B.cloneElement(r,{ref:p}):r:f&&To.createPortal(r,f)});function lk(){var n=document.createElement("div");n.style.width="99px",n.style.height="99px",n.style.position="absolute",n.style.top="-9999px",n.style.overflow="scroll",document.body.appendChild(n);var e=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),e}function ck(n){var e=cs(n);return e.body===n?QS(e).innerWidth>e.documentElement.clientWidth:n.scrollHeight>n.clientHeight}function vu(n,e){e?n.setAttribute("aria-hidden","true"):n.removeAttribute("aria-hidden")}function V3(n){return parseInt(window.getComputedStyle(n)["padding-right"],10)||0}function z3(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],s=arguments.length>4?arguments[4]:void 0,i=[e,t].concat(Bp(r)),o=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(n.children,function(a){a.nodeType===1&&i.indexOf(a)===-1&&o.indexOf(a.tagName)===-1&&vu(a,s)})}function y0(n,e){var t=-1;return n.some(function(r,s){return e(r)?(t=s,!0):!1}),t}function uk(n,e){var t=[],r=[],s=n.container,i;if(!e.disableScrollLock){if(ck(s)){var o=lk();t.push({value:s.style.paddingRight,key:"padding-right",el:s}),s.style["padding-right"]="".concat(V3(s)+o,"px"),i=cs(s).querySelectorAll(".mui-fixed"),[].forEach.call(i,function(h){r.push(h.style.paddingRight),h.style.paddingRight="".concat(V3(h)+o,"px")})}var a=s.parentElement,u=a.nodeName==="HTML"&&window.getComputedStyle(a)["overflow-y"]==="scroll"?a:s;t.push({value:u.style.overflow,key:"overflow",el:u}),u.style.overflow="hidden"}var f=function(){i&&[].forEach.call(i,function(p,m){r[m]?p.style.paddingRight=r[m]:p.style.removeProperty("padding-right")}),t.forEach(function(p){var m=p.value,v=p.el,x=p.key;m?v.style.setProperty(x,m):v.style.removeProperty(x)})};return f}function fk(n){var e=[];return[].forEach.call(n.children,function(t){t.getAttribute&&t.getAttribute("aria-hidden")==="true"&&e.push(t)}),e}var hk=function(){function n(){iM(this,n),this.modals=[],this.containers=[]}return ly(n,[{key:"add",value:function(t,r){var s=this.modals.indexOf(t);if(s!==-1)return s;s=this.modals.length,this.modals.push(t),t.modalRef&&vu(t.modalRef,!1);var i=fk(r);z3(r,t.mountNode,t.modalRef,i,!0);var o=y0(this.containers,function(a){return a.container===r});return o!==-1?(this.containers[o].modals.push(t),s):(this.containers.push({modals:[t],container:r,restore:null,hiddenSiblingNodes:i}),s)}},{key:"mount",value:function(t,r){var s=y0(this.containers,function(o){return o.modals.indexOf(t)!==-1}),i=this.containers[s];i.restore||(i.restore=uk(i,r))}},{key:"remove",value:function(t){var r=this.modals.indexOf(t);if(r===-1)return r;var s=y0(this.containers,function(a){return a.modals.indexOf(t)!==-1}),i=this.containers[s];if(i.modals.splice(i.modals.indexOf(t),1),this.modals.splice(r,1),i.modals.length===0)i.restore&&i.restore(),t.modalRef&&vu(t.modalRef,!0),z3(i.container,t.mountNode,t.modalRef,i.hiddenSiblingNodes,!1),this.containers.splice(s,1);else{var o=i.modals[i.modals.length-1];o.modalRef&&vu(o.modalRef,!1)}return r}},{key:"isTopModal",value:function(t){return this.modals.length>0&&this.modals[this.modals.length-1]===t}}]),n}();function dk(n){var e=n.children,t=n.disableAutoFocus,r=t===void 0?!1:t,s=n.disableEnforceFocus,i=s===void 0?!1:s,o=n.disableRestoreFocus,a=o===void 0?!1:o,u=n.getDoc,f=n.isEnabled,h=n.open,p=B.useRef(),m=B.useRef(null),v=B.useRef(null),x=B.useRef(),w=B.useRef(null),T=B.useCallback(function(P){w.current=To.findDOMNode(P)},[]),E=Gn(e.ref,T),C=B.useRef();return B.useEffect(function(){C.current=h},[h]),!C.current&&h&&typeof window<"u"&&(x.current=u().activeElement),B.useEffect(function(){if(h){var P=cs(w.current);!r&&w.current&&!w.current.contains(P.activeElement)&&(w.current.hasAttribute("tabIndex")||w.current.setAttribute("tabIndex",-1),w.current.focus());var L=function(){var q=w.current;if(q!==null){if(!P.hasFocus()||i||!f()||p.current){p.current=!1;return}w.current&&!w.current.contains(P.activeElement)&&w.current.focus()}},I=function(q){i||!f()||q.keyCode!==9||P.activeElement===w.current&&(p.current=!0,q.shiftKey?v.current.focus():m.current.focus())};P.addEventListener("focus",L,!0),P.addEventListener("keydown",I,!0);var F=setInterval(function(){L()},50);return function(){clearInterval(F),P.removeEventListener("focus",L,!0),P.removeEventListener("keydown",I,!0),a||(x.current&&x.current.focus&&x.current.focus(),x.current=null)}}},[r,i,a,f,h]),B.createElement(B.Fragment,null,B.createElement("div",{tabIndex:0,ref:m,"data-test":"sentinelStart"}),B.cloneElement(e,{ref:E}),B.createElement("div",{tabIndex:0,ref:v,"data-test":"sentinelEnd"}))}var $3={root:{zIndex:-1,position:"fixed",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},pk=B.forwardRef(function(e,t){var r=e.invisible,s=r===void 0?!1:r,i=e.open,o=Et(e,["invisible","open"]);return i?B.createElement("div",Ee({"aria-hidden":!0,ref:t},o,{style:Ee({},$3.root,s?$3.invisible:{},o.style)})):null});function gk(n){return n=typeof n=="function"?n():n,To.findDOMNode(n)}function mk(n){return n.children?n.children.props.hasOwnProperty("in"):!1}var vk=new hk,_k=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}},yk=B.forwardRef(function(e,t){var r=sf(),s=IS({name:"MuiModal",props:Ee({},e),theme:r}),i=s.BackdropComponent,o=i===void 0?pk:i,a=s.BackdropProps,u=s.children,f=s.closeAfterTransition,h=f===void 0?!1:f,p=s.container,m=s.disableAutoFocus,v=m===void 0?!1:m,x=s.disableBackdropClick,w=x===void 0?!1:x,T=s.disableEnforceFocus,E=T===void 0?!1:T,C=s.disableEscapeKeyDown,P=C===void 0?!1:C,L=s.disablePortal,I=L===void 0?!1:L,F=s.disableRestoreFocus,j=F===void 0?!1:F,q=s.disableScrollLock,Q=q===void 0?!1:q,le=s.hideBackdrop,he=le===void 0?!1:le,pe=s.keepMounted,ne=pe===void 0?!1:pe,ve=s.manager,Me=ve===void 0?vk:ve,U=s.onBackdropClick,H=s.onClose,N=s.onEscapeKeyDown,Y=s.onRendered,k=s.open,b=Et(s,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),O=B.useState(!0),W=O[0],K=O[1],ee=B.useRef({}),te=B.useRef(null),ce=B.useRef(null),me=Gn(ce,t),xe=mk(s),Pe=function(){return cs(te.current)},Ue=function(){return ee.current.modalRef=ce.current,ee.current.mountNode=te.current,ee.current},Ke=function(){Me.mount(Ue(),{disableScrollLock:Q}),ce.current.scrollTop=0},tt=qn(function(){var Pt=gk(p)||Pe().body;Me.add(Ue(),Pt),ce.current&&Ke()}),Qe=B.useCallback(function(){return Me.isTopModal(Ue())},[Me]),He=qn(function(Pt){te.current=Pt,Pt&&(Y&&Y(),k&&Qe()?Ke():vu(ce.current,!0))}),Ie=B.useCallback(function(){Me.remove(Ue())},[Me]);if(B.useEffect(function(){return function(){Ie()}},[Ie]),B.useEffect(function(){k?tt():(!xe||!h)&&Ie()},[k,Ie,xe,h,tt]),!ne&&!k&&(!xe||W))return null;var lt=function(){K(!1)},_n=function(){K(!0),h&&Ie()},Vt=function(Ft){Ft.target===Ft.currentTarget&&(U&&U(Ft),!w&&H&&H(Ft,"backdropClick"))},It=function(Ft){Ft.key!=="Escape"||!Qe()||(N&&N(Ft),P||(Ft.stopPropagation(),H&&H(Ft,"escapeKeyDown")))},ht=_k(r||{zIndex:RS}),ot={};return u.props.tabIndex===void 0&&(ot.tabIndex=u.props.tabIndex||"-1"),xe&&(ot.onEnter=Rv(lt,u.props.onEnter),ot.onExited=Rv(_n,u.props.onExited)),B.createElement(ak,{ref:He,container:p,disablePortal:I},B.createElement("div",Ee({ref:me,onKeyDown:It,role:"presentation"},b,{style:Ee({},ht.root,!k&&W?ht.hidden:{},b.style)}),he?null:B.createElement(o,Ee({open:k,onClick:Vt},a)),B.createElement(dk,{disableEnforceFocus:E,disableAutoFocus:v,disableRestoreFocus:j,getDoc:Pe,isEnabled:Qe,open:k},B.cloneElement(u,ot))))}),xk=function(e){return{root:{height:1,margin:0,border:"none",flexShrink:0,backgroundColor:e.palette.divider},absolute:{position:"absolute",bottom:0,left:0,width:"100%"},inset:{marginLeft:72},light:{backgroundColor:ro(e.palette.divider,.08)},middle:{marginLeft:e.spacing(2),marginRight:e.spacing(2)},vertical:{height:"100%",width:1},flexItem:{alignSelf:"stretch",height:"auto"}}},wk=B.forwardRef(function(e,t){var r=e.absolute,s=r===void 0?!1:r,i=e.classes,o=e.className,a=e.component,u=a===void 0?"hr":a,f=e.flexItem,h=f===void 0?!1:f,p=e.light,m=p===void 0?!1:p,v=e.orientation,x=v===void 0?"horizontal":v,w=e.role,T=w===void 0?u!=="hr"?"separator":void 0:w,E=e.variant,C=E===void 0?"fullWidth":E,P=Et(e,["absolute","classes","className","component","flexItem","light","orientation","role","variant"]);return B.createElement(u,Ee({className:Tt(i.root,o,C!=="fullWidth"&&i[C],s&&i.absolute,h&&i.flexItem,m&&i.light,x==="vertical"&&i.vertical),role:T,ref:t},P))});const kr=En(xk,{name:"MuiDivider"})(wk);function rE(n){var e=n.props,t=n.states,r=n.muiFormControl;return t.reduce(function(s,i){return s[i]=e[i],r&&typeof e[i]>"u"&&(s[i]=r[i]),s},{})}function Ch(n,e){return parseInt(n[e],10)||0}var bk=typeof window<"u"?B.useLayoutEffect:B.useEffect,Tk={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}},Sk=B.forwardRef(function(e,t){var r=e.onChange,s=e.rows,i=e.rowsMax,o=e.rowsMin,a=e.maxRows,u=e.minRows,f=u===void 0?1:u,h=e.style,p=e.value,m=Et(e,["onChange","rows","rowsMax","rowsMin","maxRows","minRows","style","value"]),v=a||i,x=s||o||f,w=B.useRef(p!=null),T=w.current,E=B.useRef(null),C=Gn(t,E),P=B.useRef(null),L=B.useRef(0),I=B.useState({}),F=I[0],j=I[1],q=B.useCallback(function(){var le=E.current,he=window.getComputedStyle(le),pe=P.current;pe.style.width=he.width,pe.value=le.value||e.placeholder||"x",pe.value.slice(-1)===`
`&&(pe.value+=" ");var ne=he["box-sizing"],ve=Ch(he,"padding-bottom")+Ch(he,"padding-top"),Me=Ch(he,"border-bottom-width")+Ch(he,"border-top-width"),U=pe.scrollHeight-ve;pe.value="x";var H=pe.scrollHeight-ve,N=U;x&&(N=Math.max(Number(x)*H,N)),v&&(N=Math.min(Number(v)*H,N)),N=Math.max(N,H);var Y=N+(ne==="border-box"?ve+Me:0),k=Math.abs(N-U)<=1;j(function(b){return L.current<20&&(Y>0&&Math.abs((b.outerHeightStyle||0)-Y)>1||b.overflow!==k)?(L.current+=1,{overflow:k,outerHeightStyle:Y}):b})},[v,x,e.placeholder]);B.useEffect(function(){var le=ZS(function(){L.current=0,q()});return window.addEventListener("resize",le),function(){le.clear(),window.removeEventListener("resize",le)}},[q]),bk(function(){q()}),B.useEffect(function(){L.current=0},[p]);var Q=function(he){L.current=0,T||q(),r&&r(he)};return B.createElement(B.Fragment,null,B.createElement("textarea",Ee({value:p,onChange:Q,ref:C,rows:x,style:Ee({height:F.outerHeightStyle,overflow:F.overflow?"hidden":null},h)},m)),B.createElement("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:P,tabIndex:-1,style:Ee({},Tk.shadow,h)}))});function j3(n){return n!=null&&!(Array.isArray(n)&&n.length===0)}function Ek(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return n&&(j3(n.value)&&n.value!==""||e&&j3(n.defaultValue)&&n.defaultValue!=="")}var Ak=function(e){var t=e.palette.type==="light",r={color:"currentColor",opacity:t?.42:.5,transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},s={opacity:"0 !important"},i={opacity:t?.42:.5};return{"@global":{"@keyframes mui-auto-fill":{},"@keyframes mui-auto-fill-cancel":{}},root:Ee({},e.typography.body1,{color:e.palette.text.primary,lineHeight:"1.1876em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center","&$disabled":{color:e.palette.text.disabled,cursor:"default"}}),formControl:{},focused:{},disabled:{},adornedStart:{},adornedEnd:{},error:{},marginDense:{},multiline:{padding:"".concat(6,"px 0 ").concat(7,"px"),"&$marginDense":{paddingTop:3}},colorSecondary:{},fullWidth:{width:"100%"},input:{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"".concat(6,"px 0 ").concat(7,"px"),border:0,boxSizing:"content-box",background:"none",height:"1.1876em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&:-ms-input-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{"-webkit-appearance":"none"},"label[data-shrink=false] + $formControl &":{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&:-ms-input-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":i,"&:focus::-moz-placeholder":i,"&:focus:-ms-input-placeholder":i,"&:focus::-ms-input-placeholder":i},"&$disabled":{opacity:1},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},inputMarginDense:{paddingTop:3},inputMultiline:{height:"auto",resize:"none",padding:0},inputTypeSearch:{"-moz-appearance":"textfield","-webkit-appearance":"textfield"},inputAdornedStart:{},inputAdornedEnd:{},inputHiddenLabel:{}}},Rk=typeof window>"u"?B.useEffect:B.useLayoutEffect,Ck=B.forwardRef(function(e,t){var r=e["aria-describedby"],s=e.autoComplete,i=e.autoFocus,o=e.classes,a=e.className;e.color;var u=e.defaultValue,f=e.disabled,h=e.endAdornment;e.error;var p=e.fullWidth,m=p===void 0?!1:p,v=e.id,x=e.inputComponent,w=x===void 0?"input":x,T=e.inputProps,E=T===void 0?{}:T,C=e.inputRef;e.margin;var P=e.multiline,L=P===void 0?!1:P,I=e.name,F=e.onBlur,j=e.onChange,q=e.onClick,Q=e.onFocus,le=e.onKeyDown,he=e.onKeyUp,pe=e.placeholder,ne=e.readOnly,ve=e.renderSuffix,Me=e.rows,U=e.rowsMax,H=e.rowsMin,N=e.maxRows,Y=e.minRows,k=e.startAdornment,b=e.type,O=b===void 0?"text":b,W=e.value,K=Et(e,["aria-describedby","autoComplete","autoFocus","classes","className","color","defaultValue","disabled","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","rowsMax","rowsMin","maxRows","minRows","startAdornment","type","value"]),ee=E.value!=null?E.value:W,te=B.useRef(ee!=null),ce=te.current,me=B.useRef(),xe=B.useCallback(function(Kt){},[]),Pe=Gn(E.ref,xe),Ue=Gn(C,Pe),Ke=Gn(me,Ue),tt=B.useState(!1),Qe=tt[0],He=tt[1],Ie=sk(),lt=rE({props:e,muiFormControl:Ie,states:["color","disabled","error","hiddenLabel","margin","required","filled"]});lt.focused=Ie?Ie.focused:Qe,B.useEffect(function(){!Ie&&f&&Qe&&(He(!1),F&&F())},[Ie,f,Qe,F]);var _n=Ie&&Ie.onFilled,Vt=Ie&&Ie.onEmpty,It=B.useCallback(function(Kt){Ek(Kt)?_n&&_n():Vt&&Vt()},[_n,Vt]);Rk(function(){ce&&It({value:ee})},[ee,It,ce]);var ht=function(gt){if(lt.disabled){gt.stopPropagation();return}Q&&Q(gt),E.onFocus&&E.onFocus(gt),Ie&&Ie.onFocus?Ie.onFocus(gt):He(!0)},ot=function(gt){F&&F(gt),E.onBlur&&E.onBlur(gt),Ie&&Ie.onBlur?Ie.onBlur(gt):He(!1)},Pt=function(gt){if(!ce){var On=gt.target||me.current;if(On==null)throw new Error(Pu(1));It({value:On.value})}for(var Bt=arguments.length,xr=new Array(Bt>1?Bt-1:0),ir=1;ir<Bt;ir++)xr[ir-1]=arguments[ir];E.onChange&&E.onChange.apply(E,[gt].concat(xr)),j&&j.apply(void 0,[gt].concat(xr))};B.useEffect(function(){It(me.current)},[]);var Ft=function(gt){me.current&&gt.currentTarget===gt.target&&me.current.focus(),q&&q(gt)},An=w,yn=Ee({},E,{ref:Ke});typeof An!="string"?yn=Ee({inputRef:Ke,type:O},yn,{ref:null}):L?Me&&!N&&!Y&&!U&&!H?An="textarea":(yn=Ee({minRows:Me||Y,rowsMax:U,maxRows:N},yn),An=Sk):yn=Ee({type:O},yn);var Nr=function(gt){It(gt.animationName==="mui-auto-fill-cancel"?me.current:{value:"x"})};return B.useEffect(function(){Ie&&Ie.setAdornedStart(!!k)},[Ie,k]),B.createElement("div",Ee({className:Tt(o.root,o["color".concat(Yr(lt.color||"primary"))],a,lt.disabled&&o.disabled,lt.error&&o.error,m&&o.fullWidth,lt.focused&&o.focused,Ie&&o.formControl,L&&o.multiline,k&&o.adornedStart,h&&o.adornedEnd,lt.margin==="dense"&&o.marginDense),onClick:Ft,ref:t},K),k,B.createElement(vy.Provider,{value:null},B.createElement(An,Ee({"aria-invalid":lt.error,"aria-describedby":r,autoComplete:s,autoFocus:i,defaultValue:u,disabled:lt.disabled,id:v,onAnimationStart:Nr,name:I,placeholder:pe,readOnly:ne,required:lt.required,rows:Me,value:ee,onKeyDown:le,onKeyUp:he},yn,{className:Tt(o.input,E.className,lt.disabled&&o.disabled,L&&o.inputMultiline,lt.hiddenLabel&&o.inputHiddenLabel,k&&o.inputAdornedStart,h&&o.inputAdornedEnd,O==="search"&&o.inputTypeSearch,lt.margin==="dense"&&o.inputMarginDense),onBlur:ot,onChange:Pt,onFocus:ht}))),h,ve?ve(Ee({},lt,{startAdornment:k})):null)});const Pk=En(Ak,{name:"MuiInputBase"})(Ck);var Ik=[0,1,2,3,4,5,6,7,8,9,10],Mk=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12];function kk(n,e,t){var r={};Mk.forEach(function(s){var i="grid-".concat(t,"-").concat(s);if(s===!0){r[i]={flexBasis:0,flexGrow:1,maxWidth:"100%"};return}if(s==="auto"){r[i]={flexBasis:"auto",flexGrow:0,maxWidth:"none"};return}var o="".concat(Math.round(s/12*1e8)/1e6,"%");r[i]={flexBasis:o,flexGrow:0,maxWidth:o}}),t==="xs"?Ee(n,r):n[e.breakpoints.up(t)]=r}function x0(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=parseFloat(n);return"".concat(t/e).concat(String(n).replace(String(t),"")||"px")}function Ok(n,e){var t={};return Ik.forEach(function(r){var s=n.spacing(r);s!==0&&(t["spacing-".concat(e,"-").concat(r)]={margin:"-".concat(x0(s,2)),width:"calc(100% + ".concat(x0(s),")"),"& > $item":{padding:x0(s,2)}})}),t}var Nk=function(e){return Ee({root:{},container:{boxSizing:"border-box",display:"flex",flexWrap:"wrap",width:"100%"},item:{boxSizing:"border-box",margin:"0"},zeroMinWidth:{minWidth:0},"direction-xs-column":{flexDirection:"column"},"direction-xs-column-reverse":{flexDirection:"column-reverse"},"direction-xs-row-reverse":{flexDirection:"row-reverse"},"wrap-xs-nowrap":{flexWrap:"nowrap"},"wrap-xs-wrap-reverse":{flexWrap:"wrap-reverse"},"align-items-xs-center":{alignItems:"center"},"align-items-xs-flex-start":{alignItems:"flex-start"},"align-items-xs-flex-end":{alignItems:"flex-end"},"align-items-xs-baseline":{alignItems:"baseline"},"align-content-xs-center":{alignContent:"center"},"align-content-xs-flex-start":{alignContent:"flex-start"},"align-content-xs-flex-end":{alignContent:"flex-end"},"align-content-xs-space-between":{alignContent:"space-between"},"align-content-xs-space-around":{alignContent:"space-around"},"justify-content-xs-center":{justifyContent:"center"},"justify-content-xs-flex-end":{justifyContent:"flex-end"},"justify-content-xs-space-between":{justifyContent:"space-between"},"justify-content-xs-space-around":{justifyContent:"space-around"},"justify-content-xs-space-evenly":{justifyContent:"space-evenly"}},Ok(e,"xs"),e.breakpoints.keys.reduce(function(t,r){return kk(t,e,r),t},{}))},Dk=B.forwardRef(function(e,t){var r=e.alignContent,s=r===void 0?"stretch":r,i=e.alignItems,o=i===void 0?"stretch":i,a=e.classes,u=e.className,f=e.component,h=f===void 0?"div":f,p=e.container,m=p===void 0?!1:p,v=e.direction,x=v===void 0?"row":v,w=e.item,T=w===void 0?!1:w,E=e.justify,C=e.justifyContent,P=C===void 0?"flex-start":C,L=e.lg,I=L===void 0?!1:L,F=e.md,j=F===void 0?!1:F,q=e.sm,Q=q===void 0?!1:q,le=e.spacing,he=le===void 0?0:le,pe=e.wrap,ne=pe===void 0?"wrap":pe,ve=e.xl,Me=ve===void 0?!1:ve,U=e.xs,H=U===void 0?!1:U,N=e.zeroMinWidth,Y=N===void 0?!1:N,k=Et(e,["alignContent","alignItems","classes","className","component","container","direction","item","justify","justifyContent","lg","md","sm","spacing","wrap","xl","xs","zeroMinWidth"]),b=Tt(a.root,u,m&&[a.container,he!==0&&a["spacing-xs-".concat(String(he))]],T&&a.item,Y&&a.zeroMinWidth,x!=="row"&&a["direction-xs-".concat(String(x))],ne!=="wrap"&&a["wrap-xs-".concat(String(ne))],o!=="stretch"&&a["align-items-xs-".concat(String(o))],s!=="stretch"&&a["align-content-xs-".concat(String(s))],(E||P)!=="flex-start"&&a["justify-content-xs-".concat(String(E||P))],H!==!1&&a["grid-xs-".concat(String(H))],Q!==!1&&a["grid-sm-".concat(String(Q))],j!==!1&&a["grid-md-".concat(String(j))],I!==!1&&a["grid-lg-".concat(String(I))],Me!==!1&&a["grid-xl-".concat(String(Me))]);return B.createElement(h,Ee({className:b,ref:t},k))}),Ct=En(Nk,{name:"MuiGrid"})(Dk);function Mv(n){return"scale(".concat(n,", ").concat(Math.pow(n,2),")")}var Lk={entering:{opacity:1,transform:Mv(1)},entered:{opacity:1,transform:"none"}},sE=B.forwardRef(function(e,t){var r=e.children,s=e.disableStrictModeCompat,i=s===void 0?!1:s,o=e.in,a=e.onEnter,u=e.onEntered,f=e.onEntering,h=e.onExit,p=e.onExited,m=e.onExiting,v=e.style,x=e.timeout,w=x===void 0?"auto":x,T=e.TransitionComponent,E=T===void 0?zs:T,C=Et(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),P=B.useRef(),L=B.useRef(),I=dy(),F=I.unstable_strictMode&&!i,j=B.useRef(null),q=Gn(r.ref,t),Q=Gn(F?j:void 0,q),le=function(Y){return function(k,b){if(Y){var O=F?[j.current,k]:[k,b],W=Up(O,2),K=W[0],ee=W[1];ee===void 0?Y(K):Y(K,ee)}}},he=le(f),pe=le(function(N,Y){kM(N);var k=Ad({style:v,timeout:w},{mode:"enter"}),b=k.duration,O=k.delay,W;w==="auto"?(W=I.transitions.getAutoHeightDuration(N.clientHeight),L.current=W):W=b,N.style.transition=[I.transitions.create("opacity",{duration:W,delay:O}),I.transitions.create("transform",{duration:W*.666,delay:O})].join(","),a&&a(N,Y)}),ne=le(u),ve=le(m),Me=le(function(N){var Y=Ad({style:v,timeout:w},{mode:"exit"}),k=Y.duration,b=Y.delay,O;w==="auto"?(O=I.transitions.getAutoHeightDuration(N.clientHeight),L.current=O):O=k,N.style.transition=[I.transitions.create("opacity",{duration:O,delay:b}),I.transitions.create("transform",{duration:O*.666,delay:b||O*.333})].join(","),N.style.opacity="0",N.style.transform=Mv(.75),h&&h(N)}),U=le(p),H=function(Y,k){var b=F?Y:k;w==="auto"&&(P.current=setTimeout(b,L.current||0))};return B.useEffect(function(){return function(){clearTimeout(P.current)}},[]),B.createElement(E,Ee({appear:!0,in:o,nodeRef:F?j:void 0,onEnter:pe,onEntered:ne,onEntering:he,onExit:Me,onExited:U,onExiting:ve,addEndListener:H,timeout:w==="auto"?null:w},C),function(N,Y){return B.cloneElement(r,Ee({style:Ee({opacity:0,transform:Mv(.75),visibility:N==="exited"&&!o?"hidden":void 0},Lk[N],v,r.props.style),ref:Q},Y))})});sE.muiSupportAuto=!0;var Fk=function(e){var t=e.palette.type==="light",r=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{position:"relative"},formControl:{"label + &":{marginTop:16}},focused:{},disabled:{},colorSecondary:{"&$underline:after":{borderBottomColor:e.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(e.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(r),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):before":{borderBottom:"2px solid ".concat(e.palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(r)}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{},marginDense:{},multiline:{},fullWidth:{},input:{},inputMarginDense:{},inputMultiline:{},inputTypeSearch:{}}},iE=B.forwardRef(function(e,t){var r=e.disableUnderline,s=e.classes,i=e.fullWidth,o=i===void 0?!1:i,a=e.inputComponent,u=a===void 0?"input":a,f=e.multiline,h=f===void 0?!1:f,p=e.type,m=p===void 0?"text":p,v=Et(e,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return B.createElement(Pk,Ee({classes:Ee({},s,{root:Tt(s.root,!r&&s.underline),underline:null}),fullWidth:o,inputComponent:u,multiline:h,ref:t,type:m},v))});iE.muiName="Input";const _y=En(Fk,{name:"MuiInput"})(iE);var Bk={root:{},underlineNone:{textDecoration:"none"},underlineHover:{textDecoration:"none","&:hover":{textDecoration:"underline"}},underlineAlways:{textDecoration:"underline"},button:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none","&::-moz-focus-inner":{borderStyle:"none"},"&$focusVisible":{outline:"auto"}},focusVisible:{}},Uk=B.forwardRef(function(e,t){var r=e.classes,s=e.className,i=e.color,o=i===void 0?"primary":i,a=e.component,u=a===void 0?"a":a,f=e.onBlur,h=e.onFocus,p=e.TypographyClasses,m=e.underline,v=m===void 0?"hover":m,x=e.variant,w=x===void 0?"inherit":x,T=Et(e,["classes","className","color","component","onBlur","onFocus","TypographyClasses","underline","variant"]),E=py(),C=E.isFocusVisible,P=E.onBlurVisible,L=E.ref,I=B.useState(!1),F=I[0],j=I[1],q=Gn(t,L),Q=function(pe){F&&(P(),j(!1)),f&&f(pe)},le=function(pe){C(pe)&&j(!0),h&&h(pe)};return B.createElement(rr,Ee({className:Tt(r.root,r["underline".concat(Yr(v))],s,F&&r.focusVisible,u==="button"&&r.button),classes:p,color:o,component:u,onBlur:Q,onFocus:le,ref:q,variant:w},T))});const Vk=En(Bk,{name:"MuiLink"})(Uk);function W3(n,e){var t=0;return typeof e=="number"?t=e:e==="center"?t=n.height/2:e==="bottom"&&(t=n.height),t}function H3(n,e){var t=0;return typeof e=="number"?t=e:e==="center"?t=n.width/2:e==="right"&&(t=n.width),t}function X3(n){return[n.horizontal,n.vertical].map(function(e){return typeof e=="number"?"".concat(e,"px"):e}).join(" ")}function zk(n,e){for(var t=e,r=0;t&&t!==n;)t=t.parentElement,r+=t.scrollTop;return r}function w0(n){return typeof n=="function"?n():n}var $k={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},jk=B.forwardRef(function(e,t){var r=e.action,s=e.anchorEl,i=e.anchorOrigin,o=i===void 0?{vertical:"top",horizontal:"left"}:i,a=e.anchorPosition,u=e.anchorReference,f=u===void 0?"anchorEl":u,h=e.children,p=e.classes,m=e.className,v=e.container,x=e.elevation,w=x===void 0?8:x,T=e.getContentAnchorEl,E=e.marginThreshold,C=E===void 0?16:E,P=e.onEnter,L=e.onEntered,I=e.onEntering,F=e.onExit,j=e.onExited,q=e.onExiting,Q=e.open,le=e.PaperProps,he=le===void 0?{}:le,pe=e.transformOrigin,ne=pe===void 0?{vertical:"top",horizontal:"left"}:pe,ve=e.TransitionComponent,Me=ve===void 0?sE:ve,U=e.transitionDuration,H=U===void 0?"auto":U,N=e.TransitionProps,Y=N===void 0?{}:N,k=Et(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),b=B.useRef(),O=B.useCallback(function(Ue){if(f==="anchorPosition")return a;var Ke=w0(s),tt=Ke&&Ke.nodeType===1?Ke:cs(b.current).body,Qe=tt.getBoundingClientRect(),He=Ue===0?o.vertical:"center";return{top:Qe.top+W3(Qe,He),left:Qe.left+H3(Qe,o.horizontal)}},[s,o.horizontal,o.vertical,a,f]),W=B.useCallback(function(Ue){var Ke=0;if(T&&f==="anchorEl"){var tt=T(Ue);if(tt&&Ue.contains(tt)){var Qe=zk(Ue,tt);Ke=tt.offsetTop+tt.clientHeight/2-Qe||0}}return Ke},[o.vertical,f,T]),K=B.useCallback(function(Ue){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return{vertical:W3(Ue,ne.vertical)+Ke,horizontal:H3(Ue,ne.horizontal)}},[ne.horizontal,ne.vertical]),ee=B.useCallback(function(Ue){var Ke=W(Ue),tt={width:Ue.offsetWidth,height:Ue.offsetHeight},Qe=K(tt,Ke);if(f==="none")return{top:null,left:null,transformOrigin:X3(Qe)};var He=O(Ke),Ie=He.top-Qe.vertical,lt=He.left-Qe.horizontal,_n=Ie+tt.height,Vt=lt+tt.width,It=QS(w0(s)),ht=It.innerHeight-C,ot=It.innerWidth-C;if(Ie<C){var Pt=Ie-C;Ie-=Pt,Qe.vertical+=Pt}else if(_n>ht){var Ft=_n-ht;Ie-=Ft,Qe.vertical+=Ft}if(lt<C){var An=lt-C;lt-=An,Qe.horizontal+=An}else if(Vt>ot){var yn=Vt-ot;lt-=yn,Qe.horizontal+=yn}return{top:"".concat(Math.round(Ie),"px"),left:"".concat(Math.round(lt),"px"),transformOrigin:X3(Qe)}},[s,f,O,W,K,C]),te=B.useCallback(function(){var Ue=b.current;if(Ue){var Ke=ee(Ue);Ke.top!==null&&(Ue.style.top=Ke.top),Ke.left!==null&&(Ue.style.left=Ke.left),Ue.style.transformOrigin=Ke.transformOrigin}},[ee]),ce=function(Ke,tt){I&&I(Ke,tt),te()},me=B.useCallback(function(Ue){b.current=To.findDOMNode(Ue)},[]);B.useEffect(function(){Q&&te()}),B.useImperativeHandle(r,function(){return Q?{updatePosition:function(){te()}}:null},[Q,te]),B.useEffect(function(){if(Q){var Ue=ZS(function(){te()});return window.addEventListener("resize",Ue),function(){Ue.clear(),window.removeEventListener("resize",Ue)}}},[Q,te]);var xe=H;H==="auto"&&!Me.muiSupportAuto&&(xe=void 0);var Pe=v||(s?cs(w0(s)).body:void 0);return B.createElement(yk,Ee({container:Pe,open:Q,ref:t,BackdropProps:{invisible:!0},className:Tt(p.root,m)},k),B.createElement(Me,Ee({appear:!0,in:Q,onEnter:P,onEntered:L,onExit:F,onExited:j,onExiting:q,timeout:xe},Y,{onEntering:Rv(ce,Y.onEntering)}),B.createElement(of,Ee({elevation:w,ref:me},he,{className:Tt(p.paper,he.className)}),h)))});const yy=En($k,{name:"MuiPopover"})(jk);var Wk=B.forwardRef(function(e,t){var r=e.classes,s=e.className,i=e.disabled,o=e.IconComponent,a=e.inputRef,u=e.variant,f=u===void 0?"standard":u,h=Et(e,["classes","className","disabled","IconComponent","inputRef","variant"]);return B.createElement(B.Fragment,null,B.createElement("select",Ee({className:Tt(r.root,r.select,r[f],s,i&&r.disabled),disabled:i,ref:a||t},h)),e.multiple?null:B.createElement(o,{className:Tt(r.icon,r["icon".concat(Yr(f))],i&&r.disabled)}))});const Hk=di(B.createElement("path",{d:"M7 10l5 5 5-5z"}));var Xk=function(e){return{root:{},select:{"-moz-appearance":"none","-webkit-appearance":"none",userSelect:"none",borderRadius:0,minWidth:16,cursor:"pointer","&:focus":{backgroundColor:e.palette.type==="light"?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"},"&$disabled":{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:e.palette.background.paper},"&&":{paddingRight:24}},filled:{"&&":{paddingRight:32}},outlined:{borderRadius:e.shape.borderRadius,"&&":{paddingRight:32}},selectMenu:{height:"auto",minHeight:"1.1876em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},disabled:{},icon:{position:"absolute",right:0,top:"calc(50% - 12px)",pointerEvents:"none",color:e.palette.action.active,"&$disabled":{color:e.palette.action.disabled}},iconOpen:{transform:"rotate(180deg)"},iconFilled:{right:7},iconOutlined:{right:7},nativeInput:{bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%"}}},Yk=B.createElement(_y,null),oE=B.forwardRef(function(e,t){var r=e.children,s=e.classes,i=e.IconComponent,o=i===void 0?Hk:i,a=e.input,u=a===void 0?Yk:a,f=e.inputProps;e.variant;var h=Et(e,["children","classes","IconComponent","input","inputProps","variant"]),p=ik(),m=rE({props:e,muiFormControl:p,states:["variant"]});return B.cloneElement(u,Ee({inputComponent:Wk,inputProps:Ee({children:r,classes:s,IconComponent:o,variant:m.variant,type:void 0},f,u?u.props.inputProps:{}),ref:t},h))});oE.muiName="Select";const xy=En(Xk,{name:"MuiNativeSelect"})(oE);var qk=function(e){return{thumb:{"&$open":{"& $offset":{transform:"scale(1) translateY(-10px)"}}},open:{},offset:Ee({zIndex:1},e.typography.body2,{fontSize:e.typography.pxToRem(12),lineHeight:1.2,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),top:-34,transformOrigin:"bottom center",transform:"scale(0)",position:"absolute"}),circle:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"currentColor",transform:"rotate(-45deg)"},label:{color:e.palette.primary.contrastText,transform:"rotate(45deg)"}}};function Kk(n){var e=n.children,t=n.classes,r=n.className,s=n.open,i=n.value,o=n.valueLabelDisplay;return o==="off"?e:B.cloneElement(e,{className:Tt(e.props.className,(s||o==="on")&&t.open,t.thumb)},B.createElement("span",{className:Tt(t.offset,r)},B.createElement("span",{className:t.circle},B.createElement("span",{className:t.label},i))))}const Zk=En(qk,{name:"PrivateValueLabel"})(Kk);function b0(n,e){return n-e}function T0(n,e,t){return Math.min(Math.max(e,n),t)}function Y3(n,e){var t=n.reduce(function(s,i,o){var a=Math.abs(e-i);return s===null||a<s.distance||a===s.distance?{distance:a,index:o}:s},null),r=t.index;return r}function Ph(n,e){if(e.current!==void 0&&n.changedTouches){for(var t=0;t<n.changedTouches.length;t+=1){var r=n.changedTouches[t];if(r.identifier===e.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:n.clientX,y:n.clientY}}function Ih(n,e,t){return(n-e)*100/(t-e)}function Qk(n,e,t){return(t-e)*n+e}function Gk(n){if(Math.abs(n)<1){var e=n.toExponential().split("e-"),t=e[0].split(".")[1];return(t?t.length:0)+parseInt(e[1],10)}var r=n.toString().split(".")[1];return r?r.length:0}function q3(n,e,t){var r=Math.round((n-t)/e)*e+t;return Number(r.toFixed(Gk(e)))}function K3(n){var e=n.values,t=n.source,r=n.newValue,s=n.index;if(e[s]===r)return t;var i=e.slice();return i[s]=r,i}function Mh(n){var e=n.sliderRef,t=n.activeIndex,r=n.setActive;(!e.current.contains(document.activeElement)||Number(document.activeElement.getAttribute("data-index"))!==t)&&e.current.querySelector('[role="slider"][data-index="'.concat(t,'"]')).focus(),r&&r(t)}var kh={horizontal:{offset:function(e){return{left:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},"horizontal-reverse":{offset:function(e){return{right:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},vertical:{offset:function(e){return{bottom:"".concat(e,"%")}},leap:function(e){return{height:"".concat(e,"%")}}}},Z3=function(e){return e},Jk=function(e){return{root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:e.palette.type==="light"?bS(e.palette.primary.main,.62):wS(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(ro(e.palette.primary.main,.16)),"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(ro(e.palette.primary.main,.16))},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(ro(e.palette.secondary.main,.16))},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(ro(e.palette.secondary.main,.16))}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:Ee({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}},e5=B.forwardRef(function(e,t){var r=e["aria-label"],s=e["aria-labelledby"],i=e["aria-valuetext"],o=e.classes,a=e.className,u=e.color,f=u===void 0?"primary":u,h=e.component,p=h===void 0?"span":h,m=e.defaultValue,v=e.disabled,x=v===void 0?!1:v,w=e.getAriaLabel,T=e.getAriaValueText,E=e.marks,C=E===void 0?!1:E,P=e.max,L=P===void 0?100:P,I=e.min,F=I===void 0?0:I,j=e.name,q=e.onChange,Q=e.onChangeCommitted,le=e.onMouseDown,he=e.orientation,pe=he===void 0?"horizontal":he,ne=e.scale,ve=ne===void 0?Z3:ne,Me=e.step,U=Me===void 0?1:Me,H=e.ThumbComponent,N=H===void 0?"span":H,Y=e.track,k=Y===void 0?"normal":Y,b=e.value,O=e.ValueLabelComponent,W=O===void 0?Zk:O,K=e.valueLabelDisplay,ee=K===void 0?"off":K,te=e.valueLabelFormat,ce=te===void 0?Z3:te,me=Et(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]),xe=dy(),Pe=B.useRef(),Ue=B.useState(-1),Ke=Ue[0],tt=Ue[1],Qe=B.useState(-1),He=Qe[0],Ie=Qe[1],lt=GS({controlled:b,default:m,name:"Slider"}),_n=Up(lt,2),Vt=_n[0],It=_n[1],ht=Array.isArray(Vt),ot=ht?Vt.slice().sort(b0):[Vt];ot=ot.map(function(ze){return T0(ze,F,L)});var Pt=C===!0&&U!==null?Bp(Array(Math.floor((L-F)/U)+1)).map(function(ze,Xe){return{value:F+U*Xe}}):C||[],Ft=py(),An=Ft.isFocusVisible,yn=Ft.onBlurVisible,Nr=Ft.ref,Kt=B.useState(-1),gt=Kt[0],On=Kt[1],Bt=B.useRef(),xr=Gn(Nr,Bt),ir=Gn(t,xr),mi=qn(function(ze){var Xe=Number(ze.currentTarget.getAttribute("data-index"));An(ze)&&On(Xe),Ie(Xe)}),Co=qn(function(){gt!==-1&&(On(-1),yn()),Ie(-1)}),$s=qn(function(ze){var Xe=Number(ze.currentTarget.getAttribute("data-index"));Ie(Xe)}),Ze=qn(function(){Ie(-1)}),Rn=xe.direction==="rtl",js=qn(function(ze){var Xe=Number(ze.currentTarget.getAttribute("data-index")),At=ot[Xe],Ht=(L-F)/10,dt=Pt.map(function(xi){return xi.value}),wn=dt.indexOf(At),bt,ys=Rn?"ArrowLeft":"ArrowRight",xs=Rn?"ArrowRight":"ArrowLeft";switch(ze.key){case"Home":bt=F;break;case"End":bt=L;break;case"PageUp":U&&(bt=At+Ht);break;case"PageDown":U&&(bt=At-Ht);break;case ys:case"ArrowUp":U?bt=At+U:bt=dt[wn+1]||dt[dt.length-1];break;case xs:case"ArrowDown":U?bt=At-U:bt=dt[wn-1]||dt[0];break;default:return}if(ze.preventDefault(),U&&(bt=q3(bt,U,F)),bt=T0(bt,F,L),ht){var yi=bt;bt=K3({values:ot,source:Vt,newValue:bt,index:Xe}).sort(b0),Mh({sliderRef:Bt,activeIndex:bt.indexOf(yi)})}It(bt),On(Xe),q&&q(ze,bt),Q&&Q(ze,bt)}),Gr=B.useRef(),xn=pe;Rn&&pe!=="vertical"&&(xn+="-reverse");var or=function(Xe){var At=Xe.finger,Ht=Xe.move,dt=Ht===void 0?!1:Ht,wn=Xe.values,bt=Xe.source,ys=Bt.current,xs=ys.getBoundingClientRect(),yi=xs.width,xi=xs.height,Lr=xs.bottom,Io=xs.left,Fr;xn.indexOf("vertical")===0?Fr=(Lr-At.y)/xi:Fr=(At.x-Io)/yi,xn.indexOf("-reverse")!==-1&&(Fr=1-Fr);var Jt;if(Jt=Qk(Fr,F,L),U)Jt=q3(Jt,U,F);else{var Jr=Pt.map(function(uc){return uc.value}),ws=Y3(Jr,Jt);Jt=Jr[ws]}Jt=T0(Jt,F,L);var lr=0;if(ht){dt?lr=Gr.current:lr=Y3(wn,Jt);var wi=Jt;Jt=K3({values:wn,source:bt,newValue:Jt,index:lr}).sort(b0),lr=Jt.indexOf(wi),Gr.current=lr}return{newValue:Jt,activeIndex:lr}},ar=qn(function(ze){var Xe=Ph(ze,Pe);if(Xe){var At=or({finger:Xe,move:!0,values:ot,source:Vt}),Ht=At.newValue,dt=At.activeIndex;Mh({sliderRef:Bt,activeIndex:dt,setActive:tt}),It(Ht),q&&q(ze,Ht)}}),Dr=qn(function(ze){var Xe=Ph(ze,Pe);if(Xe){var At=or({finger:Xe,values:ot,source:Vt}),Ht=At.newValue;tt(-1),ze.type==="touchend"&&Ie(-1),Q&&Q(ze,Ht),Pe.current=void 0;var dt=cs(Bt.current);dt.removeEventListener("mousemove",ar),dt.removeEventListener("mouseup",Dr),dt.removeEventListener("touchmove",ar),dt.removeEventListener("touchend",Dr)}}),vi=qn(function(ze){ze.preventDefault();var Xe=ze.changedTouches[0];Xe!=null&&(Pe.current=Xe.identifier);var At=Ph(ze,Pe),Ht=or({finger:At,values:ot,source:Vt}),dt=Ht.newValue,wn=Ht.activeIndex;Mh({sliderRef:Bt,activeIndex:wn,setActive:tt}),It(dt),q&&q(ze,dt);var bt=cs(Bt.current);bt.addEventListener("touchmove",ar),bt.addEventListener("touchend",Dr)});B.useEffect(function(){var ze=Bt.current;ze.addEventListener("touchstart",vi);var Xe=cs(ze);return function(){ze.removeEventListener("touchstart",vi),Xe.removeEventListener("mousemove",ar),Xe.removeEventListener("mouseup",Dr),Xe.removeEventListener("touchmove",ar),Xe.removeEventListener("touchend",Dr)}},[Dr,ar,vi]);var ka=qn(function(ze){le&&le(ze),ze.preventDefault();var Xe=Ph(ze,Pe),At=or({finger:Xe,values:ot,source:Vt}),Ht=At.newValue,dt=At.activeIndex;Mh({sliderRef:Bt,activeIndex:dt,setActive:tt}),It(Ht),q&&q(ze,Ht);var wn=cs(Bt.current);wn.addEventListener("mousemove",ar),wn.addEventListener("mouseup",Dr)}),_i=Ih(ht?ot[0]:F,F,L),Po=Ih(ot[ot.length-1],F,L)-_i,Oa=Ee({},kh[xn].offset(_i),kh[xn].leap(Po));return B.createElement(p,Ee({ref:ir,className:Tt(o.root,o["color".concat(Yr(f))],a,x&&o.disabled,Pt.length>0&&Pt.some(function(ze){return ze.label})&&o.marked,k===!1&&o.trackFalse,pe==="vertical"&&o.vertical,k==="inverted"&&o.trackInverted),onMouseDown:ka},me),B.createElement("span",{className:o.rail}),B.createElement("span",{className:o.track,style:Oa}),B.createElement("input",{value:ot.join(","),name:j,type:"hidden"}),Pt.map(function(ze,Xe){var At=Ih(ze.value,F,L),Ht=kh[xn].offset(At),dt;return k===!1?dt=ot.indexOf(ze.value)!==-1:dt=k==="normal"&&(ht?ze.value>=ot[0]&&ze.value<=ot[ot.length-1]:ze.value<=ot[0])||k==="inverted"&&(ht?ze.value<=ot[0]||ze.value>=ot[ot.length-1]:ze.value>=ot[0]),B.createElement(B.Fragment,{key:ze.value},B.createElement("span",{style:Ht,"data-index":Xe,className:Tt(o.mark,dt&&o.markActive)}),ze.label!=null?B.createElement("span",{"aria-hidden":!0,"data-index":Xe,style:Ht,className:Tt(o.markLabel,dt&&o.markLabelActive)},ze.label):null)}),ot.map(function(ze,Xe){var At=Ih(ze,F,L),Ht=kh[xn].offset(At);return B.createElement(W,{key:Xe,valueLabelFormat:ce,valueLabelDisplay:ee,className:o.valueLabel,value:typeof ce=="function"?ce(ve(ze),Xe):ce,index:Xe,open:He===Xe||Ke===Xe||ee==="on",disabled:x},B.createElement(N,{className:Tt(o.thumb,o["thumbColor".concat(Yr(f))],Ke===Xe&&o.active,x&&o.disabled,gt===Xe&&o.focusVisible),tabIndex:x?null:0,role:"slider",style:Ht,"data-index":Xe,"aria-label":w?w(Xe):r,"aria-labelledby":s,"aria-orientation":pe,"aria-valuemax":ve(L),"aria-valuemin":ve(F),"aria-valuenow":ve(ze),"aria-valuetext":T?T(ve(ze),Xe):i,onKeyDown:js,onFocus:mi,onBlur:Co,onMouseOver:$s,onMouseLeave:Ze}))}))});const Wp=En(Jk,{name:"MuiSlider"})(e5);let t5=0;function n5(n,e){const t=`atom${++t5}`,r={toString:()=>t};return typeof n=="function"?r.read=n:(r.init=n,r.read=s=>s(r),r.write=(s,i,o)=>i(r,typeof o=="function"?o(s(r)):o)),e&&(r.write=e),r}const Pr={},po=Symbol(),kv=n=>!!n[po],Oh=n=>!n[po].c,Hc=n=>{var e;const{b:t,c:r}=n[po];r&&(r(),(e=s5.get(t))==null||e())},ad=(n,e)=>{const t=n[po].o,r=e[po].o;return t===r||n===r||kv(t)&&ad(t,e)},Ov=(n,e)=>{const t={b:n,o:e,c:null},r=new Promise(s=>{t.c=()=>{t.c=null,s()},e.finally(t.c)});return r[po]=t,r},r5=n=>Ov(n[po].b,n[po].o),s5=new WeakMap,Nh=n=>"init"in n,Nv="r",Dv="w",Mu="c",Lv="s",Q3="h",i5="n",o5="l",a5="a",l5="m",c5=n=>{const e=new WeakMap,t=new WeakMap,r=new Map;let s,i;if((Pr&&"production")!=="production"&&(s=new Set,i=new Set),n)for(const[k,b]of n){const O={v:b,r:0,y:!0,d:new Map};(Pr&&"production")!=="production"&&(Object.freeze(O),Nh(k)||console.warn("Found initial value for derived atom which can cause unexpected behavior",k)),e.set(k,O)}const o=new WeakMap,a=(k,b,O)=>{let W=o.get(b);W||(W=new Map,o.set(b,W)),O.then(()=>{W.get(k)===O&&(W.delete(k),W.size||o.delete(b))}),W.set(k,O)},u=k=>{const b=new Set,O=o.get(k);return O&&(o.delete(k),O.forEach((W,K)=>{Hc(W),b.add(K)})),b},f=new WeakMap,h=k=>{let b=f.get(k);return b||(b=new Map,f.set(k,b)),b},p=(k,b)=>{if(k){const O=h(k);let W=O.get(b);return W||(W=p(k.p,b),W&&"p"in W&&Oh(W.p)&&(W=void 0),W&&O.set(b,W)),W}return e.get(b)},m=(k,b,O)=>{if((Pr&&"production")!=="production"&&Object.freeze(O),k)h(k).set(b,O);else{const W=e.get(b);e.set(b,O),r.has(b)||r.set(b,W)}},v=(k,b=new Map,O)=>{if(!O)return b;const W=new Map;let K=!1;return O.forEach(ee=>{var te;const ce=((te=p(k,ee))==null?void 0:te.r)||0;W.set(ee,ce),b.get(ee)!==ce&&(K=!0)}),b.size===W.size&&!K?b:W},x=(k,b,O,W,K)=>{const ee=p(k,b);if(ee){if(K&&(!("p"in ee)||!ad(ee.p,K)))return ee;"p"in ee&&Hc(ee.p)}const te={v:O,r:(ee==null?void 0:ee.r)||0,y:!0,d:v(k,ee==null?void 0:ee.d,W)};let ce=!(ee!=null&&ee.y);return!ee||!("v"in ee)||!Object.is(ee.v,O)?(ce=!0,++te.r,te.d.has(b)&&(te.d=new Map(te.d).set(b,te.r))):te.d!==ee.d&&(te.d.size!==ee.d.size||!Array.from(te.d.keys()).every(me=>ee.d.has(me)))&&(ce=!0,Promise.resolve().then(()=>{Me(k)})),ee&&!ce?ee:(m(k,b,te),te)},w=(k,b,O,W,K)=>{const ee=p(k,b);if(ee){if(K&&(!("p"in ee)||!ad(ee.p,K)))return ee;"p"in ee&&Hc(ee.p)}const te={e:O,r:((ee==null?void 0:ee.r)||0)+1,y:!0,d:v(k,ee==null?void 0:ee.d,W)};return m(k,b,te),te},T=(k,b,O,W)=>{const K=p(k,b);if(K&&"p"in K){if(ad(K.p,O)&&!Oh(K.p))return K.y?K:{...K,y:!0};Hc(K.p)}a(k,b,O);const ee={p:O,r:((K==null?void 0:K.r)||0)+1,y:!0,d:v(k,K==null?void 0:K.d,W)};return m(k,b,ee),ee},E=(k,b,O,W)=>{if(O instanceof Promise){const K=Ov(O,O.then(ee=>{x(k,b,ee,W,K)}).catch(ee=>{if(ee instanceof Promise)return kv(ee)?ee.then(()=>{P(k,b,!0)}):ee;w(k,b,ee,W,K)}));return T(k,b,K,W)}return x(k,b,O,W)},C=(k,b)=>{const O=p(k,b);if(O){const W={...O,y:!1};m(k,b,W)}else(Pr&&"production")!=="production"&&console.warn("[Bug] could not invalidate non existing atom",b)},P=(k,b,O)=>{if(!O){const K=p(k,b);if(K){if(K.y&&"p"in K&&!Oh(K.p))return K;if(K.d.forEach((ee,te)=>{if(te!==b)if(!t.has(te))P(k,te);else{const ce=p(k,te);ce&&!ce.y&&P(k,te)}}),Array.from(K.d).every(([ee,te])=>{const ce=p(k,ee);return ce&&!("p"in ce)&&ce.r===te}))return K.y?K:{...K,y:!0}}}const W=new Set;try{const K=b.read(ee=>{W.add(ee);const te=ee===b?p(k,ee):P(k,ee);if(te){if("e"in te)throw te.e;if("p"in te)throw te.p;return te.v}if(Nh(ee))return ee.init;throw new Error("no atom init")});return E(k,b,K,W)}catch(K){if(K instanceof Promise){const ee=kv(K)&&Oh(K)?r5(K):Ov(K,K);return T(k,b,ee,W)}return w(k,b,K,W)}},L=(k,b)=>P(b,k),I=(k,b)=>{let O=t.get(b);return O||(O=pe(k,b)),O},F=(k,b)=>!b.l.size&&(!b.t.size||b.t.size===1&&b.t.has(k)),j=(k,b)=>{const O=t.get(b);O&&F(b,O)&&ne(k,b)},q=(k,b)=>{const O=t.get(b);O==null||O.t.forEach(W=>{W!==b&&(C(k,W),q(k,W))})},Q=(k,b,O)=>{let W=!0;const K=(ce,me)=>{const xe=P(k,ce);if("e"in xe)throw xe.e;if("p"in xe){if(me!=null&&me.unstable_promise)return xe.p.then(()=>{const Pe=p(k,ce);return Pe&&"p"in Pe&&Pe.p===xe.p?new Promise(Ue=>setTimeout(Ue)).then(()=>K(ce,me)):K(ce,me)});throw(Pr&&"production")!=="production"&&console.info("Reading pending atom state in write operation. We throw a promise for now.",ce),xe.p}if("v"in xe)return xe.v;throw(Pr&&"production")!=="production"&&console.warn("[Bug] no value found while reading atom in write operation. This is probably a bug.",ce),new Error("no value found")},ee=(ce,me)=>{let xe;if(ce===b){if(!Nh(ce))throw new Error("atom not writable");u(ce).forEach(tt=>{tt!==k&&E(tt,ce,me)});const Ue=p(k,ce),Ke=E(k,ce,me);Ue!==Ke&&q(k,ce)}else xe=Q(k,ce,me);return W||Me(k),xe},te=b.write(K,ee,O);return W=!1,te},le=(k,b,O)=>{const W=Q(O,k,b);return Me(O),W},he=k=>!!k.write,pe=(k,b,O)=>{const W={t:new Set(O&&[O]),l:new Set};if(t.set(b,W),(Pr&&"production")!=="production"&&i.add(b),P(void 0,b).d.forEach((ee,te)=>{const ce=t.get(te);ce?ce.t.add(b):te!==b&&pe(k,te,b)}),he(b)&&b.onMount){const ee=ce=>le(b,ce,k),te=b.onMount(ee);k=void 0,te&&(W.u=te)}return W},ne=(k,b)=>{var O;const W=(O=t.get(b))==null?void 0:O.u;W&&W(),t.delete(b),(Pr&&"production")!=="production"&&i.delete(b);const K=p(k,b);K?("p"in K&&Hc(K.p),K.d.forEach((ee,te)=>{if(te!==b){const ce=t.get(te);ce&&(ce.t.delete(b),F(te,ce)&&ne(k,te))}})):(Pr&&"production")!=="production"&&console.warn("[Bug] could not find atom state to unmount",b)},ve=(k,b,O,W)=>{const K=new Set(O.d.keys());W==null||W.forEach((ee,te)=>{if(K.has(te)){K.delete(te);return}const ce=t.get(te);ce&&(ce.t.delete(b),F(te,ce)&&ne(k,te))}),K.forEach(ee=>{const te=t.get(ee);te?te.t.add(b):t.has(b)&&pe(k,ee,b)})},Me=k=>{if(k){h(k).forEach((O,W)=>{const K=e.get(W);if(O!==K){const ee=t.get(W);ee==null||ee.l.forEach(te=>te(k))}});return}for(;r.size;){const b=Array.from(r);r.clear(),b.forEach(([O,W])=>{const K=p(void 0,O);if(K&&K.d!==(W==null?void 0:W.d)&&ve(void 0,O,K,W==null?void 0:W.d),W&&!W.y&&(K!=null&&K.y))return;const ee=t.get(O);ee==null||ee.l.forEach(te=>te())})}(Pr&&"production")!=="production"&&s.forEach(b=>b())},U=k=>{h(k).forEach((O,W)=>{const K=e.get(W);(!K||O.r>K.r||O.y!==K.y||O.r===K.r&&O.d!==K.d)&&(e.set(W,O),O.d!==(K==null?void 0:K.d)&&ve(k,W,O,K==null?void 0:K.d))})},H=(k,b)=>{b&&U(b),Me(void 0)},N=(k,b,O)=>{const K=I(O,k).l;return K.add(b),()=>{K.delete(b),j(O,k)}},Y=(k,b)=>{for(const[O,W]of k)Nh(O)&&(E(b,O,W),q(b,O));Me(b)};return(Pr&&"production")!=="production"?{[Nv]:L,[Dv]:le,[Mu]:H,[Lv]:N,[Q3]:Y,[i5]:k=>(s.add(k),()=>{s.delete(k)}),[o5]:()=>i.values(),[a5]:k=>e.get(k),[l5]:k=>t.get(k)}:{[Nv]:L,[Dv]:le,[Mu]:H,[Lv]:N,[Q3]:Y}},aE=(n,e)=>({s:e?e(n).SECRET_INTERNAL_store:c5(n)}),S0=new Map,wy=n=>(S0.has(n)||S0.set(n,B.createContext(aE())),S0.get(n)),u5=({children:n,initialValues:e,scope:t,unstable_createStore:r,unstable_enableVersionedWrite:s})=>{const[i,o]=B.useState({});B.useEffect(()=>{const f=a.current;f.w&&(f.s[Mu](null,i),delete i.p,f.v=i)},[i]);const a=B.useRef();if(!a.current){const f=aE(e,r);if(s){let h=0;f.w=p=>{o(m=>{const v=h?m:{p:m};return p(v),v})},f.v=i,f.r=p=>{++h,p(),--h}}a.current=f}const u=wy(t);return B.createElement(u.Provider,{value:a.current},n)};function Fn(n,e){return n5(n,e)}function ku(n,e){const t=wy(e),r=B.useContext(t),{s,v:i}=r,o=m=>{const v=s[Nv](n,m);if((Pr&&"production")!=="production"&&!v.y)throw new Error("should not be invalidated");if("e"in v)throw v.e;if("p"in v)throw v.p;if("v"in v)return v.v;throw new Error("no atom value")},[[a,u,f],h]=B.useReducer((m,v)=>{const x=o(v);return Object.is(m[1],x)&&m[2]===n?m:[v,x,n]},i,m=>{const v=o(m);return[m,v,n]});let p=u;return f!==n&&(h(a),p=o(a)),B.useEffect(()=>{const{v:m}=r;m&&s[Mu](n,m);const v=s[Lv](n,h,m);return h(m),v},[s,n,r]),B.useEffect(()=>{s[Mu](n,a)}),B.useDebugValue(p),p}function Fv(n,e){const t=wy(e),{s:r,w:s}=B.useContext(t);return B.useCallback(o=>{if((Pr&&"production")!=="production"&&!("write"in n))throw new Error("not writable atom");const a=u=>r[Dv](n,o,u);return s?s(a):a()},[r,s,n])}function by(n,e){return"scope"in n&&(console.warn("atom.scope is deprecated. Please do useAtom(atom, scope) instead."),e=n.scope),[ku(n,e),Fv(n,e)]}var Dh={},G3;function f5(){if(G3)return Dh;G3=1;var n=JS();return Dh.createRoot=n.createRoot,Dh.hydrateRoot=n.hydrateRoot,Dh}var h5=f5();const d5=Ea(h5),lE=di(B.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})),p5=di(B.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"})),cE=di(B.createElement("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),uE=di(B.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),fE=di(B.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),hE=di(B.createElement("path",{d:"M19 13H5v-2h14v2z"})),g5=di(B.createElement("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})),m5=di(B.createElement("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})),v5="modulepreload",_5=function(n,e){return new URL(n,e).href},J3={},nr=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(f=>{if(f=_5(f,r),f in J3)return;J3[f]=!0;const h=f.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(!!r)for(let x=o.length-1;x>=0;x--){const w=o[x];if(w.href===f&&(!h||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${p}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":v5,h||(v.as="script"),v.crossOrigin="",v.href=f,u&&v.setAttribute("nonce",u),document.head.appendChild(v),h)return new Promise((x,w)=>{v.addEventListener("load",x),v.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${f}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},y5={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...y5}};const _r=globalThis.mathgl.config;function x5(n,{precision:e=_r.precision}={}){return n=w5(n),`${parseFloat(n.toPrecision(e))}`}function da(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function cn(n,e,t){return T5(n,r=>Math.max(e,Math.min(t,r)))}function ia(n,e,t){return da(n)?n.map((r,s)=>ia(r,e[s],t)):t*e+(1-t)*n}function ii(n,e,t){const r=_r.EPSILON;try{if(n===e)return!0;if(da(n)&&da(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!ii(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=_r.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{_r.EPSILON=r}}function w5(n){return Math.round(n/_r.EPSILON)*_r.EPSILON}function b5(n){return n.clone?n.clone():new Array(n.length)}function T5(n,e,t){if(da(n)){const r=n;t=t||b5(r);for(let s=0;s<t.length&&s<r.length;++s){const i=typeof n=="number"?n:n[s];t[s]=e(i,s,t)}return t}return e(n)}class Ty extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:da(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_r)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+x5(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!ii(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const i=e[s],o=typeof t=="number"?t:t[s];this[s]=i+r*(o-i)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(_r.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function S5(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Ut(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function _u(n,e,t=""){if(_r.debug&&!S5(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Ou(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class dE extends Ty{get x(){return this[0]}set x(e){this[0]=Ut(e)}get y(){return this[1]}set y(e){this[1]=Ut(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];t+=s*s}return Ut(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Ut(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ou(e>=0&&e<this.ELEMENTS,"index is out of range"),Ut(this[e])}setComponent(e,t){return Ou(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const yu=1e-6;let ps=typeof Float32Array<"u"?Float32Array:Array;function E5(){const n=new ps(2);return ps!=Float32Array&&(n[0]=0,n[1]=0),n}function Rd(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function pE(n,e){return n[0]=-e[0],n[1]=-e[1],n}function gE(n,e,t,r){const s=e[0],i=e[1];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n}function A5(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[3]*s+t[6],n[1]=t[1]*r+t[4]*s+t[7],n}function R5(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[4]*s+t[12],n[1]=t[1]*r+t[5]*s+t[13],n}(function(){const n=E5();return function(e,t,r,s,i,o){let a,u;for(t||(t=2),r||(r=0),s?u=Math.min(s*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],i(n,n,o),e[a]=n[0],e[a+1]=n[1];return e}})();function C5(n,e,t){const r=e[0],s=e[1],i=t[3]*r+t[7]*s||1;return n[0]=(t[0]*r+t[4]*s)/i,n[1]=(t[1]*r+t[5]*s)/i,n}function mE(n,e,t){const r=e[0],s=e[1],i=e[2],o=t[3]*r+t[7]*s+t[11]*i||1;return n[0]=(t[0]*r+t[4]*s+t[8]*i)/o,n[1]=(t[1]*r+t[5]*s+t[9]*i)/o,n[2]=(t[2]*r+t[6]*s+t[10]*i)/o,n}function P5(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[2]*s,n[1]=t[1]*r+t[3]*s,n[2]=e[2],n}function I5(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[2]*s,n[1]=t[1]*r+t[3]*s,n[2]=e[2],n[3]=e[3],n}function vE(n,e,t){const r=e[0],s=e[1],i=e[2];return n[0]=t[0]*r+t[3]*s+t[6]*i,n[1]=t[1]*r+t[4]*s+t[7]*i,n[2]=t[2]*r+t[5]*s+t[8]*i,n[3]=e[3],n}function _E(){const n=new ps(3);return ps!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function M5(n){const e=n[0],t=n[1],r=n[2];return Math.sqrt(e*e+t*t+r*r)}function ew(n,e,t){const r=new ps(3);return r[0]=n,r[1]=e,r[2]=t,r}function k5(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function O5(n){const e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function N5(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function D5(n,e){const t=e[0],r=e[1],s=e[2];let i=t*t+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function yE(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ld(n,e,t){const r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],u=t[2];return n[0]=s*u-i*a,n[1]=i*o-r*u,n[2]=r*a-s*o,n}function L5(n,e,t,r){const s=e[0],i=e[1],o=e[2];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n[2]=o+r*(t[2]-o),n}function Sy(n,e,t){const r=e[0],s=e[1],i=e[2];let o=t[3]*r+t[7]*s+t[11]*i+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*s+t[8]*i+t[12])/o,n[1]=(t[1]*r+t[5]*s+t[9]*i+t[13])/o,n[2]=(t[2]*r+t[6]*s+t[10]*i+t[14])/o,n}function xE(n,e,t){const r=e[0],s=e[1],i=e[2];return n[0]=r*t[0]+s*t[3]+i*t[6],n[1]=r*t[1]+s*t[4]+i*t[7],n[2]=r*t[2]+s*t[5]+i*t[8],n}function wE(n,e,t){const r=t[0],s=t[1],i=t[2],o=t[3],a=e[0],u=e[1],f=e[2];let h=s*f-i*u,p=i*a-r*f,m=r*u-s*a,v=s*m-i*p,x=i*h-r*m,w=r*p-s*h;const T=o*2;return h*=T,p*=T,m*=T,v*=2,x*=2,w*=2,n[0]=a+h+v,n[1]=u+p+x,n[2]=f+m+w,n}function F5(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function B5(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function U5(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function V5(n,e){const t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2],u=Math.sqrt((t*t+r*r+s*s)*(i*i+o*o+a*a)),f=u&&yE(n,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}const bE=k5,TE=M5,E0=O5;(function(){const n=_E();return function(e,t,r,s,i,o){let a,u;for(t||(t=3),r||(r=0),s?u=Math.min(s*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const A0=[0,0,0];let Lh;class Fe extends dE{static get ZERO(){return Lh||(Lh=new Fe(0,0,0),Object.freeze(Lh)),Lh}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&da(e)?this.copy(e):(_r.debug&&(Ut(e),Ut(t),Ut(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return _r.debug&&(Ut(e.x),Ut(e.y),Ut(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ut(e)}angle(e){return V5(this,e)}cross(e){return ld(this,this,e),this.check()}rotateX({radians:e,origin:t=A0}){return F5(this,this,t,e),this.check()}rotateY({radians:e,origin:t=A0}){return B5(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=A0}){return U5(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Sy(this,this,e),this.check()}transformAsVector(e){return mE(this,this,e),this.check()}transformByMatrix3(e){return xE(this,this,e),this.check()}transformByMatrix2(e){return P5(this,this,e),this.check()}transformByQuaternion(e){return wE(this,this,e),this.check()}}let Fh;class Ey extends dE{static get ZERO(){return Fh||(Fh=new Ey(0,0,0,0),Object.freeze(Fh)),Fh}constructor(e=0,t=0,r=0,s=0){super(-0,-0,-0,-0),da(e)&&arguments.length===1?this.copy(e):(_r.debug&&(Ut(e),Ut(t),Ut(r),Ut(s)),this[0]=e,this[1]=t,this[2]=r,this[3]=s)}set(e,t,r,s){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return _r.debug&&(Ut(e.x),Ut(e.y),Ut(e.z),Ut(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ut(e)}get w(){return this[3]}set w(e){this[3]=Ut(e)}transform(e){return Sy(this,this,e),this.check()}transformByMatrix3(e){return vE(this,this,e),this.check()}transformByMatrix2(e){return I5(this,this,e),this.check()}transformByQuaternion(e){return wE(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class SE extends Ty{toString(){let e="[";if(_r.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Ut(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[r+s];return t}setColumn(e,t){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=t[s];return this}}function z5(){const n=new ps(9);return ps!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $5(n,e){if(n===e){const t=e[1],r=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=r,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function j5(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],u=e[6],f=e[7],h=e[8],p=h*o-a*f,m=-h*i+a*u,v=f*i-o*u;let x=t*p+r*m+s*v;return x?(x=1/x,n[0]=p*x,n[1]=(-h*r+s*f)*x,n[2]=(a*r-s*o)*x,n[3]=m*x,n[4]=(h*t-s*u)*x,n[5]=(-a*t+s*i)*x,n[6]=v*x,n[7]=(-f*t+r*u)*x,n[8]=(o*t-r*i)*x,n):null}function W5(n){const e=n[0],t=n[1],r=n[2],s=n[3],i=n[4],o=n[5],a=n[6],u=n[7],f=n[8];return e*(f*i-o*u)+t*(-f*s+o*a)+r*(u*s-i*a)}function tw(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],f=e[6],h=e[7],p=e[8],m=t[0],v=t[1],x=t[2],w=t[3],T=t[4],E=t[5],C=t[6],P=t[7],L=t[8];return n[0]=m*r+v*o+x*f,n[1]=m*s+v*a+x*h,n[2]=m*i+v*u+x*p,n[3]=w*r+T*o+E*f,n[4]=w*s+T*a+E*h,n[5]=w*i+T*u+E*p,n[6]=C*r+P*o+L*f,n[7]=C*s+P*a+L*h,n[8]=C*i+P*u+L*p,n}function H5(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],f=e[6],h=e[7],p=e[8],m=t[0],v=t[1];return n[0]=r,n[1]=s,n[2]=i,n[3]=o,n[4]=a,n[5]=u,n[6]=m*r+v*o+f,n[7]=m*s+v*a+h,n[8]=m*i+v*u+p,n}function X5(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],f=e[6],h=e[7],p=e[8],m=Math.sin(t),v=Math.cos(t);return n[0]=v*r+m*o,n[1]=v*s+m*a,n[2]=v*i+m*u,n[3]=v*o-m*r,n[4]=v*a-m*s,n[5]=v*u-m*i,n[6]=f,n[7]=h,n[8]=p,n}function nw(n,e,t){const r=t[0],s=t[1];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function Y5(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=t+t,a=r+r,u=s+s,f=t*o,h=r*o,p=r*a,m=s*o,v=s*a,x=s*u,w=i*o,T=i*a,E=i*u;return n[0]=1-p-x,n[3]=h-E,n[6]=m+T,n[1]=h+E,n[4]=1-f-x,n[7]=v-w,n[2]=m-T,n[5]=v+w,n[8]=1-f-p,n}var Bv;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Bv||(Bv={}));const q5=Object.freeze([1,0,0,0,1,0,0,0,1]);class Bn extends SE{static get IDENTITY(){return Z5()}static get ZERO(){return K5()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Bv}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(q5)}fromObject(e){return this.check()}fromQuaternion(e){return Y5(this,e),this.check()}set(e,t,r,s,i,o,a,u,f){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=u,this[8]=f,this.check()}setRowMajor(e,t,r,s,i,o,a,u,f){return this[0]=e,this[1]=s,this[2]=a,this[3]=t,this[4]=i,this[5]=u,this[6]=r,this[7]=o,this[8]=f,this.check()}determinant(){return W5(this)}transpose(){return $5(this,this),this.check()}invert(){return j5(this,this),this.check()}multiplyLeft(e){return tw(this,e,this),this.check()}multiplyRight(e){return tw(this,this,e),this.check()}rotate(e){return X5(this,this,e),this.check()}scale(e){return Array.isArray(e)?nw(this,this,e):nw(this,this,[e,e]),this.check()}translate(e){return H5(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=A5(t||[-0,-0],e,this);break;case 3:r=xE(t||[-0,-0,-0],e,this);break;case 4:r=vE(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return _u(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Bh,Uh=null;function K5(){return Bh||(Bh=new Bn([0,0,0,0,0,0,0,0,0]),Object.freeze(Bh)),Bh}function Z5(){return Uh||(Uh=new Bn,Object.freeze(Uh)),Uh}function Q5(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function G5(n,e){if(n===e){const t=e[1],r=e[2],s=e[3],i=e[6],o=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=i,n[11]=e[14],n[12]=s,n[13]=o,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Uv(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],u=e[6],f=e[7],h=e[8],p=e[9],m=e[10],v=e[11],x=e[12],w=e[13],T=e[14],E=e[15],C=t*a-r*o,P=t*u-s*o,L=t*f-i*o,I=r*u-s*a,F=r*f-i*a,j=s*f-i*u,q=h*w-p*x,Q=h*T-m*x,le=h*E-v*x,he=p*T-m*w,pe=p*E-v*w,ne=m*E-v*T;let ve=C*ne-P*pe+L*he+I*le-F*Q+j*q;return ve?(ve=1/ve,n[0]=(a*ne-u*pe+f*he)*ve,n[1]=(s*pe-r*ne-i*he)*ve,n[2]=(w*j-T*F+E*I)*ve,n[3]=(m*F-p*j-v*I)*ve,n[4]=(u*le-o*ne-f*Q)*ve,n[5]=(t*ne-s*le+i*Q)*ve,n[6]=(T*L-x*j-E*P)*ve,n[7]=(h*j-m*L+v*P)*ve,n[8]=(o*pe-a*le+f*q)*ve,n[9]=(r*le-t*pe-i*q)*ve,n[10]=(x*F-w*L+E*C)*ve,n[11]=(p*L-h*F-v*C)*ve,n[12]=(a*Q-o*he-u*q)*ve,n[13]=(t*he-r*Q+s*q)*ve,n[14]=(w*P-x*I-T*C)*ve,n[15]=(h*I-p*P+m*C)*ve,n):null}function J5(n){const e=n[0],t=n[1],r=n[2],s=n[3],i=n[4],o=n[5],a=n[6],u=n[7],f=n[8],h=n[9],p=n[10],m=n[11],v=n[12],x=n[13],w=n[14],T=n[15],E=e*o-t*i,C=e*a-r*i,P=t*a-r*o,L=f*x-h*v,I=f*w-p*v,F=h*w-p*x,j=e*F-t*I+r*L,q=i*F-o*I+a*L,Q=f*P-h*C+p*E,le=v*P-x*C+w*E;return u*j-s*q+T*Q-m*le}function oa(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],u=e[5],f=e[6],h=e[7],p=e[8],m=e[9],v=e[10],x=e[11],w=e[12],T=e[13],E=e[14],C=e[15];let P=t[0],L=t[1],I=t[2],F=t[3];return n[0]=P*r+L*a+I*p+F*w,n[1]=P*s+L*u+I*m+F*T,n[2]=P*i+L*f+I*v+F*E,n[3]=P*o+L*h+I*x+F*C,P=t[4],L=t[5],I=t[6],F=t[7],n[4]=P*r+L*a+I*p+F*w,n[5]=P*s+L*u+I*m+F*T,n[6]=P*i+L*f+I*v+F*E,n[7]=P*o+L*h+I*x+F*C,P=t[8],L=t[9],I=t[10],F=t[11],n[8]=P*r+L*a+I*p+F*w,n[9]=P*s+L*u+I*m+F*T,n[10]=P*i+L*f+I*v+F*E,n[11]=P*o+L*h+I*x+F*C,P=t[12],L=t[13],I=t[14],F=t[15],n[12]=P*r+L*a+I*p+F*w,n[13]=P*s+L*u+I*m+F*T,n[14]=P*i+L*f+I*v+F*E,n[15]=P*o+L*h+I*x+F*C,n}function Cd(n,e,t){const r=t[0],s=t[1],i=t[2];let o,a,u,f,h,p,m,v,x,w,T,E;return e===n?(n[12]=e[0]*r+e[4]*s+e[8]*i+e[12],n[13]=e[1]*r+e[5]*s+e[9]*i+e[13],n[14]=e[2]*r+e[6]*s+e[10]*i+e[14],n[15]=e[3]*r+e[7]*s+e[11]*i+e[15]):(o=e[0],a=e[1],u=e[2],f=e[3],h=e[4],p=e[5],m=e[6],v=e[7],x=e[8],w=e[9],T=e[10],E=e[11],n[0]=o,n[1]=a,n[2]=u,n[3]=f,n[4]=h,n[5]=p,n[6]=m,n[7]=v,n[8]=x,n[9]=w,n[10]=T,n[11]=E,n[12]=o*r+h*s+x*i+e[12],n[13]=a*r+p*s+w*i+e[13],n[14]=u*r+m*s+T*i+e[14],n[15]=f*r+v*s+E*i+e[15]),n}function Ay(n,e,t){const r=t[0],s=t[1],i=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*i,n[9]=e[9]*i,n[10]=e[10]*i,n[11]=e[11]*i,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function eO(n,e,t,r){let s=r[0],i=r[1],o=r[2],a=Math.sqrt(s*s+i*i+o*o),u,f,h,p,m,v,x,w,T,E,C,P,L,I,F,j,q,Q,le,he,pe,ne,ve,Me;return a<yu?null:(a=1/a,s*=a,i*=a,o*=a,f=Math.sin(t),u=Math.cos(t),h=1-u,p=e[0],m=e[1],v=e[2],x=e[3],w=e[4],T=e[5],E=e[6],C=e[7],P=e[8],L=e[9],I=e[10],F=e[11],j=s*s*h+u,q=i*s*h+o*f,Q=o*s*h-i*f,le=s*i*h-o*f,he=i*i*h+u,pe=o*i*h+s*f,ne=s*o*h+i*f,ve=i*o*h-s*f,Me=o*o*h+u,n[0]=p*j+w*q+P*Q,n[1]=m*j+T*q+L*Q,n[2]=v*j+E*q+I*Q,n[3]=x*j+C*q+F*Q,n[4]=p*le+w*he+P*pe,n[5]=m*le+T*he+L*pe,n[6]=v*le+E*he+I*pe,n[7]=x*le+C*he+F*pe,n[8]=p*ne+w*ve+P*Me,n[9]=m*ne+T*ve+L*Me,n[10]=v*ne+E*ve+I*Me,n[11]=x*ne+C*ve+F*Me,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function EE(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[4],o=e[5],a=e[6],u=e[7],f=e[8],h=e[9],p=e[10],m=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=i*s+f*r,n[5]=o*s+h*r,n[6]=a*s+p*r,n[7]=u*s+m*r,n[8]=f*s-i*r,n[9]=h*s-o*r,n[10]=p*s-a*r,n[11]=m*s-u*r,n}function tO(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],u=e[3],f=e[8],h=e[9],p=e[10],m=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*s-f*r,n[1]=o*s-h*r,n[2]=a*s-p*r,n[3]=u*s-m*r,n[8]=i*r+f*s,n[9]=o*r+h*s,n[10]=a*r+p*s,n[11]=u*r+m*s,n}function AE(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],u=e[3],f=e[4],h=e[5],p=e[6],m=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*s+f*r,n[1]=o*s+h*r,n[2]=a*s+p*r,n[3]=u*s+m*r,n[4]=f*s-i*r,n[5]=h*s-o*r,n[6]=p*s-a*r,n[7]=m*s-u*r,n}function nO(n,e){const t=e[0],r=e[1],s=e[2],i=e[4],o=e[5],a=e[6],u=e[8],f=e[9],h=e[10];return n[0]=Math.sqrt(t*t+r*r+s*s),n[1]=Math.sqrt(i*i+o*o+a*a),n[2]=Math.sqrt(u*u+f*f+h*h),n}function rO(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=t+t,a=r+r,u=s+s,f=t*o,h=r*o,p=r*a,m=s*o,v=s*a,x=s*u,w=i*o,T=i*a,E=i*u;return n[0]=1-p-x,n[1]=h+E,n[2]=m-T,n[3]=0,n[4]=h-E,n[5]=1-f-x,n[6]=v+w,n[7]=0,n[8]=m+T,n[9]=v-w,n[10]=1-f-p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function sO(n,e,t,r,s,i,o){const a=1/(t-e),u=1/(s-r),f=1/(i-o);return n[0]=i*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i*2*u,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(s+r)*u,n[10]=(o+i)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*i*2*f,n[15]=0,n}function iO(n,e,t,r,s){const i=1/Math.tan(e/2);if(n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const o=1/(r-s);n[10]=(s+r)*o,n[14]=2*s*r*o}else n[10]=-1,n[14]=-2*r;return n}const oO=iO;function aO(n,e,t,r,s,i,o){const a=1/(e-t),u=1/(r-s),f=1/(i-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(e+t)*a,n[13]=(s+r)*u,n[14]=(o+i)*f,n[15]=1,n}const lO=aO;function cO(n,e,t,r){let s,i,o,a,u,f,h,p,m,v;const x=e[0],w=e[1],T=e[2],E=r[0],C=r[1],P=r[2],L=t[0],I=t[1],F=t[2];return Math.abs(x-L)<yu&&Math.abs(w-I)<yu&&Math.abs(T-F)<yu?Q5(n):(p=x-L,m=w-I,v=T-F,s=1/Math.sqrt(p*p+m*m+v*v),p*=s,m*=s,v*=s,i=C*v-P*m,o=P*p-E*v,a=E*m-C*p,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),u=m*a-v*o,f=v*i-p*a,h=p*o-m*i,s=Math.sqrt(u*u+f*f+h*h),s?(s=1/s,u*=s,f*=s,h*=s):(u=0,f=0,h=0),n[0]=i,n[1]=u,n[2]=p,n[3]=0,n[4]=o,n[5]=f,n[6]=m,n[7]=0,n[8]=a,n[9]=h,n[10]=v,n[11]=0,n[12]=-(i*x+o*w+a*T),n[13]=-(u*x+f*w+h*T),n[14]=-(p*x+m*w+v*T),n[15]=1,n)}function uO(){const n=new ps(4);return ps!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function fO(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function Ry(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function hO(n){const e=n[0],t=n[1],r=n[2],s=n[3];return Math.sqrt(e*e+t*t+r*r+s*s)}function dO(n){const e=n[0],t=n[1],r=n[2],s=n[3];return e*e+t*t+r*r+s*s}function pO(n,e){const t=e[0],r=e[1],s=e[2],i=e[3];let o=t*t+r*r+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=r*o,n[2]=s*o,n[3]=i*o,n}function gO(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function mO(n,e,t,r){const s=e[0],i=e[1],o=e[2],a=e[3];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n[2]=o+r*(t[2]-o),n[3]=a+r*(t[3]-a),n}function sc(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3];return n[0]=t[0]*r+t[4]*s+t[8]*i+t[12]*o,n[1]=t[1]*r+t[5]*s+t[9]*i+t[13]*o,n[2]=t[2]*r+t[6]*s+t[10]*i+t[14]*o,n[3]=t[3]*r+t[7]*s+t[11]*i+t[15]*o,n}function vO(n,e,t){const r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],u=t[2],f=t[3],h=f*r+a*i-u*s,p=f*s+u*r-o*i,m=f*i+o*s-a*r,v=-o*r-a*s-u*i;return n[0]=h*f+v*-o+p*-u-m*-a,n[1]=p*f+v*-a+m*-o-h*-u,n[2]=m*f+v*-u+h*-a-p*-o,n[3]=e[3],n}(function(){const n=uO();return function(e,t,r,s,i,o){let a,u;for(t||(t=4),r||(r=0),s?u=Math.min(s*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var Vv;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Vv||(Vv={}));const _O=45*Math.PI/180,yO=1,R0=.1,C0=500,xO=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class St extends SE{static get IDENTITY(){return bO()}static get ZERO(){return wO()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Vv}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,s,i,o,a,u,f,h,p,m,v,x,w,T){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=u,this[8]=f,this[9]=h,this[10]=p,this[11]=m,this[12]=v,this[13]=x,this[14]=w,this[15]=T,this.check()}setRowMajor(e,t,r,s,i,o,a,u,f,h,p,m,v,x,w,T){return this[0]=e,this[1]=i,this[2]=f,this[3]=v,this[4]=t,this[5]=o,this[6]=h,this[7]=x,this[8]=r,this[9]=a,this[10]=p,this[11]=w,this[12]=s,this[13]=u,this[14]=m,this[15]=T,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(xO)}fromObject(e){return this.check()}fromQuaternion(e){return rO(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:s,top:i,near:o=R0,far:a=C0}=e;return a===1/0?TO(this,t,r,s,i,o):sO(this,t,r,s,i,o,a),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:s=[0,1,0]}=e;return cO(this,t,r,s),this.check()}ortho(e){const{left:t,right:r,bottom:s,top:i,near:o=R0,far:a=C0}=e;return lO(this,t,r,s,i,o,a),this.check()}orthographic(e){const{fovy:t=_O,aspect:r=yO,focalDistance:s=1,near:i=R0,far:o=C0}=e;rw(t);const a=t/2,u=s*Math.tan(a),f=u*r;return this.ortho({left:-f,right:f,bottom:-u,top:u,near:i,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:s=.1,far:i=500}=e;return rw(t),oO(this,t,r,s,i),this.check()}determinant(){return J5(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return G5(this,this),this.check()}invert(){return Uv(this,this),this.check()}multiplyLeft(e){return oa(this,e,this),this.check()}multiplyRight(e){return oa(this,this,e),this.check()}rotateX(e){return EE(this,this,e),this.check()}rotateY(e){return tO(this,this,e),this.check()}rotateZ(e){return AE(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return eO(this,this,e,t),this.check()}scale(e){return Ay(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Cd(this,this,e),this.check()}transform(e,t){return e.length===4?(t=sc(t||[-0,-0,-0,-0],e,this),_u(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let s;switch(r){case 2:s=R5(t||[-0,-0],e,this);break;case 3:s=Sy(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return _u(s,e.length),s}transformAsVector(e,t){let r;switch(e.length){case 2:r=C5(t||[-0,-0],e,this);break;case 3:r=mE(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return _u(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let Vh,zh;function wO(){return Vh||(Vh=new St([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Vh)),Vh}function bO(){return zh||(zh=new St,Object.freeze(zh)),zh}function rw(n){if(n>Math.PI*2)throw Error("expected radians")}function TO(n,e,t,r,s,i){const o=2*i/(t-e),a=2*i/(s-r),u=(t+e)/(t-e),f=(s+r)/(s-r),h=-1,p=-1,m=-2*i;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=u,n[9]=f,n[10]=h,n[11]=p,n[12]=0,n[13]=0,n[14]=m,n[15]=0,n}function sw(){const n=new ps(4);return ps!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function SO(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function RE(n,e,t){t=t*.5;const r=Math.sin(t);return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=Math.cos(t),n}function iw(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=t[0],u=t[1],f=t[2],h=t[3];return n[0]=r*h+o*a+s*f-i*u,n[1]=s*h+o*u+i*a-r*f,n[2]=i*h+o*f+r*u-s*a,n[3]=o*h-r*a-s*u-i*f,n}function EO(n,e,t){t*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+o*a,n[1]=s*u+i*a,n[2]=i*u-s*a,n[3]=o*u-r*a,n}function AO(n,e,t){t*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u-i*a,n[1]=s*u+o*a,n[2]=i*u+r*a,n[3]=o*u-s*a,n}function RO(n,e,t){t*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+s*a,n[1]=s*u-r*a,n[2]=i*u+o*a,n[3]=o*u-i*a,n}function CO(n,e){const t=e[0],r=e[1],s=e[2];return n[0]=t,n[1]=r,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-r*r-s*s)),n}function cd(n,e,t,r){const s=e[0],i=e[1],o=e[2],a=e[3];let u=t[0],f=t[1],h=t[2],p=t[3],m,v,x,w,T;return m=s*u+i*f+o*h+a*p,m<0&&(m=-m,u=-u,f=-f,h=-h,p=-p),1-m>yu?(v=Math.acos(m),T=Math.sin(v),x=Math.sin((1-r)*v)/T,w=Math.sin(r*v)/T):(x=1-r,w=r),n[0]=x*s+w*u,n[1]=x*i+w*f,n[2]=x*o+w*h,n[3]=x*a+w*p,n}function PO(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=t*t+r*r+s*s+i*i,a=o?1/o:0;return n[0]=-t*a,n[1]=-r*a,n[2]=-s*a,n[3]=i*a,n}function IO(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function CE(n,e){const t=e[0]+e[4]+e[8];let r;if(t>0)r=Math.sqrt(t+1),n[3]=.5*r,r=.5/r,n[0]=(e[5]-e[7])*r,n[1]=(e[6]-e[2])*r,n[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const i=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[s*3+s]-e[i*3+i]-e[o*3+o]+1),n[s]=.5*r,r=.5/r,n[3]=(e[i*3+o]-e[o*3+i])*r,n[i]=(e[i*3+s]+e[s*3+i])*r,n[o]=(e[o*3+s]+e[s*3+o])*r}return n}const MO=fO,kO=Ry,OO=gO,NO=mO,DO=hO,LO=dO,PE=pO,FO=function(){const n=_E(),e=ew(1,0,0),t=ew(0,1,0);return function(r,s,i){const o=yE(s,i);return o<-.999999?(ld(n,e,s),TE(n)<1e-6&&ld(n,t,s),D5(n,n),RE(r,n,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ld(n,s,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+o,PE(r,r))}}();(function(){const n=sw(),e=sw();return function(t,r,s,i,o,a){return cd(n,r,o,a),cd(e,s,i,a),cd(t,n,e,2*a*(1-a)),t}})();(function(){const n=z5();return function(e,t,r,s){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],PE(e,CE(e,n))}})();const BO=[0,0,0,1];class ow extends Ty{constructor(e=0,t=0,r=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,s){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return CE(this,e),this.check()}fromAxisRotation(e,t){return RE(this,e,t),this.check()}identity(){return SO(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ut(e)}get y(){return this[1]}set y(e){this[1]=Ut(e)}get z(){return this[2]}set z(e){this[2]=Ut(e)}get w(){return this[3]}set w(e){this[3]=Ut(e)}len(){return DO(this)}lengthSquared(){return LO(this)}dot(e){return OO(this,e)}rotationTo(e,t){return FO(this,e,t),this.check()}add(e){return MO(this,this,e),this.check()}calculateW(){return CO(this,this),this.check()}conjugate(){return IO(this,this),this.check()}invert(){return PO(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(NO(this,e,t,r),this.check())}multiplyRight(e){return iw(this,this,e),this.check()}multiplyLeft(e){return iw(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return EO(this,this,e),this.check()}rotateY(e){return AO(this,this,e),this.check()}rotateZ(e){return RO(this,this,e),this.check()}scale(e){return kO(this,this,e),this.check()}slerp(e,t,r){let s,i,o;switch(arguments.length){case 1:({start:s=BO,target:i,ratio:o}=e);break;case 2:s=this,i=e,o=t;break;default:s=e,i=t,o=r}return cd(this,s,i,o),this.check()}transformVector4(e,t=new Ey){return vO(t,e,this),_u(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const UO=1e-15,VO=1e-20;class Aa extends Error{constructor(e,t={}){super(`Node not found: ${e}`,t),this.name="NodeNotFoundError"}}class Cy extends Error{constructor(e){super(`Missing key: ${e}`),this.name="KeyError"}}var Mr;class IE{constructor(e,t,r){vt(this,Mr);typeof e=="number"?nt(this,Mr,new Uint8Array(e)):e instanceof ArrayBuffer?nt(this,Mr,new Uint8Array(e,t,r)):nt(this,Mr,new Uint8Array(Array.from(e,s=>s?1:0)))}get BYTES_PER_ELEMENT(){return 1}get byteOffset(){return be(this,Mr).byteOffset}get byteLength(){return be(this,Mr).byteLength}get buffer(){return be(this,Mr).buffer}get length(){return be(this,Mr).length}get(e){let t=be(this,Mr)[e];return typeof t=="number"?t!==0:t}set(e,t){be(this,Mr)[e]=t?1:0}fill(e){be(this,Mr).fill(e?1:0)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}Mr=new WeakMap;var Fl;class Py{constructor(e,t,r,s){S(this,"_data");S(this,"chars");vt(this,Fl);if(this.chars=e,nt(this,Fl,new TextEncoder),typeof t=="number")this._data=new Uint8Array(t*e);else if(t instanceof ArrayBuffer)s&&(s=s*e),this._data=new Uint8Array(t,r,s);else{let i=Array.from(t);this._data=new Uint8Array(i.length*e);for(let o=0;o<i.length;o++)this.set(o,i[o])}}get BYTES_PER_ELEMENT(){return this.chars}get byteOffset(){return this._data.byteOffset}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get length(){return this.byteLength/this.BYTES_PER_ELEMENT}get(e){const t=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);return new TextDecoder().decode(t).replace(/\x00/g,"")}set(e,t){const r=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);r.fill(0),r.set(be(this,Fl).encode(t))}fill(e){const t=be(this,Fl).encode(e);for(let r=0;r<this.length;r++)this._data.set(t,r*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}Fl=new WeakMap;var Xn;const O1=class O1{constructor(e,t,r,s){vt(this,Xn);S(this,"chars");if(this.chars=e,typeof t=="number")nt(this,Xn,new Int32Array(t*e));else if(t instanceof ArrayBuffer)s&&(s*=e),nt(this,Xn,new Int32Array(t,r,s));else{const i=t,o=new O1(e,1);nt(this,Xn,new Int32Array(function*(){for(let a of i)o.set(0,a),yield*be(o,Xn)}()))}}get BYTES_PER_ELEMENT(){return be(this,Xn).BYTES_PER_ELEMENT*this.chars}get byteLength(){return be(this,Xn).byteLength}get byteOffset(){return be(this,Xn).byteOffset}get buffer(){return be(this,Xn).buffer}get length(){return be(this,Xn).length/this.chars}get(e){const t=this.chars*e;let r="";for(let s=0;s<this.chars;s++)r+=String.fromCodePoint(be(this,Xn)[t+s]);return r.replace(/\u0000/g,"")}set(e,t){const r=this.chars*e,s=be(this,Xn).subarray(r,r+this.chars);s.fill(0);for(let i=0;i<this.chars;i++)s[i]=t.codePointAt(i)??0}fill(e){this.set(0,e);let t=be(this,Xn).subarray(0,this.chars);for(let r=1;r<this.length;r++)be(this,Xn).set(t,r*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}};Xn=new WeakMap;let Nu=O1;function af(n){const e=new TextDecoder().decode(n);return JSON.parse(e)}function aw(n,e){const t=e/2,r=e-1;let s=0;for(let i=0;i<n.length;i+=e)for(let o=0;o<t;o+=1)s=n[i+o],n[i+o]=n[i+r-o],n[i+r-o]=s}function ME(n){if(n==="v2:object")return globalThis.Array;let e=n.match(/v2:([US])(\d+)/);if(e){let[,r,s]=e;return(r==="U"?Nu:Py).bind(null,Number(s))}let t={int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:globalThis.BigInt64Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:globalThis.BigUint64Array,float16:globalThis.Float16Array,float32:Float32Array,float64:Float64Array,bool:IE}[n];return kn(t,`Unknown or unsupported data_type: ${n}`),t}function pa(n,e){const t=n.length;typeof e=="string"&&(e=e==="C"?Array.from({length:t},(i,o)=>o):Array.from({length:t},(i,o)=>t-1-o)),kn(t===e.length,"Order length must match the number of dimensions.");let r=1,s=new Array(t);for(let i=e.length-1;i>=0;i--)s[e[i]]=r,r*=n[e[i]];return s}function zO({name:n,configuration:e}){if(n==="default"){const t=(e==null?void 0:e.separator)??"/";return r=>["c",...r].join(t)}if(n==="v2"){const t=(e==null?void 0:e.separator)??".";return r=>r.join(t)||"0"}throw new Error(`Unknown chunk key encoding: ${n}`)}function $O(n){if(n==="|O")return{data_type:"v2:object"};let e=n.match(/^([<|>])(.*)$/);kn(e,`Invalid dtype: ${n}`);let[,t,r]=e,s={b1:"bool",i1:"int8",u1:"uint8",i2:"int16",u2:"uint16",i4:"int32",u4:"uint32",i8:"int64",u8:"uint64",f2:"float16",f4:"float32",f8:"float64"}[r]??(r.startsWith("S")||r.startsWith("U")?`v2:${r}`:void 0);return kn(s,`Unsupported or unknown dtype: ${n}`),t==="|"?{data_type:s}:{data_type:s,endian:t==="<"?"little":"big"}}function jO(n,e={}){let t=[],r=$O(n.dtype);n.order==="F"&&t.push({name:"transpose",configuration:{order:"F"}}),"endian"in r&&r.endian==="big"&&t.push({name:"bytes",configuration:{endian:"big"}});for(let{id:s,...i}of n.filters??[])t.push({name:s,configuration:i});if(n.compressor){let{id:s,...i}=n.compressor;t.push({name:s,configuration:i})}return{zarr_format:3,node_type:"array",shape:n.shape,data_type:r.data_type,chunk_grid:{name:"regular",configuration:{chunk_shape:n.chunks}},chunk_key_encoding:{name:"v2",configuration:{separator:n.dimension_separator??"."}},codecs:t,fill_value:n.fill_value,attributes:e}}function WO(n,e={}){return{zarr_format:3,node_type:"group",attributes:e}}function HO(n,e){if(e!=="number"&&e!=="bigint"&&e!=="boolean"&&e!=="object"&&e!=="string")return n===e;let t=n==="bool";if(e==="boolean")return t;let r=n.startsWith("v2:U")||n.startsWith("v2:S");if(e==="string")return r;let s=n==="int64"||n==="uint64";if(e==="bigint")return s;let i=n==="v2:object";return e==="object"?i:!r&&!s&&!t&&!i}function XO(n){return(n==null?void 0:n.name)==="sharding_indexed"}function kE(n){return(n.data_type==="uint64"||n.data_type==="int64")&&n.fill_value!=null?BigInt(n.fill_value):n.fill_value}function OE(n,...e){if(!e.some(t=>n instanceof t))throw n}function kn(n,e=""){if(!n)throw new Error(e)}class Iy{constructor(e,t){S(this,"kind","array_to_array");kn(e.keepbits>=0,"keepbits must be zero or positive")}static fromConfig(e,t){return new Iy(e,t)}encode(e){throw new Error("`BitroundCodec.encode` is not implemented. Please open an issue at https://github.com/manzt/zarrita.js/issues.")}decode(e){return e}}const lw=YO();function YO(){const n=new Uint32Array([305419896]);return new Uint8Array(n.buffer,n.byteOffset,n.byteLength)[0]!==18}function cw(n){return"BYTES_PER_ELEMENT"in n?n.BYTES_PER_ELEMENT:4}var Wu,eo,Hu,Xu,Bl;const N1=class N1{constructor(e,t){S(this,"kind","array_to_bytes");vt(this,Wu);vt(this,eo);vt(this,Hu);vt(this,Xu);vt(this,Bl);nt(this,Bl,e==null?void 0:e.endian),nt(this,eo,ME(t.data_type)),nt(this,Xu,t.shape),nt(this,Wu,pa(t.shape,"C"));const r=new(be(this,eo))(0);nt(this,Hu,r.BYTES_PER_ELEMENT)}static fromConfig(e,t){return new N1(e,t)}encode(e){let t=new Uint8Array(e.data.buffer);return lw&&be(this,Bl)==="big"&&aw(t,cw(be(this,eo))),t}decode(e){return lw&&be(this,Bl)==="big"&&aw(e,cw(be(this,eo))),{data:new(be(this,eo))(e.buffer,e.byteOffset,e.byteLength/be(this,Hu)),shape:be(this,Xu),stride:be(this,Wu)}}};Wu=new WeakMap,eo=new WeakMap,Hu=new WeakMap,Xu=new WeakMap,Bl=new WeakMap;let Pd=N1;class My{constructor(){S(this,"kind","bytes_to_bytes")}static fromConfig(){return new My}encode(e){throw new Error("Not implemented")}decode(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength-4)}}function qO(n,e){return kn(!Number.isNaN(e),"JsonCodec allow_nan is false but NaN was encountered during encoding."),kn(e!==Number.POSITIVE_INFINITY,"JsonCodec allow_nan is false but Infinity was encountered during encoding."),kn(e!==Number.NEGATIVE_INFINITY,"JsonCodec allow_nan is false but -Infinity was encountered during encoding."),e}function KO(n,e){return e instanceof Object&&!Array.isArray(e)?Object.keys(e).sort().reduce((t,r)=>(t[r]=e[r],t),{}):e}var Yu,qu;const D1=class D1{constructor(e={}){S(this,"configuration");S(this,"kind","array_to_bytes");vt(this,Yu);vt(this,qu);this.configuration=e;const{encoding:t="utf-8",skipkeys:r=!1,ensure_ascii:s=!0,check_circular:i=!0,allow_nan:o=!0,sort_keys:a=!0,indent:u,strict:f=!0}=e;let h=e.separators;h||(u?h=[", ",": "]:h=[",",":"]),nt(this,Yu,{encoding:t,skipkeys:r,ensure_ascii:s,check_circular:i,allow_nan:o,indent:u,separators:h,sort_keys:a}),nt(this,qu,{strict:f})}static fromConfig(e){return new D1(e)}encode(e){const{indent:t,encoding:r,ensure_ascii:s,check_circular:i,allow_nan:o,sort_keys:a}=be(this,Yu);kn(r==="utf-8","JsonCodec does not yet support non-utf-8 encoding.");const u=[];kn(i,"JsonCodec does not yet support skipping the check for circular references during encoding."),o||u.push(qO),a&&u.push(KO);const f=Array.from(e.data);f.push("|O"),f.push(e.shape);let h;u.length&&(h=(m,v)=>{let x=v;for(let w of u)x=w(m,x);return x});let p=JSON.stringify(f,h,t);return s&&(p=p.replace(/[\u007F-\uFFFF]/g,m=>{const v=`0000${m.charCodeAt(0).toString(16)}`;return`\\u${v.substring(v.length-4)}`})),new TextEncoder().encode(p)}decode(e){const{strict:t}=be(this,qu);kn(t,"JsonCodec does not yet support non-strict decoding.");const r=af(e),s=r.pop();r.pop(),kn(s,"0D not implemented for JsonCodec.");const i=pa(s,"C");return{data:r,shape:s,stride:i}}};Yu=new WeakMap,qu=new WeakMap;let zv=D1;function uw(n){return n instanceof IE||n instanceof Py||n instanceof Nu?new Proxy(n,{get(t,r){return t.get(Number(r))},set(t,r,s){return t.set(Number(r),s),!0}}):n}function ZO(n,e){let t;return n.data instanceof Py||n.data instanceof Nu?t=new n.constructor(n.data.length,n.data.chars):t=new n.constructor(n.data.length),{data:t,shape:n.shape,stride:pa(n.shape,e)}}function QO(n,e){let t=ZO(n,e),r=n.shape.length,s=n.data.length,i=Array(r).fill(0),o=uw(n.data),a=uw(t.data);for(let u=0;u<s;u++){let f=0;for(let h=0;h<r;h++)f+=i[h]*t.stride[h];a[f]=o[u],i[0]+=1;for(let h=0;h<r;h++)if(i[h]===n.shape[h]){if(h+1===r)break;i[h]=0,i[h+1]+=1}}return t}function GO(n){let e=n.shape.length;return kn(e===n.stride.length,"Shape and stride must have the same length."),n.stride.map((t,r)=>({stride:t,index:r})).sort((t,r)=>r.stride-t.stride).map(t=>t.index)}function JO(n,e){let t=GO(n);return kn(t.length===e.length,"Orders must match"),t.every((r,s)=>r===e[s])}var Ku,Ul;const L1=class L1{constructor(e,t){S(this,"kind","array_to_array");vt(this,Ku);vt(this,Ul);let r=e.order??"C",s=t.shape.length,i=new Array(s),o=new Array(s);if(r==="C")for(let a=0;a<s;++a)i[a]=a,o[a]=a;else if(r==="F")for(let a=0;a<s;++a)i[a]=s-a-1,o[a]=s-a-1;else i=r,i.forEach((a,u)=>{kn(o[a]===void 0,`Invalid permutation: ${JSON.stringify(r)}`),o[a]=u});nt(this,Ku,i),nt(this,Ul,o)}static fromConfig(e,t){return new L1(e,t)}encode(e){return JO(e,be(this,Ul))?e:QO(e,be(this,Ul))}decode(e){return{data:e.data,shape:e.shape,stride:pa(e.shape,be(this,Ku))}}};Ku=new WeakMap,Ul=new WeakMap;let $v=L1;var Zu,Qu;const F1=class F1{constructor(e){S(this,"kind","array_to_bytes");vt(this,Zu);vt(this,Qu);nt(this,Zu,e),nt(this,Qu,pa(e,"C"))}static fromConfig(e,t){return new F1(t.shape)}encode(e){throw new Error("Method not implemented.")}decode(e){let t=new TextDecoder,r=new DataView(e.buffer),s=Array(r.getUint32(0,!0)),i=4;for(let o=0;o<s.length;o++){let a=r.getUint32(i,!0);i+=4,s[o]=t.decode(e.buffer.slice(i,i+a)),i+=a}return{data:s,shape:be(this,Zu),stride:be(this,Qu)}}};Zu=new WeakMap,Qu=new WeakMap;let jv=F1;function eN(){return new Map().set("blosc",()=>nr(()=>import("./blosc-CAH7LpMT.js"),__vite__mapDeps([0,1]),import.meta.url).then(n=>n.default)).set("gzip",()=>nr(()=>import("./gzip-BamaTLWd.js"),__vite__mapDeps([2,3]),import.meta.url).then(n=>n.default)).set("lz4",()=>nr(()=>import("./lz4-CQc_tcCf.js"),__vite__mapDeps([4,1]),import.meta.url).then(n=>n.default)).set("zlib",()=>nr(()=>import("./zlib-B21wBxKw.js"),__vite__mapDeps([5,3]),import.meta.url).then(n=>n.default)).set("zstd",()=>nr(()=>import("./zstd-CIO_1wnt.js"),__vite__mapDeps([6,1]),import.meta.url).then(n=>n.default)).set("transpose",()=>$v).set("bytes",()=>Pd).set("crc32c",()=>My).set("vlen-utf8",()=>jv).set("json2",()=>zv).set("bitround",()=>Iy)}const NE=eN();function Wv(n){let e;return{async encode(t){e||(e=await fw(n));for(const s of e.array_to_array)t=await s.encode(t);let r=await e.array_to_bytes.encode(t);for(const s of e.bytes_to_bytes)r=await s.encode(r);return r},async decode(t){e||(e=await fw(n));for(let s=e.bytes_to_bytes.length-1;s>=0;s--)t=await e.bytes_to_bytes[s].decode(t);let r=await e.array_to_bytes.decode(t);for(let s=e.array_to_array.length-1;s>=0;s--)r=await e.array_to_array[s].decode(r);return r}}}async function fw(n){let e=n.codecs.map(async i=>{var a;let o=await((a=NE.get(i.name))==null?void 0:a());return kn(o,`Unknown codec: ${i.name}`),{Codec:o,meta:i}}),t=[],r,s=[];for await(let{Codec:i,meta:o}of e){let a=i.fromConfig(o.configuration,n);switch(a.kind){case"array_to_array":t.push(a);break;case"array_to_bytes":r=a;break;default:s.push(a)}}return r||(kn(tN(n),`Cannot encode ${n.data_type} to bytes without a codec`),r=Pd.fromConfig({endian:"little"},n)),{array_to_array:t,array_to_bytes:r,bytes_to_bytes:s}}function tN(n){return n.data_type!=="v2:object"}const hw=18446744073709551615n;function nN(n,e,t,r){kn(n.store.getRange,"Store does not support range requests");let s=n.store.getRange.bind(n.store),i=e.map((u,f)=>u/r.chunk_shape[f]),o=Wv({data_type:"uint64",shape:[...i,2],codecs:r.index_codecs}),a={};return async u=>{let f=u.map((C,P)=>Math.floor(C/i[P])),h=n.resolve(t(f)).path,p;if(h in a)p=a[h];else{let C=4,P=16*i.reduce((I,F)=>I*F,1),L=await s(h,{suffixLength:P+C});p=a[h]=L?await o.decode(L):null}if(p===null)return;let{data:m,shape:v,stride:x}=p,w=u.map((C,P)=>C%v[P]).reduce((C,P,L)=>C+P*x[L],0),T=m[w],E=m[w+1];if(!(T===hw&&E===hw))return s(h,{offset:Number(T),length:Number(E)})}}class So{constructor(e,t="/"){S(this,"store");S(this,"path");this.store=e,this.path=t}resolve(e){let t=new URL(`file://${this.path.endsWith("/")?this.path:`${this.path}/`}`);return new So(this.store,new URL(e,t).pathname)}}function rN(n){return new So(n??new Map)}var Gu;class Hp extends So{constructor(t,r,s){super(t,r);S(this,"kind","group");vt(this,Gu);nt(this,Gu,s)}get attrs(){return be(this,Gu).attributes}}Gu=new WeakMap;function dw(n){var t;const e=n.find(r=>r.name==="transpose");return((t=e==null?void 0:e.configuration)==null?void 0:t.order)??"C"}const iu=Symbol("zarrita.context");function sN(n){return n[iu]}function iN(n,e){let{configuration:t}=e.codecs.find(XO)??{},r={encode_chunk_key:zO(e.chunk_key_encoding),TypedArray:ME(e.data_type),fill_value:e.fill_value};if(t){let i=dw(t.codecs);return{...r,kind:"sharded",chunk_shape:t.chunk_shape,codec:Wv({data_type:e.data_type,shape:t.chunk_shape,codecs:t.codecs}),get_strides(o){return pa(o,i)},get_chunk_bytes:nN(n,e.chunk_grid.configuration.chunk_shape,r.encode_chunk_key,t)}}let s=dw(e.codecs);return{...r,kind:"regular",chunk_shape:e.chunk_grid.configuration.chunk_shape,codec:Wv({data_type:e.data_type,shape:e.chunk_grid.configuration.chunk_shape,codecs:e.codecs}),get_strides(i){return pa(i,s)},async get_chunk_bytes(i,o){let a=r.encode_chunk_key(i),u=n.resolve(a).path;return n.store.get(u,o)}}}var mS,vS,na,_S;let Id=(_S=class extends(vS=So,mS=iu,vS){constructor(t,r,s){super(t,r);S(this,"kind","array");vt(this,na);S(this,mS);nt(this,na,{...s,fill_value:kE(s)}),this[iu]=iN(this,s)}get attrs(){return be(this,na).attributes}get shape(){return be(this,na).shape}get chunks(){return this[iu].chunk_shape}get dtype(){return be(this,na).data_type}async getChunk(t,r){let s=this[iu],i=await s.get_chunk_bytes(t,r);if(!i){let o=s.chunk_shape.reduce((u,f)=>u*f,1),a=new s.TypedArray(o);return a.fill(s.fill_value),{data:a,shape:s.chunk_shape,stride:s.get_strides(s.chunk_shape)}}return s.codec.decode(i)}is(t){return HO(this.dtype,t)}},na=new WeakMap,_S),Xp=oN();function oN(){let n=new WeakMap;function e(t){let r=n.get(t)??{v2:0,v3:0};return n.set(t,r),r}return{increment(t,r){e(t)[r]+=1},version_max(t){let r=e(t);return r.v3>r.v2?"v3":"v2"}}}async function aN(n){let e=await n.store.get(n.resolve(".zattrs").path);return e?af(e):{}}async function lN(n,e={}){let t="store"in n?n:new So(n),r={};return(e.attrs??!0)&&(r=await aN(t)),e.kind==="array"?pw(t,r):e.kind==="group"?gw(t,r):pw(t,r).catch(s=>(OE(s,Aa),gw(t,r)))}async function pw(n,e){let{path:t}=n.resolve(".zarray"),r=await n.store.get(t);if(!r)throw new Aa("v2 array",{cause:new Cy(t)});return Xp.increment(n.store,"v2"),new Id(n.store,n.path,jO(af(r),e))}async function gw(n,e){let{path:t}=n.resolve(".zgroup"),r=await n.store.get(t);if(!r)throw new Aa("v2 group",{cause:new Cy(t)});return Xp.increment(n.store,"v2"),new Hp(n.store,n.path,WO(af(r),e))}async function cN(n){let{store:e,path:t}=n.resolve("zarr.json"),r=await n.store.get(t);if(!r)throw new Aa("v3 array or group",{cause:new Cy(t)});let s=af(r);return s.node_type==="array"&&(s.fill_value=kE(s)),s.node_type==="array"?new Id(e,n.path,s):new Hp(e,n.path,s)}async function uN(n,e={}){let t="store"in n?n:new So(n),r=await cN(t);if(Xp.increment(t.store,"v3"),e.kind===void 0||e.kind==="array"&&r instanceof Id||e.kind==="group"&&r instanceof Hp)return r;let s=r instanceof Id?"array":"group";throw new Error(`Expected node of kind ${e.kind}, found ${s}.`)}async function Un(n,e={}){let t="store"in n?n.store:n,r=Xp.version_max(t),s=r==="v2"?Un.v2:Un.v3,i=r==="v2"?Un.v3:Un.v2;return s(n,e).catch(o=>(OE(o,Aa),i(n,e)))}Un.v2=lN;Un.v3=uN;function*fN(n,e,t=1){e===void 0&&(e=n,n=0);for(let r=n;r<e;r+=t)yield r}function*hN(...n){if(n.length===0)return;const e=n.map(r=>r[Symbol.iterator]()),t=e.map(r=>r.next());if(t.some(r=>r.done))throw new Error("Input contains an empty iterator.");for(let r=0;;){if(t[r].done){if(e[r]=n[r][Symbol.iterator](),t[r]=e[r].next(),++r>=e.length)return}else yield t.map(({value:s})=>s),r=0;t[r]=e[r].next()}}function dN({start:n,stop:e,step:t},r){if(t===0)throw new Error("slice step cannot be zero");t=t??1;const s=t<0,[i,o]=s?[-1,r-1]:[0,r];return n===null?n=s?o:i:n<0?(n+=r,n<i&&(n=i)):n>o&&(n=o),e===null?e=s?i:o:e<0?(e+=r,e<i&&(e=i)):e>o&&(e=o),[n,e,t]}function Go(n,e,t=null){return e===void 0&&(e=n,n=null),{start:n,stop:e,step:t}}function pN(){const n=[];return{add:e=>n.push(e()),onIdle:()=>Promise.all(n)}}class ky extends Error{constructor(e){super(e),this.name="IndexError"}}function gN(n,e){throw new ky(`too many indicies for array; expected ${e.length}, got ${n.length}`)}function mN(n){throw new ky(`index out of bounds for dimension with length ${n}`)}function vN(){throw new ky("only slices with step >= 1 are supported")}function _N(n,e){n.length>e.length&&gN(n,e)}function yN(n,e){return n=Math.trunc(n),n<0&&(n=e+n),(n>=e||n<0)&&mN(e),n}class xN{constructor({dim_sel:e,dim_len:t,dim_chunk_len:r}){S(this,"dim_sel");S(this,"dim_len");S(this,"dim_chunk_len");S(this,"nitems");e=yN(e,t),this.dim_sel=e,this.dim_len=t,this.dim_chunk_len=r,this.nitems=1}*[Symbol.iterator](){const e=Math.floor(this.dim_sel/this.dim_chunk_len),t=e*this.dim_chunk_len,r=this.dim_sel-t;yield{dim_chunk_ix:e,dim_chunk_sel:r}}}class mw{constructor({dim_sel:e,dim_len:t,dim_chunk_len:r}){S(this,"start");S(this,"stop");S(this,"step");S(this,"dim_len");S(this,"dim_chunk_len");S(this,"nitems");S(this,"nchunks");const[s,i,o]=dN(e,t);this.start=s,this.stop=i,this.step=o,this.step<1&&vN(),this.dim_len=t,this.dim_chunk_len=r,this.nitems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.nchunks=Math.ceil(this.dim_len/this.dim_chunk_len)}*[Symbol.iterator](){const e=Math.floor(this.start/this.dim_chunk_len),t=Math.ceil(this.stop/this.dim_chunk_len);for(const r of fN(e,t)){const s=r*this.dim_chunk_len,i=Math.min(this.dim_len,(r+1)*this.dim_chunk_len),o=i-s;let a=0,u=0;if(this.start<s){const v=(s-this.start)%this.step;v&&(u+=this.step-v),a=Math.ceil((s-this.start)/this.step)}else u=this.start-s;const f=this.stop>i?o:this.stop-s,h=[u,f,this.step],p=Math.ceil((f-u)/this.step),m=[a,a+p,1];yield{dim_chunk_ix:r,dim_chunk_sel:h,dim_out_sel:m}}}}function wN(n,e){let t=[];return n===null?t=e.map(r=>Go(null)):Array.isArray(n)&&(t=n.map(r=>r??Go(null))),_N(t,e),t}class bN{constructor({selection:e,shape:t,chunk_shape:r}){S(this,"dim_indexers");S(this,"shape");this.dim_indexers=wN(e,t).map((s,i)=>new(typeof s=="number"?xN:mw)({dim_sel:s,dim_len:t[i],dim_chunk_len:r[i]})),this.shape=this.dim_indexers.filter(s=>s instanceof mw).map(s=>s.nitems)}*[Symbol.iterator](){for(const e of hN(...this.dim_indexers)){const t=e.map(s=>s.dim_chunk_ix),r=e.map(s=>"dim_out_sel"in s?{from:s.dim_chunk_sel,to:s.dim_out_sel}:{from:s.dim_chunk_sel,to:null});yield{chunk_coords:t,mapping:r}}}}function TN(n,e){return"get"in n?n.get(e):n[e]}async function SN(n,e,t,r){var u;let s=sN(n),i=new bN({selection:e,shape:n.shape,chunk_shape:n.chunks}),o=r.prepare(new s.TypedArray(i.shape.reduce((f,h)=>f*h,1)),i.shape,s.get_strides(i.shape)),a=((u=t.create_queue)==null?void 0:u.call(t))??pN();for(const{chunk_coords:f,mapping:h}of i)a.add(async()=>{let{data:p,shape:m,stride:v}=await n.getChunk(f,t.opts),x=r.prepare(p,m,v);r.set_from_chunk(o,x,h)});return await a.onIdle(),i.shape.length===0?TN(o.data,0):o}function Oy(n,e=0,t){let r=t??n.length-e;return{length:r,subarray(s,i=r){return Oy(n,e+s,i-s)},set(s,i=0){for(let o=0;o<s.length;o++)n[e+i+o]=s.get(o)},get(s){return n[e+s]}}}function P0(n){return globalThis.Array.isArray(n.data)?{data:Oy(n.data),stride:n.stride,bytes_per_element:1}:{data:new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength),stride:n.stride,bytes_per_element:n.data.BYTES_PER_ELEMENT}}function EN(n){return"chars"in n?n.constructor.bind(null,n.chars):n.constructor}function AN(n,e){if(globalThis.Array.isArray(n.data))return Oy([e]);let t=EN(n.data),r=new t([e]);return new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}const RN={prepare(n,e,t){return{data:n,shape:e,stride:t}},set_scalar(n,e,t){let r=P0(n);Hv(r,e,AN(n,t),r.bytes_per_element)},set_from_chunk(n,e,t){let r=P0(n);ud(r,P0(e),r.bytes_per_element,t)}};async function CN(n,e=null,t={}){return SN(n,e,t,RN)}function DE(n,e,t){return t<0&&e<n?Math.floor((n-e-1)/-t)+1:n<e?Math.floor((e-n-1)/t)+1:0}function Hv(n,e,t,r){if(e.length===0){n.data.set(t,0);return}const[s,...i]=e,[o,...a]=n.stride;if(typeof s=="number"){const m=n.data.subarray(o*s*r);Hv({data:m,stride:a},i,t,r);return}const[u,f,h]=s,p=DE(u,f,h);if(i.length===0){for(let m=0;m<p;m++)n.data.set(t,o*(u+h*m)*r);return}for(let m=0;m<p;m++){const v=n.data.subarray(o*(u+h*m)*r);Hv({data:v,stride:a},i,t,r)}}function ud(n,e,t,r){const[s,...i]=r,[o,...a]=n.stride,[u,...f]=e.stride;if(s.from===null){if(i.length===0){n.data.set(e.data.subarray(0,t),s.to*t);return}ud({data:n.data.subarray(o*s.to*t),stride:a},e,t,i);return}if(s.to===null){if(i.length===0){let E=s.from*t;n.data.set(e.data.subarray(E,E+t),0);return}ud(n,{data:e.data.subarray(u*s.from*t),stride:f},t,i);return}const[h,p,m]=s.to,[v,x,w]=s.from,T=DE(h,p,m);if(i.length===0){if(m===1&&w===1&&o===1&&u===1){let E=v*t,C=T*t;n.data.set(e.data.subarray(E,E+C),h*t);return}for(let E=0;E<T;E++){let C=u*(v+w*E)*t;n.data.set(e.data.subarray(C,C+t),o*(h+m*E)*t)}return}for(let E=0;E<T;E++)ud({data:n.data.subarray(o*(h+E*m)*t),stride:a},{data:e.data.subarray(u*(v+E*w)*t),stride:f},t,i)}function LE(n,e,t,r={}){return e!==void 0&&t!==void 0&&(r={...r,headers:{...r.headers,Range:`bytes=${e}-${e+t-1}`}}),fetch(n,r)}function PN(n,e){return{...n,...e,headers:{...n.headers,...e.headers}}}function vw(n,e){const t=typeof n=="string"?new URL(n):n;t.pathname.endsWith("/")||(t.pathname+="/");const r=new URL(e.slice(1),t);return r.search=t.search,r}async function _w(n){if(n.status!==404){if(n.status===200||n.status===206)return new Uint8Array(await n.arrayBuffer());throw new Error(`Unexpected response status ${n.status} ${n.statusText}`)}}async function IN(n,e,t,r){if(r)return fetch(n,{...t,headers:{...t.headers,Range:`bytes=-${e}`}});let s=await fetch(n,{...t,method:"HEAD"});if(!s.ok)return s;let i=s.headers.get("Content-Length"),o=Number(i);return LE(n,o-e,o,t)}var Ju,ef,tf,Xv;class MN{constructor(e,t={}){vt(this,tf);S(this,"url");vt(this,Ju);vt(this,ef);this.url=e,nt(this,Ju,t.overrides??{}),nt(this,ef,t.useSuffixRequest??!1)}async get(e,t={}){let r=vw(this.url,e).href,s=await fetch(r,Mt(this,tf,Xv).call(this,t));return _w(s)}async getRange(e,t,r={}){let s=vw(this.url,e),i=Mt(this,tf,Xv).call(this,r),o;return"suffixLength"in t?o=await IN(s,t.suffixLength,i,be(this,ef)):o=await LE(s,t.offset,t.length,i),_w(o)}}Ju=new WeakMap,ef=new WeakMap,tf=new WeakSet,Xv=function(e){return PN(be(this,Ju),e)};var Wr,qt,sn,to,nf,no,wt,Yv,as,FE,qv,Kv,Zv,BE,Qv;class kN extends Map{constructor(t={}){super();vt(this,wt);vt(this,Wr,0);vt(this,qt,new Map);vt(this,sn,new Map);vt(this,to);vt(this,nf);vt(this,no);if(!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");nt(this,to,t.maxSize),nt(this,nf,t.maxAge||Number.POSITIVE_INFINITY),nt(this,no,t.onEviction)}get __oldCache(){return be(this,sn)}get(t){if(be(this,qt).has(t)){const r=be(this,qt).get(t);return Mt(this,wt,qv).call(this,t,r)}if(be(this,sn).has(t)){const r=be(this,sn).get(t);if(Mt(this,wt,as).call(this,t,r)===!1)return Mt(this,wt,BE).call(this,t,r),r.value}}set(t,r,{maxAge:s=be(this,nf)}={}){const i=typeof s=="number"&&s!==Number.POSITIVE_INFINITY?Date.now()+s:void 0;return be(this,qt).has(t)?be(this,qt).set(t,{value:r,expiry:i}):Mt(this,wt,Zv).call(this,t,{value:r,expiry:i}),this}has(t){return be(this,qt).has(t)?!Mt(this,wt,as).call(this,t,be(this,qt).get(t)):be(this,sn).has(t)?!Mt(this,wt,as).call(this,t,be(this,sn).get(t)):!1}peek(t){if(be(this,qt).has(t))return Mt(this,wt,Kv).call(this,t,be(this,qt));if(be(this,sn).has(t))return Mt(this,wt,Kv).call(this,t,be(this,sn))}delete(t){const r=be(this,qt).delete(t);return r&&jm(this,Wr)._--,be(this,sn).delete(t)||r}clear(){be(this,qt).clear(),be(this,sn).clear(),nt(this,Wr,0)}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...Mt(this,wt,Qv).call(this)],s=r.length-t;s<0?(nt(this,qt,new Map(r)),nt(this,sn,new Map),nt(this,Wr,r.length)):(s>0&&Mt(this,wt,Yv).call(this,r.slice(0,s)),nt(this,sn,new Map(r.slice(s))),nt(this,qt,new Map),nt(this,Wr,0)),nt(this,to,t)}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of be(this,qt)){const[r,s]=t;Mt(this,wt,as).call(this,r,s)===!1&&(yield[r,s.value])}for(const t of be(this,sn)){const[r,s]=t;be(this,qt).has(r)||Mt(this,wt,as).call(this,r,s)===!1&&(yield[r,s.value])}}*entriesDescending(){let t=[...be(this,qt)];for(let r=t.length-1;r>=0;--r){const s=t[r],[i,o]=s;Mt(this,wt,as).call(this,i,o)===!1&&(yield[i,o.value])}t=[...be(this,sn)];for(let r=t.length-1;r>=0;--r){const s=t[r],[i,o]=s;be(this,qt).has(i)||Mt(this,wt,as).call(this,i,o)===!1&&(yield[i,o.value])}}*entriesAscending(){for(const[t,r]of Mt(this,wt,Qv).call(this))yield[t,r.value]}get size(){if(!be(this,Wr))return be(this,sn).size;let t=0;for(const r of be(this,sn).keys())be(this,qt).has(r)||t++;return Math.min(be(this,Wr)+t,be(this,to))}get maxSize(){return be(this,to)}entries(){return this.entriesAscending()}forEach(t,r=this){for(const[s,i]of this.entriesAscending())t.call(r,i,s,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}Wr=new WeakMap,qt=new WeakMap,sn=new WeakMap,to=new WeakMap,nf=new WeakMap,no=new WeakMap,wt=new WeakSet,Yv=function(t){if(typeof be(this,no)=="function")for(const[r,s]of t)be(this,no).call(this,r,s.value)},as=function(t,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof be(this,no)=="function"&&be(this,no).call(this,t,r.value),this.delete(t)):!1},FE=function(t,r){if(Mt(this,wt,as).call(this,t,r)===!1)return r.value},qv=function(t,r){return r.expiry?Mt(this,wt,FE).call(this,t,r):r.value},Kv=function(t,r){const s=r.get(t);return Mt(this,wt,qv).call(this,t,s)},Zv=function(t,r){be(this,qt).set(t,r),jm(this,Wr)._++,be(this,Wr)>=be(this,to)&&(nt(this,Wr,0),Mt(this,wt,Yv).call(this,be(this,sn)),nt(this,sn,be(this,qt)),nt(this,qt,new Map))},BE=function(t,r){be(this,sn).delete(t),Mt(this,wt,Zv).call(this,t,r)},Qv=function*(){for(const t of be(this,sn)){const[r,s]=t;be(this,qt).has(r)||Mt(this,wt,as).call(this,r,s)===!1&&(yield t)}for(const t of be(this,qt)){const[r,s]=t;Mt(this,wt,as).call(this,r,s)===!1&&(yield t)}};function yw(n,e){return e?"suffixLength"in e?`${n}:-${e.suffixLength}`:`${n}:${e.offset}:${e.offset+e.length-1}`:n}function ON(n,e=100){const t=new kN({maxSize:e});let r=n.getRange?n.getRange.bind(n):void 0;function s(...i){const[o,a]=i,u=yw(o),f=t.get(u);if(f)return f;const h=Promise.resolve(n.get(o,a)).catch(p=>{throw t.delete(u),p});return t.set(u,h),h}if(r){const i=r;r=(...o)=>{const[a,u,f]=o,h=yw(a,u),p=t.get(h);if(p)return p;const m=Promise.resolve(i==null?void 0:i(a,u,f)).catch(v=>{throw t.delete(h),v});return t.set(h,m),m}}return new Proxy(n,{get(i,o,a){return o==="get"?s:o==="getRange"&&r?r:Reflect.get(i,o,a)}})}const Ml=6,Fs={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},NN=[Fs.magenta,Fs.green],DN=[Fs.red,Fs.green,Fs.blue],xw=Object.values(Fs).slice(0,-2),LN="https://ome.github.io/ome-ngff-validator/";async function FN(n){if(typeof n=="string"){let e,t="/";if(n.endsWith(".json")){const[{default:r},s]=await Promise.all([nr(()=>import("./ref-BaYXKYu5.js"),[],import.meta.url),fetch(n).then(i=>i.json())]);e=r.fromSpec(s)}else{const r=new URL(n);t=BN(r.pathname),r.pathname="/",e=new MN(r.href)}return new So(ON(e),t)}return rN(n)}function BN(n){return n==="/"||n.startsWith("/")?n:`/${n}`}async function UN(n){const e=await FN(n);return Un(e)}async function I0(n,e){const t=new TextDecoder;if(e.path&&(n=n.resolve(e.path)),e.zarrVersion===3){const o=await Un.v3(n).then(a=>a.attrs);return ga(o)}const r=n.resolve(".zattrs"),s=await n.store.get(r.path),i=s?JSON.parse(t.decode(s)):{};return ga(i)}async function Ny(n,e){const{datasets:t}=e[0]||[{path:"0"}];return Promise.all(t.map(({path:r})=>Un(n.resolve(r),{kind:"array",attrs:!1})))}function Dy(n){n.startsWith("#")&&(n=n.slice(1));const e=Number.parseInt(n.slice(0,2),16),t=Number.parseInt(n.slice(2,4),16),r=Number.parseInt(n.slice(4,6),16);return[e,t,r]}function Du(n){return Array.from({length:n},(e,t)=>t)}function VN(n,e=" "){for(;n.length>0&&e.includes(n.charAt(n.length-1));)n=n.substr(0,n.length-1);return n}function wl(...n){return n.filter(e=>e!==void 0).map(e=>VN(e,"/")).join("/")}function zN(n,e){return(!e||e.length!==n.shape.length)&&(e=n.shape.slice(0,-2).map((r,s)=>`${s}`).concat(["y","x"])),e}function ic(n){const e=[{type:"time",name:"t"},{type:"channel",name:"c"},{type:"space",name:"z"},{type:"space",name:"y"},{type:"space",name:"x"}];function t(s){return s==="t"?"time":s==="c"?"channel":"space"}let r=e;return n[0].axes&&(r=n[0].axes.map(s=>{if(typeof s=="string")return{name:s,type:t(s)};const{name:i,type:o}=s;return{name:i,type:o??t(i)}})),r}function lf(n){return n.map(t=>t.name)}function UE(n,e){return e||(n<=Ml?e=Array(n).fill(!0):e=[...Array(Ml).fill(!0),...Array(n-Ml).fill(!1)]),e}function VE(n,e){let t=[];if(n===1)t=[Fs.white];else if(n===2)t=NN;else if(n===3)t=DN;else if(n<=Ml)t=xw.slice(0,n);else{t=Array(n).fill(Fs.white);const r=e.flatMap((s,i)=>s?i:[]);for(const[s,i]of r.entries())t[i]=xw[s]}return t}function zE(n){const e=n[n.length-1];return e===3||e===4}function cf(n){const e=zE(n.shape),[t,r]=n.chunks.slice(e?-3:-2),s=Math.min(t,r);return 2**Math.floor(Math.log2(s))}function $N(n){const{image:e,viewport:t,padding:r,matrix:s=new St().identity()}=n,i=[[0,0,0],[e.width,0,0],[e.width,e.height,0],[0,e.height,0]].map(m=>s.transformAsPoint(m)),o=Math.min(...i.map(m=>m[0])),a=Math.max(...i.map(m=>m[0])),u=Math.min(...i.map(m=>m[1])),f=Math.max(...i.map(m=>m[1])),h=t.width-2*r,p=t.height-2*r;return{zoom:Math.log2(Math.min(h/(a-o),p/(f-o))),target:[(o+a)/2,(u+f)/2]}}function jN(n){return Array.isArray(n)?n.length===16&&n.every(e=>typeof e=="number"):!1}function uf(n){if(!n)return St.IDENTITY;const e=new St;try{const t=typeof n=="string"?JSON.parse(n):n;Dt(jN(t),"Invalid modelMatrix size. Must be 16."),e.setRowMajor(...t)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(n)}, using identity.`;console.warn(t)}return e}async function Ly(n,e){if(n.dtype==="Uint8")return[0,255];const{data:t}=await n.getRaster({selection:e});let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let i=0;i<t.length;i++)t[i]>s&&(s=t[i]),t[i]<r&&(r=t[i]);return r===s&&(r=0,s=1),[r,s]}async function $E(n,e,t,r){const s=n.shape.map(()=>0),i=n.shape[e];return e!==-1&&Dt(i===t.length,"visibilities do not match number of channels"),Promise.all(t.map(async(o,a)=>{if(!o)return;const u=[...s];return e>-1&&(u[e]=a),Ly(n,u)}))}function WN(){let n,e;return{promise:new Promise((r,s)=>{n=r,e=s}),resolve:n,reject:e}}function HN(){let n=new EventTarget;return{on:(e,t)=>{n.addEventListener(e,r=>t(r.detail))},emit:(e,t)=>{n.dispatchEvent(new CustomEvent(e,{detail:t}))}}}function ga(n){return"ome"in n?n.ome:n}class XN extends Error{constructor(e){super(e),this.name="AssertionError"}}class jE extends Error{constructor(t,r){super(t);S(this,"url");this.name="RedirectError",this.url=r}}function Dt(n,e=""){if(!n)throw new XN(e)}async function YN(n){try{return await Un.v3(n),3}catch(e){if(!(e instanceof Aa))throw e;return 2}}function ww(n){return"plate"in n}function qN(n){return"well"in n}function KN(n){return"image-label"in n&&Yp(n)}function WE(n){return"omero"in n&&Yp(n)}function Yp(n){return"multiscales"in n}function ZN(n){return"bioformats2raw.layout"in n}/**
 * Ensures an error matches expected type(s), otherwise rethrows.
 *
 * Unmatched errors bubble up, like Python's `except`. Narrows error types for
 * type-safe property access.
 *
 * Usage
 * @example
 * ```ts
 * class DatabaseError extends Error {}
 * class NetworkError extends Error {}
 *
 * try {
 *   await db.query();
 * } catch (error) {
 *   rethrowUnless(error, DatabaseError, NetworkError);
 *   error; // DatabaseError | NetworkError
 * }
 * ```
 *
 * @param error - The error to check
 * @param ErrorClasses - Expected error type(s)
 * @throws The original error if it doesn't match expected type(s)
 *
 * @copyright Trevor Manz 2025
 * @license MIT
 * @see {@link https://github.com/manzt/manzt/blob/4b04f2/utils/rethrow-unless.js}
 */function HE(n,...e){if(!e.some(t=>n instanceof t))throw n}function XE(n){return"loaders"in n&&"rows"in n&&"columns"in n}function YE(n){return XE(n)?n.loaders[0].loader:n.loader}function qE(n){var i;let e=new St().identity();const t=ic(n),r=(i=n[0].datasets[0])==null?void 0:i.coordinateTransformations,s=["x","y","z"].map(o=>t.findIndex(a=>a.type==="space"&&a.name===o));for(const o of r??[]){if(o.type==="translation"){const{translation:a}=o;if(a.length!==t.length)throw new Error("Length of translation array was expected to match length of axes.");const u=0,f=s.map(p=>p>=0?a[p]:u),h=new St().translate(f);e=e.multiplyLeft(h)}if(o.type==="scale"){const{scale:a}=o;if(a.length!==t.length)throw new Error("Length of scale array was expected to match length of axes.");const u=1,f=s.map(p=>p>=0?a[p]:u),h=new St().scale(f);e=e.multiplyLeft(h)}}return e}function QN(...n){const e=n.reduce((r,s)=>Math.min(s.length,r),Number.POSITIVE_INFINITY),t=new Array(e);for(let r=0;r<e;r+=1){const s=n.map(i=>i[r]);t[r]=s}return t}const KE=B.createContext(null);function vs(){const n=B.useContext(KE);return Dt(n,"useSourceData hook must be used within SourceDataContext."),by(n)}const ZE=B.createContext(null);function pi(){const n=B.useContext(ZE);return Dt(n,"useLayerState hook must be used within LayerStateContext."),by(n)}const Gv=B.createContext(null);function GN(){const n=B.useContext(Gv);return Dt(n,"useViewState hook must be used within ViewStateContext."),by(n)}function Fy(n,e){let t=null;const r=new Map,s=i=>{let o;if(e===void 0)o=r.get(i);else for(const[u,f]of r)if(e(u,i)){o=f;break}if(o!==void 0)if(t!=null&&t(o[1],i))s.remove(i);else return o[0];const a=n(i);return r.set(i,[a,Date.now()]),a};return s.remove=i=>{if(e===void 0)r.delete(i);else for(const[o]of r)if(e(o,i)){r.delete(o);break}},s.setShouldRemove=i=>{if(t=i,!!t)for(const[o,a]of r)t(a[1],o)&&r.delete(o)},s}const JN=(n,e)=>{do{const[t,...r]=e,s=n.get(t);if(!s)return;if(!r.length)return s[1];n=s[0],e=r}while(e.length)},e8=(n,e,t)=>{do{const[r,...s]=e;let i=n.get(r);if(i||(i=[new WeakMap],n.set(r,i)),!s.length){i[1]=t;return}n=i[0],e=s}while(e.length)},QE=()=>{const n=new WeakMap;return(t,r)=>{const s=JN(n,r);if(s)return s;const i=t();return e8(n,r,i),i}},t8=QE(),bw=n=>!!n.write,n8=n=>typeof n=="function";function r8(n,e){return t8(()=>{const t=new WeakMap,r=(u,f)=>{let h=t.get(u);if(h)return h;const p=f&&t.get(f),m=[],v=[];return u.forEach((x,w)=>{const T=w;v[w]=T;const E=p&&p.atomList[p.keyList.indexOf(T)];if(E){m[w]=E;return}const C=L=>{const I=L(s),F=L(n),q=r(F,I.prev).keyList.indexOf(T);if(q<0||q>=F.length){const Q=u[r(u).keyList.indexOf(T)];if(Q)return Q;throw new Error("splitAtom: index out of bounds for read")}return F[q]},P=(L,I,F)=>{const j=L(s),q=L(n),le=r(q,j.prev).keyList.indexOf(T);if(le<0||le>=q.length)throw new Error("splitAtom: index out of bounds for write");const he=n8(F)?F(q[le]):F;I(n,[...q.slice(0,le),he,...q.slice(le+1)])};m[w]=bw(n)?Fn(C,P):Fn(C)}),p&&p.keyList.length===v.length&&p.keyList.every((x,w)=>x===v[w])?h=p:h={atomList:m,keyList:v},t.set(u,h),h},s=Fn(()=>({})),i=u=>{const f=u(s),h=u(n),p=r(h,f.prev);return f.prev=h,p.atomList},o=(u,f,h)=>{switch("read"in h&&(console.warn("atomToRemove is deprecated. use action with type"),h={type:"remove",atom:h}),h.type){case"remove":{const p=u(a).indexOf(h.atom);if(p>=0){const m=u(n);f(n,[...m.slice(0,p),...m.slice(p+1)])}break}case"insert":{const p=h.before?u(a).indexOf(h.before):u(a).length;if(p>=0){const m=u(n);f(n,[...m.slice(0,p),h.value,...m.slice(p)])}break}case"move":{const p=u(a).indexOf(h.atom),m=h.before?u(a).indexOf(h.before):u(a).length;if(p>=0&&m>=0){const v=u(n);p<m?f(n,[...v.slice(0,p),...v.slice(p+1,m),v[p],...v.slice(m)]):f(n,[...v.slice(0,m),v[p],...v.slice(m,p),...v.slice(p+1)])}break}}},a=bw(n)?Fn(i,o):Fn(i);return a},[n])}const s8=QE(),i8=Fn(()=>[]);function o8(n){const e=()=>{const t=a8(n);return Fn(s=>{const i=[],o=t.map((a,u)=>{try{return s(a)}catch(f){if(f instanceof Promise)i[u]=f;else throw f}});if(i.length)throw Promise.all(i);return l8(n,o)})};return Array.isArray(n)?n.length?s8(e,n):i8:e()}const a8=n=>Array.isArray(n)?n:Object.getOwnPropertyNames(n).map(e=>n[e]),l8=(n,e)=>Array.isArray(n)?e:Object.getOwnPropertyNames(n).reduce((t,r,s)=>({...t,[r]:e[s]}),{}),c8="x",u8="y",Tw="_c";var Vl,ra,zl,$l,ms,GE,JE,Jv,e4;class ff{constructor(e,t){vt(this,ms);S(this,"labels");S(this,"tileSize");S(this,"dtype");vt(this,Vl);vt(this,ra);vt(this,zl);vt(this,$l,[]);Dt(e.is("number")||e.is("bigint"),`Unsupported viv dtype: ${e.dtype}`),nt(this,Vl,e),this.labels=t.labels,this.tileSize=t.tileSize,e.dtype==="uint64"||e.dtype==="int64"?(this.dtype="Uint32",nt(this,ra,r=>Uint32Array.from(r,s=>Number(s)))):e.dtype==="float16"?(this.dtype="Float32",nt(this,ra,r=>new Float32Array(r))):(this.dtype=f8(e.dtype),nt(this,ra,r=>r))}get shape(){return be(this,Vl).shape}async getRaster(e){const{selection:t,signal:r}=e;return Mt(this,ms,Jv).call(this,{selection:Sw(t,{labels:this.labels,slices:{x:Go(null),y:Go(null)}}),signal:r})}onTileError(e){}async getTile(e){const{x:t,y:r,selection:s,signal:i}=e;return Mt(this,ms,Jv).call(this,{selection:Sw(s,{labels:this.labels,slices:{x:Go(t*this.tileSize,Math.min((t+1)*this.tileSize,be(this,ms,GE))),y:Go(r*this.tileSize,Math.min((r+1)*this.tileSize,be(this,ms,JE)))}}),signal:i})}}Vl=new WeakMap,ra=new WeakMap,zl=new WeakMap,$l=new WeakMap,ms=new WeakSet,GE=function(){const e=this.shape.length-1;return this.shape[this.labels.indexOf("c")===e?e-1:e]},JE=function(){const e=this.shape.length-1;return this.shape[this.labels.indexOf("c")===e?e-2:e-1]},Jv=async function(e){const{promise:t,resolve:r,reject:s}=Promise.withResolvers();return be(this,$l).push({request:e,resolve:r,reject:s}),nt(this,zl,be(this,zl)??requestAnimationFrame(()=>Mt(this,ms,e4).call(this))),t},e4=async function(){for(const{request:e,resolve:t,reject:r}of be(this,$l))CN(be(this,Vl),e.selection,{opts:{signal:e.signal}}).then(({data:s,shape:i})=>{t({data:be(this,ra).call(this,s),width:i[1],height:i[0]})}).catch(s=>r(s));nt(this,zl,void 0),nt(this,$l,[])};function Sw(n,e){const{labels:t,slices:r}=e;let s;if(Array.isArray(n))s=[...n];else{s=Array.from({length:t.length},()=>0);for(const[i,o]of Object.entries(n))s[t.indexOf(i)]=o}return s[t.indexOf(c8)]=r.x,s[t.indexOf(u8)]=r.y,Tw in t&&(s[t.indexOf(Tw)]=Go(null)),s}function f8(n){return n[0].toUpperCase()+n.slice(1)}async function t4(n,e,{concurrency:t=Number.POSITIVE_INFINITY,stopOnError:r=!0,signal:s}={}){return new Promise((i,o)=>{if(n[Symbol.iterator]===void 0&&n[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof n})`);if(typeof e!="function")throw new TypeError("Mapper function is required");if(!(Number.isSafeInteger(t)&&t>=1||t===Number.POSITIVE_INFINITY))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${t}\` (${typeof t})`);const a=[],u=[],f=new Map;let h=!1,p=!1,m=!1,v=0,x=0;const w=n[Symbol.iterator]===void 0?n[Symbol.asyncIterator]():n[Symbol.iterator](),T=()=>{P(s.reason)},E=()=>{s==null||s.removeEventListener("abort",T)},C=I=>{i(I),E()},P=I=>{h=!0,p=!0,o(I),E()};s&&(s.aborted&&P(s.reason),s.addEventListener("abort",T,{once:!0}));const L=async()=>{if(p)return;const I=await w.next(),F=x;if(x++,I.done){if(m=!0,v===0&&!p){if(!r&&u.length>0){P(new AggregateError(u));return}if(p=!0,f.size===0){C(a);return}const j=[];for(const[q,Q]of a.entries())f.get(q)!==Ew&&j.push(Q);C(j)}return}v++,(async()=>{try{const j=await I.value;if(p)return;const q=await e(j,F);q===Ew&&f.set(F,q),a[F]=q,v--,await L()}catch(j){if(r)P(j);else{u.push(j),v--;try{await L()}catch(q){P(q)}}}})()};(async()=>{for(let I=0;I<t;I++){try{await L()}catch(F){P(F);break}if(m||h)break}})()})}const Ew=Symbol("skip");async function h8(n,e,t){const r=n.acquisition?Number.parseInt(n.acquisition):void 0;let s=[];Dt(t==null?void 0:t.images,"Well .zattrs missing images"),Dt(e.path,"Cannot inspect zarr path to open well.");const[i,o]=e.path.split("/").filter(Boolean).slice(-2);let{images:a}=t;const u=a.flatMap(j=>j.acquisition?[j.acquisition]:[]);if(u.length>1){const j=e.path.replace(`${i}/${o}`,""),q=await Un(e.resolve(j));s=ga(q.attrs).plate.acquisitions??[],r&&u.includes(r)&&(a=a.filter(le=>le.acquisition===r))}const f=a.map(j=>j.path),h=Math.ceil(Math.sqrt(f.length)),p=Math.ceil(f.length/h),m=await Un(e.resolve(f[0]),{kind:"group"}),v=ga(m.attrs);Dt(Yp(v),"Path for image is not valid.");let x=v.multiscales[0].datasets[0].path;const w=f.map(j=>{const q=e.resolve(wl(j,x));return Un(q,{kind:"array",attrs:!1})}),T=await Promise.all(w),E=ic(v.multiscales),C=lf(E),P=cf(T[0]),L=Du(p).flatMap(j=>Du(h).filter(q=>q+j*h<T.length).map(q=>{const Q=q+j*h;return{name:String(Q),row:j,col:q,loader:new ff(T[Q],{labels:C,tileSize:P})}}));let I;WE(v)?I=By(v.omero,E):I=await n4(L[0].loader,C);const F={loaders:L,...I,axis_labels:C,loader:[L[0].loader],model_matrix:uf(n.model_matrix),defaults:{selection:I.defaultSelection,colormap:n.colormap??"",opacity:n.opacity??1},name:`Well ${i}${o}`};return s.length>0&&(F.acquisitions=s,F.acquisitionId=r||-1),F.rows=p,F.columns=h,F.onClick=j=>{let q=j.gridCoord;if(!q)return;const{row:Q,column:le}=q;let he;if(typeof n.source=="string"&&e.path&&!Number.isNaN(Q)&&!Number.isNaN(le)){const pe=Q*h+le;he=wl(n.source,f[pe])}n.onClick?(j.layer=void 0,j.imageSource=he,n.onClick(j)):he&&window.open(`${window.location.origin+window.location.pathname}?source=${he}`)},F}async function Aw(n,e,t){Dt((t==null?void 0:t.rows)||(t==null?void 0:t.columns),"Plate .zattrs missing rows, columns or wells");const r=t.rows.map(j=>j.name),s=t.columns.map(j=>j.name),i=t.wells.map(j=>j.path),o=await YN(e),a=await I0(e,{path:i[0],zarrVersion:o});Dt("well"in a,"Path for image is not valid, not a well.");const u=a.well.images[0].path,f=await I0(e,{path:wl(i[0],u),zarrVersion:o});Dt("multiscales"in f,"Path for image is not valid.");const{datasets:h}=f.multiscales[0],p=h[h.length-1].path;async function m(j){const q=await I0(e,{path:j,zarrVersion:o});return Dt("well"in q,"Path for image is not valid, not a well."),wl(j,q.well.images[0].path)}const v=await Promise.all(i.map(m)),x=async([j,q])=>{let Q=await Un(e.resolve(q),{kind:"array",attrs:!1});return[j,Q]},w=await t4(v.map(j=>[j,wl(j,p)]),x,{concurrency:10}),T=await Promise.all(w),E=ic(f.multiscales),C=lf(E),P=cf(T[0][1]),L=T.map(j=>{const[q,Q]=j[0].split("/");return{name:`${q}${Q}`,row:r.indexOf(q),col:s.indexOf(Q),loader:new ff(j[1],{labels:C,tileSize:P})}});let I;"omero"in f?I=By(f.omero,E):I=await n4(L[0].loader,C);const F={loaders:L,...I,axis_labels:C,loader:[L[0].loader],model_matrix:uf(n.model_matrix),defaults:{selection:I.defaultSelection,colormap:n.colormap??"",opacity:n.opacity??1},name:t.name||"Plate",rows:r.length,columns:s.length};return F.onClick=j=>{let q=j.gridCoord;if(!q)return;const{row:Q,column:le}=q;let he;typeof n.source=="string"&&e.path&&!Number.isNaN(Q)&&!Number.isNaN(le)&&(he=wl(n.source,r[Q],s[le])),n.onClick?(j.layer=void 0,j.imageSource=he,n.onClick(j)):he&&window.open(`${window.location.origin+window.location.pathname}?source=${he}`)},F}async function d8(n,e,t){const{name:r,opacity:s=1,colormap:i=""}=n,o=await Ny(e,t.multiscales),a=ic(t.multiscales),u=lf(a),f=By(t.omero,a),h=cf(o[0]),p=o.map(v=>new ff(v,{labels:u,tileSize:h})),m=await g8(e);return{loader:p,axis_labels:u,model_matrix:n.model_matrix?uf(n.model_matrix):qE(t.multiscales),defaults:{selection:f.defaultSelection,colormap:i,opacity:s},...f,name:f.name??r,labels:await Promise.all(m.map(v=>p8(e.resolve("labels"),v)))}}async function p8(n,e){const t=await Un(n.resolve(e),{kind:"group"}),r=ga(t.attrs);Dt(KN(r),"No 'image-label' metadata.");const s=await Ny(t,r.multiscales),i=s.at(0);Dt(i,"No base resolution found for multiscale labels.");const o=cf(i),a=ic(r.multiscales),u=lf(a),f=(r["image-label"].colors??[]).map(h=>({labelValue:h["label-value"],rgba:h.rgba}));return{name:e,modelMatrix:qE(r.multiscales),loader:s.map(h=>new ff(h,{labels:u,tileSize:o})),colors:f.length>0?f:void 0}}async function g8(n){return Un(n.resolve("labels"),{kind:"group"}).then(({attrs:e})=>e.labels??[]).catch(e=>(HE(e,Aa),[]))}async function n4(n,e){const t=e.indexOf("c"),r=t===-1?1:n.shape[t],s=UE(r),i=await $E(n,t,s),o=VE(r,s);return{name:"Image",names:Du(r).map(a=>`channel_${a}`),colors:o,contrast_limits:i,visibilities:s,channel_axis:e.includes("c")?e.indexOf("c"):null,defaultSelection:e.map(()=>0)}}function By({rdefs:n,channels:e,name:t},r){const s=(n==null?void 0:n.defaultT)??0,i=(n==null?void 0:n.defaultZ)??0,o=[],a=[],u=[],f=[];e.forEach((m,v)=>{o.push(m.color),a.push([m.window.start,m.window.end]),u.push(m.active),f.push(m.label||`${v}`)});const h=r.map(m=>m.type==="time"?s:m.name==="z"?i:0),p=r.findIndex(m=>m.type==="channel");return{name:t,names:f,colors:o,contrast_limits:a,visibilities:u,channel_axis:p,defaultSelection:h}}function Md(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Uy=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Rw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rw&&parseFloat(Rw[1]);const $h=globalThis,cl=globalThis.process||{},m8=globalThis.navigator||{};function r4(n){var r,s;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Eo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||r4()}function v8(n){return Eo()?r4()?"Electron":(m8.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const s4="4.1.0";function _8(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class y8{constructor(e,t,r="sessionStorage"){this.storage=_8(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function x8(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function w8(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var kd;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(kd||(kd={}));const b8=10;function Cw(n){return typeof n!="string"?n:(n=n.toUpperCase(),kd[n]||kd.WHITE)}function T8(n,e,t){return!Eo&&typeof n=="string"&&(e&&(n=`\x1B[${Cw(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Cw(t)+b8}m${n}\x1B[49m`)),n}function S8(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),s=n;for(const i of r){const o=s[i];typeof o=="function"&&(e.find(a=>i===a)||(s[i]=o.bind(n)))}}function Vy(n,e){if(!n)throw new Error("Assertion failed")}function ul(){var e,t,r;let n;if(Eo()&&$h.performance)n=(t=(e=$h==null?void 0:$h.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in cl){const s=(r=cl==null?void 0:cl.hrtime)==null?void 0:r.call(cl);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const fl={debug:Eo()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},E8={enabled:!0,level:0};function hl(){}const Pw={},Iw={once:!0};class hf{constructor({id:e}={id:""}){this.VERSION=s4,this._startTs=ul(),this._deltaTs=ul(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new y8(`__probe-${this.id}__`,E8),this.timeStamp(`${this.id} started`),S8(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ul()-this._startTs).toPrecision(10))}getDelta(){return Number((ul()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,fl.warn,arguments,Iw)}error(e){return this._getLogFunction(0,e,fl.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,fl.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,fl.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,fl.debug||fl.info,arguments,Iw)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||hl,r&&[r],{tag:R8(t)}):hl}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||hl)}group(e,t,r={collapsed:!1}){const s=Mw({logLevel:e,message:t,opts:r}),{collapsed:i}=r;return s.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||hl)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=i4(e)}_getLogFunction(e,t,r,s,i){if(this._shouldLog(e)){i=Mw({logLevel:e,message:t,args:s,opts:i}),r=r||i.method,Vy(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=ul();const o=i.tag||i.message;if(i.once&&o)if(!Pw[o])Pw[o]=ul();else return hl;return t=A8(this.id,i.message,i),r.bind(console,t,...i.args)}return hl}}hf.VERSION=s4;function i4(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Vy(Number.isFinite(e)&&e>=0),e}function Mw(n){const{logLevel:e,message:t}=n;n.logLevel=i4(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Vy(s==="string"||s==="object"),Object.assign(n,{args:r},n.opts)}function A8(n,e,t){if(typeof e=="string"){const r=t.time?w8(x8(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=T8(e,t.color,t.background)}return e}function R8(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const M0="4.3.2",C8=M0[0]>="0"&&M0[0]<="9"?`v${M0}`:"";function P8(){const n=new hf({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=C8,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const I8=P8();function M8(n,e){return o4(n||{},e)}function o4(n,e,t=0){if(t>3)return e;const r={...n};for(const[s,i]of Object.entries(e))i&&typeof i=="object"&&!Array.isArray(i)?r[s]=o4(r[s]||{},e[s],t+1):r[s]=e[s];return r}const k8="latest";function O8(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const N8=O8();function go(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const aa=typeof process!="object"||String(process)!=="[object process]"||process.browser,D8=typeof window<"u"&&typeof window.orientation<"u",kw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);kw&&parseFloat(kw[1]);class L8{constructor(e,t){S(this,"name");S(this,"workerThread");S(this,"isRunning",!0);S(this,"result");S(this,"_resolve",()=>{});S(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){go(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){go(this.isRunning),this.isRunning=!1,this._reject(e)}}class k0{terminate(){}}const O0=new Map;function F8(n){go(n.source&&!n.url||!n.source&&n.url);let e=O0.get(n.source||n.url);return e||(n.url&&(e=B8(n.url),O0.set(n.url,e)),n.source&&(e=a4(n.source),O0.set(n.source,e))),go(e),e}function B8(n){if(!n.startsWith("http"))return n;const e=U8(n);return a4(e)}function a4(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function U8(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function l4(n,e=!0,t){const r=t||new Set;if(n){if(Ow(n))r.add(n);else if(Ow(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)l4(n[s],e,r)}}return t===void 0?Array.from(r):[]}function Ow(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const N0=()=>{};class e_{constructor(e){S(this,"name");S(this,"source");S(this,"url");S(this,"terminated",!1);S(this,"worker");S(this,"onMessage");S(this,"onError");S(this,"_loadableURL","");const{name:t,source:r,url:s}=e;go(r||s),this.name=t,this.source=r,this.url=s,this.onMessage=N0,this.onError=i=>console.log(i),this.worker=aa?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&aa||typeof k0<"u"&&!aa}destroy(){this.onMessage=N0,this.onError=N0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||l4(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=F8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new k0(r,{eval:!1})}else if(this.source)e=new k0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class V8{constructor(e){S(this,"name","unnamed");S(this,"source");S(this,"url");S(this,"maxConcurrency",1);S(this,"maxMobileConcurrency",1);S(this,"onDebug",()=>{});S(this,"reuseWorkers",!0);S(this,"props",{});S(this,"jobQueue",[]);S(this,"idleQueue",[]);S(this,"count",0);S(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return e_.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,i,o)=>s.done(o),r=(s,i)=>s.error(i)){const s=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:i}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new L8(t.name,e);e.onMessage=s=>t.onMessage(r,s.type,s.payload),e.onError=s=>t.onError(r,s),t.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!aa||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new e_({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return D8?this.maxMobileConcurrency:this.maxConcurrency}}const z8={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Gi=class Gi{constructor(e){S(this,"props");S(this,"workerPools",new Map);this.props={...z8},this.setProps(e),this.workerPools=new Map}static isSupported(){return e_.isSupported()}static getWorkerFarm(e={}){return Gi._workerFarm=Gi._workerFarm||new Gi({}),Gi._workerFarm.setProps(e),Gi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:s}=e;let i=this.workerPools.get(t);return i||(i=new V8({name:t,source:r,url:s}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};S(Gi,"_workerFarm");let Od=Gi;function $8(n,e={}){const t=e[n.id]||{},r=aa?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(aa?s=`modules/${n.module}/dist/${r}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let i=n.version;i==="latest"&&(i=k8);const o=i?`@${i}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${r}`}return go(s),s}function j8(n,e=N8){go(n,"no worker provided");const t=n.version;return!(!e||!t)}function W8(n,e){return!Od.isSupported()||!aa&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function H8(n,e,t,r,s){const i=n.id,o=$8(n,t),u=Od.getWorkerFarm(t).getWorkerPool({name:i,url:o});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const f=await u.startJob("process-on-worker",X8.bind(null,s));return f.postMessage("process",{input:e,options:t,context:r}),await(await f.result).result}async function X8(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:i,options:o}=r;try{const a=await n(i,o);e.postMessage("done",{id:s,result:a})}catch(a){const u=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Y8(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),s=new Uint8Array(e);for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}function q8(...n){return K8(n)}function K8(n){const e=n.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),t=e.reduce((i,o)=>i+o.byteLength,0),r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.byteLength;return r.buffer}async function Z8(n){const e=[];for await(const t of n)e.push(t);return q8(...e)}function Nw(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Dw{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Nw(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Nw()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class df{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let s=this.stats[t];return s||(e instanceof Dw?s=e:s=new Dw(t,r),this.stats[t]=s),s}}const Q8="Queued Requests",G8="Active Requests",J8="Cancelled Requests",eD="Queued Requests Ever",tD="Active Requests Ever",nD={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class rD{constructor(e={}){S(this,"props");S(this,"stats");S(this,"activeRequestCount",0);S(this,"requestQueue",[]);S(this,"requestMap",new Map);S(this,"updateTimer",null);this.props={...nD,...e},this.stats=new df({id:this.props.id}),this.stats.get(Q8),this.stats.get(G8),this.stats.get(J8),this.stats.get(eD),this.stats.get(tD)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},s=new Promise(i=>(r.resolve=i,r));return this.requestQueue.push(r),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:r}=e;let s=!1;const i=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let sD="";const Lw={};function iD(n){for(const e in Lw)if(n.startsWith(e)){const t=Lw[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${sD}${n}`),n}function oD(n){return n&&typeof n=="object"&&n.isBuffer}function c4(n){if(oD(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function u4(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function aD(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const lD=n=>typeof n=="boolean",xu=n=>typeof n=="function",pf=n=>n!==null&&typeof n=="object",Fw=n=>pf(n)&&n.constructor==={}.constructor,cD=n=>!!n&&typeof n[Symbol.iterator]=="function",uD=n=>n&&typeof n[Symbol.asyncIterator]=="function",Ra=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Ca=n=>typeof Blob<"u"&&n instanceof Blob,fD=n=>n&&typeof n=="object"&&n.isBuffer,hD=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||pf(n)&&xu(n.tee)&&xu(n.cancel)&&xu(n.getReader),dD=n=>pf(n)&&xu(n.read)&&xu(n.pipe)&&lD(n.readable),f4=n=>hD(n)||dD(n);class pD extends Error{constructor(t,r){super(t);S(this,"reason");S(this,"url");S(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const gD=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,mD=/^([-\w.]+\/[-\w.+]+)/;function Bw(n,e){return n.toLowerCase()===e.toLowerCase()}function vD(n){const e=mD.exec(n);return e?e[1]:n}function Uw(n){const e=gD.exec(n);return e?e[1]:""}const h4=/\?.*/;function _D(n){const e=n.match(h4);return e&&e[0]}function zy(n){return n.replace(h4,"")}function yD(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function qp(n){return Ra(n)?n.url:Ca(n)?n.name||"":typeof n=="string"?n:""}function $y(n){if(Ra(n)){const e=n,t=e.headers.get("content-type")||"",r=zy(e.url);return vD(t)||Uw(r)}return Ca(n)?n.type||"":typeof n=="string"?Uw(n):""}function xD(n){return Ra(n)?n.headers["content-length"]||-1:Ca(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function d4(n){if(Ra(n))return n;const e={},t=xD(n);t>=0&&(e["content-length"]=String(t));const r=qp(n),s=$y(n);s&&(e["content-type"]=s);const i=await TD(n);i&&(e["x-first-bytes"]=i),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function wD(n){if(!n.ok)throw await bD(n)}async function bD(n){const e=yD(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new pD(t,r)}async function TD(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=i=>{var o;return r((o=i==null?void 0:i.target)==null?void 0:o.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${SD(t)}`}return null}function SD(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function ED(n){return!AD(n)&&!RD(n)}function AD(n){return n.startsWith("http:")||n.startsWith("https:")}function RD(n){return n.startsWith("data:")}async function Vw(n,e){var t,r;if(typeof n=="string"){const s=iD(n);return ED(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await d4(n)}const zw=new hf({id:"loaders.gl"});class CD{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class PD{constructor(){S(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const p4={fetch:null,mimeType:void 0,nothrow:!1,log:new PD,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Uy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ID={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function g4(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function m4(){const n=g4();return n.globalOptions=n.globalOptions||{...p4},n.globalOptions}function MD(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],kD(n,t),ND(e,n,r)}function kD(n,e){$w(n,null,p4,ID,e);for(const t of e){const r=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},i=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};$w(r,t.id,s,i,e)}}function $w(n,e,t,r,s){const i=e||"Top level",o=e?`${e}.`:"";for(const a in n){const u=!e&&pf(n[a]),f=a==="baseUri"&&!e,h=a==="workerUrl"&&e;if(!(a in t)&&!f&&!h){if(a in r)zw.warn(`${i} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!u){const p=OD(a,s);zw.warn(`${i} loader option '${o}${a}' not recognized. ${p}`)()}}}}function OD(n,e){const t=n.toLowerCase();let r="";for(const s of e)for(const i in s.options){if(n===i)return`Did you mean '${s.id}.${i}'?`;const o=i.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||`Did you mean '${s.id}.${i}'?`)}return r}function ND(n,e,t){const s={...n.options||{}};return DD(s,t),s.log===null&&(s.log=new CD),jw(s,m4()),jw(s,e),s}function jw(n,e){for(const t in e)if(t in e){const r=e[t];Fw(r)&&Fw(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function DD(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function jy(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Wy(n){Md(n,"null loader"),Md(jy(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const v4=()=>{const n=g4();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function LD(n){const e=v4();n=Array.isArray(n)?n:[n];for(const t of n){const r=Wy(t);e.find(s=>r===s)||e.unshift(r)}}function FD(){return v4()}const BD=/\.([^.]+)$/;async function UD(n,e=[],t,r){if(!_4(n))return null;let s=Ww(n,e,{...t,nothrow:!0},r);if(s)return s;if(Ca(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Ww(n,e,t,r)),!s&&!(t!=null&&t.nothrow))throw new Error(y4(n));return s}function Ww(n,e=[],t,r){if(!_4(n))return null;if(e&&!Array.isArray(e))return Wy(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...FD()),zD(s);const i=VD(n,s,t,r);if(!i&&!(t!=null&&t.nothrow))throw new Error(y4(n));return i}function VD(n,e,t,r){const s=qp(n),i=$y(n),o=zy(s)||(r==null?void 0:r.url);let a=null,u="";return t!=null&&t.mimeType&&(a=D0(e,t==null?void 0:t.mimeType),u=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),a=a||$D(e,o),u=u||(a?`matched url ${o}`:""),a=a||D0(e,i),u=u||(a?`matched MIME type ${i}`:""),a=a||WD(e,n),u=u||(a?`matched initial data ${x4(n)}`:""),t!=null&&t.fallbackMimeType&&(a=a||D0(e,t==null?void 0:t.fallbackMimeType),u=u||(a?`matched fallback MIME type ${i}`:"")),u&&I8.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${u}.`),a}function _4(n){return!(n instanceof Response&&n.status===204)}function y4(n){const e=qp(n),t=$y(n);let r="No valid loader found (";r+=e?`${u4(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?x4(n):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function zD(n){for(const e of n)Wy(e)}function $D(n,e){const t=e&&BD.exec(e),r=t&&t[1];return r?jD(n,r):null}function jD(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function D0(n,e){var t;for(const r of n)if((t=r.mimeTypes)!=null&&t.some(s=>Bw(e,s))||Bw(e,`application/x.${r.id}`))return r;return null}function WD(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(HD(e,t))return t}else if(ArrayBuffer.isView(e)){if(Hw(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Hw(e,0,t))return t;return null}function HD(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function Hw(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>XD(n,e,t,s))}function XD(n,e,t,r){if(r instanceof ArrayBuffer)return Y8(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const s=t_(n,e,r.length);return r===s;default:return!1}}function x4(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?t_(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?t_(n,0,e):""}function t_(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(r.getUint8(e+i));return s}const YD=256*1024;function*qD(n,e){const t=(e==null?void 0:e.chunkSize)||YD;let r=0;const s=new TextEncoder;for(;r<n.length;){const i=Math.min(n.length-r,t),o=n.slice(r,r+i);r+=i,yield s.encode(o)}}const KD=256*1024;function*ZD(n,e={}){const{chunkSize:t=KD}=e;let r=0;for(;r<n.byteLength;){const s=Math.min(n.byteLength-r,t),i=new ArrayBuffer(s),o=new Uint8Array(n,r,s);new Uint8Array(i).set(o),r+=s,yield i}}const QD=1024*1024;async function*GD(n,e){const t=(e==null?void 0:e.chunkSize)||QD;let r=0;for(;r<n.size;){const s=r+t,i=await n.slice(r,s).arrayBuffer();r=s,yield i}}function Xw(n,e){return Uy?JD(n,e):eL(n)}async function*JD(n,e){const t=n.getReader();let r;try{for(;;){const s=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:i,value:o}=await s;if(i)return;yield c4(o)}}catch{t.releaseLock()}}async function*eL(n,e){for await(const t of n)yield c4(t)}function tL(n,e){if(typeof n=="string")return qD(n,e);if(n instanceof ArrayBuffer)return ZD(n,e);if(Ca(n))return GD(n,e);if(f4(n))return Xw(n,e);if(Ra(n))return Xw(n.body,e);throw new Error("makeIterator")}const w4="Cannot convert supplied data type";function nL(n,e,t){if(e.text&&typeof n=="string")return n;if(fD(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+s)),r}throw new Error(w4)}async function rL(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return nL(n,e);if(Ca(n)&&(n=await d4(n)),Ra(n)){const s=n;return await wD(s),e.binary?await s.arrayBuffer():await s.text()}if(f4(n)&&(n=tL(n,t)),cD(n)||uD(n))return Z8(n);throw new Error(w4)}function b4(n,e){const t=m4(),r=n||t;return typeof r.fetch=="function"?r.fetch:pf(r.fetch)?s=>Vw(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Vw}function sL(n,e,t){if(t)return t;const r={fetch:b4(e,n),...n};if(r.url){const s=zy(r.url);r.baseUrl=s,r.queryString=_D(r.url),r.filename=u4(s),r.baseUrl=aD(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function iL(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function Nd(n,e,t,r){e&&!Array.isArray(e)&&!jy(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const s=qp(n),o=iL(e,r),a=await UD(n,o,t);return a?(t=MD(t,a,o,s),r=sL({url:s,_parse:Nd,loaders:o},t,r||null),await oL(a,n,t,r)):null}async function oL(n,e,t,r){if(j8(n),t=M8(n.options,t),Ra(e)){const i=e,{ok:o,redirected:a,status:u,statusText:f,type:h,url:p}=i,m=Object.fromEntries(i.headers.entries());r.response={headers:m,ok:o,redirected:a,status:u,statusText:f,type:h,url:p}}e=await rL(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,r);if(W8(n,t))return await H8(n,e,t,r,Nd);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,r);if(s.parse)return await s.parse(e,t,r);throw go(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Dd(n,e,t,r){let s,i;!Array.isArray(e)&&!jy(e)?(s=[],i=e):(s=e,i=t);const o=b4(i);let a=n;return typeof n=="string"&&(a=await o(n)),Ca(n)&&(a=await o(n)),Array.isArray(s)?await Nd(a,s,i):await Nd(a,s,i)}const aL="4.3.2";var yS;const lL=(yS=globalThis.loaders)==null?void 0:yS.parseImageNode,n_=typeof Image<"u",r_=typeof ImageBitmap<"u",cL=!!lL,s_=Uy?!0:cL;function uL(n){switch(n){case"auto":return r_||n_||s_;case"imagebitmap":return r_;case"image":return n_;case"data":return s_;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function fL(){if(r_)return"imagebitmap";if(n_)return"image";if(s_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function hL(n){const e=pL(n);if(!e)throw new Error("Not an image");return e}function dL(n){switch(hL(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function pL(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const gL=/^data:image\/svg\+xml/,mL=/\.svg((\?|#).*)?$/;function Hy(n){return n&&(gL.test(n)||mL.test(n))}function vL(n,e){if(Hy(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return T4(n,e)}function T4(n,e){if(Hy(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function S4(n,e,t){const r=vL(n,t),s=self.URL||self.webkitURL,i=typeof r!="string"&&s.createObjectURL(r);try{return await _L(i||r,e)}finally{i&&s.revokeObjectURL(i)}}async function _L(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,s)=>{try{t.onload=()=>r(t),t.onerror=i=>{const o=i instanceof Error?i.message:"error";s(new Error(o))}}catch(i){s(i)}})}const yL={};let Yw=!0;async function xL(n,e,t){let r;Hy(t)?r=await S4(n,e,t):r=T4(n,t);const s=e&&e.imagebitmap;return await wL(r,s)}async function wL(n,e=null){if((bL(e)||!Yw)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),Yw=!1}return await createImageBitmap(n)}function bL(n){for(const e in n||yL)return!1;return!0}function TL(n){return!RL(n,"ftyp",4)||(n[8]&96)===0?null:SL(n)}function SL(n){switch(EL(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function EL(n,e,t){return String.fromCharCode(...n.slice(e,t))}function AL(n){return[...n].map(e=>e.charCodeAt(0))}function RL(n,e,t=0){const r=AL(e);for(let s=0;s<r.length;++s)if(r[s]!==n[s+t])return!1;return!0}const Os=!1,wu=!0;function E4(n){const e=gf(n);return PL(e)||kL(e)||IL(e)||ML(e)||CL(e)}function CL(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=TL(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function PL(n){const e=gf(n);return e.byteLength>=24&&e.getUint32(0,Os)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Os),height:e.getUint32(20,Os)}:null}function IL(n){const e=gf(n);return e.byteLength>=10&&e.getUint32(0,Os)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,wu),height:e.getUint16(8,wu)}:null}function ML(n){const e=gf(n);return e.byteLength>=14&&e.getUint16(0,Os)===16973&&e.getUint32(2,wu)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,wu),height:e.getUint32(22,wu)}:null}function kL(n){const e=gf(n);if(!(e.byteLength>=3&&e.getUint16(0,Os)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=OL();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,Os);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,Os),width:e.getUint16(i+7,Os)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,Os)}return null}function OL(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function gf(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function NL(n,e){var s;const{mimeType:t}=E4(n)||{},r=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Md(r),await r(n,t)}async function DL(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:i}=t||{},o=LL(s);let a;switch(o){case"imagebitmap":a=await xL(n,e,i);break;case"image":a=await S4(n,e,i);break;case"data":a=await NL(n);break;default:Md(!1)}return s==="data"&&(a=dL(a)),a}function LL(n){switch(n){case"auto":case"data":return fL();default:return uL(n),n}}const FL=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],BL=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],UL={image:{type:"auto",decode:!0}},VL={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:aL,mimeTypes:BL,extensions:FL,parse:DL,tests:[n=>!!E4(new DataView(n))],options:UL},ut=new hf({id:"deck"});let i_={};function zL(n){i_=n}function Zn(n,e,t,r){ut.level>0&&i_[n]&&i_[n].call(null,e,t,r)}function $L(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const jL={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:$L,parseTextSync:JSON.parse};function WL(){const n="9.0.41",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(ut.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:ut,_registerLoggers:zL},LD([jL,[VL,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const HL=WL();function Jo(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const L0={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function XL(n){const e={};for(const[t,r]of Object.entries(n))e[t]=qL(r);return e}function YL(n,e,t){const r={};for(const[s,i]of Object.entries(e))n&&s in n&&!i.private?(i.validate&&Jo(i.validate(n[s],i),`${t}: invalid ${s}`),r[s]=n[s]):r[s]=i.value;return r}function qL(n){let e=qw(n);if(e!=="object")return{value:n,...L0[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...L0[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=qw(n.value),{...n,...L0[e],type:e}):{type:"object",value:null};throw new Error("props")}function qw(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const KL=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,ZL=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,QL={vertex:KL,fragment:ZL},Kw=/void\s+main\s*\([^)]*\)\s*\{\n?/,Zw=/}\n?[^{}]*$/,F0=[],fd="__LUMA_INJECT_DECLARATIONS__";function GL(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const s=JL(t);typeof r=="string"&&(r={order:0,injection:r}),e[s][t]=r}return e}function JL(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Ld(n,e,t,r=!1){const s=e==="vertex";for(const i in t){const o=t[i];o.sort((u,f)=>u.order-f.order),F0.length=o.length;for(let u=0,f=o.length;u<f;++u)F0[u]=o[u].injection;const a=`${F0.join(`
`)}
`;switch(i){case"vs:#decl":s&&(n=n.replace(fd,a));break;case"vs:#main-start":s&&(n=n.replace(Kw,u=>u+a));break;case"vs:#main-end":s&&(n=n.replace(Zw,u=>a+u));break;case"fs:#decl":s||(n=n.replace(fd,a));break;case"fs:#main-start":s||(n=n.replace(Kw,u=>u+a));break;case"fs:#main-end":s||(n=n.replace(Zw,u=>a+u));break;default:n=n.replace(i,u=>u+a)}}return n=n.replace(fd,""),r&&(n=n.replace(/\}\s*$/,i=>i+QL[e])),n}let eF=1;class ea{constructor(e){S(this,"name");S(this,"vs");S(this,"fs");S(this,"getModuleUniforms");S(this,"dependencies");S(this,"deprecations");S(this,"defines");S(this,"injections");S(this,"uniforms",{});S(this,"uniformTypes",{});const{name:t,vs:r,fs:s,dependencies:i=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:u,deprecations:f=[],defines:h={},inject:p={}}=e;Jo(typeof t=="string"),this.name=t,this.vs=r,this.fs=s,this.getModuleUniforms=u,this.dependencies=ea.instantiateModules(i),this.deprecations=this._parseDeprecationDefinitions(f),this.defines=h,this.injections=GL(p),this.uniformTypes=o,a&&(this.uniforms=XL(a))}static instantiateModules(e){return e.map(t=>{if(t instanceof ea)return t;Jo(typeof t!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(t)}' and use it directly.`),t.name||(console.warn("shader module has no name"),t.name=`shader-module-${eF++}`);const r=new ea(t);return r.dependencies=ea.instantiateModules(t.dependencies||[]),r})}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:Jo(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${t}

`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):YL(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{var s;(s=r.regex)!=null&&s.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}_defaultGetUniforms(e={}){const t={},r=this.uniforms;for(const s in r){const i=r[s];s in e&&!i.private?(i.validate&&Jo(i.validate(e[s],i),`${this.name}: invalid ${s}`),t[s]=e[s]):t[s]=i.value}return t}}function Qw(n){if(n.source&&n.platformInfo.type==="webgpu")return{...n,vs:void 0,fs:void 0};if(!n.vs)throw new Error("no vertex shader");const e=Gw(n.platformInfo,n.vs);let t;return n.fs&&(t=Gw(n.platformInfo,n.fs)),{...n,vs:e,fs:t}}function Gw(n,e){if(typeof e=="string")return e;switch(n.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Kp(n){const e=ea.instantiateModules(n);return tF(e)}function tF(n){const e={},t={};return A4({modules:n,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,s)=>t[s]-t[r]).map(r=>e[r])}function A4(n){const{modules:e,level:t,moduleMap:r,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)r[i.name]=i,(s[i.name]===void 0||s[i.name]<t)&&(s[i.name]=t);for(const i of e)i.dependencies&&A4({modules:i.dependencies,level:t+1,moduleMap:r,moduleDepth:s})}function nF(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function rF(n,e){var r;if(Number(((r=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Jw(n,sF),n;case"fragment":return n=Jw(n,iF),n;default:throw new Error(e)}}const R4=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],sF=[...R4,[o_("attribute"),"in $1"],[o_("varying"),"out $1"]],iF=[...R4,[o_("varying"),"in $1"]];function Jw(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function o_(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function C4(n,e){let t="";for(const r in n){const s=n[r];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[r]){const i=e[r];i.sort((o,a)=>o.order-a.order);for(const o of i)t+=`  ${o.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function P4(n){const e={vertex:{},fragment:{}};for(const t of n){let r,s;typeof t!="string"?(r=t,s=r.hook):(r={},s=t),s=s.trim();const[i,o]=s.split(":"),a=s.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(i){case"vs":e.vertex[a]=u;break;case"fs":e.fragment[a]=u;break;default:throw new Error(i)}}return e}function oF(n,e){return{name:aF(n,e),language:"glsl",version:lF(n)}}function aF(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function lF(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const I4=`

${fd}
`,cF=`precision highp float;
`;function uF(n){const e=Kp(n.modules||[]);return{source:a_(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:Xy(e)}}function fF(n){const e=Kp(n.modules||[]);return{vs:a_(n.platformInfo,{...n,source:n.vs,stage:"vertex",modules:e}),fs:a_(n.platformInfo,{...n,source:n.fs,stage:"fragment",modules:e}),getUniforms:Xy(e)}}function hF(n){const{vs:e,fs:t}=n,r=Kp(n.modules||[]);return{vs:eb(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:eb(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:Xy(r)}}function a_(n,e){const{source:t,stage:r,modules:s,hookFunctions:i=[],inject:o={},log:a}=e;Jo(typeof t=="string","shader source must be a string");const u=t;let f="";const h=P4(i),p={},m={},v={};for(const w in o){const T=typeof o[w]=="string"?{injection:o[w],order:0}:o[w],E=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(E){const C=E[2],P=E[3];C?P==="decl"?m[w]=[T]:v[w]=[T]:p[w]=[T]}else v[w]=[T]}const x=n.type!=="webgpu"?s:[];for(const w of x){a&&w.checkDeprecations(u,a);const T=w.getModuleSource(r,"wgsl");f+=T;const E=w.injections[r];for(const C in E){const P=/^(v|f)s:#([\w-]+)$/.exec(C);if(P){const I=P[2]==="decl"?m:v;I[C]=I[C]||[],I[C].push(E[C])}else p[C]=p[C]||[],p[C].push(E[C])}}return f+=I4,f=Ld(f,r,m),f+=C4(h[r],p),f+=u,f=Ld(f,r,v),f}function eb(n,e){const{id:t,source:r,stage:s,language:i="glsl",modules:o,defines:a={},hookFunctions:u=[],inject:f={},prologue:h=!0,log:p}=e;Jo(typeof r=="string","shader source must be a string");const m=i==="glsl"?oF(r).version:-1,v=n.shaderLanguageVersion,x=m===100?"#version 100":"#version 300 es",T=r.split(`
`).slice(1).join(`
`),E={};o.forEach(j=>{Object.assign(E,j.getDefines())}),Object.assign(E,a);let C="";switch(i){case"wgsl":break;case"glsl":C=h?`${x}

// ----- PROLOGUE -------------------------
${dF({id:t,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${nF(n)}
${s==="fragment"?cF:""}

// ----- APPLICATION DEFINES -------------------------

${pF(E)}

`:`${x}
`;break}const P=P4(u),L={},I={},F={};for(const j in f){const q=typeof f[j]=="string"?{injection:f[j],order:0}:f[j],Q=/^(v|f)s:(#)?([\w-]+)$/.exec(j);if(Q){const le=Q[2],he=Q[3];le?he==="decl"?I[j]=[q]:F[j]=[q]:L[j]=[q]}else F[j]=[q]}for(const j of o){p&&j.checkDeprecations(T,p);const q=j.getModuleSource(s);C+=q;const Q=j.injections[s];for(const le in Q){const he=/^(v|f)s:#([\w-]+)$/.exec(le);if(he){const ne=he[2]==="decl"?I:F;ne[le]=ne[le]||[],ne[le].push(Q[le])}else L[le]=L[le]||[],L[le].push(Q[le])}}return C+="// ----- MAIN SHADER SOURCE -------------------------",C+=I4,C=Ld(C,s,I),C+=C4(P[s],L),C+=T,C=Ld(C,s,F),i==="glsl"&&m!==v&&(C=rF(C,s)),C.trim()}function Xy(n){return function(t){const r={};for(const s of n){const i=s.getUniforms(t,r);Object.assign(r,i)}return r}}function dF(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function pF(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}const Ko=class Ko{constructor(){S(this,"_hookFunctions",[]);S(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ko.defaultShaderAssembler=Ko.defaultShaderAssembler||new Ko,Ko.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,s=Qw(e);return{...uF({platformInfo:e.platformInfo,...s,modules:t,hookFunctions:r}),modules:t}}assembleShaderPair(e){const t=Qw(e),r=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:i}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?fF({platformInfo:i,...t,modules:r,hookFunctions:s}):hF({platformInfo:i,...t,modules:r,hookFunctions:s}),modules:r}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const a=this._defaultModules[i],u=a.name;t[s++]=a,r[u]=!0}for(let i=0,o=e.length;i<o;++i){const a=e[i],u=a.name;r[u]||(t[s++]=a,r[u]=!0)}return t.length=s,ea.instantiateModules(t)}};S(Ko,"defaultShaderAssembler");let Hl=Ko;const gF=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,mF=`#version 300 es
${gF}`;function vF(n){const{input:e,inputChannels:t,output:r}={};if(!e)return mF;if(!t)throw new Error("inputChannels");const s=_F(t),i=yF(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${r};
void main() {
  ${r} = ${i};
}`}function _F(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function yF(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}const Ce=new hf({id:"luma.gl"});class xF{constructor(){S(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new df({id:e})),this.stats.get(e)}}const Yy=new xF;function wF(){const n="9.0.28",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==n)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${n}`);return globalThis.luma||(Eo()&&Ce.log(1,`${n} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:n,version:n,log:Ce,stats:Yy}),n}const bF=wF();function TF(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)?n:null}function Lu(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number"?n:null:TF(n)}const B0={};function Pa(n="id"){B0[n]=B0[n]||1;const e=B0[n]++;return`${n}-${e}`}function Fd(n){let e=!0;for(const t in n){e=!1;break}return e}var dv;let Lt=(dv=class{constructor(e,t,r){S(this,"id");S(this,"props");S(this,"userData",{});S(this,"_device");S(this,"destroyed",!1);S(this,"allocatedBytes",0);S(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=SF(t,r);const s=this.props.id!=="undefined"?this.props.id:Pa(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},S(dv,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),dv);function SF(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}var vn;let un=(vn=class extends Lt{constructor(t,r){const s={...r};(r.usage||0)&vn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16"));super(t,s,vn.defaultProps);S(this,"usage");S(this,"indexType");S(this,"updateTimestamp");S(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,s){const i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:s,vn.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(o):r===0&&s===t.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}},S(vn,"defaultProps",{...Lt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),S(vn,"MAP_READ",1),S(vn,"MAP_WRITE",2),S(vn,"COPY_SRC",4),S(vn,"COPY_DST",8),S(vn,"INDEX",16),S(vn,"VERTEX",32),S(vn,"UNIFORM",64),S(vn,"STORAGE",128),S(vn,"INDIRECT",256),S(vn,"QUERY_RESOLVE",512),S(vn,"DEBUG_DATA_MAX_LENGTH",32),vn);function M4(n){const e=tb[n],t=EF(e),r=n.includes("norm"),s=!r&&!n.startsWith("float"),i=n.startsWith("s");return{dataType:tb[n],byteLength:t,integer:s,signed:i,normalized:r}}function EF(n){return AF[n]}const tb={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},AF={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},RF=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],CF=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function PF(n){return RF.some(e=>n.startsWith(e))}function k4(n){const e=CF.exec(n);if(e){const[,t,r,s,i,o]=e;if(t){const a=`${s}${r}`,u=M4(a);return{format:t,components:t.length,srgb:i==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...u}}}return MF(n)}const IF={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function MF(n){var t;const e=IF[n];if(!e)throw new Error(`Unknown format ${n}`);return{format:e.format||"",components:e.components||((t=e.format)==null?void 0:t.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class kF{}class OF{constructor(e=[],t){S(this,"features");S(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Ru=class Ru{constructor(e){S(this,"id");S(this,"props");S(this,"userData",{});S(this,"statsManager",Yy);S(this,"_lumaData",{});S(this,"timestamp",0);this.props={...Ru.defaultProps,...e},this.id=this.props.id||Pa(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return PF(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&un.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Ce.warn("indices buffer content must be of integer type")()),t}};S(Ru,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Ce.get("debug"),spector:!!(Ce.get("spector")||Ce.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Ce.error(e.message)}),S(Ru,"VERSION",bF);let Xl=Ru;function jt(n,e){if(!n)throw new Error(e||"luma.gl: assertion failed.")}const Xc=new Map,Il=class Il{static registerDevices(e){for(const t of e)jt(t.type&&t.isSupported&&t.create),Xc.set(t.type,t)}static getAvailableDevices(){return Array.from(Xc).map(e=>e.type)}static getSupportedDevices(){return Array.from(Xc).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Xl.defaultProps,e)}static async attachDevice(e){const t=nb(e.devices)||Xc;if(e.handle instanceof WebGL2RenderingContext){const r=t.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=t.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var i,o;e={...Il.defaultProps,...e},e.gl&&(e.type="webgl");const t=nb(e.devices)||Xc;let r,s;switch(e.type){case"webgpu":if(r=t.get("webgpu"),r)return await r.create(e);break;case"webgl":if(s=t.get("webgl"),s)return await s.create(e);break;case"unknown":const a=t.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=t.get("webgpu"),(i=r==null?void 0:r.isSupported)!=null&&i.call(r))return await r.create(e);if(s=t.get("webgl"),(o=s==null?void 0:s.isSupported)!=null&&o.call(s))return await s.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(r,s){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(r,s)}}};S(Il,"defaultProps",{...Xl.defaultProps,type:"best-available",devices:void 0}),S(Il,"stats",Yy),S(Il,"log",Ce);let kl=Il;function nb(n){if(!n||(n==null?void 0:n.length)===0)return null;const e=new Map;for(const t of n)e.set(t.type,t);return e}const NF=Eo()&&typeof document<"u",Zp=()=>NF&&document.readyState==="complete",DF={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class qy{constructor(e){S(this,"id");S(this,"props");S(this,"canvas");S(this,"htmlCanvas");S(this,"offscreenCanvas");S(this,"type");S(this,"width",1);S(this,"height",1);S(this,"resizeObserver");S(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...DF,...e},e=this.props,!Eo()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=BF(e.canvas):this.canvas=e.canvas;else{const t=UF(e),r=FF((e==null?void 0:e.container)||null);r.insertBefore(t,r.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Zp()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?t/r:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[s,i]=this.getDrawingBufferSize();return VF(e,r,s,i,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!s)&&(Ce.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==r||i.clientHeight!==s||i.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),u=Math.floor(s*o);this.htmlCanvas.width=a,this.htmlCanvas.height=u;const[f,h]=this.getDrawingBufferSize();(f!==a||h!==u)&&(o=Math.min(f/r,h/s),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(s*o),Ce.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}S(qy,"pageLoaded",LF());function LF(){return Zp()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}function FF(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e&&!Zp())throw new Error(`Accessing '${n}' before page was loaded`);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function BF(n){const e=document.getElementById(n);if(!e&&!Zp())throw new Error(`Accessing '${n}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function UF(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function VF(n,e,t,r,s){const i=n,o=rb(i[0],e,t);let a=sb(i[1],e,r,s),u=rb(i[0]+1,e,t);const f=u===t-1?u:u-1;u=sb(i[1]+1,e,r,s);let h;return s?(u=u===0?u:u+1,h=a,a=u):h=u===r-1?u:u-1,{x:o,y:a,width:Math.max(f-o+1,1),height:Math.max(h-a+1,1)}}function rb(n,e,t){return Math.min(Math.round(n*e),t-1)}function sb(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const ni=class ni extends Lt{constructor(t,r,s=ni.defaultProps){super(t,r,s);S(this,"dimension");S(this,"format");S(this,"width");S(this,"height");S(this,"depth");S(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};S(ni,"defaultProps",{...Lt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),S(ni,"COPY_SRC",1),S(ni,"COPY_DST",2),S(ni,"TEXTURE_BINDING",4),S(ni,"STORAGE_BINDING",8),S(ni,"RENDER_ATTACHMENT",16);let Hr=ni;const wp=class wp extends Lt{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,wp.defaultProps)}};S(wp,"defaultProps",{...Lt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Bd=wp;function zF(n,e,t){let r="";const s=e.split(/\r?\n/),i=n.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(r+=O4(s[a-1],a,t);i.length>o&&i[o].lineNum===a;){const u=i[o++];r+=ib(u,s,u.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const a of n)r+=ib(a,s,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function ib(n,e,t,r){if(r!=null&&r.inlineSource){const s=$F(e,t),i=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${s}${i}${n.type.toUpperCase()}: ${n.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function $F(n,e,t){let r="";for(let s=e-2;s<=e;s++){const i=n[s-1];i!==void 0&&(r+=O4(i,e,t))}return r}function O4(n,e,t){const r=t!=null&&t.html?WF(n):n;return`${jF(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function jF(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function WF(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function N4(n,e){return{name:HF(n,e),language:"glsl",version:XF(n)}}function HF(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}function XF(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const bp=class bp extends Lt{constructor(t,r){super(t,{id:YF(r),...r},bp.defaultProps);S(this,"stage");S(this,"source");S(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(t){var f;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=N4(this.source).name,s=`${this.stage} ${r}`;let i=zF(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const u=document.getElementsByClassName("luma-compiler-log-error");(f=u[0])!=null&&f.scrollIntoView&&u[0].scrollIntoView(),a.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};S(bp,"defaultProps",{...Lt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Ud=bp;function YF(n){return N4(n.source).name||n.id||Pa(`unnamed ${n.stage}-shader`)}const Tp=class Tp extends Lt{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t,Tp.defaultProps)}};S(Tp,"defaultProps",{...Lt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Vd=Tp;const Sp=class Sp extends Lt{constructor(t,r={}){super(t,r,Sp.defaultProps);S(this,"width");S(this,"height");S(this,"colorAttachments",[]);S(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(t){let r=!t;if(t){const[s,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||s!==this.width,this.width=s,this.height=i}r&&(Ce.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const s=this.createColorTexture(r);return this.attachResource(s),s.view}return r instanceof Hr?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Hr?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:Hr.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:Hr.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const i=this.device._createTexture({...this.colorAttachments[s].props,width:t,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const s=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}}};S(Sp,"defaultProps",{...Lt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let zd=Sp;const Ep=class Ep extends Lt{constructor(t,r){super(t,r,Ep.defaultProps);S(this,"shaderLayout");S(this,"bufferLayout");S(this,"linkStatus","pending");S(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};S(Ep,"defaultProps",{...Lt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Yl=Ep;const Ap=class Ap extends Lt{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t,Ap.defaultProps)}};S(Ap,"defaultProps",{...Lt.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let l_=Ap;const Rp=class Rp extends Lt{constructor(t,r){super(t,r,Rp.defaultProps);S(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};S(Rp,"defaultProps",{...Lt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let $d=Rp;const Cp=class Cp extends Lt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Cp.defaultProps)}};S(Cp,"defaultProps",{...Lt.defaultProps,measureExecutionTime:void 0});let c_=Cp;const Pp=class Pp extends Lt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Pp.defaultProps)}};S(Pp,"defaultProps",{...Lt.defaultProps});let u_=Pp;function qF(n){const[e,t]=ZF[n],r=e==="i32"||e==="u32",s=e!=="u32",i=QF[e]*t,o=KF(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:i,integer:r,signed:s}}function KF(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const ZF={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},QF={f32:4,f16:2,i32:4,u32:4};function D4(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),s=t,i=r?parseInt(r):1,o=M4(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function L4(n,e){const t={};for(const r of n.attributes)t[r.name]=JF(n,e,r.name);return t}function GF(n,e,t=16){const r=L4(n,e),s=new Array(t).fill(null);for(const i of Object.values(r))s[i.location]=i;return s}function JF(n,e,t){const r=e7(n,t),s=t7(e,t);if(!r)return null;const i=qF(r.type),o=(s==null?void 0:s.vertexFormat)||i.defaultVertexFormat,a=D4(o);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode,byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function e7(n,e){const t=n.attributes.find(r=>r.name===e);return t||Ce.warn(`shader layout attribute "${e}" not present in shader`),t||null}function t7(n,e){n7(n);let t=r7(n,e);return t||(t=s7(n,e),t)?t:(Ce.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function n7(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&Ce.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function r7(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function s7(n,e){var t;for(const r of n){let s=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=D4(o.format);s+=a.byteLength}const i=(t=r.attributes)==null?void 0:t.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:s}}return null}function i7(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(i=>i.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):Ce.warn(`shader layout attribute ${r.name} not present in shader`)}return t}const Ip=class Ip extends Lt{constructor(t,r){super(t,r,Ip.defaultProps);S(this,"maxVertexAttributes");S(this,"attributeInfos");S(this,"indexBuffer",null);S(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=GF(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){throw new Error("constant attributes not supported")}};S(Ip,"defaultProps",{...Lt.defaultProps,renderPipeline:null});let f_=Ip;const Mp=class Mp extends Lt{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Mp.defaultProps)}};S(Mp,"defaultProps",{...Lt.defaultProps,layout:void 0,buffers:{}});let h_=Mp;const kp=class kp extends Lt{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,kp.defaultProps)}};S(kp,"defaultProps",{...Lt.defaultProps,type:void 0,count:void 0});let d_=kp;const o7={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function a7(n){const e=o7[n];return jt(n),e}function l7(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let jh;function F4(n){return(!jh||jh.byteLength<n)&&(jh=new ArrayBuffer(n)),jh}function c7(n,e){const t=F4(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function u7(n){const{target:e,source:t,start:r=0,count:s=1}=n,i=t.length,o=s*i;let a=0;for(let u=r;a<i;a++)e[u++]=t[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return n.target}const ob=1024;class f7{constructor(e){S(this,"layout",{});S(this,"byteLength");let t=0;for(const[s,i]of Object.entries(e)){const o=a7(i),{type:a,components:u}=o;t=l7(t,u);const f=t;t+=u,this.layout[s]={type:a,size:u,offset:f}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,ob)}getData(e){const t=Math.max(this.byteLength,ob),r=F4(t),s={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[i,o]of Object.entries(e)){const a=this.layout[i];if(!a){Ce.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:u,size:f,offset:h}=a,p=s[u];if(f===1){if(typeof o!="number"&&typeof o!="boolean"){Ce.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}p[h]=Number(o)}else{const m=Lu(o);if(!m){Ce.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}p.set(m,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function h7(n,e,t=16){if(n!==e)return!1;const r=Lu(n);if(!r)return!1;const s=Lu(e);if(s&&r.length===s.length){for(let i=0;i<r.length;++i)if(s[i]!==r[i])return!1}return!0}function d7(n){const e=Lu(n);return e?e.slice():n}class p7{constructor(e){S(this,"name");S(this,"uniforms",{});S(this,"modifiedUniforms",{});S(this,"modified",!0);S(this,"bindingLayout",{});S(this,"needsRedraw","initialized");var t;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(i=>i.type==="uniform"&&i.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const s=r;for(const i of s.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){h7(this.uniforms[e],t)||(this.uniforms[e]=d7(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class g7{constructor(e){S(this,"uniformBlocks",new Map);S(this,"uniformBufferLayouts",new Map);S(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const s=t,i=new f7(r.uniformTypes||{});this.uniformBufferLayouts.set(s,i);const o=new p7({name:t});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,r]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const s=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:un.UNIFORM|un.COPY_DST,byteLength:s}),o=this.getUniformBufferData(t);return i.write(o),i}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:un.UNIFORM|un.COPY_DST,byteLength:r});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&Ce.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let s=!1;if(r&&t.needsRedraw){s||(s=t.needsRedraw);const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const a=this.uniformBlocks.get(e).getAllUniforms();Ce.log(4,`Writing to uniform buffer ${String(e)}`,i,a)()}return s}}function B4(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function U4(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function m7(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let s=B4(n);if(s==="uint8"&&t&&r===1)return"unorm8-webgl";if(s==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}if(s==="uint16"||s==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}return r===1?s:`${s}x${r}`}function v7(n){return Lu(n)!==null||typeof n=="number"||typeof n=="boolean"}function Ky(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];v7(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function _7(n,e,t){const{removedProps:r={},deprecatedProps:s={},replacedProps:i={}}=t;for(const a in r)if(a in e){const f=r[a]?`${n}.${r[a]}`:"N/A";Ce.removed(`${n}.${a}`,f)()}for(const a in s)if(a in e){const u=s[a];Ce.deprecated(`${n}.${a}`,`${n}.${u}`)()}let o=null;for(const[a,u]of Object.entries(i))a in e&&(Ce.deprecated(`${n}.${a}`,`${n}.${u}`)(),o=o||Object.assign({},e),o[u]=e[a],delete o[a]);return o||e}let y7="";async function x7(n,e){return await new Promise((t,r)=>{try{const s=new Image;s.onload=()=>t(s),s.onerror=()=>r(new Error(`Could not load image ${n}.`)),s.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",s.src=n.startsWith("http")?n:y7+n}catch(s){r(s)}})}async function V4(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((s,i)=>{r.onload=s,r.onerror=o=>i(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(r)})}function p_(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!p_(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!p_(n[i],e[i],t-1))return!1;return!0}return!1}function w7(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function b7(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}class ds{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class ab{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class so extends ds{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class la extends ds{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class mo extends ds{constructor(e,t,r,s){super(e,r),this.format=t,this.access=s}get isTemplate(){return!0}}var Ki,bl,ou,re,G;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ki||(Ki={}));class Wh{constructor(e,t,r,s,i,o,a){this.name=e,this.type=t,this.group=r,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class T7{constructor(e,t){this.name=e,this.type=t}}class S7{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s,this.interpolation=null}}class lb{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s}}class E7{constructor(e,t,r,s){this.name=e,this.type=t,this.attributes=r,this.id=s}}class A7{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class R7{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class C7{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class P7{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Zr{constructor(){this.id=Zr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(jd.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(Wd.instance)}}}Zr._id=0;class jd extends Zr{}jd.instance=new jd;class Wd extends Zr{}Wd.instance=new Wd;class Gt extends Zr{constructor(){super()}}class Hd extends Gt{constructor(e,t,r,s,i,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=s,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class I7 extends Gt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class z4 extends Gt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class g_ extends Gt{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class $4 extends Gt{constructor(e,t,r,s){super(),this.init=e,this.condition=t,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var t,r,s;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Ji extends Gt{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Zy extends Gt{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Xd extends Gt{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class m_ extends Gt{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}(n=>{n.increment="++",n.decrement="--"})(bl||(bl={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(bl||(bl={}));class j4 extends Gt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(ou||(ou={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(ou||(ou={}));class W4 extends Gt{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Qy extends Gt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}}class H4 extends Gt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class X4 extends Gt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class Y4 extends Gt{constructor(e,t,r,s){super(),this.condition=e,this.body=t,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class q4 extends Gt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class M7 extends Gt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class k7 extends Gt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class K4 extends Gt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Gy extends Gt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class O7 extends Gt{constructor(){super()}get astNodeType(){return"discard"}}class Z4 extends Gt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Q4 extends Gt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Se extends Gt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=Se._priority.get(t.name);Se._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?Se.i32:t}}Se.x32=new Se("x32"),Se.f32=new Se("f32"),Se.i32=new Se("i32"),Se.u32=new Se("u32"),Se.f16=new Se("f16"),Se.bool=new Se("bool"),Se._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Zi extends Se{constructor(e,t,r,s){super(e),this.members=t,this.startLine=r,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class de extends Se{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}}de.vec2f=new de("vec2",Se.f32,null),de.vec3f=new de("vec3",Se.f32,null),de.vec4f=new de("vec4",Se.f32,null),de.vec2i=new de("vec2",Se.i32,null),de.vec3i=new de("vec3",Se.i32,null),de.vec4i=new de("vec4",Se.i32,null),de.vec2u=new de("vec2",Se.u32,null),de.vec3u=new de("vec3",Se.u32,null),de.vec4u=new de("vec4",Se.u32,null),de.vec2h=new de("vec2",Se.f16,null),de.vec3h=new de("vec3",Se.f16,null),de.vec4h=new de("vec4",Se.f16,null),de.vec2b=new de("vec2",Se.bool,null),de.vec3b=new de("vec3",Se.bool,null),de.vec4b=new de("vec4",Se.bool,null),de.mat2x2f=new de("mat2x2",Se.f32,null),de.mat2x3f=new de("mat2x3",Se.f32,null),de.mat2x4f=new de("mat2x4",Se.f32,null),de.mat3x2f=new de("mat3x2",Se.f32,null),de.mat3x3f=new de("mat3x3",Se.f32,null),de.mat3x4f=new de("mat3x4",Se.f32,null),de.mat4x2f=new de("mat4x2",Se.f32,null),de.mat4x3f=new de("mat4x3",Se.f32,null),de.mat4x4f=new de("mat4x4",Se.f32,null),de.mat2x2h=new de("mat2x2",Se.f16,null),de.mat2x3h=new de("mat2x3",Se.f16,null),de.mat2x4h=new de("mat2x4",Se.f16,null),de.mat3x2h=new de("mat3x2",Se.f16,null),de.mat3x3h=new de("mat3x3",Se.f16,null),de.mat3x4h=new de("mat3x4",Se.f16,null),de.mat4x2h=new de("mat4x2",Se.f16,null),de.mat4x3h=new de("mat4x3",Se.f16,null),de.mat4x4h=new de("mat4x4",Se.f16,null);class N7 extends Se{constructor(e,t,r,s){super(e),this.storage=t,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class G4 extends Se{constructor(e,t,r,s){super(e),this.attributes=t,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class au extends Se{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class _s extends Zr{constructor(){super(),this.postfix=null}}class ma extends _s{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ca extends _s{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class oc extends _s{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return oc.builtinFunctionNames.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}oc.builtinFunctionNames=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class co extends _s{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class J4 extends _s{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getDataValue(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class on extends _s{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof se}get isVector(){return this.value instanceof V||this.value instanceof xt}get scalarValue(){return this.value instanceof se?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof V||this.value instanceof xt?this.value.value:(console.error("Value is not a vector or matrix."),[])}}class eA extends _s{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class hd extends _s{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}constEvaluate(e,t){return this.contents[0].constEvaluate(e,t)}search(e){this.searchBlock(this.contents,e)}}class ql extends _s{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class tA extends _s{constructor(){super()}}class Ir extends tA{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class ls extends tA{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Se.f32:e.name==="u32"||t.name==="u32"?Se.u32:Se.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class nA extends Zr{constructor(e){super(),this.body=e}}class dd extends _s{constructor(){super()}get astNodeType(){return"default"}}class rA extends nA{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class sA extends nA{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class D7 extends Zr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class L7 extends Zr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class F7 extends Zr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class B7 extends Zr{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class va{constructor(e){this.typeInfo=e}setDataValue(e,t,r,s){console.error("SetDataValue: Not implemented",t,r)}getDataValue(e,t,r){return console.error("GetDataValue: Not implemented",t),null}toString(){return`<${this.typeInfo.name}>`}}class v_ extends va{constructor(){super(new ds("void",null))}toString(){return"void"}}v_.void=new v_;class se extends va{constructor(e,t){super(t),this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?e=Math.floor(e):this.typeInfo.name==="bool"&&(e=e?1:0),this.value=e}setDataValue(e,t,r,s){r?console.error("SetDataValue: Scalar data does not support postfix",r):t instanceof se?(t.value,this.typeInfo.name==="i32"||this.typeInfo.name==="u32"||this.typeInfo.name,this.value=t.value):console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,r){return t?(console.error("GetDataValue: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function iA(n,e,t){const r=e.length;return r===2?t==="f32"?new V(e,n.getTypeInfo("vec2f")):t==="i32"?new V(e,n.getTypeInfo("vec2i")):t==="u32"?new V(e,n.getTypeInfo("vec2u")):t==="f16"?new V(e,n.getTypeInfo("vec2h")):(console.error(`GetDataValue: Unknown format ${t}`),null):r===3?t==="f32"?new V(e,n.getTypeInfo("vec3f")):t==="i32"?new V(e,n.getTypeInfo("vec3i")):t==="u32"?new V(e,n.getTypeInfo("vec3u")):t==="f16"?new V(e,n.getTypeInfo("vec3h")):(console.error(`GetDataValue: Unknown format ${t}`),null):r===4?t==="f32"?new V(e,n.getTypeInfo("vec4f")):t==="i32"?new V(e,n.getTypeInfo("vec4i")):t==="u32"?new V(e,n.getTypeInfo("vec4u")):t==="f16"?new V(e,n.getTypeInfo("vec4h")):(console.error(`GetDataValue: Unknown format ${t}`),null):(console.error(`GetDataValue: Invalid vector size ${e.length}`),null)}class V extends va{constructor(e,t){super(t),Array.isArray(e)?this.value=e:this.value=Array.from(e)}setDataValue(e,t,r,s){r instanceof ma?console.error("TODO: Set vector postfix"):t instanceof V?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,r){let s=e.getTypeInfo("f32");if(this.typeInfo instanceof mo)s=this.typeInfo.format;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?s=e.getTypeInfo("f32"):i==="vec2i"||i==="vec3i"||i==="vec4i"?s=e.getTypeInfo("i32"):i==="vec2u"||i==="vec3u"||i==="vec4u"?s=e.getTypeInfo("u32"):i==="vec2h"||i==="vec3h"||i==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetDataValue: Unknown type ${i}`)}if(t instanceof ql){const i=t.index;let o=-1;if(i instanceof on){if(!(i.value instanceof se))return console.error(`GetValueData: Invalid array index ${i.value}`),null;o=i.value.value}else{const a=e.evalExpression(i,r);if(!(a instanceof se))return console.error("GetDataValue: Unknown index type",i),null;o=a.value}return o<0||o>=this.value.length?(console.error("GetDataValue: Index out of range",o),null):new se(this.value[o],s)}if(t instanceof ma){const i=t.value,o=[];for(const a of i)a==="x"||a==="r"?o.push(this.value[0]):a==="y"||a==="g"?o.push(this.value[1]):a==="z"||a==="b"?o.push(this.value[2]):a==="w"||a==="a"?o.push(this.value[3]):console.error(`GetDataValue: Unknown member ${a}`);return o.length===1?new se(o[0],s):iA(e,o,s.name)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}}class xt extends va{constructor(e,t){super(t),this.value=e}setDataValue(e,t,r,s){r instanceof ma?console.error("TODO: Set matrix postfix"):t instanceof xt?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,r){const s=this.typeInfo.name;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof mo)i=this.typeInfo.format;else if(s.endsWith("f"))i=e.getTypeInfo("f32");else if(s.endsWith("i"))i=e.getTypeInfo("i32");else if(s.endsWith("u"))i=e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;i=e.getTypeInfo("f16")}if(t instanceof ql){const o=t.index;let a,u=-1;if(o instanceof on){if(!(o.value instanceof se))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;u=o.value.value}else{const h=e.evalExpression(o,r);if(!(h instanceof se))return console.error("GetDataValue: Unknown index type",o),null;u=h.value}if(u<0||u>=this.value.length)return console.error("GetDataValue: Index out of range",u),null;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")a=this.value.slice(2*u,2*u+2);else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")a=this.value.slice(3*u,3*u+3);else if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")a=this.value.slice(4*u,4*u+4);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")a=this.value.slice(2*u,2*u+2);else if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")a=this.value.slice(3*u,3*u+3);else if(s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h")a=this.value.slice(4*u,4*u+4);else if(s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")a=this.value.slice(2*u,2*u+2);else if(s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")a=this.value.slice(3*u,3*u+3);else{if(s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;a=this.value.slice(4*u,4*u+4)}const f=iA(e,a,i.name);if(t.postfix)return f.getDataValue(e,t.postfix,r)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}}class an extends va{constructor(e,t,r=0,s){super(t),this.textureSize=[0,0,0],this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r,s!==void 0&&(this.textureSize=s)}setDataValue(e,t,r,s){if(t===null)return void console.log("setDataValue: NULL data.");let i=this.offset,o=this.typeInfo;for(;r;){if(r instanceof ql)if(o instanceof la){const a=r.index;if(a instanceof on){if(!(a.value instanceof se))return void console.error(`SetDataValue: Invalid index type ${a.value}`);i+=a.value.value*o.stride}else{const u=e.evalExpression(a,s);if(!(u instanceof se))return void console.error("SetDataValue: Unknown index type",a);i+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${e.getTypeName(o)} is not an array`);else{if(!(r instanceof ma))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof so){let u=!1;for(const f of o.members)if(f.name===a){i+=f.offset,o=f.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof ds){const u=e.getTypeName(o);let f=0;if(a==="x"||a==="r")f=0;else if(a==="y"||a==="g")f=1;else if(a==="z"||a==="b")f=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);f=3}if(!(t instanceof se))return void console.error("SetDataValue: Invalid value",t);const h=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,i,2)[f]=h):u==="vec3f"?void(new Float32Array(this.buffer,i,3)[f]=h):u==="vec4f"?void(new Float32Array(this.buffer,i,4)[f]=h):u==="vec2i"?void(new Int32Array(this.buffer,i,2)[f]=h):u==="vec3i"?void(new Int32Array(this.buffer,i,3)[f]=h):u==="vec4i"?void(new Int32Array(this.buffer,i,4)[f]=h):u==="vec2u"?void(new Uint32Array(this.buffer,i,2)[f]=h):u==="vec3u"?void(new Uint32Array(this.buffer,i,3)[f]=h):u==="vec4u"?void(new Uint32Array(this.buffer,i,4)[f]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,t,o,i,s)}setData(e,t,r,s,i){const o=e.getTypeName(r);if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(t instanceof an){if(r===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,e.getTypeName(t.typeInfo))}else console.error(`SetData: Unknown type ${o}`);else{const a=new Float32Array(this.buffer,s,16);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11],a[12]=t.value[12],a[13]=t.value[13],a[14]=t.value[14],a[15]=t.value[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15])}else{const a=new Float32Array(this.buffer,s,12);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,8);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,12);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,9);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8])}else{const a=new Float32Array(this.buffer,s,6);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,8);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,6);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,4);t instanceof xt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Int32Array(this.buffer,s,4);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Int32Array(this.buffer,s,3);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Int32Array(this.buffer,s,2);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Float32Array(this.buffer,s,4);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Float32Array(this.buffer,s,3);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Float32Array(this.buffer,s,2);t instanceof V?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else t instanceof se&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof se&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof se&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof se&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getDataValue(e,t,r){let s=this.offset,i=this.typeInfo;for(;t;){if(t instanceof ql){const a=t.index,u=e.evalExpression(a,r);let f=0;if(u instanceof se?f=u.value:console.error("GetDataValue: Invalid index type",a),i instanceof la)s+=f*i.stride,i=i.format;else{const h=e.getTypeName(i);h==="mat4x4"||h==="mat4x4f"||h==="mat4x4h"?(s+=16*f,i=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${e.getTypeName(i)} is not an array`)}}else{if(!(t instanceof ma))return console.error("GetDataValue: Unknown postfix type",t),null;{const a=t.value;if(i instanceof so){let u=!1;for(const f of i.members)if(f.name===a){s+=f.offset,i=f.type,u=!0;break}if(!u)return console.error(`GetDataValue: Member ${a} not found`),null}else if(i instanceof ds){const u=e.getTypeName(i);if(u==="vec2f"||u==="vec3f"||u==="vec4f"||u==="vec2i"||u==="vec3i"||u==="vec4i"||u==="vec2u"||u==="vec3u"||u==="vec4u"||u==="vec2b"||u==="vec3b"||u==="vec4b"||u==="vec2h"||u==="vec3h"||u==="vec4h"||u==="vec2"||u==="vec3"||u==="vec4"){if(a.length>0&&a.length<5){let f="f32",h="f";const p=[];for(let m=0;m<a.length;++m){const v=a[m].toLocaleLowerCase();let x=0;if(v==="x"||v==="r")x=0;else if(v==="y"||v==="g")x=1;else if(v==="z"||v==="b")x=2;else{if(v!=="w"&&v!=="a")return console.error(`Unknown member ${a}`),null;x=3}if(u==="vec2f")p.push(new Float32Array(this.buffer,s,2)[x]);else if(u==="vec3f"){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const w=new Float32Array(this.buffer,s,3);p.push(w[x])}else if(u==="vec4f")p.push(new Float32Array(this.buffer,s,4)[x]);else if(u==="vec2i")f="i32",h="i",p.push(new Int32Array(this.buffer,s,2)[x]);else if(u==="vec3i")f="i32",h="i",p.push(new Int32Array(this.buffer,s,3)[x]);else if(u==="vec4i")f="i32",h="i",p.push(new Int32Array(this.buffer,s,4)[x]);else if(u==="vec2u"){f="u32",h="u";const w=new Uint32Array(this.buffer,s,2);p.push(w[x])}else u==="vec3u"?(f="u32",h="u",p.push(new Uint32Array(this.buffer,s,3)[x])):u==="vec4u"&&(f="u32",h="u",p.push(new Uint32Array(this.buffer,s,4)[x]))}return p.length===1?new se(p[0],e.getTypeInfo(f)):(p.length===2?i=e.getTypeInfo(`vec2${h}`):p.length===3?i=e.getTypeInfo(`vec3${h}`):p.length===4?i=e.getTypeInfo(`vec4${h}`):console.error(`GetDataValue: Invalid vector length ${p.length}`),new V(p,i))}return console.error(`GetDataValue: Unknown member ${a}`),null}return console.error(`GetDataValue: Type ${u} is not a struct`),null}}}t=t.postfix}const o=e.getTypeName(i);return o==="f32"?new se(new Float32Array(this.buffer,s,1)[0],i):o==="i32"?new se(new Int32Array(this.buffer,s,1)[0],i):o==="u32"?new se(new Uint32Array(this.buffer,s,1)[0],i):o==="vec2f"?new V(new Float32Array(this.buffer,s,2),i):o==="vec3f"?new V(new Float32Array(this.buffer,s,3),i):o==="vec4f"?new V(new Float32Array(this.buffer,s,4),i):o==="vec2i"?new V(new Int32Array(this.buffer,s,2),i):o==="vec3i"?new V(new Int32Array(this.buffer,s,3),i):o==="vec4i"?new V(new Int32Array(this.buffer,s,4),i):o==="vec2u"?new V(new Uint32Array(this.buffer,s,2),i):o==="vec3u"?new V(new Uint32Array(this.buffer,s,3),i):o==="vec4u"?new V(new Uint32Array(this.buffer,s,4),i):i instanceof mo&&i.name==="atomic"?i.format.name==="u32"?new se(new Uint32Array(this.buffer,s,1)[0],i.format):i.format.name==="i32"?new se(new Int32Array(this.buffer,s,1)[0],i.format):(console.error(`GetDataValue: Invalid atomic format ${i.format.name}`),null):new an(this.buffer,i,s)}toString(){let e="";if(this.typeInfo instanceof la)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof so?e+="{...}":e="[...]";return e}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(G||(G={}));class J{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class D{}re=D,D.none=new J("",G.reserved,""),D.eof=new J("EOF",G.token,""),D.reserved={asm:new J("asm",G.reserved,"asm"),bf16:new J("bf16",G.reserved,"bf16"),do:new J("do",G.reserved,"do"),enum:new J("enum",G.reserved,"enum"),f16:new J("f16",G.reserved,"f16"),f64:new J("f64",G.reserved,"f64"),handle:new J("handle",G.reserved,"handle"),i8:new J("i8",G.reserved,"i8"),i16:new J("i16",G.reserved,"i16"),i64:new J("i64",G.reserved,"i64"),mat:new J("mat",G.reserved,"mat"),premerge:new J("premerge",G.reserved,"premerge"),regardless:new J("regardless",G.reserved,"regardless"),typedef:new J("typedef",G.reserved,"typedef"),u8:new J("u8",G.reserved,"u8"),u16:new J("u16",G.reserved,"u16"),u64:new J("u64",G.reserved,"u64"),unless:new J("unless",G.reserved,"unless"),using:new J("using",G.reserved,"using"),vec:new J("vec",G.reserved,"vec"),void:new J("void",G.reserved,"void")},D.keywords={array:new J("array",G.keyword,"array"),atomic:new J("atomic",G.keyword,"atomic"),bool:new J("bool",G.keyword,"bool"),f32:new J("f32",G.keyword,"f32"),i32:new J("i32",G.keyword,"i32"),mat2x2:new J("mat2x2",G.keyword,"mat2x2"),mat2x3:new J("mat2x3",G.keyword,"mat2x3"),mat2x4:new J("mat2x4",G.keyword,"mat2x4"),mat3x2:new J("mat3x2",G.keyword,"mat3x2"),mat3x3:new J("mat3x3",G.keyword,"mat3x3"),mat3x4:new J("mat3x4",G.keyword,"mat3x4"),mat4x2:new J("mat4x2",G.keyword,"mat4x2"),mat4x3:new J("mat4x3",G.keyword,"mat4x3"),mat4x4:new J("mat4x4",G.keyword,"mat4x4"),ptr:new J("ptr",G.keyword,"ptr"),sampler:new J("sampler",G.keyword,"sampler"),sampler_comparison:new J("sampler_comparison",G.keyword,"sampler_comparison"),struct:new J("struct",G.keyword,"struct"),texture_1d:new J("texture_1d",G.keyword,"texture_1d"),texture_2d:new J("texture_2d",G.keyword,"texture_2d"),texture_2d_array:new J("texture_2d_array",G.keyword,"texture_2d_array"),texture_3d:new J("texture_3d",G.keyword,"texture_3d"),texture_cube:new J("texture_cube",G.keyword,"texture_cube"),texture_cube_array:new J("texture_cube_array",G.keyword,"texture_cube_array"),texture_multisampled_2d:new J("texture_multisampled_2d",G.keyword,"texture_multisampled_2d"),texture_storage_1d:new J("texture_storage_1d",G.keyword,"texture_storage_1d"),texture_storage_2d:new J("texture_storage_2d",G.keyword,"texture_storage_2d"),texture_storage_2d_array:new J("texture_storage_2d_array",G.keyword,"texture_storage_2d_array"),texture_storage_3d:new J("texture_storage_3d",G.keyword,"texture_storage_3d"),texture_depth_2d:new J("texture_depth_2d",G.keyword,"texture_depth_2d"),texture_depth_2d_array:new J("texture_depth_2d_array",G.keyword,"texture_depth_2d_array"),texture_depth_cube:new J("texture_depth_cube",G.keyword,"texture_depth_cube"),texture_depth_cube_array:new J("texture_depth_cube_array",G.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new J("texture_depth_multisampled_2d",G.keyword,"texture_depth_multisampled_2d"),texture_external:new J("texture_external",G.keyword,"texture_external"),u32:new J("u32",G.keyword,"u32"),vec2:new J("vec2",G.keyword,"vec2"),vec3:new J("vec3",G.keyword,"vec3"),vec4:new J("vec4",G.keyword,"vec4"),bitcast:new J("bitcast",G.keyword,"bitcast"),block:new J("block",G.keyword,"block"),break:new J("break",G.keyword,"break"),case:new J("case",G.keyword,"case"),continue:new J("continue",G.keyword,"continue"),continuing:new J("continuing",G.keyword,"continuing"),default:new J("default",G.keyword,"default"),diagnostic:new J("diagnostic",G.keyword,"diagnostic"),discard:new J("discard",G.keyword,"discard"),else:new J("else",G.keyword,"else"),enable:new J("enable",G.keyword,"enable"),fallthrough:new J("fallthrough",G.keyword,"fallthrough"),false:new J("false",G.keyword,"false"),fn:new J("fn",G.keyword,"fn"),for:new J("for",G.keyword,"for"),function:new J("function",G.keyword,"function"),if:new J("if",G.keyword,"if"),let:new J("let",G.keyword,"let"),const:new J("const",G.keyword,"const"),loop:new J("loop",G.keyword,"loop"),while:new J("while",G.keyword,"while"),private:new J("private",G.keyword,"private"),read:new J("read",G.keyword,"read"),read_write:new J("read_write",G.keyword,"read_write"),return:new J("return",G.keyword,"return"),requires:new J("requires",G.keyword,"requires"),storage:new J("storage",G.keyword,"storage"),switch:new J("switch",G.keyword,"switch"),true:new J("true",G.keyword,"true"),alias:new J("alias",G.keyword,"alias"),type:new J("type",G.keyword,"type"),uniform:new J("uniform",G.keyword,"uniform"),var:new J("var",G.keyword,"var"),override:new J("override",G.keyword,"override"),workgroup:new J("workgroup",G.keyword,"workgroup"),write:new J("write",G.keyword,"write"),r8unorm:new J("r8unorm",G.keyword,"r8unorm"),r8snorm:new J("r8snorm",G.keyword,"r8snorm"),r8uint:new J("r8uint",G.keyword,"r8uint"),r8sint:new J("r8sint",G.keyword,"r8sint"),r16uint:new J("r16uint",G.keyword,"r16uint"),r16sint:new J("r16sint",G.keyword,"r16sint"),r16float:new J("r16float",G.keyword,"r16float"),rg8unorm:new J("rg8unorm",G.keyword,"rg8unorm"),rg8snorm:new J("rg8snorm",G.keyword,"rg8snorm"),rg8uint:new J("rg8uint",G.keyword,"rg8uint"),rg8sint:new J("rg8sint",G.keyword,"rg8sint"),r32uint:new J("r32uint",G.keyword,"r32uint"),r32sint:new J("r32sint",G.keyword,"r32sint"),r32float:new J("r32float",G.keyword,"r32float"),rg16uint:new J("rg16uint",G.keyword,"rg16uint"),rg16sint:new J("rg16sint",G.keyword,"rg16sint"),rg16float:new J("rg16float",G.keyword,"rg16float"),rgba8unorm:new J("rgba8unorm",G.keyword,"rgba8unorm"),rgba8unorm_srgb:new J("rgba8unorm_srgb",G.keyword,"rgba8unorm_srgb"),rgba8snorm:new J("rgba8snorm",G.keyword,"rgba8snorm"),rgba8uint:new J("rgba8uint",G.keyword,"rgba8uint"),rgba8sint:new J("rgba8sint",G.keyword,"rgba8sint"),bgra8unorm:new J("bgra8unorm",G.keyword,"bgra8unorm"),bgra8unorm_srgb:new J("bgra8unorm_srgb",G.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new J("rgb10a2unorm",G.keyword,"rgb10a2unorm"),rg11b10float:new J("rg11b10float",G.keyword,"rg11b10float"),rg32uint:new J("rg32uint",G.keyword,"rg32uint"),rg32sint:new J("rg32sint",G.keyword,"rg32sint"),rg32float:new J("rg32float",G.keyword,"rg32float"),rgba16uint:new J("rgba16uint",G.keyword,"rgba16uint"),rgba16sint:new J("rgba16sint",G.keyword,"rgba16sint"),rgba16float:new J("rgba16float",G.keyword,"rgba16float"),rgba32uint:new J("rgba32uint",G.keyword,"rgba32uint"),rgba32sint:new J("rgba32sint",G.keyword,"rgba32sint"),rgba32float:new J("rgba32float",G.keyword,"rgba32float"),static_assert:new J("static_assert",G.keyword,"static_assert")},D.tokens={decimal_float_literal:new J("decimal_float_literal",G.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new J("hex_float_literal",G.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new J("int_literal",G.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new J("uint_literal",G.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new J("name",G.token,/[_a-zA-Z][0-9a-zA-Z_]*/),ident:new J("ident",G.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new J("and",G.token,"&"),and_and:new J("and_and",G.token,"&&"),arrow:new J("arrow ",G.token,"->"),attr:new J("attr",G.token,"@"),forward_slash:new J("forward_slash",G.token,"/"),bang:new J("bang",G.token,"!"),bracket_left:new J("bracket_left",G.token,"["),bracket_right:new J("bracket_right",G.token,"]"),brace_left:new J("brace_left",G.token,"{"),brace_right:new J("brace_right",G.token,"}"),colon:new J("colon",G.token,":"),comma:new J("comma",G.token,","),equal:new J("equal",G.token,"="),equal_equal:new J("equal_equal",G.token,"=="),not_equal:new J("not_equal",G.token,"!="),greater_than:new J("greater_than",G.token,">"),greater_than_equal:new J("greater_than_equal",G.token,">="),shift_right:new J("shift_right",G.token,">>"),less_than:new J("less_than",G.token,"<"),less_than_equal:new J("less_than_equal",G.token,"<="),shift_left:new J("shift_left",G.token,"<<"),modulo:new J("modulo",G.token,"%"),minus:new J("minus",G.token,"-"),minus_minus:new J("minus_minus",G.token,"--"),period:new J("period",G.token,"."),plus:new J("plus",G.token,"+"),plus_plus:new J("plus_plus",G.token,"++"),or:new J("or",G.token,"|"),or_or:new J("or_or",G.token,"||"),paren_left:new J("paren_left",G.token,"("),paren_right:new J("paren_right",G.token,")"),semicolon:new J("semicolon",G.token,";"),star:new J("star",G.token,"*"),tilde:new J("tilde",G.token,"~"),underscore:new J("underscore",G.token,"_"),xor:new J("xor",G.token,"^"),plus_equal:new J("plus_equal",G.token,"+="),minus_equal:new J("minus_equal",G.token,"-="),times_equal:new J("times_equal",G.token,"*="),division_equal:new J("division_equal",G.token,"/="),modulo_equal:new J("modulo_equal",G.token,"%="),and_equal:new J("and_equal",G.token,"&="),or_equal:new J("or_equal",G.token,"|="),xor_equal:new J("xor_equal",G.token,"^="),shift_right_equal:new J("shift_right_equal",G.token,">>="),shift_left_equal:new J("shift_left_equal",G.token,"<<=")},D.simpleTokens={"@":re.tokens.attr,"{":re.tokens.brace_left,"}":re.tokens.brace_right,":":re.tokens.colon,",":re.tokens.comma,"(":re.tokens.paren_left,")":re.tokens.paren_right,";":re.tokens.semicolon},D.literalTokens={"&":re.tokens.and,"&&":re.tokens.and_and,"->":re.tokens.arrow,"/":re.tokens.forward_slash,"!":re.tokens.bang,"[":re.tokens.bracket_left,"]":re.tokens.bracket_right,"=":re.tokens.equal,"==":re.tokens.equal_equal,"!=":re.tokens.not_equal,">":re.tokens.greater_than,">=":re.tokens.greater_than_equal,">>":re.tokens.shift_right,"<":re.tokens.less_than,"<=":re.tokens.less_than_equal,"<<":re.tokens.shift_left,"%":re.tokens.modulo,"-":re.tokens.minus,"--":re.tokens.minus_minus,".":re.tokens.period,"+":re.tokens.plus,"++":re.tokens.plus_plus,"|":re.tokens.or,"||":re.tokens.or_or,"*":re.tokens.star,"~":re.tokens.tilde,_:re.tokens.underscore,"^":re.tokens.xor,"+=":re.tokens.plus_equal,"-=":re.tokens.minus_equal,"*=":re.tokens.times_equal,"/=":re.tokens.division_equal,"%=":re.tokens.modulo_equal,"&=":re.tokens.and_equal,"|=":re.tokens.or_equal,"^=":re.tokens.xor_equal,">>=":re.tokens.shift_right_equal,"<<=":re.tokens.shift_left_equal},D.regexTokens={decimal_float_literal:re.tokens.decimal_float_literal,hex_float_literal:re.tokens.hex_float_literal,int_literal:re.tokens.int_literal,uint_literal:re.tokens.uint_literal,ident:re.tokens.ident},D.storage_class=[re.keywords.function,re.keywords.private,re.keywords.workgroup,re.keywords.uniform,re.keywords.storage],D.access_mode=[re.keywords.read,re.keywords.write,re.keywords.read_write],D.sampler_type=[re.keywords.sampler,re.keywords.sampler_comparison],D.sampled_texture_type=[re.keywords.texture_1d,re.keywords.texture_2d,re.keywords.texture_2d_array,re.keywords.texture_3d,re.keywords.texture_cube,re.keywords.texture_cube_array],D.multisampled_texture_type=[re.keywords.texture_multisampled_2d],D.storage_texture_type=[re.keywords.texture_storage_1d,re.keywords.texture_storage_2d,re.keywords.texture_storage_2d_array,re.keywords.texture_storage_3d],D.depth_texture_type=[re.keywords.texture_depth_2d,re.keywords.texture_depth_2d_array,re.keywords.texture_depth_cube,re.keywords.texture_depth_cube_array,re.keywords.texture_depth_multisampled_2d],D.texture_external_type=[re.keywords.texture_external],D.any_texture_type=[...re.sampled_texture_type,...re.multisampled_texture_type,...re.storage_texture_type,...re.depth_texture_type,...re.texture_external_type],D.texel_format=[re.keywords.r8unorm,re.keywords.r8snorm,re.keywords.r8uint,re.keywords.r8sint,re.keywords.r16uint,re.keywords.r16sint,re.keywords.r16float,re.keywords.rg8unorm,re.keywords.rg8snorm,re.keywords.rg8uint,re.keywords.rg8sint,re.keywords.r32uint,re.keywords.r32sint,re.keywords.r32float,re.keywords.rg16uint,re.keywords.rg16sint,re.keywords.rg16float,re.keywords.rgba8unorm,re.keywords.rgba8unorm_srgb,re.keywords.rgba8snorm,re.keywords.rgba8uint,re.keywords.rgba8sint,re.keywords.bgra8unorm,re.keywords.bgra8unorm_srgb,re.keywords.rgb10a2unorm,re.keywords.rg11b10float,re.keywords.rg32uint,re.keywords.rg32sint,re.keywords.rg32float,re.keywords.rgba16uint,re.keywords.rgba16sint,re.keywords.rgba16float,re.keywords.rgba32uint,re.keywords.rgba32sint,re.keywords.rgba32float],D.const_literal=[re.tokens.int_literal,re.tokens.uint_literal,re.tokens.decimal_float_literal,re.tokens.hex_float_literal,re.keywords.true,re.keywords.false],D.literal_or_ident=[re.tokens.ident,re.tokens.int_literal,re.tokens.uint_literal,re.tokens.decimal_float_literal,re.tokens.hex_float_literal,re.tokens.name],D.element_count_expression=[re.tokens.int_literal,re.tokens.uint_literal,re.tokens.ident],D.template_types=[re.keywords.vec2,re.keywords.vec3,re.keywords.vec4,re.keywords.mat2x2,re.keywords.mat2x3,re.keywords.mat2x4,re.keywords.mat3x2,re.keywords.mat3x3,re.keywords.mat3x4,re.keywords.mat4x2,re.keywords.mat4x3,re.keywords.mat4x4,re.keywords.atomic,re.keywords.bitcast,...re.any_texture_type],D.attribute_name=[re.tokens.ident,re.keywords.block,re.keywords.diagnostic],D.assignment_operators=[re.tokens.equal,re.tokens.plus_equal,re.tokens.minus_equal,re.tokens.times_equal,re.tokens.division_equal,re.tokens.modulo_equal,re.tokens.and_equal,re.tokens.or_equal,re.tokens.xor_equal,re.tokens.shift_right_equal,re.tokens.shift_left_equal],D.increment_operators=[re.tokens.plus_plus,re.tokens.minus_minus];class cb{constructor(e,t,r){this.type=e,this.lexeme=t,this.line=r}toString(){return this.lexeme}isTemplateType(){return D.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==D.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class U7{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new cb(D.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=D.simpleTokens[e];if(t)return this._addToken(t),!0;let r=D.none;const s=this._isAlpha(e),i=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(s){const o=D.keywords[e];if(o)return this._addToken(o),!0}if(s||i)return this._addToken(D.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(D.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(D.tokens.minus_minus),!0;const u=this._tokens.length-1;if((D.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==D.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let u=!1,f=this._tokens.length-1;for(let h=0;h<5&&f>=0&&D.assignment_operators.indexOf(this._tokens[f].type)===-1;++h,--f)if(this._tokens[f].type===D.tokens.less_than){f>0&&this._tokens[f-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===D.none){let u=e,f=0;const h=2;for(let p=0;p<h;++p)if(u+=this._peekAhead(p),o=this._findType(u),o!==D.none){f=p;break}if(o===D.none)return r!==D.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=f+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==D.none&&(this._addToken(r),!0)}_findType(e){for(const r in D.regexTokens){const s=D.regexTokens[r];if(this._match(e,s.rule))return s}return D.literalTokens[e]||D.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new cb(e,t,this._line))}}class V7{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Hh{constructor(e,t){this.align=e,this.size=t}}class Ns{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new C7,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Hd&&this._functions.set(t.name,new V7(t));for(const t of e)if(t instanceof Zi){const r=this.getTypeInfo(t,null);r instanceof so&&this.structs.push(r)}for(const t of e)if(t instanceof Gy)this.aliases.push(this._getAliasInfo(t));else if(t instanceof Zy){const r=t,s=this._getAttributeNum(r.attributes,"id",0),i=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new E7(r.name,i,r.attributes,s))}else if(this._isUniformVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new Wh(r.name,o,s,i,r.attributes,Ki.Uniform,r.access);this.uniforms.push(a)}else if(this._isStorageVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new Wh(r.name,o,s,i,r.attributes,a?Ki.StorageTexture:Ki.Storage,r.access);this.storage.push(u)}else if(this._isTextureVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new Wh(r.name,o,s,i,r.attributes,a?Ki.StorageTexture:Ki.Texture,r.access);a?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new Wh(r.name,o,s,i,r.attributes,Ki.Sampler,r.access);this.samplers.push(a)}else if(t instanceof Hd){const r=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),o=r||s||i,a=new R7(t.name,o==null?void 0:o.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,o&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!o),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(a)),a.arguments=t.args.map(u=>new A7(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var s;if(r.astNodeType==="varExpr"){const i=r;for(const o of this.overrides)i.name==o.name&&((s=t.info)===null||s===void 0||s.overrides.push(o))}});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const s of e.calls){const i=(r=this._functions.get(s.name))===null||r===void 0?void 0:r.info;i&&t.add(i)}}findResource(e,t){for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],s=this,i=[];return e.search(o=>{if(o instanceof jd)i.push({});else if(o instanceof Wd)i.pop();else if(o instanceof Ji){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof ca){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Xd){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof co){const a=o;if(i.length>0&&i[i.length-1][a.name])return;const u=s._findResource(a.name);u&&r.push(u)}else if(o instanceof oc){const a=o,u=s._functions.get(a.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=s._findResources(u.node,t)),r.push(...u.resources))}else if(o instanceof Qy){const a=o,u=s._functions.get(a.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=s._findResources(u.node,t)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Zi)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof Zi)this._getStructOutputs(r.type,t);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const i=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(s.value),a=new lb(r.name,i,s.name,o);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new lb("",r,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof Zi)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof Zi)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),o=new S7(e.name,s,t.name,i);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new T7(e.name,this.getTypeInfo(e.type,null))}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof G4){const s=e,i=s.format?this.getTypeInfo(s.format,s.attributes):null,o=new la(s.name,t);return o.format=i,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Zi){const s=e,i=new so(s.name,t);i.startLine=s.startLine,i.endLine=s.endLine;for(const o of s.members){const a=this.getTypeInfo(o.type,o.attributes);i.members.push(new ab(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof au){const s=e,i=s.format instanceof Se,o=s.format?i?this.getTypeInfo(s.format,null):new ds(s.format,null):null,a=new mo(s.name,o,t,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof de){const s=e,i=s.format?this.getTypeInfo(s.format,null):null,o=new mo(s.name,i,t,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new ds(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,s;const i=this._getTypeSize(e);if(e.size=(t=i==null?void 0:i.size)!==null&&t!==void 0?t:0,e instanceof la&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(s=o==null?void 0:o.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof so&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,s=0,i=0,o=0;for(let a=0,u=e.members.length;a<u;++a){const f=e.members[a],h=this._getTypeSize(f);if(!h)continue;(t=this._getAlias(f.type.name))!==null&&t!==void 0||f.type;const p=h.align,m=h.size;r=this._roundUp(p,r+s),s=m,i=r,o=Math.max(o,p),f.offset=r,f.size=m,this._updateTypeInfo(f.type)}e.size=this._roundUp(o,i+s),e.align=o}_getTypeSize(e){var t,r;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof ab&&(e=e.type),e instanceof ds){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Ns._typeInfo[e.name];if(o!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Hh(Math.max(i,o.align/a),Math.max(s,o.size/a))}}{const o=Ns._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new Hh(Math.max(i,o.align/a),Math.max(s,o.size/a))}}if(e instanceof la){let o=e,a=8,u=8;const f=this._getTypeSize(o.format);return f!==null&&(u=f.size,a=f.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,u)),s&&(u=s),new Hh(Math.max(i,a),Math.max(s,u))}if(e instanceof so){let o=0,a=0,u=0,f=0,h=0;for(const p of e.members){const m=this._getTypeSize(p.type);m!==null&&(o=Math.max(m.align,o),u=this._roundUp(m.align,u+f),f=m.size,h=u)}return a=this._roundUp(o,h+f),new Hh(Math.max(i,o),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof Ji&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ji&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ji&&e.type!==null&&Ns._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ji&&e.type!==null&&Ns._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let i of s)if(i.name==t)return i;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let s of e)if(s.name==t){let i=s!==null&&s.value!==null?s.value:r;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}Ns._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ns._textureTypes=D.any_texture_type.map(n=>n.name),Ns._samplerTypes=D.sampler_type.map(n=>n.name);class Jy{constructor(e,t,r){this.name=e,this.value=t,this.node=r}clone(){return new Jy(this.name,this.value,this.node)}}class e1{constructor(e){this.name=e.name,this.node=e}clone(){return new e1(this.node)}}class t1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new Jy(e,t,r??null))}setVariable(e,t,r){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new t1(this)}}class z7{evalExpression(e,t){return null}getTypeName(e){return""}getTypeInfo(e){return null}getVariableName(e,t){return""}}class $7{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let s=!0;if(r instanceof V)return r.value.forEach(i=>{i||(s=!1)}),new se(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V){const s=r.value.some(i=>i);return new se(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof se))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.evalExpression(r,t);if(s instanceof an&&s.typeInfo.size===0){const i=s.typeInfo,o=s.buffer.byteLength/i.stride;return new se(o,this.getTypeInfo("u32"))}return new se(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.abs(i)),r.typeInfo);const s=r;return new se(Math.abs(s.value),s.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.acos(i)),r.typeInfo);const s=r;return new se(Math.acos(s.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.acosh(i)),r.typeInfo);const s=r;return new se(Math.acosh(s.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.asin(i)),r.typeInfo);const s=r;return new se(Math.asin(s.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.asinh(i)),r.typeInfo);const s=r;return new se(Math.asinh(s.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.atan(i)),r.typeInfo);const s=r;return new se(Math.atan(s.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.atanh(i)),r.typeInfo);const s=r;return new se(Math.atanh(s.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V)return new V(r.value.map((a,u)=>Math.atan2(a,s.value[u])),r.typeInfo);const i=r,o=s;return new se(Math.atan2(i.value,o.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.ceil(i)),r.typeInfo);const s=r;return new se(Math.ceil(s.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof V&&s instanceof V&&i instanceof V)return new V(r.value.map((f,h)=>this._clamp(f,s.value[h],i.value[h])),r.typeInfo);const o=r,a=s,u=i;return new se(this._clamp(o.value,a.value,u.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.cos(i)),r.typeInfo);const s=r;return new se(Math.cos(s.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.cosh(i)),r.typeInfo);const s=r;return new se(Math.cos(s.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.clz32(i)),r.typeInfo);const s=r;return new se(Math.clz32(s.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>this._countOneBits(i)),r.typeInfo);const s=r;return new se(this._countOneBits(s.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>this._countTrailingZeros(i)),r.typeInfo);const s=r;return new se(this._countTrailingZeros(s.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V){if(r.value.length!==3||s.value.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const i=r.value,o=s.value;return new V([i[1]*o[2]-o[1]*i[2],i[2]*o[0]-o[2]*i[0],i[0]*o[1]-o[0]*i[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return r instanceof V?new V(r.value.map(i=>i*s),r.typeInfo):new se(r.value*s,r.typeInfo)}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof xt){const s=r.value,i=this.exec.getTypeName(r.typeInfo),o=i.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")return new se(s[0]*s[3]-s[1]*s[2],o);if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")return new se(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")console.error(`TODO: Determinant for ${i}`);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")console.error(`TODO: Determinant for ${i}`);else{if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")return new se(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h"?console.error(`TODO: Determinant for ${i}`):i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h"||console.error(`TODO: Determinant for ${i}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V){let a=0;for(let u=0;u<r.value.length;++u)a+=(r.value[u]-s.value[u])*(r.value[u]-s.value[u]);return new se(Math.sqrt(a),this.getTypeInfo("f32"))}const i=r,o=s;return new se(Math.abs(i.value-o.value),r.typeInfo)}_dot(e,t){let r=0;for(let s=0;s<e.length;++s)r+=t[s]*e[s];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return r instanceof V&&s instanceof V?new se(this._dot(r.value,s.value),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.exp(i)),r.typeInfo);const s=r;return new se(Math.exp(s.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.pow(2,i)),r.typeInfo);const s=r;return new se(Math.pow(2,s.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=s.value,a=i.value;if(r instanceof V)return new V(r.value.map(f=>f>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new se(u>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof V&&s instanceof V&&i instanceof V){const o=this._dot(s.value,i.value);return new V(o<0?r.value:r.value.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>this._firstLeadingBit(i)),r.typeInfo);const s=r;return new se(this._firstLeadingBit(s.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>this._firstTrailingBit(i)),r.typeInfo);const s=r;return new se(this._firstTrailingBit(s.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.floor(i)),r.typeInfo);const s=r;return new se(Math.floor(s.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof V&&s instanceof V&&i instanceof V)return r.value.length!==s.value.length||r.value.length!==i.value.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new V(r.value.map((f,h)=>f*s.value[h]+i.value[h]),r.typeInfo);const o=r,a=s,u=i;return new se(o.value*a.value+u.value,o.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>i-Math.floor(i)),r.typeInfo);const s=r;return new se(s.value-Math.floor(s.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=i.value,u=(1<<o.value)-1<<a,f=~u;if(r instanceof V&&s instanceof V)return new V(r.value.map((m,v)=>m&f|s.value[v]<<a&u),r.typeInfo);const h=r.value,p=s.value;return new se(h&f|p<<a&u,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>1/Math.sqrt(i)),r.typeInfo);const s=r;return new se(1/Math.sqrt(s.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V){let i=0;return r.value.forEach(o=>{i+=o*o}),new se(Math.sqrt(i),this.getTypeInfo("f32"))}const s=r;return new se(Math.abs(s.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.log(i)),r.typeInfo);const s=r;return new se(Math.log(s.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.log2(i)),r.typeInfo);const s=r;return new se(Math.log2(s.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V)return new V(r.value.map((a,u)=>Math.max(a,s.value[u])),r.typeInfo);const i=r,o=s;return new se(Math.max(i.value,o.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V)return new V(r.value.map((a,u)=>Math.min(a,s.value[u])),r.typeInfo);const i=r,o=s;return new se(Math.min(i.value,o.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof V&&s instanceof V&&i instanceof V)return new V(r.value.map((u,f)=>r.value[f]*(1-i.value[f])+s.value[f]*i.value[f]),r.typeInfo);const o=s,a=i;return new se(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V)return new V(r.value.map((o,a)=>o%s.value[a]),r.typeInfo);const i=s;return new se(r.value%i.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V){const s=this.Length(e,t).value;return new V(r.value.map(i=>i/s),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V)return new V(r.value.map((a,u)=>Math.pow(a,s.value[u])),r.typeInfo);const i=r,o=s;return new se(Math.pow(i.value,o.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof V?new V(r.value.map(s=>s),r.typeInfo):new se(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof V?new V(r.value.map(s=>s*Math.PI/180),r.typeInfo):new se(r.value*Math.PI/180,r.typeInfo)}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof V&&s instanceof V){const i=this._dot(r.value,s.value);return new V(r.value.map((o,a)=>o-2*i*s.value[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof V&&s instanceof V&&i instanceof se){const o=this._dot(s.value,r.value);return new V(r.value.map((a,u)=>{const f=1-i.value*i.value*(1-o*o);if(f<0)return 0;const h=Math.sqrt(f);return i.value*a-(i.value*o+h)*s.value[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.round(i)),r.typeInfo);const s=r;return new se(Math.round(s.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.min(Math.max(i,0),1)),r.typeInfo);const s=r;return new se(Math.min(Math.max(s.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.sign(i)),r.typeInfo);const s=r;return new se(Math.sign(s.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.sin(i)),r.typeInfo);const s=r;return new se(Math.sin(s.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.sinh(i)),r.typeInfo);const s=r;return new se(Math.sinh(s.value),r.typeInfo)}_smoothstep(e,t,r){const s=Math.min(Math.max((r-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(i instanceof V&&r instanceof V&&s instanceof V)return new V(i.value.map((f,h)=>this._smoothstep(r.value[h],s.value[h],f)),i.typeInfo);const o=r,a=s,u=i;return new se(this._smoothstep(o.value,a.value,u.value),i.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.sqrt(i)),r.typeInfo);const s=r;return new se(Math.sqrt(s.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof V&&r instanceof V)return new V(s.value.map((o,a)=>o<r.value[a]?0:1),s.typeInfo);const i=r;return new se(s.value<i.value?0:1,i.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.tan(i)),r.typeInfo);const s=r;return new se(Math.tan(s.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.tanh(i)),r.typeInfo);const s=r;return new se(Math.tanh(s.value),r.typeInfo)}_getTransposeType(e){const t=this.exec.getTypeName(e);return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof xt))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const i=r.value;return new xt([i[0],i[2],i[1],i[3]],s)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const i=r.value;return new xt([i[0],i[3],i[6],i[1],i[4],i[7]],s)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const i=r.value;return new xt([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13]],s)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const i=r.value;return new xt([i[0],i[3],i[1],i[4],i[2],i[5]],s)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const i=r.value;return new xt([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]],s)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const i=r.value;return new xt([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]],s)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const i=r.value;return new xt([i[0],i[4],i[1],i[5],i[2],i[6]],s)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const i=r.value;return new xt([i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]],s)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const i=r.value;return new xt([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]],s)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof V)return new V(r.value.map(i=>Math.trunc(i)),r.typeInfo);const s=r;return new se(Math.trunc(s.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0];if((e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(r instanceof co){const s=r.name,i=t.getVariableValue(s);return i instanceof an?new V(i.textureSize,this.getTypeInfo("vec2u")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t);if((e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(!(s instanceof V)||s.value.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof co){const i=r.name,o=t.getVariableValue(i);if(o instanceof an){const a=o.textureSize,u=Math.floor(s.value[0]),f=Math.floor(s.value[1]);if(u<0||u>=a[0]||f<0||f>=a[1])return console.error(`Texture ${i} out of bounds. Line ${e.line}`),null;const h=4*(f*a[0]+u),p=new Uint8Array(o.buffer,h,4);return new V([p[0]/255,p[1]/255,p[2]/255,p[3]/255],this.getTypeInfo("vec4f"))}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){return console.error("TODO: textureNumLayers"),null}TextureNumLevels(e,t){return console.error("TODO: textureNumLevels"),null}TextureNumSamples(e,t){return console.error("TODO: textureNumSamples"),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t).value;if(i.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof V)||s.value.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof co){const o=r.name,a=t.getVariableValue(o);if(a instanceof an){const u=a.textureSize,f=Math.floor(s.value[0]),h=Math.floor(s.value[1]);if(f<0||f>=u[0]||h<0||h>=u[1])return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const p=4*(h*u[0]+f),m=new Uint8Array(a.buffer,p,4);return m[0]=255*i[0],m[1]=255*i[1],m[2]=255*i[2],m[3]=255*i[3],null}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t);return t.getVariable(s).value.getDataValue(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t);return u instanceof se&&a instanceof se&&(u.value=a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t);return u instanceof se&&a instanceof se&&(u.value+=a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicSub(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t);return u instanceof se&&a instanceof se&&(u.value-=a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicMax(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=Math.max(u.value,a.value)),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicMin(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=Math.min(u.value,a.value)),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicAnd(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=u.value&a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicOr(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=u.value|a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicXor(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=u.value^a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicExchange(e,t){let r=e.args[0];r instanceof Ir&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=i.value.getDataValue(this.exec,r.postfix,t),f=new se(u.value,u.typeInfo);return u instanceof se&&a instanceof se&&(u.value=a.value),i.value instanceof an&&i.value.setDataValue(this.exec,u,r.postfix,t),f}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}function ke(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const Yd=new Float32Array(1),j7=new Uint32Array(Yd.buffer),W7=new Uint32Array(Yd.buffer),qd=new Int32Array(1),H7=new Float32Array(qd.buffer),X7=new Uint32Array(qd.buffer),Kd=new Uint32Array(1),Y7=new Float32Array(Kd.buffer),q7=new Int32Array(Kd.buffer);function ub(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Yd[0]=n,j7[0];if(t==="u32")return Yd[0]=n,W7[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return qd[0]=n,H7[0];if(t==="u32")return qd[0]=n,X7[0]}else if(e==="u32"){if(t==="f32")return Kd[0]=n,Y7[0];if(t==="i32"||t==="x32")return Kd[0]=n,q7[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class Yn extends z7{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new Ns,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new t1,this.builtins=new $7(this),this.typeInfo={bool:this.getTypeInfo(Se.bool),i32:this.getTypeInfo(Se.i32),u32:this.getTypeInfo(Se.u32),f32:this.getTypeInfo(Se.f32),f16:this.getTypeInfo(Se.f16),vec2f:this.getTypeInfo(de.vec2f),vec2u:this.getTypeInfo(de.vec2u),vec2i:this.getTypeInfo(de.vec2i),vec2h:this.getTypeInfo(de.vec2h),vec3f:this.getTypeInfo(de.vec3f),vec3u:this.getTypeInfo(de.vec3u),vec3i:this.getTypeInfo(de.vec3i),vec3h:this.getTypeInfo(de.vec3h),vec4f:this.getTypeInfo(de.vec4f),vec4u:this.getTypeInfo(de.vec4u),vec4i:this.getTypeInfo(de.vec4i),vec4h:this.getTypeInfo(de.vec4h),mat2x2f:this.getTypeInfo(de.mat2x2f),mat2x3f:this.getTypeInfo(de.mat2x3f),mat2x4f:this.getTypeInfo(de.mat2x4f),mat3x2f:this.getTypeInfo(de.mat3x2f),mat3x3f:this.getTypeInfo(de.mat3x3f),mat3x4f:this.getTypeInfo(de.mat3x4f),mat4x2f:this.getTypeInfo(de.mat4x2f),mat4x3f:this.getTypeInfo(de.mat4x3f),mat4x4f:this.getTypeInfo(de.mat4x4f)}}getVariableValue(e){var t,r;const s=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;return s===null?null:s instanceof se||s instanceof V||s instanceof xt?s.value:(console.error(`Unsupported return variable type ${s.typeInfo.name}`),null)}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,s){const i=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,i),this._execStatements(this.ast,i);const o=i.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],u=t[1],f=t[2],h=this.getTypeInfo("vec3u");i.setVariable("@num_workgroups",new V(t,h));for(const p in r)for(const m in r[p]){const v=r[p][m];i.variables.forEach(x=>{const w=x.node;if(w!=null&&w.attributes){let T=null,E=null;for(const C of w.attributes)C.name==="binding"?T=C.value:C.name==="group"&&(E=C.value);m==T&&p==E&&(v.texture!==void 0&&v.size!==void 0?x.value=new an(v.texture,this.getTypeInfo(w.type),0,v.size):v.uniform!==void 0?x.value=new an(v.uniform,this.getTypeInfo(w.type)):x.value=new an(v,this.getTypeInfo(w.type)))}})}for(let p=0;p<f;++p)for(let m=0;m<u;++m)for(let v=0;v<a;++v)i.setVariable("@workgroup_id",new V([v,m,p],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[v,m,p],i)}execStatement(e,t){if(e instanceof q4)return this.evalExpression(e.value,t);if(e instanceof Z4){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof se))throw new Error("Invalid break-if condition");if(!r.value)return null}return Yn._breakObj}if(e instanceof Q4)return Yn._continueObj;if(e instanceof Xd)this._let(e,t);else if(e instanceof Ji)this._var(e,t);else if(e instanceof m_)this._const(e,t);else if(e instanceof Hd)this._function(e,t);else{if(e instanceof Y4)return this._if(e,t);if(e instanceof X4)return this._switch(e,t);if(e instanceof $4)return this._for(e,t);if(e instanceof z4)return this._while(e,t);if(e instanceof H4)return this._loop(e,t);if(e instanceof g_){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof W4)this._assign(e,t);else if(e instanceof j4)this._increment(e,t);else{if(e instanceof Zi)return null;if(e instanceof Zy){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new se(0,this.getTypeInfo("u32")))}else if(e instanceof Qy)this._call(e,t);else{if(e instanceof K4||e instanceof Gy)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){for(;e instanceof hd;)e=e.contents[0];return e instanceof ls?this._evalBinaryOp(e,t):e instanceof on?this._evalLiteral(e,t):e instanceof co?this._evalVariable(e,t):e instanceof oc?this._evalCall(e,t):e instanceof ca?this._evalCreate(e,t):e instanceof J4?this._evalConst(e,t):e instanceof eA?this._evalBitcast(e,t):e instanceof Ir?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Se){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}const r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null?r:null}getTypeName(e){if(e===null)return console.error("Type is null."),"unknown";let t=e.name;if(e instanceof mo||e instanceof de){if(e.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(e.format.name==="f32")return t+="f",t;if(e.format.name==="i32")return t+="i",t;if(e.format.name==="u32")return t+="u",t;if(e.format.name==="bool")return t+="b",t;if(e.format.name==="f16")return t+="h",t}t+=`<${e.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t}return t}_setOverrides(e,t){for(const r in e){const s=e[r],i=this.reflection.getOverrideInfo(r);i!==null?i.type.name==="u32"||i.type.name==="i32"||i.type.name==="f32"||i.type.name==="f16"?t.setVariable(r,new se(s,i.type)):i.type.name==="bool"?t.setVariable(r,new se(s?1:0,i.type)):i.type.name==="vec2"||i.type.name==="vec3"||i.type.name==="vec4"||i.type.name==="vec2f"||i.type.name==="vec3f"||i.type.name==="vec4f"||i.type.name==="vec2i"||i.type.name==="vec3i"||i.type.name==="vec4i"||i.type.name==="vec2u"||i.type.name==="vec3u"||i.type.name==="vec4u"||i.type.name==="vec2h"||i.type.name==="vec3h"||i.type.name==="vec4h"?t.setVariable(r,new V(s,i.type)):console.error(`Invalid constant type for ${r}`):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const s=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const p=r.getVariableValue(h.value[0]);s[0]=p instanceof se?p.value:parseInt(h.value[0])}if(h.value.length>1){const p=r.getVariableValue(h.value[1]);s[1]=p instanceof se?p.value:parseInt(h.value[1])}if(h.value.length>2){const p=r.getVariableValue(h.value[2]);s[2]=p instanceof se?p.value:parseInt(h.value[2])}}const i=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new V(s,i));const a=s[0],u=s[1],f=s[2];for(let h=0,p=0;h<f;++h)for(let m=0;m<u;++m)for(let v=0;v<a;++v,++p){const x=[v,m,h],w=[v+t[0]*s[0],m+t[1]*s[1],h+t[2]*s[2]];r.setVariable("@local_invocation_id",new V(x,i)),r.setVariable("@global_invocation_id",new V(w,i)),r.setVariable("@local_invocation_index",new se(p,o)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const s of r.attributes)if(s.name==="builtin"){const i=`@${s.value}`,o=t.getVariable(i);o!==void 0&&t.variables.set(r.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){return e instanceof co?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const i=t.clone(),o=this._execStatements(r,i);if(o)return o;continue}const s=this.execStatement(r,t);if(s)return s}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let i=0;i<s.node.args.length;++i){const o=s.node.args[i],a=this.evalExpression(e.args[i],r);r.setVariable(o.name,a,o)}this._execStatements(s.node.body,r)}else this._callBuiltinFunction(e,r)}_increment(e,t){const r=this.getVariableName(e.variable,t),s=t.getVariable(r);s?e.operator==="++"?s.value instanceof se?s.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof se?s.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_assign(e,t){const r=this.getVariableName(e.variable,t),s=t.getVariable(r);if(s===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);const i=this.evalExpression(e.value,t),o=e.operator;if(o==="=")if(s.value instanceof an)s.value.setDataValue(this,i,e.variable.postfix,t);else if(e.variable.postfix){if(!(s.value instanceof V||s.value instanceof xt))return void console.error(`Variable ${s.name} is not a vector or matrix. Line ${e.line}`);if(e.variable.postfix instanceof ql){const a=this.evalExpression(e.variable.postfix.index,t).value;if(s.value instanceof V){if(!(i instanceof se))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[a]=i.value}else{if(!(s.value instanceof xt))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);{const u=this.evalExpression(e.variable.postfix.index,t).value;if(u<0)return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(!(i instanceof V))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);{const f=this.getTypeName(s.value.typeInfo);if(f==="mat2x2"||f==="mat2x2f"||f==="mat2x2h"){if(!(u<2&&i.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*u]=i.value[0],s.value.value[2*u+1]=i.value[1]}else if(f==="mat2x3"||f==="mat2x3f"||f==="mat2x3h"){if(!(u<2&&i.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*u]=i.value[0],s.value.value[3*u+1]=i.value[1],s.value.value[3*u+2]=i.value[2]}else if(f==="mat2x4"||f==="mat2x4f"||f==="mat2x4h"){if(!(u<2&&i.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*u]=i.value[0],s.value.value[4*u+1]=i.value[1],s.value.value[4*u+2]=i.value[2],s.value.value[4*u+3]=i.value[3]}else if(f==="mat3x2"||f==="mat3x2f"||f==="mat3x2h"){if(!(u<3&&i.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*u]=i.value[0],s.value.value[2*u+1]=i.value[1]}else if(f==="mat3x3"||f==="mat3x3f"||f==="mat3x3h"){if(!(u<3&&i.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*u]=i.value[0],s.value.value[3*u+1]=i.value[1],s.value.value[3*u+2]=i.value[2]}else if(f==="mat3x4"||f==="mat3x4f"||f==="mat3x4h"){if(!(u<3&&i.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*u]=i.value[0],s.value.value[4*u+1]=i.value[1],s.value.value[4*u+2]=i.value[2],s.value.value[4*u+3]=i.value[3]}else if(f==="mat4x2"||f==="mat4x2f"||f==="mat4x2h"){if(!(u<4&&i.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*u]=i.value[0],s.value.value[2*u+1]=i.value[1]}else if(f==="mat4x3"||f==="mat4x3f"||f==="mat4x3h"){if(!(u<4&&i.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*u]=i.value[0],s.value.value[3*u+1]=i.value[1],s.value.value[3*u+2]=i.value[2]}else{if(f!=="mat4x4"&&f!=="mat4x4f"&&f!=="mat4x4h")return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(!(u<4&&i.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*u]=i.value[0],s.value.value[4*u+1]=i.value[1],s.value.value[4*u+2]=i.value[2],s.value.value[4*u+3]=i.value[3]}}}}}else if(e.variable.postfix instanceof ma){const a=e.variable.postfix.value;if(!(s.value instanceof V))return void console.error(`Invalid assignment to ${a}. Variable ${s.name} is not a vector. Line ${e.line}`);if(i instanceof se){if(a.length>1)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);if(a==="x")s.value.value[0]=i.value;else if(a==="y"){if(s.value.value.length<2)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[1]=i.value}else if(a==="z"){if(s.value.value.length<3)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[2]=i.value}else if(a==="w"){if(s.value.value.length<4)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[3]=i.value}}else{if(!(i instanceof V))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(a.length!==i.value.length)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);for(let u=0;u<a.length;++u){const f=a[u];if(f==="x"||f==="r")s.value.value[0]=i.value[u];else if(f==="y"||f==="g"){if(i.value.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[1]=i.value[u]}else if(f==="z"||f==="b"){if(i.value.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[2]=i.value[u]}else{if(f!=="w"&&f!=="a")return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);if(i.value.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[3]=i.value[u]}}}}}else s.value=i;else{const a=s.value.getDataValue(this,e.variable.postfix,t);if(a instanceof V&&i instanceof se){const u=a.value,f=i.value;if(o==="+=")for(let h=0;h<u.length;++h)u[h]+=f;else if(o==="-=")for(let h=0;h<u.length;++h)u[h]-=f;else if(o==="*=")for(let h=0;h<u.length;++h)u[h]*=f;else if(o==="/=")for(let h=0;h<u.length;++h)u[h]/=f;else if(o==="%=")for(let h=0;h<u.length;++h)u[h]%=f;else if(o==="&=")for(let h=0;h<u.length;++h)u[h]&=f;else if(o==="|=")for(let h=0;h<u.length;++h)u[h]|=f;else if(o==="^=")for(let h=0;h<u.length;++h)u[h]^=f;else if(o==="<<=")for(let h=0;h<u.length;++h)u[h]<<=f;else if(o===">>=")for(let h=0;h<u.length;++h)u[h]>>=f;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(a instanceof V&&i instanceof V){const u=a.value,f=i.value;if(u.length!==f.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let h=0;h<u.length;++h)u[h]+=f[h];else if(o==="-=")for(let h=0;h<u.length;++h)u[h]-=f[h];else if(o==="*=")for(let h=0;h<u.length;++h)u[h]*=f[h];else if(o==="/=")for(let h=0;h<u.length;++h)u[h]/=f[h];else if(o==="%=")for(let h=0;h<u.length;++h)u[h]%=f[h];else if(o==="&=")for(let h=0;h<u.length;++h)u[h]&=f[h];else if(o==="|=")for(let h=0;h<u.length;++h)u[h]|=f[h];else if(o==="^=")for(let h=0;h<u.length;++h)u[h]^=f[h];else if(o==="<<=")for(let h=0;h<u.length;++h)u[h]<<=f[h];else if(o===">>=")for(let h=0;h<u.length;++h)u[h]>>=f[h];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(a instanceof se&&i instanceof se))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?a.value+=i.value:o==="-="?a.value-=i.value:o==="*="?a.value*=i.value:o==="/="?a.value/=i.value:o==="%="?a.value%=i.value:o==="&="?a.value&=i.value:o==="|="?a.value|=i.value:o==="^="?a.value^=i.value:o==="<<="?a.value<<=i.value:o===">>="?a.value>>=i.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}s.value instanceof an&&s.value.setDataValue(this,a,e.variable.postfix,t)}}_function(e,t){const r=new e1(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!=null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;e.value!=null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null)r=this.evalExpression(e.value,t);else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);if(e.type.name==="f32"||e.type.name==="i32"||e.type.name==="u32"||e.type.name==="bool"||e.type.name==="f16"||e.type.name==="vec2"||e.type.name==="vec3"||e.type.name==="vec4"||e.type.name==="vec2f"||e.type.name==="vec3f"||e.type.name==="vec4f"||e.type.name==="vec2i"||e.type.name==="vec3i"||e.type.name==="vec4i"||e.type.name==="vec2u"||e.type.name==="vec3u"||e.type.name==="vec4u"||e.type.name==="vec2h"||e.type.name==="vec3h"||e.type.name==="vec4h"||e.type.name==="mat2x2"||e.type.name==="mat2x3"||e.type.name==="mat2x4"||e.type.name==="mat3x2"||e.type.name==="mat3x3"||e.type.name==="mat3x4"||e.type.name==="mat4x2"||e.type.name==="mat4x3"||e.type.name==="mat4x4"||e.type.name==="mat2x2f"||e.type.name==="mat2x3f"||e.type.name==="mat2x4f"||e.type.name==="mat3x2f"||e.type.name==="mat3x3f"||e.type.name==="mat3x4f"||e.type.name==="mat4x2f"||e.type.name==="mat4x3f"||e.type.name==="mat4x4f"||e.type.name==="mat2x2h"||e.type.name==="mat2x3h"||e.type.name==="mat2x4h"||e.type.name==="mat3x2h"||e.type.name==="mat3x3h"||e.type.name==="mat3x4h"||e.type.name==="mat4x2h"||e.type.name==="mat4x3h"||e.type.name==="mat4x4h"){const s=new ca(e.type,[]);r=this._evalCreate(s,t)}if(e.type.name==="array"){const s=new ca(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof se))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const i of e.cases)if(i instanceof rA)for(const o of i.selectors){if(o instanceof dd){s=i;continue}const a=this.evalExpression(o,t);if(!(a instanceof se))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(i.body,t)}else i instanceof sA&&(s=i);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof se))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const s of e.elseif){const i=this.evalExpression(s.condition,t);if(!(i instanceof se))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof se?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Yn._breakObj)break;if(r!==null&&r!==Yn._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===Yn._breakObj)break;if(r===Yn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Yn._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Yn._breakObj)break;if(r!==Yn._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),s=e.type;if(r instanceof se){const i=ub(r.value,r.typeInfo.name,s.name);return new se(i,this.getTypeInfo(s))}if(r instanceof V){const i=this.getTypeName(r.typeInfo);let o="";if(i.endsWith("f"))o="f32";else if(i.endsWith("i"))o="i32";else if(i.endsWith("u"))o="u32";else if(i.endsWith("b"))o="bool";else{if(!i.endsWith("h"))return console.error(`Unknown vector type ${i}. Line ${e.line}`),null;o="f16"}const a=this.getTypeName(s);let u="";if(a.endsWith("f"))u="f32";else if(a.endsWith("i"))u="i32";else if(a.endsWith("u"))u="u32";else if(a.endsWith("b"))u="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const f=function(h,p,m){if(p===m)return h;const v=new Array(h.length);for(let x=0;x<h.length;x++)v[x]=ub(h[x],p,m);return v}(r.value,o,u);return new V(f,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){const r=t.getVariableValue(e.name);return e.postfix?r.getDataValue(this,e.postfix,t):r}_evalCreate(e,t){var r;if(e.type===null)return v_.void;const s=this.getTypeName(e.type);switch(s){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}const i=this.getTypeInfo(e.type);if(i===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(i.size===0)return null;const o=new an(new ArrayBuffer(i.size),i,0);if(i instanceof so){if(e.args)for(let a=0;a<e.args.length;++a){const u=i.members[a],f=e.args[a],h=this.evalExpression(f,t);o.setData(this,h,u.type,u.offset,t)}}else if(i instanceof la){let a=0;if(e.args)for(let u=0;u<e.args.length;++u){const f=e.args[u],h=this.evalExpression(f,t);i.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?i.format=this.getTypeInfo("i32"):i.format=h.typeInfo),o.setData(this,h,i.format,a,t),a+=i.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return o}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),s=r.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new se(e.scalarValue,r):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:e!=null&&e.postfix?r.getDataValue(this,e.postfix,t):r}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=Yn._priority.get(t.name);Yn._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t),s=r instanceof se||r instanceof V?r.value:null;switch(e.operator){case"+":{if(ke(s)){const a=s.map((u,f)=>+u);return new V(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new se(+i,o)}case"-":{if(ke(s)){const a=s.map((u,f)=>-u);return new V(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new se(-i,o)}case"!":{if(ke(s)){const a=s.map((u,f)=>u?0:1);return new V(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new se(i?0:1,o)}case"~":{if(ke(s)){const a=s.map((u,f)=>~u);return new V(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new se(~i,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),i=r instanceof se||r instanceof V||r instanceof xt?r.value:null,o=s instanceof se||s instanceof V||s instanceof xt?s.value:null;switch(e.operator){case"+":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v+p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m+h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h+m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a+u,f)}case"-":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v-p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m-h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h-m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a-u,f)}case"*":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v*p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m*h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h*m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a*u,f)}case"%":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v%p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m%h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h%m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a%u,f)}case"/":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v/p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m/h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h/m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a/u,f)}case"&":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v&p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m&h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h&m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a&u,f)}case"|":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v|p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m|h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h|m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a|u,f)}case"^":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v^p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m^h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h^m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a^u,f)}case"<<":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v<<p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m<<h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h<<m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a<<u,f)}case">>":{if(ke(i)&&ke(o)){const h=i,p=o;if(h.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=h.map((v,x)=>v>>p[x]);return new V(m,r.typeInfo)}if(ke(i)){const h=o,p=i.map((m,v)=>m>>h);return new V(p,r.typeInfo)}if(ke(o)){const h=i,p=o.map((m,v)=>h>>m);return new V(p,s.typeInfo)}const a=i,u=o,f=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new se(a>>u,f)}case">":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h>u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f>a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a>f?1:0);return new V(u,s.typeInfo)}return new se(i>o?1:0,this.getTypeInfo("bool"));case"<":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h<u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f<a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a<f?1:0);return new V(u,s.typeInfo)}return new se(i<o?1:0,this.getTypeInfo("bool"));case"==":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h===u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f==a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a==f?1:0);return new V(u,s.typeInfo)}return new se(i===o?1:0,this.getTypeInfo("bool"));case"!=":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h!==u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f!==a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a!==f?1:0);return new V(u,s.typeInfo)}return new se(i!==o?1:0,this.getTypeInfo("bool"));case">=":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h>=u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f>=a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a>=f?1:0);return new V(u,s.typeInfo)}return new se(i>=o?1:0,this.getTypeInfo("bool"));case"<=":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h<=u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f<=a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a<=f?1:0);return new V(u,s.typeInfo)}return new se(i<=o?1:0,this.getTypeInfo("bool"));case"&&":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h&&u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f&&a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a&&f?1:0);return new V(u,s.typeInfo)}return new se(i&&o?1:0,this.getTypeInfo("bool"));case"||":if(ke(i)&&ke(o)){const a=i,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((h,p)=>h||u[p]?1:0);return new V(f,r.typeInfo)}if(ke(i)){const a=o,u=i.map((f,h)=>f||a?1:0);return new V(u,r.typeInfo)}if(ke(o)){const a=i,u=o.map((f,h)=>a||f?1:0);return new V(u,s.typeInfo)}return new se(i||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return this._callBuiltinFunction(e,r);for(let i=0;i<s.node.args.length;++i){const o=s.node.args[i],a=this.evalExpression(e.args[i],r);r.createVariable(o.name,a,o)}return this._execStatements(s.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const s=t.clone();for(let i=0;i<r.node.args.length;++i){const o=r.node.args[i],a=this.evalExpression(e.args[i],s);s.setVariable(o.name,a,o)}return this._execStatements(r.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new se(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),s=this.getTypeName(e.type),i={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4}[s];if(i===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const o=s.endsWith("i")||s.endsWith("u"),a=[];if(e instanceof on)if(e.isVector){const u=e.vectorValue;for(const f of u)a.push(f)}else a.push(e.scalarValue);else if(e.args)for(const u of e.args){const f=this.evalExpression(u,t);if(f instanceof V){const h=f.value;for(let p=0;p<h.length;++p){let m=h[p];o&&(m=Math.floor(m)),a.push(m)}}else if(f instanceof se){let h=f.value;o&&(h=Math.floor(h)),a.push(h)}}if(e.type instanceof de&&e.type.format===null&&(e.type.format=de.f32),a.length===0){const u=new Array(i).fill(0);return new V(u,r)}if(a.length===1)for(;a.length<i;)a.push(a[0]);return a.length<i?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new V(a.length>i?a.slice(0,i):a,r)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),s=this.getTypeName(e.type),i={mat2x2:4,mat2x2f:4,mat2x2h:4,mat2x3:6,mat2x3f:6,mat2x3h:6,mat2x4:8,mat2x4f:8,mat2x4h:8,mat3x2:6,mat3x2f:6,mat3x2h:6,mat3x3:9,mat3x3f:9,mat3x3h:9,mat3x4:12,mat3x4f:12,mat3x4h:12,mat4x2:8,mat4x2f:8,mat4x2h:8,mat4x3:12,mat4x3f:12,mat4x3h:12,mat4x4:16,mat4x4f:16,mat4x4h:16}[s];if(i===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const o=[];if(e instanceof on)if(e.isVector){const a=e.vectorValue;for(const u of a)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const u=this.evalExpression(a,t);if(u instanceof V){const f=u.value;for(let h=0;h<f.length;++h)o.push(f[h])}else u instanceof se?o.push(u.value):u instanceof xt&&o.push(...u.value)}if(r instanceof mo&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(i).fill(0);return new xt(a,r)}return o.length!==i?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new xt(o,r)}}Yn._breakObj=new va(new ds("BREAK",null)),Yn._continueObj=new va(new ds("CONTINUE",null)),Yn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class K7{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new P7,this._exec=new Yn}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const s=r.arrayType,i=r.countNode;if(i instanceof co){const o=i.name,a=this._context.constants.get(o);if(a)try{const u=a.constEvaluate(this._exec);s.count=u}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new U7(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==D.eof}_match(e){if(e instanceof J)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let s=!1;for(const i of e){if(r===i)return!0;i===D.tokens.name&&(s=!0)}if(s){const i=D.tokens.name.rule.exec(t.lexeme);if(i&&i.index==0&&i[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===D.tokens.name){const r=D.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(D.tokens.semicolon)&&!this._isAtEnd(););if(this._match(D.keywords.alias)){const t=this._type_alias();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.diagnostic)){const t=this._diagnostic();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.requires)){const t=this._requires_directive();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.enable)){const t=this._enable_directive();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(D.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(D.keywords.fn))return null;const e=this._currentLine,t=this._consume(D.tokens.ident,"Expected function name.").toString();this._consume(D.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(D.tokens.paren_right))do{if(this._check(D.tokens.paren_right))break;const a=this._attribute(),u=this._consume(D.tokens.name,"Expected argument name.").toString();this._consume(D.tokens.colon,"Expected ':' for argument type.");const f=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=f,r.push(this._updateNode(new D7(u,h,a))))}while(this._match(D.tokens.comma));this._consume(D.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(D.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const i=this._compound_statement(),o=this._currentLine;return this._updateNode(new Hd(t,r,s,i,e,o),e)}_compound_statement(){const e=[];for(this._consume(D.tokens.brace_left,"Expected '{' for block.");!this._check(D.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(D.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(D.tokens.semicolon)&&!this._isAtEnd(););if(this._check(D.tokens.attr)&&this._attribute(),this._check(D.keywords.if))return this._if_statement();if(this._check(D.keywords.switch))return this._switch_statement();if(this._check(D.keywords.loop))return this._loop_statement();if(this._check(D.keywords.for))return this._for_statement();if(this._check(D.keywords.while))return this._while_statement();if(this._check(D.keywords.continuing))return this._continuing_statement();if(this._check(D.keywords.static_assert))return this._static_assert_statement();if(this._check(D.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(D.keywords.return))e=this._return_statement();else if(this._check([D.keywords.var,D.keywords.let,D.keywords.const]))e=this._variable_statement();else if(this._match(D.keywords.discard))e=this._updateNode(new O7);else if(this._match(D.keywords.break)){const t=this._updateNode(new Z4);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(D.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression(),t.condition instanceof hd&&t.condition.contents.length===1&&(t.condition=t.condition.contents[0]))}else if(this._match(D.keywords.continue)){const t=this._updateNode(new Q4);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(D.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(D.keywords.static_assert))return null;const e=this._optional_paren_expression();return this._updateNode(new I7(e))}_while_statement(){if(!this._match(D.keywords.while))return null;const e=this._updateNode(new z4(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(D.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){if(!this._match(D.keywords.continuing))return null;const e=this._compound_statement();return this._updateNode(new g_(e))}_for_statement(){if(!this._match(D.keywords.for))return null;this._consume(D.tokens.paren_left,"Expected '('.");const e=this._updateNode(new $4(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(D.tokens.semicolon)?null:this._for_init(),this._consume(D.tokens.semicolon,"Expected ';'."),e.condition=this._check(D.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(D.tokens.semicolon,"Expected ';'."),e.increment=this._check(D.tokens.paren_right)?null:this._for_increment(),this._consume(D.tokens.paren_right,"Expected ')'."),this._check(D.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(D.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(D.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Ji(e.name,e.type,e.storage,e.access,t))}if(this._match(D.keywords.let)){const e=this._consume(D.tokens.name,"Expected name for let.").toString();let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}this._consume(D.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new Xd(e,t,null,null,r))}if(this._match(D.keywords.const)){const e=this._consume(D.tokens.name,"Expected name for const.").toString();let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}this._consume(D.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return t===null&&r instanceof on&&(t=r.type),this._updateNode(new m_(e,t,null,null,r))}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(D.increment_operators))return this._current=e,null;const r=this._consume(D.increment_operators,"Expected increment operator");return this._updateNode(new j4(r.type===D.tokens.plus_plus?bl.increment:bl.decrement,t))}_assignment_statement(){let e=null;if(this._check(D.tokens.brace_right))return null;let t=this._match(D.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const r=this._consume(D.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new W4(ou.parse(r.lexeme),e,s))}_func_call_statement(){if(!this._check(D.tokens.ident))return null;const e=this._current,t=this._consume(D.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):this._updateNode(new Qy(t.lexeme,r))}_loop_statement(){if(!this._match(D.keywords.loop))return null;this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new H4([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof g_){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(D.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(D.keywords.switch))return null;const e=this._updateNode(new X4(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(D.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([D.keywords.default,D.keywords.case]);){if(this._match(D.keywords.case)){const r=this._case_selectors();for(const i of r)if(i instanceof dd){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(D.tokens.colon),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(D.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new rA(r,s)))}if(this._match(D.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(D.tokens.colon),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(D.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new sA(r)))}}return e}_case_selectors(){const e=[];for(this._match(D.keywords.default)?e.push(this._updateNode(new dd)):e.push(this._shift_expression());this._match(D.tokens.comma);)this._match(D.keywords.default)?e.push(this._updateNode(new dd)):e.push(this._shift_expression());return e}_case_body(){if(this._match(D.keywords.fallthrough))return this._consume(D.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(D.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(D.tokens.attr)&&this._attribute();const r=this._compound_statement();let s=[];this._match_elseif()&&(this._check(D.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let i=null;return this._match(D.keywords.else)&&(this._check(D.tokens.attr)&&this._attribute(),i=this._compound_statement()),this._updateNode(new Y4(t,r,s,i),e)}_match_elseif(){return this._tokens[this._current].type===D.keywords.else&&this._tokens[this._current+1].type===D.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new L7(t,r))),this._match_elseif()&&(this._check(D.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(D.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new q4(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(D.tokens.or_or);)e=this._updateNode(new ls(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(D.tokens.and_and);)e=this._updateNode(new ls(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(D.tokens.or);)e=this._updateNode(new ls(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(D.tokens.xor);)e=this._updateNode(new ls(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(D.tokens.and);)e=this._updateNode(new ls(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([D.tokens.equal_equal,D.tokens.not_equal])?this._updateNode(new ls(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([D.tokens.less_than,D.tokens.greater_than,D.tokens.less_than_equal,D.tokens.greater_than_equal]);)e=this._updateNode(new ls(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([D.tokens.shift_left,D.tokens.shift_right]);)e=this._updateNode(new ls(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([D.tokens.plus,D.tokens.minus]);)e=this._updateNode(new ls(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([D.tokens.star,D.tokens.forward_slash,D.tokens.modulo]);)e=this._updateNode(new ls(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([D.tokens.minus,D.tokens.bang,D.tokens.tilde,D.tokens.star,D.tokens.and])?this._updateNode(new Ir(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(D.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(D.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new ql(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(D.tokens.period)){const e=this._consume(D.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new ma(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"bool":return Se.bool;case"i32":return Se.i32;case"u32":return Se.u32;case"f32":return Se.f32;case"f16":return Se.f16;case"vec2f":return de.vec2f;case"vec3f":return de.vec3f;case"vec4f":return de.vec4f;case"vec2i":return de.vec2i;case"vec3i":return de.vec3i;case"vec4i":return de.vec4i;case"vec2u":return de.vec2u;case"vec3u":return de.vec3u;case"vec4u":return de.vec4u;case"vec2h":return de.vec2h;case"vec3h":return de.vec3h;case"vec4h":return de.vec4h;case"mat2x2f":return de.mat2x2f;case"mat2x3f":return de.mat2x3f;case"mat2x4f":return de.mat2x4f;case"mat3x2f":return de.mat3x2f;case"mat3x3f":return de.mat3x3f;case"mat3x4f":return de.mat3x4f;case"mat4x2f":return de.mat4x2f;case"mat4x3f":return de.mat4x3f;case"mat4x4f":return de.mat4x4f;case"mat2x2h":return de.mat2x2h;case"mat2x3h":return de.mat2x3h;case"mat2x4h":return de.mat2x4h;case"mat3x2h":return de.mat3x2h;case"mat3x3h":return de.mat3x3h;case"mat3x4h":return de.mat3x4h;case"mat4x2h":return de.mat4x2h;case"mat4x3h":return de.mat4x3h;case"mat4x4h":return de.mat4x4h}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(D.tokens.ident)){const r=this._previous().toString();if(this._check(D.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getType(r);return i!==null?this._updateNode(new ca(i,s)):this._updateNode(new oc(r,s))}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return this._updateNode(new J4(r,s.value))}return this._updateNode(new co(r))}if(this._match(D.tokens.int_literal)){const r=this._previous().toString();let s=r.endsWith("i")||r.endsWith("i")?Se.i32:r.endsWith("u")||r.endsWith("U")?Se.u32:Se.x32;const i=parseInt(r);return this._validateTypeRange(i,s),this._updateNode(new on(new se(i,this._exec.getTypeInfo(s)),s))}if(this._match(D.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,Se.u32),this._updateNode(new on(new se(r,this._exec.getTypeInfo(Se.u32)),Se.u32))}if(this._match([D.tokens.decimal_float_literal,D.tokens.hex_float_literal])){let r=this._previous().toString(),s=r.endsWith("h");s&&(r=r.substring(0,r.length-1));const i=parseFloat(r);this._validateTypeRange(i,s?Se.f16:Se.f32);const o=s?Se.f16:Se.f32;return this._updateNode(new on(new se(i,this._exec.getTypeInfo(o)),o))}if(this._match([D.keywords.true,D.keywords.false])){let r=this._previous().toString()===D.keywords.true.rule;return this._updateNode(new on(new se(r?1:0,this._exec.getTypeInfo(Se.bool)),Se.bool))}if(this._check(D.tokens.paren_left))return this._paren_expression();if(this._match(D.keywords.bitcast)){this._consume(D.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(D.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new eA(r,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ca(e,t))}_argument_expression_list(){if(!this._match(D.tokens.paren_left))return null;const e=[];do{if(this._check(D.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(D.tokens.comma));return this._consume(D.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(D.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(D.tokens.paren_right),this._updateNode(new hd([e]))}_paren_expression(){this._consume(D.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(D.tokens.paren_right,"Expected ')'."),this._updateNode(new hd([e]))}_struct_decl(){if(!this._match(D.keywords.struct))return null;const e=this._currentLine,t=this._consume(D.tokens.ident,"Expected name for struct.").toString();this._consume(D.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(D.tokens.brace_right);){const o=this._attribute(),a=this._consume(D.tokens.name,"Expected variable name.").toString();this._consume(D.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=u),this._check(D.tokens.brace_right)?this._match(D.tokens.comma):this._consume(D.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new F7(a,f,o)))}this._consume(D.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,i=this._updateNode(new Zi(t,r,e,s),e);return this._context.structs.set(t,i),i}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(D.tokens.equal)){const t=this._const_expression(),r=[Se.f32];try{const s=t.constEvaluate(this._exec,r);e.value=new on(s,r[0]),this._exec.context.setVariable(e.name,s)}catch{e.value=t}}else{const t=new ca(e.type,null),r=this._exec.evalExpression(t,this._exec.context);r!==null&&(e.value=new on(r,e.type),this._exec.context.setVariable(e.name,r))}if(e.type!==null&&e.value instanceof on){if(e.value.type.name!=="x32"&&this._exec.getTypeName(e.type)!==this._exec.getTypeName(e.value.type))throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof on&&(e.type=e.value.type.name==="x32"?Se.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(D.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(D.keywords.const))return null;const t=this._consume(D.tokens.name,"Expected variable name");let r=null;if(this._match(D.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}let s=null;this._consume(D.tokens.equal,"const declarations require an assignment");const i=this._short_circuit_or_expression();try{let a=[Se.f32];const u=i.constEvaluate(this._exec,a);u instanceof se&&this._validateTypeRange(u.value,a[0]),a[0]instanceof de&&a[0].format===null&&u.typeInfo instanceof mo&&u.typeInfo.format!==null&&(u.typeInfo.format.name==="f16"?a[0].format=Se.f16:u.typeInfo.format.name==="f32"?a[0].format=Se.f32:u.typeInfo.format.name==="i32"?a[0].format=Se.i32:u.typeInfo.format.name==="u32"?a[0].format=Se.u32:u.typeInfo.format.name==="bool"?a[0].format=Se.bool:console.error(`TODO: impelement template format type ${u.typeInfo.format.name}`)),s=this._updateNode(new on(u,a[0])),this._exec.context.setVariable(t.toString(),u)}catch{s=i}if(r!==null&&s instanceof on){if(s.type.name!=="x32"&&this._exec.getTypeName(r)!==this._exec.getTypeName(s.type))throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else r===null&&s instanceof on&&(r=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:Se.f32,r===Se.x32&&(r=Se.i32));const o=this._updateNode(new m_(t.toString(),r,"","",s));return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(D.keywords.let))return null;const e=this._consume(D.tokens.name,"Expected variable name");let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}let r=null;if(this._match(D.tokens.equal)){r=this._const_expression();const s=[Se.f32];try{const i=r.constEvaluate(this._exec,s);i!==null&&(r=new on(i,s[0]))}catch{}}if(t!==null&&r instanceof on){if(r.type.name!=="x32"&&this._exec.getTypeName(t)!==this._exec.getTypeName(r.type))throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${t.name}. Line:${this._currentLine}`);r.type=t}else t===null&&r instanceof on&&(t=r.type.name==="x32"?Se.i32:r.type);return r instanceof on&&r.isScalar&&this._validateTypeRange(r.scalarValue,t),this._updateNode(new Xd(e.toString(),t,"","",r))}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(D.keywords.var))return null;let e="",t="";this._match(D.tokens.less_than)&&(e=this._consume(D.storage_class,"Expected storage_class.").toString(),this._match(D.tokens.comma)&&(t=this._consume(D.access_mode,"Expected access_mode.").toString()),this._consume(D.tokens.greater_than,"Expected '>'."));const r=this._consume(D.tokens.name,"Expected variable name");let s=null;if(this._match(D.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}return this._updateNode(new Ji(r.toString(),s,e,t,null))}_override_decl(){if(!this._match(D.keywords.override))return null;const e=this._consume(D.tokens.name,"Expected variable name");let t=null;if(this._match(D.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new Zy(e.toString(),t,null))}_diagnostic(){this._consume(D.tokens.paren_left,"Expected '('");const e=this._consume(D.tokens.ident,"Expected severity control name.");this._consume(D.tokens.comma,"Expected ','");let t=this._consume(D.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(D.tokens.period)&&(t+=`.${this._consume(D.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(D.tokens.paren_right,"Expected ')'"),this._updateNode(new K4(e.toString(),t))}_enable_directive(){const e=this._consume(D.tokens.ident,"identity expected.");return this._updateNode(new M7(e.toString()))}_requires_directive(){const e=[this._consume(D.tokens.ident,"identity expected.").toString()];for(;this._match(D.tokens.comma);){const t=this._consume(D.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new k7(e))}_type_alias(){const e=this._consume(D.tokens.ident,"identity expected.");this._consume(D.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new Gy(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([D.tokens.ident,...D.texel_format,D.keywords.bool,D.keywords.f32,D.keywords.i32,D.keywords.u32])){const r=this._advance(),s=r.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:this._updateNode(new Se(r.toString()))}let e=this._texture_sampler_types();if(e)return e;if(this._check(D.template_types)){let r=this._advance().toString(),s=null,i=null;return this._match(D.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(D.tokens.comma)&&(i=this._consume(D.access_mode,"Expected access_mode for pointer").toString()),this._consume(D.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new de(r,s,i))}if(this._match(D.keywords.ptr)){let r=this._previous().toString();this._consume(D.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(D.storage_class,"Expected storage_class for pointer");this._consume(D.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(D.tokens.comma)&&(o=this._consume(D.access_mode,"Expected access_mode for pointer").toString()),this._consume(D.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new N7(r,s.toString(),i,o))}const t=this._attribute();if(this._match(D.keywords.array)){let r=null,s=-1;const i=this._previous();let o=null;if(this._match(D.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(D.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(D.tokens.greater_than,"Expected '>' for array."),s=u?parseInt(u):0}const a=this._updateNode(new G4(i.toString(),t,r,s));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(D.sampler_type))return this._updateNode(new au(this._previous().toString(),null,null));if(this._match(D.depth_texture_type))return this._updateNode(new au(this._previous().toString(),null,null));if(this._match(D.sampled_texture_type)||this._match(D.multisampled_texture_type)){const e=this._previous();this._consume(D.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(D.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new au(e.toString(),t,null))}if(this._match(D.storage_texture_type)){const e=this._previous();this._consume(D.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(D.texel_format,"Invalid texel format.").toString();this._consume(D.tokens.comma,"Expected ',' after texel format.");const r=this._consume(D.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(D.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new au(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(D.tokens.attr);){const t=this._consume(D.attribute_name,"Expected attribute name"),r=this._updateNode(new B7(t.toString(),null));if(this._match(D.tokens.paren_left)){if(r.value=this._consume(D.literal_or_ident,"Expected attribute value").toString(),this._check(D.tokens.comma)){this._advance();do{const s=this._consume(D.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(D.tokens.comma))}this._consume(D.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Z7 extends Ns{constructor(e){super(),e&&this.update(e)}update(e){const t=new K7().parse(e);this.updateAST(t)}}function Q7(n){var i;const e={attributes:[],bindings:[]};let t;try{t=G7(n)}catch(o){return Ce.error(o.message)(),e}for(const o of t.uniforms){const a=[];for(const u of((i=o.type)==null?void 0:i.members)||[])a.push({name:u.name,type:fb(u.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=t.entry.vertex[0],s=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<s;o++){const a=r.inputs[o];if(a.locationType==="location"){const u=fb(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:u})}}return e}function fb(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function G7(n){try{return new Z7(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const J7=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,e9={name:"fp32",vs:J7},t9=[0,1,1,1],n9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,r9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,hb={name:"picking",vs:n9,fs:r9,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:t9},getUniforms:s9};function s9(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,s=>s/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}function oA(n,e=[],t=0){const r=Math.fround(n),s=n-r;return e[t]=r,e[t+1]=s,e}function i9(n){return n-Math.fround(n)}function o9(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const s=t*4+r;oA(n[r*4+t],e,s*2)}return e}const a9=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,l9={ONE:1};function c9(){return l9}const u9={name:"fp64-arithmetic",vs:a9,getUniforms:c9,fp64ify:oA,fp64LowPart:i9,fp64ifyMatrix4:o9},db=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,f9={lightSources:{}};function U0(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/255)}function h9({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};return n?r["lighting_uAmbientLight.color"]=U0(n):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,i)=>{r[`lighting_uPointLight[${i}].color`]=U0(s),r[`lighting_uPointLight[${i}].position`]=s.position,r[`lighting_uPointLight[${i}].attenuation`]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,t.forEach((s,i)=>{r[`lighting_uDirectionalLight[${i}].color`]=U0(s),r[`lighting_uDirectionalLight[${i}].direction`]=s.direction}),r.lighting_uDirectionalLightCount=t.length,r}function aA(n=f9){var e,t;if("lightSources"in n){const{ambientLight:r,pointLights:s,directionalLights:i}=n.lightSources||{};return r||s&&s.length>0||i&&i.length>0?Object.assign({},h9({ambientLight:r,pointLights:s,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in n){const r={pointLights:[],directionalLights:[]};for(const s of n.lights||[])switch(s.type){case"ambient":r.ambientLight=s;break;case"directional":(e=r.directionalLights)==null||e.push(s);break;case"point":(t=r.pointLights)==null||t.push(s);break}return aA({lightSources:r})}return{}}const d9={name:"lights",vs:db,fs:db,getUniforms:aA,defines:{MAX_LIGHTS:3}},p9=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,g9={};function m9(n){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:s=[30,30,30]}=n;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:s.map(i=>i/255)}}function v9(n=g9){if(!("material"in n))return{};const{material:e}=n;return e?m9(e):{lighting_uEnabled:!1}}const _9={name:"gouraud-lighting",dependencies:[d9],vs:p9,defines:{LIGHTING_VERTEX:1},getUniforms:v9},lA="#define SMOOTH_EDGE_RADIUS 0.5",y9=`
${lA}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,x9=`
${lA}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,w9={name:"geometry",vs:y9,fs:x9},et={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(et,"IDENTITY",{get:()=>(ut.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const us={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},vo={common:0,meters:1,pixels:2},__={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},b9=Object.keys(et).map(n=>`const int COORDINATE_SYSTEM_${n} = ${et[n]};`).join(""),T9=Object.keys(us).map(n=>`const int PROJECTION_MODE_${n} = ${us[n]};`).join(""),S9=Object.keys(vo).map(n=>`const int UNIT_${n.toUpperCase()} = ${vo[n]};`).join(""),E9=`${b9}
${T9}
${S9}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function A9(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function mf(n){let e={},t;return r=>{for(const s in r)if(!A9(r[s],e[s])){t=n(r),e=r;break}return t}}const pb=[0,0,0,0],R9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],cA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],C9=[0,0,0],uA=[0,0,0],P9=mf(k9);function fA(n,e,t=uA){t.length<3&&(t=[t[0],t[1],0]);let r=t,s,i=!0;switch(e===et.LNGLAT_OFFSETS||e===et.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case us.WEB_MERCATOR:(e===et.LNGLAT||e===et.CARTESIAN)&&(s=[0,0,0],i=!1);break;case us.WEB_MERCATOR_AUTO_OFFSET:e===et.LNGLAT?r=s:e===et.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case us.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case us.GLOBE:i=!1,s=null;break;default:i=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:i}}function I9(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:s}=n;let{viewMatrix:i,viewProjectionMatrix:o}=n,a=pb,u=pb,f=n.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:p,offsetMode:m}=fA(n,e,t);return m&&(u=n.projectPosition(h||p),f=[f[0]-u[0],f[1]-u[1],f[2]-u[2]],u[3]=1,a=sc([],u,o),i=r||i,o=oa([],s,i),o=oa([],o,R9)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:u,cameraPosCommon:f,shaderCoordinateOrigin:p,geospatialOrigin:h}}function M9({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=et.DEFAULT,coordinateOrigin:s=uA,autoWrapLongitude:i=!1}){r===et.DEFAULT&&(r=n.isGeospatial?et.LNGLAT:et.CARTESIAN);const o=P9({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return o.project_uWrapLongitude=i,o.project_uModelMatrix=t||cA,o}function k9({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:u,geospatialOrigin:f}=I9(n,t,r),h=n.getDistanceScales(),p=[n.width*e,n.height*e],m=sc([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={project_uCoordinateSystem:t,project_uProjectionMode:n.projectionMode,project_uCoordinateOrigin:u,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!n._pseudoMeters,project_uViewportSize:p,project_uDevicePixelRatio:e,project_uFocalDistance:m,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:C9,project_uScale:n.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:i,project_uModelMatrix:cA,project_uCameraPosition:a};if(f){const x=n.getDistanceScales(f);switch(t){case et.METER_OFFSETS:v.project_uCommonUnitsPerWorldUnit=x.unitsPerMeter,v.project_uCommonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case et.LNGLAT:case et.LNGLAT_OFFSETS:n._pseudoMeters||(v.project_uCommonUnitsPerMeter=x.unitsPerMeter),v.project_uCommonUnitsPerWorldUnit=x.unitsPerDegree,v.project_uCommonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case et.CARTESIAN:v.project_uCommonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],v.project_uCommonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return v}const O9={};function N9(n=O9){return"viewport"in n?M9(n):{}}const n1={name:"project",dependencies:[e9,w9],vs:E9,getUniforms:N9},D9=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ao={name:"project32",dependencies:[n1],vs:D9};function L9(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ol(n,e){const t=sc([],e,n);return Ry(t,t,1/t[3]),t}function gb(n,e){const t=n%e;return t<0?e+t:t}function y_(n,e,t){return n<e?e:n>t?t:n}function F9(n){return Math.log(n)*Math.LOG2E}const r1=Math.log2||F9;function li(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const fs=Math.PI,hA=fs/4,qr=fs/180,x_=180/fs,Kl=512,Zd=4003e4,mb=85.051129,B9=1.5;function U9(n){return r1(n)}function _o(n){const[e,t]=n;li(Number.isFinite(e)),li(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*qr,s=t*qr,i=Kl*(r+fs)/(2*fs),o=Kl*(fs+Math.log(Math.tan(hA+s*.5)))/(2*fs);return[i,o]}function Zl(n){const[e,t]=n,r=e/Kl*(2*fs)-fs,s=2*(Math.atan(Math.exp(t/Kl*(2*fs)-fs))-hA);return[r*x_,s*x_]}function V9(n){const{latitude:e}=n;li(Number.isFinite(e));const t=Math.cos(e*qr);return U9(Zd*t)-9}function V0(n){const e=Math.cos(n*qr);return Kl/Zd/e}function w_(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;li(Number.isFinite(e)&&Number.isFinite(t));const s=Kl,i=Math.cos(e*qr),o=s/360,a=o/i,u=s/Zd/i,f={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,a,u],degreesPerUnit:[1/o,1/a,1/u]};if(r){const h=qr*Math.tan(e*qr)/i,p=o*h/2,m=s/Zd*h,v=m/a*u;f.unitsPerDegree2=[0,p,m],f.unitsPerMeter2=[v,0,v]}return f}function dA(n,e){const[t,r,s]=n,[i,o,a]=e,{unitsPerMeter:u,unitsPerMeter2:f}=w_({longitude:t,latitude:r,highPrecision:!0}),h=_o(n);h[0]+=i*(u[0]+f[0]*o),h[1]+=o*(u[1]+f[1]*o);const p=Zl(h),m=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[p[0],p[1],m]:p}function z9(n){const{height:e,pitch:t,bearing:r,altitude:s,scale:i,center:o}=n,a=L9();Cd(a,a,[0,0,-s]),EE(a,a,-t*qr),AE(a,a,r*qr);const u=i/e;return Ay(a,a,[u,u,u]),o&&Cd(a,a,N5([],o)),a}function $9(n){const{width:e,height:t,altitude:r,pitch:s=0,offset:i,center:o,scale:a,nearZMultiplier:u=1,farZMultiplier:f=1}=n;let{fovy:h=Qd(B9)}=n;r!==void 0&&(h=Qd(r));const p=h*qr,m=s*qr,v=pA(h);let x=v;o&&(x+=o[2]*a/Math.cos(m)/t);const w=p*(.5+(i?i[1]:0)/t),T=Math.sin(w)*x/Math.sin(y_(Math.PI/2-m-w,.01,Math.PI-.01)),E=Math.sin(m)*T+x,C=x*10,P=Math.min(E*f,C);return{fov:p,aspect:e/t,focalDistance:v,near:u,far:P}}function Qd(n){return 2*Math.atan(.5/n)*x_}function pA(n){return .5/Math.tan(.5*n*qr)}function gA(n,e){const[t,r,s=0]=n;return li(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(s)),Ol(e,[t,r,s,1])}function Qp(n,e,t=0){const[r,s,i]=n;if(li(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(i))return Ol(e,[r,s,i,1]);const o=Ol(e,[r,s,0,1]),a=Ol(e,[r,s,1,1]),u=o[2],f=a[2],h=u===f?0:((t||0)-u)/(f-u);return gE([],o,a,h)}function j9(n){const{width:e,height:t,bounds:r,minExtent:s=0,maxZoom:i=24,offset:o=[0,0]}=n,[[a,u],[f,h]]=r,p=W9(n.padding),m=_o([a,y_(h,-85.051129,mb)]),v=_o([f,y_(u,-85.051129,mb)]),x=[Math.max(Math.abs(v[0]-m[0]),s),Math.max(Math.abs(v[1]-m[1]),s)],w=[e-p.left-p.right-Math.abs(o[0])*2,t-p.top-p.bottom-Math.abs(o[1])*2];li(w[0]>0&&w[1]>0);const T=w[0]/x[0],E=w[1]/x[1],C=(p.right-p.left)/2/T,P=(p.top-p.bottom)/2/E,L=[(v[0]+m[0])/2+C,(v[1]+m[1])/2+P],I=Zl(L),F=Math.min(i,r1(Math.abs(Math.min(T,E))));return li(Number.isFinite(F)),{longitude:I[0],latitude:I[1],zoom:F}}function W9(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(li(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const vb=Math.PI/180;function H9(n,e=0){const{width:t,height:r,unproject:s}=n,i={targetZ:e},o=s([0,r],i),a=s([t,r],i);let u,f;const h=n.fovy?.5*n.fovy*vb:Math.atan(.5/n.altitude),p=(90-n.pitch)*vb;return h>p-.01?(u=_b(n,0,e),f=_b(n,t,e)):(u=s([0,0],i),f=s([t,0],i)),[o,a,f,u]}function _b(n,e,t){const{pixelUnprojectionMatrix:r}=n,s=Ol(r,[e,0,1,1]),i=Ol(r,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(i[2]-s[2]),u=gE([],s,i,a),f=Zl(u);return f.push(t),f}const yb=512;function X9(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:s,latitude:i,zoom:o,bearing:a=0}=n;(s<-180||s>180)&&(s=gb(s+180,360)-180),(a<-180||a>180)&&(a=gb(a+180,360)-180);const u=r1(t/yb);if(o<=u)o=u,i=0;else{const f=t/2/Math.pow(2,o),h=Zl([0,f])[1];if(i<h)i=h;else{const p=Zl([0,yb-f])[1];i>p&&(i=p)}}return{width:e,height:t,longitude:s,latitude:i,zoom:o,pitch:r,bearing:a}}const Y9=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,q9=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,K9=mf(eB),Z9=mf(tB),Q9=[0,0,0,1],G9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function J9(n,e){const[t,r,s]=n,i=Qp([t,r,s],e);return Number.isFinite(s)?i:[i[0],i[1],0]}function eB({viewport:n,center:e}){return new St(n.viewProjectionMatrix).invert().transform(e)}function tB({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,i=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>J9(o,r));for(const o of e){const a=o.clone().translate(new Fe(n.center).negate()),u=i.map(h=>a.transform(h)),f=new St().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});t.push(f.multiplyRight(o))}return t}function nB(n,e){const{shadowEnabled:t=!0}=n;if(!t||!n.shadowMatrices||!n.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r={shadow_uDrawShadowMap:!!n.drawToShadowMap,shadow_uUseShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,shadow_uColor:n.shadowColor||Q9,shadow_uLightId:n.shadowLightId||0,shadow_uLightCount:n.shadowMatrices.length},s=K9({viewport:n.viewport,center:e.project_uCenter}),i=[],o=Z9({shadowMatrices:n.shadowMatrices,viewport:n.viewport}).slice();for(let a=0;a<n.shadowMatrices.length;a++){const u=o[a],f=u.clone().translate(new Fe(n.viewport.center).negate());e.project_uCoordinateSystem===et.LNGLAT&&e.project_uProjectionMode===us.WEB_MERCATOR?(o[a]=f,i[a]=s):(o[a]=u.clone().multiplyRight(G9),i[a]=f.transform(s))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=i[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=n.shadowMaps&&n.shadowMaps[a]||n.dummyShadowMap;return r}const xb={name:"shadow",dependencies:[n1],vs:Y9,fs:q9,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(n={},e={})=>"viewport"in n&&(n.drawToShadowMap||n.shadowMaps&&n.shadowMaps.length>0)?nB(n,e):{}},Ro={...hb,defaultUniforms:{...hb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},rB=[n1],sB=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function iB(){const n=Hl.getDefaultShaderAssembler();for(const e of rB)n.addDefaultModule(e);for(const e of sB)n.addShaderHook(e);return n}const oB=[255,255,255],aB=1;let lB=0;class cB{constructor(e={}){this.type="ambient";const{color:t=oB}=e,{intensity:r=aB}=e;this.id=e.id||`ambient-${lB++}`,this.color=t,this.intensity=r}}const uB=[255,255,255],fB=1,hB=[0,0,-1];let dB=0;class wb{constructor(e={}){this.type="directional";const{color:t=uB}=e,{intensity:r=fB}=e,{direction:s=hB}=e,{_shadow:i=!1}=e;this.id=e.id||`directional-${dB++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new Fe(s).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class pB{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class s1 extends pB{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,i=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=s?0:!1,u=e.colorMask??15,f={viewport:[0,0,t,r]};e.colorMask&&(f.colorMask=u),e.scissorRect&&(f.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:f,clearColor:i,clearDepth:o,clearStencil:a});try{return this._drawLayers(h,e)}finally{h.end()}}_drawLayers(e,t){const{target:r,moduleParameters:s,viewports:i,views:o,onViewportActive:a,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const f=[];for(const h of i){const p=o&&o[h.id];a==null||a(h);const m=this._getDrawLayerParams(h,t),v=h.subViewports||[h];for(const x of v){const w=this._drawLayersInViewport(e,{target:r,moduleParameters:s,viewport:x,view:p,pass:t.pass,layers:t.layers},m);f.push(w)}}return f}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:s=!1,layerFilter:i,cullRect:o,effects:a,moduleParameters:u},f=!1){var x;const h=[],p=mA(this._lastRenderIndex+1),m={layer:t[0],viewport:e,isPicking:s,renderPass:r,cullRect:o},v={};for(let w=0;w<t.length;w++){const T=t[w],E=this._shouldDrawLayer(T,m,i,v),C={shouldDrawLayer:E};E&&!f&&(C.layerRenderIndex=p(T,E),C.moduleParameters=this._getModuleParameters(T,a,r,u),C.layerParameters={...(x=T.context.deck)==null?void 0:x.props.parameters,...this.getLayerParameters(T,w,e)}),h[w]=C}return h}_drawLayersInViewport(e,{layers:t,moduleParameters:r,pass:s,target:i,viewport:o,view:a},u){const f=gB(this.device,{moduleParameters:r,target:i,viewport:o});if(a&&a.props.clear){const p=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:f},()=>this.device.clearWebGL(p))}const h={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:f});for(let p=0;p<t.length;p++){const m=t[p],{shouldDrawLayer:v,layerRenderIndex:x,moduleParameters:w,layerParameters:T}=u[p];if(v&&m.props.pickable&&h.pickableCount++,m.isComposite)h.compositeCount++;else if(v){h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,x),w.viewport=o,m.context.renderPass=e;try{m._drawLayer({renderPass:e,moduleParameters:w,uniforms:{layerIndex:x},parameters:T})}catch(E){m.raiseError(E,`drawing ${m} to ${s}`)}}}return h}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(r){const a=t.layer.id;if(a in s||(s[a]=r(t)),!s[a])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,s){var a,u;const i=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:i});if(t)for(const f of t)Object.assign(o,(u=f.getModuleParameters)==null?void 0:u.call(f,e));return Object.assign(o,this.getModuleParameters(e,t),s)}}function mA(n=0,e={}){const t={},r=(s,i)=>{const o=s.props._offset,a=s.id,u=s.parent&&s.parent.id;let f;if(u&&!(u in e)&&r(s.parent,!1),u in t){const h=t[u]=t[u]||mA(e[u],e);f=h(s,i),t[a]=h}else Number.isFinite(o)?(f=o+(e[u]||0),t[a]=null):f=n;return i&&f>=n&&(n=f+1),e[a]=f,f};return r}function gB(n,{moduleParameters:e,target:t,viewport:r}){const s=e&&e.devicePixelRatio||n.canvasContext.cssToDeviceRatio(),[,i]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:i,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}class mB extends s1{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],i=s.width*r,o=s.height*r,a=[1,1,1,1];(i!==t.width||o!==t.height)&&t.resize({width:i,height:o}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const vB={color:[255,255,255],intensity:1},bb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],_B=[0,0,0,200/255];class vA{constructor(e={}){this.id="lighting-effect",this.shadowColor=_B,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(xb),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:i,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(xb))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new St().lookAt({eye:new Fe(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new mB(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new cB(vB),this.directionalLights.push(new wb(bb[0]),new wb(bb[1])))}}class yB{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:s,padding:i=0,copy:o=!1,initialize:a=!1,maxCount:u}){const f=s||e&&e.constructor||Float32Array,h=t*r+i;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new f(e.buffer,0,h)}let p=1/0;u&&(p=u*r+i);const m=this._allocate(f,h,a,p);return e&&o?m.set(e):a||m.fill(0,0,4),this._release(e),m}release(e){this._release(e)}_allocate(e,t,r,s){let i=Math.max(Math.ceil(t*this.opts.overAlloc),1);i>s&&(i=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*i,u=o.findIndex(f=>f.byteLength>=a);if(u>=0){const f=new e(o.splice(u,1)[0],0,i);return r&&f.fill(0),f}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:s}=r,i=t.findIndex(o=>o.byteLength>=s);i<0?t.push(r):(i>0||t.length<this.opts.poolSize)&&t.splice(i,0,r),t.length>this.opts.poolSize&&t.shift()}}const Ql=new yB;function lu(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xB(n,e){const t=n%e;return t<0?e+t:t}function wB(n){return[n[12],n[13],n[14]]}function bB(n){return{left:dl(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:dl(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:dl(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:dl(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:dl(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:dl(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Tb=new Fe;function dl(n,e,t,r){Tb.set(n,e,t);const s=Tb.len();return{distance:r/s,normal:new Fe(-n/s,-e/s,-t/s)}}function TB(n){return n-Math.fround(n)}let Yc;function z0(n,e){const{size:t=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,i=(s-r)/t;Yc=Ql.allocate(Yc,i,{type:Float32Array,size:t*2});let o=r,a=0;for(;o<s;){for(let u=0;u<t;u++){const f=n[o++];Yc[a+u]=f,Yc[a+u+t]=TB(f)}a+=t*2}return Yc.subarray(0,i*t*2)}function SB(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const EB=Math.PI/180,AB=lu(),Sb=[0,0,0],RB={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function CB({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:s,padding:i,near:o,far:a}){const u=n/e,f=t?new St().orthographic({fovy:r,aspect:u,focalDistance:s,near:o,far:a}):new St().perspective({fovy:r,aspect:u,near:o,far:a});if(i){const{left:h=0,right:p=0,top:m=0,bottom:v=0}=i,x=cn((h+n-p)/2,0,n)-n/2,w=cn((m+e-v)/2,0,e)-e/2;f[8]-=x*2/n,f[9]+=w*2/e}return f}class Ia{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||RB,this.focalDistance=e.focalDistance||1,this.position=e.position||Sb,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?us.WEB_MERCATOR:us.WEB_MERCATOR_AUTO_OFFSET:us.IDENTITY}equals(e){return e instanceof Ia?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ii(e.projectionMatrix,this.projectionMatrix)&&ii(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),s=gA(r,this.pixelProjectionMatrix),[i,o]=s,a=t?o:this.height-o;return e.length===2?[i,a]:[i,a,s[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[s,i,o]=e,a=t?i:this.height-i,u=r&&r*this.distanceScales.unitsPerMeter[2],f=Qp([s,a,o],this.pixelUnprojectionMatrix,u),[h,p,m]=this.unprojectPosition(f);return Number.isFinite(o)?[h,p,m]:Number.isFinite(r)?[h,p,r]:[h,p]}projectPosition(e){const[t,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,s]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,s]}projectFlat(e){if(this.isGeospatial){const t=_o(e);return t[1]=cn(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Zl(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),s=this.unproject([this.width,0],t),i=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}getDistanceScales(e){return e?w_({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,bB(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=V9({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||w_({latitude:r,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:i,modelMatrix:o}=e;let a=Sb;if(i&&(a=o?new St(o).transformAsVector(i,[]):i),this.isGeospatial){const u=this.projectPosition([t,r,0]);this.center=new Fe(a).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=AB,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:i,fovy:o=75,near:a=.1,far:u=1e3,padding:f=null,focalDistance:h=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new St().multiplyRight(t).translate(new Fe(this.center).negate()),this.projectionMatrix=r||CB({width:this.width,height:this.height,orthographic:s,fovyRadians:i||o*EB,focalDistance:h,padding:f,near:a,far:u});const p=lu();oa(p,p,this.projectionMatrix),oa(p,p,this.viewMatrix),this.viewProjectionMatrix=p,this.viewMatrixInverse=Uv([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=wB(this.viewMatrixInverse);const m=lu(),v=lu();Ay(m,m,[this.width/2,-this.height/2,1]),Cd(m,m,[1,-1,0]),oa(v,m,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=Uv(lu(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ut.warn("Pixel project matrix not invertible")()}}Ia.displayName="Viewport";class yo extends Ia{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:s=0,pitch:i=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:u=1.01,nearZ:f,farZ:h,orthographic:p=!1,projectionMatrix:m,repeat:v=!1,worldOffset:x=0,position:w,padding:T,legacyMeterSizes:E=!1}=e;let{width:C,height:P,altitude:L=1.5}=e;const I=Math.pow(2,s);C=C||1,P=P||1;let F,j=null;if(m)L=m[5]/2,F=Qd(L);else{e.fovy?(F=e.fovy,L=pA(F)):F=Qd(L);let Q;if(T){const{top:le=0,bottom:he=0}=T;Q=[0,cn((le+P-he)/2,0,P)-P/2]}j=$9({width:C,height:P,scale:I,center:w&&[0,0,w[2]*V0(t)],offset:Q,pitch:i,fovy:F,nearZMultiplier:a,farZMultiplier:u}),Number.isFinite(f)&&(j.near=f),Number.isFinite(h)&&(j.far=h)}let q=z9({height:P,pitch:i,bearing:o,scale:I,altitude:L});x&&(q=new St().translate([512*x,0,0]).multiplyLeft(q)),super({...e,width:C,height:P,viewMatrix:q,longitude:r,latitude:t,zoom:s,...j,fovy:F,focalDistance:L}),this.latitude=t,this.longitude=r,this.zoom=s,this.pitch=i,this.bearing=o,this.altitude=L,this.fovy=F,this.orthographic=p,this._subViewports=v?[]:null,this._pseudoMeters=E,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=t;s<=r;s++){const i=s?new yo({...this,worldOffset:s}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),s=(e[2]||0)*V0(e[1]);return[t,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),s=(e[2]||0)/V0(r);return[t,r,s]}addMetersToLngLat(e,t){return dA(e,t)}panByPosition(e,t){const r=Qp(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),i=Rd([],s,pE([],r)),o=Rd([],this.center,i),[a,u]=this.unprojectFlat(o);return{longitude:a,latitude:u}}getBounds(e={}){const t=H9(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:s}=this,{longitude:i,latitude:o,zoom:a}=j9({width:r,height:s,bounds:e,...t});return new yo({width:r,height:s,longitude:i,latitude:o,zoom:a})}}yo.displayName="WebMercatorViewport";const Eb=[0,0,0];function $0(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof yo){const[s,i,o=0]=n,a=e.getDistanceScales([s,i]);r[2]=o*a.unitsPerMeter[2]}return r}function PB(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:s,fromCoordinateSystem:i,fromCoordinateOrigin:o}=n;return s===et.DEFAULT&&(s=e.isGeospatial?et.LNGLAT:et.CARTESIAN),i===void 0&&(i=s),o===void 0&&(o=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function _A(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:s,offsetMode:i}){let[o,a,u=0]=n;switch(t&&([o,a,u]=sc([],[o,a,u,1],t)),r){case et.LNGLAT:return $0([o,a,u],e,i);case et.LNGLAT_OFFSETS:return $0([o+s[0],a+s[1],u+(s[2]||0)],e,i);case et.METER_OFFSETS:return $0(dA(s,[o,a,u]),e,i);case et.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],u+s[2]]:e.projectPosition([o,a,u])}}function IB(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=PB(e),{autoOffset:u=!0}=e,{geospatialOrigin:f=Eb,shaderCoordinateOrigin:h=Eb,offsetMode:p=!1}=u?fA(t,r,s):{},m=_A(n,{viewport:t,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:p});if(p){const v=t.projectPosition(f||h);bE(m,m,v)}return m}let MB=1,kB=1;class yA{constructor(){S(this,"time",0);S(this,"channels",new Map);S(this,"animations",new Map);S(this,"playing",!1);S(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:i=1}=e,o=MB++,a={time:0,delay:t,duration:r,rate:s,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:i,channel:o}=s;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=kB++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let OB=0;const NB={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:kl.stats.get(`animation-loop-${OB++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class DB{constructor(e){S(this,"device",null);S(this,"canvas",null);S(this,"props");S(this,"animationProps",null);S(this,"timeline",null);S(this,"stats");S(this,"cpuTime");S(this,"gpuTime");S(this,"frameRate");S(this,"display");S(this,"needsRedraw","initialized");S(this,"_initialized",!1);S(this,"_running",!1);S(this,"_animationFrameId",null);S(this,"_nextFramePromise",null);S(this,"_resolveNextFrame",null);S(this,"_cpuStartTime",0);if(this.props={...NB,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new df({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=w7(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(b7(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,t;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(t=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:t.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){var i,o,a,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((o=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const s=(u=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:u.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Ab{constructor(e){S(this,"id");S(this,"userData",{});S(this,"topology");S(this,"bufferLayout",[]);S(this,"vertexCount");S(this,"indices");S(this,"attributes");this.id=e.id||Pa("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&jt(this.indices.usage===un.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function LB(n,e){if(e instanceof Ab)return e;const t=FB(n,e),{attributes:r,bufferLayout:s}=BB(n,e);return new Ab({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:r})}function FB(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:un.INDEX,data:t})}function BB(n,e){const t=[],r={};for(const[i,o]of Object.entries(e.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=n.createBuffer({data:o.value,id:`${i}-buffer`});const{value:u,size:f,normalized:h}=o;t.push({name:a,format:m7(u,f,h)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:s}}class UB{constructor(e){S(this,"modules");S(this,"moduleUniforms");S(this,"moduleBindings");S(this,"moduleUniformsChanged");const t=Kp(Object.values(e).filter(r=>r.dependencies));for(const r of t)e[r.name]=r;Ce.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e)){const i=r;this.moduleUniforms[i]=s.defaultUniforms||{},this.moduleBindings[i]={}}}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const s=r,i=e[s],o=this.modules[s];if(!o){Ce.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[s],u=this.moduleBindings[s],f=((t=o.getUniforms)==null?void 0:t.call(o,i,a))||i,{uniforms:h,bindings:p}=Ky(f);this.moduleUniforms[s]={...a,...h},this.moduleBindings[s]={...u,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,s]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(s))e[`${r}.${i}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[i],value:String(o)};return e}}const Op=class Op{constructor(e){S(this,"device");S(this,"_hashCounter",0);S(this,"_hashes",{});S(this,"_renderPipelineCache",{});S(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Op(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Yl.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._renderPipelineCache[r]={pipeline:s,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...$d.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._computePipelineCache[r]={pipeline:s,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof $d?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,s="-",i=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${s}BL${i}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${s}T${e.topology}P${o}BL${i}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};S(Op,"defaultProps",{...Yl.defaultProps});let b_=Op;const Np=class Np{constructor(e){S(this,"device");S(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Np(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:s,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};S(Np,"defaultProps",{...Ud.defaultProps});let T_=Np;function VB(n,e){var s;const t={},r="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const i of n.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;t[`in ${o}`]={[r]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const o=`${i.location} ${i.name}`;t[`out ${o}`]={[r]:JSON.stringify(i.accessor)}}return t}let Mn=null,j0=null;function zB(n,{id:e,minimap:t,opaque:r,top:s="0",left:i="0",rgbaScale:o=1}){Mn||(Mn=document.createElement("canvas"),Mn.id=e,Mn.title=e,Mn.style.zIndex="100",Mn.style.position="absolute",Mn.style.top=s,Mn.style.left=i,Mn.style.border="blue 1px solid",Mn.style.transform="scaleY(-1)",document.body.appendChild(Mn),j0=Mn.getContext("2d")),(Mn.width!==n.width||Mn.height!==n.height)&&(Mn.width=n.width/2,Mn.height=n.height/2,Mn.style.width="400px",Mn.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),u=j0.createImageData(n.width,n.height),f=0;for(let h=0;h<a.length;h+=4)u.data[f+h+0]=a[h+0]*o,u.data[f+h+1]=a[h+1]*o,u.data[f+h+2]=a[h+2]*o,u.data[f+h+3]=r?255:a[h+3]*o;j0.putImageData(u,0,0)}const pl=2,$B=1e4,Dp=class Dp{constructor(e,t){S(this,"device");S(this,"id");S(this,"source");S(this,"vs");S(this,"fs");S(this,"pipelineFactory");S(this,"shaderFactory");S(this,"userData",{});S(this,"parameters");S(this,"topology");S(this,"bufferLayout");S(this,"isInstanced");S(this,"instanceCount",0);S(this,"vertexCount");S(this,"indexBuffer",null);S(this,"bufferAttributes",{});S(this,"constantAttributes",{});S(this,"bindings",{});S(this,"uniforms",{});S(this,"vertexArray");S(this,"transformFeedback",null);S(this,"pipeline");S(this,"shaderInputs");S(this,"_uniformStore");S(this,"_attributeInfos",{});S(this,"_gpuGeometry",null);S(this,"_getModuleUniforms");S(this,"props");S(this,"_pipelineNeedsUpdate","newly created");S(this,"_needsRedraw","initializing");S(this,"_destroyed",!1);S(this,"_lastDrawTimestamp",-1);S(this,"_lastLogTime",0);S(this,"_logOpen",!1);S(this,"_drawCount",0);var a,u,f,h;this.props={...Dp.defaultProps,...t},t=this.props,this.id=t.id||Pa("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(p=>[p.name,p]))||[]);this.setShaderInputs(t.shaderInputs||new UB(r));const s=jB(e),i=(((u=this.props.modules)==null?void 0:u.length)>0?this.props.modules:(f=this.shaderInputs)==null?void 0:f.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(h=this.props).shaderLayout||(h.shaderLayout=Q7(this.props.source));const{source:p,getUniforms:m}=this.props.shaderAssembler.assembleShader({platformInfo:s,...this.props,modules:i});this.source=p,this._getModuleUniforms=m}else{const{vs:p,fs:m,getUniforms:v}=this.props.shaderAssembler.assembleShaderPair({platformInfo:s,...this.props,modules:i});this.vs=p,this.fs=m,this._getModuleUniforms=v}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||b_.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||T_.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&this.updateModuleSettings(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let t;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Fd(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,s=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&LB(this.device,e);t&&(this.setTopology(t.topology||"triangle-list"),this.bufferLayout=Rb(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)),this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Rb(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){p_(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new g7(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){e.indices&&Ce.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,s]of Object.entries(e)){const i=this.bufferLayout.find(u=>Cb(u).includes(r));if(!i){Ce.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=Cb(i);let a=!1;for(const u of o){const f=this._attributeInfos[u];f&&(this.vertexArray.setBuffer(f.location,s),a=!0)}!a&&!((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)&&Ce.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,s]of Object.entries(e)){const i=this._attributeInfos[r];i?this.vertexArray.setConstantWebGL(i.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||Ce.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Fd(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:t,uniforms:r}=Ky(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Bd?e=Math.max(e,t.texture.updateTimestamp):t instanceof un||t instanceof Hr?e=Math.max(e,t.updateTimestamp):t instanceof Vd||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Ce.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=r:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:s}),this._attributeInfos=L4(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Ce.level>3?0:$B;Ce.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Ce.group(pl,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ce.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=VB(this.pipeline.shaderLayout,this.id);Ce.table(pl,e)();const t=this.shaderInputs.getDebugTable();for(const[s,i]of Object.entries(this.uniforms))t[s]={value:i};Ce.table(pl,t)();const r=this._getAttributeDebugTable();Ce.table(pl,this._attributeInfos)(),Ce.table(pl,r)(),Ce.groupEnd(pl)(),this._logOpen=!1}}_logFramebuffer(e){const t=Ce.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&zB(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos))e[r.location]={name:t,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=U4(t);return(e instanceof un?new r(e.debugData):e).toString()}};S(Dp,"defaultProps",{...Yl.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Hl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Jn=Dp;function Rb(n,e){const t=[...n];for(const r of e){const s=t.findIndex(i=>i.name===r.name);s<0?t.push(r):t[s]=r}return t}function jB(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Cb(n){var e;return n.attributes?(e=n.attributes)==null?void 0:e.map(t=>t.attribute):[n.name]}class Fu{constructor(e,t=Jn.defaultProps){S(this,"device");S(this,"model");S(this,"transformFeedback");jt(Fu.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Jn(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||vF(),topology:t.topology||"point-list",...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(t instanceof un)return t.readAsync();const{buffer:r,byteOffset:s=0,byteLength:i=r.byteLength}=t;return r.readAsync(s,i)}}class ci{constructor(e){S(this,"id");S(this,"topology");S(this,"vertexCount");S(this,"indices");S(this,"attributes");S(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:s=null}=e;this.id=e.id||Pa("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[i,o]of Object.entries(t)){const a=ArrayBuffer.isView(o)?{value:o}:o;jt(ArrayBuffer.isView(a.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(jt(!this.indices),this.indices=a):this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const s of Object.values(e)){const{value:i,size:o,constant:a}=s;!a&&i&&o>=1&&(r=Math.min(r,i.length/o))}return jt(Number.isFinite(r)),r}}const WB={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class xA extends s1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:i,pickingFBO:o,deviceRect:{x:a,y:u,width:f,height:h},cullRect:p,effects:m,pass:v="picking",pickZ:x,moduleParameters:w}){this.pickZ=x;const T=this._resetColorEncoder(x),E=[a,u,f,h],C=super.render({target:o,layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:i,cullRect:p,effects:m==null?void 0:m.filter(L=>L.useInPicking),pass:v,isPicking:!0,moduleParameters:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:E});return this._colorEncoderState=null,{decodePickingColor:T&&XB.bind(null,T),stats:C}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,r){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:i&&o.includes("draw")&&(Object.assign(s,WB),s.blend=!0,s.blendColor=HB(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function HB(n,e,t){const{byLayer:r,byAlpha:s}=n;let i,o=r.get(e);return o?(o.viewports.push(t),i=o.a):(i=r.size+1,i<=255?(o={a:i,layer:e,viewports:[t]},r.set(e,o),s[i]=o):(ut.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function XB(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const vl={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Gd=Symbol.for("component"),uo=Symbol.for("propTypes"),W0=Symbol.for("deprecatedProps"),Nl=Symbol.for("asyncPropDefaults"),_a=Symbol.for("asyncPropOriginal"),io=Symbol.for("asyncPropResolved");function Gp(n,e=()=>!0){return Array.isArray(n)?wA(n,e,[]):e(n)?[n]:[]}function wA(n,e,t){let r=-1;for(;++r<n.length;){const s=n[r];Array.isArray(s)?wA(s,e,t):e(s)&&t.push(s)}return t}function YB({target:n,source:e,start:t=0,count:r=1}){const s=e.length,i=r*s;let o=0;for(let a=t;o<s;o++)n[a++]=e[o];for(;o<i;)o<i-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+i-o),o=i);return n}class qB{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=Dd(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class KB{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:s=!0}){let i=this._resources[e];i?i.setData(t,r):(i=new qB(e,t,this._context),this._resources[e]=i),i.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const s=t[r],i=this._resources[s.resourceId];i&&i.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:s="default"}){const{_resources:i,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),i[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=i[e];if(this._track(r,s,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,s){const i=this._consumers,o=i[e]=i[e]||{};let a=o[t];const u=a&&a.resourceId&&this._resources[a.resourceId];u&&(u.unsubscribe(a),this.prune()),r&&(a?(a.onChange=s,a.resourceId=r.id):a={onChange:s,resourceId:r.id},o[t]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const ZB="layerManager.setLayers",QB="layerManager.activateViewport";class GB{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Zn(QB,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:s,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new KB({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:iB(),defaultShaderModules:[],renderPass:void 0,stats:s||new df({id:"deck.gl"}),viewport:i||new Ia({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new yA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Zn(ZB,this,t,e),this._lastRenderedLayers=e;const r=Gp(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(s=>s.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const o of e)r[o.id]?ut.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,r,s),this._finalizeOldLayers(r);let i=!1;for(const o of s)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=s}_updateSublayersRecursively(e,t,r){for(const s of e){s.context=this.context;const i=t[s.id];i===null&&ut.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let o=null;try{this._debug&&i!==s&&s.validateProps(),i?(this._transferLayerState(i,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=vl.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=vl.MATCHED,t!==e&&(e.lifecycle=vl.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=vl.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=vl.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Xr(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Xr(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!Xr(n[i],e[i],t-1))return!1;return!0}return!1}class JB{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let i=r.length-1;i>=0;--i){const o=r[i];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Gp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Xr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ut.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:i,width:this.width,height:this.height})}})}_updateController(e,t,r,s){const i=e.controller;if(i&&r){const o={...t,...i,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==i.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const i=e[s],o=this.getViewState(i),a=i.makeViewport({viewState:o,width:this.width,height:this.height});let u=t[i.id];const f=!!i.controller;f&&!u&&(r=!0),(r||!f)&&u&&(u.finalize(),u=null),this.controllers[i.id]=this._updateController(i,o,a,u),a&&this._viewports.unshift(a)}for(const s in t){const i=t[s];i&&!this.controllers[s]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,s)=>!e[s].equals(t[s]))}}const eU=/([0-9]+\.?[0-9]*)(%|px)/;function ji(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=eU.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Wi(n,e){return n.relative?Math.round(n.position*e):n.position}class ya{constructor(e){const{id:t,x:r=0,y:s=0,width:i="100%",height:o="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ji(r),this._y=ji(s),this._width=ji(i),this._height=ji(o),this._padding=a&&{left:ji(a.left||0),right:ji(a.right||0),top:ji(a.top||0),bottom:ji(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Xr(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:t});return!s.height||!s.width?null:new this.ViewportType({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:Wi(this._x,e),y:Wi(this._y,t),width:Wi(this._width,e),height:Wi(this._height,t)};return this._padding&&(r.padding={left:Wi(this._padding.left,e),top:Wi(this._padding.top,t),right:Wi(this._padding.right,e),bottom:Wi(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Jp{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Pb=()=>{},S_={BREAK:1,SNAP_TO_END:2,IGNORE:3},tU=n=>n,nU=S_.BREAK;class rU{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:s,startProps:i,endProps:o,duration:a,easing:u}}=t,f=u(r/a),h=s.interpolateProps(i,o,f);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Jp(e.timeline),this.onViewStateChange=e.onViewStateChange||Pb,this.onStateChange=e.onStateChange||Pb}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;s={...r,...i===S_.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===S_.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(r),i=t.transitionInterpolator,o=i.getDuration?i.getDuration(e,t):t.transitionDuration;if(o===0)return;const a=i.initializeProps(e,s);this.propsInTransition={};const u={duration:o,easing:t.transitionEasing||tU,interpolator:i,interruption:t.transitionInterruption||nU,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Ln(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class sU{constructor(e){const{compare:t,extract:r,required:s}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=s}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!ii(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},s={};for(const i of this._propsToExtract)(i in e||i in t)&&(r[i]=e[i],s[i]=t[i]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Ln(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const iU=["longitude","latitude","zoom","bearing","pitch"],oU=["longitude","latitude","zoom"];class i1 extends sU{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:iU,required:oU},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:s,around:i}=this.opts;if(s&&i){const o=s(e),a=s(t),u=o.unproject(i);r.start.around=i,Object.assign(r.end,{around:a.project(u),aroundPosition:u,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const s={};for(const i of this._propsToExtract)s[i]=ia(e[i]||0,t[i]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...t,...s});Object.assign(s,i.panByPosition(t.aroundPosition,ia(e.around,t.around,r)))}return s}}const Hi={transitionDuration:0},aU=300,Xh=n=>1-(1-n)*(1-n),gl={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ho={};class bA{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new rU({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-r]}isPointInBounds(e,t){const{width:r,height:s}=this.props;if(t&&t.handled)return!1;const i=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return i&&t&&t.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?aU:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:u=!1,keyboard:f=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(gl.WHEEL,h&&r),this.toggleEvents(gl.PAN,h),this.toggleEvents(gl.PINCH,h&&(a||u)),this.toggleEvents(gl.TRIPLE_PAN,h&&u),this.toggleEvents(gl.DOUBLE_TAP,h&&o),this.toggleEvents(gl.KEYBOARD,h&&f),this.scrollZoom=r,this.dragPan=s,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=u,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const s={...e.getViewportProps(),...t},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),i){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(s,Hi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Hi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],i=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Xh},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Hi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],i=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Xh},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*r)));i<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Hi,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Hi,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*t/2],i=this.controllerState.rotate({pos:s});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Xh},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Ho._startPinchRotation=e.rotation,Ho._lastPinchEvent=e,this.updateViewport(r,Hi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:Ho._startPinchRotation-r})}return this.updateViewport(t,Hi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ho._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=Ho;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const s=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+a*t/2);i=i.zoom({pos:s,scale:u}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:Xh},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ho._startPinchRotation=null,Ho._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let u;const f={};switch(e.srcEvent.code){case"Minus":u=t?a.zoomOut(r).zoomOut(r):a.zoomOut(r),f.isZooming=!0;break;case"Equal":u=t?a.zoomIn(r).zoomIn(r):a.zoomIn(r),f.isZooming=!0;break;case"ArrowLeft":t?(u=a.rotateLeft(i),f.isRotating=!0):(u=a.moveLeft(s),f.isPanning=!0);break;case"ArrowRight":t?(u=a.rotateRight(i),f.isRotating=!0):(u=a.moveRight(s),f.isPanning=!0);break;case"ArrowUp":t?(u=a.rotateUp(o),f.isRotating=!0):(u=a.moveUp(s),f.isPanning=!0);break;case"ArrowDown":t?(u=a.rotateDown(o),f.isRotating=!0):(u=a.moveDown(s),f.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),f),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Hi:e?{...t,transitionInterpolator:new i1({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class TA{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Ib=5,lU=1.2;class cU extends TA{constructor(e){const{width:t,height:r,latitude:s,longitude:i,zoom:o,bearing:a=0,pitch:u=0,altitude:f=1.5,position:h=[0,0,0],maxZoom:p=20,minZoom:m=0,maxPitch:v=60,minPitch:x=0,startPanLngLat:w,startZoomLngLat:T,startRotatePos:E,startBearing:C,startPitch:P,startZoom:L,normalize:I=!0}=e;Ln(Number.isFinite(i)),Ln(Number.isFinite(s)),Ln(Number.isFinite(o)),super({width:t,height:r,latitude:s,longitude:i,zoom:o,bearing:a,pitch:u,altitude:f,maxZoom:p,minZoom:m,maxPitch:v,minPitch:x,normalize:I,position:h},{startPanLngLat:w,startZoomLngLat:T,startRotatePos:E,startBearing:C,startPitch:P,startZoom:L}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:i,startPitch:o}=this.getState();if(!s||i===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,i):a={bearing:i+t,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:s,startZoomLngLat:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(t)||this._unproject(e)),!i)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let u=s+Math.log2(r);u=cn(u,a,o);const f=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...f.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:i}=r;return Math.abs(s-t.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(i-t.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:s}=e;e.zoom=cn(s,r,t);const{maxPitch:i,minPitch:o,pitch:a}=e;e.pitch=cn(a,o,i);const{normalize:u=!0}=e;return u&&Object.assign(e,X9(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,s){const i=e[0]-t[0],o=e[1]-t[1],a=e[1],u=t[1],{width:f,height:h}=this.getViewportProps(),p=i/f;let m=0;o>0?Math.abs(h-u)>Ib&&(m=o/(u-h)*lU):o<0&&u>Ib&&(m=1-a/u),m=cn(m,-1,1);const{minPitch:v,maxPitch:x}=this.getViewportProps(),w=s+180*p;let T=r;return m>0?T=r+m*(x-r):m<0&&(T=r-m*(v-r)),{pitch:T,bearing:w}}}class uU extends bA{constructor(){super(...arguments),this.ControllerState=cU,this.transition={transitionDuration:300,transitionInterpolator:new i1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class SA extends ya{constructor(e={}){super(e)}get ViewportType(){return yo}get ControllerType(){return uU}}SA.displayName="MapView";const fU=new vA;function hU(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class dU{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(s=>hU(s,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Xr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const r=[];for(const s of e){const i=t[s.id];let o=s;i&&i!==s?i.setProps?(i.setProps(s.props),o=i):i.cleanup(this._context):i||s.setup(this._context),r.push(o),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof vA)||this._resolvedEffects.push(fU),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class pU extends s1{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const gU="deckRenderer.renderLayers";class mU{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new pU(e),this.pickLayersPass=new xA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const i=t.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,Zn(gU,this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,s={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const i of e)if(i.postRender){s.target=i.id===this.lastPostProcessEffect?t.target:void 0;const o=i.postRender(s);s.inputBuffer=o,s.swapBuffer=o===r[0]?r[1]:r[0]}}}const vU={pickedColor:null,pickedObjectIndex:-1};function _U({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:s,deviceRect:i}){const{x:o,y:a,width:u,height:f}=i;let h=s*s,p=-1,m=0;for(let v=0;v<f;v++){const x=v+a-r,w=x*x;if(w>h)m+=4*u;else for(let T=0;T<u;T++){if(n[m+3]-1>=0){const C=T+o-t,P=C*C+w;P<=h&&(h=P,p=m)}m+=4}}if(p>=0){const v=n.slice(p,p+4),x=e(v);if(x){const w=Math.floor(p/4/u),T=p/4-w*u;return{...x,pickedColor:v,pickedX:o+T,pickedY:a+w}}ut.error("Picked non-existent layer. Is picking buffer corrupt?")()}return vU}function yU({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const i=n.slice(r,r+4),o=i.join(",");if(!t.has(o)){const a=e(i);a?t.set(o,{...a,color:i}):ut.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function EA({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:s,z:i}){let o=e[0];e.length>1&&(o=wU((n==null?void 0:n.pickedViewports)||e,{x:r,y:s}));let a;if(o){const u=[r-o.x,s-o.y];i!==void 0&&(u[2]=i),a=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function xU(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:s}=n,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=e,u=o?[o]:[];if(r==="hover"){const p=t.index,m=t.layerId,v=o?o.props.id:null;if(v!==m||a!==p){if(v!==m){const x=s.find(w=>w.props.id===m);x&&u.unshift(x)}t.layerId=v,t.index=a,t.info=null}}const f=EA(n),h=new Map;return h.set(null,f),u.forEach(p=>{let m={...f};p===o&&(m.color=i,m.index=a,m.picked=!0),m=AA({layer:p,info:m,mode:r});const v=m.layer;p===o&&r==="hover"&&(t.info=m),h.set(v.id,m),r==="hover"&&v.updateAutoHighlight(m)}),h}function AA({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function wU(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class bU{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new xA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:s},i=this.lastPickedInfo.info){const o=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,u=o?r.find(m=>m.id===o):null,f=a&&s.find(m=>m.id===a)||s[0],h=f&&f.unproject([e-f.x,t-f.y]);return{...i,...{x:e,y:t,viewport:f,coordinate:h,layer:u}}}_resizeBuffer(){var t,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:s,y:i,radius:o=0,depth:a=1,mode:u="query",unproject3D:f,onViewportActive:h,effects:p}){const m=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||r.length===0)return{result:[],emptyInfo:EA({viewports:r,x:s,y:i,pixelRatio:m})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,i],!0),w=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],T=Math.round(o*m),{width:E,height:C}=this.pickingFBO,P=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:T,deviceWidth:E,deviceHeight:C}),L={x:s-o,y:i-o,width:o*2+1,height:o*2+1};let I;const F=[],j=new Set;for(let q=0;q<a;q++){let Q;if(P){const he=this._drawAndSample({layers:v,views:t,viewports:r,onViewportActive:h,deviceRect:P,cullRect:L,effects:p,pass:`picking:${u}`});Q=_U({...he,deviceX:w[0],deviceY:w[1],deviceRadius:T,deviceRect:P})}else Q={pickedColor:null,pickedObjectIndex:-1};let le;if(Q.pickedLayer&&f&&this.depthFBO){const{pickedColors:he}=this._drawAndSample({layers:[Q.pickedLayer],views:t,viewports:r,onViewportActive:h,deviceRect:{x:Q.pickedX,y:Q.pickedY,width:1,height:1},cullRect:L,effects:p,pass:`picking:${u}:z`},!0);he[3]&&(le=he[0])}Q.pickedLayer&&q+1<a&&(j.add(Q.pickedLayer),Q.pickedLayer.disablePickingIndex(Q.pickedObjectIndex)),I=xU({pickInfo:Q,lastPickedInfo:this.lastPickedInfo,mode:u,layers:v,viewports:r,x:s,y:i,z:le,pixelRatio:m});for(const he of I.values())he.layer&&F.push(he);if(!Q.pickedColor)break}for(const q of j)q.restorePickingColors();return{result:F,emptyInfo:I.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:s,y:i,width:o=1,height:a=1,mode:u="query",maxObjects:f=null,onViewportActive:h,effects:p}){const m=this._getPickable(e);if(!m||r.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,i],!0),w=x.x,T=x.y+x.height,E=this.device.canvasContext.cssToDevicePixels([s+o,i+a],!0),C=E.x+E.width,P=E.y,L={x:w,y:P,width:C-w,height:T-P},I=this._drawAndSample({layers:m,views:t,viewports:r,onViewportActive:h,deviceRect:L,cullRect:{x:s,y:i,width:o,height:a},effects:p,pass:`picking:${u}`}),F=yU(I),j=new Map,q=[],Q=Number.isFinite(f);for(let le=0;le<F.length&&!(Q&&q.length>=f);le++){const he=F[le];let pe={color:he.pickedColor,layer:null,index:he.pickedObjectIndex,picked:!0,x:s,y:i,pixelRatio:v};pe=AA({layer:he.pickedLayer,info:pe,mode:u});const ne=pe.layer.id;j.has(ne)||j.set(ne,new Set);const ve=j.get(ne),Me=pe.object??pe.index;ve.has(Me)||(ve.add(Me),q.push(pe))}return q}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:s,deviceRect:i,cullRect:o,effects:a,pass:u},f=!1){const h=f?this.depthFBO:this.pickingFBO,p={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:s,pickingFBO:h,deviceRect:i,cullRect:o,effects:a,pass:u,pickZ:f,preRenderStats:{},isPicking:!0};for(const C of a)C.useInPicking&&(p.preRenderStats[C.id]=C.preRender(p));const{decodePickingColor:m}=this.pickLayersPass.render(p),{x:v,y:x,width:w,height:T}=i,E=new(f?Float32Array:Uint8Array)(w*T*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:v,sourceY:x,sourceWidth:w,sourceHeight:T,target:E}),{pickedColors:E,decodePickingColor:m}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:s,deviceHeight:i}){const o=Math.max(0,e-r),a=Math.max(0,t-r),u=Math.min(s,e+r+1)-o,f=Math.min(i,t+r+1)-a;return u<=0||f<=0?null:{x:o,y:a,width:u,height:f}}}const TU={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},SU="top-left",Mb="__root";class EU{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Xr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=t[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const s=t[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=SU}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,r).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var o;const r=e||Mb;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[r]=s);let i=s.querySelector(`.${t}`);return i||(i=document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,TU[t]),s.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,i=r===Mb||s,o=this.containers[r];i?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){var i,o;const r=e.reduce((a,u)=>(a[u.id]=u,a),{}),{lastViewports:s}=this;for(const a of this.getWidgets()){const{viewId:u}=a;if(u){const f=r[u];f&&(a.onViewportChange&&!f.equals(s[u])&&a.onViewportChange(f),(i=a.onRedraw)==null||i.call(a,{viewports:[f],layers:t}))}else{if(a.onViewportChange)for(const f of e)f.equals(s[f.id])||a.onViewportChange(f);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var r,s;for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((s=i.onHover)==null||s.call(i,e,t))}}onEvent(e,t){var s,i;const r=__[t.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((i=o[r.handler])==null||i.call(o,e,t))}}}const AU={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class RU{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,AU),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var pt;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(pt||(pt={}));const o1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},mn=(n,e,t)=>e?n.enable(t):n.disable(t),kb=(n,e,t)=>n.hint(t,e),Cr=(n,e,t)=>n.pixelStorei(t,e),Ob=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},qc=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function H0(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const CU={3042:mn,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:mn,2885:(n,e)=>n.cullFace(e),2929:mn,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:mn,35723:kb,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:Ob,36010:Ob,34964:qc,36662:qc,36663:qc,35053:qc,35055:qc,2886:(n,e)=>n.frontFace(e),33170:kb,2849:(n,e)=>n.lineWidth(e),32823:mn,32824:"polygonOffset",10752:"polygonOffset",35977:mn,32926:mn,32928:mn,32938:"sampleCoverage",32939:"sampleCoverage",3089:mn,3088:(n,e)=>n.scissor(...e),2960:mn,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:mn,10754:mn,12288:mn,12289:mn,12290:mn,12291:mn,12292:mn,12293:mn,12294:mn,12295:mn,3333:Cr,3317:Cr,37440:Cr,37441:Cr,37443:Cr,3330:Cr,3332:Cr,3331:Cr,3314:Cr,32878:Cr,3316:Cr,3315:Cr,32877:Cr,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(...e),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=H0(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=H0(e)&&e.length===3?[...e,...e]:e;const[t,r,s,i,o,a]=e;n.stencilFuncSeparate(1028,t,r,s),n.stencilFuncSeparate(1029,i,o,a)},stencilOp:(n,e)=>{e=H0(e)&&e.length===3?[...e,...e]:e;const[t,r,s,i,o,a]=e;n.stencilOpSeparate(1028,t,r,s),n.stencilOpSeparate(1029,i,o,a)},viewport:(n,e)=>n.viewport(...e)};function rn(n,e,t){return e[n]!==void 0?e[n]:t[n]}const PU={blendEquation:(n,e,t)=>n.blendEquationSeparate(rn(32777,e,t),rn(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(rn(32969,e,t),rn(32968,e,t),rn(32971,e,t),rn(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(rn(32824,e,t),rn(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(rn(32938,e,t),rn(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,rn(2962,e,t),rn(2967,e,t),rn(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,rn(34816,e,t),rn(36003,e,t),rn(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,rn(2964,e,t),rn(2965,e,t),rn(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,rn(34817,e,t),rn(34818,e,t),rn(34819,e,t))},Nb={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,s)=>n({32773:new Float32Array([e,t,r,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,s)=>n({32969:e,32968:t,32971:r,32970:s}),clearColor:(n,e,t,r,s)=>n({3106:new Float32Array([e,t,r,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,s)=>n({3107:[e,t,r,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,s)=>n({3088:new Int32Array([e,t,r,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(n,e,t,r,s)=>n({2978:[e,t,r,s]})},Cs=(n,e)=>n.isEnabled(e),Db={3042:Cs,2884:Cs,2929:Cs,3024:Cs,32823:Cs,32926:Cs,32928:Cs,3089:Cs,2960:Cs,35977:Cs},IU=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ac(n,e){if(kU(e))return;const t={};for(const s in e){const i=Number(s),o=CU[s];o&&(typeof o=="string"?t[o]=!0:o(n,e[s],i))}const r=n.state&&n.state.cache;if(r)for(const s in t){const i=PU[s];i(n,e,r)}}function RA(n,e=o1){if(typeof e=="number"){const s=e,i=Db[s];return i?i(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const s of t){const i=Db[s];r[s]=i?i(n,Number(s)):n.getParameter(Number(s))}return r}function MU(n){ac(n,o1)}function kU(n){for(const e in n)return!1;return!0}function OU(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class NU{constructor(e,{copyState:t=!1,log:r=()=>{}}={}){S(this,"gl");S(this,"program",null);S(this,"stateStack",[]);S(this,"enable",!0);S(this,"cache");S(this,"log");this.gl=e,this.cache=t?RA(e):Object.assign({},o1),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){jt(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];ac(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){jt(i!==void 0);const o=e[i],a=this.cache[i];OU(o,a)||(t=!0,r=a,s&&!(i in s)&&(s[i]=a),this.cache[i]=o)}return{valueChanged:t,oldValue:r}}}function xa(n){return n.state}function CA(n,e){const{enable:t=!0,copyState:r}=e;if(jt(r!==void 0),!n.state){n.state=new NU(n,{copyState:r}),LU(n);for(const i in Nb){const o=Nb[i];DU(n,i,o)}Lb(n,"getParameter"),Lb(n,"isEnabled")}const s=xa(n);return s.enable=t,n}function eg(n){let e=xa(n);e||(CA(n,{copyState:!1}),e=xa(n)),e.push()}function Bu(n){const e=xa(n);jt(e),e.pop()}function Lb(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||IU.has(s))return t(s);const i=xa(n);return s in i.cache||(i.cache[s]=t(s)),i.enable?i.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function DU(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...i){const o=xa(n),{valueChanged:a,oldValue:u}=t(o._updateCache,...i);return a&&r(...i),u},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function LU(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const s=xa(n);s.program!==r&&(e(r),s.program=r)}}const FU={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function BU(n,e){e={...FU,...e};let t=null;const r=i=>t=i.statusMessage||t;n.addEventListener("webglcontextcreationerror",r,!1);let s=null;if(s||(s=n.getContext("webgl2",e)),n.removeEventListener("webglcontextcreationerror",r,!1),!s)throw new Error(`Failed to create WebGL context: ${t||"Unknown error"}`);if(e.onContextLost){const{onContextLost:i}=e;n.addEventListener("webglcontextlost",o=>i(o),!1)}if(e.onContextRestored){const{onContextRestored:i}=e;n.addEventListener("webglcontextrestored",o=>i(o),!1)}return s}function xo(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function UU(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);xo(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,i=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=i||t,u=o||r,f=n.getParameter(7938),h=PA(a,u),p=VU(a,u),m=zU(a,u);return{type:"webgl",gpu:h,gpuType:m,gpuBackend:p,vendor:a,renderer:u,version:f,shadingLanguage:"glsl",shadingLanguageVersion:300}}function PA(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function VU(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function zU(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(PA(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function IA(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Hn="texture-compression-bc",Ot="texture-compression-astc",Ps="texture-compression-etc2",$U="texture-compression-etc1-webgl",Yh="texture-compression-pvrtc-webgl",X0="texture-compression-atc-webgl",Kc="float32-renderable-webgl",Y0="float16-renderable-webgl",jU="rgb9e5ufloat_renderable-webgl",q0="snorm8-renderable-webgl",Zc="norm16-renderable-webgl",K0="snorm16-renderable-webgl",qh="float32-filterable",Fb="float16-filterable-webgl",cu="WEBGL_compressed_texture_s3tc",uu="WEBGL_compressed_texture_s3tc_srgb",Tl="EXT_texture_compression_rgtc",Sl="EXT_texture_compression_bptc",WU="WEBGL_compressed_texture_etc",HU="WEBGL_compressed_texture_astc",XU="WEBGL_compressed_texture_etc1",YU="WEBGL_compressed_texture_pvrtc",qU="WEBGL_compressed_texture_atc",Bb="EXT_texture_norm16",Ub="EXT_render_snorm",KU="EXT_color_buffer_float",a1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Ub],"norm16-renderable-webgl":[Bb],"snorm16-renderable-webgl":[Bb,Ub],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[cu,uu,Tl,Sl],"texture-compression-bc5-webgl":[Tl],"texture-compression-bc7-webgl":[Sl],"texture-compression-etc2":[WU],"texture-compression-astc":[HU],"texture-compression-etc1-webgl":[XU],"texture-compression-pvrtc-webgl":[YU],"texture-compression-atc-webgl":[qU]};function ZU(n){return n in a1}function QU(n,e,t){return(a1[e]||[]).every(s=>xo(n,s,t))}const tg={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:q0},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:q0},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Y0,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Zc,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:K0},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:q0},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Y0,filter:Fb,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Zc},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:K0},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Kc,filter:qh},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:jU},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Kc,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Zc},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Zc},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Kc,filter:qh,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Y0,filter:Fb},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Zc,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:K0},"rgb32float-webgl":{gl:34837,render:Kc,filter:qh,gl2ext:KU,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Kc,filter:qh,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:cu,f:Hn},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:uu,f:Hn},"bc1-rgba-unorm":{gl:33777,x:cu,f:Hn},"bc1-rgba-unorm-srgb":{gl:35916,x:uu,f:Hn},"bc2-rgba-unorm":{gl:33778,x:cu,f:Hn},"bc2-rgba-unorm-srgb":{gl:35918,x:uu,f:Hn},"bc3-rgba-unorm":{gl:33779,x:cu,f:Hn},"bc3-rgba-unorm-srgb":{gl:35919,x:uu,f:Hn},"bc4-r-unorm":{gl:36283,x:Tl,f:Hn},"bc4-r-snorm":{gl:36284,x:Tl,f:Hn},"bc5-rg-unorm":{gl:36285,x:Tl,f:Hn},"bc5-rg-snorm":{gl:36286,x:Tl,f:Hn},"bc6h-rgb-ufloat":{gl:36495,x:Sl,f:Hn},"bc6h-rgb-float":{gl:36494,x:Sl,f:Hn},"bc7-rgba-unorm":{gl:36492,x:Sl,f:Hn},"bc7-rgba-unorm-srgb":{gl:36493,x:Sl,f:Hn},"etc2-rgb8unorm":{gl:37492,f:Ps},"etc2-rgb8unorm-srgb":{gl:37494,f:Ps},"etc2-rgb8a1unorm":{gl:37496,f:Ps},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Ps},"etc2-rgba8unorm":{gl:37493,f:Ps},"etc2-rgba8unorm-srgb":{gl:37495,f:Ps},"eac-r11unorm":{gl:37488,f:Ps},"eac-r11snorm":{gl:37489,f:Ps},"eac-rg11unorm":{gl:37490,f:Ps},"eac-rg11snorm":{gl:37491,f:Ps},"astc-4x4-unorm":{gl:37808,f:Ot},"astc-4x4-unorm-srgb":{gl:37840,f:Ot},"astc-5x4-unorm":{gl:37809,f:Ot},"astc-5x4-unorm-srgb":{gl:37841,f:Ot},"astc-5x5-unorm":{gl:37810,f:Ot},"astc-5x5-unorm-srgb":{gl:37842,f:Ot},"astc-6x5-unorm":{gl:37811,f:Ot},"astc-6x5-unorm-srgb":{gl:37843,f:Ot},"astc-6x6-unorm":{gl:37812,f:Ot},"astc-6x6-unorm-srgb":{gl:37844,f:Ot},"astc-8x5-unorm":{gl:37813,f:Ot},"astc-8x5-unorm-srgb":{gl:37845,f:Ot},"astc-8x6-unorm":{gl:37814,f:Ot},"astc-8x6-unorm-srgb":{gl:37846,f:Ot},"astc-8x8-unorm":{gl:37815,f:Ot},"astc-8x8-unorm-srgb":{gl:37847,f:Ot},"astc-10x5-unorm":{gl:37819,f:Ot},"astc-10x5-unorm-srgb":{gl:37851,f:Ot},"astc-10x6-unorm":{gl:37817,f:Ot},"astc-10x6-unorm-srgb":{gl:37849,f:Ot},"astc-10x8-unorm":{gl:37818,f:Ot},"astc-10x8-unorm-srgb":{gl:37850,f:Ot},"astc-10x10-unorm":{gl:37819,f:Ot},"astc-10x10-unorm-srgb":{gl:37851,f:Ot},"astc-12x10-unorm":{gl:37820,f:Ot},"astc-12x10-unorm-srgb":{gl:37852,f:Ot},"astc-12x12-unorm":{gl:37821,f:Ot},"astc-12x12-unorm-srgb":{gl:37853,f:Ot},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Yh},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Yh},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Yh},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Yh},"etc1-rbg-unorm-webgl":{gl:36196,f:$U},"atc-rgb-unorm-webgl":{gl:35986,f:X0},"atc-rgba-unorm-webgl":{gl:35986,f:X0},"atc-rgbai-unorm-webgl":{gl:34798,f:X0}},GU={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},JU={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function l1(n,e,t){const r=tg[e];if(!r||r.gl===void 0)return!1;const s=r.x||r.gl2ext;return s?!!xo(n,s,t):!0}function MA(n){const e=tg[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}function eV(n,e,t){if(!l1(n,e,t)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(k4(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!xo(n,"OES_texture_float_linear, extensions",t):e.endsWith("16float")?!!xo(n,"OES_texture_half_float_linear, extensions",t):!0}function tV(n,e,t){return!(!l1(n,e,t)||typeof e=="number")}function Jd(n){var s;const e=tg[n],t=MA(n),r=k4(n);return{format:t,dataFormat:(e==null?void 0:e.dataFormat)||rV(r.format,r.integer,r.normalized,t),type:r.dataType?IA(r.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:r.compressed}}function nV(n){const e=tg[n];if(!(e!=null&&e.attachment))throw new Error(`${n} is not a depth stencil format`);return e.attachment}function Vb(n){const e=Jd(n),t=GU[e.dataFormat]||4,r=JU[e.type]||1;return t*r}function rV(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;default:return 6408}}const zb={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class sV extends OF{constructor(t,r,s){super([],s);S(this,"gl");S(this,"extensions");S(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,xo(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),ZU(t)&&QU(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(zb),...Object.keys(a1)]}getWebGLFeature(t){const r=zb[t];return typeof r=="string"?!!xo(this.gl,r,this.extensions):!!r}}class iV extends kF{constructor(t){super();S(this,"gl");S(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}}function oo(n,e,t){if(oV(e))return t(n);const{nocatch:r=!0}=e;eg(n),ac(n,e);let s;if(r)s=t(n),Bu(n);else try{s=t(n)}finally{Bu(n)}return s}function oV(n){for(const e in n)return!1;return!0}function aV(n,e,t,r){if(Fd(e))return r(n);const s=n;eg(s.gl);try{return lV(n,e),ac(s.gl,t),r(n)}finally{Bu(s.gl)}}function lV(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(ua("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const i=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=ua("provokingVertex",e.provokingVertex,{first:36429,last:36430});i==null||i.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=ua("polygonMode",e.polygonMode,{fill:6914,line:6913});i==null||i.polygonModeWEBGL(1028,o),i==null||i.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(uV("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(E_("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Ce.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,i=E_("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,i,0,s),r.stencilFuncSeparate(1029,i,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Z0("stencilPassOperation",e.stencilPassOperation),i=Z0("stencilFailOperation",e.stencilFailOperation),o=Z0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,i,o,s),r.stencilOpSeparate(1029,i,o,s)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const s=$b("blendColorOperation",e.blendColorOperation||"add"),i=$b("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,i);const o=Kh("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Kh("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=Kh("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),f=Kh("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,u,f)}}function E_(n,e){return ua(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Z0(n,e){return ua(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function $b(n,e){return ua(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Kh(n,e){return ua(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function cV(n,e){return`Illegal parameter ${e} for ${n}`}function ua(n,e,t){if(!(e in t))throw new Error(cV(n,e));return t[e]}function uV(n,e){return e}function kA(n){const e={};return n.addressModeU&&(e[10242]=Q0(n.addressModeU)),n.addressModeV&&(e[10243]=Q0(n.addressModeV)),n.addressModeW&&(e[32882]=Q0(n.addressModeW)),n.magFilter&&(e[10240]=OA(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=fV(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=E_("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Q0(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function OA(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function fV(n,e){if(!e)return OA(n);switch(n){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class fo extends un{constructor(t,r={}){super(t,r);S(this,"device");S(this,"gl");S(this,"handle");S(this,"glTarget");S(this,"glUsage");S(this,"glIndexType",5123);S(this,"byteLength");S(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=hV(this.props.usage),this.glUsage=dV(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,s=t.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,s,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){jt(t>=0);let r=t;t===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const s=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,r),s}}function hV(n){return n&un.INDEX?34963:n&un.VERTEX?34962:n&un.UNIFORM?35345:34962}function dV(n){return n&un.INDEX||n&un.VERTEX?35044:n&un.UNIFORM?35048:35044}class A_ extends Vd{constructor(t,r){super(t,r);S(this,"device");S(this,"handle");S(this,"parameters");this.device=t,this.parameters=kA(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,s]of Object.entries(t)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,s);break;default:this.device.gl.samplerParameteri(this.handle,i,s);break}}}}class El extends Bd{constructor(t,r){super(t,{...Hr.defaultProps,...r});S(this,"device");S(this,"gl");S(this,"handle");S(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const pV={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Cu=class Cu extends Hr{constructor(t,r){var s;super(t,{...pV,format:"rgba8unorm",...r});S(this,"MAX_ATTRIBUTES");S(this,"device");S(this,"gl");S(this,"handle");S(this,"sampler");S(this,"view");S(this,"glFormat");S(this,"type");S(this,"dataFormat");S(this,"mipmaps");S(this,"target");S(this,"textureUnit");S(this,"loaded",!1);S(this,"_video");this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=gV(this.props),this.loaded=!1,typeof((s=this.props)==null?void 0:s.data)=="string"&&Object.assign(this.props,{data:x7(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new El(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let r=t.data;if(r instanceof Promise)return r.then(E=>this.initialize(Object.assign({},t,{pixels:E,data:E}))),this;const s=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(s&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;const{parameters:i={}}=t,{pixels:o=null,pixelStore:a={},textureUnit:u=void 0,mipmaps:f=!0}=t;r||(r=o);let{width:h,height:p,dataFormat:m,type:v,compressed:x=!1}=t;const{depth:w=0}=t,T=MA(t.format);return{width:h,height:p,compressed:x,dataFormat:m,type:v}=this._deduceParameters({format:t.format,type:v,dataFormat:m,compressed:x,data:r,width:h,height:p}),this.width=h,this.height=p,this.glFormat=T,this.type=v,this.dataFormat=m,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=f,this.setImageData({data:r,width:h,height:p,depth:w,format:t.format,type:v,dataFormat:m,parameters:a,compressed:x}),this.setSampler(t.sampler),this._setSamplerParameters(i),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),f&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),s&&(this._video={video:r,parameters:i,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(t){const{mipmaps:r=!0,parameters:s={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(s)}),this}setSampler(t={}){let r;t instanceof A_?(this.sampler=t,r=t.props):(this.sampler=new A_(this.device,t),r=t);const s=kA(r);return this._setSamplerParameters(s),this}resize(t){const{height:r,width:s,mipmaps:i=!1}=t;return s!==this.width||r!==this.height?this.initialize({width:s,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:t,parameters:r,lastTime:s}=this._video;if(s===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),oo(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:s=null,level:i=0,glFormat:o=this.glFormat,offset:a=0,parameters:u={}}=t;let{data:f=null,type:h=this.type,width:p=this.width,height:m=this.height,dataFormat:v=this.dataFormat,compressed:x=!1}=t;f||(f=s),{type:h,dataFormat:v,compressed:x,width:p,height:m}=this._deduceParameters({format:this.props.format,type:h,dataFormat:v,compressed:x,data:f,width:p,height:m});const{gl:w}=this;w.bindTexture(this.target,this.handle);let T=null;if({data:f,dataType:T}=this._getDataType({data:f,compressed:x}),oo(this.gl,u,()=>{switch(T){case"null":w.texImage2D(r,i,o,p,m,0,v,h,f);break;case"typed-array":w.texImage2D(r,i,o,p,m,0,v,h,f,a);break;case"buffer":this.device.gl.bindBuffer(35052,f.handle||f),this.device.gl.texImage2D(r,i,o,p,m,0,v,h,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":w.texImage2D(r,i,o,p,m,0,v,h,f);break;case"compressed":for(const[E,C]of f.entries())w.compressedTexImage2D(r,E,C.format,C.width,C.height,0,C.data);break;default:jt(!1,"Unknown image data type")}}),f&&f.byteLength)this.trackAllocatedMemory(f.byteLength,"Texture");else{const E=Vb(this.props.format);this.trackAllocatedMemory(this.width*this.height*E,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:r=null,data:s=null,x:i=0,y:o=0,width:a=this.width,height:u=this.height,level:f=0,glFormat:h=this.glFormat,type:p=this.type,dataFormat:m=this.dataFormat,compressed:v=!1,offset:x=0,parameters:w={}}){if({type:p,dataFormat:m,compressed:v,width:a,height:u}=this._deduceParameters({format:this.props.format,type:p,dataFormat:m,compressed:v,data:s,width:a,height:u}),jt(this.depth===1,"texSubImage not supported for 3D textures"),s||(s=r),s&&s.data){const T=s;s=T.data,a=T.shape[0],u=T.shape[1]}s instanceof fo&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),oo(this.gl,w,()=>{v?this.gl.compressedTexSubImage2D(t,f,i,o,a,u,h,s):s===null?this.gl.texSubImage2D(t,f,i,o,a,u,m,p,null):ArrayBuffer.isView(s)?this.gl.texSubImage2D(t,f,i,o,a,u,m,p,s,x):typeof WebGLBuffer<"u"&&s instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,s),this.device.gl.texSubImage2D(t,f,i,o,a,u,m,p,x),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,f,i,o,a,u,m,p,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return Ce.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType({data:t,compressed:r=!1}){return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof fo?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:r,data:s}=t;let{width:i,height:o,dataFormat:a,type:u,compressed:f}=t;const h=Jd(r);return a=a||h.dataFormat,u=u||h.type,f=f||h.compressed,{width:i,height:o}=this._deduceImageSize(s,i,o),{dataFormat:a,type:u,compressed:f,width:i,height:o,format:r,data:s}}_deduceImageSize(t,r,s){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:r,height:s}:i={width:r>=0?r:1,height:s>=0?s:1},jt(i,"Could not deduced texture size"),jt(r===void 0||i.width===r,"Deduced texture width does not match supplied width"),jt(s===void 0||i.height===s,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(t){const{gl:r}=this,{width:s,height:i,pixels:o,data:a,format:u=6408,type:f=5121}=t,h=o||a,p=await Promise.all(Cu.FACES.map(m=>{const v=h[m];return Promise.all(Array.isArray(v)?v:[v])}));this.bind(),Cu.FACES.forEach((m,v)=>{p[v].length>1&&this.props.mipmaps!==!1&&Ce.warn(`${this.id} has mipmap and multiple LODs.`)(),p[v].forEach((x,w)=>{s&&i?r.texImage2D(m,w,u,s,i,0,u,f,x):r.texImage2D(m,w,u,u,f,x)})}),this.unbind()}setImageDataForFace(t){const{face:r,width:s,height:i,pixels:o,data:a,format:u=6408,type:f=5121}=t,{gl:h}=this,p=o||a;return this.bind(),p instanceof Promise?p.then(m=>this.setImageDataForFace(Object.assign({},t,{face:r,data:m,pixels:m}))):this.width||this.height?h.texImage2D(r,0,u,s,i,0,u,f,p):h.texImage2D(r,0,u,u,f,p),this}setImageData3D(t){const{level:r=0,dataFormat:s,format:i,type:o,width:a,height:u,depth:f=1,offset:h=0,data:p,parameters:m={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const v=Jd(i);if(oo(this.gl,m,()=>{ArrayBuffer.isView(p)&&this.gl.texImage3D(this.target,r,v.format,a,u,f,0,v.dataFormat,v.type,p),p instanceof fo&&(this.gl.bindBuffer(35052,p.handle),this.gl.texImage3D(this.target,r,s,a,u,f,0,i,o,h))}),p&&p.byteLength)this.trackAllocatedMemory(p.byteLength,"Texture");else{const x=Vb(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*x,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!Fd(t)){mV(t),this.gl.bindTexture(this.target,this.handle);for(const[r,s]of Object.entries(t)){const i=Number(r),o=s;switch(i){case 33082:case 33083:this.gl.texParameterf(this.target,i,o);break;default:this.gl.texParameteri(this.target,i,o);break}}this.gl.bindTexture(this.target,null)}}};S(Cu,"FACES",[34069,34070,34071,34072,34073,34074]);let Ds=Cu;function gV(n){switch(n.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(n.dimension)}}function mV(n){Ce.log(1,"texture sampler parameters",n)()}class bu extends zd{constructor(t,r){super(t,r);S(this,"device");S(this,"gl");S(this,"handle");const s=r.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),!s){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const i=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],u=36064+o;a&&this._attachOne(u,a)}if(this.depthStencilAttachment&&this._attachOne(nV(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${_V(o)}`)}this.gl.bindFramebuffer(36160,i)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new Ds(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const s of this.colorAttachments)s.texture.resize({width:t,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:r}),this}_attachOne(t,r){if(Array.isArray(r)){const[s,i=0,o=0]=r;return this._attachTexture(t,s,i,o),s}if(r instanceof Ds)return this._attachTexture(t,r,0,0),r;if(r instanceof El){const s=r;return this._attachTexture(t,s.texture,s.props.baseMipLevel,s.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(t,r,s,i){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,t,r.target,i,s);break;case 34067:const a=vV(s);o.framebufferTexture2D(36160,t,a,r.handle,i);break;case 3553:o.framebufferTexture2D(36160,t,3553,r.handle,i);break;default:jt(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function vV(n){return n<34069?n+34069:n}function _V(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class yV extends qy{constructor(t,r){super(r);S(this,"device");S(this,"presentationSize");S(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new bu(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}const xV={spector:Ce.get("spector")||Ce.get("spectorjs")},wV="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",bV=1;let Nt=null,jb=!1;async function TV(n){if(!globalThis.SPECTOR)try{await V4(wV)}catch(e){Ce.warn(String(e))}}function SV(n){if(n={...xV,...n},!(n!=null&&n.spector)||(!Nt&&globalThis.SPECTOR&&(Ce.probe(bV,"SPECTOR found and initialized")(),Nt=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Nt)),!Nt))return null;if(jb||(jb=!0,Nt.spyCanvases(),Nt==null||Nt.onCaptureStarted.add(e=>Ce.info("Spector capture started:",e)()),Nt==null||Nt.onCapture.add(e=>{Ce.info("Spector capture complete:",e)(),Nt==null||Nt.getResultUI(),Nt==null||Nt.resultView.display(),Nt==null||Nt.resultView.addCapture(e)})),n!=null&&n.canvas){if(typeof n.spector=="string"&&n.spector!==n.canvas.id)return Nt;Nt==null||Nt.startCapture(n==null?void 0:n.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Ce.info("Spector capture stopped after 2 seconds")(),Nt==null||Nt.stopCapture()})}return Nt}const EV="https://unpkg.com/webgl-debug@2.0.1/index.js";function NA(n){return n.luma=n.luma||{},n.luma}async function AV(){Eo()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await V4(EV))}function RV(n,e={}){return n?e.debug?PV(n,e):CV(n):null}function CV(n){const e=NA(n);return e.realContext?e.realContext:n}function PV(n,e){if(!globalThis.WebGLDebugUtils)return Ce.warn("webgl-debug not loaded")(),n;const t=NA(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...pt,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,IV.bind(null,e),MV.bind(null,e));for(const o in pt)!(o in r)&&typeof pt[o]=="number"&&(r[o]=pt[o]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,r);const i=Object.create(s);return t.realContext=n,t.debugContext=i,i.debug=!0,i}function G0(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function IV(n,e,t,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),o=`${s} in gl.${t}(${i})`;Ce.error(o)();debugger;if(n.throwOnError)throw new Error(o)}function MV(n,e,t){let r="";if(Ce.level>=1&&(r=G0(e,t),Ce.log(1,r)()),n.break&&n.break.length>0&&(r=r||G0(e,t),n.break.every(i=>r.indexOf(i)!==-1)))debugger;for(const s of t)if(s===void 0){if(r=r||G0(e,t),n.throwOnError)throw new Error(`Undefined argument: ${r}`);Ce.error(`Undefined argument: ${r}`)();debugger}}function kV(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[p,m]=s;t.push({message:m.trim(),type:Wb(p),lineNum:0,linePos:0});continue}const[i,o,a,...u]=s;let f=parseInt(a,10);isNaN(f)&&(f=0);let h=parseInt(o,10);isNaN(h)&&(h=0),t.push({message:u.join(":").trim(),type:Wb(i),lineNum:f,linePos:h})}return t}function Wb(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class OV extends Ud{constructor(t,r){super(t,r);S(this,"device");S(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return kV(t)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(t){t=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(t);const{gl:s}=this.device;if(s.shaderSource(this.handle,t),s.compileShader(this.handle),Ce.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Ce.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ce.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const NV=256,DV=1024,LV=16384,J0=6144,FV=[1,2,4,8];class BV extends l_{constructor(t,r){super(t,r);S(this,"device");S(this,"glParameters");this.device=t,eg(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Bu(this.device.gl)}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=FV.map(s=>!!(s&t.colorMask))),this.glParameters=r,ac(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=LV,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=NV,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=DV,t.clearStencil=this.props.clearStencil),r!==0&&oo(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){oo(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(J0,t,r);break;case Uint32Array:this.device.gl.clearBufferuiv(J0,t,r);break;case Float32Array:default:this.device.gl.clearBufferfv(J0,t,r);break}})}}const UV="Failed to deduce GL constant from typed array";function VV(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(UV)}}function R_(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const zV={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},$V={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Tu{constructor(...e){S(this,"offset");S(this,"stride");S(this,"type");S(this,"size");S(this,"divisor");S(this,"normalized");S(this,"integer");S(this,"buffer");S(this,"index");e.forEach(t=>this._assign(t)),Object.freeze(this)}static getBytesPerElement(e){return R_(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return jt(e.size),R_(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Tu(zV,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Tu.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Tu.getBytesPerVertex(this)}_assign(e={}){return e=_7("Accessor",e,$V),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function jV(n){return WV.includes(n)}const WV=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],DA={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function LA(n){const e=DA[n];if(!e)throw new Error("uniform");const[t,r,,s]=e;return{format:s,components:r,glType:t}}function HV(n){const e=DA[n];if(!e)throw new Error("attribute");const[,t,,r,s]=e;return{attributeType:r,vertexFormat:s,components:t}}function XV(n,e){const t={attributes:[],bindings:[]};t.attributes=YV(n,e);const r=ZV(n,e);for(const a of r){const u=a.uniforms.map(f=>({name:f.name,format:f.format,byteOffset:f.byteOffset,byteStride:f.byteStride,arrayLength:f.arrayLength}));t.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:u})}const s=KV(n,e);let i=0;for(const a of s)if(jV(a.type)){const{viewDimension:u,sampleType:f}=GV(a.type);t.bindings.push({type:"texture",name:a.name,location:i,viewDimension:u,sampleType:f}),a.textureUnit=i,i+=1}s.length&&(t.uniforms=s);const o=qV(n,e);return o!=null&&o.length&&(t.varyings=o),t}function YV(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let s=0;s<r;s++){const i=n.getActiveAttrib(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a}=i,u=n.getAttribLocation(e,o);if(u>=0){const{attributeType:f}=HV(a),h=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:u,stepMode:h,type:f})}}return t.sort((s,i)=>s.location-i.location),t}function qV(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let s=0;s<r;s++){const i=n.getTransformFeedbackVarying(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a,size:u}=i,{glType:f,components:h}=LA(a),p=new Tu({type:f,size:u*h}),m={location:s,name:o,accessor:p};t.push(m)}return t.sort((s,i)=>s.location-i.location),t}function KV(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let s=0;s<r;s++){const i=n.getActiveUniform(e,s);if(!i)throw new Error("activeInfo");const{name:o,size:a,type:u}=i,{name:f,isArray:h}=JV(o);let p=n.getUniformLocation(e,f);const m={location:p,name:f,size:a,type:u,isArray:h};if(t.push(m),m.size>1)for(let v=0;v<m.size;v++){const x=`${f}[${v}]`;p=n.getUniformLocation(e,x);const w={...m,name:x,location:p};t.push(w)}}return t}function ZV(n,e){const t=(i,o)=>n.getActiveUniformBlockParameter(e,i,o),r=[],s=n.getProgramParameter(e,35382);for(let i=0;i<s;i++){const o={name:n.getActiveUniformBlockName(e,i)||"",location:t(i,35391),byteLength:t(i,35392),vertex:t(i,35396),fragment:t(i,35398),uniformCount:t(i,35394),uniforms:[]},a=t(i,35395)||[],u=n.getActiveUniforms(e,a,35383),f=n.getActiveUniforms(e,a,35384),h=n.getActiveUniforms(e,a,35387),p=n.getActiveUniforms(e,a,35388);for(let m=0;m<o.uniformCount;++m){const v=n.getActiveUniform(e,a[m]);if(!v)throw new Error("activeInfo");o.uniforms.push({name:v.name,format:LA(u[m]).format,type:u[m],arrayLength:f[m],byteOffset:h[m],byteStride:p[m]})}r.push(o)}return r.sort((i,o)=>i.location-o.location),r}const QV={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function GV(n){const e=QV[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function JV(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function ez(n,e,t,r){const s=n;let i=r;i===!0&&(i=1),i===!1&&(i=0);const o=typeof i=="number"?[i]:i;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function tz(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(n)}}function nz(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(n)}}const Hb=4;class rz extends Yl{constructor(t,r){super(t,r);S(this,"device");S(this,"handle");S(this,"vs");S(this,"fs");S(this,"introspectedLayout");S(this,"uniforms",{});S(this,"bindings",{});S(this,"varyings",null);S(this,"_uniformCount",0);S(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:i=35981}=r;switch(s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,i)),this._linkShaders(),Ce.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=XV(this.device.gl,this.handle),Ce.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=i7(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Ce.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[s,i]of Object.entries(t)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||Ce.warn(`Unknown binding "${s}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(i||Ce.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof fo)&&!(i.buffer instanceof fo))throw new Error("buffer value");break;case"texture":if(!(i instanceof El||i instanceof Ds||i instanceof bu))throw new Error("texture value");break;case"sampler":Ce.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=i}}draw(t){var T;const{renderPass:r,parameters:s=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:u,isInstanced:f=!1,firstVertex:h=0,transformFeedback:p}=t,m=tz(i),v=!!o.indexBuffer,x=(T=o.indexBuffer)==null?void 0:T.glIndexType;if(this.linkStatus!=="success")return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return aV(this.device,s,w.glParameters,()=>{v&&f?this.device.gl.drawElementsInstanced(m,a||0,x,h,u||0):v?this.device.gl.drawElements(m,a||0,x,h):f?this.device.gl.drawArraysInstanced(m,h,a||0,u||0):this.device.gl.drawArrays(m,h,a||0),p&&p.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=Ky(t);Object.keys(r).forEach(s=>{Ce.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Ce.time(Hb,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Ce.timeEnd(Hb,`linkProgram for ${this.id}`)(),Ce.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}Ce.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ce.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(t){var r;switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Ds&&(r.update(),t=t&&r.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,s=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:a}=i,u=t.getUniformBlockIndex(this.handle,a);if(u===4294967295)throw new Error(`Invalid uniform block name ${a}`);t.uniformBlockBinding(this.handle,s,u),o instanceof fo?t.bindBufferBase(35345,s,o.handle):t.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof El||o instanceof Ds||o instanceof bu))throw new Error("texture");let f;if(o instanceof El)f=o.texture;else if(o instanceof Ds)f=o;else if(o instanceof bu&&o.colorAttachments[0]instanceof El)Ce.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(f.target,f.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:i,textureUnit:o}=t,a=this.uniforms[r]??o;a!==void 0&&ez(this.device.gl,s,i,a)}}}class sz extends u_{constructor(t){super(t,{});S(this,"device");S(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":iz(this.device,r.options);break;case"copy-buffer-to-texture":oz(this.device,r.options);break;case"copy-texture-to-buffer":az(this.device,r.options);break;case"copy-texture-to-texture":lz(this.device,r.options);break}}}function iz(n,e){const t=e.source,r=e.destination;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function oz(n,e){throw new Error("Not implemented")}function az(n,e){const{source:t,mipLevel:r=0,aspect:s="all",width:i=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:u=[0,0],destination:f,byteOffset:h=0,bytesPerRow:p,rowsPerImage:m}=e;if(s!=="all")throw new Error("not supported");if(r!==0||a!==0||p||m)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:x}=FA(t);let w;try{const T=f,E=i||v.width,C=o||v.height,P=Jd(v.texture.props.format),L=P.dataFormat,I=P.type;n.gl.bindBuffer(35051,T.handle),w=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(u[0],u[1],E,C,L,I,h)}finally{n.gl.bindBuffer(35051,null),w!==void 0&&n.gl.bindFramebuffer(36160,w),x&&v.destroy()}}function lz(n,e){const{source:t,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:i=[0,0],destination:o}=e;let{width:a=e.destination.width,height:u=e.destination.height}=e;const{framebuffer:f,destroyFramebuffer:h}=FA(t),[p,m]=s,[v,x,w]=i,T=n.gl.bindFramebuffer(36160,f.handle);let E=null,C;if(o instanceof Ds)E=o,a=Number.isFinite(a)?a:E.width,u=Number.isFinite(u)?u:E.height,E.bind(0),C=E.target;else throw new Error("invalid destination");switch(C){case 3553:case 34067:n.gl.copyTexSubImage2D(C,r,v,x,p,m,a,u);break;case 35866:case 32879:n.gl.copyTexSubImage3D(C,r,v,x,w,p,m,a,u);break}E&&E.unbind(),n.gl.bindFramebuffer(36160,T),h&&f.destroy()}function FA(n){if(n instanceof Hr){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class cz extends c_{constructor(t,r){super(t,r);S(this,"device");S(this,"commandBuffer");this.device=t,this.commandBuffer=new sz(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,s){}}class c1 extends f_{constructor(t,r){super(t,r);S(this,"device");S(this,"handle");S(this,"buffer",null);S(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return v8()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:a,offset:u,normalized:f,integer:h,divisor:p}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),h?this.device.gl.vertexAttribIPointer(t,i,o,a,u):this.device.gl.vertexAttribPointer(t,i,o,f,a,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,p||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const s=IA(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const i=c1.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const s=uz(r),i=s.byteLength*t,o=s.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),a=a||!fz(s,this.bufferValue),a){const u=c7(r.constructor,o);u7({target:u,source:s,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function uz(n){return Array.isArray(n)?new Float32Array(n):n}function fz(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class hz extends h_{constructor(t,r){super(t,r);S(this,"device");S(this,"gl");S(this,"handle");S(this,"layout");S(this,"buffers",{});S(this,"unusedBuffers",{});S(this,"bindOnUse",!0);S(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(nz(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const s=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(s<0){this.unusedBuffers[t]=i,Ce.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:i,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,i,a,o)}getBuffer(t){if(Xb(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof fo)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:s=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:s,byteLength:i}}_getVaryingIndex(t){if(Xb(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:s,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,s=0,i){const o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,s,i)}}function Xb(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class dz extends d_{constructor(t,r){super(t,r);S(this,"device");S(this,"handle");S(this,"target",null);S(this,"_queryPending",!1);S(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,i)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function BA(n){switch(n){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return jt(!1),0}}function pz(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return jt(!1),0}}function gz(n,e){var T,E;const{sourceX:t=0,sourceY:r=0,sourceFormat:s=6408,sourceAttachment:i=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:u,sourceType:f}=e||{};const{framebuffer:h,deleteFramebuffer:p}=UA(n);jt(h);const{gl:m,handle:v}=h;a=a||h.width,u=u||h.height;const x=i-36064;f=f||((E=(T=h.colorAttachments[x])==null?void 0:T.texture)==null?void 0:E.type)||5121,o=_z(o,f,s,a,u),f=f||VV(o);const w=m.bindFramebuffer(36160,v);return m.readPixels(t,r,a,u,s,f,o),m.bindFramebuffer(36160,w||null),p&&h.destroy(),o}function mz(n,e){const{target:t,sourceX:r=0,sourceY:s=0,sourceFormat:i=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:u,sourceType:f}=e||{};const{framebuffer:h,deleteFramebuffer:p}=UA(n);jt(h),a=a||h.width,u=u||h.height;const m=h;f=f||5121;let v=t;if(!v){const w=BA(i),T=pz(f),E=o+a*u*w*T;v=m.device.createBuffer({byteLength:E})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({source:n,width:a,height:u,origin:[r,s],destination:v,byteOffset:o}),x.destroy(),p&&h.destroy(),v}function UA(n){return n instanceof zd?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:vz(n),deleteFramebuffer:!0}}function vz(n,e){const{device:t,width:r,height:s,id:i}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${i}`,width:r,height:s,colorAttachments:[n]})}function _z(n,e,t,r,s){if(n)return n;e=e||5121;const i=R_(e,{clamped:!1}),o=BA(t);return new i(r*s*o)}const yz=256,xz=1024,wz=16384,bz="clear: bad arguments";function Tz(n,e){const{framebuffer:t=null,color:r=null,depth:s=null,stencil:i=null}=e||{},o={};t&&(o.framebuffer=t);let a=0;r&&(a|=wz,r!==!0&&(o.clearColor=r)),s&&(a|=yz,s!==!0&&(o.clearDepth=s)),i&&(a|=xz,s!==!0&&(o.clearStencil=s)),jt(a!==0,bz);const u=n.gl;oo(u,o,()=>{u.clear(a)})}const Qc=1,Zo=class Zo extends Xl{constructor(t){var f,h;super({...t,id:t.id||Pa("webgl-device")});S(this,"type","webgl");S(this,"handle");S(this,"features");S(this,"limits");S(this,"info");S(this,"canvasContext");S(this,"lost");S(this,"_resolveContextLost");S(this,"renderPass",null);S(this,"gl");S(this,"debug",!1);S(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});S(this,"_extensions",{});S(this,"_polyfilled",!1);S(this,"spectorJS");S(this,"_constants");const r=(f=t.gl)==null?void 0:f.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const s=((h=t.gl)==null?void 0:h.canvas)||t.canvas,i=!t.gl;this.canvasContext=new yV(this,{...t,autoResize:i,canvas:s}),this.lost=new Promise(p=>{this._resolveContextLost=p});let o=t.gl||null;if(o||(o=BU(this.canvasContext.canvas,{...t,onContextLost:p=>{var m;return(m=this._resolveContextLost)==null?void 0:m.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!o)throw new Error("WebGL context creation failed");this.handle=o,this.gl=o,this.gl.device=this,this.gl._version=2,t.spector&&(this.spectorJS=SV({...this.props,canvas:this.handle.canvas})),this.info=UU(this.gl,this._extensions),this.limits=new iV(this.gl),this.features=new sV(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),i&&this.canvasContext.resize();const{enable:a=!0,copyState:u=!1}=t;CA(this.gl,{enable:a,copyState:u}),t.debug&&(this.gl=RV(this.gl,{...t,throwOnError:!0}),this.debug=!0,Ce.level=Math.max(Ce.level,1),Ce.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof Zo)return t;if((t==null?void 0:t.device)instanceof Xl)return t.device;if(!Sz(t))throw new Error("Invalid WebGL2RenderingContext");return new Zo({gl:t})}static async create(t={}){var a;Ce.groupCollapsed(Qc,"WebGLDevice created")();const r=[];t.debug&&r.push(AV()),t.spector&&r.push(TV()),typeof t.canvas=="string"&&r.push(qy.pageLoaded);const s=await Promise.allSettled(r);for(const u of s)u.status==="rejected"&&Ce.error(`Failed to initialize debug libraries ${u.reason}`)();if(Ce.probe(Qc+1,"DOM is loaded")(),(a=t.gl)!=null&&a.device)return Ce.warn("reattaching existing device")(),Zo.attach(t.gl);const i=new Zo(t),o=`Created ${i.type}${i.debug?" debug":""} context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return Ce.probe(Qc,o)(),Ce.table(Qc,i.info)(),Ce.groupEnd(Qc)(),i}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return l1(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return eV(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return tV(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._getBufferProps(t);return new fo(this,r)}_createTexture(t){return new Ds(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new A_(this,t)}createShader(t){return new OV(this,t)}createFramebuffer(t){return new bu(this,t)}createVertexArray(t){return new c1(this,t)}createTransformFeedback(t){return new hz(this,t)}createQuerySet(t){return new dz(this,t)}createRenderPipeline(t){return new rz(this,t)}beginRenderPass(t){return new BV(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t){return new cz(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return gz(t,r)}readPixelsToBufferWebGL(t,r){return mz(t,r)}setParametersWebGL(t){ac(this.gl,t)}getParametersWebGL(t){return RA(this.gl,t)}withParametersWebGL(t,r){return oo(this.gl,t,r)}clearWebGL(t){Tz(this,t)}resetWebGL(){Ce.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),MU(this.gl)}loseDevice(){var i;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(i=this._resolveContextLost)==null||i.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){eg(this.gl)}popState(){Bu(this.gl)}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){r=r||this.gl2||this.gl;const s=Number(t);for(const i in r)if(r[i]===s)return`GL.${i}`;return String(t)}setConstantAttributeWebGL(t,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const i=this._constants[t];switch(i&&Cz(i,r)&&Ce.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:Ez(this,t,r);break;case Int32Array:Az(this,t,r);break;case Uint32Array:Rz(this,t,r);break;default:jt(!1)}}getExtension(t){return xo(this.gl,t,this._extensions),this._extensions}};S(Zo,"type","webgl");let Su=Zo;function Sz(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}function Ez(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break;default:jt(!1)}}function Az(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Rz(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Cz(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var ev={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var Yb;function Pz(){return Yb||(Yb=1,function(n){(function(e,t,r,s){var i=["","webkit","Moz","MS","ms","o"],o=t.createElement("div"),a="function",u=Math.round,f=Math.abs,h=Date.now;function p(R,M,$){return setTimeout(P(R,$),M)}function m(R,M,$){return Array.isArray(R)?(v(R,$[M],$),!0):!1}function v(R,M,$){var ue;if(R)if(R.forEach)R.forEach(M,$);else if(R.length!==s)for(ue=0;ue<R.length;)M.call($,R[ue],ue,R),ue++;else for(ue in R)R.hasOwnProperty(ue)&&M.call($,R[ue],ue,R)}function x(R,M,$){var ue="DEPRECATED METHOD: "+M+`
`+$+` AT 
`;return function(){var ye=new Error("get-stack-trace"),Ne=ye&&ye.stack?ye.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",at=e.console&&(e.console.warn||e.console.log);return at&&at.call(e.console,ue,Ne),R.apply(this,arguments)}}var w;typeof Object.assign!="function"?w=function(M){if(M===s||M===null)throw new TypeError("Cannot convert undefined or null to object");for(var $=Object(M),ue=1;ue<arguments.length;ue++){var ye=arguments[ue];if(ye!==s&&ye!==null)for(var Ne in ye)ye.hasOwnProperty(Ne)&&($[Ne]=ye[Ne])}return $}:w=Object.assign;var T=x(function(M,$,ue){for(var ye=Object.keys($),Ne=0;Ne<ye.length;)(!ue||ue&&M[ye[Ne]]===s)&&(M[ye[Ne]]=$[ye[Ne]]),Ne++;return M},"extend","Use `assign`."),E=x(function(M,$){return T(M,$,!0)},"merge","Use `assign`.");function C(R,M,$){var ue=M.prototype,ye;ye=R.prototype=Object.create(ue),ye.constructor=R,ye._super=ue,$&&w(ye,$)}function P(R,M){return function(){return R.apply(M,arguments)}}function L(R,M){return typeof R==a?R.apply(M&&M[0]||s,M):R}function I(R,M){return R===s?M:R}function F(R,M,$){v(le(M),function(ue){R.addEventListener(ue,$,!1)})}function j(R,M,$){v(le(M),function(ue){R.removeEventListener(ue,$,!1)})}function q(R,M){for(;R;){if(R==M)return!0;R=R.parentNode}return!1}function Q(R,M){return R.indexOf(M)>-1}function le(R){return R.trim().split(/\s+/g)}function he(R,M,$){if(R.indexOf&&!$)return R.indexOf(M);for(var ue=0;ue<R.length;){if($&&R[ue][$]==M||!$&&R[ue]===M)return ue;ue++}return-1}function pe(R){return Array.prototype.slice.call(R,0)}function ne(R,M,$){for(var ue=[],ye=[],Ne=0;Ne<R.length;){var at=R[Ne][M];he(ye,at)<0&&ue.push(R[Ne]),ye[Ne]=at,Ne++}return ue=ue.sort(function(hn,pn){return hn[M]>pn[M]}),ue}function ve(R,M){for(var $,ue,ye=M[0].toUpperCase()+M.slice(1),Ne=0;Ne<i.length;){if($=i[Ne],ue=$?$+ye:M,ue in R)return ue;Ne++}return s}var Me=1;function U(){return Me++}function H(R){var M=R.ownerDocument||R;return M.defaultView||M.parentWindow||e}var N=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in e,k=ve(e,"PointerEvent")!==s,b=Y&&N.test(navigator.userAgent),O="touch",W="pen",K="mouse",ee="kinect",te=25,ce=1,me=2,xe=4,Pe=8,Ue=1,Ke=2,tt=4,Qe=8,He=16,Ie=Ke|tt,lt=Qe|He,_n=Ie|lt,Vt=["x","y"],It=["clientX","clientY"];function ht(R,M){var $=this;this.manager=R,this.callback=M,this.element=R.element,this.target=R.options.inputTarget,this.domHandler=function(ue){L(R.options.enable,[R])&&$.handler(ue)},this.init()}ht.prototype={handler:function(){},init:function(){this.evEl&&F(this.element,this.evEl,this.domHandler),this.evTarget&&F(this.target,this.evTarget,this.domHandler),this.evWin&&F(H(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(H(this.element),this.evWin,this.domHandler)}};function ot(R){var M,$=R.options.inputClass;return $?M=$:k?M=ar:b?M=Xe:Y?M=wn:M=Rn,new M(R,Pt)}function Pt(R,M,$){var ue=$.pointers.length,ye=$.changedPointers.length,Ne=M&ce&&ue-ye===0,at=M&(xe|Pe)&&ue-ye===0;$.isFirst=!!Ne,$.isFinal=!!at,Ne&&(R.session={}),$.eventType=M,Ft(R,$),R.emit("hammer.input",$),R.recognize($),R.session.prevInput=$}function Ft(R,M){var $=R.session,ue=M.pointers,ye=ue.length;$.firstInput||($.firstInput=Nr(M)),ye>1&&!$.firstMultiple?$.firstMultiple=Nr(M):ye===1&&($.firstMultiple=!1);var Ne=$.firstInput,at=$.firstMultiple,fn=at?at.center:Ne.center,hn=M.center=Kt(ue);M.timeStamp=h(),M.deltaTime=M.timeStamp-Ne.timeStamp,M.angle=xr(fn,hn),M.distance=Bt(fn,hn),An($,M),M.offsetDirection=On(M.deltaX,M.deltaY);var pn=gt(M.deltaTime,M.deltaX,M.deltaY);M.overallVelocityX=pn.x,M.overallVelocityY=pn.y,M.overallVelocity=f(pn.x)>f(pn.y)?pn.x:pn.y,M.scale=at?mi(at.pointers,ue):1,M.rotation=at?ir(at.pointers,ue):0,M.maxPointers=$.prevInput?M.pointers.length>$.prevInput.maxPointers?M.pointers.length:$.prevInput.maxPointers:M.pointers.length,yn($,M);var bn=R.element;q(M.srcEvent.target,bn)&&(bn=M.srcEvent.target),M.target=bn}function An(R,M){var $=M.center,ue=R.offsetDelta||{},ye=R.prevDelta||{},Ne=R.prevInput||{};(M.eventType===ce||Ne.eventType===xe)&&(ye=R.prevDelta={x:Ne.deltaX||0,y:Ne.deltaY||0},ue=R.offsetDelta={x:$.x,y:$.y}),M.deltaX=ye.x+($.x-ue.x),M.deltaY=ye.y+($.y-ue.y)}function yn(R,M){var $=R.lastInterval||M,ue=M.timeStamp-$.timeStamp,ye,Ne,at,fn;if(M.eventType!=Pe&&(ue>te||$.velocity===s)){var hn=M.deltaX-$.deltaX,pn=M.deltaY-$.deltaY,bn=gt(ue,hn,pn);Ne=bn.x,at=bn.y,ye=f(bn.x)>f(bn.y)?bn.x:bn.y,fn=On(hn,pn),R.lastInterval=M}else ye=$.velocity,Ne=$.velocityX,at=$.velocityY,fn=$.direction;M.velocity=ye,M.velocityX=Ne,M.velocityY=at,M.direction=fn}function Nr(R){for(var M=[],$=0;$<R.pointers.length;)M[$]={clientX:u(R.pointers[$].clientX),clientY:u(R.pointers[$].clientY)},$++;return{timeStamp:h(),pointers:M,center:Kt(M),deltaX:R.deltaX,deltaY:R.deltaY}}function Kt(R){var M=R.length;if(M===1)return{x:u(R[0].clientX),y:u(R[0].clientY)};for(var $=0,ue=0,ye=0;ye<M;)$+=R[ye].clientX,ue+=R[ye].clientY,ye++;return{x:u($/M),y:u(ue/M)}}function gt(R,M,$){return{x:M/R||0,y:$/R||0}}function On(R,M){return R===M?Ue:f(R)>=f(M)?R<0?Ke:tt:M<0?Qe:He}function Bt(R,M,$){$||($=Vt);var ue=M[$[0]]-R[$[0]],ye=M[$[1]]-R[$[1]];return Math.sqrt(ue*ue+ye*ye)}function xr(R,M,$){$||($=Vt);var ue=M[$[0]]-R[$[0]],ye=M[$[1]]-R[$[1]];return Math.atan2(ye,ue)*180/Math.PI}function ir(R,M){return xr(M[1],M[0],It)+xr(R[1],R[0],It)}function mi(R,M){return Bt(M[0],M[1],It)/Bt(R[0],R[1],It)}var Co={mousedown:ce,mousemove:me,mouseup:xe},$s="mousedown",Ze="mousemove mouseup";function Rn(){this.evEl=$s,this.evWin=Ze,this.pressed=!1,ht.apply(this,arguments)}C(Rn,ht,{handler:function(M){var $=Co[M.type];$&ce&&M.button===0&&(this.pressed=!0),$&me&&M.which!==1&&($=xe),this.pressed&&($&xe&&(this.pressed=!1),this.callback(this.manager,$,{pointers:[M],changedPointers:[M],pointerType:K,srcEvent:M}))}});var js={pointerdown:ce,pointermove:me,pointerup:xe,pointercancel:Pe,pointerout:Pe},Gr={2:O,3:W,4:K,5:ee},xn="pointerdown",or="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(xn="MSPointerDown",or="MSPointerMove MSPointerUp MSPointerCancel");function ar(){this.evEl=xn,this.evWin=or,ht.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}C(ar,ht,{handler:function(M){var $=this.store,ue=!1,ye=M.type.toLowerCase().replace("ms",""),Ne=js[ye],at=Gr[M.pointerType]||M.pointerType,fn=at==O,hn=he($,M.pointerId,"pointerId");Ne&ce&&(M.button===0||fn)?hn<0&&($.push(M),hn=$.length-1):Ne&(xe|Pe)&&(ue=!0),!(hn<0)&&($[hn]=M,this.callback(this.manager,Ne,{pointers:$,changedPointers:[M],pointerType:at,srcEvent:M}),ue&&$.splice(hn,1))}});var Dr={touchstart:ce,touchmove:me,touchend:xe,touchcancel:Pe},vi="touchstart",ka="touchstart touchmove touchend touchcancel";function _i(){this.evTarget=vi,this.evWin=ka,this.started=!1,ht.apply(this,arguments)}C(_i,ht,{handler:function(M){var $=Dr[M.type];if($===ce&&(this.started=!0),!!this.started){var ue=Po.call(this,M,$);$&(xe|Pe)&&ue[0].length-ue[1].length===0&&(this.started=!1),this.callback(this.manager,$,{pointers:ue[0],changedPointers:ue[1],pointerType:O,srcEvent:M})}}});function Po(R,M){var $=pe(R.touches),ue=pe(R.changedTouches);return M&(xe|Pe)&&($=ne($.concat(ue),"identifier")),[$,ue]}var Oa={touchstart:ce,touchmove:me,touchend:xe,touchcancel:Pe},ze="touchstart touchmove touchend touchcancel";function Xe(){this.evTarget=ze,this.targetIds={},ht.apply(this,arguments)}C(Xe,ht,{handler:function(M){var $=Oa[M.type],ue=At.call(this,M,$);ue&&this.callback(this.manager,$,{pointers:ue[0],changedPointers:ue[1],pointerType:O,srcEvent:M})}});function At(R,M){var $=pe(R.touches),ue=this.targetIds;if(M&(ce|me)&&$.length===1)return ue[$[0].identifier]=!0,[$,$];var ye,Ne,at=pe(R.changedTouches),fn=[],hn=this.target;if(Ne=$.filter(function(pn){return q(pn.target,hn)}),M===ce)for(ye=0;ye<Ne.length;)ue[Ne[ye].identifier]=!0,ye++;for(ye=0;ye<at.length;)ue[at[ye].identifier]&&fn.push(at[ye]),M&(xe|Pe)&&delete ue[at[ye].identifier],ye++;if(fn.length)return[ne(Ne.concat(fn),"identifier"),fn]}var Ht=2500,dt=25;function wn(){ht.apply(this,arguments);var R=P(this.handler,this);this.touch=new Xe(this.manager,R),this.mouse=new Rn(this.manager,R),this.primaryTouch=null,this.lastTouches=[]}C(wn,ht,{handler:function(M,$,ue){var ye=ue.pointerType==O,Ne=ue.pointerType==K;if(!(Ne&&ue.sourceCapabilities&&ue.sourceCapabilities.firesTouchEvents)){if(ye)bt.call(this,$,ue);else if(Ne&&xs.call(this,ue))return;this.callback(M,$,ue)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bt(R,M){R&ce?(this.primaryTouch=M.changedPointers[0].identifier,ys.call(this,M)):R&(xe|Pe)&&ys.call(this,M)}function ys(R){var M=R.changedPointers[0];if(M.identifier===this.primaryTouch){var $={x:M.clientX,y:M.clientY};this.lastTouches.push($);var ue=this.lastTouches,ye=function(){var Ne=ue.indexOf($);Ne>-1&&ue.splice(Ne,1)};setTimeout(ye,Ht)}}function xs(R){for(var M=R.srcEvent.clientX,$=R.srcEvent.clientY,ue=0;ue<this.lastTouches.length;ue++){var ye=this.lastTouches[ue],Ne=Math.abs(M-ye.x),at=Math.abs($-ye.y);if(Ne<=dt&&at<=dt)return!0}return!1}var yi=ve(o.style,"touchAction"),xi=yi!==s,Lr="compute",Io="auto",Fr="manipulation",Jt="none",Jr="pan-x",ws="pan-y",lr=fg();function wi(R,M){this.manager=R,this.set(M)}wi.prototype={set:function(R){R==Lr&&(R=this.compute()),xi&&this.manager.element.style&&lr[R]&&(this.manager.element.style[yi]=R),this.actions=R.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var R=[];return v(this.manager.recognizers,function(M){L(M.options.enable,[M])&&(R=R.concat(M.getTouchAction()))}),uc(R.join(" "))},preventDefaults:function(R){var M=R.srcEvent,$=R.offsetDirection;if(this.manager.session.prevented){M.preventDefault();return}var ue=this.actions,ye=Q(ue,Jt)&&!lr[Jt],Ne=Q(ue,ws)&&!lr[ws],at=Q(ue,Jr)&&!lr[Jr];if(ye){var fn=R.pointers.length===1,hn=R.distance<2,pn=R.deltaTime<250;if(fn&&hn&&pn)return}if(!(at&&Ne)&&(ye||Ne&&$&Ie||at&&$&lt))return this.preventSrc(M)},preventSrc:function(R){this.manager.session.prevented=!0,R.preventDefault()}};function uc(R){if(Q(R,Jt))return Jt;var M=Q(R,Jr),$=Q(R,ws);return M&&$?Jt:M||$?M?Jr:ws:Q(R,Fr)?Fr:Io}function fg(){if(!xi)return!1;var R={},M=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function($){R[$]=M?e.CSS.supports("touch-action",$):!0}),R}var zt=1,cr=2,bs=4,es=8,ur=es,Mo=16,wr=32;function fr(R){this.options=w({},this.defaults,R||{}),this.id=U(),this.manager=null,this.options.enable=I(this.options.enable,!0),this.state=zt,this.simultaneous={},this.requireFail=[]}fr.prototype={defaults:{},set:function(R){return w(this.options,R),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(R){if(m(R,"recognizeWith",this))return this;var M=this.simultaneous;return R=Vn(R,this),M[R.id]||(M[R.id]=R,R.recognizeWith(this)),this},dropRecognizeWith:function(R){return m(R,"dropRecognizeWith",this)?this:(R=Vn(R,this),delete this.simultaneous[R.id],this)},requireFailure:function(R){if(m(R,"requireFailure",this))return this;var M=this.requireFail;return R=Vn(R,this),he(M,R)===-1&&(M.push(R),R.requireFailure(this)),this},dropRequireFailure:function(R){if(m(R,"dropRequireFailure",this))return this;R=Vn(R,this);var M=he(this.requireFail,R);return M>-1&&this.requireFail.splice(M,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(R){return!!this.simultaneous[R.id]},emit:function(R){var M=this,$=this.state;function ue(ye){M.manager.emit(ye,R)}$<es&&ue(M.options.event+br($)),ue(M.options.event),R.additionalEvent&&ue(R.additionalEvent),$>=es&&ue(M.options.event+br($))},tryEmit:function(R){if(this.canEmit())return this.emit(R);this.state=wr},canEmit:function(){for(var R=0;R<this.requireFail.length;){if(!(this.requireFail[R].state&(wr|zt)))return!1;R++}return!0},recognize:function(R){var M=w({},R);if(!L(this.options.enable,[this,M])){this.reset(),this.state=wr;return}this.state&(ur|Mo|wr)&&(this.state=zt),this.state=this.process(M),this.state&(cr|bs|es|Mo)&&this.tryEmit(M)},process:function(R){},getTouchAction:function(){},reset:function(){}};function br(R){return R&Mo?"cancel":R&es?"end":R&bs?"move":R&cr?"start":""}function Af(R){return R==He?"down":R==Qe?"up":R==Ke?"left":R==tt?"right":""}function Vn(R,M){var $=M.manager;return $?$.get(R):R}function Tr(){fr.apply(this,arguments)}C(Tr,fr,{defaults:{pointers:1},attrTest:function(R){var M=this.options.pointers;return M===0||R.pointers.length===M},process:function(R){var M=this.state,$=R.eventType,ue=M&(cr|bs),ye=this.attrTest(R);return ue&&($&Pe||!ye)?M|Mo:ue||ye?$&xe?M|es:M&cr?M|bs:cr:wr}});function Na(){Tr.apply(this,arguments),this.pX=null,this.pY=null}C(Na,Tr,{defaults:{event:"pan",threshold:10,pointers:1,direction:_n},getTouchAction:function(){var R=this.options.direction,M=[];return R&Ie&&M.push(ws),R&lt&&M.push(Jr),M},directionTest:function(R){var M=this.options,$=!0,ue=R.distance,ye=R.direction,Ne=R.deltaX,at=R.deltaY;return ye&M.direction||(M.direction&Ie?(ye=Ne===0?Ue:Ne<0?Ke:tt,$=Ne!=this.pX,ue=Math.abs(R.deltaX)):(ye=at===0?Ue:at<0?Qe:He,$=at!=this.pY,ue=Math.abs(R.deltaY))),R.direction=ye,$&&ue>M.threshold&&ye&M.direction},attrTest:function(R){return Tr.prototype.attrTest.call(this,R)&&(this.state&cr||!(this.state&cr)&&this.directionTest(R))},emit:function(R){this.pX=R.deltaX,this.pY=R.deltaY;var M=Af(R.direction);M&&(R.additionalEvent=this.options.event+M),this._super.emit.call(this,R)}});function fc(){Tr.apply(this,arguments)}C(fc,Tr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Jt]},attrTest:function(R){return this._super.attrTest.call(this,R)&&(Math.abs(R.scale-1)>this.options.threshold||this.state&cr)},emit:function(R){if(R.scale!==1){var M=R.scale<1?"in":"out";R.additionalEvent=this.options.event+M}this._super.emit.call(this,R)}});function bi(){fr.apply(this,arguments),this._timer=null,this._input=null}C(bi,fr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Io]},process:function(R){var M=this.options,$=R.pointers.length===M.pointers,ue=R.distance<M.threshold,ye=R.deltaTime>M.time;if(this._input=R,!ue||!$||R.eventType&(xe|Pe)&&!ye)this.reset();else if(R.eventType&ce)this.reset(),this._timer=p(function(){this.state=ur,this.tryEmit()},M.time,this);else if(R.eventType&xe)return ur;return wr},reset:function(){clearTimeout(this._timer)},emit:function(R){this.state===ur&&(R&&R.eventType&xe?this.manager.emit(this.options.event+"up",R):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}});function Ti(){Tr.apply(this,arguments)}C(Ti,Tr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Jt]},attrTest:function(R){return this._super.attrTest.call(this,R)&&(Math.abs(R.rotation)>this.options.threshold||this.state&cr)}});function Ws(){Tr.apply(this,arguments)}C(Ws,Tr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ie|lt,pointers:1},getTouchAction:function(){return Na.prototype.getTouchAction.call(this)},attrTest:function(R){var M=this.options.direction,$;return M&(Ie|lt)?$=R.overallVelocity:M&Ie?$=R.overallVelocityX:M&lt&&($=R.overallVelocityY),this._super.attrTest.call(this,R)&&M&R.offsetDirection&&R.distance>this.options.threshold&&R.maxPointers==this.options.pointers&&f($)>this.options.velocity&&R.eventType&xe},emit:function(R){var M=Af(R.offsetDirection);M&&this.manager.emit(this.options.event+M,R),this.manager.emit(this.options.event,R)}});function Hs(){fr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}C(Hs,fr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Fr]},process:function(R){var M=this.options,$=R.pointers.length===M.pointers,ue=R.distance<M.threshold,ye=R.deltaTime<M.time;if(this.reset(),R.eventType&ce&&this.count===0)return this.failTimeout();if(ue&&ye&&$){if(R.eventType!=xe)return this.failTimeout();var Ne=this.pTime?R.timeStamp-this.pTime<M.interval:!0,at=!this.pCenter||Bt(this.pCenter,R.center)<M.posThreshold;this.pTime=R.timeStamp,this.pCenter=R.center,!at||!Ne?this.count=1:this.count+=1,this._input=R;var fn=this.count%M.taps;if(fn===0)return this.hasRequireFailures()?(this._timer=p(function(){this.state=ur,this.tryEmit()},M.interval,this),cr):ur}return wr},failTimeout:function(){return this._timer=p(function(){this.state=wr},this.options.interval,this),wr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ur&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ts(R,M){return M=M||{},M.recognizers=I(M.recognizers,Ts.defaults.preset),new La(R,M)}Ts.VERSION="2.0.7",Ts.defaults={domEvents:!1,touchAction:Lr,enable:!0,inputTarget:null,inputClass:null,preset:[[Ti,{enable:!1}],[fc,{enable:!1},["rotate"]],[Ws,{direction:Ie}],[Na,{direction:Ie},["swipe"]],[Hs],[Hs,{event:"doubletap",taps:2},["tap"]],[bi]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var hg=1,Da=2;function La(R,M){this.options=w({},Ts.defaults,M||{}),this.options.inputTarget=this.options.inputTarget||R,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=R,this.input=ot(this),this.touchAction=new wi(this,this.options.touchAction),Fa(this,!0),v(this.options.recognizers,function($){var ue=this.add(new $[0]($[1]));$[2]&&ue.recognizeWith($[2]),$[3]&&ue.requireFailure($[3])},this)}La.prototype={set:function(R){return w(this.options,R),R.touchAction&&this.touchAction.update(),R.inputTarget&&(this.input.destroy(),this.input.target=R.inputTarget,this.input.init()),this},stop:function(R){this.session.stopped=R?Da:hg},recognize:function(R){var M=this.session;if(!M.stopped){this.touchAction.preventDefaults(R);var $,ue=this.recognizers,ye=M.curRecognizer;(!ye||ye&&ye.state&ur)&&(ye=M.curRecognizer=null);for(var Ne=0;Ne<ue.length;)$=ue[Ne],M.stopped!==Da&&(!ye||$==ye||$.canRecognizeWith(ye))?$.recognize(R):$.reset(),!ye&&$.state&(cr|bs|es)&&(ye=M.curRecognizer=$),Ne++}},get:function(R){if(R instanceof fr)return R;for(var M=this.recognizers,$=0;$<M.length;$++)if(M[$].options.event==R)return M[$];return null},add:function(R){if(m(R,"add",this))return this;var M=this.get(R.options.event);return M&&this.remove(M),this.recognizers.push(R),R.manager=this,this.touchAction.update(),R},remove:function(R){if(m(R,"remove",this))return this;if(R=this.get(R),R){var M=this.recognizers,$=he(M,R);$!==-1&&(M.splice($,1),this.touchAction.update())}return this},on:function(R,M){if(R!==s&&M!==s){var $=this.handlers;return v(le(R),function(ue){$[ue]=$[ue]||[],$[ue].push(M)}),this}},off:function(R,M){if(R!==s){var $=this.handlers;return v(le(R),function(ue){M?$[ue]&&$[ue].splice(he($[ue],M),1):delete $[ue]}),this}},emit:function(R,M){this.options.domEvents&&ko(R,M);var $=this.handlers[R]&&this.handlers[R].slice();if(!(!$||!$.length)){M.type=R,M.preventDefault=function(){M.srcEvent.preventDefault()};for(var ue=0;ue<$.length;)$[ue](M),ue++}},destroy:function(){this.element&&Fa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Fa(R,M){var $=R.element;if($.style){var ue;v(R.options.cssProps,function(ye,Ne){ue=ve($.style,Ne),M?(R.oldCssProps[ue]=$.style[ue],$.style[ue]=ye):$.style[ue]=R.oldCssProps[ue]||""}),M||(R.oldCssProps={})}}function ko(R,M){var $=t.createEvent("Event");$.initEvent(R,!0,!0),$.gesture=M,M.target.dispatchEvent($)}w(Ts,{INPUT_START:ce,INPUT_MOVE:me,INPUT_END:xe,INPUT_CANCEL:Pe,STATE_POSSIBLE:zt,STATE_BEGAN:cr,STATE_CHANGED:bs,STATE_ENDED:es,STATE_RECOGNIZED:ur,STATE_CANCELLED:Mo,STATE_FAILED:wr,DIRECTION_NONE:Ue,DIRECTION_LEFT:Ke,DIRECTION_RIGHT:tt,DIRECTION_UP:Qe,DIRECTION_DOWN:He,DIRECTION_HORIZONTAL:Ie,DIRECTION_VERTICAL:lt,DIRECTION_ALL:_n,Manager:La,Input:ht,TouchAction:wi,TouchInput:Xe,MouseInput:Rn,PointerEventInput:ar,TouchMouseInput:wn,SingleTouchInput:_i,Recognizer:fr,AttrRecognizer:Tr,Tap:Hs,Pan:Na,Swipe:Ws,Pinch:fc,Rotate:Ti,Press:bi,on:F,off:j,each:v,merge:E,extend:T,assign:w,inherit:C,bindFn:P,prefixed:ve});var dg=typeof e<"u"?e:typeof self<"u"?self:{};dg.Hammer=Ts,n.exports?n.exports=Ts:e[r]=Ts})(window,document,"Hammer")}(ev)),ev.exports}var vf=Pz();const Iz=Ea(vf),Is=FP({__proto__:null,default:Iz},[vf]),VA=1,zA=2,C_=4,Mz={mousedown:VA,mousemove:zA,mouseup:C_};function kz(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}function Oz(n){const e=n.prototype.handler;n.prototype.handler=function(r){const s=this.store;r.button>0&&r.type==="pointerdown"&&(kz(s,i=>i.pointerId===r.pointerId)||s.push(r)),e.call(this,r)}}function Nz(n){n.prototype.handler=function(t){let r=Mz[t.type];r&VA&&t.button>=0&&(this.pressed=!0),r&zA&&t.buttons===0&&(r=C_),this.pressed&&(r&C_&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}Oz(vf.PointerEventInput);Nz(vf.MouseInput);const Dz=vf.Manager;class ng{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const Lz=Is?[[Is.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Is.Rotate,{enable:!1}],[Is.Pinch,{enable:!1}],[Is.Swipe,{enable:!1}],[Is.Pan,{threshold:0,enable:!1}],[Is.Press,{enable:!1}],[Is.Tap,{event:"doubletap",taps:2,enable:!1}],[Is.Tap,{event:"anytap",enable:!1}],[Is.Tap,{enable:!1}]]:null,qb={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Fz={doubletap:["tap"]},Bz={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},u1={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Uz={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Kb={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Vz=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Al=typeof window<"u"?window:global;let P_=!1;try{const n={get passive(){return P_=!0,!0}};Al.addEventListener("test",null,n),Al.removeEventListener("test",null)}catch{P_=!1}const zz=Vz.indexOf("firefox")!==-1,{WHEEL_EVENTS:$z}=u1,Zb="wheel",Qb=4.000244140625,jz=40,Wz=.25;class Hz extends ng{constructor(e,t,r){super(e,t,r),this.handleEvent=s=>{if(!this.options.enable)return;let i=s.deltaY;Al.WheelEvent&&(zz&&s.deltaMode===Al.WheelEvent.DOM_DELTA_PIXEL&&(i/=Al.devicePixelRatio),s.deltaMode===Al.WheelEvent.DOM_DELTA_LINE&&(i*=jz)),i!==0&&i%Qb===0&&(i=Math.floor(i/Qb)),s.shiftKey&&i&&(i=i*Wz),this.callback({type:Zb,center:{x:s.clientX,y:s.clientY},delta:-i,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat($z),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,P_?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Zb&&(this.options.enable=t)}}const{MOUSE_EVENTS:Xz}=u1,Gb="pointermove",Jb="pointerover",eT="pointerout",tT="pointerenter",nT="pointerleave";class Yz extends ng{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(Xz),this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Gb&&(this.enableMoveEvent=t),e===Jb&&(this.enableOverEvent=t),e===eT&&(this.enableOutEvent=t),e===tT&&(this.enableEnterEvent=t),e===nT&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Jb,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(eT,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(tT,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(nT,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(Gb,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:qz}=u1,rT="keydown",sT="keyup";class Kz extends ng{constructor(e,t,r){super(e,t,r),this.handleEvent=s=>{const i=s.target||s.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:rT,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:sT,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(qz),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===rT&&(this.enableDownEvent=t),e===sT&&(this.enableUpEvent=t)}}const iT="contextmenu";class Zz extends ng{constructor(e,t,r){super(e,t,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:iT,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===iT&&(this.options.enable=t)}}const oT=1,I_=2,aT=4,Qz={pointerdown:oT,pointermove:I_,pointerup:aT,mousedown:oT,mousemove:I_,mouseup:aT},Gz=0,Jz=1,e$=2,t$=1,n$=2,r$=4;function s$(n){const e=Qz[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let s=!1,i=!1,o=!1;return e===I_?(s=!!(t&t$),i=!!(t&r$),o=!!(t&n$)):(s=r===Gz,i=r===Jz,o=r===e$),{leftButton:s,middleButton:i,rightButton:o}}function i$(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,i=r.height/e.offsetHeight||1,o={x:(t.x-r.left-e.clientLeft)/s,y:(t.y-r.top-e.clientTop)/i};return{center:t,offsetCenter:o}}const tv={srcElement:"root",priority:0};class o${constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let s=t.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,s=!1,i=!1){const{handlers:o,handlersByElement:a}=this;let u=tv;typeof r=="string"||r&&r.addEventListener?u={...tv,srcElement:r}:r&&(u={...tv,...r});let f=a.get(u.srcElement);f||(f=[],a.set(u.srcElement,f));const h={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};s&&(h.once=!0),i&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let p=f.length-1;for(;p>=0&&!(f[p].priority>=h.priority);)p--;f.splice(p+1,0,h)}remove(e,t){const{handlers:r,handlersByElement:s}=this;for(let i=r.length-1;i>=0;i--){const o=r[i];if(o.type===e&&o.handler===t){r.splice(i,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=r.some(i=>!i.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let s=!1;const i=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let u=0;u<r.length;u++){const{type:f,handler:h,once:p}=r[u];if(h({...e,type:f,stopPropagation:i,stopImmediatePropagation:o}),p&&a.push(r[u]),s)break}for(let u=0;u<a.length;u++){const{type:f,handler:h}=a[u];this.remove(f,h)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...s$(e),...i$(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const a$={events:null,recognizers:null,recognizerOptions:{},Manager:Dz,touchAction:"none",tabIndex:0};class l${constructor(e=null,t){this._onBasicInput=s=>{const{srcEvent:i}=s,o=Bz[i.type];o&&this.manager.emit(o,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...a$,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||Lz}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(qb).forEach(s=>{const i=this.manager.get(s);i&&qb[s].forEach(o=>{i.recognizeWith(o)})});for(const s in t.recognizerOptions){const i=this.manager.get(s);if(i){const o=t.recognizerOptions[s];delete o.enable,i.set(o)}}this.wheelInput=new Hz(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Yz(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Kz(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Zz(e,this._onOtherEvent,{enable:!1});for(const[s,i]of this.events)i.isEmpty()||(this._toggleRecognizer(i.recognizerName,!0),this.manager.on(s,i.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const s=r.get(e);if(s&&s.options.enable!==t){s.set({enable:t});const i=Fz[e];i&&!this.options.recognizers&&i.forEach(o=>{const a=r.get(o);t?(a.requireFailure(e),s.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,s,i){if(typeof e!="string"){r=t;for(const h in e)this._addEventHandler(h,e[h],r,s,i);return}const{manager:o,events:a}=this,u=Kb[e]||e;let f=a.get(u);f||(f=new o$(this),a.set(u,f),f.recognizerName=Uz[u]||u,o&&o.on(u,f.handleEvent)),f.add(e,t,r,s,i),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,s=Kb[e]||e,i=r.get(s);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:o}=i;let a=!1;for(const u of r.values())if(u.recognizerName===o&&!u.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Xi(){}const c$=({isDragging:n})=>n?"grabbing":"grab",$A={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Xi,onWebGLInitialized:Xi,onResize:Xi,onViewStateChange:Xi,onInteractionStateChange:Xi,onBeforeRender:Xi,onAfterRender:Xi,onLoad:Xi,onError:n=>ut.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:c$,getTooltip:null,debug:!1,drawPickingColors:!1};class f1{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new df({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const i=r.offsetCenter;if(!i)return;s.x=i.x,s.y=i.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=__[r.type],i=r.offsetCenter;if(!s||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:u}=a,f=u&&(u[s.handler]||u.props[s.handler]),h=this.props[s.handler];let p=!1;f&&(p=f.call(u,a,r)),p||(h==null||h(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const s=r.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...$A,...e},e=this.props,e.viewState&&e.initialViewState&&ut.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ut.error("WebGL1 context not supported.")(),this.device=Su.attach(e.gl));let t=this.device;t||(kl.registerDevices([Su]),t=kl.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Ql.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,s,i,o,a,u,f,h;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(i=this.effectManager)==null||i.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(f=this.widgetManager)==null||f.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ut.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ut.removed("onLayerClick","onClick")(),e.initialViewState&&!Xr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||r||s||i||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Ln(this.viewManager),this.viewManager.views}getViewports(e){return Ln(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,r){Ln(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(t).timeEnd(),i}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Ln(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){var s,i;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,(s=this.viewManager)==null||s.setProps({width:t,height:r}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:s,useDevicePixels:i}=t;return new DB({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new SA({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,r,s;const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let a=o,u=!1;for(const f of i)a=f,u=((t=f.layer)==null?void 0:t.onHover(f,e.event))||u;u||((s=(r=this.props).onHover)==null||s.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Su&&this.props.onWebGLInitialized(this.device.gl);const t=new yA;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new l$(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in __)this.eventManager.on(o,this._onEvent);this.viewManager=new JB({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new GB(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new dU({deck:this,device:this.device}),this.deckRenderer=new mU(this.device),this.deckPicker=new bU(this.device),this.widgetManager=new EU({deck:this,parentElement:(i=this.canvas)==null?void 0:i.parentElement}),this.widgetManager.addDefault(new RU),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var o;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(o=this.deckRenderer)==null||o.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ut.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=kl.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}f1.defaultProps=$A;f1.VERSION=HL;function u$(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return U4(n)}}const f$=B4;function Zh(n,e){return{attribute:n,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function ta(n){return n.stride||n.size*n.bytesPerElement}function h$(n,e){return n.type===e.type&&n.size===e.size&&ta(n)===ta(e)&&(n.offset||0)===(e.offset||0)}function M_(n,e){e.offset&&ut.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=ta(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,i=r*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:i,stride:t}}function d$(n,e){const t=M_(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class p${constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,i=s==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;i?a="float32":!s&&t.isIndexed?a="uint32":a=s||"float32";let u=u$(s||a);this.doublePrecision=i,i&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ta(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ql.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const s=this.value;if(t){const i=M_(this.getAccessor(),t),o=i.offset/s.BYTES_PER_ELEMENT,a=i.size||this.size;r[e]=s.subarray(o,o+a)}else r[e]=s}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),s=[],i={name:this.id,byteStride:ta(r),attributes:s};if(this.doublePrecision){const o=d$(r,t||{});s.push(Zh(e,{...r,...o.high}),Zh(`${e}64Low`,{...r,...o.low}))}else if(t){const o=M_(r,t);s.push(Zh(e,{...r,...o}))}else s.push(Zh(e,r));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:s}=this,i=r*s;if(t&&i&&t.length>=i){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let u=0;u<i;)for(let f=0;f<s;f++){const h=t[u++];h<o[f]&&(o[f]=h),h>a[f]&&(a[f]=h)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof un?r={buffer:e}:r=e;const s={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)s.type="float32";else{const o=f$(r.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=r.value.BYTES_PER_ELEMENT,s.stride=ta(s)}if(t.bounds=null,r.constant){let i=r.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!t.constant||!this._areValuesEqual(i,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(r.buffer){const i=r.buffer;t.externalBuffer=i,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let i=r.value;t.externalBuffer=null,t.constant=!1,this.value=i;let{buffer:o}=this;const a=ta(s),u=(s.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=z0(i,s)),this.settings.isIndexed){const h=this.settings.defaultType;i.constructor!==h&&(i=new h(i))}const f=i.byteLength+u+a*2;(!o||o.byteLength<f)&&(o=this._createBuffer(f)),o.write(i,u)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?z0(t,{size:this.size,startIndex:r,endIndex:s}):t.subarray(r,s),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,s=r.allocatedValue,i=Ql.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=i;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<i.byteLength+o)&&(a=this._createBuffer(i.byteLength+o),t&&s&&a.write(s instanceof Float64Array?z0(s,this):s,o)),r.allocatedValue=i,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ut.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:s,size:i}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let o=i;for(;--o>=0;)t[r+o]=s[o];return t}switch(i){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=i;for(;--o>=0;)t[r+o]=Number.isFinite(e[o])?e[o]:s[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:t?un.INDEX:un.VERTEX,indexType:t?r:void 0,byteLength:e}),this._buffer}}const lT=[],cT=[];function _f(n,e=0,t=1/0){let r=lT;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(cT.length=n.length,r=cT):r=lT,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),s.index=e-1),{iterable:r,objectInfo:s}}function jA(n){return n&&n[Symbol.asyncIterator]}function WA(n,e){const{size:t,stride:r,offset:s,startIndices:i,nested:o}=e,a=n.BYTES_PER_ELEMENT,u=r?r/a:t,f=s?s/a:0,h=Math.floor((n.length-f)/u);return(p,{index:m,target:v})=>{if(!i){const E=m*u+f;for(let C=0;C<t;C++)v[C]=n[E+C];return v}const x=i[m],w=i[m+1]||h;let T;if(o){T=new Array(w-x);for(let E=x;E<w;E++){const C=E*u+f;v=new Array(t);for(let P=0;P<t;P++)v[P]=n[C+P];T[E-x]=v}}else if(u===t)T=n.subarray(x*t+f,w*t+f);else{T=new n.constructor((w-x)*t);let E=0;for(let C=x;C<w;C++){const P=C*u+f;for(let L=0;L<t;L++)T[E++]=n[P+L]}}return T}}const g$=[],pd=[[0,1/0]];function m$(n,e){if(n===pd||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let s=0;for(let i=0;i<r;i++){const o=n[i];o[1]<e[0]?(t.push(o),s=i+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(s,0,e),t}const v$={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function HA(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...v$[t],...e,...n,type:t}}class XA extends p${constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:pd}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!h$(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,s=Array.isArray(t)?e[t.find(i=>e[i])]:e[t];return HA(s,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:s=1/0}=t;this.state.updateRanges=m$(this.state.updateRanges,[r,s])}else this.state.updateRanges=pd}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=g$}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==pd),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:i},settings:{update:o,noAlloc:a}}=this;let u=!0;if(o){for(const[f,h]of i)o.call(s,this,{data:t,startRow:f,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[f,h]of i){const p=Number.isFinite(f)?this.getVertexOffset(f):0,m=Number.isFinite(h)?this.getVertexOffset(h):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:p,endOffset:m})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ln(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=WA(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=s??"vertex",!t)return r;for(const i in t){const o=super._getBufferLayout(i,t[i]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:s,props:i,numInstances:o}){if(e.constant)return;const{settings:a,state:u,value:f,size:h,startIndices:p}=e,{accessor:m,transform:v}=a,x=u.binaryAccessor||(typeof m=="function"?m:i[m]);Ln(typeof x=="function",`accessor "${m}" is not a function`);let w=e.getVertexOffset(r);const{iterable:T,objectInfo:E}=_f(t,r,s);for(const C of T){E.index++;let P=x(C,E);if(v&&(P=v.call(this,P)),p){const L=(E.index<p.length-1?p[E.index+1]:o)-p[E.index];if(P&&Array.isArray(P[0])){let I=w;for(const F of P)e._normalizeValue(F,f,I),I+=h}else P&&P.length>h?f.set(P,w):(e._normalizeValue(P,E.target,0),YB({target:f,source:E.target,start:w,count:L}));w+=L*h}else e._normalizeValue(P,f,w),w+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function nv(n){const{source:e,target:t,start:r=0,size:s,getData:i}=n,o=n.end||t.length,a=e.length,u=o-r;if(a>u){t.set(e.subarray(0,u),r);return}if(t.set(e,r),!i)return;let f=a;for(;f<u;){const h=i(f,e);for(let p=0;p<s;p++)t[r+f]=h[p]||0,f++}}function _$({source:n,target:e,size:t,getData:r,sourceStartIndices:s,targetStartIndices:i}){if(!s||!i)return nv({source:n,target:e,size:t,getData:r}),e;let o=0,a=0;const u=r&&((h,p)=>r(h+a,p)),f=Math.min(s.length,i.length);for(let h=1;h<f;h++){const p=s[h]*t,m=i[h]*t;nv({source:n.subarray(o,p),target:e,start:a,end:m,size:t,getData:u}),o=p,a=m}return a<e.length&&nv({source:[],target:e,start:a,size:t,getData:u}),e}function y$(n){const{device:e,settings:t,value:r}=n,s=new XA(e,t);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function YA(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function qA(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function KA(n){n.push(n.shift())}function x$(n,e){const{doublePrecision:t,settings:r,value:s,size:i}=n,o=t&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:u}=n.settings;if(u)for(const f of Object.values(u))a=Math.max(a,f.vertexOffset??0);return(r.noAlloc?s.length:(e+a)*i)*o}function ZA({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function QA({device:n,buffer:e,attribute:t,fromLength:r,toLength:s,fromStartIndices:i,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*a,f=t.byteOffset,h=t.settings.bytesPerElement<4?f/t.settings.bytesPerElement*4:f,p=t.startIndices,m=i&&p,v=t.isConstant;if(!m&&e&&r>=s)return e;const x=t.value instanceof Float64Array?Float32Array:t.value.constructor,w=v?t.value:new x(t.getBuffer().readSyncWebGL(f,s*x.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const P=o;o=(L,I)=>t.normalizeConstant(P(L,I))}const T=v?(P,L)=>o(w,L):(P,L)=>o(w.subarray(P+f,P+f+u),L),E=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),C=new Float32Array(s);return _$({source:E,target:C,sourceStartIndices:i,targetStartIndices:p,size:u,getData:T}),(!e||e.byteLength<C.byteLength+h)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:C.byteLength+h,usage:35050})),e.write(C,h),e}class GA{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Jp(r),this.attribute=t,this.attributeInTransition=y$(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=x$(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class w$ extends GA{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=S$(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:i,attribute:o}=this;KA(i),i[0]=QA({device:this.device,buffer:i[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),i[1]=ZA({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:a}=this,u=a.model;let f=Math.floor(this.currentLength/o.size);JA(o)&&(f/=2),u.setVertexCount(f),o.isConstant?(u.setAttributes({aFrom:i[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let s=r/e;t&&(s=t(s));const{model:i}=this.transform;i.setUniforms({time:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const b$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,T$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function JA(n){return n.doublePrecision&&n.value instanceof Float64Array}function S$(n,e){const t=e.size,r=YA(t),s=qA(t),i=e.getBufferLayout();return JA(e)?new Fu(n,{vs:T$,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[u9],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Fu(n,{vs:b$,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:i.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class E$ extends GA{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=P$(e),this.framebuffer=I$(e,this.texture),this.transform=C$(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:i,attribute:o}=this;for(let u=0;u<2;u++)i[u]=QA({device:this.device,buffer:i[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});i[2]=ZA({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:s}=this,i=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:i.stiffness,damping:i.damping}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),KA(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const A$=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,R$=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function C$(n,e){const t=YA(e.size),r=qA(e.size);return new Fu(n,{vs:A$,fs:R$,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function P$(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function I$(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const M$={interpolation:w$,spring:E$};class k${constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const s in e){const i=e[s],o=i.getTransitionSetting(t);o&&this._updateAttribute(s,i,o)}for(const s in this.transitions){const i=e[s];(!i||!i.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const s=this.transitions[e];let i=!s||s.type!==r.type;if(i){s&&this._removeTransition(e);const o=M$[r.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(ut.error(`unsupported transition type '${r.type}'`)(),i=!1)}(i||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const uT="attributeManager.invalidate",O$="attributeManager.updateStart",N$="attributeManager.updateEnd",D$="attribute.updateStart",L$="attribute.allocate",F$="attribute.updateEnd";class B${constructor(e,{id:t="attribute-manager",stats:r,timeline:s}={}){this.mergeBoundsMemoized=mf(SB),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new k$(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Zn(uT,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Zn(uT,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:s,props:i={},buffers:o={},context:a={}}){let u=!1;Zn(O$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const f in this.attributes){const h=this.attributes[f],p=h.settings.accessor;h.startIndices=r,h.numInstances=t,i[f]&&ut.removed(`props.${f}`,`data.attributes.${f}`)(),h.setExternalBuffer(o[f])||h.setBinaryValue(typeof p=="string"?o[p]:void 0,e.startIndices)||typeof p=="string"&&!o[p]&&h.setConstantValue(i[p])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:t,data:e,props:i,context:a})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&Zn(N$,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var s;return(s=this.attributes[r])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const i in t){const o=t[i];o.needsRedraw(e)&&!r.hasAttribute(i)&&(s[i]=o)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const s=e[r],i={...s,id:r,size:s.isIndexed&&1||s.size||1,...t};this.attributes[r]=new XA(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:s}=this,i=s[e];return i&&i.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,t)}),i}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Zn(D$,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Zn(L$,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Zn(F$,t,r))}}class U$ extends Jp{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:s,easing:i}}=this,o=i(e/s);this._value=ia(t,r,o)}}const fT=1e-5;function hT(n,e,t,r,s){const i=e-n,a=(t-e)*s,u=-i*r;return a+u+i+e}function V$(n,e,t,r,s){if(Array.isArray(t)){const i=[];for(let o=0;o<t.length;o++)i[o]=hT(n[o],e[o],t[o],r,s);return i}return hT(n,e,t,r,s)}function dT(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const s=n[r]-e[r];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class z$ extends Jp{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:s}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let a=V$(i,o,t,r,s);const u=dT(a,t),f=dT(a,o);u<fT&&f<fT&&(a=t,this.end()),this._prevValue=o,this._currValue=a}}const $$={interpolation:U$,spring:z$};class j${constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,s){const{transitions:i}=this;if(i.has(e)){const u=i.get(e),{value:f=u.settings.fromValue}=u;t=f,this.remove(e)}if(s=HA(s),!s)return;const o=$$[s.type];if(!o){ut.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:t,toValue:r}),i.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function W$(n){const e=n[uo];for(const t in e){const r=e[t],{validate:s}=r;if(s&&!s(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function H$(n,e){const t=eR({newProps:n,oldProps:e,propTypes:n[uo],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Y$(n,e);let s=!1;return r||(s=q$(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:s,extensionsChanged:K$(n,e),transitionsChanged:X$(n,e)}}function X$(n,e){if(!n.transitions)return!1;const t={},r=n[uo];let s=!1;for(const i in n.transitions){const o=r[i],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&k_(n[i],e[i],o)&&(t[i]=!0,s=!0)}return s?t:!1}function eR({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const i of Object.keys(n))if(!(i in t)){if(!(i in e))return`${s}.${i} added`;const o=k_(n[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}for(const i of Object.keys(e))if(!(i in t)){if(!(i in n))return`${s}.${i} dropped`;if(!Object.hasOwnProperty.call(n,i)){const o=k_(n[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}}return!1}function k_(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function Y$(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:s}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function q$(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&pT(n,e,"all"))return{all:!0};const t={};let r=!1;for(const s in n.updateTriggers)s!=="all"&&pT(n,e,s)&&(t[s]=!0,r=!0);return r?t:!1}function K$(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(t[s]))return!0;return!1}function pT(n,e,t){let r=n.updateTriggers[t];r=r??{};let s=e.updateTriggers[t];return s=s??{},eR({oldProps:s,newProps:r,triggerName:t})}const Z$="count(): argument not an object",Q$="count(): argument not a container";function G$(n){if(!ej(n))throw new Error(Z$);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(J$(n))return Object.keys(n).length;throw new Error(Q$)}function J$(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function ej(n){return n!==null&&typeof n=="object"}function gT(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(s=>s.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];t.inject=r}return t}const tj={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},O_={};function nj(n,e,t,r){if(t instanceof Hr)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const i=e.createTexture({...t,sampler:{...tj,...s,...r}});return O_[i.id]=n,i}function rj(n,e){!e||!(e instanceof Hr)||O_[e.id]===n&&(e.delete(),delete O_[e.id])}const sj={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||N_(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Xr(n,e,1)}},accessor:{validate(n,e){const t=ep(n);return t==="function"||t===ep(e.value)},equal(n,e,t){return typeof e=="function"?!0:Xr(n,e,1)}},array:{validate(n,e){return e.optional&&!n||N_(n)},equal(n,e,t){const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Xr(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Xr(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:nj(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{rj(t.id,n)}}};function ij(n){const e={},t={},r={};for(const[s,i]of Object.entries(n)){const o=i==null?void 0:i.deprecatedFor;if(o)r[s]=Array.isArray(o)?o:[o];else{const a=oj(s,i);e[s]=a,t[s]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function oj(n,e){switch(ep(e)){case"object":return Gc(n,e);case"array":return Gc(n,{type:"array",value:e,compare:!1});case"boolean":return Gc(n,{type:"boolean",value:e});case"number":return Gc(n,{type:"number",value:e});case"function":return Gc(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Gc(n,e){return"type"in e?{name:n,...sj[e.type],...e}:"value"in e?{name:n,type:ep(e.value),...e}:{name:n,type:"object",value:e}}function N_(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function ep(n){return N_(n)?"array":n===null?"null":typeof n}function aj(n,e){let t;for(let i=e.length-1;i>=0;i--){const o=e[i];"extensions"in o&&(t=o.extensions)}const r=D_(n.constructor,t),s=Object.create(r);s[Gd]=n,s[_a]={},s[io]={};for(let i=0;i<e.length;++i){const o=e[i];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const lj="_mergedDefaultProps";function D_(n,e){if(!(n instanceof rg.constructor))return{};let t=lj;if(e)for(const s of e){const i=s.constructor;i&&(t+=`:${i.extensionName||i.name}`)}const r=tR(n,t);return r||(n[t]=cj(n,e||[]))}function cj(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),s=D_(r),i=tR(n,"defaultProps")||{},o=ij(i),a=Object.assign(Object.create(null),s,o.defaultProps),u=Object.assign(Object.create(null),s==null?void 0:s[uo],o.propTypes),f=Object.assign(Object.create(null),s==null?void 0:s[W0],o.deprecatedProps);for(const h of e){const p=D_(h.constructor);p&&(Object.assign(a,p),Object.assign(u,p[uo]),Object.assign(f,p[W0]))}return uj(a,n),hj(a,u),fj(a,f),a[uo]=u,a[W0]=f,e.length===0&&!h1(n,"_propTypes")&&(n._propTypes=u),a}function uj(n,e){const t=pj(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function fj(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const s=`${this.id}: ${t}`;for(const i of e[t])h1(this,i)||(this[i]=r);ut.deprecated(s,e[t].join("/"))()}})}function hj(n,e){const t={},r={};for(const s in e){const i=e[s],{name:o,value:a}=i;i.async&&(t[o]=a,r[o]=dj(o))}n[Nl]=t,n[_a]={},Object.defineProperties(n,r)}function dj(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||jA(e)?this[_a][n]=e:this[io][n]=e},get(){if(this[io]){if(n in this[io])return this[io][n]||this[Nl][n];if(n in this[_a]){const e=this[Gd]&&this[Gd].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Nl][n]}}return this[Nl][n]}}}function h1(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function tR(n,e){return h1(n,e)&&n[e]}function pj(n){const e=n.componentName;return e||ut.warn(`${n.name}.componentName not specified`)(),e||n.name}let gj=0;class rg{constructor(...e){this.props=aj(this,e),this.id=this.props.id,this.count=gj++}clone(e){const{props:t}=this,r={};for(const s in t[Nl])s in t[io]?r[s]=t[io][s]:s in t[_a]&&(r[s]=t[_a][s]);return new this.constructor({...t,...r,...e})}}rg.componentName="Component";rg.defaultProps={};const mj=Object.freeze({});class vj{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||mj}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Gd]||this.component;const t=e[io]||{},r=e[_a]||e,s=e[Nl]||{};for(const i in t){const o=t[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o),t[i]=this.getAsyncProp(i)}for(const i in r){const o=r[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(jA(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;t.then(i=>{this.component&&(i=this._postProcessValue(r,i),this._setAsyncPropValue(e,i,s),this._onResolve(e,i))}).catch(i=>{this._onError(e,i)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let i=[],o=0;for await(const a of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?i=u(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,s)}this._onResolve(e,i)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[uo];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class _j extends vj{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const yj="layer.changeFlag",xj="layer.initialize",wj="layer.update",bj="layer.finalize",Tj="layer.matched",mT=2**24-1,Sj=Object.freeze([]),Ej=mf(({oldViewport:n,viewport:e})=>n.equals(e));let Ms=new Uint8ClampedArray(0);const Aj={data:{type:"data",value:Sj,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:s,signal:i})=>{const{resourceManager:o}=t.context;s=s||t.getLoadOptions(),r=r||t.props.loaders,i&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:i}});let a=o.contains(n);return!a&&!s&&(o.add({resourceId:n,data:Dd(n,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:n,onChange:u=>{var f;return(f=t.internalState)==null?void 0:f.reloadAsyncProp(e,u)},consumerId:t.id,requestId:e}):Dd(n,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:et.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Or extends rg{constructor(){super(...arguments),this.internalState=null,this.lifecycle=vl.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ln(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=_A(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,i,o]=gA(r,t.pixelProjectionMatrix);return e.length===2?[s,i]:[s,i,o]}unproject(e){return Ln(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ln(this.internalState);const r=this.internalState.viewport||this.context.viewport;return IB(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===et.DEFAULT||e===et.LNGLAT||e===et.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ln(e instanceof Uint8Array);const[t,r,s]=e;return t+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:G$(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=gT(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=gT(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const s of r)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,i=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:u}=t.attributes,f=a||u;f&&(o&&f.constant&&(f.constant=!1,t.invalidate(f.id)),!f.value&&!o&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var r,s,i,o;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(r=this.props).onError)!=null&&s.call(r,e)||(o=(i=this.context)==null?void 0:i.onError)==null||o.call(i,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!Ej({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const s in t)Object.defineProperty(r,s,{value:t[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Ms.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>mT&&ut.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ms=Ql.allocate(Ms,t,{size:4,copy:!0,maxCount:Math.max(t,mT)});const s=Math.floor(Ms.length/4),i=[];for(let o=r;o<s;o++)this.encodePickingColor(o,i),Ms[o*4+0]=i[0],Ms[o*4+1]=i[1],Ms[o*4+2]=i[2]}e.value=Ms.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var a;if(!Object.keys(t).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},i={},o={};for(const u in t){if(s[u])continue;const f=t[u].getValue();for(const h in f){const p=f[h];p instanceof un?t[u].settings.isIndexed?e.setIndexBuffer(p):i[h]=p:p&&(o[h]=p)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,i=r||s,o=i&&t.attributes&&t.attributes[i.id];if(o&&o.value){const a=o.value,u=this.encodePickingColor(e);for(let f=0;f<t.length;f++){const h=i.getVertexOffset(f);a[h]===u[0]&&a[h+1]===u[1]&&a[h+2]===u[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,s=t||r;if(!s)return;const i=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ms.buffer&&(r.value=Ms.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ln(!this.internalState),Ln(Number.isFinite(this.props.coordinateSystem)),Zn(xj,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _j({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ut.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new j$(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Zn(Tj,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Zn(wj,this,e),!e)return;const t=this.props,r=this.context,s=this.internalState,i=r.viewport,o=this._updateUniformTransition();s.propsInTransition=o,r.viewport=s.viewport||i,this.props=o;try{const a=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const h of this.props.extensions)h.updateState.call(this,a,h);const f=this.getModels()[0]!==u[0];this._postUpdate(a,f)}finally{r.viewport=i,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Zn(bj,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:t=null,uniforms:r={},parameters:s={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(t){const{isActive:h,isAttribute:p}=t.picking;this.setModuleParameters(t),this.setShaderModuleProps({picking:{isActive:h,isAttribute:p}})}const{getPolygonOffset:u}=this.props,f=u&&u(r)||[0,0];o.device.setParametersWebGL({polygonOffset:f});for(const h of this.getModels())h.setParameters(s);o.device.withParametersWebGL(s,()=>{const h={renderPass:e,moduleParameters:t,uniforms:r,parameters:s,context:o};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let i=!1;switch(s){case"dataChanged":const o=e[s],a=t[s];o&&Array.isArray(a)&&(t.dataChanged=Array.isArray(o)?a.concat(o):o,i=!0);default:t[s]||(t[s]=e[s],i=!0)}i&&Zn(yj,this,s,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const r=H$(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],(s=e.transitions)==null?void 0:s[i]);return this.setChangeFlags(r)}validateProps(){W$(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new B$(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const i=this.state.model;i!=null&&i.isInstanced&&i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:u}=r;if(t||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==u){const f={};Array.isArray(u)&&(f.highlightColor=u),(t||s.autoHighlight!==o||a!==s.highlightedObjectIndex)&&(f.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:f})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(t=t||s,t)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Or.defaultProps=Aj;Or.layerName="Layer";const Rj="compositeLayer.renderLayers";class Qr extends Or{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,s)}return e}getSubLayerProps(e={}){var j;const{opacity:t,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:f,coordinateSystem:h,coordinateOrigin:p,wrapLongitude:m,positionFormat:v,modelMatrix:x,extensions:w,fetch:T,operation:E,_subLayerProps:C}=this.props,P={id:"",updateTriggers:{},opacity:t,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:f,coordinateSystem:h,coordinateOrigin:p,wrapLongitude:m,positionFormat:v,modelMatrix:x,extensions:w,fetch:T,operation:E},L=C&&e.id&&C[e.id],I=L&&L.updateTriggers,F=e.id||"sublayer";if(L){const q=this.props[uo],Q=e.type?e.type._propTypes:{};for(const le in L){const he=Q[le]||q[le];he&&he.type==="accessor"&&(L[le]=this.getSubLayerAccessor(L[le]))}}Object.assign(P,e,L),P.id=`${this.props.id}-${F}`,P.updateTriggers={all:(j=this.props.updateTriggers)==null?void 0:j.all,...e.updateTriggers,...I};for(const q of w){const Q=q.getSubLayerProps.call(this,q);Q&&Object.assign(P,Q,{updateTriggers:Object.assign(P.updateTriggers,Q.updateTriggers)})}return P}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const i=this.renderLayers();r=Gp(i,Boolean),this.internalState.subLayers=r}Zn(Rj,this,s,r);for(const i of r)i.parent=this}}Qr.layerName="CompositeLayer";const Qh=Math.PI/180,vT=180/Math.PI,gd=6370972,Rl=256;function Cj(){const n=Rl/gd,e=Math.PI/180*Rl;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class Pj extends Ia{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:s=0,nearZMultiplier:i=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:u,altitude:f=1.5}=e;u=u||1,f=Math.max(.75,f);const h=new St().lookAt({eye:[0,-f,0],up:[0,0,1]}),p=Math.pow(2,s);h.rotateX(t*Qh),h.rotateZ(-r*Qh),h.scale(p/u);const m=Math.atan(.5/f),v=Rl*2*p/u;super({...e,height:u,viewMatrix:h,longitude:r,latitude:t,zoom:s,distanceScales:Cj(),fovyRadians:m*2,focalDistance:f,near:i,far:Math.min(2,1/v+1)*f*o}),this.latitude=t,this.longitude=r,this.resolution=a}get projectionMode(){return us.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),i=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return i[0]<this.longitude&&(i[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[s,i,o]=e,a=t?i:this.height-i,{pixelUnprojectionMatrix:u}=this;let f;if(Number.isFinite(o))f=rv(u,[s,a,o,1]);else{const v=rv(u,[s,a,-1,1]),x=rv(u,[s,a,1,1]),w=((r||0)/gd+1)*Rl,T=E0(bE([],v,x)),E=E0(v),C=E0(x),L=4*((4*E*C-(T-E-C)**2)/16)/T,I=Math.sqrt(E-L),F=Math.sqrt(Math.max(0,w*w-L)),j=(I-F)/Math.sqrt(T);f=L5([],v,x,j)}const[h,p,m]=this.unprojectPosition(f);return Number.isFinite(o)?[h,p,m]:Number.isFinite(r)?[h,p,r]:[h,p]}projectPosition(e){const[t,r,s=0]=e,i=t*Qh,o=r*Qh,a=Math.cos(o),u=(s/gd+1)*Rl;return[Math.sin(i)*a*u,-Math.cos(i)*a*u,Math.sin(o)*u]}unprojectPosition(e){const[t,r,s]=e,i=TE(e),o=Math.asin(s/i),u=Math.atan2(t,-r)*vT,f=o*vT,h=(i/Rl-1)*gd;return[u,f,h]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function rv(n,e){const t=sc([],e,n);return Ry(t,t,1/t[3]),t}const Ij=new St().lookAt({eye:[0,0,1]});function Mj({width:n,height:e,near:t,far:r,padding:s}){let i=-n/2,o=n/2,a=-e/2,u=e/2;if(s){const{left:f=0,right:h=0,top:p=0,bottom:m=0}=s,v=cn((f+n-h)/2,0,n)-n/2,x=cn((p+e-m)/2,0,e)-e/2;i-=v,o-=v,a+=x,u+=x}return new St().ortho({left:i,right:o,bottom:a,top:u,near:t,far:r})}class kj extends Ia{constructor(e){const{width:t,height:r,near:s=.1,far:i=1e3,zoom:o=0,target:a=[0,0,0],padding:u=null,flipY:f=!0}=e,h=Array.isArray(o)?o[0]:o,p=Array.isArray(o)?o[1]:o,m=Math.min(h,p),v=Math.pow(2,m);let x;if(h!==p){const w=Math.pow(2,h),T=Math.pow(2,p);x={unitsPerMeter:[w/v,T/v,1],metersPerUnit:[v/w,v/T,1]}}super({...e,longitude:void 0,position:a,viewMatrix:Ij.clone().scale([v,v*(f?-1:1),v]),projectionMatrix:Mj({width:t||1,height:r||1,padding:u,near:s,far:i}),zoom:m,distanceScales:x})}projectFlat([e,t]){const{unitsPerMeter:r}=this.distanceScales;return[e*r[0],t*r[1]]}unprojectFlat([e,t]){const{metersPerUnit:r}=this.distanceScales;return[e*r[0],t*r[1]]}panByPosition(e,t){const r=Qp(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),i=Rd([],s,pE([],r)),o=Rd([],this.center,i);return{target:this.unprojectFlat(o)}}}class Oj extends TA{constructor(e){const{width:t,height:r,rotationX:s=0,rotationOrbit:i=0,target:o=[0,0,0],zoom:a=0,minRotationX:u=-90,maxRotationX:f=90,minZoom:h=-1/0,maxZoom:p=1/0,startPanPosition:m,startRotatePos:v,startRotationX:x,startRotationOrbit:w,startZoomPosition:T,startZoom:E}=e;super({width:t,height:r,rotationX:s,rotationOrbit:i,target:o,zoom:a,minRotationX:u,maxRotationX:f,minZoom:h,maxZoom:p},{startPanPosition:m,startRotatePos:v,startRotationX:x,startRotationOrbit:w,startZoomPosition:T,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const r=this.getState().startPanPosition||t;if(!r)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:s,startRotationX:i,startRotationOrbit:o}=this.getState(),{width:a,height:u}=this.getViewportProps();if(!s||i===void 0||o===void 0)return this;let f;if(e){let h=(e[0]-s[0])/a;const p=(e[1]-s[1])/u;(i<-90||i>90)&&(h*=-1),f={rotationX:i+p*180,rotationOrbit:o+h*180}}else f={rotationX:i+r,rotationOrbit:o+t};return this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:s}=r;return Math.abs(s-t.rotationOrbit)>180&&(r.rotationOrbit=s<0?s+360:s-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:s,startZoomPosition:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(t)||this._unproject(e)),!i)return this;const o=this._calculateNewZoom({scale:r,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:r,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);const i=t+Math.log2(e);return cn(i,s,r)}_panFromCenter(e){const{width:t,height:r,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:s,maxRotationX:i,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(s)?[cn(s[0],r,t),cn(s[1],r,t)]:cn(s,r,t),e.rotationX=cn(e.rotationX,o,i),(a<-180||a>180)&&(e.rotationOrbit=xB(a+180,360)-180),e}}class Nj extends Oj{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:r,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);let i=Math.log2(e);if(Array.isArray(t)){let[o,a]=t;switch(this.zoomAxis){case"X":o=cn(o+i,s,r);break;case"Y":a=cn(a+i,s,r);break;default:let u=Math.min(o+i,a+i);u<s&&(i+=s-u),u=Math.max(o+i,a+i),u>r&&(i+=r-u),o+=i,a+=i}return[o,a]}return cn(t+i,s,r)}}class Dj extends bA{constructor(){super(...arguments),this.ControllerState=Nj,this.transition={transitionDuration:300,transitionInterpolator:new i1(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}}class d1 extends ya{constructor(e={}){super(e)}get ViewportType(){return kj}get ControllerType(){return Dj}}d1.displayName="OrthographicView";class Ma{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Xr(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,r={updateTriggers:{}};for(const s in t)if(s in this.props){const i=t[s],o=this.props[s];r[s]=o,i&&i.type==="accessor"&&(r.updateTriggers[s]=this.props.updateTriggers[s],typeof o=="function"&&(r[s]=this.getSubLayerAccessor(o)))}return r}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}Ma.defaultProps={};Ma.extensionName="LayerExtension";class nR{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Ql,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:s,geometryBuffer:i,positionFormat:o,dataChanged:a,normalize:u=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=i&&i.size||(o==="XY"?2:3),this.buffers=r,this.normalize=u,i&&(Ln(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),u||(r.vertexPositions=i)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const f of a)this._rebuildGeometry(f);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?WA(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:s,_attributeDefs:i,typedArrayManager:o}=this;for(const a in i)if(a in s)o.release(r[a]),r[a]=null;else{const u=i[a];u.copy=t,r[a]=o.allocate(r[a],e,u)}}_forEachGeometry(e,t,r){const{data:s,getGeometry:i}=this,{iterable:o,objectInfo:a}=_f(s,t,r);for(const u of o){a.index++;const f=i?i(u,a):null;e(f,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:s}=this;const{data:i,geometryBuffer:o}=this,{startRow:a=0,endRow:u=1/0}=e||{},f={};if(e||(t=[0],r=[0]),this.normalize||!o)this._forEachGeometry((p,m)=>{const v=p&&this.normalizeGeometry(p);f[m]=v,r[m+1]=r[m]+(v?this.getGeometrySize(v):0)},a,u),s=r[r.length-1];else if(r=i.startIndices,s=r[i.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof un){const p=this.positionSize*4;s=s||o.byteLength/p}else if(o.buffer){const p=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/p}else if(o.value){const p=o.value,m=o.stride/p.BYTES_PER_ELEMENT||this.positionSize;s=s||p.length/m}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=s;const h={};this._forEachGeometry((p,m)=>{const v=f[m]||p;h.vertexStart=r[m],h.indexStart=t[m];const x=m<r.length-1?r[m+1]:s;h.geometrySize=x-r[m],h.geometryIndex=m,this.updateGeometryAttributes(v,h)},a,u),this.vertexCount=t[t.length-1]}}const Lj=new Uint32Array([0,2,1,0,3,2]),Fj=new Float32Array([0,1,0,0,1,0,1,1]);function Bj(n,e){if(!e)return Uj(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),r=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),s=Math.ceil(t/e)+1,i=Math.ceil(r/e)+1,o=(s-1)*(i-1)*6,a=new Uint32Array(o),u=new Float32Array(s*i*2),f=new Float64Array(s*i*3);let h=0,p=0;for(let m=0;m<s;m++){const v=m/(s-1);for(let x=0;x<i;x++){const w=x/(i-1),T=Vj(n,v,w);f[h*3+0]=T[0],f[h*3+1]=T[1],f[h*3+2]=T[2]||0,u[h*2+0]=v,u[h*2+1]=1-w,m>0&&x>0&&(a[p++]=h-i,a[p++]=h-i-1,a[p++]=h-1,a[p++]=h-i,a[p++]=h-1,a[p++]=h),h++}}return{vertexCount:o,positions:f,indices:a,texCoords:u}}function Uj(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:Lj,texCoords:Fj}}function Vj(n,e,t){return ia(ia(n[0],n[1],t),ia(n[3],n[2],t),e)}const zj=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,$j=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,jj=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${$j}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Wj={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:et.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};let yf=class extends Or{getShaders(){return super.getShaders({vs:zj,fs:jj,modules:[Ao,Ro]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:r=>r.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:r=>r.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:r=>r.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:r}){var i;const s=this.getAttributeManager();if(r.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==t.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const u in a)o&&o[u]!==a[u]&&s.invalidate(u);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;const{width:s,height:i}=t;r.index=0;const o=Hj(r.color);return r.bitmap={size:{width:s,height:i},uv:o,pixel:[Math.floor(o[0]*s),Math.floor(o[1]*i)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return _T(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Bj(t,this.context.viewport.resolution)}_getModel(){return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:t,moduleParameters:r}=e,{model:s,coordinateConversion:i,bounds:o,disablePicking:a}=this.state,{image:u,desaturate:f,transparentColor:h,tintColor:p}=this.props;r.picking.isActive&&a||u&&s&&(s.setUniforms(t),s.setBindings({bitmapTexture:u}),s.setUniforms({desaturate:f,transparentColor:h.map(m=>m/255),tintColor:p.slice(0,3).map(m=>m/255),coordinateConversion:i,bounds:o}),s.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=et;let{_imageCoordinateSystem:s}=this.props;if(s!==r){const{bounds:i}=this.props;if(!_T(i))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:t;if(s=s===e?e:t,s===e&&o===t)return{coordinateConversion:-1,bounds:i};if(s===t&&o===e){const a=_o([i[0],i[1]]),u=_o([i[2],i[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};yf.layerName="BitmapLayer";yf.defaultProps=Wj;function Hj(n){const[e,t,r]=n,s=(r&240)/256,i=(r&15)/16;return[(e+i)/256,(t+s)/256]}function _T(n){return Number.isFinite(n[0])}const Xj=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Yj=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qj=1024,Kj=4,yT=()=>{},xT={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Zj={x:0,y:0,width:0,height:0};function Qj(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Gj(n,e,t,r){const s=Math.min(t/e.width,r/e.height),i=Math.floor(e.width*s),o=Math.floor(e.height*s);return s===1?{data:e,width:i,height:o}:(n.canvas.height=o,n.canvas.width=i,n.clearRect(0,0,i,o),n.drawImage(e,0,0,e.width,e.height,0,0,i,o),{data:n.canvas,width:i,height:o})}function Uu(n){return n&&(n.id||n.url)}function Jj(n,e,t,r){const{width:s,height:i,device:o}=n,a=o.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r}),u=o.createCommandEncoder();return u.copyTextureToTexture({source:n,destination:a,width:s,height:i}),u.finish(),n.destroy(),a}function wT(n,e,t){for(let r=0;r<e.length;r++){const{icon:s,xOffset:i}=e[r],o=Uu(s);n[o]={...s,x:i,y:t}}}function eW({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:s=0,rowHeight:i=0,canvasWidth:o}){let a=[];for(let u=0;u<n.length;u++){const f=n[u],h=Uu(f);if(!t[h]){const{height:p,width:m}=f;r+m+e>o&&(wT(t,a,s),r=0,s=i+s+e,i=0,a=[]),a.push({icon:f,xOffset:r}),r=r+m+e,i=Math.max(i,p)}}return a.length>0&&wT(t,a,s),{mapping:t,rowHeight:i,xOffset:r,yOffset:s,canvasWidth:o,canvasHeight:Qj(i+s+e)}}function tW(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:s,objectInfo:i}=_f(n);for(const o of s){i.index++;const a=e(o,i),u=Uu(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[u]&&(!t[u]||a.url!==t[u].url)&&(r[u]={...a,source:o,sourceIndex:i.index})}return r}class nW{constructor(e,{onUpdate:t=yT,onError:r=yT}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Kj,this._canvasWidth=qj,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Uu(e):e;return this._mapping[t]||Zj}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:s,textureParameters:i}){var o;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),i&&(this._textureParameters=i)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(tW(e,t,this._mapping)||{});if(r.length>0){const{mapping:s,xOffset:i,yOffset:o,rowHeight:a,canvasHeight:u}=eW({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=i,this._yOffset=o,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||xT})),this._texture.height!==this._canvasHeight&&(this._texture=Jj(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||xT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Dd(r.url,this._loadOptions).then(s=>{const i=Uu(r),o=this._mapping[i],{x:a,y:u,width:f,height:h}=o,{data:p,width:m,height:v}=Gj(t,s,f,h);this._texture.setSubImageData({data:p,x:a+(f-m)/2,y:u+(h-v)/2,width:m,height:v}),o.width=m,o.height=v,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const rR=[0,0,0,255],rW={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:rR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class sg extends Or{getShaders(){return super.getShaders({vs:Xj,fs:Yj,modules:[Ao,Ro]})}initializeState(){this.state={iconManager:new nW(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:rR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var v;super.updateState(e);const{props:t,oldProps:r,changeFlags:s}=e,i=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:u,getIcon:f,textureParameters:h}=t,{iconManager:p}=this.state;if(typeof o=="string")return;const m=o||this.internalState.isAsyncPropLoading("iconAtlas");p.setProps({loadOptions:t.loadOptions,autoPacking:!m,iconAtlas:o,iconMapping:m?a:null,textureParameters:h}),m?r.iconMapping!==t.iconMapping&&i.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&p.packIcons(u,f),s.extensionsChanged&&((v=this.state.model)==null||v.destroy(),this.state.model=this._getModel(),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:s,sizeUnits:i,billboard:o,alphaCutoff:a}=this.props,{iconManager:u}=this.state,f=u.getTexture();if(f){const h=this.state.model;h.setBindings({iconsTexture:f}),h.setUniforms(e),h.setUniforms({iconsTextureDim:[f.width,f.height],sizeUnits:vo[i],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:s,billboard:o,alphaCutoff:a}),h.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ci({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const t=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;t?t(e):ut.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:s=t/2,anchorY:i=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,r/2-i]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:s,height:i}=this.state.iconManager.getIconMapping(e);return[t,r,s,i]}}sg.defaultProps=rW;sg.layerName="IconLayer";const sW=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (useShortestPath > 0.5 || useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * useShortestPath > 180.) {
source_world.x += 360. * useShortestPath;
source_world = splitLine(source_world, target_world, 180. * useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * useShortestPath < -180.) {
target_world.x += 360. * useShortestPath;
target_world = splitLine(source_world, target_world, 180. * useShortestPath);
target_world_64low = vec3(0.0);
} else if (useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,iW=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,oW=[0,0,0,255],aW={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:oW},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Eu extends Or{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:sW,fs:iW,modules:[Ao,Ro]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:r,widthMinPixels:s,widthMaxPixels:i,wrapLongitude:o}=this.props,a=this.state.model;a.setUniforms(e),a.setUniforms({widthUnits:vo[t],widthScale:r,widthMinPixels:s,widthMaxPixels:i,useShortestPath:o?1:0}),a.draw(this.context.renderPass),o&&(a.setUniforms({useShortestPath:-1}),a.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ci({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Eu.layerName="LineLayer";Eu.defaultProps=aW;const lW=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,cW=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bT=[0,0,0,255],uW={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:bT},getLineColor:{type:"accessor",value:bT},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class p1 extends Or{getShaders(){return super.getShaders({vs:lW,fs:cW,modules:[Ao,Ro]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:s,radiusMaxPixels:i,stroked:o,filled:a,billboard:u,antialiasing:f,lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:m,lineWidthMaxPixels:v}=this.props,x=this.state.model;x.setUniforms(e),x.setUniforms({stroked:o?1:0,filled:a,billboard:u,antialiasing:f,radiusUnits:vo[t],radiusScale:r,radiusMinPixels:s,radiusMaxPixels:i,lineWidthUnits:vo[h],lineWidthScale:p,lineWidthMinPixels:m,lineWidthMaxPixels:v}),x.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ci({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}p1.defaultProps=uW;p1.layerName="ScatterplotLayer";const sR={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function iR(n,e,t={}){return fW(n,t)!==e?(dW(n,t),!0):!1}function fW(n,e={}){return Math.sign(hW(n,e))}const TT={x:0,y:1,z:2};function hW(n,e={}){const{start:t=0,end:r=n.length,plane:s="xy"}=e,i=e.size||2;let o=0;const a=TT[s[0]],u=TT[s[1]];for(let f=t,h=r-i;f<r;f+=i)o+=(n[f+a]-n[h+a])*(n[f+u]+n[h+u]),h=f;return o/2}function dW(n,e){const{start:t=0,end:r=n.length,size:s=2}=e,i=(r-t)/s,o=Math.floor(i/2);for(let a=0;a<o;++a){const u=t+a*s,f=t+(i-1-a)*s;for(let h=0;h<s;++h){const p=n[u+h];n[u+h]=n[f+h],n[f+h]=p}}}function hs(n,e){const t=e.length,r=n.length;if(r>0){let s=!0;for(let i=0;i<t;i++)if(n[r-t+i]!==e[i]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[r+s]=e[s];return!0}function L_(n,e){const t=e.length;for(let r=0;r<t;r++)n[r]=e[r]}function Vu(n,e,t,r,s=[]){const i=r+e*t;for(let o=0;o<t;o++)s[o]=n[i+o];return s}function F_(n,e,t,r,s=[]){let i,o;if(t&8)i=(r[3]-n[1])/(e[1]-n[1]),o=3;else if(t&4)i=(r[1]-n[1])/(e[1]-n[1]),o=1;else if(t&2)i=(r[2]-n[0])/(e[0]-n[0]),o=2;else if(t&1)i=(r[0]-n[0])/(e[0]-n[0]),o=0;else return null;for(let a=0;a<n.length;a++)s[a]=(o&1)===a?r[o]:i*(e[a]-n[a])+n[a];return s}function md(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function oR(n,e){const{size:t=2,broken:r=!1,gridResolution:s=10,gridOffset:i=[0,0],startIndex:o=0,endIndex:a=n.length}=e||{},u=(a-o)/t;let f=[];const h=[f],p=Vu(n,0,t,o);let m,v;const x=lR(p,s,i,[]),w=[];hs(f,p);for(let T=1;T<u;T++){for(m=Vu(n,T,t,o,m),v=md(m,x);v;){F_(p,m,v,x,w);const E=md(w,x);E&&(F_(p,w,E,x,w),v=E),hs(f,w),L_(p,w),gW(x,s,v),r&&f.length>t&&(f=[],h.push(f),hs(f,p)),v=md(m,x)}hs(f,m),L_(p,m)}return r?h:h[0]}const ST=0,pW=1;function aR(n,e=null,t){if(!n.length)return[];const{size:r=2,gridResolution:s=10,gridOffset:i=[0,0],edgeTypes:o=!1}=t||{},a=[],u=[{pos:n,types:o?new Array(n.length/r).fill(pW):null,holes:e||[]}],f=[[],[]];let h=[];for(;u.length;){const{pos:p,types:m,holes:v}=u.shift();mW(p,r,v[0]||p.length,f),h=lR(f[0],s,i,h);const x=md(f[1],h);if(x){let w=ET(p,m,r,0,v[0]||p.length,h,x);const T={pos:w[0].pos,types:w[0].types,holes:[]},E={pos:w[1].pos,types:w[1].types,holes:[]};u.push(T,E);for(let C=0;C<v.length;C++)w=ET(p,m,r,v[C],v[C+1]||p.length,h,x),w[0]&&(T.holes.push(T.pos.length),T.pos=Gh(T.pos,w[0].pos),o&&(T.types=Gh(T.types,w[0].types))),w[1]&&(E.holes.push(E.pos.length),E.pos=Gh(E.pos,w[1].pos),o&&(E.types=Gh(E.types,w[1].types)))}else{const w={positions:p};o&&(w.edgeTypes=m),v.length&&(w.holeIndices=v),a.push(w)}}return a}function ET(n,e,t,r,s,i,o){const a=(s-r)/t,u=[],f=[],h=[],p=[],m=[];let v,x,w;const T=Vu(n,a-1,t,r);let E=Math.sign(o&8?T[1]-i[3]:T[0]-i[2]),C=e&&e[a-1],P=0,L=0;for(let I=0;I<a;I++)v=Vu(n,I,t,r,v),x=Math.sign(o&8?v[1]-i[3]:v[0]-i[2]),w=e&&e[r/t+I],x&&E&&E!==x&&(F_(T,v,o,i,m),hs(u,m)&&h.push(C),hs(f,m)&&p.push(C)),x<=0?(hs(u,v)&&h.push(w),P-=x):h.length&&(h[h.length-1]=ST),x>=0?(hs(f,v)&&p.push(w),L+=x):p.length&&(p[p.length-1]=ST),L_(T,v),E=x,C=w;return[P?{pos:u,types:e&&h}:null,L?{pos:f,types:e&&p}:null]}function lR(n,e,t,r){const s=Math.floor((n[0]-t[0])/e)*e+t[0],i=Math.floor((n[1]-t[1])/e)*e+t[1];return r[0]=s,r[1]=i,r[2]=s+e,r[3]=i+e,r}function gW(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function mW(n,e,t,r){let s=1/0,i=-1/0,o=1/0,a=-1/0;for(let u=0;u<t;u+=e){const f=n[u],h=n[u+1];s=f<s?f:s,i=f>i?f:i,o=h<o?h:o,a=h>a?h:a}return r[0][0]=s,r[0][1]=o,r[1][0]=i,r[1][1]=a,r}function Gh(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const vW=85.051129;function _W(n,e){const{size:t=2,startIndex:r=0,endIndex:s=n.length,normalize:i=!0}=e||{},o=n.slice(r,s);cR(o,t,0,s-r);const a=oR(o,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(i)for(const u of a)uR(u,t);return a}function yW(n,e=null,t){const{size:r=2,normalize:s=!0,edgeTypes:i=!1}=t||{};e=e||[];const o=[],a=[];let u=0,f=0;for(let p=0;p<=e.length;p++){const m=e[p]||n.length,v=f,x=xW(n,r,u,m);for(let w=x;w<m;w++)o[f++]=n[w];for(let w=u;w<x;w++)o[f++]=n[w];cR(o,r,v,f),wW(o,r,v,f,t==null?void 0:t.maxLatitude),u=m,a[p]=f}a.pop();const h=aR(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:i});if(s)for(const p of h)uR(p.positions,r);return h}function xW(n,e,t,r){let s=-1,i=-1;for(let o=t+1;o<r;o+=e){const a=Math.abs(n[o]);a>s&&(s=a,i=o-1)}return i}function wW(n,e,t,r,s=vW){const i=n[t],o=n[r-e];if(Math.abs(i-o)>180){const a=Vu(n,0,e,t);a[0]+=Math.round((o-i)/360)*360,hs(n,a),a[1]=Math.sign(a[1])*s,hs(n,a),a[0]=i,hs(n,a)}}function cR(n,e,t,r){let s=n[0],i;for(let o=t;o<r;o+=e){i=n[o];const a=i-s;(a>180||a<-180)&&(i-=Math.round(a/360)*360),n[o]=s=i}}function uR(n,e){let t;const r=n.length/e;for(let i=0;i<r&&(t=n[i*e],(t+180)%360===0);i++);const s=-Math.round(t/360)*360;if(s!==0)for(let i=0;i<r;i++)n[i*e]+=s}function bW(n,e,t,r){let s;if(Array.isArray(n[0])){const i=n.length*e;s=new Array(i);for(let o=0;o<n.length;o++)for(let a=0;a<e;a++)s[o*e+a]=n[o][a]||0}else s=n;return t?oR(s,{size:e,gridResolution:t}):r?_W(s,{size:e}):s}const TW=1,SW=2,sv=4;class EW extends nR{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?bW(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(AT(e)){let r=0;for(const s of e)r+=this.getGeometrySize(s);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&AT(e))for(const r of e){const s=this.getGeometrySize(r);t.geometrySize=s,this.updateGeometryAttributes(r,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:i,geometrySize:o}=t;r.fill(0,i,i+o),s?(r[i]=sv,r[i+o-2]=sv):(r[i]+=TW,r[i+o-2]+=SW),r[i+o-1]=sv}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:s,geometrySize:i}=t,o=new Array(3);for(let a=s,u=0;u<i;a++,u++)this.getPointOnPath(e,u,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const i=t*s;return r[0]=e[i],r[1]=e[i+1],r[2]=s===3&&e[i+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function AT(n){return Array.isArray(n[0])}const AW=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,RW=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fR=[0,0,0,255],CW={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:fR},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},iv={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class ig extends Or{getShaders(){return super.getShaders({vs:AW,fs:RW,modules:[Ao,Ro]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:iv,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:iv,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:iv,defaultValue:fR},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:s,target:i})=>this.encodePickingColor(r&&r.__source?r.__source.index:s,i)}}),this.setState({pathTesselator:new EW({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:t,changeFlags:r}=e,s=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,u=t.data.attributes||{};a.updateGeometry({data:t.data,geometryBuffer:u.getPath,buffers:u,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||s.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(i=>i.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:s,miterLimit:i,widthUnits:o,widthScale:a,widthMinPixels:u,widthMaxPixels:f}=this.props,h=this.state.model;h.setUniforms(e),h.setUniforms({jointType:Number(t),capType:Number(r),billboard:s,widthUnits:vo[o],widthScale:a,miterLimit:i,widthMinPixels:u,widthMaxPixels:f}),h.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ci({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}ig.defaultProps=CW;ig.layerName="PathLayer";var Jh={exports:{}},RT;function PW(){if(RT)return Jh.exports;RT=1,Jh.exports=n,Jh.exports.default=n;function n(U,H,N){N=N||2;var Y=H&&H.length,k=Y?H[0]*N:U.length,b=e(U,0,k,N,!0),O=[];if(!b||b.next===b.prev)return O;var W,K,ee,te,ce,me,xe;if(Y&&(b=u(U,H,b,N)),U.length>80*N){W=ee=U[0],K=te=U[1];for(var Pe=N;Pe<k;Pe+=N)ce=U[Pe],me=U[Pe+1],ce<W&&(W=ce),me<K&&(K=me),ce>ee&&(ee=ce),me>te&&(te=me);xe=Math.max(ee-W,te-K),xe=xe!==0?32767/xe:0}return r(b,O,N,W,K,xe,0),O}function e(U,H,N,Y,k){var b,O;if(k===Me(U,H,N,Y)>0)for(b=H;b<N;b+=Y)O=pe(b,U[b],U[b+1],O);else for(b=N-Y;b>=H;b-=Y)O=pe(b,U[b],U[b+1],O);return O&&L(O,O.next)&&(ne(O),O=O.next),O}function t(U,H){if(!U)return U;H||(H=U);var N=U,Y;do if(Y=!1,!N.steiner&&(L(N,N.next)||P(N.prev,N,N.next)===0)){if(ne(N),N=H=N.prev,N===N.next)break;Y=!0}else N=N.next;while(Y||N!==H);return H}function r(U,H,N,Y,k,b,O){if(U){!O&&b&&v(U,Y,k,b);for(var W=U,K,ee;U.prev!==U.next;){if(K=U.prev,ee=U.next,b?i(U,Y,k,b):s(U)){H.push(K.i/N|0),H.push(U.i/N|0),H.push(ee.i/N|0),ne(U),U=ee.next,W=ee.next;continue}if(U=ee,U===W){O?O===1?(U=o(t(U),H,N),r(U,H,N,Y,k,b,2)):O===2&&a(U,H,N,Y,k,b):r(t(U),H,N,Y,k,b,1);break}}}}function s(U){var H=U.prev,N=U,Y=U.next;if(P(H,N,Y)>=0)return!1;for(var k=H.x,b=N.x,O=Y.x,W=H.y,K=N.y,ee=Y.y,te=k<b?k<O?k:O:b<O?b:O,ce=W<K?W<ee?W:ee:K<ee?K:ee,me=k>b?k>O?k:O:b>O?b:O,xe=W>K?W>ee?W:ee:K>ee?K:ee,Pe=Y.next;Pe!==H;){if(Pe.x>=te&&Pe.x<=me&&Pe.y>=ce&&Pe.y<=xe&&E(k,W,b,K,O,ee,Pe.x,Pe.y)&&P(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.next}return!0}function i(U,H,N,Y){var k=U.prev,b=U,O=U.next;if(P(k,b,O)>=0)return!1;for(var W=k.x,K=b.x,ee=O.x,te=k.y,ce=b.y,me=O.y,xe=W<K?W<ee?W:ee:K<ee?K:ee,Pe=te<ce?te<me?te:me:ce<me?ce:me,Ue=W>K?W>ee?W:ee:K>ee?K:ee,Ke=te>ce?te>me?te:me:ce>me?ce:me,tt=w(xe,Pe,H,N,Y),Qe=w(Ue,Ke,H,N,Y),He=U.prevZ,Ie=U.nextZ;He&&He.z>=tt&&Ie&&Ie.z<=Qe;){if(He.x>=xe&&He.x<=Ue&&He.y>=Pe&&He.y<=Ke&&He!==k&&He!==O&&E(W,te,K,ce,ee,me,He.x,He.y)&&P(He.prev,He,He.next)>=0||(He=He.prevZ,Ie.x>=xe&&Ie.x<=Ue&&Ie.y>=Pe&&Ie.y<=Ke&&Ie!==k&&Ie!==O&&E(W,te,K,ce,ee,me,Ie.x,Ie.y)&&P(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;He&&He.z>=tt;){if(He.x>=xe&&He.x<=Ue&&He.y>=Pe&&He.y<=Ke&&He!==k&&He!==O&&E(W,te,K,ce,ee,me,He.x,He.y)&&P(He.prev,He,He.next)>=0)return!1;He=He.prevZ}for(;Ie&&Ie.z<=Qe;){if(Ie.x>=xe&&Ie.x<=Ue&&Ie.y>=Pe&&Ie.y<=Ke&&Ie!==k&&Ie!==O&&E(W,te,K,ce,ee,me,Ie.x,Ie.y)&&P(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function o(U,H,N){var Y=U;do{var k=Y.prev,b=Y.next.next;!L(k,b)&&I(k,Y,Y.next,b)&&Q(k,b)&&Q(b,k)&&(H.push(k.i/N|0),H.push(Y.i/N|0),H.push(b.i/N|0),ne(Y),ne(Y.next),Y=U=b),Y=Y.next}while(Y!==U);return t(Y)}function a(U,H,N,Y,k,b){var O=U;do{for(var W=O.next.next;W!==O.prev;){if(O.i!==W.i&&C(O,W)){var K=he(O,W);O=t(O,O.next),K=t(K,K.next),r(O,H,N,Y,k,b,0),r(K,H,N,Y,k,b,0);return}W=W.next}O=O.next}while(O!==U)}function u(U,H,N,Y){var k=[],b,O,W,K,ee;for(b=0,O=H.length;b<O;b++)W=H[b]*Y,K=b<O-1?H[b+1]*Y:U.length,ee=e(U,W,K,Y,!1),ee===ee.next&&(ee.steiner=!0),k.push(T(ee));for(k.sort(f),b=0;b<k.length;b++)N=h(k[b],N);return N}function f(U,H){return U.x-H.x}function h(U,H){var N=p(U,H);if(!N)return H;var Y=he(N,U);return t(Y,Y.next),t(N,N.next)}function p(U,H){var N=H,Y=U.x,k=U.y,b=-1/0,O;do{if(k<=N.y&&k>=N.next.y&&N.next.y!==N.y){var W=N.x+(k-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(W<=Y&&W>b&&(b=W,O=N.x<N.next.x?N:N.next,W===Y))return O}N=N.next}while(N!==H);if(!O)return null;var K=O,ee=O.x,te=O.y,ce=1/0,me;N=O;do Y>=N.x&&N.x>=ee&&Y!==N.x&&E(k<te?Y:b,k,ee,te,k<te?b:Y,k,N.x,N.y)&&(me=Math.abs(k-N.y)/(Y-N.x),Q(N,U)&&(me<ce||me===ce&&(N.x>O.x||N.x===O.x&&m(O,N)))&&(O=N,ce=me)),N=N.next;while(N!==K);return O}function m(U,H){return P(U.prev,U,H.prev)<0&&P(H.next,U,U.next)<0}function v(U,H,N,Y){var k=U;do k.z===0&&(k.z=w(k.x,k.y,H,N,Y)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==U);k.prevZ.nextZ=null,k.prevZ=null,x(k)}function x(U){var H,N,Y,k,b,O,W,K,ee=1;do{for(N=U,U=null,b=null,O=0;N;){for(O++,Y=N,W=0,H=0;H<ee&&(W++,Y=Y.nextZ,!!Y);H++);for(K=ee;W>0||K>0&&Y;)W!==0&&(K===0||!Y||N.z<=Y.z)?(k=N,N=N.nextZ,W--):(k=Y,Y=Y.nextZ,K--),b?b.nextZ=k:U=k,k.prevZ=b,b=k;N=Y}b.nextZ=null,ee*=2}while(O>1);return U}function w(U,H,N,Y,k){return U=(U-N)*k|0,H=(H-Y)*k|0,U=(U|U<<8)&16711935,U=(U|U<<4)&252645135,U=(U|U<<2)&858993459,U=(U|U<<1)&1431655765,H=(H|H<<8)&16711935,H=(H|H<<4)&252645135,H=(H|H<<2)&858993459,H=(H|H<<1)&1431655765,U|H<<1}function T(U){var H=U,N=U;do(H.x<N.x||H.x===N.x&&H.y<N.y)&&(N=H),H=H.next;while(H!==U);return N}function E(U,H,N,Y,k,b,O,W){return(k-O)*(H-W)>=(U-O)*(b-W)&&(U-O)*(Y-W)>=(N-O)*(H-W)&&(N-O)*(b-W)>=(k-O)*(Y-W)}function C(U,H){return U.next.i!==H.i&&U.prev.i!==H.i&&!q(U,H)&&(Q(U,H)&&Q(H,U)&&le(U,H)&&(P(U.prev,U,H.prev)||P(U,H.prev,H))||L(U,H)&&P(U.prev,U,U.next)>0&&P(H.prev,H,H.next)>0)}function P(U,H,N){return(H.y-U.y)*(N.x-H.x)-(H.x-U.x)*(N.y-H.y)}function L(U,H){return U.x===H.x&&U.y===H.y}function I(U,H,N,Y){var k=j(P(U,H,N)),b=j(P(U,H,Y)),O=j(P(N,Y,U)),W=j(P(N,Y,H));return!!(k!==b&&O!==W||k===0&&F(U,N,H)||b===0&&F(U,Y,H)||O===0&&F(N,U,Y)||W===0&&F(N,H,Y))}function F(U,H,N){return H.x<=Math.max(U.x,N.x)&&H.x>=Math.min(U.x,N.x)&&H.y<=Math.max(U.y,N.y)&&H.y>=Math.min(U.y,N.y)}function j(U){return U>0?1:U<0?-1:0}function q(U,H){var N=U;do{if(N.i!==U.i&&N.next.i!==U.i&&N.i!==H.i&&N.next.i!==H.i&&I(N,N.next,U,H))return!0;N=N.next}while(N!==U);return!1}function Q(U,H){return P(U.prev,U,U.next)<0?P(U,H,U.next)>=0&&P(U,U.prev,H)>=0:P(U,H,U.prev)<0||P(U,U.next,H)<0}function le(U,H){var N=U,Y=!1,k=(U.x+H.x)/2,b=(U.y+H.y)/2;do N.y>b!=N.next.y>b&&N.next.y!==N.y&&k<(N.next.x-N.x)*(b-N.y)/(N.next.y-N.y)+N.x&&(Y=!Y),N=N.next;while(N!==U);return Y}function he(U,H){var N=new ve(U.i,U.x,U.y),Y=new ve(H.i,H.x,H.y),k=U.next,b=H.prev;return U.next=H,H.prev=U,N.next=k,k.prev=N,Y.next=N,N.prev=Y,b.next=Y,Y.prev=b,Y}function pe(U,H,N,Y){var k=new ve(U,H,N);return Y?(k.next=Y.next,k.prev=Y,Y.next.prev=k,Y.next=k):(k.prev=k,k.next=k),k}function ne(U){U.next.prev=U.prev,U.prev.next=U.next,U.prevZ&&(U.prevZ.nextZ=U.nextZ),U.nextZ&&(U.nextZ.prevZ=U.prevZ)}function ve(U,H,N){this.i=U,this.x=H,this.y=N,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(U,H,N,Y){var k=H&&H.length,b=k?H[0]*N:U.length,O=Math.abs(Me(U,0,b,N));if(k)for(var W=0,K=H.length;W<K;W++){var ee=H[W]*N,te=W<K-1?H[W+1]*N:U.length;O-=Math.abs(Me(U,ee,te,N))}var ce=0;for(W=0;W<Y.length;W+=3){var me=Y[W]*N,xe=Y[W+1]*N,Pe=Y[W+2]*N;ce+=Math.abs((U[me]-U[Pe])*(U[xe+1]-U[me+1])-(U[me]-U[xe])*(U[Pe+1]-U[me+1]))}return O===0&&ce===0?0:Math.abs((ce-O)/O)};function Me(U,H,N,Y){for(var k=0,b=H,O=N-Y;b<N;b+=Y)k+=(U[O]-U[b])*(U[b+1]+U[O+1]),O=b;return k}return n.flatten=function(U){for(var H=U[0][0].length,N={vertices:[],holes:[],dimensions:H},Y=0,k=0;k<U.length;k++){for(var b=0;b<U[k].length;b++)for(var O=0;O<H;O++)N.vertices.push(U[k][b][O]);k>0&&(Y+=U[k-1].length,N.holes.push(Y))}return N},Jh.exports}var IW=PW();const MW=Ea(IW),ed=sR.CLOCKWISE,CT=sR.COUNTER_CLOCKWISE,ao={};function kW(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function fu(n){return"positions"in n?n.positions:n}function vd(n){return"holeIndices"in n?n.holeIndices:null}function OW(n){return Array.isArray(n[0])}function NW(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function DW(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function LW(n,e,t,r){for(let s=0;s<e;s++)if(n[t+s]!==n[r-e+s])return!1;return!0}function PT(n,e,t,r,s){let i=e;const o=t.length;for(let a=0;a<o;a++)for(let u=0;u<r;u++)n[i++]=t[a][u]||0;if(!DW(t))for(let a=0;a<r;a++)n[i++]=t[0][a]||0;return ao.start=e,ao.end=i,ao.size=r,iR(n,s,ao),i}function IT(n,e,t,r,s=0,i,o){i=i||t.length;const a=i-s;if(a<=0)return e;let u=e;for(let f=0;f<a;f++)n[u++]=t[s+f];if(!LW(t,r,s,i))for(let f=0;f<r;f++)n[u++]=t[s+f];return ao.start=e,ao.end=u,ao.size=r,iR(n,o,ao),u}function hR(n,e){kW(n);const t=[],r=[];if("positions"in n){const{positions:s,holeIndices:i}=n;if(i){let o=0;for(let a=0;a<=i.length;a++)o=IT(t,o,s,e,i[a-1],i[a],a===0?ed:CT),r.push(o);return r.pop(),{positions:t,holeIndices:r}}n=s}if(!OW(n))return IT(t,0,n,e,0,t.length,ed),t;if(!NW(n)){let s=0;for(const[i,o]of n.entries())s=PT(t,s,o,e,i===0?ed:CT),r.push(s);return r.pop(),{positions:t,holeIndices:r}}return PT(t,0,n,e,ed),t}function ov(n,e,t){const r=n.length/3;let s=0;for(let i=0;i<r;i++){const o=(i+1)%r;s+=n[i*3+e]*n[o*3+t],s-=n[o*3+e]*n[i*3+t]}return Math.abs(s/2)}function MT(n,e,t,r){const s=n.length/3;for(let i=0;i<s;i++){const o=i*3,a=n[o+0],u=n[o+1],f=n[o+2];n[o+e]=a,n[o+t]=u,n[o+r]=f}}function FW(n,e,t,r){let s=vd(n);s&&(s=s.map(a=>a/e));let i=fu(n);const o=r&&e===3;if(t){const a=i.length;i=i.slice();const u=[];for(let f=0;f<a;f+=e){u[0]=i[f],u[1]=i[f+1],o&&(u[2]=i[f+2]);const h=t(u);i[f]=h[0],i[f+1]=h[1],o&&(i[f+2]=h[2])}}if(o){const a=ov(i,0,1),u=ov(i,0,2),f=ov(i,1,2);if(!a&&!u&&!f)return[];a>u&&a>f||(u>f?(t||(i=i.slice()),MT(i,0,2,1)):(t||(i=i.slice()),MT(i,2,0,1)))}return MW(i,s,e)}class BW extends nR{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=hR(e,this.positionSize);return this.opts.resolution?aR(fu(t),vd(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?yW(fu(t),vd(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(kT(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return fu(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&kT(e))for(const r of e){const s=this.getGeometrySize(r);t.geometrySize=s,this.updateGeometryAttributes(r,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:s}){const{attributes:i,indexStarts:o,typedArrayManager:a}=this;let u=i.indices;if(!u||!e)return;let f=s;const h=FW(e,this.positionSize,this.opts.preproject,this.opts.full3d);u=a.allocate(u,s+h.length,{copy:!0});for(let p=0;p<h.length;p++)u[f++]=h[p]+r;o[t+1]=s+h.length,i.indices=u}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:s},positionSize:i}=this;if(!s||!e)return;const o=fu(e);for(let a=t,u=0;u<r;a++,u++){const f=o[u*i],h=o[u*i+1],p=i>2?o[u*i+2]:0;s[a*3]=f,s[a*3+1]=h,s[a*3+2]=p}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:s}=this,i=this.attributes.vertexValid,o=e&&vd(e);if(e&&e.edgeTypes?i.set(e.edgeTypes,t):i.fill(1,t,t+r),o)for(let a=0;a<o.length;a++)i[t+o[a]/s-1]=0;i[t+r-1]=0}}function kT(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const dR=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,UW=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${dR}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,VW=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${dR}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,zW=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,tp=[0,0,0,255],$W={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:tp},getLineColor:{type:"accessor",value:tp},material:!0},td={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class xf extends Or{getShaders(e){return super.getShaders({vs:e==="top"?UW:VW,fs:zW,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ao,_9,Ro]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===et.DEFAULT&&(t=et.LNGLAT);let s;t===et.LNGLAT&&(r?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new BW({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const i=this.getAttributeManager(),o=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:td,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:td,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:td,accessor:"getFillColor",defaultValue:tp},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:td,accessor:"getLineColor",defaultValue:tp},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:u,target:f})=>this.encodePickingColor(a&&a.__source?a.__source.index:u,f)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(i=>i.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:s,elevationScale:i}=this.props,{topModel:o,sideModel:a,wireframeModel:u,polygonTesselator:f}=this.state,h={...e,extruded:!!t,elevationScale:i};u&&s&&(u.setInstanceCount(f.instanceCount-1),u.setUniforms(h),u.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(f.instanceCount-1),a.setUniforms(h),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(f.vertexCount),o.setUniforms(h),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:s}=e,i=this.getAttributeManager();(s.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(u=>u.destroy()),this.setState(this._getModels()),i.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:i}=this.state,o=e.data.attributes||{};i.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let s,i,o;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Jn(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});i=new Jn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new ci({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Jn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new ci({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[i,o,s].filter(Boolean),topModel:s,sideModel:i,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}xf.defaultProps=$W;xf.layerName="SolidPolygonLayer";function pR({data:n,getIndex:e,dataRange:t,replace:r}){const{startRow:s=0,endRow:i=1/0}=t,o=n.length;let a=o,u=o;for(let m=0;m<o;m++){const v=e(n[m]);if(a>m&&v>=s&&(a=m),v>=i){u=m;break}}let f=a;const p=u-a!==r.length?n.slice(u):void 0;for(let m=0;m<r.length;m++)n[f++]=r[m];if(p){for(let m=0;m<p.length;m++)n[f++]=p[m];n.length=f}return{startRow:a,endRow:a+r.length}}const gR=[0,0,0,255],jW=[0,0,0,255],WW={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:n=>n.polygon},getFillColor:{type:"accessor",value:jW},getLineColor:{type:"accessor",value:gR},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class np extends Qr{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ut.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),s=e.dataChanged.map(i=>pR({data:r,getIndex:o=>o.__source.index,dataRange:i,replace:this._getPaths(i)}));this.setState({paths:r,pathsDiff:s})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:r,positionFormat:s,_normalize:i}=this.props,o=[],a=s==="XY"?2:3,{startRow:u,endRow:f}=e,{iterable:h,objectInfo:p}=_f(t,u,f);for(const m of h){p.index++;let v=r(m,p);i&&(v=hR(v,a));const{holeIndices:x}=v,w=v.positions||v;if(x)for(let T=0;T<=x.length;T++){const E=w.slice(x[T-1]||0,x[T]||w.length);o.push(this.getSubLayerRow({path:E},m,p.index))}else o.push(this.getSubLayerRow({path:w},m,p.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:r,filled:s,extruded:i,wireframe:o,_normalize:a,_windingOrder:u,elevationScale:f,transitions:h,positionFormat:p}=this.props,{lineWidthUnits:m,lineWidthScale:v,lineWidthMinPixels:x,lineWidthMaxPixels:w,lineJointRounded:T,lineMiterLimit:E,lineDashJustified:C}=this.props,{getFillColor:P,getLineColor:L,getLineWidth:I,getLineDashArray:F,getElevation:j,getPolygon:q,updateTriggers:Q,material:le}=this.props,{paths:he,pathsDiff:pe}=this.state,ne=this.getSubLayerClass("fill",xf),ve=this.getSubLayerClass("stroke",ig),Me=this.shouldRenderSubLayer("fill",he)&&new ne({_dataDiff:t,extruded:i,elevationScale:f,filled:s,wireframe:o,_normalize:a,_windingOrder:u,getElevation:j,getFillColor:P,getLineColor:i&&o?L:gR,material:le,transitions:h},this.getSubLayerProps({id:"fill",updateTriggers:Q&&{getPolygon:Q.getPolygon,getElevation:Q.getElevation,getFillColor:Q.getFillColor,lineColors:i&&o,getLineColor:Q.getLineColor}}),{data:e,positionFormat:p,getPolygon:q}),U=!i&&r&&this.shouldRenderSubLayer("stroke",he)&&new ve({_dataDiff:pe&&(()=>pe),widthUnits:m,widthScale:v,widthMinPixels:x,widthMaxPixels:w,jointRounded:T,miterLimit:E,dashJustified:C,_pathType:"loop",transitions:h&&{getWidth:h.getLineWidth,getColor:h.getLineColor,getPath:h.getPolygon},getColor:this.getSubLayerAccessor(L),getWidth:this.getSubLayerAccessor(I),getDashArray:this.getSubLayerAccessor(F)},this.getSubLayerProps({id:"stroke",updateTriggers:Q&&{getWidth:Q.getLineWidth,getColor:Q.getLineColor,getDashArray:Q.getLineDashArray}}),{data:he,positionFormat:p,getPath:H=>H.path});return[!i&&Me,U,i&&Me]}}np.layerName="PolygonLayer";np.defaultProps=WW;function HW(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,r=n.featureIds.value[t];return t!==-1?XW(n,r,t):null}function XW(n,e,t){const r={properties:{...n.properties[e]}};for(const s in n.numericProps)r.properties[s]=n.numericProps[s].value[t];return r}function YW(n,e){const t={points:null,lines:null,polygons:null};for(const r in t){const s=n[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(s.length*4);const i=[];for(let o=0;o<s.length;o++)e(s[o],i),t[r][o*4+0]=i[0],t[r][o*4+1]=i[1],t[r][o*4+2]=i[2],t[r][o*4+3]=255}return t}const qW=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,av=192/256,OT=[],KW={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class g1 extends sg{getShaders(){return{...super.getShaders(),fs:qW}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:r,target:s})=>this.encodePickingColor(r,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:s}=t;s!==r.outlineColor&&(s=s.map(i=>i/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&ut.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:r,outlineWidth:s}=this.props,{outlineColor:i}=this.state,o=s?Math.max(r,av*(1-s)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:av,outlineBuffer:o,gamma:r,sdf:!!t,outlineColor:i},super.draw(e),t&&s){const{iconManager:a}=this.state,u=a.getTexture(),f=this.state.model;u&&(f.setUniforms({outlineBuffer:av}),f.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):OT}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):OT}}g1.defaultProps=KW;g1.layerName="MultiIconLayer";const rp=1e20;class ZW{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:s=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=r;const u=this.size=e+t*4,f=this._createCanvas(u),h=this.ctx=f.getContext("2d",{willReadFrequently:!0});h.font=`${a} ${o} ${e}px ${i}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),u=0,f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),h=Math.min(this.size-this.buffer,a+Math.ceil(s)),p=f+2*this.buffer,m=h+2*this.buffer,v=Math.max(p*m,0),x=new Uint8ClampedArray(v),w={data:x,width:p,height:m,glyphWidth:f,glyphHeight:h,glyphTop:a,glyphLeft:u,glyphAdvance:t};if(f===0||h===0)return w;const{ctx:T,buffer:E,gridInner:C,gridOuter:P}=this;T.clearRect(E,E,f,h),T.fillText(e,E,E+a);const L=T.getImageData(E,E,f,h);P.fill(rp,0,v),C.fill(0,0,v);for(let I=0;I<h;I++)for(let F=0;F<f;F++){const j=L.data[4*(I*f+F)+3]/255;if(j===0)continue;const q=(I+E)*p+F+E;if(j===1)P[q]=0,C[q]=rp;else{const Q=.5-j;P[q]=Q>0?Q*Q:0,C[q]=Q<0?Q*Q:0}}NT(P,0,0,p,m,p,this.f,this.v,this.z),NT(C,E,E,f,h,p,this.f,this.v,this.z);for(let I=0;I<v;I++){const F=Math.sqrt(P[I])-Math.sqrt(C[I]);x[I]=Math.round(255-255*(F/this.radius+this.cutoff))}return w}}function NT(n,e,t,r,s,i,o,a,u){for(let f=e;f<e+r;f++)DT(n,t*i+f,i,s,o,a,u);for(let f=t;f<t+s;f++)DT(n,f*i+e,1,r,o,a,u)}function DT(n,e,t,r,s,i,o){i[0]=0,o[0]=-1e20,o[1]=rp,s[0]=n[e];for(let a=1,u=0,f=0;a<r;a++){s[a]=n[e+a*t];const h=a*a;do{const p=i[u];f=(s[a]-s[p]+h-p*p)/(a-p)/2}while(f<=o[u]&&--u>-1);u++,i[u]=a,o[u]=f,o[u+1]=rp}for(let a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;const f=i[u],h=a-f;n[e+a*t]=s[f]+h*h}}const QW=32,GW=[];function JW(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function eH({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:s,mapping:i={},xOffset:o=0,yOffset:a=0}){let u=0,f=o;const h=t+r*2;for(const p of n)if(!i[p]){const m=e(p);f+m+r*2>s&&(f=0,u++),i[p]={x:f+r,y:a+u*h+r,width:m,height:h,layoutWidth:m,layoutHeight:t},f+=m+r*2}return{mapping:i,xOffset:f,yOffset:a+u*h,canvasHeight:JW(a+(u+1)*h)}}function mR(n,e,t,r){var i;let s=0;for(let o=e;o<t;o++){const a=n[o];s+=((i=r[a])==null?void 0:i.layoutWidth)||0}return s}function vR(n,e,t,r,s,i){let o=e,a=0;for(let u=e;u<t;u++){const f=mR(n,u,u+1,s);a+f>r&&(o<u&&i.push(u),o=u,a=0),a+=f}return a}function tH(n,e,t,r,s,i){let o=e,a=e,u=e,f=0;for(let h=e;h<t;h++)if((n[h]===" "||n[h+1]===" "||h+1===t)&&(u=h+1),u>a){let p=mR(n,a,u,s);f+p>r&&(o<a&&(i.push(a),o=a,f=0),p>r&&(p=vR(n,a,u,r,s,i),o=i[i.length-1])),a=u,f+=p}return f}function nH(n,e,t,r,s=0,i){i===void 0&&(i=n.length);const o=[];return e==="break-all"?vR(n,s,i,t,r,o):tH(n,s,i,t,r,o),o}function rH(n,e,t,r,s,i){let o=0,a=0;for(let u=e;u<t;u++){const f=n[u],h=r[f];h?(a||(a=h.layoutHeight),s[u]=o+h.layoutWidth/2,o+=h.layoutWidth):(ut.warn(`Missing character: ${f} (${f.codePointAt(0)})`)(),s[u]=o,o+=QW)}i[0]=o,i[1]=a}function sH(n,e,t,r,s){var T;const i=Array.from(n),o=i.length,a=new Array(o),u=new Array(o),f=new Array(o),h=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,p=[0,0],m=[0,0];let v=0,x=0,w=0;for(let E=0;E<=o;E++){const C=i[E];if((C===`
`||E===o)&&(w=E),w>x){const P=h?nH(i,t,r,s,x,w):GW;for(let L=0;L<=P.length;L++){const I=L===0?x:P[L-1],F=L<P.length?P[L]:w;rH(i,I,F,s,a,m);for(let j=I;j<F;j++){const q=i[j],Q=((T=s[q])==null?void 0:T.layoutOffsetY)||0;u[j]=v+m[1]/2+Q,f[j]=m[0]}v=v+m[1]*e,p[0]=Math.max(p[0],m[0])}x=w}C===`
`&&(a[x]=0,u[x]=0,f[x]=0,x++)}return p[1]=v,{x:a,y:u,rowWidth:f,size:p}}function iH({value:n,length:e,stride:t,offset:r,startIndices:s,characterSet:i}){const o=n.BYTES_PER_ELEMENT,a=t?t/o:1,u=r?r/o:0,f=s[e]||Math.ceil((n.length-u)/a),h=i&&new Set,p=new Array(e);let m=n;if(a>1||u>0){const v=n.constructor;m=new v(f);for(let x=0;x<f;x++)m[x]=n[x*a+u]}for(let v=0;v<e;v++){const x=s[v],w=s[v+1]||f,T=m.subarray(x,w);p[v]=String.fromCodePoint.apply(null,T),h&&T.forEach(h.add,h)}if(h)for(const v of h)i.add(String.fromCodePoint(v));return{texts:p,characterCount:f}}class _R{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function oH(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Dl={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:oH(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},LT=1024,FT=.9,BT=1.2,yR=3;let sp=new _R(yR);function aH(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=sp.get(n);if(!r)return t;for(const s in r.mapping)t.has(s)&&t.delete(s);return t}function lH(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function UT(n,e,t,r){n.font=`${r} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function cH(n){ut.assert(Number.isFinite(n)&&n>=yR,"Invalid cache limit"),sp=new _R(n)}class uH{constructor(){this.props={...Dl}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*BT+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=aH(this._key,this.props.characterSet),r=sp.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const s=this._generateFontAtlas(t,r);this._atlas=s,sp.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:s,fontSize:i,buffer:o,sdf:a,radius:u,cutoff:f}=this.props;let h=t&&t.data;h||(h=document.createElement("canvas"),h.width=LT);const p=h.getContext("2d",{willReadFrequently:!0});UT(p,r,i,s);const{mapping:m,canvasHeight:v,xOffset:x,yOffset:w}=eH({getFontWidth:T=>p.measureText(T).width,fontHeight:i*BT,buffer:o,characterSet:e,maxCanvasWidth:LT,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(h.height!==v){const T=p.getImageData(0,0,h.width,h.height);h.height=v,p.putImageData(T,0,0)}if(UT(p,r,i,s),a){const T=new ZW({fontSize:i,buffer:o,radius:u,cutoff:f,fontFamily:r,fontWeight:`${s}`});for(const E of e){const{data:C,width:P,height:L,glyphTop:I}=T.draw(E);m[E].width=P,m[E].layoutOffsetY=i*FT-I;const F=p.createImageData(P,L);lH(C,F),p.putImageData(F,m[E].x,m[E].y)}}else for(const T of e)p.fillText(T,m[T].x,m[T].y+o+i*FT);return{xOffset:x,yOffset:w,mapping:m,data:h,width:h.width,height:h.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:s,sdf:i,radius:o,cutoff:a}=this.props;return i?`${e} ${t} ${r} ${s} ${o} ${a}`:`${e} ${t} ${r} ${s}`}}const fH=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hH=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dH={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class m1 extends Or{getShaders(){return super.getShaders({vs:fH,fs:hH,modules:[Ao,Ro]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:s,sizeMinPixels:i,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:u}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]);const f=this.state.model;f.setUniforms(e),f.setUniforms({billboard:t,stroked:!!a,padding:u,sizeUnits:vo[s],sizeScale:r,sizeMinPixels:i,sizeMaxPixels:o}),f.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ci({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}m1.defaultProps=dH;m1.layerName="TextBackgroundLayer";const VT={start:1,middle:0,end:-1},zT={top:1,center:0,bottom:-1},lv=[0,0,0,255],pH=1,gH={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:lv},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Dl.characterSet},fontFamily:Dl.fontFamily,fontWeight:Dl.fontWeight,lineHeight:pH,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:lv},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:lv},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class lc extends Qr{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,s]}=this.transformParagraph(e,t);const{fontSize:i}=this.state.fontAtlasManager.props;r/=i,s/=i;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,u=VT[typeof o=="function"?o(e,t):o],f=zT[typeof a=="function"?a(e,t):a];return[(u-1)*r/2,(f-1)*s/2,r,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:r,getAlignmentBaseline:s}=this.props,{x:i,y:o,rowWidth:a,size:[u,f]}=this.transformParagraph(e,t),h=VT[typeof r=="function"?r(e,t):r],p=zT[typeof s=="function"?s(e,t):s],m=i.length,v=new Array(m*2);let x=0;for(let w=0;w<m;w++){const T=(1-h)*(u-a[w])/2;v[x++]=(h-1)*u/2+T+i[w],v[x++]=(p-1)*f/2+o[w]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new uH},this.props.maxWidth>0&&ut.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:s,characterSet:i}=this.state,o={...e,characterSet:i,fontFamily:t,fontWeight:r};if(!s.mapping)return s.setProps(o),!0;for(const a in o)if(o[a]!==s.props[a])return s.setProps(o),!0;return!1}_updateText(){var u;const{data:e,characterSet:t}=this.props,r=(u=e.attributes)==null?void 0:u.getText;let{getText:s}=this.props,i=e.startIndices,o;const a=t==="auto"&&new Set;if(r&&i){const{texts:f,characterCount:h}=iH({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:i,characterSet:a});o=h,s=(p,{index:m})=>f[m]}else{const{iterable:f,objectInfo:h}=_f(e);i=[0],o=0;for(const p of f){h.index++;const m=Array.from(s(p,h)||"");a&&m.forEach(a.add,a),o+=m.length,i.push(o)}}this.setState({getText:s,startIndices:i,numInstances:o,characterSet:a||t})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,s=r.mapping,i=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:u}=this.props,f=i(e,t)||"";return sH(f,a,o,u*r.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:s,atlas:i,mapping:o},styleVersion:a}=this.state,{data:u,_dataDiff:f,getPosition:h,getColor:p,getSize:m,getAngle:v,getPixelOffset:x,getBackgroundColor:w,getBorderColor:T,getBorderWidth:E,backgroundPadding:C,background:P,billboard:L,fontSettings:I,outlineWidth:F,outlineColor:j,sizeScale:q,sizeUnits:Q,sizeMinPixels:le,sizeMaxPixels:he,transitions:pe,updateTriggers:ne}=this.props,ve=this.getSubLayerClass("characters",g1),Me=this.getSubLayerClass("background",m1);return[P&&new Me({getFillColor:w,getLineColor:T,getLineWidth:E,padding:C,getPosition:h,getSize:m,getAngle:v,getPixelOffset:x,billboard:L,sizeScale:q,sizeUnits:Q,sizeMinPixels:le,sizeMaxPixels:he,transitions:pe&&{getPosition:pe.getPosition,getAngle:pe.getAngle,getSize:pe.getSize,getFillColor:pe.getBackgroundColor,getLineColor:pe.getBorderColor,getLineWidth:pe.getBorderWidth,getPixelOffset:pe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ne.getPosition,getAngle:ne.getAngle,getSize:ne.getSize,getFillColor:ne.getBackgroundColor,getLineColor:ne.getBorderColor,getLineWidth:ne.getBorderWidth,getPixelOffset:ne.getPixelOffset,getBoundingRect:{getText:ne.getText,getTextAnchor:ne.getTextAnchor,getAlignmentBaseline:ne.getAlignmentBaseline,styleVersion:a}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:f,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new ve({sdf:I.sdf,smoothing:Number.isFinite(I.smoothing)?I.smoothing:Dl.smoothing,outlineWidth:F/(I.radius||Dl.radius),outlineColor:j,iconAtlas:i,iconMapping:o,getPosition:h,getColor:p,getSize:m,getAngle:v,getPixelOffset:x,billboard:L,sizeScale:q*s,sizeUnits:Q,sizeMinPixels:le*s,sizeMaxPixels:he*s,transitions:pe&&{getPosition:pe.getPosition,getAngle:pe.getAngle,getColor:pe.getColor,getSize:pe.getSize,getPixelOffset:pe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ne.getText,getPosition:ne.getPosition,getAngle:ne.getAngle,getColor:ne.getColor,getSize:ne.getSize,getPixelOffset:ne.getPixelOffset,getIconOffsets:{getTextAnchor:ne.getTextAnchor,getAlignmentBaseline:ne.getAlignmentBaseline,styleVersion:a}}}),{data:u,_dataDiff:f,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){cH(e)}}lc.defaultProps=gH;lc.layerName="TextLayer";const _d={circle:{type:p1,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:sg,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:lc,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},yd={type:ig,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},B_={type:xf,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Jc({type:n,props:e}){const t={};for(const r in e)t[r]=n.defaultProps[e[r]];return t}function cv(n,e){const{transitions:t,updateTriggers:r}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const i in e){const o=e[i];let a=n.props[i];i.startsWith("get")&&(a=n.getSubLayerAccessor(a),s.updateTriggers[o]=r[i],t&&(s.transitions[o]=t[i])),s[o]=a}return s}function mH(n){if(Array.isArray(n))return n;switch(ut.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return ut.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function $T(n,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:i=n.length}=t;for(let o=s;o<i;o++){const a=n[o],{geometry:u}=a;if(u)if(u.type==="GeometryCollection"){ut.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:f}=u;for(let h=0;h<f.length;h++){const p=f[h];jT(p,r,e,a,o)}}else jT(u,r,e,a,o)}return r}function jT(n,e,t,r,s){const{type:i,coordinates:o}=n,{pointFeatures:a,lineFeatures:u,polygonFeatures:f,polygonOutlineFeatures:h}=e;if(!_H(i,o)){ut.warn(`${i} coordinates are malformed`)();return}switch(i){case"Point":a.push(t({geometry:n},r,s));break;case"MultiPoint":o.forEach(p=>{a.push(t({geometry:{type:"Point",coordinates:p}},r,s))});break;case"LineString":u.push(t({geometry:n},r,s));break;case"MultiLineString":o.forEach(p=>{u.push(t({geometry:{type:"LineString",coordinates:p}},r,s))});break;case"Polygon":f.push(t({geometry:n},r,s)),o.forEach(p=>{h.push(t({geometry:{type:"LineString",coordinates:p}},r,s))});break;case"MultiPolygon":o.forEach(p=>{f.push(t({geometry:{type:"Polygon",coordinates:p}},r,s)),p.forEach(m=>{h.push(t({geometry:{type:"LineString",coordinates:m}},r,s))})});break}}const vH={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _H(n,e){let t=vH[n];for(ut.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function xR(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function nd(n){return n.geometry.coordinates}function yH(n,e){const t=xR(),{pointFeatures:r,lineFeatures:s,polygonFeatures:i,polygonOutlineFeatures:o}=n;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=nd,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=nd,t.polygons.data=i,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=nd,t.polygonsOutline.data=o,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=nd,t}function xH(n,e){const t=xR(),{points:r,lines:s,polygons:i}=n,o=YW(n,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:i.polygonIndices.value.length-1,startIndices:i.polygonIndices.value,attributes:{...i.attributes,getPolygon:i.positions,pickingColors:{size:4,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.polygons._normalize=!1,i.triangles&&(t.polygons.data.attributes.indices=i.triangles.value),t.polygonsOutline.data={length:i.primitivePolygonIndices.value.length-1,startIndices:i.primitivePolygonIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.polygonsOutline._pathType="open",t}const wH=["points","linestrings","polygons"],bH={...Jc(_d.circle),...Jc(_d.icon),...Jc(_d.text),...Jc(yd),...Jc(B_),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class v1 extends Qr{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,s=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=xH(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=mH(e.data),s=this.getSubLayerRow.bind(this);let i={};const o={};if(Array.isArray(t.dataChanged)){const u=this.state.features;for(const f in u)i[f]=u[f].slice(),o[f]=[];for(const f of t.dataChanged){const h=$T(r,s,f);for(const p in u)o[p].push(pR({data:i[p],getIndex:m=>m.__source.index,dataRange:f,replace:h[p]}))}}else i=$T(r,s);const a=yH(i,o);this.setState({features:i,featuresDiff:o,layerProps:a})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:s}=t;return t.featureType=wH.find(i=>s.id.startsWith(`${this.id}-${i}-`)),r>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,r=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===r&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,s="polygons-fill",i=this.shouldRenderSubLayer(s,(o=r.polygons)==null?void 0:o.data)&&this.getSubLayerClass(s,B_.type);if(i){const a=cv(this,B_.props),u=e&&t;return u||delete a.getLineColor,a.updateTriggers.lineColors=u,new i(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var u,f;const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,s="polygons-stroke",i="linestrings",o=!e&&t&&this.shouldRenderSubLayer(s,(u=r.polygonsOutline)==null?void 0:u.data)&&this.getSubLayerClass(s,yd.type),a=this.shouldRenderSubLayer(i,(f=r.lines)==null?void 0:f.data)&&this.getSubLayerClass(i,yd.type);if(o||a){const h=cv(this,yd.props);return[o&&new o(h,this.getSubLayerProps({id:s,updateTriggers:h.updateTriggers}),r.polygonsOutline),a&&new a(h,this.getSubLayerProps({id:i,updateTriggers:h.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:s}=this.props;!r&&Number.isFinite(s)&&(s=t.points.data.findIndex(u=>u.__source.index===s));const i=new Set(e.split("+")),o=[];for(const u of i){const f=`points-${u}`,h=_d[u],p=h&&this.shouldRenderSubLayer(f,(a=t.points)==null?void 0:a.data)&&this.getSubLayerClass(f,h.type);if(p){const m=cv(this,h.props);let v=t.points;if(u==="text"&&r){const{instancePickingColors:x,...w}=v.data.attributes;v={...v,data:{...v.data,attributes:w}}}o.push(new p(m,this.getSubLayerProps({id:f,updateTriggers:m.updateTriggers,highlightedObjectIndex:s}),v))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,r,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,s)=>{const{data:i,index:o}=s,a=HW(i,o);return e(a,s)}}}v1.layerName="GeoJsonLayer";v1.defaultProps=bH;class TH{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:s}){const{index:i,id:o,bbox:a,userData:u,zoom:f}=this,h=this._loaderId;this._abortController=new AbortController;const{signal:p}=this._abortController,m=await t.scheduleRequest(this,w=>w.isSelected?1:-1);if(!m){this._isCancelled=!0;return}if(this._isCancelled){m.done();return}let v=null,x;try{v=await e({index:i,id:o,bbox:a,userData:u,zoom:f,signal:p})}catch(w){x=w||!0}finally{m.done()}if(h===this._loaderId){if(this._loader=void 0,this.content=v,this._isCancelled&&!v){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,x?s(x,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Qn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},WT=new Fe,SH=new Fe;class _1{constructor(e=[0,0,0],t=[0,0,0],r){r=r||WT.copy(e).add(t).scale(.5),this.center=new Fe(r),this.halfDiagonal=new Fe(t).subtract(this.center),this.minimum=new Fe(e),this.maximum=new Fe(t)}clone(){return new _1(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,r=SH.from(e.normal),s=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),i=this.center.dot(r)+e.distance;return i-s>0?Qn.INSIDE:i+s<0?Qn.OUTSIDE:Qn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=WT.from(e).subtract(this.center),{halfDiagonal:r}=this;let s=0,i;return i=Math.abs(t.x)-r.x,i>0&&(s+=i*i),i=Math.abs(t.y)-r.y,i>0&&(s+=i*i),i=Math.abs(t.z)-r.z,i>0&&(s+=i*i),s}}const eu=new Fe,HT=new Fe;class y1{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new Fe,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=eu.from(t),this.center=new Fe().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new y1(this.center,this.radius)}union(e){const t=this.center,r=this.radius,s=e.center,i=e.radius,o=eu.copy(s).subtract(t),a=o.magnitude();if(r>=a+i)return this.clone();if(i>=a+r)return e.clone();const u=(r+a+i)*.5;return HT.copy(o).scale((-r+u)/a).add(t),this.center.copy(HT),this.radius=u,this}expand(e){const r=eu.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=nO(eu,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=eu.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,i=e.normal.dot(t)+e.distance;return i<-r?Qn.OUTSIDE:i<r?Qn.INTERSECTING:Qn.INSIDE}}const EH=new Fe,AH=new Fe,rd=new Fe,sd=new Fe,id=new Fe,RH=new Fe,CH=new Fe,ei={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class x1{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new Fe().from(e),this.halfAxes=new Bn(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Fe(e).len(),new Fe(t).len(),new Fe(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new Fe(e).normalize(),i=new Fe(t).normalize(),o=new Fe(r).normalize();return new ow().fromMatrix3(new Bn([...s,...i,...o]))}fromCenterHalfSizeQuaternion(e,t,r){const s=new ow(r),i=new Bn().fromQuaternion(s);return i[0]=i[0]*t[0],i[1]=i[1]*t[0],i[2]=i[2]*t[0],i[3]=i[3]*t[1],i[4]=i[4]*t[1],i[5]=i[5]*t[1],i[6]=i[6]*t[2],i[7]=i[7]*t[2],i[8]=i[8]*t[2],this.center=new Fe().from(e),this.halfAxes=i,this}clone(){return new x1(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new y1){const t=this.halfAxes,r=t.getColumn(0,rd),s=t.getColumn(1,sd),i=t.getColumn(2,id),o=EH.copy(r).add(s).add(i);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,s=this.halfAxes,i=r.x,o=r.y,a=r.z,u=Math.abs(i*s[ei.COLUMN0ROW0]+o*s[ei.COLUMN0ROW1]+a*s[ei.COLUMN0ROW2])+Math.abs(i*s[ei.COLUMN1ROW0]+o*s[ei.COLUMN1ROW1]+a*s[ei.COLUMN1ROW2])+Math.abs(i*s[ei.COLUMN2ROW0]+o*s[ei.COLUMN2ROW1]+a*s[ei.COLUMN2ROW2]),f=r.dot(t)+e.distance;return f<=-u?Qn.OUTSIDE:f>=u?Qn.INSIDE:Qn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=AH.from(e).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,rd),i=r.getColumn(1,sd),o=r.getColumn(2,id),a=s.magnitude(),u=i.magnitude(),f=o.magnitude();s.normalize(),i.normalize(),o.normalize();let h=0,p;return p=Math.abs(t.dot(s))-a,p>0&&(h+=p*p),p=Math.abs(t.dot(i))-u,p>0&&(h+=p*p),p=Math.abs(t.dot(o))-f,p>0&&(h+=p*p),h}computePlaneDistances(e,t,r=[-0,-0]){let s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,u=a.getColumn(0,rd),f=a.getColumn(1,sd),h=a.getColumn(2,id),p=RH.copy(u).add(f).add(h).add(o),m=CH.copy(p).subtract(e);let v=t.dot(m);return s=Math.min(v,s),i=Math.max(v,i),p.copy(o).add(u).add(f).subtract(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),p.copy(o).add(u).subtract(f).add(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),p.copy(o).add(u).subtract(f).subtract(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),o.copy(p).subtract(u).add(f).add(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),o.copy(p).subtract(u).add(f).subtract(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),o.copy(p).subtract(u).subtract(f).add(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),o.copy(p).subtract(u).subtract(f).subtract(h),m.copy(p).subtract(e),v=t.dot(m),s=Math.min(v,s),i=Math.max(v,i),r[0]=s,r[1]=i,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,rd);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,sd);r.transformAsPoint(e);const s=this.halfAxes.getColumn(2,id);return s.transformAsPoint(e),this.halfAxes=new Bn([...t,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const XT=new Fe,YT=new Fe;class Gl{constructor(e=[0,0,1],t=0){this.normal=new Fe,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Ou(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=XT.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,s){return this.normal.set(e,t,r),Ou(ii(this.normal.len(),1)),this.distance=s,this}clone(){return new Gl(this.normal,this.distance)}equals(e){return ii(this.distance,e.distance)&&ii(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=YT.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){const r=XT.from(e),s=this.getPointDistance(r),i=YT.copy(this.normal).scale(s);return r.subtract(i).to(t)}}const qT=[new Fe([1,0,0]),new Fe([0,1,0]),new Fe([0,0,1])],KT=new Fe,PH=new Fe;class ri{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*qT.length;const t=e.center,r=e.radius;let s=0;for(const i of qT){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Gl),a||(a=this.planes[s+1]=new Gl);const u=KT.copy(i).scale(-r).add(t);o.fromPointNormal(u,i);const f=KT.copy(i).scale(r).add(t),h=PH.copy(i).negate();a.fromPointNormal(f,h),s+=2}return this}computeVisibility(e){let t=Qn.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Qn.OUTSIDE:return Qn.OUTSIDE;case Qn.INTERSECTING:t=Qn.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Ou(Number.isFinite(t),"parentPlaneMask is required."),t===ri.MASK_OUTSIDE||t===ri.MASK_INSIDE)return t;let r=ri.MASK_INSIDE;const s=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&(t&o)===0)continue;const a=s[i],u=e.intersectPlane(a);if(u===Qn.OUTSIDE)return ri.MASK_OUTSIDE;u===Qn.INTERSECTING&&(r|=o)}return r}}ri.MASK_OUTSIDE=4294967295;ri.MASK_INSIDE=0;ri.MASK_INDETERMINATE=2147483647;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;new Fe;const ks=new Bn,IH=new Bn,MH=new Bn,od=new Bn,ZT=new Bn;function kH(n,e={}){const t=VO,r=10;let s=0,i=0;const o=IH,a=MH;o.identity(),a.copy(n);const u=t*OH(a);for(;i<r&&NH(a)>u;)DH(a,od),ZT.copy(od).transpose(),a.multiplyRight(od),a.multiplyLeft(ZT),o.multiplyRight(od),++s>2&&(++i,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function OH(n){let e=0;for(let t=0;t<9;++t){const r=n[t];e+=r*r}return Math.sqrt(e)}const U_=[1,0,0],V_=[2,2,1];function NH(n){let e=0;for(let t=0;t<3;++t){const r=n[ks.getElementIndex(V_[t],U_[t])];e+=2*r*r}return Math.sqrt(e)}function DH(n,e){const t=UO;let r=0,s=1;for(let f=0;f<3;++f){const h=Math.abs(n[ks.getElementIndex(V_[f],U_[f])]);h>r&&(s=f,r=h)}const i=U_[s],o=V_[s];let a=1,u=0;if(Math.abs(n[ks.getElementIndex(o,i)])>t){const f=n[ks.getElementIndex(o,o)],h=n[ks.getElementIndex(i,i)],p=n[ks.getElementIndex(o,i)],m=(f-h)/2/p;let v;m<0?v=-1/(-m+Math.sqrt(1+m*m)):v=1/(m+Math.sqrt(1+m*m)),a=1/Math.sqrt(1+v*v),u=v*a}return Bn.IDENTITY.to(e),e[ks.getElementIndex(i,i)]=e[ks.getElementIndex(o,o)]=a,e[ks.getElementIndex(o,i)]=u,e[ks.getElementIndex(i,o)]=-u,e}const Yi=new Fe,LH=new Fe,FH=new Fe,BH=new Fe,UH=new Fe,VH=new Bn,zH={diagonal:new Bn,unitary:new Bn};function $H(n,e=new x1){if(!n||n.length===0)return e.halfAxes=new Bn([0,0,0,0,0,0,0,0,0]),e.center=new Fe,e;const t=n.length,r=new Fe(0,0,0);for(const Q of n)r.add(Q);const s=1/t;r.multiplyByScalar(s);let i=0,o=0,a=0,u=0,f=0,h=0;for(const Q of n){const le=Yi.copy(Q).subtract(r);i+=le.x*le.x,o+=le.x*le.y,a+=le.x*le.z,u+=le.y*le.y,f+=le.y*le.z,h+=le.z*le.z}i*=s,o*=s,a*=s,u*=s,f*=s,h*=s;const p=VH;p[0]=i,p[1]=o,p[2]=a,p[3]=o,p[4]=u,p[5]=f,p[6]=a,p[7]=f,p[8]=h;const{unitary:m}=kH(p,zH),v=e.halfAxes.copy(m);let x=v.getColumn(0,FH),w=v.getColumn(1,BH),T=v.getColumn(2,UH),E=-Number.MAX_VALUE,C=-Number.MAX_VALUE,P=-Number.MAX_VALUE,L=Number.MAX_VALUE,I=Number.MAX_VALUE,F=Number.MAX_VALUE;for(const Q of n)Yi.copy(Q),E=Math.max(Yi.dot(x),E),C=Math.max(Yi.dot(w),C),P=Math.max(Yi.dot(T),P),L=Math.min(Yi.dot(x),L),I=Math.min(Yi.dot(w),I),F=Math.min(Yi.dot(T),F);x=x.multiplyByScalar(.5*(L+E)),w=w.multiplyByScalar(.5*(I+C)),T=T.multiplyByScalar(.5*(F+P)),e.center.copy(x).add(w).add(T);const j=LH.set(E-L,C-I,P-F).multiplyByScalar(.5),q=new Bn([j[0],0,0,0,j[1],0,0,0,j[2]]);return e.halfAxes.multiplyRight(q),e}const Cl=512,jH=3,wR=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],bR=wR.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),WH=bR.concat([[.25,.5],[.75,.5]]);class Pl{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){const e=this.x*2,t=this.y*2,r=this.z+1;this._children=[new Pl(e,t,r),new Pl(e,t+1,r),new Pl(e+1,t,r),new Pl(e+1,t+1,r)]}return this._children}update(e){const{viewport:t,cullingVolume:r,elevationBounds:s,minZ:i,maxZ:o,bounds:a,offset:u,project:f}=e,h=this.getBoundingVolume(s,u,f);if(a&&!this.insideBounds(a)||r.computeVisibility(h)<0)return!1;if(!this.childVisible){let{z:m}=this;if(m<o&&m>=i){const v=h.distanceTo(t.cameraPosition)*t.scale/t.height;m+=Math.floor(Math.log2(v))}if(m>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const m of this.children)m.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,s]){const i=Math.pow(2,this.z),o=Cl/i;return this.x*o<r&&this.y*o<s&&(this.x+1)*o>e&&(this.y+1)*o>t}getBoundingVolume(e,t,r){if(r){const u=this.z<1?WH:this.z<2?bR:wR,f=[];for(const h of u){const p=$_(this.x+h[0],this.y+h[1],this.z);p[2]=e[0],f.push(r(p)),e[0]!==e[1]&&(p[2]=e[1],f.push(r(p)))}return $H(f)}const s=Math.pow(2,this.z),i=Cl/s,o=this.x*i+t*Cl,a=Cl-(this.y+1)*i;return new _1([o,a,e[0]],[o+i,a+i,e[1]])}}function HH(n,e,t,r){const s=n instanceof Pj&&n.resolution?n.projectPosition:null,i=Object.values(n.getFrustumPlanes()).map(({normal:v,distance:x})=>new Gl(v.clone().negate(),x)),o=new ri(i),a=n.distanceScales.unitsPerMeter[2],u=t&&t[0]*a||0,f=t&&t[1]*a||0,h=n instanceof yo&&n.pitch<=60?e:0;if(r){const[v,x,w,T]=r,E=_o([v,T]),C=_o([w,x]);r=[E[0],Cl-E[1],C[0],Cl-C[1]]}const p=new Pl(0,0,0),m={viewport:n,project:s,cullingVolume:o,elevationBounds:[u,f],minZ:h,maxZ:e,bounds:r,offset:0};if(p.update(m),n instanceof yo&&n.subViewports&&n.subViewports.length>1){for(m.offset=-1;p.update(m)&&!(--m.offset<-3););for(m.offset=1;p.update(m)&&!(++m.offset>jH););}return p.getSelected()}const ui=512,XH=[-1/0,-1/0,1/0,1/0],YH={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}};function TR(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function qH(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function KH(n,e){if(!n||!n.length)return null;const{index:t,id:r}=e;if(Array.isArray(n)){const i=qH(r)%n.length;n=n[i]}let s=n;for(const i of Object.keys(t)){const o=new RegExp(`{${i}}`,"g");s=s.replace(o,String(t[i]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function ZH(n,e,t){let r;return r=n.getBounds(),n.isGeospatial?[Math.max(r[0],t[0]),Math.max(r[1],t[1]),Math.min(r[2],t[2]),Math.min(r[3],t[3])]:[Math.max(Math.min(r[0],t[2]),t[0]),Math.max(Math.min(r[1],t[3]),t[1]),Math.min(Math.max(r[2],t[0]),t[2]),Math.min(Math.max(r[3],t[1]),t[3])]}function QH({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(s=>z_(s,e||0,t))}function z_(n,e,t){if(!Array.isArray(e)){const i=t.x-n.x,o=t.y-n.y,{width:a,height:u}=t,f={targetZ:e},h=n.unproject([i,o],f),p=n.unproject([i+a,o],f),m=n.unproject([i,o+u],f),v=n.unproject([i+a,o+u],f);return[Math.min(h[0],p[0],m[0],v[0]),Math.min(h[1],p[1],m[1],v[1]),Math.max(h[0],p[0],m[0],v[0]),Math.max(h[1],p[1],m[1],v[1])]}const r=z_(n,e[0],t),s=z_(n,e[1],t);return[Math.min(r[0],s[0]),Math.min(r[1],s[1]),Math.max(r[2],s[2]),Math.max(r[3],s[3])]}function GH(n,e,t){return t?TR(n,t).map(s=>s*e/ui):n.map(r=>r*e/ui)}function w1(n,e){return Math.pow(2,n)*ui/e}function $_(n,e,t){const r=w1(t,ui),s=n/r*360-180,i=Math.PI-2*Math.PI*e/r,o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[s,o]}function QT(n,e,t,r){const s=w1(t,r);return[n/s*ui,e/s*ui]}function JH(n,e,t,r,s=ui){if(n.isGeospatial){const[f,h]=$_(e,t,r),[p,m]=$_(e+1,t+1,r);return{west:f,north:h,east:p,south:m}}const[i,o]=QT(e,t,r,s),[a,u]=QT(e+1,t+1,r,s);return{left:i,top:o,right:a,bottom:u}}function eX(n,e,t,r,s){const i=ZH(n,null,r),o=w1(e,t),[a,u,f,h]=GH(i,o,s),p=[];for(let m=Math.floor(a);m<f;m++)for(let v=Math.floor(u);v<h;v++)p.push({x:m,y:v,z:e});return p}function tX({viewport:n,maxZoom:e,minZoom:t,zRange:r,extent:s,tileSize:i=ui,modelMatrix:o,modelMatrixInverse:a,zoomOffset:u=0}){let f=n.isGeospatial?Math.round(n.zoom+Math.log2(ui/i))+u:Math.ceil(n.zoom)+u;if(typeof t=="number"&&Number.isFinite(t)&&f<t){if(!s)return[];f=t}typeof e=="number"&&Number.isFinite(e)&&f>e&&(f=e);let h=s;return o&&a&&s&&!n.isGeospatial&&(h=TR(s,o)),n.isGeospatial?HH(n,f,r,s):eX(n,f,i,h||XH,a)}function nX(n){let e={},t;return r=>{for(const s in r)if(!rX(r[s],e[s])){t=n(r),e=r;break}return t}}function rX(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}const GT=1,og=2,sX="never",iX="no-overlap",b1="best-available",oX=5,aX={[b1]:uX,[iX]:fX,[sX]:()=>{}},lX={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class cX{constructor(e){this._getCullBounds=nX(QH),this.opts={...lX,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var r,s;(s=(r=this.opts).onTileLoad)==null||s.call(r,t),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new rD({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new St,this._modelMatrixInverse=new St}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){const s=r?new St(r):new St,i=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!ii(this._zRange,t)||i){i&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:s}=e;for(const[i,o,a,u]of r){let f;if("west"in s)f=s.west<a&&s.east>i&&s.south<u&&s.north>o;else{const h=Math.min(s.top,s.bottom),p=Math.max(s.top,s.bottom);f=s.left<a&&s.right>i&&h<u&&p>o}if(f)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:s,modelMatrix:i,modelMatrixInverse:o}){const{tileSize:a,extent:u,zoomOffset:f}=this.opts;return tX({viewport:e,maxZoom:t,minZoom:r,zRange:s,tileSize:a,extent:u,modelMatrix:i,modelMatrixInverse:o,zoomOffset:f})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:JH(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),r=Math.floor(e.y/2),s=e.z-1;return{x:t,y:r,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||b1,t=new Array(this._cache.size);let r=0;for(const s of this._cache.values())t[r++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:aX[e])(Array.from(this._cache.values())),r=0;for(const s of this._cache.values())if(t[r++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let r=0;for(const s of this._cache.values())s.isLoading&&(r++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const r=this._getNearestAncestor(t);t.parent=r,r!=null&&r.children&&r.children.push(t)}}_resizeCache(){var o,a;const{_cache:e,opts:t}=this,r=t.maxCacheSize??(t.maxCacheByteSize!=null?1/0:oX*this.selectedTiles.length),s=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>s){for(const[u,f]of e)if(!f.isVisible&&!f.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!=null?f.byteLength:0,e.delete(u),(a=(o=this.opts).onTileUnload)==null||a.call(o,f)),e.size<=r&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((u,f)=>u.zoom-f.zoom),this._dirty=!1)}_getTile(e,t){const r=this.getTileId(e);let s=this._cache.get(r),i=!1;return!s&&t?(s=new TH(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:r,zoom:this.getTileZoom(s.index)}),i=!0,this._cache.set(r,s),this._dirty=!0):s&&s.needsReload&&(i=!0),s&&i&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:t=0}=this;let r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);const s=this._getTile(r);if(s)return s}return null}}function uX(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!SR(e)&&T1(e);for(const e of n)e.isVisible=!!(e.state&og)}function fX(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&SR(t);const e=Array.from(n).sort((t,r)=>t.zoom-r.zoom);for(const t of e)if(t.isVisible=!!(t.state&og),t.children&&(t.isVisible||t.state&GT))for(const r of t.children)r.state=GT;else t.isSelected&&T1(t)}function SR(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=og,!0;e=e.parent}return!1}function T1(n){for(const e of n.children)e.isLoaded||e.content?e.state|=og:T1(e)}const hX={TilesetClass:cX,data:{type:"data",value:[]},dataComparator:YH.equal,renderSubLayers:{type:"function",value:n=>new v1(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:b1,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class ag extends Qr{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,r;return!!((r=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&r.every(s=>s.isLoaded&&s.layers&&s.layers.every(i=>i.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():t.tiles.forEach(i=>{i.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:s,extent:i,maxZoom:o,minZoom:a,maxRequests:u,debounceTime:f,zoomOffset:h}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:s,extent:i,maxRequests:u,debounceTime:f,zoomOffset:h,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:i}=e,o=this.state.isLoaded!==i,a=this.state.frameNumber!==s;i&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:s}),this.state.isLoaded=i}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:r,fetch:s}=this.props,{signal:i}=e;return e.url=typeof t=="string"||Array.isArray(t)?KH(t,e):null,r?r(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:i}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,r=t.props.tile,s=e.info;return s.picked&&(s.tile=r),s.sourceTile=r,s.sourceTileSubLayer=t,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(r=>r.clone(t)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Gp(r,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,t)}}ag.defaultProps=hX;ag.layerName="TileLayer";const dX=typeof window<"u"?B.useLayoutEffect:B.useEffect;function ip(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const pX={position:"absolute",zIndex:-1};function ER(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>ER(t,e));if(lg(n)){if(gX(n))return e.style=pX,B.cloneElement(n,e);if(mX(n))return B.cloneElement(n,e)}return n}function lg(n){return n&&typeof n=="object"&&"type"in n||!1}function gX(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function mX(n){const e=n.type;return e&&e.deckGLViewProps}function j_(n){if(typeof n=="function")return B.createElement(ya,{},n);if(Array.isArray(n))return n.map(j_);if(lg(n)){if(n.type===B.Fragment)return j_(n.props.children);if(ip(n.type,ya))return n}return n}function vX({children:n,layers:e=[],views:t=null}){const r=[],s=[],i={};return B.Children.forEach(j_(n),o=>{if(lg(o)){const a=o.type;if(ip(a,Or)){const u=_X(a,o.props);s.push(u)}else r.push(o);if(ip(a,ya)&&a!==ya&&o.props.id){const u=new a(o.props);i[u.id]=u}}else o&&r.push(o)}),Object.keys(i).length>0&&(Array.isArray(t)?t.forEach(o=>{i[o.id]=o}):t&&(i[t.id]=t),t=Object.values(i)),e=s.length>0?[...s,...e]:e,{layers:e,children:r,views:t}}function _X(n,e){const t={},r=n.defaultProps||{};for(const s in e)r[s]!==e[s]&&(t[s]=e[s]);return new n(t)}function yX({children:n,deck:e,ContextProvider:t}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const s={},i=r.views[0].id;for(const o of n){let a=i,u=o;lg(o)&&ip(o.type,ya)&&(a=o.props.id||i,u=o.props.children);const f=r.getViewport(a),h=r.getViewState(a);if(f){h.padding=f.padding;const{x:p,y:m,width:v,height:x}=f;u=ER(u,{x:p,y:m,width:v,height:x,viewport:f,viewState:h}),s[a]||(s[a]={viewport:f,children:[]}),s[a].children.push(u)}}return Object.keys(s).map(o=>{const{viewport:a,children:u}=s[o],{x:f,y:h,width:p,height:m}=a,v={position:"absolute",left:f,top:h,width:p,height:m},x=`view-${o}`,w=B.createElement("div",{key:x,id:x,style:v},...u);if(t){const T={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:E=>{E.viewId=o,e._onViewStateChange(E)}};return B.createElement(t,{key:x,value:T},w)}return w})}const xX={mixBlendMode:null};function wX({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const i in t)i in xX?s[i]=t[i]:r[i]=t[i];return{containerStyle:r,canvasStyle:s}}function bX(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function AR(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function TX(n,e,t){const r=new e({...t,_customRender:s=>{n.redrawReason=s;const i=r.getViewports();n.lastRenderedViewports!==i?n.forceUpdate():AR(n)}});return r}function SX(n,e){const[t,r]=B.useState(0),i=B.useRef({control:null,version:t,forceUpdate:()=>r(I=>I+1)}).current,o=B.useRef(null),a=B.useRef(null),u=B.useMemo(()=>vX(n),[n.layers,n.views,n.children]);let f=!0;const h=I=>{var F;return f&&n.viewState?(i.viewStateUpdateRequested=I,null):(i.viewStateUpdateRequested=null,(F=n.onViewStateChange)==null?void 0:F.call(n,I))},p=I=>{var F;f?i.interactionStateUpdateRequested=I:(i.interactionStateUpdateRequested=null,(F=n.onInteractionStateChange)==null||F.call(n,I))},m=B.useMemo(()=>{const I={...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:p};return delete I._customRender,i.deck&&i.deck.setProps(I),I},[n]);B.useEffect(()=>{const I=n.Deck||f1;return i.deck=TX(i,I,{...m,parent:o.current,canvas:a.current}),()=>{var F;return(F=i.deck)==null?void 0:F.finalize()}},[]),dX(()=>{AR(i);const{viewStateUpdateRequested:I,interactionStateUpdateRequested:F}=i;I&&h(I),F&&p(F)}),B.useImperativeHandle(e,()=>bX(i),[]);const v=i.deck&&i.deck.isInitialized?i.deck.getViewports():void 0,{ContextProvider:x,width:w="100%",height:T="100%",id:E,style:C}=n,{containerStyle:P,canvasStyle:L}=B.useMemo(()=>wX({width:w,height:T,style:C}),[w,T,C]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===v||i.version!==t){i.lastRenderedViewports=v,i.version=t;const I=yX({children:u.children,deck:i.deck,ContextProvider:x}),F=B.createElement("canvas",{key:"canvas",id:E||"deckgl-overlay",ref:a,style:L});i.control=B.createElement("div",{id:`${E||"deckgl"}-wrapper`,ref:o,style:P},[F,I])}return f=!1,i.control}const EX=B.forwardRef(SX),AX=.5;class RR extends ag{constructor(t){const r=t.loader,s={height:r[0].shape.at(-2),width:r[0].shape.at(-1)};Dt(s.width&&s.height);const i=RX(r);super({id:`labels-${t.id}`,extent:[0,0,s.width,s.height],tileSize:i,minZoom:Math.round(-(r.length-1)),opacity:t.opacity,maxZoom:0,modelMatrix:t.modelMatrix,colors:t.colors,zoomOffset:Math.round(Math.log2(t.modelMatrix?t.modelMatrix.getScale()[0]:1)),updateTriggers:{getTileData:[t.loader,t.selection]},async getTileData({index:o,signal:a}){const{x:u,y:f,z:h}=o,p=r[Math.round(-h)],m={x:u,y:f,signal:a,selection:t.selection};let{data:v,width:x,height:w}=await p.getTile(m);return Dt(!(v instanceof Float32Array)&&!(v instanceof Float64Array),`The pixels of labels MUST be integer data types, got ${JSON.stringify(p.dtype)}`),{data:v,width:x,height:w}}});S(this,"state")}renderSubLayers(t){const{tile:r,data:s,...i}=t,[[o,a],[u,f]]=r.boundingBox;Dt(i.extent,"missing extent");const[h,p,m,v]=i.extent;return new CR({id:`tile-${r.index.x}.${r.index.y}.${r.index.z}-${i.id}`,pixelData:s,opacity:i.opacity,modelMatrix:i.modelMatrix,colorTexture:this.state.colorTexture,bounds:[cn(o,0,m),cn(f,0,v),cn(u,0,m),cn(a,0,v)],image:new ImageData(s.width,s.height),pickable:!1})}updateState({props:t,oldProps:r,changeFlags:s,...i}){var o;if(super.updateState({props:t,oldProps:r,changeFlags:s,...i}),t.colors!==r.colors||!this.state.colorTexture){(o=this.state.colorTexture)==null||o.destroy();const a=CX({source:t.colors,maxTextureDimension2D:this.context.device.limits.maxTextureDimension2D});this.setState({colorTexture:this.context.device.createTexture({width:a.width,height:a.height,data:a.data,dimension:"2d",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},format:"rgba8unorm"})})}}}S(RR,"layerName","VizarrLabelLayer");class CR extends yf{constructor(){super(...arguments);S(this,"state")}getShaders(){const t={Uint8Array:"usampler2D",Uint16Array:"usampler2D",Uint32Array:"usampler2D",Int8Array:"isampler2D",Int16Array:"isampler2D",Int32Array:"isampler2D"}[tS(this.props.pixelData.data)];return{...super.getShaders(),fs:`#version 300 es
#define SHADER_NAME grayscale-bitmap-layer-fragment-shader

precision highp float;
precision highp int;
precision highp ${t};

uniform ${t} grayscaleTexture;
uniform sampler2D colorTexture;
uniform float colorTextureWidth;
uniform float colorTextureHeight;
uniform float opacity;

in vec2 vTexCoord;
out vec4 fragColor;

void main() {
  int index = int(texture(grayscaleTexture, vTexCoord).r);
  float x = (mod(float(index), colorTextureWidth) + 0.5) / colorTextureWidth;
  float y = (floor(float(index) / colorTextureWidth) + 0.5) / colorTextureHeight;
  vec2 uv = vec2(x, y);
  vec3 color = texture(colorTexture, uv).rgb;
  fragColor = vec4(color, ((index > 0) ? 1.0 : 0.0) * opacity);
}
`}}updateState({props:t,oldProps:r,changeFlags:s,...i}){var o;super.updateState({props:t,oldProps:r,changeFlags:s,...i}),t.pixelData!==r.pixelData&&((o=this.state.texture)==null||o.destroy(),this.setState({texture:this.context.device.createTexture({width:t.pixelData.width,height:t.pixelData.height,data:t.pixelData.data,dimension:"2d",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},format:{Uint8Array:"r8uint",Uint16Array:"r16uint",Uint32Array:"r32uint",Int8Array:"r8sint",Int16Array:"r16sint",Int32Array:"r32sint"}[tS(t.pixelData.data)]})}))}draw(t){const{model:r,texture:s}=this.state,{colorTexture:i}=this.props;r&&s&&i&&(r.setUniforms({colorTextureWidth:i.width,colorTextureHeight:i.height}),r.setBindings({grayscaleTexture:s,colorTexture:i})),super.draw(t)}}S(CR,"layerName","VizarrGrayscaleBitmapLayer");function RX(n){const e=n[0].tileSize;return Dt(n.every(t=>t.tileSize===e),"resolutions must all have the same tile size"),e}const JT=new WeakSet;function CX(n){const{source:e,maxTextureDimension2D:t}=n,r={data:eS,width:eS.length/4,height:1};if(!e)return r;const s=Math.max(...e.map(u=>u.labelValue))+1,i=Math.min(s,t),o=Math.ceil(s/i);if(i>t||o>t)return JT.has(e)||(console.warn("[vizarr] Skipping color palette from OME-NGFF `image-label` source: max texture dimension limit."),JT.add(e)),r;const a=new Uint8Array(i*o*4);for(const{labelValue:u,rgba:f}of e){const h=u%i,m=(Math.floor(u/i)*i+h)*4;a[m]=f[0],a[m+1]=f[1],a[m+2]=f[2],a[m+3]=f[3]}return{data:a,width:i,height:o}}const eS=Uint8Array.from([[0,73,73],[0,146,146],[255,109,182],[255,182,219],[73,0,146],[0,109,219],[182,109,255],[109,182,255],[182,219,255],[146,0,0],[146,72,0],[219,109,0],[36,255,36],[255,255,109],[255,255,255]].flatMap(n=>[...n,255]));function tS(n){return n.constructor.name}async function PX(n,e){const{color:t,contrast_limits:r,visibility:s,name:i,colormap:o="",opacity:a=1}=n,u=e[e.length-1],f=Array(e[0].shape.length).fill(0),h=r??await Ly(u,f);return{loader:e,name:i,channel_axis:null,colors:[t??Fs.white],names:["channel_0"],contrast_limits:[h],visibilities:[s??!0],model_matrix:uf(n.model_matrix),defaults:{selection:f,colormap:o,opacity:a},axis_labels:e[0].labels}}async function IX(n,e,t){const{names:r,contrast_limits:s,name:i,model_matrix:o,opacity:a=1,colormap:u=""}=n;let{visibilities:f,colors:h}=n;const p=e[0].shape[t];for(const v of[s,f,r,h])if(v){const x=Object.keys({channelProp:v})[0];Dt(v.length===p,`channel_axis is length ${p} and provided channel_axis property ${x} is different size.`)}f=f||UE(p),h=h||VE(p,f);const m=s??await $E(e[e.length-1],t,f);return{loader:e,name:i,channel_axis:t,colors:h,names:r??Du(p).map(v=>`channel_${v}`),contrast_limits:m,visibilities:f,model_matrix:uf(o),defaults:{selection:Array(e[0].shape.length).fill(0),colormap:u,opacity:a},axis_labels:e[0].labels}}async function MX(n){const e=await UN(n.source);let t,r;if(e instanceof Hp){let h=ga(e.attrs);if(ww(h))return Aw(n,e,h.plate);if(qN(h))return h8(n,e,h.well);if(WE(h))return d8(n,e,h);if(Object.keys(h).length===0&&e.path){const p=await Un(e.resolve(".."),{kind:"group"}),m=ga(p.attrs);if(ww(m))return Aw(n,p,m.plate)}if(ZN(h)){let p=`${LN}?source=${n.source}`;throw new jE("Please open in ome-ngff-validator",p)}Dt(Yp(h),"Group is missing multiscales specification."),t=await Ny(e,h.multiscales),h.multiscales[0].axes&&(r=ic(h.multiscales))}else t=[e];const{channel_axis:s,labels:i}=kX(n,r,t[0]),o=cf(t[0]),a=t.map(h=>new ff(h,{labels:i,tileSize:o})),[u]=a;if("channel_axis"in n||s>-1)return n=n,IX(n,a,Number(n.channel_axis??s));if(u.shape.length===2||!("channel_axis"in n))return PX(n,a);throw Error("Failed to load image.")}function kX(n,e,t){const r=n.axis_labels,s="channel_axis"in n?Number(n.channel_axis):void 0;if(e){const a=r??lf(e),u=s??e.findIndex(f=>f.type==="channel");return{labels:a,channel_axis:u}}const i=r??zN(t),o=s??i.indexOf("c");return{labels:i,channel_axis:o}}function PR(n){const{selection:e,opacity:t,colormap:r}=n.defaults,s=[],i=[],o=[],a=[],u=n.visibilities.flatMap((p,m)=>p?m:[]);for(const p of u.slice(0,Ml)){const m=[...e];Number.isInteger(n.channel_axis)&&(m[n.channel_axis]=p),s.push(m),i.push(Dy(n.colors[p])),o.push(n.contrast_limits[p]??[0,255]),a.push(!0)}const f={id:n.id,selections:s,colors:i,contrastLimits:o,contrastLimitsRange:[...o],channelsVisible:a,opacity:t,colormap:r,modelMatrix:n.model_matrix,onClick:n.onClick};if(n.loaders)return{kind:"grid",layerProps:{...f,loaders:n.loaders,columns:n.columns,rows:n.rows},on:!0};if(n.loader.length===1)return{kind:"image",layerProps:{...f,loader:n.loader[0]},on:!0};let h;return n.labels&&n.labels.length>0&&(h=n.labels.map((p,m)=>({on:!1,transformSourceSelection:OX(p.loader[0],n.loader[0]),layerProps:{id:`${n.id}_${m}`,loader:p.loader,modelMatrix:p.modelMatrix,opacity:AX,colors:p.colors}}))),{kind:"multiscale",layerProps:{...f,loader:n.loader},on:!0,labels:h}}function OX(n,e){Dt(e.shape.length===e.labels.length,`Image source axes and shape are not same rank. Got ${JSON.stringify(e)}`),Dt(n.shape.length===n.labels.length,`Label axes and shape are not same rank. Got ${JSON.stringify(n)}`),Dt(n.labels.every(r=>e.labels.includes(r)),`Label axes MUST be a subset of source. Source: ${JSON.stringify(e.labels)} Labels: ${JSON.stringify(n.labels)}`);const t=new Set(QN(n.labels,n.shape).filter(([r,s])=>s===1).map(([r,s])=>r));return r=>n.labels.map(s=>t.has(s)?0:r[e.labels.indexOf(s)])}const NX=Object.freeze(Object.defineProperty({__proto__:null,createSourceData:MX,initLayerStateFromSource:PR},Symbol.toStringTag,{value:"Module"})),DX=255,nS=[0,0,0],IR=6,LX="-apple-system, 'Helvetica Neue', Arial, sans-serif",rS={Uint8:{format:"r8uint",dataFormat:pt.RED_INTEGER,type:pt.UNSIGNED_BYTE,max:2**8-1,sampler:"usampler2D"},Uint16:{format:"r16uint",dataFormat:pt.RED_INTEGER,type:pt.UNSIGNED_SHORT,max:2**16-1,sampler:"usampler2D"},Uint32:{format:"r32uint",dataFormat:pt.RED_INTEGER,type:pt.UNSIGNED_INT,max:2**32-1,sampler:"usampler2D"},Float32:{format:"r32float",dataFormat:pt.RED,type:pt.FLOAT,max:3.4*10**38,sampler:"sampler2D"},Int8:{format:"r8sint",dataFormat:pt.RED_INTEGER,type:pt.BYTE,max:2**7-1,sampler:"isampler2D"},Int16:{format:"r16sint",dataFormat:pt.RED_INTEGER,type:pt.SHORT,max:2**15-1,sampler:"isampler2D"},Int32:{format:"r32sint",dataFormat:pt.RED_INTEGER,type:pt.INT,max:2**31-1,sampler:"isampler2D"},Float64:{format:"r32float",dataFormat:pt.RED,type:pt.FLOAT,max:3.4*10**38,sampler:"sampler2D",cast:n=>new Float32Array(n)}},MR=`vec4 apply_transparent_color(vec3 color, vec3 transparentColor, bool useTransparentColor, float opacity){
  return vec4(color, (color == transparentColor && useTransparentColor) ? 0. : opacity);
}
`,FX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(1,1,1,0);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,1,1,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,BX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(1,0,0,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,1,0,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,UX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9921568627450981,0.996078431372549,0.8,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,VX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.2;
  const vec4 v1 = vec4(0.9019607843137255,0,0,1);
  const float e2 = 0.4;
  const vec4 v2 = vec4(0.9019607843137255,0.8235294117647058,0,1);
  const float e3 = 0.7;
  const vec4 v3 = vec4(1,1,1,1);
  const float e4 = 1.0;
  const vec4 v4 = vec4(0.6274509803921569,0.7843137254901961,1,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),mix(v3,v4,a3)*step(e3,x)*step(x,e4)
  )));
}
`,zX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,1,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,0,0,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,$X=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.376;
  const vec4 v1 = vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);
  const float e2 = 0.753;
  const vec4 v2 = vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);
  const float e3 = 1.0;
  const vec4 v3 = vec4(1,1,1,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),mix(v2,v3,a2)*step(e2,x)*step(x,e3)
  ));
}
`,jX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,WX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,HX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.4549019607843137,0,0.8549019607843137,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0,0.8,0.7725490196078432,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0,0.9686274509803922,0.5725490196078431,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0,1,0.34509803921568627,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.1568627450980392,1,0.03137254901960784,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.5764705882352941,1,0,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,XX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.804;
  const vec4 v1 = vec4(1,0.6274509803921569,0.4,1);
  const float e2 = 1.0;
  const vec4 v2 = vec4(1,0.7803921568627451,0.4980392156862745,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),mix(v1,v2,a1)*step(e1,x)*step(x,e2)
  );
}
`,YX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.07;
  const vec4 v1 = vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);
  const float e2 = 0.13;
  const vec4 v2 = vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);
  const float e3 = 0.2;
  const vec4 v3 = vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);
  const float e4 = 0.27;
  const vec4 v4 = vec4(0.6313725490196078,0,0.5764705882352941,1);
  const float e5 = 0.33;
  const vec4 v5 = vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);
  const float e6 = 0.4;
  const vec4 v6 = vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);
  const float e7 = 0.47;
  const vec4 v7 = vec4(1,0.11372549019607843,0.3803921568627451,1);
  const float e8 = 0.53;
  const vec4 v8 = vec4(1,0.21176470588235294,0.27058823529411763,1);
  const float e9 = 0.6;
  const vec4 v9 = vec4(1,0.3333333333333333,0.1803921568627451,1);
  const float e10 = 0.67;
  const vec4 v10 = vec4(1,0.47058823529411764,0.13333333333333333,1);
  const float e11 = 0.73;
  const vec4 v11 = vec4(1,0.615686274509804,0.1450980392156863,1);
  const float e12 = 0.8;
  const vec4 v12 = vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);
  const float e13 = 0.87;
  const vec4 v13 = vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);
  const float e14 = 0.93;
  const vec4 v14 = vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);
  const float e15 = 1.0;
  const vec4 v15 = vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  float a8 = smoothstep(e8,e9,x);
  float a9 = smoothstep(e9,e10,x);
  float a10 = smoothstep(e10,e11,x);
  float a11 = smoothstep(e11,e12,x);
  float a12 = smoothstep(e12,e13,x);
  float a13 = smoothstep(e13,e14,x);
  float a14 = smoothstep(e14,e15,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),
    max(mix(v7,v8,a7)*step(e7,x)*step(x,e8),
    max(mix(v8,v9,a8)*step(e8,x)*step(x,e9),
    max(mix(v9,v10,a9)*step(e9,x)*step(x,e10),
    max(mix(v10,v11,a10)*step(e10,x)*step(x,e11),
    max(mix(v11,v12,a11)*step(e11,x)*step(x,e12),
    max(mix(v12,v13,a12)*step(e12,x)*step(x,e13),
    max(mix(v13,v14,a13)*step(e13,x)*step(x,e14),mix(v14,v15,a14)*step(e14,x)*step(x,e15)
  ))))))))))))));
}
`,qX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,KX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0.5098039215686274,1);
  const float e1 = 0.1;
  const vec4 v1 = vec4(0,0.7058823529411765,0.7058823529411765,1);
  const float e2 = 0.2;
  const vec4 v2 = vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);
  const float e3 = 0.4;
  const vec4 v3 = vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);
  const float e4 = 0.6;
  const vec4 v4 = vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);
  const float e5 = 1.0;
  const vec4 v5 = vec4(1,1,1,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),mix(v4,v5,a4)*step(e4,x)*step(x,e5)
  ))));
}
`,ZX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.15;
  const vec4 v1 = vec4(0.11764705882352941,0,0.39215686274509803,1);
  const float e2 = 0.4;
  const vec4 v2 = vec4(0.47058823529411764,0,0.39215686274509803,1);
  const float e3 = 0.6;
  const vec4 v3 = vec4(0.6274509803921569,0.35294117647058826,0,1);
  const float e4 = 0.8;
  const vec4 v4 = vec4(0.9019607843137255,0.7843137254901961,0,1);
  const float e5 = 1.0;
  const vec4 v5 = vec4(1,0.9803921568627451,0.8627450980392157,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),mix(v4,v5,a4)*step(e4,x)*step(x,e5)
  ))));
}
`,QX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,GX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,JX=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0.26666666666666666,0.10588235294117647,1);
  const float e1 = 0.125;
  const vec4 v1 = vec4(0,0.42745098039215684,0.17254901960784313,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);
  const float e3 = 0.375;
  const vec4 v3 = vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);
  const float e5 = 0.625;
  const vec4 v5 = vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);
  const float e7 = 0.875;
  const vec4 v7 = vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,eY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,1,1,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,tY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0,1);
  const float e1 = 0.3;
  const vec4 v1 = vec4(0.9019607843137255,0,0,1);
  const float e2 = 0.6;
  const vec4 v2 = vec4(1,0.8235294117647058,0,1);
  const float e3 = 1.0;
  const vec4 v3 = vec4(1,1,1,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),mix(v2,v3,a2)*step(e2,x)*step(x,e3)
  ));
}
`,nY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(1,0,0,1);
  const float e1 = 0.169;
  const vec4 v1 = vec4(0.9921568627450981,1,0.00784313725490196,1);
  const float e2 = 0.173;
  const vec4 v2 = vec4(0.9686274509803922,1,0.00784313725490196,1);
  const float e3 = 0.337;
  const vec4 v3 = vec4(0,0.9882352941176471,0.01568627450980392,1);
  const float e4 = 0.341;
  const vec4 v4 = vec4(0,0.9882352941176471,0.0392156862745098,1);
  const float e5 = 0.506;
  const vec4 v5 = vec4(0.00392156862745098,0.9764705882352941,1,1);
  const float e6 = 0.671;
  const vec4 v6 = vec4(0.00784313725490196,0,0.9921568627450981,1);
  const float e7 = 0.675;
  const vec4 v7 = vec4(0.03137254901960784,0,0.9921568627450981,1);
  const float e8 = 0.839;
  const vec4 v8 = vec4(1,0,0.984313725490196,1);
  const float e9 = 0.843;
  const vec4 v9 = vec4(1,0,0.9607843137254902,1);
  const float e10 = 1.0;
  const vec4 v10 = vec4(1,0,0.023529411764705882,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  float a8 = smoothstep(e8,e9,x);
  float a9 = smoothstep(e9,e10,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),
    max(mix(v7,v8,a7)*step(e7,x)*step(x,e8),
    max(mix(v8,v9,a8)*step(e8,x)*step(x,e9),mix(v9,v10,a9)*step(e9,x)*step(x,e10)
  )))))))));
}
`,rY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0.01568627450980392,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.8901960784313725,0.34901960784313724,0.2,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9882352941176471,1,0.6431372549019608,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,sY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0.5137254901960784,1);
  const float e1 = 0.125;
  const vec4 v1 = vec4(0,0.23529411764705882,0.6666666666666666,1);
  const float e2 = 0.375;
  const vec4 v2 = vec4(0.0196078431372549,1,1,1);
  const float e3 = 0.625;
  const vec4 v3 = vec4(1,1,0,1);
  const float e4 = 0.875;
  const vec4 v4 = vec4(0.9803921568627451,0,0,1);
  const float e5 = 1.0;
  const vec4 v5 = vec4(0.5019607843137255,0,0,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),mix(v4,v5,a4)*step(e4,x)*step(x,e5)
  ))));
}
`,iY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,0.01568627450980392,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,oY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,aY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.2,0.0784313725490196,0.09411764705882353,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,lY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,cY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,1,1);
  const float e1 = 0.1;
  const vec4 v1 = vec4(0.2,0.6,1,1);
  const float e2 = 0.2;
  const vec4 v2 = vec4(0.4,0.8,1,1);
  const float e3 = 0.3;
  const vec4 v3 = vec4(0.6,0.8,1,1);
  const float e4 = 0.4;
  const vec4 v4 = vec4(0.8,0.8,1,1);
  const float e5 = 0.5;
  const vec4 v5 = vec4(1,1,1,1);
  const float e6 = 0.6;
  const vec4 v6 = vec4(1,0.8,1,1);
  const float e7 = 0.7;
  const vec4 v7 = vec4(1,0.6,1,1);
  const float e8 = 0.8;
  const vec4 v8 = vec4(1,0.4,0.8,1);
  const float e9 = 0.9;
  const vec4 v9 = vec4(1,0.4,0.4,1);
  const float e10 = 1.0;
  const vec4 v10 = vec4(1,0,0,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  float a8 = smoothstep(e8,e9,x);
  float a9 = smoothstep(e9,e10,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),
    max(mix(v7,v8,a7)*step(e7,x)*step(x,e8),
    max(mix(v8,v9,a8)*step(e8,x)*step(x,e9),mix(v9,v10,a9)*step(e9,x)*step(x,e10)
  )))))))));
}
`,uY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,fY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.047058823529411764,0.2,0.5137254901960784,1);
  const float e1 = 0.25;
  const vec4 v1 = vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);
  const float e2 = 0.5;
  const vec4 v2 = vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);
  const float e3 = 0.75;
  const vec4 v3 = vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);
  const float e4 = 1.0;
  const vec4 v4 = vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),mix(v3,v4,a3)*step(e3,x)*step(x,e4)
  )));
}
`,hY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);
  const float e1 = 0.1;
  const vec4 v1 = vec4(0.7803921568627451,0,0.7058823529411765,1);
  const float e2 = 0.2;
  const vec4 v2 = vec4(1,0,0.4745098039215686,1);
  const float e3 = 0.3;
  const vec4 v3 = vec4(1,0.4235294117647059,0,1);
  const float e4 = 0.4;
  const vec4 v4 = vec4(0.8705882352941177,0.7607843137254902,0,1);
  const float e5 = 0.5;
  const vec4 v5 = vec4(0.5882352941176471,1,0,1);
  const float e6 = 0.6;
  const vec4 v6 = vec4(0,1,0.21568627450980393,1);
  const float e7 = 0.7;
  const vec4 v7 = vec4(0,0.9647058823529412,0.5882352941176471,1);
  const float e8 = 0.8;
  const vec4 v8 = vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);
  const float e9 = 0.9;
  const vec4 v9 = vec4(0.403921568627451,0.2,0.9215686274509803,1);
  const float e10 = 1.0;
  const vec4 v10 = vec4(0.48627450980392156,0,0.7294117647058823,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  float a8 = smoothstep(e8,e9,x);
  float a9 = smoothstep(e9,e10,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),
    max(mix(v7,v8,a7)*step(e7,x)*step(x,e8),
    max(mix(v8,v9,a8)*step(e8,x)*step(x,e9),mix(v9,v10,a9)*step(e9,x)*step(x,e10)
  )))))))));
}
`,dY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.5882352941176471,0,0.35294117647058826,1);
  const float e1 = 0.125;
  const vec4 v1 = vec4(0,0,0.7843137254901961,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0,0.09803921568627451,1,1);
  const float e3 = 0.375;
  const vec4 v3 = vec4(0,0.596078431372549,1,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.17254901960784313,1,0.5882352941176471,1);
  const float e5 = 0.625;
  const vec4 v5 = vec4(0.592156862745098,1,0,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(1,0.9176470588235294,0,1);
  const float e7 = 0.875;
  const vec4 v7 = vec4(1,0.43529411764705883,0,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(1,0,0,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,pY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);
  const float e1 = 0.35;
  const vec4 v1 = vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);
  const float e2 = 0.5;
  const vec4 v2 = vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);
  const float e3 = 0.6;
  const vec4 v3 = vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);
  const float e4 = 0.7;
  const vec4 v4 = vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);
  const float e5 = 1.0;
  const vec4 v5 = vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),mix(v4,v5,a4)*step(e4,x)*step(x,e5)
  ))));
}
`,gY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,mY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(1,0,1,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,1,0,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,vY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0.5019607843137255,0.4,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(1,1,0.4,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,_Y=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.01568627450980392,0.13725490196078433,0.2,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.09019607843137255,0.2,0.47843137254901963,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,yY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,xY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,wY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(1,0.9921568627450981,0.803921568627451,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,bY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,TY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.49019607843137253,0,0.7019607843137254,1);
  const float e1 = 0.13;
  const vec4 v1 = vec4(0.6745098039215687,0,0.7333333333333333,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.8588235294117647,0,0.6666666666666666,1);
  const float e3 = 0.38;
  const vec4 v3 = vec4(1,0,0.5098039215686274,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(1,0.24705882352941178,0.2901960784313726,1);
  const float e5 = 0.63;
  const vec4 v5 = vec4(1,0.4823529411764706,0,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.9176470588235294,0.6901960784313725,0,1);
  const float e7 = 0.88;
  const vec4 v7 = vec4(0.7450980392156863,0.8941176470588236,0,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(0.5764705882352941,1,0,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,SY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0,0,1,1);
  const float e1 = 1.0;
  const vec4 v1 = vec4(0,1,0.5019607843137255,1);
  float a0 = smoothstep(e0,e1,x);
  return mix(v0,v1,a0)*step(e0,x)*step(x,e1);
}
`,EY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);
  const float e1 = 0.125;
  const vec4 v1 = vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);
  const float e3 = 0.375;
  const vec4 v3 = vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);
  const float e5 = 0.625;
  const vec4 v5 = vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);
  const float e7 = 0.875;
  const vec4 v7 = vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(1,1,0.8509803921568627,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,AY=`vec4 apply_cmap (float x) {
  const float e0 = 0.0;
  const vec4 v0 = vec4(0.5019607843137255,0,0.14901960784313725,1);
  const float e1 = 0.125;
  const vec4 v1 = vec4(0.7411764705882353,0,0.14901960784313725,1);
  const float e2 = 0.25;
  const vec4 v2 = vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);
  const float e3 = 0.375;
  const vec4 v3 = vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);
  const float e4 = 0.5;
  const vec4 v4 = vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);
  const float e5 = 0.625;
  const vec4 v5 = vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);
  const float e6 = 0.75;
  const vec4 v6 = vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);
  const float e7 = 0.875;
  const vec4 v7 = vec4(1,0.9294117647058824,0.6274509803921569,1);
  const float e8 = 1.0;
  const vec4 v8 = vec4(1,1,0.8,1);
  float a0 = smoothstep(e0,e1,x);
  float a1 = smoothstep(e1,e2,x);
  float a2 = smoothstep(e2,e3,x);
  float a3 = smoothstep(e3,e4,x);
  float a4 = smoothstep(e4,e5,x);
  float a5 = smoothstep(e5,e6,x);
  float a6 = smoothstep(e6,e7,x);
  float a7 = smoothstep(e7,e8,x);
  return max(mix(v0,v1,a0)*step(e0,x)*step(x,e1),
    max(mix(v1,v2,a1)*step(e1,x)*step(x,e2),
    max(mix(v2,v3,a2)*step(e2,x)*step(x,e3),
    max(mix(v3,v4,a3)*step(e3,x)*step(x,e4),
    max(mix(v4,v5,a4)*step(e4,x)*step(x,e5),
    max(mix(v5,v6,a5)*step(e5,x)*step(x,e6),
    max(mix(v6,v7,a6)*step(e6,x)*step(x,e7),mix(v7,v8,a7)*step(e7,x)*step(x,e8)
  )))))));
}
`,kR={__proto__:null,alpha:FX,autumn:BX,bathymetry:UX,blackbody:VX,bluered:zX,bone:$X,cdom:jX,chlorophyll:WX,cool:HX,copper:XX,cubehelix:YX,density:qX,earth:KX,electric:ZX,freesurface_blue:QX,freesurface_red:GX,greens:JX,greys:eY,hot:tY,hsv:nY,inferno:rY,jet:sY,magma:iY,oxygen:oY,par:aY,phase:lY,picnic:cY,plasma:uY,portland:fY,rainbow:dY,rainbow_soft:hY,rdbu:pY,salinity:gY,spring:mY,summer:vY,temperature:_Y,turbidity:yY,velocity_blue:xY,velocity_green:wY,viridis:bY,warm:TY,winter:SY,yignbu:EY,yiorrd:AY};function RY(n,e){return{name:`additive-colormap-${n}`,fs:`uniform float opacity;
uniform bool useTransparentColor;

${MR}
${e}

vec4 colormap(float intensity) {
  return vec4(apply_transparent_color(apply_cmap(min(1.,intensity)).xyz, apply_cmap(0.).xyz, useTransparentColor, opacity));
}`,inject:{"fs:DECKGL_MUTATE_COLOR":`  float intensityCombo = 0.;
  intensityCombo += max(0.,intensity0);
  intensityCombo += max(0.,intensity1);
  intensityCombo += max(0.,intensity2);
  intensityCombo += max(0.,intensity3);
  intensityCombo += max(0.,intensity4);
  intensityCombo += max(0.,intensity5);
  rgba = colormap(intensityCombo);`}}}const xd={colormap:{type:"string",value:"viridis",compare:!0},opacity:{type:"number",value:1,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},OR=class extends Ma{getShaders(){var t;const n=((t=this==null?void 0:this.props)==null?void 0:t.colormap)||xd.colormap.value,e=kR[n];if(!e)throw Error(`No colormap named ${n} found in registry`);return{modules:[RY(n,e)]}}updateState({props:n,oldProps:e,changeFlags:t,...r}){if(super.updateState({props:n,oldProps:e,changeFlags:t,...r}),n.colormap!==e.colormap){const{device:s}=this.context;this.state.model&&(this.state.model.destroy(),this.setState({model:this._getModel(s)}))}}draw(){var r;const{useTransparentColor:n=xd.useTransparentColor.value,opacity:e=xd.opacity.value}=this.props,t={opacity:e,useTransparentColor:n};(r=this.state.model)==null||r.setUniforms(t)}};OR.extensionName="AdditiveColormapExtension";OR.defaultProps=xd;function CY(n,e,t){for(let r=0;r<t;r+=1)n.push(e);return n}const sS=[[0,0,255],[0,255,0],[255,0,255],[255,255,0],[255,128,0],[0,255,255],[255,255,255],[255,0,0]];function S1(n){if(n>sS.length)throw new Error("Too many colors");return sS.slice(0,n)}function E1({colors:n,channelsVisible:e}){const t=n.map((i,o)=>e[o]?i.map(a=>a/DX):nS),r=IR-t.length;return CY(t,nS,r).reduce((i,o)=>i.concat(o),[])}const PY=`uniform vec3 transparentColor;
uniform bool useTransparentColor;
uniform float opacity;

uniform vec3 colors[6];

${MR}

void mutate_color(inout vec3 rgb, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5) { 
  rgb += max(0.0, min(1.0, intensity0)) * vec3(colors[0]);
  rgb += max(0.0, min(1.0, intensity1)) * vec3(colors[1]);
  rgb += max(0.0, min(1.0, intensity2)) * vec3(colors[2]);
  rgb += max(0.0, min(1.0, intensity3)) * vec3(colors[3]);
  rgb += max(0.0, min(1.0, intensity4)) * vec3(colors[4]);
  rgb += max(0.0, min(1.0, intensity5)) * vec3(colors[5]);
}

vec4 apply_opacity(vec3 rgb) {
  return vec4(apply_transparent_color(rgb, transparentColor, useTransparentColor, opacity));
}
`,IY=`vec3 rgb = rgba.rgb;
mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5);
rgba = apply_opacity(rgb);
`,MY={name:"color-palette-module",fs:PY,inject:{"fs:DECKGL_MUTATE_COLOR":IY}},wd={colors:{type:"array",value:null,compare:!0},opacity:{type:"number",value:1,compare:!0},transparentColor:{type:"array",value:null,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},cc=class extends Ma{getShaders(){return{...super.getShaders(),modules:[MY]}}draw(){var a;const{colors:n,channelsVisible:e,opacity:t=wd.opacity.value,transparentColor:r=wd.transparentColor.value,useTransparentColor:s=wd.useTransparentColor.value}=this.props,o={colors:E1({channelsVisible:e||this.selections.map(()=>!0),colors:n||S1(this.props.selections.length)}),opacity:t,transparentColor:(r||[0,0,0]).map(u=>u/255),useTransparentColor:!!s};(a=this.state.model)==null||a.setUniforms(o)}};cc.extensionName="ColorPaletteExtension";cc.defaultProps=wd;const kY=`// lens bounds for ellipse
uniform float majorLensAxis;
uniform float minorLensAxis;
uniform vec2 lensCenter;

// lens uniforms
uniform bool lensEnabled;
uniform int lensSelection;
uniform vec3 lensBorderColor;
uniform float lensBorderRadius;

// color palette
uniform vec3 colors[6];

bool frag_in_lens_bounds(vec2 vTexCoord) {
  // Check membership in what is (not visually, but effectively) an ellipse.
  // Since the fragment space is a unit square and the real coordinates could be longer than tall,
  // to get a circle visually we have to treat the check as that of an ellipse to get the effect of a circle.

  // Check membership in ellipse.
  return pow((lensCenter.x - vTexCoord.x) / majorLensAxis, 2.) + pow((lensCenter.y - vTexCoord.y) / minorLensAxis, 2.) < (1. - lensBorderRadius);
}

bool frag_on_lens_bounds(vec2 vTexCoord) {
  // Same as the above, except this checks the boundary.

  float ellipseDistance = pow((lensCenter.x - vTexCoord.x) / majorLensAxis, 2.) + pow((lensCenter.y - vTexCoord.y) / minorLensAxis, 2.);

  // Check membership on "bourndary" of ellipse.
  return ellipseDistance <= 1. && ellipseDistance >= (1. - lensBorderRadius);
}
// Return a float for boolean arithmetic calculation.
float get_use_color_float(vec2 vTexCoord, int channelIndex) {
  bool isFragInLensBounds = frag_in_lens_bounds(vTexCoord);
  bool inLensAndUseLens = lensEnabled && isFragInLensBounds;
  return float(int((inLensAndUseLens && channelIndex == lensSelection) || (!inLensAndUseLens)));
 
}
void mutate_color(inout vec3 rgb, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5, vec2 vTexCoord){
  float useColorValue = 0.;

  useColorValue = get_use_color_float(vTexCoord, 0);
  rgb += max(0., min(1., intensity0)) * max(vec3(colors[0]), (1. - useColorValue) * vec3(1., 1., 1.));

  useColorValue = get_use_color_float(vTexCoord, 1);
  rgb += max(0., min(1., intensity1)) * max(vec3(colors[1]), (1. - useColorValue) * vec3(1., 1., 1.));

  useColorValue = get_use_color_float(vTexCoord, 2);
  rgb += max(0., min(1., intensity2)) * max(vec3(colors[2]), (1. - useColorValue) * vec3(1., 1., 1.));

  useColorValue = get_use_color_float(vTexCoord, 3);
  rgb += max(0., min(1., intensity3)) * max(vec3(colors[3]), (1. - useColorValue) * vec3(1., 1., 1.));

  useColorValue = get_use_color_float(vTexCoord, 4);
  rgb += max(0., min(1., intensity4)) * max(vec3(colors[4]), (1. - useColorValue) * vec3(1., 1., 1.));

  useColorValue = get_use_color_float(vTexCoord, 5);
  rgb += max(0., min(1., intensity5)) * max(vec3(colors[5]), (1. - useColorValue) * vec3(1., 1., 1.));
}
`,OY={name:"lens-module",fs:kY,inject:{"fs:DECKGL_MUTATE_COLOR":`
   vec3 rgb = rgba.rgb;
   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5, vTexCoord);
   rgba = vec4(rgb, 1.);
  `,"fs:#main-end":`
      bool isFragOnLensBounds = frag_on_lens_bounds(vTexCoord);
      fragColor = (lensEnabled && isFragOnLensBounds) ? vec4(lensBorderColor, 1.) : fragColor;
  `}},_l={lensEnabled:{type:"boolean",value:!1,compare:!0},lensSelection:{type:"number",value:0,compare:!0},lensRadius:{type:"number",value:100,compare:!0},lensBorderColor:{type:"array",value:[255,255,255],compare:!0},lensBorderRadius:{type:"number",value:.02,compare:!0},colors:{type:"array",value:null,compare:!0}},NR=class extends Ma{getShaders(){return{...super.getShaders(),modules:[OY]}}initializeState(){const n=this.getCurrentLayer();if(n.isComposite)return;const e=()=>{const{viewportId:t}=n.props,{lensRadius:r=_l.lensRadius.value}=this.props;if(!t){n.setState({unprojectLensBounds:[0,0,0,0]});return}const{mousePosition:s}=n.context,i=n.context.deck.viewManager.views.filter(u=>u.id===t)[0],o=n.context.deck.viewManager.viewState[t],a=i.makeViewport({...o,viewState:o});if(s&&a.containsPixel(s)){const u={x:s.x-a.x,y:s.y-a.y},h=[[u.x-r,u.y],[u.x,u.y+r],[u.x+r,u.y],[u.x,u.y-r]].map((p,m)=>a.unproject(p)[m%2]);n.setState({unprojectLensBounds:h})}else n.setState({unprojectLensBounds:[0,0,0,0]})};this.context.deck&&this.context.deck.eventManager.on({pointermove:e,pointerleave:e,wheel:e}),this.setState({onMouseMove:e,unprojectLensBounds:[0,0,0,0]})}draw(){var F;const{unprojectLensBounds:n=[0,0,0,0]}=this.state,{bounds:e,lensEnabled:t=_l.lensEnabled.value,lensSelection:r=_l.lensSelection.value,lensBorderColor:s=_l.lensBorderColor.value,lensBorderRadius:i=_l.lensBorderRadius.value,colors:o,channelsVisible:a}=this.props,[u,f,h,p]=n,[m,v,x,w]=e,T=(u-m)/(x-m),E=(f-w)/(v-w),C=(h-m)/(x-m),P=(p-w)/(v-w),L=E1({channelsVisible:a||this.selections.map(()=>!0),colors:o||S1(this.props.selections.length)}),I={majorLensAxis:(C-T)/2,minorLensAxis:(E-P)/2,lensCenter:[(C+T)/2,(E+P)/2],lensEnabled:t,lensSelection:r,lensBorderColor:s,lensBorderRadius:i,colors:L};(F=this.state.model)==null||F.setUniforms(I)}finalizeState(){var n,e,t;this.context.deck&&this.context.deck.eventManager.off({pointermove:(n=this.state)==null?void 0:n.onMouseMove,pointerleave:(e=this.state)==null?void 0:e.onMouseMove,wheel:(t=this.state)==null?void 0:t.onMouseMove})}};NR.extensionName="LensExtension";NR.defaultProps=_l;function NY(n,e){const t=`${e}

vec4 colormap(float intensity, float opacity) {
  return vec4(apply_cmap(min(1.,intensity)).xyz, opacity);
}`;return{name:`additive-colormap-3d-${n}`,fs:t}}const DR={colormap:{type:"string",value:"viridis",compare:!0}},wf=class extends Ma{constructor(...e){super(e),this.opts=this.opts||{}}getShaders(){var r;const e=((r=this==null?void 0:this.props)==null?void 0:r.colormap)||DR.colormap.value,t=kR[e];return{...super.getShaders(),modules:[NY(e,t)]}}updateState({props:e,oldProps:t,changeFlags:r,...s}){if(super.updateState({props:e,oldProps:t,changeFlags:r,...s}),e.colormap!==t.colormap){const{device:i}=this.context;this.state.model&&(this.state.model.destroy(),this.setState({model:this._getModel(i)}))}}};wf.extensionName="BaseExtension";wf.defaultProps=DR;const DY="",LY=`  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
  float total = 0.0;

  for(int i = 0; i < 6; i++) {
    total += intensityArray[i];
  }
  // Do not go past 1 in opacity/colormap value.
  total = min(total, 1.0);

  vec4 val_color = colormap(total, total);

  // Opacity correction
  val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
  color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
  color.a += (1.0 - color.a) * val_color.a;
  if (color.a >= 0.95) {
    break;
  }
  p += ray_dir * dt;
`,FY="",BY=class extends wf{constructor(e){super(e),this.rendering={_BEFORE_RENDER:DY,_RENDER:LY,_AFTER_RENDER:FY}}};BY.extensionName="AdditiveBlendExtension";const UY=`  float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
`,VY=`  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

  for(int i = 0; i < 6; i++) {
    if(intensityArray[i] > maxVals[i]) {
      maxVals[i] = intensityArray[i];
    }
  }
`,zY=`  float total = 0.0;
  for(int i = 0; i < 6; i++) {
    total += maxVals[i];
  }
  // Do not go past 1 in opacity/colormap value.
  total = min(total, 1.0);
  color = colormap(total, total);
`,$Y=class extends wf{constructor(e){super(e),this.rendering={_BEFORE_RENDER:UY,_RENDER:VY,_AFTER_RENDER:zY}}};$Y.extensionName="MaximumIntensityProjectionExtension";const jY=`  float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
`,WY=`  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

  for(int i = 0; i < 6; i++) {
    if(intensityArray[i] < minVals[i]) {
      minVals[i] = intensityArray[i];
    }
  }
`,HY=`  float total = 0.0;
  for(int i = 0; i < 6; i++) {
    total += minVals[i];
  }
  // Do not go past 1 in opacity/colormap value.
  total = min(total, 1.0);
  color = colormap(total, total);
`,XY=class extends wf{constructor(e){super(e),this.rendering={_BEFORE_RENDER:jY,_RENDER:WY,_AFTER_RENDER:HY}}};XY.extensionName="MinimumIntensityProjectionExtension";const YY={colors:{type:"array",value:null,compare:!0}},bf=class extends Ma{constructor(...n){super(n),this.opts=this.opts||{}}draw(){var s;const{colors:n,channelsVisible:e}=this.props,r={colors:E1({channelsVisible:e||this.selections.map(()=>!0),colors:n||S1(this.props.selections.length)})};(s=this.state.model)==null||s.setUniforms(r)}};bf.extensionName="BaseExtension";bf.defaultProps=YY;const qY="",KY=`  vec3 rgbCombo = vec3(0.0);
  vec3 hsvCombo = vec3(0.0);
  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
  float total = 0.0;
  for(int i = 0; i < 6; i++) {
    float intensityValue = intensityArray[i];
    rgbCombo += max(0.0, min(1.0, intensityValue)) * colors[i];
    total += intensityValue;
  }
  // Do not go past 1 in opacity.
  total = min(total, 1.0);
  vec4 val_color = vec4(rgbCombo, total);
  // Opacity correction
  val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
  color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
  color.a += (1.0 - color.a) * val_color.a;
  if (color.a >= 0.95) {
    break;
  }
`,ZY="",LR=class extends bf{constructor(n){super(n),this.rendering={_BEFORE_RENDER:qY,_RENDER:KY,_AFTER_RENDER:ZY}}};LR.extensionName="AdditiveBlendExtension";const QY=`  float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
`,GY=`  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

  for(int i = 0; i < 6; i++) {
    if(intensityArray[i] > maxVals[i]) {
      maxVals[i] = intensityArray[i];
    }
  }
`,JY=`  vec3 rgbCombo = vec3(0.0);
  for(int i = 0; i < 6; i++) {
    rgbCombo += max(0.0, min(1.0, maxVals[i])) * vec3(colors[i]);
  }
  color = vec4(rgbCombo, 1.0);
`,eq=class extends bf{constructor(n){super(n),this.rendering={_BEFORE_RENDER:QY,_RENDER:GY,_AFTER_RENDER:JY}}};eq.extensionName="MaximumIntensityProjectionExtension";const tq=`  float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
`,nq=`  float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

  for(int i = 0; i < 6; i++) {
    if(intensityArray[i] < minVals[i]) {
      minVals[i] = intensityArray[i];
    }
  }
`,rq=`  vec3 rgbCombo = vec3(0.0);
  for(int i = 0; i < 6; i++) {
    rgbCombo += max(0.0, min(1.0, minVals[i])) * vec3(colors[i]);
  }
  color = vec4(rgbCombo, 1.0);
`,sq=class extends bf{constructor(n){super(n),this.rendering={_BEFORE_RENDER:tq,_RENDER:nq,_AFTER_RENDER:rq}}};sq.extensionName="MinimumIntensityProjectionExtension";const FR={AdditiveBlendExtension:LR},gZ={AddCompression:1},mZ={None:0,Deflate:1,Zstandard:2},iq=new Map;function gi(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>iq.set(t,e))}gi([void 0,1],()=>nr(()=>import("./raw-BWdJGzpc.js"),[],import.meta.url).then(n=>n.default));gi(5,()=>nr(()=>import("./lzw-FuHLq6ak.js"),[],import.meta.url).then(n=>n.default));gi(6,()=>{throw new Error("old style JPEG compression is not supported.")});gi(7,()=>nr(()=>import("./jpeg-BzfaIrVG.js"),[],import.meta.url).then(n=>n.default));gi([8,32946],()=>nr(()=>import("./deflate-DXrZzV2C.js"),__vite__mapDeps([7,8]),import.meta.url).then(n=>n.default));gi(32773,()=>nr(()=>import("./packbits-2YyNOV-k.js"),[],import.meta.url).then(n=>n.default));gi(34887,()=>nr(()=>import("./lerc-BirfXWYY.js"),__vite__mapDeps([9,8]),import.meta.url).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));gi(50001,()=>nr(()=>import("./webimage-CMaov4QO.js"),[],import.meta.url).then(n=>n.default));function oq(n,e){let t=n.length-e,r=0;do{for(let s=e;s>0;s--)n[r+e]+=n[r],r++;t-=e}while(t>0)}function aq(n,e,t){let r=0,s=n.length;const i=s/t;for(;s>e;){for(let a=e;a>0;--a)n[r+e]+=n[r],++r;s-=e}const o=n.slice();for(let a=0;a<i;++a)for(let u=0;u<t;++u)n[t*a+u]=o[(t-u-1)*i+a]}function lq(n,e,t,r,s,i){if(e===1)return n;for(let u=0;u<s.length;++u){if(s[u]%8!==0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(s[u]!==s[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const o=s[0]/8,a=i===2?1:s.length;for(let u=0;u<r&&!(u*a*t*o>=n.byteLength);++u){let f;if(e===2){switch(s[0]){case 8:f=new Uint8Array(n,u*a*t*o,a*t*o);break;case 16:f=new Uint16Array(n,u*a*t*o,a*t*o/2);break;case 32:f=new Uint32Array(n,u*a*t*o,a*t*o/4);break;default:throw new Error(`Predictor 2 not allowed with ${s[0]} bits per sample.`)}oq(f,a)}else e===3&&(f=new Uint8Array(n,u*a*t*o,a*t*o),aq(f,a,o))}return n}class cq{async decode(e,t){const r=await this.decodeBlock(t),s=e.Predictor||1;if(s!==1){const i=!e.StripOffsets,o=i?e.TileWidth:e.ImageWidth,a=i?e.TileLength:e.RowsPerStrip||e.ImageLength;return lq(r,s,o,a,e.BitsPerSample,e.PlanarConfiguration)}return r}}var _t;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const o of s)i[o]=o;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(const a of i)o[a]=s[a];return n.objectValues(o)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},n.find=(s,i)=>{for(const o of s)if(i(o))return o},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(_t||(_t={}));var iS;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(iS||(iS={}));const Le=_t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qi=n=>{switch(typeof n){case"undefined":return Le.undefined;case"string":return Le.string;case"number":return isNaN(n)?Le.nan:Le.number;case"boolean":return Le.boolean;case"function":return Le.function;case"bigint":return Le.bigint;case"symbol":return Le.symbol;case"object":return Array.isArray(n)?Le.array:n===null?Le.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?Le.promise:typeof Map<"u"&&n instanceof Map?Le.map:typeof Set<"u"&&n instanceof Set?Le.set:typeof Date<"u"&&n instanceof Date?Le.date:Le.object;default:return Le.unknown}},Ae=_t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Kr extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,u=0;for(;u<o.path.length;){const f=o.path[u];u===o.path.length-1?(a[f]=a[f]||{_errors:[]},a[f]._errors.push(t(o))):a[f]=a[f]||{_errors:[]},a=a[f],u++}}};return s(this),r}static assert(e){if(!(e instanceof Kr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_t.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Kr.create=n=>new Kr(n);const zu=(n,e)=>{let t;switch(n.code){case Ae.invalid_type:n.received===Le.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case Ae.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,_t.jsonStringifyReplacer)}`;break;case Ae.unrecognized_keys:t=`Unrecognized key(s) in object: ${_t.joinValues(n.keys,", ")}`;break;case Ae.invalid_union:t="Invalid input";break;case Ae.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${_t.joinValues(n.options)}`;break;case Ae.invalid_enum_value:t=`Invalid enum value. Expected ${_t.joinValues(n.options)}, received '${n.received}'`;break;case Ae.invalid_arguments:t="Invalid function arguments";break;case Ae.invalid_return_type:t="Invalid function return type";break;case Ae.invalid_date:t="Invalid date";break;case Ae.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:_t.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case Ae.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case Ae.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case Ae.custom:t="Invalid input";break;case Ae.invalid_intersection_types:t="Intersection results could not be merged";break;case Ae.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case Ae.not_finite:t="Number must be finite";break;default:t=e.defaultError,_t.assertNever(n)}return{message:t}};let uq=zu;function W_(){return uq}const H_=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let a="";const u=r.filter(f=>!!f).slice().reverse();for(const f of u)a=f(o,{data:e,defaultError:a}).message;return{...s,path:i,message:a}};function Oe(n,e){const t=W_(),r=H_({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===zu?void 0:zu].filter(s=>!!s)});n.common.issues.push(r)}class sr{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return rt;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,o=await s.value;r.push({key:i,value:o})}return sr.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return rt;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(r[i.value]=o.value)}return{status:e.value,value:r}}}const rt=Object.freeze({status:"aborted"}),hu=n=>({status:"dirty",value:n}),yr=n=>({status:"valid",value:n}),oS=n=>n.status==="aborted",aS=n=>n.status==="dirty",Jl=n=>n.status==="valid",op=n=>typeof Promise<"u"&&n instanceof Promise;function ap(n,e,t,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function BR(n,e,t,r,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var We;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(We||(We={}));var du,pu;class Vs{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const lS=(n,e)=>{if(Jl(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Kr(n.common.issues);return this._error=t,this._error}}};function it(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,a)=>{var u,f;const{message:h}=n;return o.code==="invalid_enum_value"?{message:h??a.defaultError}:typeof a.data>"u"?{message:(u=h??r)!==null&&u!==void 0?u:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(f=h??t)!==null&&f!==void 0?f:a.defaultError}},description:s}}class ft{get description(){return this._def.description}_getType(e){return Qi(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Qi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new sr,ctx:{common:e.parent.common,data:e.data,parsedType:Qi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(op(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qi(e)},i=this._parseSync({data:e,path:s.path,parent:s});return lS(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qi(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return Jl(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>Jl(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qi(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(op(s)?s:Promise.resolve(s));return lS(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const o=e(s),a=()=>i.addIssue({code:Ae.custom,...r(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new hi({schema:this,typeName:Ge.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return oi.create(this,this._def)}nullable(){return Sa.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Bs.create(this)}promise(){return $u.create(this,this._def)}or(e){return fp.create([this,e],this._def)}and(e){return hp.create(this,e,this._def)}transform(e){return new hi({...it(this._def),schema:this,typeName:Ge.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new vp({...it(this._def),innerType:this,defaultValue:t,typeName:Ge.ZodDefault})}brand(){return new $R({typeName:Ge.ZodBranded,type:this,...it(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new _p({...it(this._def),innerType:this,catchValue:t,typeName:Ge.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return cg.create(this,e)}readonly(){return yp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const fq=/^c[^\s-]{8,}$/i,hq=/^[0-9a-z]+$/,dq=/^[0-9A-HJKMNP-TV-Z]{26}$/i,pq=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,gq=/^[a-z0-9_-]{21}$/i,mq=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vq=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_q=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yq="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let uv;const xq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,bq=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Tq=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Sq=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Eq=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,UR="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Aq=new RegExp(`^${UR}$`);function VR(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Rq(n){return new RegExp(`^${VR(n)}$`)}function Cq(n){let e=`${UR}T${VR(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Pq(n,e){return!!((e==="v4"||!e)&&xq.test(n)||(e==="v6"||!e)&&bq.test(n))}function Iq(n,e){if(!mq.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function Mq(n,e){return!!((e==="v4"||!e)&&wq.test(n)||(e==="v6"||!e)&&Tq.test(n))}class Ls extends ft{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Le.string){const i=this._getOrReturnCtx(e);return Oe(i,{code:Ae.invalid_type,expected:Le.string,received:i.parsedType}),rt}const r=new sr;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(s=this._getOrReturnCtx(e,s),o?Oe(s,{code:Ae.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&Oe(s,{code:Ae.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")_q.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"email",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")uv||(uv=new RegExp(yq,"u")),uv.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"emoji",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")pq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"uuid",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")gq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"nanoid",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")fq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"cuid",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")hq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"cuid2",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")dq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"ulid",code:Ae.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),Oe(s,{validation:"url",code:Ae.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"regex",code:Ae.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Cq(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?Aq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Rq(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?vq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"duration",code:Ae.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?Pq(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"ip",code:Ae.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?Iq(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"jwt",code:Ae.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?Mq(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"cidr",code:Ae.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Sq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"base64",code:Ae.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?Eq.test(e.data)||(s=this._getOrReturnCtx(e,s),Oe(s,{validation:"base64url",code:Ae.invalid_string,message:i.message}),r.dirty()):_t.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:Ae.invalid_string,...We.errToObj(r)})}_addCheck(e){return new Ls({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...We.errToObj(e)})}url(e){return this._addCheck({kind:"url",...We.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...We.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...We.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...We.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...We.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...We.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...We.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...We.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...We.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...We.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...We.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...We.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...We.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...We.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...We.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...We.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...We.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...We.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...We.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...We.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...We.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...We.errToObj(t)})}nonempty(e){return this.min(1,We.errToObj(e))}trim(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ls.create=n=>{var e;return new Ls({checks:[],typeName:Ge.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...it(n)})};function kq(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}class wa extends ft{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Le.number){const i=this._getOrReturnCtx(e);return Oe(i,{code:Ae.invalid_type,expected:Le.number,received:i.parsedType}),rt}let r;const s=new sr;for(const i of this._def.checks)i.kind==="int"?_t.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?kq(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.not_finite,message:i.message}),s.dirty()):_t.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,We.toString(t))}gt(e,t){return this.setLimit("min",e,!1,We.toString(t))}lte(e,t){return this.setLimit("max",e,!0,We.toString(t))}lt(e,t){return this.setLimit("max",e,!1,We.toString(t))}setLimit(e,t,r,s){return new wa({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:We.toString(s)}]})}_addCheck(e){return new wa({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:We.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:We.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:We.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:We.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:We.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:We.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:We.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:We.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:We.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&_t.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}wa.create=n=>new wa({checks:[],typeName:Ge.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...it(n)});class ba extends ft{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Le.bigint)return this._getInvalidInput(e);let r;const s=new sr;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Oe(r,{code:Ae.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):_t.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Oe(t,{code:Ae.invalid_type,expected:Le.bigint,received:t.parsedType}),rt}gte(e,t){return this.setLimit("min",e,!0,We.toString(t))}gt(e,t){return this.setLimit("min",e,!1,We.toString(t))}lte(e,t){return this.setLimit("max",e,!0,We.toString(t))}lt(e,t){return this.setLimit("max",e,!1,We.toString(t))}setLimit(e,t,r,s){return new ba({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:We.toString(s)}]})}_addCheck(e){return new ba({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:We.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:We.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:We.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:We.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:We.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ba.create=n=>{var e;return new ba({checks:[],typeName:Ge.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...it(n)})};class lp extends ft{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Le.boolean){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.boolean,received:r.parsedType}),rt}return yr(e.data)}}lp.create=n=>new lp({typeName:Ge.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...it(n)});class ec extends ft{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Le.date){const i=this._getOrReturnCtx(e);return Oe(i,{code:Ae.invalid_type,expected:Le.date,received:i.parsedType}),rt}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return Oe(i,{code:Ae.invalid_date}),rt}const r=new sr;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),Oe(s,{code:Ae.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):_t.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ec({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:We.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:We.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ec.create=n=>new ec({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Ge.ZodDate,...it(n)});class X_ extends ft{_parse(e){if(this._getType(e)!==Le.symbol){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.symbol,received:r.parsedType}),rt}return yr(e.data)}}X_.create=n=>new X_({typeName:Ge.ZodSymbol,...it(n)});class cp extends ft{_parse(e){if(this._getType(e)!==Le.undefined){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.undefined,received:r.parsedType}),rt}return yr(e.data)}}cp.create=n=>new cp({typeName:Ge.ZodUndefined,...it(n)});class up extends ft{_parse(e){if(this._getType(e)!==Le.null){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.null,received:r.parsedType}),rt}return yr(e.data)}}up.create=n=>new up({typeName:Ge.ZodNull,...it(n)});class Y_ extends ft{constructor(){super(...arguments),this._any=!0}_parse(e){return yr(e.data)}}Y_.create=n=>new Y_({typeName:Ge.ZodAny,...it(n)});class Ll extends ft{constructor(){super(...arguments),this._unknown=!0}_parse(e){return yr(e.data)}}Ll.create=n=>new Ll({typeName:Ge.ZodUnknown,...it(n)});class wo extends ft{_parse(e){const t=this._getOrReturnCtx(e);return Oe(t,{code:Ae.invalid_type,expected:Le.never,received:t.parsedType}),rt}}wo.create=n=>new wo({typeName:Ge.ZodNever,...it(n)});class q_ extends ft{_parse(e){if(this._getType(e)!==Le.undefined){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.void,received:r.parsedType}),rt}return yr(e.data)}}q_.create=n=>new q_({typeName:Ge.ZodVoid,...it(n)});class Bs extends ft{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==Le.array)return Oe(t,{code:Ae.invalid_type,expected:Le.array,received:t.parsedType}),rt;if(s.exactLength!==null){const o=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(o||a)&&(Oe(t,{code:o?Ae.too_big:Ae.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(Oe(t,{code:Ae.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(Oe(t,{code:Ae.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>s.type._parseAsync(new Vs(t,o,t.path,a)))).then(o=>sr.mergeArray(r,o));const i=[...t.data].map((o,a)=>s.type._parseSync(new Vs(t,o,t.path,a)));return sr.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Bs({...this._def,minLength:{value:e,message:We.toString(t)}})}max(e,t){return new Bs({...this._def,maxLength:{value:e,message:We.toString(t)}})}length(e,t){return new Bs({...this._def,exactLength:{value:e,message:We.toString(t)}})}nonempty(e){return this.min(1,e)}}Bs.create=(n,e)=>new Bs({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Ge.ZodArray,...it(e)});function yl(n){if(n instanceof ln){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=oi.create(yl(r))}return new ln({...n._def,shape:()=>e})}else return n instanceof Bs?new Bs({...n._def,type:yl(n.element)}):n instanceof oi?oi.create(yl(n.unwrap())):n instanceof Sa?Sa.create(yl(n.unwrap())):n instanceof fi?fi.create(n.items.map(e=>yl(e))):n}class ln extends ft{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=_t.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Le.object){const f=this._getOrReturnCtx(e);return Oe(f,{code:Ae.invalid_type,expected:Le.object,received:f.parsedType}),rt}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof wo&&this._def.unknownKeys==="strip"))for(const f in s.data)o.includes(f)||a.push(f);const u=[];for(const f of o){const h=i[f],p=s.data[f];u.push({key:{status:"valid",value:f},value:h._parse(new Vs(s,p,s.path,f)),alwaysSet:f in s.data})}if(this._def.catchall instanceof wo){const f=this._def.unknownKeys;if(f==="passthrough")for(const h of a)u.push({key:{status:"valid",value:h},value:{status:"valid",value:s.data[h]}});else if(f==="strict")a.length>0&&(Oe(s,{code:Ae.unrecognized_keys,keys:a}),r.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const f=this._def.catchall;for(const h of a){const p=s.data[h];u.push({key:{status:"valid",value:h},value:f._parse(new Vs(s,p,s.path,h)),alwaysSet:h in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const f=[];for(const h of u){const p=await h.key,m=await h.value;f.push({key:p,value:m,alwaysSet:h.alwaysSet})}return f}).then(f=>sr.mergeObjectSync(r,f)):sr.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return We.errToObj,new ln({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,o,a;const u=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&o!==void 0?o:r.defaultError;return t.code==="unrecognized_keys"?{message:(a=We.errToObj(e).message)!==null&&a!==void 0?a:u}:{message:u}}}:{}})}strip(){return new ln({...this._def,unknownKeys:"strip"})}passthrough(){return new ln({...this._def,unknownKeys:"passthrough"})}extend(e){return new ln({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ln({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ge.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ln({...this._def,catchall:e})}pick(e){const t={};return _t.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ln({...this._def,shape:()=>t})}omit(e){const t={};return _t.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ln({...this._def,shape:()=>t})}deepPartial(){return yl(this)}partial(e){const t={};return _t.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new ln({...this._def,shape:()=>t})}required(e){const t={};return _t.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof oi;)i=i._def.innerType;t[r]=i}}),new ln({...this._def,shape:()=>t})}keyof(){return zR(_t.objectKeys(this.shape))}}ln.create=(n,e)=>new ln({shape:()=>n,unknownKeys:"strip",catchall:wo.create(),typeName:Ge.ZodObject,...it(e)});ln.strictCreate=(n,e)=>new ln({shape:()=>n,unknownKeys:"strict",catchall:wo.create(),typeName:Ge.ZodObject,...it(e)});ln.lazycreate=(n,e)=>new ln({shape:n,unknownKeys:"strip",catchall:wo.create(),typeName:Ge.ZodObject,...it(e)});class fp extends ft{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const a of i)if(a.result.status==="valid")return a.result;for(const a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(a=>new Kr(a.ctx.common.issues));return Oe(t,{code:Ae.invalid_union,unionErrors:o}),rt}if(t.common.async)return Promise.all(r.map(async i=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i;const o=[];for(const u of r){const f={...t,common:{...t.common,issues:[]},parent:null},h=u._parseSync({data:t.data,path:t.path,parent:f});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:f}),f.common.issues.length&&o.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const a=o.map(u=>new Kr(u));return Oe(t,{code:Ae.invalid_union,unionErrors:a}),rt}}get options(){return this._def.options}}fp.create=(n,e)=>new fp({options:n,typeName:Ge.ZodUnion,...it(e)});const ti=n=>n instanceof pp?ti(n.schema):n instanceof hi?ti(n.innerType()):n instanceof gp?[n.value]:n instanceof Ta?n.options:n instanceof mp?_t.objectValues(n.enum):n instanceof vp?ti(n._def.innerType):n instanceof cp?[void 0]:n instanceof up?[null]:n instanceof oi?[void 0,...ti(n.unwrap())]:n instanceof Sa?[null,...ti(n.unwrap())]:n instanceof $R||n instanceof yp?ti(n.unwrap()):n instanceof _p?ti(n._def.innerType):[];class A1 extends ft{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Le.object)return Oe(t,{code:Ae.invalid_type,expected:Le.object,received:t.parsedType}),rt;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(Oe(t,{code:Ae.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),rt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const o=ti(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,i)}}return new A1({typeName:Ge.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...it(r)})}}function K_(n,e){const t=Qi(n),r=Qi(e);if(n===e)return{valid:!0,data:n};if(t===Le.object&&r===Le.object){const s=_t.objectKeys(e),i=_t.objectKeys(n).filter(a=>s.indexOf(a)!==-1),o={...n,...e};for(const a of i){const u=K_(n[a],e[a]);if(!u.valid)return{valid:!1};o[a]=u.data}return{valid:!0,data:o}}else if(t===Le.array&&r===Le.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const o=n[i],a=e[i],u=K_(o,a);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===Le.date&&r===Le.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class hp extends ft{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,o)=>{if(oS(i)||oS(o))return rt;const a=K_(i.value,o.value);return a.valid?((aS(i)||aS(o))&&t.dirty(),{status:t.value,value:a.data}):(Oe(r,{code:Ae.invalid_intersection_types}),rt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}hp.create=(n,e,t)=>new hp({left:n,right:e,typeName:Ge.ZodIntersection,...it(t)});class fi extends ft{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Le.array)return Oe(r,{code:Ae.invalid_type,expected:Le.array,received:r.parsedType}),rt;if(r.data.length<this._def.items.length)return Oe(r,{code:Ae.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),rt;!this._def.rest&&r.data.length>this._def.items.length&&(Oe(r,{code:Ae.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((o,a)=>{const u=this._def.items[a]||this._def.rest;return u?u._parse(new Vs(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(i).then(o=>sr.mergeArray(t,o)):sr.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new fi({...this._def,rest:e})}}fi.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new fi({items:n,typeName:Ge.ZodTuple,rest:null,...it(e)})};class dp extends ft{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Le.object)return Oe(r,{code:Ae.invalid_type,expected:Le.object,received:r.parsedType}),rt;const s=[],i=this._def.keyType,o=this._def.valueType;for(const a in r.data)s.push({key:i._parse(new Vs(r,a,r.path,a)),value:o._parse(new Vs(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?sr.mergeObjectAsync(t,s):sr.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof ft?new dp({keyType:e,valueType:t,typeName:Ge.ZodRecord,...it(r)}):new dp({keyType:Ls.create(),valueType:e,typeName:Ge.ZodRecord,...it(t)})}}class Z_ extends ft{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Le.map)return Oe(r,{code:Ae.invalid_type,expected:Le.map,received:r.parsedType}),rt;const s=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([a,u],f)=>({key:s._parse(new Vs(r,a,r.path,[f,"key"])),value:i._parse(new Vs(r,u,r.path,[f,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const u of o){const f=await u.key,h=await u.value;if(f.status==="aborted"||h.status==="aborted")return rt;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(f.value,h.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const u of o){const f=u.key,h=u.value;if(f.status==="aborted"||h.status==="aborted")return rt;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(f.value,h.value)}return{status:t.value,value:a}}}}Z_.create=(n,e,t)=>new Z_({valueType:e,keyType:n,typeName:Ge.ZodMap,...it(t)});class tc extends ft{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Le.set)return Oe(r,{code:Ae.invalid_type,expected:Le.set,received:r.parsedType}),rt;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(Oe(r,{code:Ae.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(Oe(r,{code:Ae.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function o(u){const f=new Set;for(const h of u){if(h.status==="aborted")return rt;h.status==="dirty"&&t.dirty(),f.add(h.value)}return{status:t.value,value:f}}const a=[...r.data.values()].map((u,f)=>i._parse(new Vs(r,u,r.path,f)));return r.common.async?Promise.all(a).then(u=>o(u)):o(a)}min(e,t){return new tc({...this._def,minSize:{value:e,message:We.toString(t)}})}max(e,t){return new tc({...this._def,maxSize:{value:e,message:We.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}tc.create=(n,e)=>new tc({valueType:n,minSize:null,maxSize:null,typeName:Ge.ZodSet,...it(e)});class Au extends ft{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Le.function)return Oe(t,{code:Ae.invalid_type,expected:Le.function,received:t.parsedType}),rt;function r(a,u){return H_({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,W_(),zu].filter(f=>!!f),issueData:{code:Ae.invalid_arguments,argumentsError:u}})}function s(a,u){return H_({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,W_(),zu].filter(f=>!!f),issueData:{code:Ae.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof $u){const a=this;return yr(async function(...u){const f=new Kr([]),h=await a._def.args.parseAsync(u,i).catch(v=>{throw f.addIssue(r(u,v)),f}),p=await Reflect.apply(o,this,h);return await a._def.returns._def.type.parseAsync(p,i).catch(v=>{throw f.addIssue(s(p,v)),f})})}else{const a=this;return yr(function(...u){const f=a._def.args.safeParse(u,i);if(!f.success)throw new Kr([r(u,f.error)]);const h=Reflect.apply(o,this,f.data),p=a._def.returns.safeParse(h,i);if(!p.success)throw new Kr([s(h,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Au({...this._def,args:fi.create(e).rest(Ll.create())})}returns(e){return new Au({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Au({args:e||fi.create([]).rest(Ll.create()),returns:t||Ll.create(),typeName:Ge.ZodFunction,...it(r)})}}class pp extends ft{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}pp.create=(n,e)=>new pp({getter:n,typeName:Ge.ZodLazy,...it(e)});class gp extends ft{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Oe(t,{received:t.data,code:Ae.invalid_literal,expected:this._def.value}),rt}return{status:"valid",value:e.data}}get value(){return this._def.value}}gp.create=(n,e)=>new gp({value:n,typeName:Ge.ZodLiteral,...it(e)});function zR(n,e){return new Ta({values:n,typeName:Ge.ZodEnum,...it(e)})}class Ta extends ft{constructor(){super(...arguments),du.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return Oe(t,{expected:_t.joinValues(r),received:t.parsedType,code:Ae.invalid_type}),rt}if(ap(this,du)||BR(this,du,new Set(this._def.values)),!ap(this,du).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Oe(t,{received:t.data,code:Ae.invalid_enum_value,options:r}),rt}return yr(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ta.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ta.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}du=new WeakMap;Ta.create=zR;class mp extends ft{constructor(){super(...arguments),pu.set(this,void 0)}_parse(e){const t=_t.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Le.string&&r.parsedType!==Le.number){const s=_t.objectValues(t);return Oe(r,{expected:_t.joinValues(s),received:r.parsedType,code:Ae.invalid_type}),rt}if(ap(this,pu)||BR(this,pu,new Set(_t.getValidEnumValues(this._def.values))),!ap(this,pu).has(e.data)){const s=_t.objectValues(t);return Oe(r,{received:r.data,code:Ae.invalid_enum_value,options:s}),rt}return yr(e.data)}get enum(){return this._def.values}}pu=new WeakMap;mp.create=(n,e)=>new mp({values:n,typeName:Ge.ZodNativeEnum,...it(e)});class $u extends ft{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Le.promise&&t.common.async===!1)return Oe(t,{code:Ae.invalid_type,expected:Le.promise,received:t.parsedType}),rt;const r=t.parsedType===Le.promise?t.data:Promise.resolve(t.data);return yr(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}$u.create=(n,e)=>new $u({type:n,typeName:Ge.ZodPromise,...it(e)});class hi extends ft{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ge.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{Oe(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const o=s.transform(r.data,i);if(r.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return rt;const u=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return u.status==="aborted"?rt:u.status==="dirty"||t.value==="dirty"?hu(u.value):u});{if(t.value==="aborted")return rt;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?rt:a.status==="dirty"||t.value==="dirty"?hu(a.value):a}}if(s.type==="refinement"){const o=a=>{const u=s.refinement(a,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?rt:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?rt:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Jl(o))return o;const a=s.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>Jl(o)?Promise.resolve(s.transform(o.value,i)).then(a=>({status:t.value,value:a})):o);_t.assertNever(s)}}hi.create=(n,e,t)=>new hi({schema:n,typeName:Ge.ZodEffects,effect:e,...it(t)});hi.createWithPreprocess=(n,e,t)=>new hi({schema:e,effect:{type:"preprocess",transform:n},typeName:Ge.ZodEffects,...it(t)});class oi extends ft{_parse(e){return this._getType(e)===Le.undefined?yr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oi.create=(n,e)=>new oi({innerType:n,typeName:Ge.ZodOptional,...it(e)});class Sa extends ft{_parse(e){return this._getType(e)===Le.null?yr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Sa.create=(n,e)=>new Sa({innerType:n,typeName:Ge.ZodNullable,...it(e)});class vp extends ft{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Le.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}vp.create=(n,e)=>new vp({innerType:n,typeName:Ge.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...it(e)});class _p extends ft{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return op(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Kr(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Kr(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}_p.create=(n,e)=>new _p({innerType:n,typeName:Ge.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...it(e)});class Q_ extends ft{_parse(e){if(this._getType(e)!==Le.nan){const r=this._getOrReturnCtx(e);return Oe(r,{code:Ae.invalid_type,expected:Le.nan,received:r.parsedType}),rt}return{status:"valid",value:e.data}}}Q_.create=n=>new Q_({typeName:Ge.ZodNaN,...it(n)});class $R extends ft{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class cg extends ft{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?rt:i.status==="dirty"?(t.dirty(),hu(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?rt:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new cg({in:e,out:t,typeName:Ge.ZodPipeline})}}class yp extends ft{_parse(e){const t=this._def.innerType._parse(e),r=s=>(Jl(s)&&(s.value=Object.freeze(s.value)),s);return op(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}yp.create=(n,e)=>new yp({innerType:n,typeName:Ge.ZodReadonly,...it(e)});ln.lazycreate;var Ge;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Ge||(Ge={}));const ai=Ls.create;wa.create;Q_.create;ba.create;lp.create;ec.create;X_.create;cp.create;up.create;Y_.create;const Oq=Ll.create;wo.create;q_.create;Bs.create;const gs=ln.create;ln.strictCreate;fp.create;A1.create;hp.create;fi.create;dp.create;Z_.create;tc.create;Au.create;pp.create;gp.create;const R1=Ta.create;mp.create;$u.create;hi.create;oi.create;Sa.create;const G_=hi.createWithPreprocess;cg.create;const Kn={string:n=>Ls.create({...n,coerce:!0}),number:n=>wa.create({...n,coerce:!0}),boolean:n=>lp.create({...n,coerce:!0}),bigint:n=>ba.create({...n,coerce:!0}),date:n=>ec.create({...n,coerce:!0})};var Nq=Object.defineProperty,Dq=(n,e,t)=>e in n?Nq(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Lq=(n,e,t)=>(Dq(n,e+"",t),t);class Fq extends cq{constructor(e){super(),Lq(this,"maxUncompressedSize");const t=e.TileWidth||e.ImageWidth,r=e.TileLength||e.ImageLength,s=e.BitsPerSample[0]/8;this.maxUncompressedSize=t*r*s}async decodeBlock(e){const t=new Uint8Array(e);return(await decompress(t,this.maxUncompressedSize)).buffer}}function Bq(n){if(!Number.isInteger(n))throw Error("Not an integer.");const e=new ArrayBuffer(4);new DataView(e).setInt32(0,n,!1);const r=new Uint8Array(e);return Array.from(r)}function ju(n){const e=n[n.length-1];return e===3||e===4}function ug(n){const e=ju(n.shape),[t,r]=n.shape.slice(e?-3:-2);return{height:t,width:r}}const jR="__vivSignalAborted";function Tf({attr:n,...e}){return{...n,...e}}function J_(n){return Array.isArray(n)?n:[n]}const Uq=R1(["XYZCT","XYZTC","XYCTZ","XYCZT","XYTCZ","XYTZC"]),Vq=R1(["int8","int16","int32","uint8","uint16","uint32","float","bit","double","complex","double-complex"]),fv=R1(["Ym","Zm","Em","Pm","Tm","Gm","Mm","km","hm","dam","m","dm","cm","mm","µm","nm","pm","fm","am","zm","ym","Å","thou","li","in","ft","yd","mi","ua","ly","pc","pt","pixel","reference frame"]),zq=gs({}).extend({attr:gs({ID:ai(),SamplesPerPixel:Kn.number().optional(),Name:ai().optional(),Color:Kn.number().transform(Bq).optional()})}).transform(Tf),$q=gs({}).extend({attr:gs({FileName:ai()})}).transform(Tf),jq=gs({UUID:$q.optional()}).extend({attr:gs({IFD:Kn.number().default(0),PlaneCount:Kn.number().default(1),FirstT:Kn.number().optional(),FirstC:Kn.number().optional(),FirstZ:Kn.number().optional()})}).transform(Tf),Wq=gs({Channel:G_(J_,zq.array()),TiffData:G_(J_,jq.array()).optional()}).extend({attr:gs({ID:ai(),DimensionOrder:Uq,Type:Vq,SizeT:Kn.number(),SizeC:Kn.number(),SizeZ:Kn.number(),SizeY:Kn.number(),SizeX:Kn.number(),PhysicalSizeX:Kn.number().optional(),PhysicalSizeY:Kn.number().optional(),PhysicalSizeZ:Kn.number().optional(),SignificantBits:Kn.number().optional(),PhysicalSizeXUnit:fv.optional().default("µm"),PhysicalSizeYUnit:fv.optional().default("µm"),PhysicalSizeZUnit:fv.optional().default("µm"),BigEndian:ai().transform(n=>n.toLowerCase()==="true").optional(),Interleaved:ai().transform(n=>n.toLowerCase()==="true").optional()})}).transform(Tf).transform(({Channel:n,...e})=>({Channels:n,...e})),Hq=gs({AquisitionDate:ai().optional().default(""),Description:Oq().optional().default(""),Pixels:Wq}).extend({attr:gs({ID:ai(),Name:ai().optional()})}).transform(Tf);gs({Image:G_(J_,Hq.array())});gi(5,()=>Fq);function Xq(n){return[...Array(n).keys()]}function WR(n,e,t){for(let r=0;r<t;r+=1)n.push(e);return n}function C1(n){const e=rS[n];if(!e){const t=Object.keys(rS);throw Error(`Dtype not supported, got ${n}. Must be one of ${t}.`)}return e}function HR({contrastLimits:n=[],channelsVisible:e,domain:t,dtype:r}){const s=(t==null?void 0:t[1])||C1(r).max,i=n.map((u,f)=>e[f]?u:[s,s]),o=IR-i.length;if(o<0)throw Error(`${i.lengths} channels passed in, but only 6 are allowed.`);return WR(i,[s,s],o).reduce((u,f)=>u.concat(f),[])}function Yq(n){var s;const{x:e,y:t,z:r}=((s=n==null?void 0:n.meta)==null?void 0:s.physicalSizes)??{};if(e!=null&&e.size&&(t!=null&&t.size)&&(r!=null&&r.size)){const i=Math.min(r.size,e.size,t.size),o=[e.size/i,t.size/i,r.size/i];return new St().scale(o)}return new St().identity()}function qq(n){const e=new d1().makeViewport({viewState:n,height:n.height,width:n.width});return[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])]}const xp=[1,2,3,4,5,10,20,25,50,100,200,250,500,1e3],Kq=xp[0],Zq=xp[xp.length-1],ey=[{symbol:"Y",exponent:24},{symbol:"Z",exponent:21},{symbol:"E",exponent:18},{symbol:"P",exponent:15},{symbol:"T",exponent:12},{symbol:"G",exponent:9},{symbol:"M",exponent:6},{symbol:"k",exponent:3},{symbol:"h",exponent:2},{symbol:"da",exponent:1},{symbol:"",exponent:0},{symbol:"d",exponent:-1},{symbol:"c",exponent:-2},{symbol:"m",exponent:-3},{symbol:"µ",exponent:-6},{symbol:"n",exponent:-9},{symbol:"p",exponent:-12},{symbol:"f",exponent:-15},{symbol:"a",exponent:-18},{symbol:"z",exponent:-21},{symbol:"y",exponent:-24}];function Qq(n,e){if(!e||e==="m")return n;if(e.length>1){let t=e.substring(0,e.length-1);t==="u"&&(t="µ");const r=ey.find(s=>s.symbol===t);if(r)return n*10**r.exponent}throw new Error("Received unknown unit")}function Gq(n){let e=0;(n<Kq||n>Zq)&&(e=Math.floor(Math.log10(n)));let t=ey.find(o=>o.exponent%3===0&&o.exponent<=e),r=n/10**t.exponent;r>500&&r<=1e3&&(t=ey.find(o=>o.exponent%3===0&&o.exponent<=e+3),r=n/10**t.exponent);const s=xp.find(o=>o>r);return[s*10**t.exponent,s,t.symbol]}function Jq(n){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");const e=new Uint8Array(n.length+n.length/3);for(let t=0;t<n.length/3;t+=1)e[t*4]=n[t*3],e[t*4+1]=n[t*3+1],e[t*4+2]=n[t*3+2],e[t*4+3]=255;return e}const si={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},XR={...yf.defaultProps,pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:et.CARTESIAN},eK=(n,e)=>{const t=e?"true":"false",r=`vec3(${(e||[0,0,0]).map(s=>String(s/255)).join(",")})`;switch(n){case si.RGB:return`color[3] = (${t} && (color.rgb == ${r})) ? 0.0 : color.a;`;case si.WhiteIsZero:return`          float value = 1.0 - (color.r / 256.0);
          color = vec4(value, value, value, (${t} && vec3(value, value, value) == ${r}) ? 0.0 : color.a);
        `;case si.BlackIsZero:return`          float value = (color.r / 256.0);
          color = vec4(value, value, value, (${t} && vec3(value, value, value) == ${r}) ? 0.0 : color.a);
        `;case si.YCbCr:return`          float y = color[0];
          float cb = color[1];
          float cr = color[2];
          color[0] = (y + (1.40200 * (cr - .5)));
          color[1] = (y - (0.34414 * (cb - .5)) - (0.71414 * (cr - .5)));
          color[2] = (y + (1.77200 * (cb - .5)));
          color[3] = (${t} && distance(color.rgb, ${r}) < 0.01) ? 0.0 : color.a;
        `;default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),""}},tK=n=>{switch(n){case si.RGB:return[0,0,0,0];case si.WhiteIsZero:return[255,255,255,0];case si.BlackIsZero:return[0,0,0,0];case si.YCbCr:return[16,128,128,0];default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),[0,0,0,0]}};class P1 extends yf{_getModel(e){const{photometricInterpretation:t,transparentColorInHook:r}=this.props,s=eK(t,r);return new Jn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1,inject:{"fs:DECKGL_FILTER_COLOR":s}})}}const Sf=class extends Qr{initializeState(n){const{device:e}=this.context;e.setParametersWebGL({[pt.UNPACK_ALIGNMENT]:1,[pt.PACK_ALIGNMENT]:1}),super.initializeState(n)}renderLayers(){const{photometricInterpretation:n,transparentColor:e}=this.props,t=tK(n);return this.props.image.data=Jq(this.props.image.data),new P1(this.props,{transparentColor:t,transparentColorInHook:e,id:`${this.props.id}-wrapped`})}};Sf.layerName="BitmapLayer";Sf.PHOTOMETRIC_INTERPRETATIONS=si;Sf.defaultProps={...XR,image:{type:"object",value:{},compare:!0},transparentColor:{type:"array",value:[0,0,0],compare:!0},photometricInterpretation:{type:"number",value:2,compare:!0}};P1.defaultProps=XR;P1.layerName="BitmapLayerWrapper";const nK=`float apply_contrast_limits(float intensity, vec2 contrastLimits) {
    return  max(0., (intensity - contrastLimits[0]) / max(0.0005, (contrastLimits[1] - contrastLimits[0])));
}
`,rK={name:"channel-intensity",defines:{SAMPLER_TYPE:"usampler2D",COLORMAP_FUNCTION:""},fs:nK},sK=`#version 300 es
#define SHADER_NAME xr-layer-fragment-shader

precision highp float;
precision highp int;
precision highp SAMPLER_TYPE;

// our texture
uniform SAMPLER_TYPE channel0;
uniform SAMPLER_TYPE channel1;
uniform SAMPLER_TYPE channel2;
uniform SAMPLER_TYPE channel3;
uniform SAMPLER_TYPE channel4;
uniform SAMPLER_TYPE channel5;

in vec2 vTexCoord;

// range
uniform vec2 contrastLimits[6];

out vec4 fragColor;

void main() {

  float intensity0 = float(texture(channel0, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity0, contrastLimits[0], 0);
  float intensity1 = float(texture(channel1, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity1, contrastLimits[1], 1);
  float intensity2 = float(texture(channel2, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity2, contrastLimits[2], 2);
  float intensity3 = float(texture(channel3, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity3, contrastLimits[3], 3);
  float intensity4 = float(texture(channel4, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity4, contrastLimits[4], 4);
  float intensity5 = float(texture(channel5, vTexCoord).r);
  DECKGL_PROCESS_INTENSITY(intensity5, contrastLimits[5], 5);

  DECKGL_MUTATE_COLOR(fragColor, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5, vTexCoord);


  geometry.uv = vTexCoord;
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,iK=`#version 300 es
#define SHADER_NAME xr-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;
in vec3 instancePickingColors;
out vec2 vTexCoord;

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;
  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vTexCoord = texCoords;
  vec4 color = vec4(0.);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,oK={fs:sK,vs:iK};function cS(n,e,t){const r=t==="linear",s=C1(r?"Float32":n);return{shaderModule:oK,filter:t,cast:r?i=>new Float32Array(i):i=>i,...s}}const aK={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:et.CARTESIAN,channelData:{type:"object",value:{},compare:!0},bounds:{type:"array",value:[0,0,1,1],compare:!0},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint16",compare:!0},interpolation:{type:"string",value:"nearest",compare:!0}},nc=class extends Or{getShaders(){const{dtype:n,interpolation:e}=this.props,{shaderModule:t,sampler:r}=cS(n,this.context.device,e),s=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),i={...rK,inject:{}};return s||(i.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders({...t,defines:{SAMPLER_TYPE:r},modules:[Ao,Ro,i]})}_isHookDefinedByExtensions(n){const{extensions:e}=this.props;return e==null?void 0:e.some(t=>{const r=t.getShaders(),{inject:s={},modules:i=[]}=r,o=s[n],a=i.some(u=>u==null?void 0:u.inject[n]);return o||a})}initializeState(){const{device:n}=this.context;n.setParametersWebGL({[pt.UNPACK_ALIGNMENT]:1,[pt.PACK_ALIGNMENT]:1}),this.getAttributeManager().add({positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:this.calculatePositions,noAlloc:!0}}),this.setState({numInstances:1,positions:new Float64Array(12)});const t=Hl.getDefaultShaderAssembler(),r="fs:DECKGL_MUTATE_COLOR(inout vec4 rgba, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5, vec2 vTexCoord)",s="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";t._hookFunctions.includes(r)||t.addShaderHook(r),t._hookFunctions.includes(s)||t.addShaderHook(s)}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(n=>n==null?void 0:n.delete())}updateState({props:n,oldProps:e,changeFlags:t,...r}){var i,o;if(super.updateState({props:n,oldProps:e,changeFlags:t,...r}),t.extensionsChanged||n.interpolation!==e.interpolation){const{device:a}=this.context;this.state.model&&this.state.model.destroy(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}(n.channelData!==e.channelData&&((i=n.channelData)==null?void 0:i.data)!==((o=e.channelData)==null?void 0:o.data)||n.interpolation!==e.interpolation)&&this.loadChannelTextures(n.channelData);const s=this.getAttributeManager();n.bounds!==e.bounds&&s.invalidate("positions")}_getModel(n){return n?new Jn(n,{...this.getShaders(),id:this.props.id,geometry:new ci({topology:"triangle-list",vertexCount:6,indices:new Uint16Array([0,1,3,1,2,3]),attributes:{texCoords:{value:new Float32Array([0,1,0,0,1,0,1,1]),size:2}}}),bufferLayout:this.getAttributeManager().getBufferLayouts(),isInstanced:!1}):null}calculatePositions(n){const{positions:e}=this.state,{bounds:t}=this.props;e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[0],e[4]=t[3],e[5]=0,e[6]=t[2],e[7]=t[3],e[8]=0,e[9]=t[2],e[10]=t[1],e[11]=0,n.value=e}draw(n){const{uniforms:e}=n,{textures:t,model:r}=this.state;if(t&&r){const{contrastLimits:s,domain:i,dtype:o,channelsVisible:a}=this.props,u=Object.values(t).filter(h=>h).length,f=HR({contrastLimits:s.slice(0,u),channelsVisible:a.slice(0,u),domain:i,dtype:o});r.setUniforms({...e,contrastLimits:f},{disableWarnings:!1}),r.setBindings(t),r.draw(n)}}loadChannelTextures(n){const e={channel0:null,channel1:null,channel2:null,channel3:null,channel4:null,channel5:null};if(this.state.textures&&Object.values(this.state.textures).forEach(t=>t==null?void 0:t.delete()),n&&Object.keys(n).length>0&&n.data){n.data.forEach((t,r)=>{e[`channel${r}`]=this.dataToTexture(t,n.width,n.height)},this);for(const t in e){if(!e.channel0)throw new Error("Bad texture state!");e[t]||(e[t]=e.channel0)}this.setState({textures:e})}}dataToTexture(n,e,t){var i;const{interpolation:r}=this.props,s=cS(this.props.dtype,this.context.device,r);return this.context.device.createTexture({width:e,height:t,dimension:"2d",data:((i=s.cast)==null?void 0:i.call(s,n))??n,mipmaps:!1,sampler:{minFilter:s.filter,magFilter:s.filter,addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},format:s.format})}};nc.layerName="XRLayer";nc.defaultProps=aK;const lK={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:et.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},selections:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16",shape:[]},compare:!0},onClick:{type:"function",value:null,compare:!0},onViewportLoad:{type:"function",value:null,compare:!0},interpolation:{type:"number",value:"nearest",compare:!0},extensions:{type:"array",value:[new cc],compare:!0}},Ef=class extends Qr{finalizeState(){this.state.abortController.abort()}updateState({props:e,oldProps:t}){const r=e.loader!==t.loader,s=e.selections!==t.selections;if(r||s){const{loader:i,selections:o=[],onViewportLoad:a}=this.props,u=new AbortController;this.setState({abortController:u});const{signal:f}=u,h=m=>i.getRaster({selection:m,signal:f}),p=o.map(h);Promise.all(p).then(m=>{var x,w;const v={data:m.map(T=>T.data),width:(x=m[0])==null?void 0:x.width,height:(w=m[0])==null?void 0:w.height};ju(i.shape)&&(v.data=v.data[0],v.data.length===v.width*v.height*3&&(v.format="rgba8unorm")),a&&a(v),this.setState({...v})}).catch(m=>{if(m!==jR)throw m})}}getPickingInfo({info:e,sourceLayer:t}){return e.sourceLayer=t,e.tile=t.props.tile,e}renderLayers(){const{loader:e,id:t}=this.props,{dtype:r}=e,{width:s,height:i,data:o}=this.state;if(!(s&&i))return null;const a=[0,i,s,0];if(ju(e.shape)){const{photometricInterpretation:u=2}=e.meta;return new Sf(this.props,{image:this.state,photometricInterpretation:u,bounds:a,id:`image-sub-layer-${a}-${t}`,extensions:[]})}return new nc(this.props,{channelData:{data:o,height:i,width:s},bounds:a,id:`image-sub-layer-${a}-${t}`,dtype:r})}};Ef.layerName="ImageLayer";Ef.defaultProps=lK;function cK(n){const{bbox:{left:e,top:t,right:r,bottom:s},index:{x:i,y:o,z:a}}=n.tile,{data:u,id:f,loader:h,maxZoom:p}=n;if([e,s,r,t].some(T=>T<0)||!u)return null;const m=h[0],{height:v,width:x}=ug(m),w=[e,u.height<m.tileSize?v:s,u.width<m.tileSize?x:r,t];if(ju(m.shape)){const{photometricInterpretation:T=2}=m.meta;return new Sf(n,{image:u,photometricInterpretation:T,bounds:w,id:`tile-sub-layer-${w}-${f}`,tileId:{x:i,y:o,z:a},extensions:[]})}return new nc(n,{channelData:u,bounds:w,id:`tile-sub-layer-${w}-${f}`,tileId:{x:i,y:o,z:a},interpolation:a===p?"nearest":"linear"})}const uK={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:et.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},renderSubLayers:{type:"function",value:cK,compare:!1},dtype:{type:"string",value:"Uint16",compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},interpolation:{type:"number",value:null,compare:!0}};class I1 extends ag{_updateTileset(){this.props.viewportId||super._updateTileset(),(this.props.viewportId&&this.context.viewport.id===this.props.viewportId||!this.state.tileset._viewport)&&super._updateTileset()}}I1.layerName="MultiscaleImageLayerBase";I1.defaultProps=uK;const fK={pickable:{type:"boolean",value:!0,compare:!0},onHover:{type:"function",value:null,compare:!1},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},maxRequests:{type:"number",value:10,compare:!0},onClick:{type:"function",value:null,compare:!0},refinementStrategy:{type:"string",value:null,compare:!0},excludeBackground:{type:"boolean",value:!1,compare:!0},extensions:{type:"array",value:[new cc],compare:!0}},M1=class extends Qr{renderLayers(){const{loader:e,selections:t,opacity:r,viewportId:s,onTileError:i,onHover:o,id:a,onClick:u,modelMatrix:f,excludeBackground:h,refinementStrategy:p}=this.props,{tileSize:m,dtype:v}=e[0],x=async({index:{x:j,y:q,z:Q},signal:le})=>{if(!t||t.length===0)return null;const he=Math.round(-Q),pe=ne=>{const ve={x:j,y:q,selection:ne,signal:le};return e[he].getTile(ve)};try{const ne=await Promise.all(t.map(pe)),ve={data:ne.map(Me=>Me.data),width:ne[0].width,height:ne[0].height};return ju(e[he].shape)&&(ve.data=ve.data[0],ve.data.length===ve.width*ve.height*3&&(ve.format="rgba8unorm")),ve}catch(ne){if(ne===jR)return null;throw ne}},{height:w,width:T}=ug(e[0]),E=new I1(this.props,{id:`Tiled-Image-${a}`,getTileData:x,dtype:v,tileSize:m,zoomOffset:Math.round(Math.log2(f?f.getScale()[0]:1)),extent:[0,0,T,w],minZoom:Math.round(-(e.length-1)),maxZoom:0,refinementStrategy:p||(r===1?"best-available":"no-overlap"),updateTriggers:{getTileData:[e,t]},onTileError:i||e[0].onTileError}),C=e[e.length-1],P=typeof C.getRaster=="function",L=f?f.clone():new St;return[P&&!h&&new Ef(this.props,{id:`Background-Image-${a}`,loader:C,modelMatrix:L.scale(2**(e.length-1)),visible:!s||this.context.viewport.id===s,onHover:o,onClick:u,interpolation:"linear",onViewportLoad:null}),E]}};M1.layerName="MultiscaleImageLayer";M1.defaultProps=fK;const hK={pickable:{type:"boolean",value:!0,compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),getRasterSize:()=>({height:0,width:0}),dtype:"<u2"},compare:!0},id:{type:"string",value:"",compare:!0},boundingBox:{type:"array",value:[[0,0],[0,1],[1,1],[1,0]],compare:!0},boundingBoxColor:{type:"array",value:[255,0,0],compare:!0},boundingBoxOutlineWidth:{type:"number",value:1,compare:!0},viewportOutlineColor:{type:"array",value:[255,190,0],compare:!0},viewportOutlineWidth:{type:"number",value:2,compare:!0},overviewScale:{type:"number",value:1,compare:!0},zoom:{type:"number",value:1,compare:!0},extensions:{type:"array",value:[new cc],compare:!0}},YR=class extends Qr{renderLayers(){const{loader:n,id:e,zoom:t,boundingBox:r,boundingBoxColor:s,boundingBoxOutlineWidth:i,viewportOutlineColor:o,viewportOutlineWidth:a,overviewScale:u}=this.props,{width:f,height:h}=ug(n[0]),p=n.length-1,m=n[p],v=new Ef(this.props,{id:`viewport-${e}`,modelMatrix:new St().scale(2**p*u),loader:m}),x=new np({id:`bounding-box-overview-${e}`,coordinateSystem:et.CARTESIAN,data:[r],getPolygon:E=>E,filled:!1,stroked:!0,getLineColor:s,getLineWidth:i*2**t}),w=new np({id:`viewport-outline-${e}`,coordinateSystem:et.CARTESIAN,data:[[[0,0],[f*u,0],[f*u,h*u],[0,h*u]]],getPolygon:E=>E,filled:!1,stroked:!0,getLineColor:o,getLineWidth:a*2**t});return[v,x,w]}};YR.layerName="OverviewLayer";YR.defaultProps=hK;function dK(n,e,t){const r=n[2][0]-n[0][0],s=n[2][1]-n[0][1];switch(e){case"bottom-right":{const i=n[2][1]-s*t,o=n[2][0]-r*t;return[i,o]}case"top-right":{const i=n[0][1]+s*t,o=n[2][0]-r*t;return[i,o]}case"top-left":{const i=n[0][1]+s*t,o=n[0][0]+r*t;return[i,o]}case"bottom-left":{const i=n[2][1]-s*t,o=n[0][0]+r*t;return[i,o]}default:throw new Error(`Position ${e} not found`)}}const pK={pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0],width:1,height:1},compare:!0},unit:{type:"string",value:"",compare:!0},size:{type:"number",value:1,compare:!0},position:{type:"string",value:"bottom-right",compare:!0},length:{type:"number",value:.085,compare:!0},snap:{type:"boolean",value:!1,compare:!0}},qR=class extends Qr{renderLayers(){const{id:n,unit:e,size:t,position:r,viewState:s,length:i,snap:o}=this.props,a=qq(s),{zoom:u}=s,h=(a[2][0]-a[0][0])*.05,p=Math.max(2**(-u+1.5),(a[2][1]-a[0][1])*.007);let m=h,v=(h*t).toPrecision(5),x=e;if(o){const j=Qq(t,e),q=h*j,[Q,le,he]=Gq(q);m=Q/j,v=le,x=`${he}m`}const[w,T]=dK(a,r,i),E=T+h,C=r.endsWith("-left"),P=new Eu({id:`scale-bar-length-${n}`,coordinateSystem:et.CARTESIAN,data:[[[C?T:E-m,w],[C?T+m:E,w]]],getSourcePosition:j=>j[0],getTargetPosition:j=>j[1],getWidth:2,getColor:[220,220,220]}),L=new Eu({id:`scale-bar-height-left-${n}`,coordinateSystem:et.CARTESIAN,data:[[[C?T:E-m,w-p],[C?T:E-m,w+p]]],getSourcePosition:j=>j[0],getTargetPosition:j=>j[1],getWidth:2,getColor:[220,220,220]}),I=new Eu({id:`scale-bar-height-right-${n}`,coordinateSystem:et.CARTESIAN,data:[[[C?T+m:E,w-p],[C?T+m:E,w+p]]],getSourcePosition:j=>j[0],getTargetPosition:j=>j[1],getWidth:2,getColor:[220,220,220]}),F=new lc({id:`units-label-layer-${n}`,coordinateSystem:et.CARTESIAN,data:[{text:`${v}${x}`,position:[C?T+h*.5:E-h*.5,w+p*4]}],getColor:[220,220,220,255],getSize:12,fontFamily:LX,sizeUnits:"meters",sizeScale:2**-u,characterSet:[...x.split(""),...Xq(10).map(j=>String(j)),".","e","+"]});return[P,L,I,F]}};qR.layerName="ScaleBarLayer";qR.defaultProps=pK;const gK=`#version 300 es
precision highp int;
precision highp float;
precision highp SAMPLER_TYPE;

uniform highp SAMPLER_TYPE volume0;
uniform highp SAMPLER_TYPE volume1;
uniform highp SAMPLER_TYPE volume2;
uniform highp SAMPLER_TYPE volume3;
uniform highp SAMPLER_TYPE volume4;
uniform highp SAMPLER_TYPE volume5;

uniform vec3 scaledDimensions;

uniform mat4 scale;

uniform vec3 normals[NUM_PLANES];
uniform float distances[NUM_PLANES];

// color
uniform vec3 colors[6];

// slices
uniform vec2 xSlice;
uniform vec2 ySlice;
uniform vec2 zSlice;

// range
uniform vec2 contrastLimits[6];

in vec3 vray_dir;
flat in vec3 transformed_eye;
out vec4 color;

vec2 intersect_box(vec3 orig, vec3 dir) {
	vec3 box_min = vec3(xSlice[0], ySlice[0], zSlice[0]);
	vec3 box_max = vec3(xSlice[1], ySlice[1], zSlice[1]);
	vec3 inv_dir = 1. / dir;
	vec3 tmin_tmp = (box_min - orig) * inv_dir;
	vec3 tmax_tmp = (box_max - orig) * inv_dir;
	vec3 tmin = min(tmin_tmp, tmax_tmp);
	vec3 tmax = max(tmin_tmp, tmax_tmp);
	float t0 = max(tmin.x, max(tmin.y, tmin.z));
  float t1 = min(tmax.x, min(tmax.y, tmax.z));
  vec2 val = vec2(t0, t1);
	return val;
}

float linear_to_srgb(float x) {
	if (x <= 0.0031308f) {
		return 12.92f * x;
	}
	return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;
}

// Pseudo-random number gen from
// http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/
// with some tweaks for the range of values
float wang_hash(int seed) {
	seed = (seed ^ 61) ^ (seed >> 16);
	seed *= 9;
	seed = seed ^ (seed >> 4);
	seed *= 0x27d4eb2d;
	seed = seed ^ (seed >> 15);
	return float(seed % 2147483647) / float(2147483647);
}


void main(void) {
	// Step 1: Normalize the view ray
	vec3 ray_dir = normalize(vray_dir);

	// Step 2: Intersect the ray with the volume bounds to find the interval
	// along the ray overlapped by the volume.
	vec2 t_hit = intersect_box(transformed_eye, ray_dir);
	if (t_hit.x > t_hit.y) {
		discard;
	}
	// We don't want to sample voxels behind the eye if it's
	// inside the volume, so keep the starting point at or in front
	// of the eye
	t_hit.x = max(t_hit.x, 0.);

	// Step 3: Compute the step size to march through the volume grid
	vec3 dt_vec = 1. / (scale * vec4(abs(ray_dir), 1.)).xyz;
	float dt = 1. * min(dt_vec.x, min(dt_vec.y, dt_vec.z));

	float offset = wang_hash(int(gl_FragCoord.x + 640. * gl_FragCoord.y));

	// Step 4: Starting from the entry point, march the ray through the volume
	// and sample it
	vec3 p = transformed_eye + (t_hit.x + offset * dt) * ray_dir;

	// TODO: Probably want to stop this process at some point to improve performance when marching down the edges.
	_BEFORE_RENDER
	for (float t = t_hit.x; t < t_hit.y; t += dt) {
		// Check if this point is on the "positive" side or "negative" side of the plane - only show positive.
		float canShow = 1.;
		for (int i = 0; i < NUM_PLANES; i += 1) {
			canShow *= max(0., sign(dot(normals[i], p) + distances[i]));
		}
		// Do not show coordinates outside 0-1 box.
		// Something about the undefined behavior outside the box causes the additive blender to 
		// render some very odd artifacts.
		float canShowXCoordinate = max(p.x - 0., 0.) * max(1. - p.x , 0.);
		float canShowYCoordinate = max(p.y - 0., 0.) * max(1. - p.y , 0.);
		float canShowZCoordinate = max(p.z - 0., 0.) * max(1. - p.z , 0.);
		float canShowCoordinate = float(ceil(canShowXCoordinate * canShowYCoordinate * canShowZCoordinate));
		canShow = canShowCoordinate * canShow;
		float intensityValue0 = float(texture(volume0, p).r);
		DECKGL_PROCESS_INTENSITY(intensityValue0, contrastLimits[0], 0);
		intensityValue0 = canShow * intensityValue0;
		float intensityValue1 = float(texture(volume1, p).r);
		DECKGL_PROCESS_INTENSITY(intensityValue1, contrastLimits[1], 1);
		intensityValue1 = canShow * intensityValue1;
		float intensityValue2 = float(texture(volume2, p).r);
  		DECKGL_PROCESS_INTENSITY(intensityValue2, contrastLimits[2], 2);
		intensityValue2 = canShow * intensityValue2;
		float intensityValue3 = float(texture(volume3, p).r);
  		DECKGL_PROCESS_INTENSITY(intensityValue3, contrastLimits[3], 3);
		intensityValue3 = canShow * intensityValue3;
    	float intensityValue4 = float(texture(volume4, p).r);
  		DECKGL_PROCESS_INTENSITY(intensityValue4, contrastLimits[4], 4);
		intensityValue4 = canShow * intensityValue4;
		float intensityValue5 = float(texture(volume5, p).r);
  		DECKGL_PROCESS_INTENSITY(intensityValue5, contrastLimits[5], 5);
		intensityValue5 = canShow * intensityValue5;

		_RENDER

		p += ray_dir * dt;
	}
	_AFTER_RENDER
  color.r = linear_to_srgb(color.r);
  color.g = linear_to_srgb(color.g);
  color.b = linear_to_srgb(color.b);
}
`,mK=`#version 300 es
#define SHADER_NAME xr-layer-vertex-shader

// Unit-cube vertices
in vec3 positions;

// Eye position - last column of the inverted view matrix
uniform vec3 eye_pos;
// Projection matrix
uniform mat4 proj;
// Model Matrix
uniform mat4 model;
// View Matrix
uniform mat4 view;
// A matrix for scaling in the model space before any transformations.
// This projects the unit cube up to match the "pixel size" multiplied by the physical size ratio, if provided.
uniform mat4 scale;
uniform mat4 resolution;


out vec3 vray_dir;
flat out vec3 transformed_eye;

void main() {

  // Step 1: Standard MVP transformation (+ the scale matrix) to place the positions on your 2D screen ready for rasterization + fragment processing.
  gl_Position = proj * view * model * scale * resolution * vec4(positions, 1.);

  // Step 2: Invert the eye back from world space to the normalized 0-1 cube world space because ray casting on the fragment shader runs in 0-1 space.
  // Geometrically, the transformed_eye is a position relative to the 0-1 normalized vertices, which themselves are the inverse of the model + scale trasnformation.
  // See below for an example which does not involve a scale transformation, for simplicity, but motivates geometrically the needed transformation on eye_pos.
  /*
  This first diagram is a skewed volume (i.e a "shear" model matrix applied) top down with the eye marked as #, all in world space
       ^
    ___|__
    \\  |  \\
     \\ |   \\
      \\|____\\
       | 
       | 
       |
       #

  This next diagram shows the volume after the inverse model matrix has placed it back in model coordinates, but the eye still in world space. 
       ^
    ___|___
    |  |  |
    |  |  |
    |__|__|
       |
       |
       |
       #

  Finally, we apply the inverse model matrix transformation to the eye as well to bring it too into world space.
  Notice that the ray here matches the "voxels" through which the first ray also passes, as desired.
         ^
    ____/__
    |  /  |
    | /   |
    |/____|
    /
   /
  /
 #
  */
  transformed_eye = (inverse(resolution) * inverse(scale) * inverse(model) * (vec4(eye_pos, 1.))).xyz;

  // Step 3: Rays are from eye to vertices so that they get interpolated over the fragments.
  vray_dir = positions - transformed_eye;
}
`,vK={name:"channel-intensity-module",fs:`    float apply_contrast_limits(float intensity, vec2 contrastLimits) {
      float contrastLimitsAppliedToIntensity = (intensity - contrastLimits[0]) / max(0.0005, (contrastLimits[1] - contrastLimits[0]));
      return max(0., contrastLimitsAppliedToIntensity);
    }
  `},_K=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0],uS=1,yK={pickable:!1,coordinateSystem:et.CARTESIAN,channelData:{type:"object",value:{},compare:!0},contrastLimits:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint8",compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},resolutionMatrix:{type:"object",value:new St,compare:!0},channelsVisible:{type:"array",value:[],compare:!0},extensions:{type:"array",value:[new FR.AdditiveBlendExtension],compare:!0}};function fS(){const n=C1("Float32");return{...n,sampler:n.sampler.replace("2D","3D"),cast:e=>new Float32Array(e)}}function xK(n){let e={};if(n.forEach(t=>{e=t.rendering}),!e._RENDER)throw new Error("XR3DLayer requires at least one extension to define opts.rendering as an object with _RENDER as a property at the minimum.");return e}const k1=class extends Or{initializeState(){const{device:n}=this.context;n.setParametersWebGL({[pt.UNPACK_ALIGNMENT]:1,[pt.PACK_ALIGNMENT]:1});const e=Hl.getDefaultShaderAssembler(),t="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";e._hookFunctions.includes(t)||e.addShaderHook(t)}_isHookDefinedByExtensions(n){const{extensions:e}=this.props;return e==null?void 0:e.some(t=>{const r=t.getShaders();if(r){const{inject:s={},modules:i=[]}=r,o=s[n],a=i.some(u=>{var f;return(f=u==null?void 0:u.inject)==null?void 0:f[n]});return o||a}return!1})}getShaders(){const{clippingPlanes:n,extensions:e}=this.props,{sampler:t}=fS(),{_BEFORE_RENDER:r,_RENDER:s,_AFTER_RENDER:i}=xK(e),o=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),a={inject:{},...vK};return o||(a.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders({vs:mK,fs:gK.replace("_BEFORE_RENDER",r).replace("_RENDER",s).replace("_AFTER_RENDER",i),defines:{SAMPLER_TYPE:t,NUM_PLANES:String(n.length||uS)},modules:[a]})}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(n=>n==null?void 0:n.delete())}updateState({props:n,oldProps:e,changeFlags:t}){var r,s;if(t.extensionsChanged||n.colormap!==e.colormap||n.renderingMode!==e.renderingMode||n.clippingPlanes.length!==e.clippingPlanes.length){const{device:i}=this.context;this.state.model&&this.state.model.destroy(),this.setState({model:this._getModel(i)})}n.channelData&&((r=n==null?void 0:n.channelData)==null?void 0:r.data)!==((s=e==null?void 0:e.channelData)==null?void 0:s.data)&&this.loadTexture(n.channelData)}_getModel(n){return n?new Jn(n,{...this.getShaders(),geometry:new ci({topology:"triangle-strip",attributes:{positions:new Float32Array(_K)}})}):null}draw(n){const{uniforms:e}=n,{textures:t,model:r,scaleMatrix:s}=this.state,{contrastLimits:i,xSlice:o,ySlice:a,zSlice:u,modelMatrix:f,channelsVisible:h,domain:p,dtype:m,clippingPlanes:v,resolutionMatrix:x}=this.props,{viewMatrix:w,viewMatrixInverse:T,projectionMatrix:E}=this.context.viewport;if(t&&r&&s){const C=HR({contrastLimits:i,channelsVisible:h,domain:p,dtype:m}),P=s.clone().invert(),L=x.clone().invert(),I=WR(v.map(q=>q.clone().transform(P).transform(L)),new Gl([1,0,0]),v.length||uS),F=I.flatMap(q=>q.normal),j=I.map(q=>q.distance);r.setUniforms({...e,contrastLimits:C,xSlice:new Float32Array(o?o.map(q=>q/s[0]/x[0]):[0,1]),ySlice:new Float32Array(a?a.map(q=>q/s[5]/x[5]):[0,1]),zSlice:new Float32Array(u?u.map(q=>q/s[10]/x[10]):[0,1]),eye_pos:new Float32Array([T[12],T[13],T[14]]),view:w,proj:E,scale:s,resolution:x,model:f||new St,normals:F,distances:j},{disableWanings:!1}),r.setBindings(t),r.draw(n)}}loadTexture(n){const e={volume0:null,volume1:null,volume2:null,volume3:null,volume4:null,volume5:null};if(this.state.textures&&Object.values(this.state.textures).forEach(t=>t==null?void 0:t.delete()),n&&Object.keys(n).length>0&&n.data){const{height:t,width:r,depth:s}=n;n.data.forEach((i,o)=>{e[`volume${o}`]=this.dataToTexture(i,r,t,s)},this);for(const i in e){if(!e.volume0)throw new Error("Bad texture state!");e[i]||(e[i]=e.volume0)}this.setState({textures:e,scaleMatrix:new St().scale(this.props.physicalSizeScalingMatrix.transformPoint([r,t,s]))})}}dataToTexture(n,e,t,r){var o;const s=fS();return this.context.device.createTexture({width:e,height:t,depth:r,dimension:"3d",data:((o=s.cast)==null?void 0:o.call(s,n))??n,format:s.format,mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge"}})}};k1.layerName="XR3DLayer";k1.defaultProps=yK;async function wK({source:n,selection:e,onUpdate:t=()=>{},downsampleDepth:r=1,signal:s}){const{shape:i,labels:o,dtype:a}=n,{height:u,width:f}=ug(n),h=i[o.indexOf("z")],p=Math.max(1,Math.floor(h/r)),m=u*f,v=`${a}Array`,x=globalThis[v],w=new x(m*p);return await Promise.all(new Array(p).fill(0).map(async(T,E)=>{const C={...e,z:E*r},{data:P}=await n.getRaster({selection:C,signal:s});let L=0;for(t();L<m;){const I=E*m+(m-L-1),F=(f-L-1)%f+f*Math.floor(L/f);w[I]=P[F],L+=1}t()})),{data:w,height:u,width:f,depth:p}}const bK=(n,e,t)=>new lc({id:`text-${t}`,coordinateSystem:et.CARTESIAN,data:[{text:n,position:e.position}],getColor:[220,220,220,255],getSize:25,sizeUnits:"meters",sizeScale:2**-e.zoom,fontFamily:"Helvetica"}),TK={pickable:!1,coordinateSystem:et.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},selections:{type:"array",value:[],compare:!0},resolution:{type:"number",value:0,compare:!0},domain:{type:"array",value:[],compare:!0},loader:{type:"object",value:[{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16",shape:[1],labels:["z"]}],compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},onUpdate:{type:"function",value:()=>{},compare:!0},useProgressIndicator:{type:"boolean",value:!0,compare:!0},extensions:{type:"array",value:[new FR.AdditiveBlendExtension],compare:!0}},KR=class extends Qr{clearState(){this.setState({height:null,width:null,depth:null,data:null,physicalSizeScalingMatrix:null,resolutionMatrix:null,progress:0,abortController:null})}finalizeState(){this.state.abortController.abort()}updateState({oldProps:n,props:e}){const t=e.loader!==n.loader,r=e.resolution!==n.resolution,s=e.selections!==n.selections;if(r&&this.clearState(),t||s||r){const{loader:i,selections:o=[],resolution:a,onViewportLoad:u}=this.props,f=i[a];let h=0;const p=(f.shape[f.labels.indexOf("z")]>>a)*o.length,m=()=>{h+=.5/p,this.props.onUpdate&&this.props.onUpdate({progress:h}),this.setState({progress:h})},v=new AbortController;this.setState({abortController:v});const{signal:x}=v,w=o.map(E=>wK({selection:E,source:f,onUpdate:m,downsampleDepth:2**a,signal:x})),T=Yq(i[a]);Promise.all(w).then(E=>{var P,L,I;u&&u(E);const C={data:E.map(F=>F.data),width:(P=E[0])==null?void 0:P.width,height:(L=E[0])==null?void 0:L.height,depth:(I=E[0])==null?void 0:I.depth};this.setState({...C,physicalSizeScalingMatrix:T,resolutionMatrix:new St().scale(2**a)})})}}renderLayers(){const{loader:n,id:e,resolution:t,useProgressIndicator:r}=this.props,{dtype:s}=n[t],{data:i,width:o,height:a,depth:u,progress:f,physicalSizeScalingMatrix:h,resolutionMatrix:p}=this.state;if(!(o&&a)&&r){const{viewport:m}=this.context;return bK(`Loading Volume ${String((f||0)*100).slice(0,5)}%...`,m,e)}return new k1(this.props,{channelData:{data:i,width:o,height:a,depth:u},id:`XR3DLayer-0-${a}-${o}-0-${t}-${e}`,physicalSizeScalingMatrix:h,parameters:{[pt.CULL_FACE]:!0,[pt.CULL_FACE_MODE]:pt.FRONT,[pt.DEPTH_TEST]:!1,blendFunc:[pt.SRC_ALPHA,pt.ONE],blend:!0},resolutionMatrix:p,dtype:s})}};KR.layerName="VolumeLayer";KR.defaultProps=TK;function SK(n,e,t=[0,0],r=1){const[s,i]=t,o=n*r+s,a=e*r+i;return[s,a,o,i]}function EK(n){const[e]=n,{width:t,height:r}=e.data;for(const{data:s}of n)s&&Dt(s.width===t&&s.height===r,"Grid data is not same shape.");return{width:t,height:r}}function hS(n){const{loaders:e,selections:t=[]}=n;let{concurrency:r}=n;return r&&t.length>0&&(r=Math.ceil(r/t.length)),t4(e,async i=>{const o=t.map(u=>i.loader.getRaster({selection:u})),a=await Promise.all(o);return{...i,data:{data:a.map(u=>u.data),width:a[0].width,height:a[0].height}}},{concurrency:r})}var fa,ny,ZR;class ty extends Qr{constructor(){super(...arguments);vt(this,fa)}initializeState(){nt(this,fa,{gridData:[],width:0,height:0},ZR),hS(this.props).then(t=>{const{width:r,height:s}=EK(t);this.setState({gridData:t,width:r,height:s})})}updateState({props:t,oldProps:r,changeFlags:s}){const{propsChanged:i}=s,o=typeof i=="string"&&i.includes("props.loaders"),a=t.selections!==r.selections;(o||a)&&hS(this.props).then(u=>{this.setState({gridData:u})})}getPickingInfo({info:t}){if(!t.coordinate)return t;const r=this.props.spacer||0,{width:s,height:i}=be(this,fa,ny),[o,a]=t.coordinate,u=Math.floor(a/(i+r)),f=Math.floor(o/(s+r));return{...t,gridCoord:{row:u,column:f}}}renderLayers(){const{gridData:t,width:r,height:s}=be(this,fa,ny);if(r===0||s===0)return null;const{rows:i,columns:o,spacer:a=0,id:u=""}=this.props,f=t.map(h=>{const p=h.row*(s+a),m=h.col*(r+a),v={channelData:h.data,bounds:SK(r,s,[m,p]),id:`${u}-GridLayer-${h.row}-${h.col}`,dtype:h.loader.dtype||"Uint16",pickable:!1,extensions:[new cc]};return new nc({...this.props,...v})});if(this.props.pickable){const h=i*(s+a),p=o*(r+a),v={data:[{polygon:[[0,0],[p,0],[p,h],[0,h]]}],getPolygon:w=>w.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${u}-GridLayer-picking`},x=new xf({...this.props,...v});f.push(x)}if(this.props.text){const h=new lc({id:`${u}-GridLayer-text`,data:t,getPosition:p=>[p.col*(r+a),p.row*(s+a)],getText:p=>p.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});f.push(h)}return f}}fa=new WeakSet,ny=function(){return this.state},ZR=function(t){this.state=t},S(ty,"layerName","VizarrGridLayer"),S(ty,"defaultProps",{...nc.defaultProps,loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});class QR extends M1{constructor(e){super(e)}}S(QR,"layerName","VizarMultiscaleImageLayer");class GR extends Ef{constructor(e){super(e)}}S(GR,"layerName","VizarrImageLayer");const hv=Fn(null),JR=Fn(null),eC=Fn(null),ry=Fn([]),AK=Fn(null,async(n,e,t)=>{const{createSourceData:r}=await nr(async()=>{const{createSourceData:i}=await Promise.resolve().then(()=>NX);return{createSourceData:i}},void 0,import.meta.url),s=Math.random().toString(36).slice(2);try{const i=await r(t),o=n(ry);i.name||(i.name=`image_${Object.keys(o).length}`),e(ry,[...o,{id:s,...i}])}catch(i){HE(i,Error),i instanceof jE?e(eC,{message:i.message,url:i.url}):e(JR,i.message)}}),tC=r8(ry),nC=Fy(n=>Fn({...PR(n),id:n.id}),(n,e)=>n.id===e.id),RK={image:GR,multiscale:QR,grid:ty},CK=Fy(n=>Fn(e=>{const{on:t,layerProps:r,kind:s}=e(n);if(!t)return null;const i=RK[s];return new i(r)})),PK=Fy(n=>Fn(e=>{const{on:t,labels:r,layerProps:s}=e(n);return!t||!r?[]:r.map(i=>i.on?new RR({...i.layerProps,selection:i.transformSourceSelection(s.selections[0])}):null)})),IK=Fn(n=>{const e=[];for(const t of n(tC)){const r=nC(n(t));e.push(CK(r)),e.push(PK(r))}return n(o8(e)).flat()});function MK(){const[n]=vs(),{acquisitionId:e,acquisitions:t}=n;if(!t)return null;const r=s=>{let i=s.target.value;const o=new URL(window.location.href);i==="-1"?o.searchParams.delete("acquisition"):o.searchParams.set("acquisition",i),window.location.href=decodeURIComponent(o.href)};return oe.jsx(oe.Fragment,{children:oe.jsx(Ct,{children:oe.jsxs(xy,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:r,value:e,children:[oe.jsx("option",{value:"-1",children:"Filter by Acquisition"},"-1"),t.map(s=>(s=s,oe.jsxs("option",{value:s.id,children:["Acquisition: ",s.name]},s.id)))]})})})}function kK(){const[n,e]=vs(),[t,r]=pi(),[s,i]=B.useState(null),o=m=>{i(m.currentTarget)},a=()=>{i(null)},u=async m=>{a();const v=+m.target.value,x=[...n.defaults.selection];n.channel_axis&&(x[n.channel_axis]=v);let w;if(n.contrast_limits[v])w=n.contrast_limits[v];else{const T=YE(t.layerProps),E=Array.isArray(T)?T[T.length-1]:T;w=await Ly(E,x),e(C=>{const P=[...C.contrast_limits];return P[v]=w,{...C,contrast_limits:P}})}r(T=>{const{layerProps:E}=T,C=[...E.selections,x],P=[...E.colors,Dy(n.colors[v])],L=[...E.contrastLimitsRange,w],I=[...E.channelsVisible,!0];return{...T,layerProps:{...E,selections:C,colors:P,contrastLimits:L,contrastLimitsRange:[...L],channelsVisible:I}}})},{names:f}=n,h=!!s,p=h?`layer-${n.id}-add-channel`:void 0;return oe.jsxs(oe.Fragment,{children:[oe.jsx(Us,{onClick:o,"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:t.layerProps.selections.length===Ml,children:oe.jsx(lE,{})}),oe.jsx(yy,{id:p,open:h,anchorEl:s,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:oe.jsxs(of,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[oe.jsx(rr,{variant:"caption",children:"selection: "}),oe.jsx(kr,{}),oe.jsxs(xy,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:u,children:[oe.jsx("option",{"aria-label":"None",value:"",children:"None"}),f.map((m,v)=>oe.jsx("option",{value:v,children:m},m))]})]})})]})}const OK=bo({root:{width:"5.5em",fontSize:"0.7em"}})(_y);function NK({axisIndex:n,max:e}){const[t]=vs(),[r,s]=pi(),[i,o]=B.useState(null),a=v=>{o(v.currentTarget)},u=()=>{o(null)},f=v=>{let x=+v.target.value;x<0&&(x=0),x>e&&(x=e),s(w=>{let T={...w.layerProps};return T.selections=T.selections.map(E=>{let C=[...E];return C[n]=x,C}),{...w,layerProps:T}})},h=!!i,p=h?`${n}-index-${t.id}-options`:void 0,m=r.layerProps.selections[0]?r.layerProps.selections[0][n]:1;return oe.jsxs(oe.Fragment,{children:[oe.jsx(Us,{onClick:a,"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:oe.jsx(cE,{})}),oe.jsx(yy,{id:p,open:h,anchorEl:i,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:oe.jsxs(of,{style:{padding:"0px 4px",marginBottom:4},children:[oe.jsx(rr,{variant:"caption",children:"Index:"}),oe.jsx(kr,{}),oe.jsx(OK,{value:m,onChange:f,type:"number",id:"max",fullWidth:!1}),oe.jsx(kr,{})]})})]})}const DK=bo({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Wp);function LK({axisIndex:n,max:e}){const[t,r]=pi(),[s]=vs(),{axis_labels:i}=s;let o=i[n];(o==="t"||o==="z")&&(o=o.toUpperCase());const[a,u]=B.useState(0);B.useEffect(()=>{u(t.layerProps.selections[0]?t.layerProps.selections[0][n]:1)},[t.layerProps.selections,n]);const f=()=>{r(p=>{let m={...p.layerProps};return m.selections=m.selections.map(v=>{let x=[...v];return x[n]=a,x}),{...p,layerProps:m}})},h=(p,m)=>{u(m)};return oe.jsxs(oe.Fragment,{children:[oe.jsxs(Ct,{children:[oe.jsxs(Ct,{container:!0,justifyContent:"space-between",children:[oe.jsx(Ct,{item:!0,xs:10,children:oe.jsx("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:oe.jsxs(rr,{variant:"caption",noWrap:!0,children:[o,": ",a,"/",e]})})}),oe.jsx(Ct,{item:!0,xs:1,children:oe.jsx(NK,{axisIndex:n,max:e})})]}),oe.jsx(Ct,{container:!0,justifyContent:"space-between",children:oe.jsx(Ct,{item:!0,xs:12,children:oe.jsx(DK,{value:a,onChange:h,onChangeCommitted:f,min:0,max:e,step:1})})})]}),oe.jsx(kr,{})]})}function FK(){const[n]=vs(),{axis_labels:e,channel_axis:t,loader:r}=n,s=e.slice(0,-2).map((i,o)=>[i,o,r[0].shape[o]]).filter(i=>i[1]===t?!1:i[2]>1).map(([i,o,a])=>oe.jsx(LK,{axisIndex:o,max:a-1},i));return s.length===0?null:oe.jsxs(oe.Fragment,{children:[oe.jsx(Ct,{children:s}),oe.jsx(kr,{})]})}const BK=$p(()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}})),UK=Object.entries(Fs).map(([n,e])=>[n,Dy(e)]);function VK({handleChange:n}){const e=BK();return oe.jsx("div",{className:e.container,"aria-label":"color-swatch",children:UK.map(([t,r])=>oe.jsx(Us,{className:e.button,onClick:()=>n(r),children:oe.jsx(p5,{fontSize:"small",style:{color:`rgb(${r})`}})},t))})}const dS=bo({root:{width:"5.5em",fontSize:"0.7em"}})(_y);function zK({channelIndex:n}){const[e]=vs(),[t,r]=pi(),[s,i]=B.useState(null),{channel_axis:o,names:a}=e,u=C=>{i(C.currentTarget)},f=()=>{i(null)},h=C=>{r(P=>{const L=[...P.layerProps.colors];return L[n]=C,{...P,layerProps:{...P.layerProps,colors:L}}})},p=C=>{const P=C.target.id;let L=+C.target.value;L<0&&(L=0),r(I=>{const F=[...I.layerProps.contrastLimitsRange],j=[...I.layerProps.contrastLimits],[q,Q]=F[n],[le,he]=j[n],[pe,ne]=P==="min"?[L,Q]:[q,L];return pe>le&&(j[n]=[pe,he]),ne<he&&(j[n]=[le,ne]),F[n]=[pe,ne],{...I,layerProps:{...I.layerProps,contrastLimits:j,contrastLimitsRange:F}}})},m=()=>{r(C=>{const{layerProps:P}=C,L=[...P.colors],I=[...P.contrastLimits],F=[...P.contrastLimitsRange],j=[...P.selections],q=[...P.channelsVisible];return L.splice(n,1),I.splice(n,1),F.splice(n,1),j.splice(n,1),q.splice(n,1),{...C,layerProps:{...P,colors:L,selections:j,channelsVisible:q,contrastLimits:I,contrastLimitsRange:F}}})},v=C=>{r(P=>{const L=[...P.layerProps.selections],I=[...L[n]];return Number.isInteger(o)&&(I[o]=+C.target.value,L[n]=I),{...P,layerProps:{...P.layerProps,selections:L}}})},x=!!s,w=x?`channel-${n}-${e.name}-options`:void 0,[T,E]=t.layerProps.contrastLimitsRange[n];return oe.jsxs(oe.Fragment,{children:[oe.jsx(Us,{onClick:u,"aria-describedby":w,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:oe.jsx(cE,{})}),oe.jsx(yy,{id:w,open:x,anchorEl:s,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:oe.jsxs(of,{style:{padding:"0px 4px",marginBottom:4},children:[oe.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[oe.jsx(rr,{variant:"caption",children:"remove:"}),oe.jsx(Us,{onClick:m,children:oe.jsx(hE,{})})]}),oe.jsx(kr,{}),oe.jsx(rr,{variant:"caption",children:"selection:"}),oe.jsx(kr,{}),oe.jsx(xy,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${e.name}-channel-select`,onChange:v,value:t.layerProps.selections[n][o],children:a.map((C,P)=>oe.jsxs("option",{value:P,children:["(",P,") ",C]},C))}),oe.jsx(kr,{}),oe.jsx(rr,{variant:"caption",children:"contrast limits:"}),oe.jsx(kr,{}),oe.jsx(dS,{value:T,onChange:p,type:"number",id:"min",fullWidth:!1}),oe.jsx(dS,{value:E,onChange:p,type:"number",id:"max",fullWidth:!1}),oe.jsx(kr,{}),oe.jsx(rr,{variant:"caption",children:"color:"}),oe.jsx(kr,{}),oe.jsx("div",{style:{display:"flex",justifyContent:"center"},children:oe.jsx(VK,{handleChange:h})})]})})]})}function $K({channelIndex:n}){const[e]=vs(),[t,r]=pi(),s=(E,C)=>{r(P=>{const L=[...P.layerProps.contrastLimits];return L[n]=C,{...P,layerProps:{...P.layerProps,contrastLimits:L}}})},i=()=>{r(E=>{const C=[...E.layerProps.channelsVisible];return C[n]=!C[n],{...E,layerProps:{...E.layerProps,channelsVisible:C}}})},o=t.layerProps,a=[...o.contrastLimits[n]],u=`rgb(${o.colormap?[255,255,255]:o.colors[n]})`,f=o.channelsVisible[n],[h,p]=o.contrastLimitsRange[n],{channel_axis:m,names:v}=e,x=o.selections[n],w=Number.isInteger(m)?x[m]:0,T=v[w];return oe.jsxs(oe.Fragment,{children:[oe.jsxs(Ct,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[oe.jsx(Ct,{item:!0,xs:10,children:oe.jsx("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:oe.jsx(rr,{variant:"caption",noWrap:!0,children:T})})}),oe.jsx(Ct,{item:!0,xs:1,children:oe.jsx(zK,{channelIndex:n})})]}),oe.jsxs(Ct,{container:!0,justifyContent:"space-between",children:[oe.jsx(Ct,{item:!0,xs:2,children:oe.jsx(Us,{style:{color:u,backgroundColor:"transparent",padding:0,zIndex:2},onClick:i,children:f?oe.jsx(uE,{}):oe.jsx(fE,{})})}),oe.jsx(Ct,{item:!0,xs:10,children:oe.jsx(Wp,{value:a,onChange:s,min:h,max:p,step:.01,style:{padding:"10px 0px 5px 0px",color:u}})})]})]})}function jK({labelIndex:n}){const[e]=vs(),[t,r]=pi();Dt(e.labels&&t.kind==="multiscale"&&t.labels,"Missing image labels");const s=(a,u)=>{r(f=>(Dt(f.kind==="multiscale"&&f.labels,"Missing image labels"),{...f,labels:f.labels.with(n,{...f.labels[n],layerProps:{...f.labels[n].layerProps,opacity:u}})}))},{name:i}=e.labels[n],o=t.labels[n];return oe.jsxs(oe.Fragment,{children:[oe.jsx(Ct,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:oe.jsx("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:oe.jsx(rr,{variant:"caption",noWrap:!0,children:i})})}),oe.jsxs(Ct,{container:!0,justifyContent:"space-between",children:[oe.jsx(Ct,{item:!0,xs:2,children:oe.jsx(Us,{style:{backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{r(a=>(Dt(a.kind==="multiscale"&&a.labels,"Missing image labels"),{...a,labels:a.labels.with(n,{...a.labels[n],on:!a.labels[n].on})}))},children:o.on?oe.jsx(uE,{}):oe.jsx(fE,{})})}),oe.jsx(Ct,{item:!0,xs:10,children:oe.jsx(Wp,{value:o.layerProps.opacity,onChange:s,min:0,max:1,step:.01,style:{padding:"10px 0px 5px 0px"}})})]})]})}const WK=bo({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Wp);function HK(){const[n,e]=pi(),t=(r,s)=>{const i=s;e(o=>({...o,layerProps:{...o.layerProps,opacity:i}}))};return oe.jsx(WK,{value:n.layerProps.opacity,onChange:t,min:0,max:1,step:.01})}const XK=bo({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})($M);function YK(){var t;const[n]=pi(),e=n.layerProps.selections.length;return oe.jsx(XK,{children:oe.jsxs(Ct,{container:!0,direction:"column",children:[oe.jsx(MK,{}),oe.jsx(Ct,{children:oe.jsxs(Ct,{container:!0,justifyContent:"space-between",children:[oe.jsx(Ct,{item:!0,xs:3,children:oe.jsx(rr,{variant:"caption",children:"opacity:"})}),oe.jsx(Ct,{item:!0,xs:8,children:oe.jsx(HK,{})})]})}),oe.jsx(FK,{}),oe.jsxs(Ct,{container:!0,justifyContent:"space-between",children:[oe.jsx(Ct,{item:!0,xs:3,children:oe.jsx(rr,{variant:"caption",children:"channels:"})}),oe.jsx(Ct,{item:!0,xs:1,children:oe.jsx(kK,{})})]}),oe.jsx(kr,{}),oe.jsx(Ct,{children:Du(e).map(r=>oe.jsx($K,{channelIndex:r},r))}),((t=n.labels)==null?void 0:t.length)&&oe.jsxs(oe.Fragment,{children:[oe.jsx(Ct,{container:!0,justifyContent:"space-between",children:oe.jsx(rr,{variant:"caption",children:"labels:"})}),oe.jsx(kr,{}),oe.jsx(Ct,{children:n.labels.map((r,s)=>oe.jsx(jK,{labelIndex:s},r.layerProps.id))})]})]})})}function qK(){const[n]=vs(),[e,t]=pi(),r=s=>{s.stopPropagation(),t(i=>{const o=!i.on;return{...i,on:o}})};return oe.jsx(Us,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:r,style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${e.on?1:.5})`},children:e.on?oe.jsx(g5,{}):oe.jsx(m5,{})})}const KK=bo({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(tk);function ZK({name:n}){const[e]=vs(),t=`layer-controller-${e.id}`;return oe.jsx(KK,{"aria-controls":t,id:t,children:oe.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[oe.jsx(qK,{}),oe.jsx(rr,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}const QK=bo({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(UM);function GK(){const[n]=vs(),e=nC(n);return oe.jsx(ZE.Provider,{value:e,children:oe.jsxs(QK,{defaultExpanded:!0,children:[oe.jsx(ZK,{name:n.name??""}),oe.jsx(YK,{})]})})}const JK=$p({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function eZ(n){const e=ku(tC),[t,r]=B.useReducer(i=>!i,!(n.open??!0)),s=JK();return oe.jsx("div",{className:s.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:oe.jsxs(Ct,{container:!0,direction:"column",alignItems:"flex-start",children:[oe.jsx(Us,{style:{backgroundColor:"transparent",padding:0},onClick:r,children:t?oe.jsx(lE,{}):oe.jsx(hE,{})}),oe.jsx("div",{className:s.scroll,style:{display:t?"none":"flex"},children:e.map(i=>oe.jsx(KE.Provider,{value:i,children:oe.jsx(GK,{})},`${i}`))})]})})}function tZ(){var o;const n=B.useRef(null),[e,t]=GN(),r=ku(IK),s=r[0];if((o=n.current)!=null&&o.deck&&!e&&s){const{deck:a}=n.current;t($N({image:nZ(s),viewport:a,padding:a.width<400?10:a.width<600?30:50,matrix:s.props.modelMatrix}))}const i={preserveDrawingBuffer:!0};return oe.jsx(EX,{ref:n,layers:r,viewState:e&&{ortho:e},onViewStateChange:a=>t(a.viewState),views:[new d1({id:"ortho",controller:!0})],glOptions:i})}function nZ({props:n}){const e=YE(n),[t,r]=Array.isArray(e)?[e[0],e.length]:[e,0],s=zE(t.shape);let[i,o]=t.shape.slice(s?-3:-2);return XE(n)&&(i=(i+5)*n.rows,o=(o+5)*n.columns),{height:i,width:o,maxZoom:r}}NE.set("jpeg2k",()=>nr(()=>import("./jpeg2k-HwDsNbN8.js"),[],import.meta.url).then(n=>n.default));var tu={},pS;function rZ(){if(pS)return tu;pS=1,Object.defineProperty(tu,"__esModule",{value:!0}),tu.default=void 0;var n={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},e=n;return tu.default=e,tu}var sZ=rZ();const gS=Ea(sZ),iZ=CS({palette:{type:"dark",primary:gS,secondary:gS},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}}),yZ="0.3.0",oZ=$p({errorContainer:{position:"fixed",top:0,bottom:0,left:0,right:0,color:"#fff",display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center",fontSize:"120%"}});function xZ(n,e={}){const t=B.createRef(),r=HN(),s=Fn(f=>f(hv),(f,h,p)=>{const m=typeof p=="function"?p(f(hv)):p;m&&r.emit("viewStateChange",{target:m.target,zoom:m.zoom}),h(hv,p)}),{promise:i,resolve:o}=WN();function a(){const f=ku(JR),h=ku(eC),p=Fv(AK),m=Fv(s);B.useImperativeHandle(t,()=>({addImage:p,setViewState:m,on:r.on.bind(r),destroy:()=>u.unmount()}),[m,p]),B.useEffect(()=>{t.current&&o(t.current)},[]);const v=oZ();return oe.jsxs(oe.Fragment,{children:[f===null&&h===null&&oe.jsxs(Gv.Provider,{value:s,children:[oe.jsx(eZ,{open:e.menuOpen??!0}),oe.jsx(tZ,{})]}),f!==null&&oe.jsx("div",{className:v.errorContainer,children:oe.jsx("p",{children:`Error: server replied with "${f}" when loading the resource`})}),h!==null&&oe.jsx("div",{className:v.errorContainer,children:oe.jsxs(rr,{variant:"h5",children:[h.message,oe.jsxs(Vk,{href:h.url,children:[" ",h.url," "]})]})})]})}let u=d5.createRoot(n);return u.render(oe.jsx(hM,{theme:iZ,children:oe.jsx(u5,{children:oe.jsx(Gv.Provider,{value:s,children:oe.jsx(a,{})})})})),i}export{cq as BaseDecoder,mZ as LercAddCompression,gZ as LercParameters,xZ as createViewer,Ea as getDefaultExportFromCjs,yZ as version};
//# sourceMappingURL=vizarr-CN6h8ZgV.js.map
