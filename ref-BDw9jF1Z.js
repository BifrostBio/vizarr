var v=r=>{throw TypeError(r)};var A=(r,t,n)=>t.has(r)||v("Cannot "+n);var g=(r,t,n)=>(A(r,t,"read from private field"),n?n.call(r):t.get(r)),y=(r,t,n)=>t.has(r)?v("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,n),w=(r,t,n,e)=>(A(r,t,"write to private field"),e?e.call(r,n):t.set(r,n),n);function E(r,t=/{{(.*?)}}/){let n=t.exec(r);const e=[];let s;for(;n;)s=n.index,s!==0&&(e.push({match:!1,str:r.substring(0,s)}),r=r.slice(s)),e.push({match:!0,str:n[0]}),r=r.slice(n[0].length),n=t.exec(r);return r&&e.push({match:!1,str:r}),e}function C(r){const t=r.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(t!=null&&t.groups))return;const{fname:n,args:e}=t.groups,s=Object.fromEntries(e.split(",").map(c=>{var i;const{key:a,num:o,str:f}=((i=c.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:i.groups)??{};if(!a||!(o||f))throw Error(`Failed to match fn kwarg: ${c}`);return[a,o?Number(o):f]}));return{fname:n,ctx:s}}const x="abcdefghijklmnopqrstuvwxyz",k="01234569789",O="()*/+-",U=" ",j=new Set(x+x.toUpperCase()+k+O+U);function z(r){for(let t=0;t<r.length;t++)if(!j.has(r.charAt(t)))return;return E(r,/[A-Za-z_][A-Za-z0-9_]*/gi)}function _(r,t){return E(r).map(e=>{if(!e.match)return e.str;let s=e.str.split(/{{|}}/).filter(Boolean)[0].trim();if(s in t)return t[s];const c=C(s);if(c){const{fname:o,ctx:f}=c,i=t[o];if(typeof i=="function")return i(f);throw Error(`Cannot find function named ${o} in rendering context.`)}const a=z(s);if(a){const o=a.map(f=>{if(!f.match)return f.str;const i=t[f.str];if(i==null)throw Error(`Cannot find number named ${f.str} in rendering context.`);if(typeof i!="number")throw Error(`The provided value for ${f.str} must be a number.`);return i});return Function('"use strict";return ('+o.join("")+")")()}throw new Error(`Unable to match ${e.str}`)}).join("")}function M(r,t=_){return"version"in r?S(r,t):N(r)}function N(r){return new Map(Object.entries(r))}function S(r,t){var c;const n={};for(const[a,o]of Object.entries(r.templates??{}))o.includes("{{")?n[a]=f=>t(o,f):n[a]=o;const e=(a,o)=>t(a,{...n,...o}),s=new Map;for(const[a,o]of Object.entries(r.refs??{}))if(typeof o=="string")s.set(a,o);else{const f=(c=o[0])!=null&&c.includes("{{")?e(o[0]):o[0];s.set(a,o.length===1?[f]:[f,o[1],o[2]])}for(const a of r.gen??[])for(const o of Z(a.dimensions)){const f=e(a.key,o),i=e(a.url,o);if("offset"in a&&"length"in a){const m=e(a.offset,o),$=e(a.length,o);s.set(f,[i,parseInt(m),parseInt($)])}else s.set(f,[i])}return s}function*Z(r){const t=Object.keys(r),n=Object.values(r).map(e=>Array.isArray(e)?e:[...I(e)]);for(const e of F(...n))yield Object.fromEntries(t.map((s,c)=>[s,e[c]]))}function*F(...r){if(r.length===0)return;const t=r.map(e=>e[Symbol.iterator]()),n=t.map(e=>e.next());if(n.some(e=>e.done))throw new Error("Input contains an empty iterator.");for(let e=0;;){if(n[e].done){if(t[e]=r[e][Symbol.iterator](),n[e]=t[e].next(),++e>=t.length)return}else yield n.map(({value:s})=>s),e=0;n[e]=t[e].next()}}function*I({stop:r,start:t=0,step:n=1}){for(let e=t;e<r;e+=n)yield e}(()=>{for(var r=new Uint8Array(128),t=0;t<64;t++)r[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return n=>{for(var e=n.length,s=new Uint8Array((e-(n[e-1]=="=")-(n[e-2]=="="))*3/4|0),c=0,a=0;c<e;){var o=r[n.charCodeAt(c++)],f=r[n.charCodeAt(c++)],i=r[n.charCodeAt(c++)],m=r[n.charCodeAt(c++)];s[a++]=o<<2|f>>4,s[a++]=f<<4|i>>2,s[a++]=i<<6|m}return s}})();new TextEncoder;function T(r){return r.slice(1)}function q(r){let[t,n]=(typeof r=="string"?r:r.href).split("://");if(t==="https"||t==="http")return r;if(t==="gc")return`https://storage.googleapis.com/${n}`;if(t==="s3")return`https://s3.amazonaws.com/${n}`;throw Error("Protocol not supported, got: "+JSON.stringify(t))}function B(r,t,n,e={}){return t!==void 0&&n!==void 0&&(e={...e,headers:{...e.headers,Range:`bytes=${t}-${t+n-1}`}}),fetch(r,e)}let l=new Uint8Array(128);for(var u=0;u<64;u++)l[u<26?u+65:u<52?u+71:u<62?u-4:u*4-205]=u;function P(r){for(var t=r.length,n=new Uint8Array((t-(r[t-1]=="=")-(r[t-2]=="="))*3/4|0),e=0,s=0;e<t;){var c=l[r.charCodeAt(e++)],a=l[r.charCodeAt(e++)],o=l[r.charCodeAt(e++)],f=l[r.charCodeAt(e++)];n[s++]=c<<2|a>>4,n[s++]=a<<4|o>>2,n[s++]=o<<6|f}return n}var h,p;const d=class d{constructor(t,n={}){y(this,h);y(this,p);w(this,h,t),w(this,p,n)}async get(t,n={}){let e=g(this,h).get(T(t));if(!e)return;if(typeof e=="string")return e.startsWith("base64:")?P(e.slice(7)):new TextEncoder().encode(e);let[s,c,a]=e,o=s??g(this,p).target;if(!o)throw Error(`No url for key ${t}, and no target url provided.`);let f=await B(q(o),c,a,n);if(f.status===200||f.status===206)return new Uint8Array(await f.arrayBuffer());throw new Error(`Request unsuccessful for key ${t}. Response status: ${f.status}.`)}static fromSpec(t,n){let e=M(t);return new d(e,n)}static async fromUrl(t,n){let e=await fetch(t).then(s=>s.json());return d.fromSpec(e,n)}};h=new WeakMap,p=new WeakMap;let b=d;export{b as default,P as to_binary};
//# sourceMappingURL=ref-BDw9jF1Z.js.map
