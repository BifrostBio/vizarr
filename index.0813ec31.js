var We=Object.defineProperty,qe=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var re=(e,t,n)=>t in e?We(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t)=>{for(var n in t||(t={}))He.call(t,n)&&re(e,n,t[n]);if(me)for(var n of me(t))Xe.call(t,n)&&re(e,n,t[n]);return e},C=(e,t)=>qe(e,Ue(t));var fe=(e,t,n)=>(re(e,typeof t!="symbol"?t+"":t,n),n);import{X as ye,C as Ye,p as ge,a as Ze,S as Je,T as Ke,Q as Qe,o as se,b as et,c as tt,Z as nt,H as ot,M as we,d as K,G as rt,I as st,e as at,f as Q,s as it,w as lt,g as ct,u as D,j as i,h as F,r as N,D as dt,O as ut,i as B,V as ht,k as pt,l as q,A as mt,m as P,n as $,F as G,q as k,N as ae,t as xe,P as ie,v as le,x as M,y as ce,z as be,B as Ce,E as ve,L as ft,R as _e,J as yt,K as gt,U as wt,W as xt,Y as Pe,_ as bt,$ as Se,a0 as Ct,a1 as vt,a2 as _t,a3 as Pt}from"./vendor.bb7c3d5f.js";const St=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};St();const Lt="modulepreload",Le={},kt="./",T=function(t,n){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=`${kt}${r}`,r in Le)return;Le[r]=!0;const o=r.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":Lt,o||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),o)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",c)})})).then(()=>t())},zt=C(g({},ye.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function It(e,t,n=[0,0],r=1){const[o,s]=n,a=e*r+o,l=t*r+s;return[o,l,a,s]}function Et(e){const[t]=e,{width:n,height:r}=t.data;return e.forEach(({data:o})=>{if((o==null?void 0:o.width)!==n||(o==null?void 0:o.height)!==r)throw new Error("Grid data is not same shape.")}),{width:n,height:r}}function ke(e){const{loaders:t,selections:n=[]}=e;let{concurrency:r}=e;return r&&n.length>0&&(r=Math.ceil(r/n.length)),ge(t,async s=>{const a=n.map(c=>s.loader.getRaster({selection:c})),l=await Promise.all(a);return C(g({},s),{data:{data:l.map(c=>c.data),width:l[0].width,height:l[0].height}})},{concurrency:r})}class de extends Ye{initializeState(){this.state={gridData:[],width:0,height:0},ke(this.props).then(t=>{const{width:n,height:r}=Et(t);this.setState({gridData:t,width:n,height:r})})}updateState({props:t,oldProps:n,changeFlags:r}){const{propsChanged:o}=r,s=typeof o=="string"&&o.includes("props.loaders"),a=t.selections!==n.selections;(s||a)&&ke(this.props).then(l=>{this.setState({gridData:l})})}getPickingInfo({info:t}){if(!t.coordinate)return t;const n=this.props.spacer||0,{width:r,height:o}=this.state,[s,a]=t.coordinate,l=Math.floor(a/(o+n)),c=Math.floor(s/(r+n));return t.gridCoord={row:l,column:c},t}renderLayers(){const{gridData:t,width:n,height:r}=this.state;if(n===0||r===0)return null;const{rows:o,columns:s,spacer:a=0,id:l=""}=this.props,c=t.map(d=>{const h=d.row*(r+a),u=d.col*(n+a),m={channelData:d.data,bounds:It(n,r,[u,h]),id:`${l}-GridLayer-${d.row}-${d.col}`,dtype:d.loader.dtype||"Uint16",pickable:!1,extensions:[new Ze]};return new ye(g(g({},this.props),m))});if(this.props.pickable){const[d,h]=[0,0],u=o*(r+a),m=s*(n+a),p={data:[{polygon:[[h,d],[m,d],[m,u],[h,u]]}],getPolygon:S=>S.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${l}-GridLayer-picking`},v=new Je(g(g({},this.props),p));c.push(v)}if(this.props.text){const d=new Ke({id:`${l}-GridLayer-text`,data:t,getPosition:h=>[h.col*(n+a),h.row*(r+a)],getText:h=>h.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});c.push(d)}return c}}de.layerName="GridLayer";de.defaultProps=zt;class Rt{constructor(t,n=100){fe(this,"cache");this.store=t,this.cache=new Qe({maxSize:n})}getItem(...t){const[n,r]=t;if(this.cache.has(n))return this.cache.get(n);const o=this.store.getItem(n,r).catch(s=>{throw this.cache.delete(n),s});return this.cache.set(n,o),o}async containsItem(t){return this.cache.has(t)||this.store.containsItem(t)}keys(){return this.store.keys()}deleteItem(t){throw new Error("deleteItem not implemented")}setItem(t,n){throw new Error("setItem not implemented")}}const Y=6,j={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},Ot=[j.magenta,j.green],Mt=[j.red,j.green,j.blue],ze=Object.values(j).slice(0,-2);async function Dt(e){let t;if(typeof e=="string"){let n;if(e.endsWith(".json")){const[{ReferenceStore:r},o]=await Promise.all([T(()=>import("./index.949b4e0f.js"),[]),fetch(e).then(s=>s.json())]);n=r.fromJSON(o)}else{const r=new URL(e);n=new ot(r.origin),t=r.pathname.slice(1)}return{store:new Rt(n),path:t}}return{store:e,path:t}}async function At(e){const{store:t,path:n}=await Dt(e);return se(t,n).catch(r=>{if(r instanceof et)return tt({store:t});throw r})}const $t=new TextDecoder;function Ie(e,t){return e.store.getItem(U(e.path,t,".zattrs")).then(n=>$t.decode(n)).then(n=>JSON.parse(n))}async function Ee(e,t){const{datasets:n}=t[0]||[{path:"0"}],r=await Promise.all(n.map(({path:o})=>e.getItem(o)));if(r.every(o=>o instanceof nt))return r;throw Error("Multiscales metadata included a path to a group.")}function ue(e){e.startsWith("#")&&(e=e.slice(1));const t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),r=parseInt(e.slice(4,6),16);return[t,n,r]}function Z(e){return Array.from({length:e},(t,n)=>n)}function jt(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}function U(...e){return e.filter(Boolean).map(t=>jt(t,"/")).join("/")}function Ft(e,t){return(!t||t.length!=e.shape.length)&&(t=e.shape.slice(0,-2).map((r,o)=>""+o).concat(["y","x"])),t}function ee(e){const t=[{type:"time",name:"t"},{type:"channel",name:"c"},{type:"space",name:"z"},{type:"space",name:"y"},{type:"space",name:"x"}];function n(o){return o==="t"?"time":o==="c"?"channel":"space"}let r=t;return e[0].axes&&(r=e[0].axes.map(o=>{if(typeof o=="string")return{name:o,type:n(o)};const{name:s,type:a}=o;return{name:s,type:a!=null?a:n(s)}})),r}function te(e){return e.map(n=>n.name)}function Re(e,t){return t||(e<=Y?t=Array(e).fill(!0):t=[...Array(Y).fill(!0),...Array(e-Y).fill(!1)]),t}function Oe(e,t){let n=[];if(e==1)n=[j.white];else if(e==2)n=Ot;else if(e===3)n=Mt;else if(e<=Y)n=ze.slice(0,e);else{n=Array(e).fill(j.white);const r=t.flatMap((o,s)=>o?s:[]);for(const[o,s]of r.entries())n[s]=ze[o]}return n}function Me(e){const t=e[e.length-1];return t===3||t===4}function ne(e){const t=Me(e.shape),[n,r]=e.chunks.slice(t?-3:-2),o=Math.min(n,r);return 2**Math.floor(Math.log2(o))}function Nt([e,t],[n,r],o,s){const a=(n-s*2)/e,l=(r-s*2)/t;return{zoom:Math.min(o,Math.log2(Math.min(a,l))),target:[e/2,t/2,0]}}function Tt(e){return Array.isArray(e)?e.length===16&&e.every(t=>typeof t=="number"):!1}function J(e){if(!e)return we.IDENTITY;const t=new we;try{const n=typeof e=="string"?JSON.parse(e):e;if(!Tt(n))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...n)}catch{const n=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(n)}return t}async function he(e,t){if(e.dtype==="Uint8")return[0,255];const{data:n}=await e.getRaster({selection:t});let r=1/0,o=-1/0;for(let s=0;s<n.length;s++)n[s]>o&&(o=n[s]),n[s]<r&&(r=n[s]);return r===o&&(r=0,o=1),[r,o]}async function De(e,t,n,r){const o=r!=null?r:e.shape.map(()=>0);if(e.shape[t]!==n.length)throw new Error("provided visibilities don't match number of channels");return Promise.all(n.map(async(a,l)=>{if(!a)return;const c=[...o];return c[t]=l,he(e,c)}))}async function Vt(e,t,n){var _,R,x,z;const r=e.acquisition?parseInt(e.acquisition):void 0;let o=[];if(!(n==null?void 0:n.images))throw Error("Well .zattrs missing images");if(!t.path)throw Error("Cannot inspect zarr path to open well.");const[s,a]=t.path.split("/").filter(Boolean).slice(-2);let{images:l}=n;const c=l.flatMap(b=>b.acquisition?[b.acquisition]:[]);if(c.length>1){const b=t.path.replace(`${s}/${a}`,""),O=await(await se(t.store,b)).attrs.asObject();o=(R=(_=O==null?void 0:O.plate)==null?void 0:_.acquisitions)!=null?R:[],r&&c.includes(r)&&(l=l.filter(W=>W.acquisition===r))}const d=l.map(b=>b.path),h=Math.ceil(Math.sqrt(d.length)),u=Math.ceil(d.length/h),m=await t.getItem(d[0]).then(b=>b.attrs.asObject());if(!("multiscales"in m))throw Error("Path for image is not valid.");let w=m.multiscales[0].datasets[0].path;const p=d.map(b=>t.getItem(U(b,w))),v=await Promise.all(p),S=ee(m.multiscales),I=te(S),E=ne(v[0]),L=Z(u).flatMap(b=>Z(h).map(A=>{const O=A+b*h;return{name:String(O),row:b,col:A,loader:new K(v[O],I,E)}}));let f;"omero"in m?f=pe(m.omero,S):f=await $e(L[0].loader,I);const y=C(g({loaders:L},f),{axis_labels:I,loader:[L[0].loader],model_matrix:J(e.model_matrix),defaults:{selection:f.defaultSelection,colormap:(x=e.colormap)!=null?x:"",opacity:(z=e.opacity)!=null?z:1},name:`Well ${s}${a}`});return o.length>0&&(y.acquisitions=o,y.acquisitionId=r||-1),y.rows=u,y.columns=h,y.onClick=b=>{let A=b.gridCoord;if(!A)return;const{row:O,column:W}=A;let V;if(typeof e.source=="string"&&t.path&&!isNaN(O)&&!isNaN(W)){const X=O*h+W;V=U(e.source,d[X])}e.onClick?(delete b.layer,b.imageSource=V,e.onClick(b)):V&&window.open(window.location.origin+window.location.pathname+"?source="+V)},y}async function Ae(e,t,n){var _,R;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const r=n.rows.map(x=>x.name),o=n.columns.map(x=>x.name),s=n.wells.map(x=>x.path),a=await Ie(t,s[0]);if(!("well"in a))throw Error("Path for image is not valid, not a well.");const l=a.well.images[0].path,c=await t.getItem(U(s[0],l)).then(x=>x.attrs.asObject());if(!("multiscales"in c))throw Error("Path for image is not valid.");const{datasets:d}=c.multiscales[0],h=d[d.length-1].path;async function u(x){const z=await Ie(t,x);return U(x,z.well.images[0].path)}const m=await Promise.all(s.map(u)),w=([x,z])=>t.getItem(z).then(b=>[x,b]),p=await ge(m.map(x=>[x,U(x,h)]),w,{concurrency:10}),v=await Promise.all(p),S=ee(c.multiscales),I=te(S),E=ne(v[0][1]),L=v.map(x=>{const[z,b]=x[0].split("/");return{name:`${z}${b}`,row:r.indexOf(z),col:o.indexOf(b),loader:new K(x[1],I,E)}});let f;"omero"in c?f=pe(c.omero,S):f=await $e(L[0].loader,I);const y=C(g({loaders:L},f),{axis_labels:I,loader:[L[0].loader],model_matrix:J(e.model_matrix),defaults:{selection:f.defaultSelection,colormap:(_=e.colormap)!=null?_:"",opacity:(R=e.opacity)!=null?R:1},name:n.name||"Plate",rows:r.length,columns:o.length});return y.onClick=x=>{let z=x.gridCoord;if(!z)return;const{row:b,column:A}=z;let O;typeof e.source=="string"&&t.path&&!isNaN(b)&&!isNaN(A)&&(O=U(e.source,r[b],o[A])),e.onClick?(delete x.layer,x.imageSource=O,e.onClick(x)):O&&window.open(window.location.origin+window.location.pathname+"?source="+O)},y}async function Bt(e,t,n){var m;const{name:r,opacity:o=1,colormap:s=""}=e,a=await Ee(t,n.multiscales),l=ee(n.multiscales),c=te(l),d=pe(n.omero,l),h=ne(a[0]),u=a.map(w=>new K(w,c,h));return C(g({loader:u,axis_labels:c,model_matrix:J(e.model_matrix),defaults:{selection:d.defaultSelection,colormap:s,opacity:o}},d),{name:(m=d.name)!=null?m:r})}async function $e(e,t){const n=t.indexOf("c"),r=e.shape[n],o=Re(r),s=await De(e,n,o),a=Oe(r,o);return{name:"Image",names:Z(r).map(l=>`channel_${l}`),colors:a,contrast_limits:s,visibilities:o,channel_axis:t.includes("c")?t.indexOf("c"):null,defaultSelection:t.map(()=>0)}}function pe({rdefs:e,channels:t,name:n},r){var m,w;const o=(m=e.defaultT)!=null?m:0,s=(w=e.defaultZ)!=null?w:0,a=[],l=[],c=[],d=[];t.forEach((p,v)=>{a.push(p.color),l.push([p.window.start,p.window.end]),c.push(p.active),d.push(p.label||""+v)});const h=r.map(p=>p.type=="time"?o:p.name=="z"?s:0),u=r.findIndex(p=>p.type==="channel");return{name:n,names:d,colors:a,contrast_limits:l,visibilities:c,channel_axis:u,defaultSelection:h}}async function Gt(e,t){const{color:n,contrast_limits:r,visibility:o,name:s,colormap:a="",opacity:l=1}=e,c=t[t.length-1],d=Array(t[0].shape.length).fill(0),h=r!=null?r:await(()=>he(c,d))();return{loader:t,name:s,channel_axis:null,colors:[n!=null?n:j.white],names:["channel_0"],contrast_limits:[h],visibilities:[o!=null?o:!0],model_matrix:J(e.model_matrix),defaults:{selection:d,colormap:a,opacity:l},axis_labels:t[0].labels}}async function Wt(e,t,n){const{names:r,contrast_limits:o,name:s,model_matrix:a,opacity:l=1,colormap:c=""}=e;let{visibilities:d,colors:h}=e;const u=t[0].shape[n];for(const w of[o,d,r,h])if(w&&w.length!==u){const p=Object.keys({channelProp:w})[0];throw Error(`channel_axis is length ${u} and provided channel_axis property ${p} is different size.`)}d=d||Re(u),h=h||Oe(u,d);const m=o!=null?o:await(()=>De(t[t.length-1],n,d))();return{loader:t,name:s,channel_axis:n,colors:h,names:r!=null?r:Z(u).map(w=>`channel_${w}`),contrast_limits:m,visibilities:d,model_matrix:J(a),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:c,opacity:l},axis_labels:t[0].labels}}async function qt(e){var h;const t=await At(e.source);let n,r;if(t instanceof rt){const u=await t.attrs.asObject();if("plate"in u)return Ae(e,t,u.plate);if("well"in u)return Vt(e,t,u.well);if("omero"in u)return Bt(e,t,u);if(Object.keys(u).length===0&&t.path){const m=t.path.slice(0,t.path.lastIndexOf("/")),w=await se(t.store,m),p=await w.attrs.asObject();if("plate"in p)return Ae(e,w,p.plate)}if(!("multiscales"in u))throw Error("Group is missing multiscales specification.");n=await Ee(t,u.multiscales),u.multiscales[0].axes&&(r=ee(u.multiscales))}else n=[t];const{channel_axis:o,labels:s}=Ut(e,r,n[0]),a=ne(n[0]),l=n.map(u=>new K(u,s,a)),[c]=l;if("channel_axis"in e||o>-1)return e=e,Wt(e,l,Number((h=e.channel_axis)!=null?h:o));if(c.shape.length===2||!("channel_axis"in e))return Gt(e,l);throw Error("Failed to load image.")}function Ut(e,t,n){const r=e.axis_labels,o="channel_axis"in e?Number(e.channel_axis):void 0;if(t){const l=r!=null?r:te(t),c=o!=null?o:t.findIndex(d=>d.type==="channel");return{labels:l,channel_axis:c}}const s=r!=null?r:Ft(n),a=o!=null?o:s.indexOf("c");return{labels:s,channel_axis:a}}function je(e){var h;const{selection:t,opacity:n,colormap:r}=e.defaults,o=[],s=[],a=[],l=[],c=e.visibilities.flatMap((u,m)=>u?m:[]);for(const u of c){const m=[...t];Number.isInteger(e.channel_axis)&&(m[e.channel_axis]=u),o.push(m),s.push(ue(e.colors[u])),a.push((h=e.contrast_limits[u])!=null?h:[0,255]),l.push(!0)}const d={id:e.id,selections:o,colors:s,contrastLimits:a,contrastLimitsRange:[...a],channelsVisible:l,opacity:n,colormap:r,modelMatrix:e.model_matrix,onClick:e.onClick};return"loaders"in e?{Layer:de,layerProps:C(g({},d),{loader:e.loader,loaders:e.loaders,columns:e.columns,rows:e.rows}),on:!0}:e.loader.length===1?{Layer:st,layerProps:C(g({},d),{loader:e.loader[0]}),on:!0}:{Layer:at,layerProps:C(g({},d),{loader:e.loader}),on:!0}}var Ht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:qt,initLayerStateFromSource:je});const Xt={zoom:0,target:[0,0,0],default:!0},Fe=Q([]),Ne=Q(Xt),Te=it(Fe),Ve=ct(e=>Q(C(g({},je(e)),{id:e.id})),(e,t)=>e.id===t.id),Yt=Q(e=>{const t=e(Te);if(t.length===0)return[];const n=t.map(r=>Ve(e(r)));return e(lt(n))});function Zt(e){const{loader:t}=e,[n,r]=Array.isArray(t)?[t[0],t.length]:[t,0],o=Me(n.shape);let[s,a]=n.shape.slice(o?-3:-2);if("loaders"in e&&e.rows&&e.columns){const l=5;s=(s+l)*e.rows,a=(a+l)*e.columns}return{height:s,width:a,maxZoom:r}}function Jt({layers:e}){var o,s;const[t,n]=F(Ne),r=N.exports.useRef(null);if(r.current&&(t==null?void 0:t.default)&&((s=(o=e[0])==null?void 0:o.props)==null?void 0:s.loader)){const{deck:a}=r.current,{width:l,height:c,maxZoom:d}=Zt(e[0].props),h=a.width<400?10:a.width<600?30:50,{zoom:u,target:m}=Nt([l,c],[a.width,a.height],d,h);n({zoom:u,target:m})}return i(dt,{ref:r,layers:e,viewState:t,onViewStateChange:a=>n(a.viewState),views:[new ut({id:"ortho",controller:!0})]})}function Kt(){const t=D(Yt).map(n=>n.on?new n.Layer(n.layerProps):null);return i(Jt,{layers:t})}function Qt({sourceAtom:e,layerAtom:t}){const n=D(e),[r,o]=F(t),s=a=>{a.stopPropagation(),o(l=>{const c=!l.on;return C(g({},l),{on:c})})};return i(B,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:s,style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${r.on?1:.5})`},children:r.on?i(ht,{}):i(pt,{})})}const en=q({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(mt);function tn({sourceAtom:e,layerAtom:t,name:n}){const o=`layer-controller-${D(e).id}`;return i(en,{"aria-controls":o,id:o,children:P("div",{style:{display:"flex",flexDirection:"row"},children:[i(Qt,{sourceAtom:e,layerAtom:t}),i($,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function nn({sourceAtom:e}){const t=D(e),{acquisitionId:n,acquisitions:r}=t;return r?i(G,{children:i(k,{children:P(ae,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:s=>{let a=s.target.value;const l=new URL(window.location.href);a==="-1"?l.searchParams.delete("acquisition"):l.searchParams.set("acquisition",a),window.location.href=decodeURIComponent(l.href)},value:n,children:[i("option",{value:"-1",children:"Filter by Acquisition"},"-1"),r.map(s=>(s=s,P("option",{value:s.id,children:["Acquisition: ",s.name]},s.id)))]})})}):null}function on({sourceAtom:e,layerAtom:t}){const[n,r]=F(e),[o,s]=F(t),[a,l]=N.exports.useState(null),c=p=>{l(p.currentTarget)},d=()=>{l(null)},h=async p=>{d();const v=+p.target.value,S=[...n.defaults.selection];n.channel_axis&&(S[n.channel_axis]=v);let I;if(n.contrast_limits[v])I=n.contrast_limits[v];else{const{loader:E}=o.layerProps,L=Array.isArray(E)?E[E.length-1]:E;I=await he(L,S),r(f=>{const y=[...f.contrast_limits];return y[v]=I,C(g({},f),{contrast_limits:y})})}s(E=>{const{layerProps:L}=E,f=[...L.selections,S],y=[...L.colors,ue(n.colors[v])],_=[...L.contrastLimitsRange,I],R=[...L.channelsVisible,!0];return C(g({},E),{layerProps:C(g({},L),{selections:f,colors:y,contrastLimits:_,contrastLimitsRange:[..._],channelsVisible:R})})})},{names:u}=n,m=Boolean(a),w=m?`layer-${n.id}-add-channel`:void 0;return P(G,{children:[i(B,{onClick:c,"aria-describedby":w,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:o.layerProps.selections.length===Y,children:i(xe,{})}),i(ie,{id:w,open:m,anchorEl:a,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(le,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[i($,{variant:"caption",children:"selection: "}),i(M,{}),P(ae,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:h,children:[i("option",{"aria-label":"None",value:"",children:"None"}),u.map((p,v)=>i("option",{value:v,children:p},p))]})]})})]})}const rn=q({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(ce);function sn({layerAtom:e}){const[t,n]=F(e),r=(o,s)=>{const a=s;n(l=>C(g({},l),{layerProps:C(g({},l.layerProps),{opacity:a})}))};return i(rn,{value:t.layerProps.opacity,onChange:r,min:0,max:1,step:.01})}const an=q({root:{width:"5.5em",fontSize:"0.7em"}})(be);function ln({sourceAtom:e,layerAtom:t,axisIndex:n,max:r}){const o=D(e),[s,a]=F(t),[l,c]=N.exports.useState(null),d=v=>{c(v.currentTarget)},h=()=>{c(null)},u=v=>{let S=+v.target.value;S<0&&(S=0),S>r&&(S=r),a(I=>{let E=g({},I.layerProps);return E.selections=E.selections.map(L=>{let f=[...L];return f[n]=S,f}),C(g({},I),{layerProps:E})})},m=Boolean(l),w=m?`${n}-index-${o.id}-options`:void 0,p=s.layerProps.selections[0]?s.layerProps.selections[0][n]:1;return P(G,{children:[i(B,{onClick:d,"aria-describedby":w,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:i(Ce,{})}),i(ie,{id:w,open:m,anchorEl:l,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(le,{style:{padding:"0px 4px",marginBottom:4},children:[i($,{variant:"caption",children:"Index:"}),i(M,{}),i(an,{value:p,onChange:u,type:"number",id:"max",fullWidth:!1}),i(M,{})]})})]})}const cn=q({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(ce);function dn({sourceAtom:e,layerAtom:t,axisIndex:n,max:r}){const[o,s]=F(t),a=D(e),{axis_labels:l}=a;let c=l[n];(c==="t"||c==="z")&&(c=c.toUpperCase());const[d,h]=N.exports.useState(0);return N.exports.useEffect(()=>{h(o.layerProps.selections[0]?o.layerProps.selections[0][n]:1)},[o.layerProps.selections]),P(G,{children:[P(k,{children:[P(k,{container:!0,justifyContent:"space-between",children:[i(k,{item:!0,xs:10,children:i("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:P($,{variant:"caption",noWrap:!0,children:[c,": ",d,"/",r]})})}),i(k,{item:!0,xs:1,children:i(ln,{sourceAtom:e,layerAtom:t,axisIndex:n,max:r})})]}),i(k,{container:!0,justifyContent:"space-between",children:i(k,{item:!0,xs:12,children:i(cn,{value:d,onChange:(w,p)=>{h(p)},onChangeCommitted:()=>{s(w=>{let p=g({},w.layerProps);return p.selections=p.selections.map(v=>{let S=[...v];return S[n]=d,S}),C(g({},w),{layerProps:p})})},min:0,max:r,step:1})})})]}),i(M,{})]})}function un({sourceAtom:e,layerAtom:t}){const n=D(e),{axis_labels:r,channel_axis:o,loader:s}=n,a=r.slice(0,-2).map((l,c)=>[l,c,s[0].shape[c]]).filter(l=>l[1]===o?!1:l[2]>1).map(([l,c,d])=>i(dn,{sourceAtom:e,layerAtom:t,axisIndex:c,max:d-1},l));return a.length===0?null:P(G,{children:[i(k,{children:a}),i(M,{})]})}const hn=ve(()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}})),pn=Object.entries(j).map(([e,t])=>[e,ue(t)]);function mn({handleChange:e}){const t=hn();return i("div",{className:t.container,"aria-label":"color-swatch",children:pn.map(([n,r])=>i(B,{className:t.button,onClick:()=>e(r),children:i(ft,{fontSize:"small",style:{color:`rgb(${r})`}})},n))})}const Be=q({root:{width:"5.5em",fontSize:"0.7em"}})(be);function fn({sourceAtom:e,layerAtom:t,channelIndex:n}){const r=D(e),[o,s]=F(t),[a,l]=N.exports.useState(null),{channel_axis:c,names:d}=r,h=f=>{l(f.currentTarget)},u=()=>{l(null)},m=f=>{s(y=>{const _=[...y.layerProps.colors];return _[n]=f,C(g({},y),{layerProps:C(g({},y.layerProps),{colors:_})})})},w=f=>{const y=f.target.id;let _=+f.target.value;_<0&&(_=0),s(R=>{const x=[...R.layerProps.contrastLimitsRange],z=[...R.layerProps.contrastLimits],[b,A]=x[n],[O,W]=z[n],[V,X]=y==="min"?[_,A]:[b,_];return V>O&&(z[n]=[V,W]),X<W&&(z[n]=[O,X]),z[n]=[V,X],C(g({},R),{layerProps:C(g({},R.layerProps),{contrastLimits:z,contrastLimitsRange:x})})})},p=()=>{s(f=>{const{layerProps:y}=f,_=[...y.colors],R=[...y.contrastLimits],x=[...y.contrastLimitsRange],z=[...y.selections],b=[...y.channelsVisible];return _.splice(n,1),R.splice(n,1),x.splice(n,1),z.splice(n,1),b.splice(n,1),C(g({},f),{layerProps:C(g({},y),{colors:_,selections:z,channelsVisible:b,contrastLimits:R,contrastLimitsRange:x})})})},v=f=>{s(y=>{const _=[...y.layerProps.selections],R=[..._[n]];return Number.isInteger(c)&&(R[c]=+f.target.value,_[n]=R),C(g({},y),{layerProps:C(g({},y.layerProps),{selections:_})})})},S=Boolean(a),I=S?`channel-${n}-${r.name}-options`:void 0,[E,L]=o.layerProps.contrastLimitsRange[n];return P(G,{children:[i(B,{onClick:h,"aria-describedby":I,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:i(Ce,{})}),i(ie,{id:I,open:S,anchorEl:a,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(le,{style:{padding:"0px 4px",marginBottom:4},children:[P("div",{style:{display:"flex",justifyContent:"space-between"},children:[i($,{variant:"caption",children:"remove:"}),i(B,{onClick:p,children:i(_e,{})})]}),i(M,{}),i($,{variant:"caption",children:"selection:"}),i(M,{}),i(ae,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${r.name}-channel-select`,onChange:v,value:o.layerProps.selections[n][c],children:d.map((f,y)=>P("option",{value:y,children:["(",y,") ",f]},f))}),i(M,{}),i($,{variant:"caption",children:"contrast limits:"}),i(M,{}),i(Be,{value:E,onChange:w,type:"number",id:"min",fullWidth:!1}),i(Be,{value:L,onChange:w,type:"number",id:"max",fullWidth:!1}),i(M,{}),i($,{variant:"caption",children:"color:"}),i(M,{}),i("div",{style:{display:"flex",justifyContent:"center"},children:i(mn,{handleChange:m})})]})})]})}function yn({sourceAtom:e,layerAtom:t,channelIndex:n}){const r=D(e),[o,s]=F(t),a=(L,f)=>{s(y=>{const _=[...y.layerProps.contrastLimits];return _[n]=f,C(g({},y),{layerProps:C(g({},y.layerProps),{contrastLimits:_})})})},l=()=>{s(L=>{const f=[...L.layerProps.channelsVisible];return f[n]=!f[n],C(g({},L),{layerProps:C(g({},L.layerProps),{channelsVisible:f})})})},c=o.layerProps,d=[...c.contrastLimits[n]],h=`rgb(${c.colormap?[255,255,255]:c.colors[n]})`,u=c.channelsVisible[n],[m,w]=c.contrastLimitsRange[n],{channel_axis:p,names:v}=r,S=c.selections[n],I=Number.isInteger(p)?S[p]:0,E=v[I];return P(G,{children:[P(k,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[i(k,{item:!0,xs:10,children:i("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:i($,{variant:"caption",noWrap:!0,children:E})})}),i(k,{item:!0,xs:1,children:i(fn,{sourceAtom:e,layerAtom:t,channelIndex:n})})]}),P(k,{container:!0,justifyContent:"space-between",children:[i(k,{item:!0,xs:2,children:i(B,{style:{color:h,backgroundColor:"transparent",padding:0,zIndex:2},onClick:l,children:u?i(yt,{}):i(gt,{})})}),i(k,{item:!0,xs:10,children:i(ce,{value:d,onChange:a,min:m,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:h}})})]})]})}const gn=q({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(wt);function wn({sourceAtom:e,layerAtom:t}){const r=D(t).layerProps.selections.length;return i(gn,{children:P(k,{container:!0,direction:"column",children:[i(nn,{sourceAtom:e,layerAtom:t}),i(k,{children:P(k,{container:!0,justifyContent:"space-between",children:[i(k,{item:!0,xs:3,children:i($,{variant:"caption",children:"opacity:"})}),i(k,{item:!0,xs:8,children:i(sn,{sourceAtom:e,layerAtom:t})})]})}),i(M,{}),i(un,{sourceAtom:e,layerAtom:t}),P(k,{container:!0,justifyContent:"space-between",children:[i(k,{item:!0,xs:3,children:i($,{variant:"caption",children:"channels:"})}),i(k,{item:!0,xs:1,children:i(on,{sourceAtom:e,layerAtom:t})})]}),i(M,{}),i(k,{children:Z(r).map(o=>i(yn,{sourceAtom:e,layerAtom:t,channelIndex:o},o))})]})})}const xn=q({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(xt);function bn({sourceAtom:e}){const t=D(e),n=Ve(t),{name:r=""}=t;return P(xn,{defaultExpanded:!0,children:[i(tn,{sourceAtom:e,layerAtom:n,name:r}),i(wn,{sourceAtom:e,layerAtom:n})]})}const Cn=ve({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function vn(){const e=D(Te),[t,n]=N.exports.useReducer(o=>!o,!1),r=Cn();return i("div",{className:r.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:P(k,{container:!0,direction:"column",alignItems:"flex-start",children:[i(B,{style:{backgroundColor:"transparent",padding:0},onClick:n,children:t?i(xe,{}):i(_e,{})}),i("div",{className:r.scroll,style:{display:t?"none":"flex"},children:e.map(o=>i(bn,{sourceAtom:o},`${o}`))})]})})}const Ge="0.3.0";function _n(){const e=Pe(Fe),t=Pe(Ne);async function n(r){const{createSourceData:o}=await T(()=>Promise.resolve().then(function(){return Ht}),void 0),s=Math.random().toString(36).slice(2),a=await o(r);e(l=>(a.name||(a.name=`image_${Object.keys(l).length}`),[...l,g({id:s},a)]))}return N.exports.useEffect(()=>{const r=new URLSearchParams(window.location.search);if(r.has("source")){const o={};for(const[l,c]of r)o[l]=c;o.source=decodeURIComponent(o.source),n(o);const s=new URL(window.location.href);s.searchParams.set("source",o.source);const a=decodeURIComponent(s.toString());window.location.href!==a&&window.history.pushState(null,"",a)}},[]),N.exports.useEffect(()=>{async function r(){const{imjoyRPC:o}=await T(()=>import("./index.326d27d5.js").then(function(c){return c.i}),[]),s=await o.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:Ge}),a=async c=>n(c),l=async c=>t(c);s.export({add_image:a,set_view_state:l})}window.self!==window.top&&r()},[]),P(G,{children:[i(vn,{}),i(Kt,{})]})}var Pn=bt({palette:{type:"dark",primary:Se,secondary:Se},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const oe=new Map;function H(e,t){Ct(e,()=>{if(!oe.has(e)){const r=t().then(o=>o.default).catch(o=>{throw oe.delete(e),o});oe.set(e,r)}return oe.get(e)})}H("lz4",()=>T(()=>import("./lz4.87389b44.js"),[]));H("gzip",()=>T(()=>import("./gzip.87321722.js"),["gzip.87321722.js","pako.esm-856454b6.df899be9.js"]));H("zlib",()=>T(()=>import("./zlib.c77211ff.js"),["zlib.c77211ff.js","pako.esm-856454b6.df899be9.js"]));H("zstd",()=>T(()=>import("./zstd.d76669c6.js"),[]));H("blosc",()=>T(()=>import("./blosc.4ec40f1c.js"),[]));H("jpeg2k",()=>T(()=>import("./jpeg2k.effd323e.js"),[]));console.log(`vizarr v${Ge}: https://github.com/hms-dbmi/vizarr`);vt.render(i(_t,{theme:Pn,children:i(Pt,{children:i(_n,{})})}),document.getElementById("root"));
