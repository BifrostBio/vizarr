var eS=Object.defineProperty;var tS=(t,e,n)=>e in t?eS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var xI=(t,e,n)=>(tS(t,typeof e!="symbol"?e+"":e,n),n);const nS=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const g of s)if(g.type==="childList")for(const o of g.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const g={};return s.integrity&&(g.integrity=s.integrity),s.referrerpolicy&&(g.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?g.credentials="include":s.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function i(s){if(s.ep)return;s.ep=!0;const g=n(s);fetch(s.href,g)}};nS();function Fv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Sv(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}),n}var Z={exports:{}},Re={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var of=Object.getOwnPropertySymbols,iS=Object.prototype.hasOwnProperty,sS=Object.prototype.propertyIsEnumerable;function gS(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function oS(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var i=Object.getOwnPropertyNames(e).map(function(g){return e[g]});if(i.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(g){s[g]=g}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Vv=oS()?Object.assign:function(t,e){for(var n,i=gS(t),s,g=1;g<arguments.length;g++){n=Object(arguments[g]);for(var o in n)iS.call(n,o)&&(i[o]=n[o]);if(of){s=of(n);for(var r=0;r<s.length;r++)sS.call(n,s[r])&&(i[s[r]]=n[s[r]])}}return i};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0=Vv,Ho=60103,Uv=60106;Re.Fragment=60107;Re.StrictMode=60108;Re.Profiler=60114;var xv=60109,Wv=60110,wv=60112;Re.Suspense=60113;var Nv=60115,Tv=60116;if(typeof Symbol=="function"&&Symbol.for){var Qn=Symbol.for;Ho=Qn("react.element"),Uv=Qn("react.portal"),Re.Fragment=Qn("react.fragment"),Re.StrictMode=Qn("react.strict_mode"),Re.Profiler=Qn("react.profiler"),xv=Qn("react.provider"),Wv=Qn("react.context"),wv=Qn("react.forward_ref"),Re.Suspense=Qn("react.suspense"),Nv=Qn("react.memo"),Tv=Qn("react.lazy")}var rf=typeof Symbol=="function"&&Symbol.iterator;function rS(t){return t===null||typeof t!="object"?null:(t=rf&&t[rf]||t["@@iterator"],typeof t=="function"?t:null)}function Ka(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ev={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Qv={};function ko(t,e,n){this.props=t,this.context=e,this.refs=Qv,this.updater=n||Ev}ko.prototype.isReactComponent={};ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(Ka(85));this.updater.enqueueSetState(this,t,e,"setState")};ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Xv(){}Xv.prototype=ko.prototype;function Z0(t,e,n){this.props=t,this.context=e,this.refs=Qv,this.updater=n||Ev}var R0=Z0.prototype=new Xv;R0.constructor=Z0;G0(R0,ko.prototype);R0.isPureReactComponent=!0;var F0={current:null},Yv=Object.prototype.hasOwnProperty,_v={key:!0,ref:!0,__self:!0,__source:!0};function Hv(t,e,n){var i,s={},g=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(g=""+e.key),e)Yv.call(e,i)&&!_v.hasOwnProperty(i)&&(s[i]=e[i]);var r=arguments.length-2;if(r===1)s.children=n;else if(1<r){for(var a=Array(r),I=0;I<r;I++)a[I]=arguments[I+2];s.children=a}if(t&&t.defaultProps)for(i in r=t.defaultProps,r)s[i]===void 0&&(s[i]=r[i]);return{$$typeof:Ho,type:t,key:g,ref:o,props:s,_owner:F0.current}}function aS(t,e){return{$$typeof:Ho,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function S0(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ho}function IS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var af=/\/+/g;function nA(t,e){return typeof t=="object"&&t!==null&&t.key!=null?IS(""+t.key):e.toString(36)}function yl(t,e,n,i,s){var g=typeof t;(g==="undefined"||g==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(g){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ho:case Uv:o=!0}}if(o)return o=t,s=s(o),t=i===""?"."+nA(o,0):i,Array.isArray(s)?(n="",t!=null&&(n=t.replace(af,"$&/")+"/"),yl(s,e,n,"",function(I){return I})):s!=null&&(S0(s)&&(s=aS(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(af,"$&/")+"/")+t)),e.push(s)),1;if(o=0,i=i===""?".":i+":",Array.isArray(t))for(var r=0;r<t.length;r++){g=t[r];var a=i+nA(g,r);o+=yl(g,e,n,a,s)}else if(a=rS(t),typeof a=="function")for(t=a.call(t),r=0;!(g=t.next()).done;)g=g.value,a=i+nA(g,r++),o+=yl(g,e,n,a,s);else if(g==="object")throw e=""+t,Error(Ka(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e));return o}function WI(t,e,n){if(t==null)return t;var i=[],s=0;return yl(t,i,"","",function(g){return e.call(n,g,s++)}),i}function lS(t){if(t._status===-1){var e=t._result;e=e(),t._status=0,t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}if(t._status===1)return t._result;throw t._result}var kv={current:null};function Hi(){var t=kv.current;if(t===null)throw Error(Ka(321));return t}var CS={ReactCurrentDispatcher:kv,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:F0,IsSomeRendererActing:{current:!1},assign:G0};Re.Children={map:WI,forEach:function(t,e,n){WI(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return WI(t,function(){e++}),e},toArray:function(t){return WI(t,function(e){return e})||[]},only:function(t){if(!S0(t))throw Error(Ka(143));return t}};Re.Component=ko;Re.PureComponent=Z0;Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CS;Re.cloneElement=function(t,e,n){if(t==null)throw Error(Ka(267,t));var i=G0({},t.props),s=t.key,g=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(g=e.ref,o=F0.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var r=t.type.defaultProps;for(a in e)Yv.call(e,a)&&!_v.hasOwnProperty(a)&&(i[a]=e[a]===void 0&&r!==void 0?r[a]:e[a])}var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){r=Array(a);for(var I=0;I<a;I++)r[I]=arguments[I+2];i.children=r}return{$$typeof:Ho,type:t.type,key:s,ref:g,props:i,_owner:o}};Re.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:Wv,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:xv,_context:t},t.Consumer=t};Re.createElement=Hv;Re.createFactory=function(t){var e=Hv.bind(null,t);return e.type=t,e};Re.createRef=function(){return{current:null}};Re.forwardRef=function(t){return{$$typeof:wv,render:t}};Re.isValidElement=S0;Re.lazy=function(t){return{$$typeof:Tv,_payload:{_status:-1,_result:t},_init:lS}};Re.memo=function(t,e){return{$$typeof:Nv,type:t,compare:e===void 0?null:e}};Re.useCallback=function(t,e){return Hi().useCallback(t,e)};Re.useContext=function(t,e){return Hi().useContext(t,e)};Re.useDebugValue=function(){};Re.useEffect=function(t,e){return Hi().useEffect(t,e)};Re.useImperativeHandle=function(t,e,n){return Hi().useImperativeHandle(t,e,n)};Re.useLayoutEffect=function(t,e){return Hi().useLayoutEffect(t,e)};Re.useMemo=function(t,e){return Hi().useMemo(t,e)};Re.useReducer=function(t,e,n){return Hi().useReducer(t,e,n)};Re.useRef=function(t){return Hi().useRef(t)};Re.useState=function(t){return Hi().useState(t)};Re.version="17.0.2";(function(t){t.exports=Re})(Z);const Ne=Fv(Z.exports);var ki={exports:{}},Sn={},Kv={exports:{}},Lv={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,i,s;if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;t.unstable_now=function(){return g.now()}}else{var o=Date,r=o.now();t.unstable_now=function(){return o.now()-r}}if(typeof window>"u"||typeof MessageChannel!="function"){var a=null,I=null,l=function(){if(a!==null)try{var S=t.unstable_now();a(!0,S),a=null}catch(w){throw setTimeout(l,0),w}};e=function(S){a!==null?setTimeout(e,0,S):(a=S,setTimeout(l,0))},n=function(S,w){I=setTimeout(S,w)},i=function(){clearTimeout(I)},t.unstable_shouldYield=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var C=window.setTimeout,c=window.clearTimeout;if(typeof console<"u"){var A=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof A!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var d=!1,h=null,u=-1,m=5,f=0;t.unstable_shouldYield=function(){return t.unstable_now()>=f},s=function(){},t.unstable_forceFrameRate=function(S){0>S||125<S?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m=0<S?Math.floor(1e3/S):5};var p=new MessageChannel,B=p.port2;p.port1.onmessage=function(){if(h!==null){var S=t.unstable_now();f=S+m;try{h(!0,S)?B.postMessage(null):(d=!1,h=null)}catch(w){throw B.postMessage(null),w}}else d=!1},e=function(S){h=S,d||(d=!0,B.postMessage(null))},n=function(S,w){u=C(function(){S(t.unstable_now())},w)},i=function(){c(u),u=-1}}function G(S,w){var T=S.length;S.push(w);e:for(;;){var Y=T-1>>>1,Q=S[Y];if(Q!==void 0&&0<V(Q,w))S[Y]=w,S[T]=Q,T=Y;else break e}}function y(S){return S=S[0],S===void 0?null:S}function U(S){var w=S[0];if(w!==void 0){var T=S.pop();if(T!==w){S[0]=T;e:for(var Y=0,Q=S.length;Y<Q;){var _=2*(Y+1)-1,D=S[_],ge=_+1,te=S[ge];if(D!==void 0&&0>V(D,T))te!==void 0&&0>V(te,D)?(S[Y]=te,S[ge]=T,Y=ge):(S[Y]=D,S[_]=T,Y=_);else if(te!==void 0&&0>V(te,T))S[Y]=te,S[ge]=T,Y=ge;else break e}}return w}return null}function V(S,w){var T=S.sortIndex-w.sortIndex;return T!==0?T:S.id-w.id}var F=[],W=[],M=1,E=null,H=3,P=!1,z=!1,re=!1;function ue(S){for(var w=y(W);w!==null;){if(w.callback===null)U(W);else if(w.startTime<=S)U(W),w.sortIndex=w.expirationTime,G(F,w);else break;w=y(W)}}function ie(S){if(re=!1,ue(S),!z)if(y(F)!==null)z=!0,e(ce);else{var w=y(W);w!==null&&n(ie,w.startTime-S)}}function ce(S,w){z=!1,re&&(re=!1,i()),P=!0;var T=H;try{for(ue(w),E=y(F);E!==null&&(!(E.expirationTime>w)||S&&!t.unstable_shouldYield());){var Y=E.callback;if(typeof Y=="function"){E.callback=null,H=E.priorityLevel;var Q=Y(E.expirationTime<=w);w=t.unstable_now(),typeof Q=="function"?E.callback=Q:E===y(F)&&U(F),ue(w)}else U(F);E=y(F)}if(E!==null)var _=!0;else{var D=y(W);D!==null&&n(ie,D.startTime-w),_=!1}return _}finally{E=null,H=T,P=!1}}var x=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(S){S.callback=null},t.unstable_continueExecution=function(){z||P||(z=!0,e(ce))},t.unstable_getCurrentPriorityLevel=function(){return H},t.unstable_getFirstCallbackNode=function(){return y(F)},t.unstable_next=function(S){switch(H){case 1:case 2:case 3:var w=3;break;default:w=H}var T=H;H=w;try{return S()}finally{H=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=x,t.unstable_runWithPriority=function(S,w){switch(S){case 1:case 2:case 3:case 4:case 5:break;default:S=3}var T=H;H=S;try{return w()}finally{H=T}},t.unstable_scheduleCallback=function(S,w,T){var Y=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?Y+T:Y):T=Y,S){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=T+Q,S={id:M++,callback:w,priorityLevel:S,startTime:T,expirationTime:Q,sortIndex:-1},T>Y?(S.sortIndex=T,G(W,S),y(F)===null&&S===y(W)&&(re?i():re=!0,n(ie,T-Y))):(S.sortIndex=Q,G(F,S),z||P||(z=!0,e(ce))),S},t.unstable_wrapCallback=function(S){var w=H;return function(){var T=H;H=w;try{return S.apply(this,arguments)}finally{H=T}}}})(Lv);(function(t){t.exports=Lv})(Kv);/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JC=Z.exports,je=Vv,ft=Kv.exports;function J(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!JC)throw Error(J(227));var Mv=new Set,ua={};function Zg(t,e){Fo(t,e),Fo(t+"Capture",e)}function Fo(t,e){for(ua[t]=e,t=0;t<e.length;t++)Mv.add(e[t])}var Ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,If=Object.prototype.hasOwnProperty,lf={},Cf={};function AS(t){return If.call(Cf,t)?!0:If.call(lf,t)?!1:cS.test(t)?Cf[t]=!0:(lf[t]=!0,!1)}function dS(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function uS(t,e,n,i){if(e===null||typeof e>"u"||dS(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Jt(t,e,n,i,s,g,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=g,this.removeEmptyString=o}var St={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){St[t]=new Jt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];St[e]=new Jt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){St[t]=new Jt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){St[t]=new Jt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){St[t]=new Jt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){St[t]=new Jt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){St[t]=new Jt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){St[t]=new Jt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){St[t]=new Jt(t,5,!1,t.toLowerCase(),null,!1,!1)});var V0=/[\-:]([a-z])/g;function U0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(V0,U0);St[e]=new Jt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(V0,U0);St[e]=new Jt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(V0,U0);St[e]=new Jt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){St[t]=new Jt(t,1,!1,t.toLowerCase(),null,!1,!1)});St.xlinkHref=new Jt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){St[t]=new Jt(t,1,!1,t.toLowerCase(),null,!0,!0)});function x0(t,e,n,i){var s=St.hasOwnProperty(e)?St[e]:null,g=s!==null?s.type===0:i?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");g||(uS(e,n,s,i)&&(n=null),i||s===null?AS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,i=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Rg=JC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wr=60103,ng=60106,ss=60107,W0=60108,Mr=60114,w0=60109,N0=60110,DC=60112,Pr=60113,Ol=60120,zC=60115,T0=60116,E0=60121,Q0=60128,Pv=60129,X0=60130,Wd=60131;if(typeof Symbol=="function"&&Symbol.for){var ut=Symbol.for;wr=ut("react.element"),ng=ut("react.portal"),ss=ut("react.fragment"),W0=ut("react.strict_mode"),Mr=ut("react.profiler"),w0=ut("react.provider"),N0=ut("react.context"),DC=ut("react.forward_ref"),Pr=ut("react.suspense"),Ol=ut("react.suspense_list"),zC=ut("react.memo"),T0=ut("react.lazy"),E0=ut("react.block"),ut("react.scope"),Q0=ut("react.opaque.id"),Pv=ut("react.debug_trace_mode"),X0=ut("react.offscreen"),Wd=ut("react.legacy_hidden")}var cf=typeof Symbol=="function"&&Symbol.iterator;function cr(t){return t===null||typeof t!="object"?null:(t=cf&&t[cf]||t["@@iterator"],typeof t=="function"?t:null)}var iA;function Nr(t){if(iA===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);iA=e&&e[1]||""}return`
`+iA+t}var sA=!1;function wI(t,e){if(!t||sA)return"";sA=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(a){var i=a}Reflect.construct(t,[],e)}else{try{e.call()}catch(a){i=a}t.call(e.prototype)}else{try{throw Error()}catch(a){i=a}t()}}catch(a){if(a&&i&&typeof a.stack=="string"){for(var s=a.stack.split(`
`),g=i.stack.split(`
`),o=s.length-1,r=g.length-1;1<=o&&0<=r&&s[o]!==g[r];)r--;for(;1<=o&&0<=r;o--,r--)if(s[o]!==g[r]){if(o!==1||r!==1)do if(o--,r--,0>r||s[o]!==g[r])return`
`+s[o].replace(" at new "," at ");while(1<=o&&0<=r);break}}}finally{sA=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Nr(t):""}function hS(t){switch(t.tag){case 5:return Nr(t.type);case 16:return Nr("Lazy");case 13:return Nr("Suspense");case 19:return Nr("SuspenseList");case 0:case 2:case 15:return t=wI(t.type,!1),t;case 11:return t=wI(t.type.render,!1),t;case 22:return t=wI(t.type._render,!1),t;case 1:return t=wI(t.type,!0),t;default:return""}}function co(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ss:return"Fragment";case ng:return"Portal";case Mr:return"Profiler";case W0:return"StrictMode";case Pr:return"Suspense";case Ol:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case N0:return(t.displayName||"Context")+".Consumer";case w0:return(t._context.displayName||"Context")+".Provider";case DC:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case zC:return co(t.type);case E0:return co(t._render);case T0:e=t._payload,t=t._init;try{return co(t(e))}catch{}}return null}function vs(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function Jv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mS(t){var e=Jv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,g=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){i=""+o,g.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function NI(t){t._valueTracker||(t._valueTracker=mS(t))}function Dv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Jv(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function jl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function wd(t,e){var n=e.checked;return je({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function Af(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=vs(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function zv(t,e){e=e.checked,e!=null&&x0(t,"checked",e,!1)}function Nd(t,e){zv(t,e);var n=vs(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Td(t,e.type,n):e.hasOwnProperty("defaultValue")&&Td(t,e.type,vs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function df(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Td(t,e,n){(e!=="number"||jl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function fS(t){var e="";return JC.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function Ed(t,e){return t=je({children:void 0},e),(e=fS(e.children))&&(t.children=e),t}function Ao(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+vs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Qd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return je({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function uf(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(J(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(J(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:vs(n)}}function Ov(t,e){var n=vs(e.value),i=vs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function hf(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var Xd={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function jv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?jv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var TI,qv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,s)})}:t}(function(t,e){if(t.namespaceURI!==Xd.svg||"innerHTML"in t)t.innerHTML=e;else{for(TI=TI||document.createElement("div"),TI.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=TI.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ha(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Jr={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pS=["Webkit","ms","Moz","O"];Object.keys(Jr).forEach(function(t){pS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Jr[e]=Jr[t]})});function $v(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Jr.hasOwnProperty(t)&&Jr[t]?(""+e).trim():e+"px"}function eG(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,s=$v(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,s):t[n]=s}}var BS=je({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _d(t,e){if(e){if(BS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function Hd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Y0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var kd=null,uo=null,ho=null;function mf(t){if(t=Ma(t)){if(typeof kd!="function")throw Error(J(280));var e=t.stateNode;e&&(e=tc(e),kd(t.stateNode,t.type,e))}}function tG(t){uo?ho?ho.push(t):ho=[t]:uo=t}function nG(){if(uo){var t=uo,e=ho;if(ho=uo=null,mf(t),e)for(t=0;t<e.length;t++)mf(e[t])}}function _0(t,e){return t(e)}function iG(t,e,n,i,s){return t(e,n,i,s)}function H0(){}var sG=_0,ig=!1,gA=!1;function k0(){(uo!==null||ho!==null)&&(H0(),nG())}function bS(t,e,n){if(gA)return t(e,n);gA=!0;try{return sG(t,e,n)}finally{gA=!1,k0()}}function ma(t,e){var n=t.stateNode;if(n===null)return null;var i=tc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(J(231,e,typeof n));return n}var Kd=!1;if(Ni)try{var Ar={};Object.defineProperty(Ar,"passive",{get:function(){Kd=!0}}),window.addEventListener("test",Ar,Ar),window.removeEventListener("test",Ar,Ar)}catch{Kd=!1}function yS(t,e,n,i,s,g,o,r,a){var I=Array.prototype.slice.call(arguments,3);try{e.apply(n,I)}catch(l){this.onError(l)}}var Dr=!1,ql=null,$l=!1,Ld=null,vS={onError:function(t){Dr=!0,ql=t}};function GS(t,e,n,i,s,g,o,r,a){Dr=!1,ql=null,yS.apply(vS,arguments)}function ZS(t,e,n,i,s,g,o,r,a){if(GS.apply(this,arguments),Dr){if(Dr){var I=ql;Dr=!1,ql=null}else throw Error(J(198));$l||($l=!0,Ld=I)}}function Fg(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&1026)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gG(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ff(t){if(Fg(t)!==t)throw Error(J(188))}function RS(t){var e=t.alternate;if(!e){if(e=Fg(t),e===null)throw Error(J(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(s===null)break;var g=s.alternate;if(g===null){if(i=s.return,i!==null){n=i;continue}break}if(s.child===g.child){for(g=s.child;g;){if(g===n)return ff(s),t;if(g===i)return ff(s),e;g=g.sibling}throw Error(J(188))}if(n.return!==i.return)n=s,i=g;else{for(var o=!1,r=s.child;r;){if(r===n){o=!0,n=s,i=g;break}if(r===i){o=!0,i=s,n=g;break}r=r.sibling}if(!o){for(r=g.child;r;){if(r===n){o=!0,n=g,i=s;break}if(r===i){o=!0,i=g,n=s;break}r=r.sibling}if(!o)throw Error(J(189))}}if(n.alternate!==i)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?t:e}function oG(t){if(t=RS(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function pf(t,e){for(var n=t.alternate;e!==null;){if(e===t||e===n)return!0;e=e.return}return!1}var rG,K0,aG,IG,Md=!1,ii=[],ls=null,Cs=null,cs=null,fa=new Map,pa=new Map,dr=[],Bf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pd(t,e,n,i,s){return{blockedOn:t,domEventName:e,eventSystemFlags:n|16,nativeEvent:s,targetContainers:[i]}}function bf(t,e){switch(t){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":Cs=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":fa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pa.delete(e.pointerId)}}function ur(t,e,n,i,s,g){return t===null||t.nativeEvent!==g?(t=Pd(e,n,i,s,g),e!==null&&(e=Ma(e),e!==null&&K0(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function FS(t,e,n,i,s){switch(e){case"focusin":return ls=ur(ls,t,e,n,i,s),!0;case"dragenter":return Cs=ur(Cs,t,e,n,i,s),!0;case"mouseover":return cs=ur(cs,t,e,n,i,s),!0;case"pointerover":var g=s.pointerId;return fa.set(g,ur(fa.get(g)||null,t,e,n,i,s)),!0;case"gotpointercapture":return g=s.pointerId,pa.set(g,ur(pa.get(g)||null,t,e,n,i,s)),!0}return!1}function SS(t){var e=sg(t.target);if(e!==null){var n=Fg(e);if(n!==null){if(e=n.tag,e===13){if(e=gG(n),e!==null){t.blockedOn=e,IG(t.lanePriority,function(){ft.unstable_runWithPriority(t.priority,function(){aG(n)})});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function vl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=J0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null)return e=Ma(n),e!==null&&K0(e),t.blockedOn=n,!1;e.shift()}return!0}function yf(t,e,n){vl(t)&&n.delete(e)}function VS(){for(Md=!1;0<ii.length;){var t=ii[0];if(t.blockedOn!==null){t=Ma(t.blockedOn),t!==null&&rG(t);break}for(var e=t.targetContainers;0<e.length;){var n=J0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null){t.blockedOn=n;break}e.shift()}t.blockedOn===null&&ii.shift()}ls!==null&&vl(ls)&&(ls=null),Cs!==null&&vl(Cs)&&(Cs=null),cs!==null&&vl(cs)&&(cs=null),fa.forEach(yf),pa.forEach(yf)}function hr(t,e){t.blockedOn===e&&(t.blockedOn=null,Md||(Md=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,VS)))}function lG(t){function e(s){return hr(s,t)}if(0<ii.length){hr(ii[0],t);for(var n=1;n<ii.length;n++){var i=ii[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ls!==null&&hr(ls,t),Cs!==null&&hr(Cs,t),cs!==null&&hr(cs,t),fa.forEach(e),pa.forEach(e),n=0;n<dr.length;n++)i=dr[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<dr.length&&(n=dr[0],n.blockedOn===null);)SS(n),n.blockedOn===null&&dr.shift()}function EI(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $g={animationend:EI("Animation","AnimationEnd"),animationiteration:EI("Animation","AnimationIteration"),animationstart:EI("Animation","AnimationStart"),transitionend:EI("Transition","TransitionEnd")},oA={},CG={};Ni&&(CG=document.createElement("div").style,"AnimationEvent"in window||(delete $g.animationend.animation,delete $g.animationiteration.animation,delete $g.animationstart.animation),"TransitionEvent"in window||delete $g.transitionend.transition);function OC(t){if(oA[t])return oA[t];if(!$g[t])return t;var e=$g[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in CG)return oA[t]=e[n];return t}var cG=OC("animationend"),AG=OC("animationiteration"),dG=OC("animationstart"),uG=OC("transitionend"),hG=new Map,L0=new Map,US=["abort","abort",cG,"animationEnd",AG,"animationIteration",dG,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",uG,"transitionEnd","waiting","waiting"];function M0(t,e){for(var n=0;n<t.length;n+=2){var i=t[n],s=t[n+1];s="on"+(s[0].toUpperCase()+s.slice(1)),L0.set(i,e),hG.set(i,s),Zg(s,[i])}}var xS=ft.unstable_now;xS();var He=8;function Jg(t){if((1&t)!==0)return He=15,1;if((2&t)!==0)return He=14,2;if((4&t)!==0)return He=13,4;var e=24&t;return e!==0?(He=12,e):(t&32)!==0?(He=11,32):(e=192&t,e!==0?(He=10,e):(t&256)!==0?(He=9,256):(e=3584&t,e!==0?(He=8,e):(t&4096)!==0?(He=7,4096):(e=4186112&t,e!==0?(He=6,e):(e=62914560&t,e!==0?(He=5,e):t&67108864?(He=4,67108864):(t&134217728)!==0?(He=3,134217728):(e=805306368&t,e!==0?(He=2,e):(1073741824&t)!==0?(He=1,1073741824):(He=8,t))))))}function WS(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function wS(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(J(358,t))}}function Ba(t,e){var n=t.pendingLanes;if(n===0)return He=0;var i=0,s=0,g=t.expiredLanes,o=t.suspendedLanes,r=t.pingedLanes;if(g!==0)i=g,s=He=15;else if(g=n&134217727,g!==0){var a=g&~o;a!==0?(i=Jg(a),s=He):(r&=g,r!==0&&(i=Jg(r),s=He))}else g=n&~o,g!==0?(i=Jg(g),s=He):r!==0&&(i=Jg(r),s=He);if(i===0)return 0;if(i=31-Gs(i),i=n&((0>i?0:1<<i)<<1)-1,e!==0&&e!==i&&(e&o)===0){if(Jg(e),s<=He)return e;He=s}if(e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Gs(e),s=1<<n,i|=t[n],e&=~s;return i}function mG(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function eC(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return t=Dg(24&~e),t===0?eC(10,e):t;case 10:return t=Dg(192&~e),t===0?eC(8,e):t;case 8:return t=Dg(3584&~e),t===0&&(t=Dg(4186112&~e),t===0&&(t=512)),t;case 2:return e=Dg(805306368&~e),e===0&&(e=268435456),e}throw Error(J(358,t))}function Dg(t){return t&-t}function rA(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function jC(t,e,n){t.pendingLanes|=e;var i=e-1;t.suspendedLanes&=i,t.pingedLanes&=i,t=t.eventTimes,e=31-Gs(e),t[e]=n}var Gs=Math.clz32?Math.clz32:ES,NS=Math.log,TS=Math.LN2;function ES(t){return t===0?32:31-(NS(t)/TS|0)|0}var QS=ft.unstable_UserBlockingPriority,XS=ft.unstable_runWithPriority,Gl=!0;function YS(t,e,n,i){ig||H0();var s=P0,g=ig;ig=!0;try{iG(s,t,e,n,i)}finally{(ig=g)||k0()}}function _S(t,e,n,i){XS(QS,P0.bind(null,t,e,n,i))}function P0(t,e,n,i){if(Gl){var s;if((s=(e&4)===0)&&0<ii.length&&-1<Bf.indexOf(t))t=Pd(null,t,e,n,i),ii.push(t);else{var g=J0(t,e,n,i);if(g===null)s&&bf(t,i);else{if(s){if(-1<Bf.indexOf(t)){t=Pd(g,t,e,n,i),ii.push(t);return}if(FS(g,t,e,n,i))return;bf(t,i)}UG(t,e,i,null,n)}}}}function J0(t,e,n,i){var s=Y0(i);if(s=sg(s),s!==null){var g=Fg(s);if(g===null)s=null;else{var o=g.tag;if(o===13){if(s=gG(g),s!==null)return s;s=null}else if(o===3){if(g.stateNode.hydrate)return g.tag===3?g.stateNode.containerInfo:null;s=null}else g!==s&&(s=null)}}return UG(t,e,i,s,n),null}var gs=null,D0=null,Zl=null;function fG(){if(Zl)return Zl;var t,e=D0,n=e.length,i,s="value"in gs?gs.value:gs.textContent,g=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===s[g-i];i++);return Zl=s.slice(t,1<i?1-i:void 0)}function Rl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function QI(){return!0}function vf(){return!1}function dn(t){function e(n,i,s,g,o){this._reactName=n,this._targetInst=s,this.type=i,this.nativeEvent=g,this.target=o,this.currentTarget=null;for(var r in t)t.hasOwnProperty(r)&&(n=t[r],this[r]=n?n(g):g[r]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?QI:vf,this.isPropagationStopped=vf,this}return je(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=QI)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=QI)},persist:function(){},isPersistent:QI}),e}var Ko={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},z0=dn(Ko),La=je({},Ko,{view:0,detail:0}),HS=dn(La),aA,IA,mr,qC=je({},La,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:O0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==mr&&(mr&&t.type==="mousemove"?(aA=t.screenX-mr.screenX,IA=t.screenY-mr.screenY):IA=aA=0,mr=t),aA)},movementY:function(t){return"movementY"in t?t.movementY:IA}}),Gf=dn(qC),kS=je({},qC,{dataTransfer:0}),KS=dn(kS),LS=je({},La,{relatedTarget:0}),lA=dn(LS),MS=je({},Ko,{animationName:0,elapsedTime:0,pseudoElement:0}),PS=dn(MS),JS=je({},Ko,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),DS=dn(JS),zS=je({},Ko,{data:0}),Zf=dn(zS),OS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $S(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qS[t])?!!e[t]:!1}function O0(){return $S}var eV=je({},La,{key:function(t){if(t.key){var e=OS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Rl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?jS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:O0,charCode:function(t){return t.type==="keypress"?Rl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Rl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),tV=dn(eV),nV=je({},qC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rf=dn(nV),iV=je({},La,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:O0}),sV=dn(iV),gV=je({},Ko,{propertyName:0,elapsedTime:0,pseudoElement:0}),oV=dn(gV),rV=je({},qC,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),aV=dn(rV),IV=[9,13,27,32],j0=Ni&&"CompositionEvent"in window,zr=null;Ni&&"documentMode"in document&&(zr=document.documentMode);var lV=Ni&&"TextEvent"in window&&!zr,pG=Ni&&(!j0||zr&&8<zr&&11>=zr),Ff=String.fromCharCode(32),Sf=!1;function BG(t,e){switch(t){case"keyup":return IV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bG(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var eo=!1;function CV(t,e){switch(t){case"compositionend":return bG(e);case"keypress":return e.which!==32?null:(Sf=!0,Ff);case"textInput":return t=e.data,t===Ff&&Sf?null:t;default:return null}}function cV(t,e){if(eo)return t==="compositionend"||!j0&&BG(t,e)?(t=fG(),Zl=D0=gs=null,eo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pG&&e.locale!=="ko"?null:e.data;default:return null}}var AV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!AV[t.type]:e==="textarea"}function yG(t,e,n,i){tG(i),e=tC(e,"onChange"),0<e.length&&(n=new z0("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Or=null,ba=null;function dV(t){FG(t,0)}function $C(t){var e=no(t);if(Dv(e))return t}function uV(t,e){if(t==="change")return e}var vG=!1;if(Ni){var CA;if(Ni){var cA="oninput"in document;if(!cA){var Uf=document.createElement("div");Uf.setAttribute("oninput","return;"),cA=typeof Uf.oninput=="function"}CA=cA}else CA=!1;vG=CA&&(!document.documentMode||9<document.documentMode)}function xf(){Or&&(Or.detachEvent("onpropertychange",GG),ba=Or=null)}function GG(t){if(t.propertyName==="value"&&$C(ba)){var e=[];if(yG(e,ba,t,Y0(t)),t=dV,ig)t(e);else{ig=!0;try{_0(t,e)}finally{ig=!1,k0()}}}}function hV(t,e,n){t==="focusin"?(xf(),Or=e,ba=n,Or.attachEvent("onpropertychange",GG)):t==="focusout"&&xf()}function mV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return $C(ba)}function fV(t,e){if(t==="click")return $C(e)}function pV(t,e){if(t==="input"||t==="change")return $C(e)}function BV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Bn=typeof Object.is=="function"?Object.is:BV,bV=Object.prototype.hasOwnProperty;function ya(t,e){if(Bn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!bV.call(e,n[i])||!Bn(t[n[i]],e[n[i]]))return!1;return!0}function Wf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wf(t,e){var n=Wf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Wf(n)}}function ZG(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ZG(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Nf(){for(var t=window,e=jl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=jl(t.document)}return e}function Jd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var yV=Ni&&"documentMode"in document&&11>=document.documentMode,to=null,Dd=null,jr=null,zd=!1;function Tf(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;zd||to==null||to!==jl(i)||(i=to,"selectionStart"in i&&Jd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),jr&&ya(jr,i)||(jr=i,i=tC(Dd,"onSelect"),0<i.length&&(e=new z0("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=to)))}M0("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);M0("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);M0(US,2);for(var Ef="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),AA=0;AA<Ef.length;AA++)L0.set(Ef[AA],0);Fo("onMouseEnter",["mouseout","mouseover"]);Fo("onMouseLeave",["mouseout","mouseover"]);Fo("onPointerEnter",["pointerout","pointerover"]);Fo("onPointerLeave",["pointerout","pointerover"]);Zg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zg("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),RG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Tr));function Qf(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,ZS(i,e,void 0,t),t.currentTarget=null}function FG(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;e:{var g=void 0;if(e)for(var o=i.length-1;0<=o;o--){var r=i[o],a=r.instance,I=r.currentTarget;if(r=r.listener,a!==g&&s.isPropagationStopped())break e;Qf(s,r,I),g=a}else for(o=0;o<i.length;o++){if(r=i[o],a=r.instance,I=r.currentTarget,r=r.listener,a!==g&&s.isPropagationStopped())break e;Qf(s,r,I),g=a}}}if($l)throw t=Ld,$l=!1,Ld=null,t}function Me(t,e){var n=WG(e),i=t+"__bubble";n.has(i)||(VG(e,t,2,!1),n.add(i))}var Xf="_reactListening"+Math.random().toString(36).slice(2);function SG(t){t[Xf]||(t[Xf]=!0,Mv.forEach(function(e){RG.has(e)||Yf(e,!1,t,null),Yf(e,!0,t,null)}))}function Yf(t,e,n,i){var s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,g=n;if(t==="selectionchange"&&n.nodeType!==9&&(g=n.ownerDocument),i!==null&&!e&&RG.has(t)){if(t!=="scroll")return;s|=2,g=i}var o=WG(g),r=t+"__"+(e?"capture":"bubble");o.has(r)||(e&&(s|=4),VG(g,t,s,e),o.add(r))}function VG(t,e,n,i){var s=L0.get(e);switch(s===void 0?2:s){case 0:s=YS;break;case 1:s=_S;break;default:s=P0}n=s.bind(null,e,n,t),s=void 0,!Kd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function UG(t,e,n,i,s){var g=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var r=i.stateNode.containerInfo;if(r===s||r.nodeType===8&&r.parentNode===s)break;if(o===4)for(o=i.return;o!==null;){var a=o.tag;if((a===3||a===4)&&(a=o.stateNode.containerInfo,a===s||a.nodeType===8&&a.parentNode===s))return;o=o.return}for(;r!==null;){if(o=sg(r),o===null)return;if(a=o.tag,a===5||a===6){i=g=o;continue e}r=r.parentNode}}i=i.return}bS(function(){var I=g,l=Y0(n),C=[];e:{var c=hG.get(t);if(c!==void 0){var A=z0,d=t;switch(t){case"keypress":if(Rl(n)===0)break e;case"keydown":case"keyup":A=tV;break;case"focusin":d="focus",A=lA;break;case"focusout":d="blur",A=lA;break;case"beforeblur":case"afterblur":A=lA;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Gf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=KS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=sV;break;case cG:case AG:case dG:A=PS;break;case uG:A=oV;break;case"scroll":A=HS;break;case"wheel":A=aV;break;case"copy":case"cut":case"paste":A=DS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=Rf}var h=(e&4)!==0,u=!h&&t==="scroll",m=h?c!==null?c+"Capture":null:c;h=[];for(var f=I,p;f!==null;){p=f;var B=p.stateNode;if(p.tag===5&&B!==null&&(p=B,m!==null&&(B=ma(f,m),B!=null&&h.push(va(f,B,p)))),u)break;f=f.return}0<h.length&&(c=new A(c,d,null,n,l),C.push({event:c,listeners:h}))}}if((e&7)===0){e:{if(c=t==="mouseover"||t==="pointerover",A=t==="mouseout"||t==="pointerout",c&&(e&16)===0&&(d=n.relatedTarget||n.fromElement)&&(sg(d)||d[Lo]))break e;if((A||c)&&(c=l.window===l?l:(c=l.ownerDocument)?c.defaultView||c.parentWindow:window,A?(d=n.relatedTarget||n.toElement,A=I,d=d?sg(d):null,d!==null&&(u=Fg(d),d!==u||d.tag!==5&&d.tag!==6)&&(d=null)):(A=null,d=I),A!==d)){if(h=Gf,B="onMouseLeave",m="onMouseEnter",f="mouse",(t==="pointerout"||t==="pointerover")&&(h=Rf,B="onPointerLeave",m="onPointerEnter",f="pointer"),u=A==null?c:no(A),p=d==null?c:no(d),c=new h(B,f+"leave",A,n,l),c.target=u,c.relatedTarget=p,B=null,sg(l)===I&&(h=new h(m,f+"enter",d,n,l),h.target=p,h.relatedTarget=u,B=h),u=B,A&&d)t:{for(h=A,m=d,f=0,p=h;p;p=Tg(p))f++;for(p=0,B=m;B;B=Tg(B))p++;for(;0<f-p;)h=Tg(h),f--;for(;0<p-f;)m=Tg(m),p--;for(;f--;){if(h===m||m!==null&&h===m.alternate)break t;h=Tg(h),m=Tg(m)}h=null}else h=null;A!==null&&_f(C,c,A,h,!1),d!==null&&u!==null&&_f(C,u,d,h,!0)}}e:{if(c=I?no(I):window,A=c.nodeName&&c.nodeName.toLowerCase(),A==="select"||A==="input"&&c.type==="file")var G=uV;else if(Vf(c))if(vG)G=pV;else{G=mV;var y=hV}else(A=c.nodeName)&&A.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(G=fV);if(G&&(G=G(t,I))){yG(C,G,n,l);break e}y&&y(t,c,I),t==="focusout"&&(y=c._wrapperState)&&y.controlled&&c.type==="number"&&Td(c,"number",c.value)}switch(y=I?no(I):window,t){case"focusin":(Vf(y)||y.contentEditable==="true")&&(to=y,Dd=I,jr=null);break;case"focusout":jr=Dd=to=null;break;case"mousedown":zd=!0;break;case"contextmenu":case"mouseup":case"dragend":zd=!1,Tf(C,n,l);break;case"selectionchange":if(yV)break;case"keydown":case"keyup":Tf(C,n,l)}var U;if(j0)e:{switch(t){case"compositionstart":var V="onCompositionStart";break e;case"compositionend":V="onCompositionEnd";break e;case"compositionupdate":V="onCompositionUpdate";break e}V=void 0}else eo?BG(t,n)&&(V="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(V="onCompositionStart");V&&(pG&&n.locale!=="ko"&&(eo||V!=="onCompositionStart"?V==="onCompositionEnd"&&eo&&(U=fG()):(gs=l,D0="value"in gs?gs.value:gs.textContent,eo=!0)),y=tC(I,V),0<y.length&&(V=new Zf(V,t,null,n,l),C.push({event:V,listeners:y}),U?V.data=U:(U=bG(n),U!==null&&(V.data=U)))),(U=lV?CV(t,n):cV(t,n))&&(I=tC(I,"onBeforeInput"),0<I.length&&(l=new Zf("onBeforeInput","beforeinput",null,n,l),C.push({event:l,listeners:I}),l.data=U))}FG(C,e)})}function va(t,e,n){return{instance:t,listener:e,currentTarget:n}}function tC(t,e){for(var n=e+"Capture",i=[];t!==null;){var s=t,g=s.stateNode;s.tag===5&&g!==null&&(s=g,g=ma(t,n),g!=null&&i.unshift(va(t,g,s)),g=ma(t,e),g!=null&&i.push(va(t,g,s))),t=t.return}return i}function Tg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _f(t,e,n,i,s){for(var g=e._reactName,o=[];n!==null&&n!==i;){var r=n,a=r.alternate,I=r.stateNode;if(a!==null&&a===i)break;r.tag===5&&I!==null&&(r=I,s?(a=ma(n,g),a!=null&&o.unshift(va(n,a,r))):s||(a=ma(n,g),a!=null&&o.push(va(n,a,r)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}function nC(){}var dA=null,uA=null;function xG(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function Od(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Hf=typeof setTimeout=="function"?setTimeout:void 0,vV=typeof clearTimeout=="function"?clearTimeout:void 0;function q0(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function mo(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function kf(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var hA=0;function GV(t){return{$$typeof:Q0,toString:t,valueOf:t}}var ec=Math.random().toString(36).slice(2),os="__reactFiber$"+ec,iC="__reactProps$"+ec,Lo="__reactContainer$"+ec,Kf="__reactEvents$"+ec;function sg(t){var e=t[os];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Lo]||n[os]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=kf(t);t!==null;){if(n=t[os])return n;t=kf(t)}return e}t=n,n=t.parentNode}return null}function Ma(t){return t=t[os]||t[Lo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function no(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(J(33))}function tc(t){return t[iC]||null}function WG(t){var e=t[Kf];return e===void 0&&(e=t[Kf]=new Set),e}var jd=[],io=-1;function Es(t){return{current:t}}function Pe(t){0>io||(t.current=jd[io],jd[io]=null,io--)}function st(t,e){io++,jd[io]=t.current,t.current=e}var Zs={},Yt=Es(Zs),qt=Es(!1),hg=Zs;function So(t,e){var n=t.type.contextTypes;if(!n)return Zs;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},g;for(g in n)s[g]=e[g];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function $t(t){return t=t.childContextTypes,t!=null}function sC(){Pe(qt),Pe(Yt)}function Lf(t,e,n){if(Yt.current!==Zs)throw Error(J(168));st(Yt,e),st(qt,n)}function wG(t,e,n){var i=t.stateNode;if(t=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var s in i)if(!(s in t))throw Error(J(108,co(e)||"Unknown",s));return je({},n,i)}function Fl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zs,hg=Yt.current,st(Yt,t),st(qt,qt.current),!0}function Mf(t,e,n){var i=t.stateNode;if(!i)throw Error(J(169));n?(t=wG(t,e,hg),i.__reactInternalMemoizedMergedChildContext=t,Pe(qt),Pe(Yt),st(Yt,t)):Pe(qt),st(qt,n)}var $0=null,cg=null,ZV=ft.unstable_runWithPriority,eh=ft.unstable_scheduleCallback,qd=ft.unstable_cancelCallback,RV=ft.unstable_shouldYield,Pf=ft.unstable_requestPaint,$d=ft.unstable_now,FV=ft.unstable_getCurrentPriorityLevel,nc=ft.unstable_ImmediatePriority,NG=ft.unstable_UserBlockingPriority,TG=ft.unstable_NormalPriority,EG=ft.unstable_LowPriority,QG=ft.unstable_IdlePriority,mA={},SV=Pf!==void 0?Pf:function(){},Gi=null,Sl=null,fA=!1,Jf=$d(),Qt=1e4>Jf?$d:function(){return $d()-Jf};function Vo(){switch(FV()){case nc:return 99;case NG:return 98;case TG:return 97;case EG:return 96;case QG:return 95;default:throw Error(J(332))}}function XG(t){switch(t){case 99:return nc;case 98:return NG;case 97:return TG;case 96:return EG;case 95:return QG;default:throw Error(J(332))}}function mg(t,e){return t=XG(t),ZV(t,e)}function Ga(t,e,n){return t=XG(t),eh(t,e,n)}function ui(){if(Sl!==null){var t=Sl;Sl=null,qd(t)}YG()}function YG(){if(!fA&&Gi!==null){fA=!0;var t=0;try{var e=Gi;mg(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),Gi=null}catch(n){throw Gi!==null&&(Gi=Gi.slice(t+1)),eh(nc,ui),n}finally{fA=!1}}}var VV=Rg.ReactCurrentBatchConfig;function Xn(t,e){if(t&&t.defaultProps){e=je({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var gC=Es(null),oC=null,so=null,rC=null;function th(){rC=so=oC=null}function nh(t){var e=gC.current;Pe(gC),t.type._context._currentValue=e}function _G(t,e){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)===e){if(n===null||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,n!==null&&(n.childLanes|=e);t=t.return}}function fo(t,e){oC=t,rC=so=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(_n=!0),t.firstContext=null)}function Zn(t,e){if(rC!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(rC=t,e=1073741823),e={context:t,observedBits:e,next:null},so===null){if(oC===null)throw Error(J(308));so=e,oC.dependencies={lanes:0,firstContext:e,responders:null}}else so=so.next=e;return t._currentValue}var is=!1;function ih(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function HG(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function As(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ds(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function Df(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var s=null,g=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};g===null?s=g=o:g=g.next=o,n=n.next}while(n!==null);g===null?s=g=e:g=g.next=e}else s=g=e;n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:g,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Za(t,e,n,i){var s=t.updateQueue;is=!1;var g=s.firstBaseUpdate,o=s.lastBaseUpdate,r=s.shared.pending;if(r!==null){s.shared.pending=null;var a=r,I=a.next;a.next=null,o===null?g=I:o.next=I,o=a;var l=t.alternate;if(l!==null){l=l.updateQueue;var C=l.lastBaseUpdate;C!==o&&(C===null?l.firstBaseUpdate=I:C.next=I,l.lastBaseUpdate=a)}}if(g!==null){C=s.baseState,o=0,l=I=a=null;do{r=g.lane;var c=g.eventTime;if((i&r)===r){l!==null&&(l=l.next={eventTime:c,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var A=t,d=g;switch(r=e,c=n,d.tag){case 1:if(A=d.payload,typeof A=="function"){C=A.call(c,C,r);break e}C=A;break e;case 3:A.flags=A.flags&-4097|64;case 0:if(A=d.payload,r=typeof A=="function"?A.call(c,C,r):A,r==null)break e;C=je({},C,r);break e;case 2:is=!0}}g.callback!==null&&(t.flags|=32,r=s.effects,r===null?s.effects=[g]:r.push(g))}else c={eventTime:c,lane:r,tag:g.tag,payload:g.payload,callback:g.callback,next:null},l===null?(I=l=c,a=C):l=l.next=c,o|=r;if(g=g.next,g===null){if(r=s.shared.pending,r===null)break;g=r.next,r.next=null,s.lastBaseUpdate=r,s.shared.pending=null}}while(1);l===null&&(a=C),s.baseState=a,s.firstBaseUpdate=I,s.lastBaseUpdate=l,Ja|=o,t.lanes=o,t.memoizedState=C}}function zf(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],s=i.callback;if(s!==null){if(i.callback=null,i=n,typeof s!="function")throw Error(J(191,s));s.call(i)}}}var kG=new JC.Component().refs;function aC(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:je({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ic={isMounted:function(t){return(t=t._reactInternals)?Fg(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=In(),s=us(t),g=As(i,s);g.payload=e,n!=null&&(g.callback=n),ds(t,g),hs(t,s,i)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=In(),s=us(t),g=As(i,s);g.tag=1,g.payload=e,n!=null&&(g.callback=n),ds(t,g),hs(t,s,i)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),i=us(t),s=As(n,i);s.tag=2,e!=null&&(s.callback=e),ds(t,s),hs(t,i,n)}};function Of(t,e,n,i,s,g,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,g,o):e.prototype&&e.prototype.isPureReactComponent?!ya(n,i)||!ya(s,g):!0}function KG(t,e,n){var i=!1,s=Zs,g=e.contextType;return typeof g=="object"&&g!==null?g=Zn(g):(s=$t(e)?hg:Yt.current,i=e.contextTypes,g=(i=i!=null)?So(t,s):Zs),e=new e(n,g),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ic,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=g),e}function jf(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ic.enqueueReplaceState(e,e.state,null)}function eu(t,e,n,i){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=kG,ih(t);var g=e.contextType;typeof g=="object"&&g!==null?s.context=Zn(g):(g=$t(e)?hg:Yt.current,s.context=So(t,g)),Za(t,n,s,i),s.state=t.memoizedState,g=e.getDerivedStateFromProps,typeof g=="function"&&(aC(t,e,g,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ic.enqueueReplaceState(s,s.state,null),Za(t,n,s,i),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4)}var XI=Array.isArray;function fr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var i=n.stateNode}if(!i)throw Error(J(147,t));var s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(g){var o=i.refs;o===kG&&(o=i.refs={}),g===null?delete o[s]:o[s]=g},e._stringRef=s,e)}if(typeof t!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,t))}return t}function YI(t,e){if(t.type!=="textarea")throw Error(J(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function LG(t){function e(u,m){if(t){var f=u.lastEffect;f!==null?(f.nextEffect=m,u.lastEffect=m):u.firstEffect=u.lastEffect=m,m.nextEffect=null,m.flags=8}}function n(u,m){if(!t)return null;for(;m!==null;)e(u,m),m=m.sibling;return null}function i(u,m){for(u=new Map;m!==null;)m.key!==null?u.set(m.key,m):u.set(m.index,m),m=m.sibling;return u}function s(u,m){return u=Fs(u,m),u.index=0,u.sibling=null,u}function g(u,m,f){return u.index=f,t?(f=u.alternate,f!==null?(f=f.index,f<m?(u.flags=2,m):f):(u.flags=2,m)):m}function o(u){return t&&u.alternate===null&&(u.flags=2),u}function r(u,m,f,p){return m===null||m.tag!==6?(m=vA(f,u.mode,p),m.return=u,m):(m=s(m,f),m.return=u,m)}function a(u,m,f,p){return m!==null&&m.elementType===f.type?(p=s(m,f.props),p.ref=fr(u,m,f),p.return=u,p):(p=Wl(f.type,f.key,f.props,null,u.mode,p),p.ref=fr(u,m,f),p.return=u,p)}function I(u,m,f,p){return m===null||m.tag!==4||m.stateNode.containerInfo!==f.containerInfo||m.stateNode.implementation!==f.implementation?(m=GA(f,u.mode,p),m.return=u,m):(m=s(m,f.children||[]),m.return=u,m)}function l(u,m,f,p,B){return m===null||m.tag!==7?(m=yo(f,u.mode,p,B),m.return=u,m):(m=s(m,f),m.return=u,m)}function C(u,m,f){if(typeof m=="string"||typeof m=="number")return m=vA(""+m,u.mode,f),m.return=u,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case wr:return f=Wl(m.type,m.key,m.props,null,u.mode,f),f.ref=fr(u,null,m),f.return=u,f;case ng:return m=GA(m,u.mode,f),m.return=u,m}if(XI(m)||cr(m))return m=yo(m,u.mode,f,null),m.return=u,m;YI(u,m)}return null}function c(u,m,f,p){var B=m!==null?m.key:null;if(typeof f=="string"||typeof f=="number")return B!==null?null:r(u,m,""+f,p);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case wr:return f.key===B?f.type===ss?l(u,m,f.props.children,p,B):a(u,m,f,p):null;case ng:return f.key===B?I(u,m,f,p):null}if(XI(f)||cr(f))return B!==null?null:l(u,m,f,p,null);YI(u,f)}return null}function A(u,m,f,p,B){if(typeof p=="string"||typeof p=="number")return u=u.get(f)||null,r(m,u,""+p,B);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case wr:return u=u.get(p.key===null?f:p.key)||null,p.type===ss?l(m,u,p.props.children,B,p.key):a(m,u,p,B);case ng:return u=u.get(p.key===null?f:p.key)||null,I(m,u,p,B)}if(XI(p)||cr(p))return u=u.get(f)||null,l(m,u,p,B,null);YI(m,p)}return null}function d(u,m,f,p){for(var B=null,G=null,y=m,U=m=0,V=null;y!==null&&U<f.length;U++){y.index>U?(V=y,y=null):V=y.sibling;var F=c(u,y,f[U],p);if(F===null){y===null&&(y=V);break}t&&y&&F.alternate===null&&e(u,y),m=g(F,m,U),G===null?B=F:G.sibling=F,G=F,y=V}if(U===f.length)return n(u,y),B;if(y===null){for(;U<f.length;U++)y=C(u,f[U],p),y!==null&&(m=g(y,m,U),G===null?B=y:G.sibling=y,G=y);return B}for(y=i(u,y);U<f.length;U++)V=A(y,u,U,f[U],p),V!==null&&(t&&V.alternate!==null&&y.delete(V.key===null?U:V.key),m=g(V,m,U),G===null?B=V:G.sibling=V,G=V);return t&&y.forEach(function(W){return e(u,W)}),B}function h(u,m,f,p){var B=cr(f);if(typeof B!="function")throw Error(J(150));if(f=B.call(f),f==null)throw Error(J(151));for(var G=B=null,y=m,U=m=0,V=null,F=f.next();y!==null&&!F.done;U++,F=f.next()){y.index>U?(V=y,y=null):V=y.sibling;var W=c(u,y,F.value,p);if(W===null){y===null&&(y=V);break}t&&y&&W.alternate===null&&e(u,y),m=g(W,m,U),G===null?B=W:G.sibling=W,G=W,y=V}if(F.done)return n(u,y),B;if(y===null){for(;!F.done;U++,F=f.next())F=C(u,F.value,p),F!==null&&(m=g(F,m,U),G===null?B=F:G.sibling=F,G=F);return B}for(y=i(u,y);!F.done;U++,F=f.next())F=A(y,u,U,F.value,p),F!==null&&(t&&F.alternate!==null&&y.delete(F.key===null?U:F.key),m=g(F,m,U),G===null?B=F:G.sibling=F,G=F);return t&&y.forEach(function(M){return e(u,M)}),B}return function(u,m,f,p){var B=typeof f=="object"&&f!==null&&f.type===ss&&f.key===null;B&&(f=f.props.children);var G=typeof f=="object"&&f!==null;if(G)switch(f.$$typeof){case wr:e:{for(G=f.key,B=m;B!==null;){if(B.key===G){switch(B.tag){case 7:if(f.type===ss){n(u,B.sibling),m=s(B,f.props.children),m.return=u,u=m;break e}break;default:if(B.elementType===f.type){n(u,B.sibling),m=s(B,f.props),m.ref=fr(u,B,f),m.return=u,u=m;break e}}n(u,B);break}else e(u,B);B=B.sibling}f.type===ss?(m=yo(f.props.children,u.mode,p,f.key),m.return=u,u=m):(p=Wl(f.type,f.key,f.props,null,u.mode,p),p.ref=fr(u,m,f),p.return=u,u=p)}return o(u);case ng:e:{for(B=f.key;m!==null;){if(m.key===B)if(m.tag===4&&m.stateNode.containerInfo===f.containerInfo&&m.stateNode.implementation===f.implementation){n(u,m.sibling),m=s(m,f.children||[]),m.return=u,u=m;break e}else{n(u,m);break}else e(u,m);m=m.sibling}m=GA(f,u.mode,p),m.return=u,u=m}return o(u)}if(typeof f=="string"||typeof f=="number")return f=""+f,m!==null&&m.tag===6?(n(u,m.sibling),m=s(m,f),m.return=u,u=m):(n(u,m),m=vA(f,u.mode,p),m.return=u,u=m),o(u);if(XI(f))return d(u,m,f,p);if(cr(f))return h(u,m,f,p);if(G&&YI(u,f),typeof f>"u"&&!B)switch(u.tag){case 1:case 22:case 0:case 11:case 15:throw Error(J(152,co(u.type)||"Component"))}return n(u,m)}}var IC=LG(!0),MG=LG(!1),Pa={},ai=Es(Pa),Ra=Es(Pa),Fa=Es(Pa);function gg(t){if(t===Pa)throw Error(J(174));return t}function tu(t,e){switch(st(Fa,e),st(Ra,t),st(ai,Pa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Yd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Yd(e,t)}Pe(ai),st(ai,e)}function Uo(){Pe(ai),Pe(Ra),Pe(Fa)}function qf(t){gg(Fa.current);var e=gg(ai.current),n=Yd(e,t.type);e!==n&&(st(Ra,t),st(ai,n))}function sh(t){Ra.current===t&&(Pe(ai),Pe(Ra))}var it=Es(0);function lC(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Si=null,rs=null,Ii=!1;function PG(t,e){var n=bn(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function $f(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function nu(t){if(Ii){var e=rs;if(e){var n=e;if(!$f(t,e)){if(e=mo(n.nextSibling),!e||!$f(t,e)){t.flags=t.flags&-1025|2,Ii=!1,Si=t;return}PG(Si,n)}Si=t,rs=mo(e.firstChild)}else t.flags=t.flags&-1025|2,Ii=!1,Si=t}}function ep(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Si=t}function _I(t){if(t!==Si)return!1;if(!Ii)return ep(t),Ii=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!Od(e,t.memoizedProps))for(e=rs;e;)PG(t,e),e=mo(e.nextSibling);if(ep(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(J(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){rs=mo(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}rs=null}}else rs=Si?mo(t.stateNode.nextSibling):null;return!0}function pA(){rs=Si=null,Ii=!1}var po=[];function gh(){for(var t=0;t<po.length;t++)po[t]._workInProgressVersionPrimary=null;po.length=0}var qr=Rg.ReactCurrentDispatcher,yn=Rg.ReactCurrentBatchConfig,Sa=0,rt=null,wt=null,Gt=null,CC=!1,$r=!1;function Ot(){throw Error(J(321))}function oh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Bn(t[n],e[n]))return!1;return!0}function rh(t,e,n,i,s,g){if(Sa=g,rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qr.current=t===null||t.memoizedState===null?xV:WV,t=n(i,s),$r){g=0;do{if($r=!1,!(25>g))throw Error(J(301));g+=1,Gt=wt=null,e.updateQueue=null,qr.current=wV,t=n(i,s)}while($r)}if(qr.current=uC,e=wt!==null&&wt.next!==null,Sa=0,Gt=wt=rt=null,CC=!1,e)throw Error(J(300));return t}function og(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?rt.memoizedState=Gt=t:Gt=Gt.next=t,Gt}function Sg(){if(wt===null){var t=rt.alternate;t=t!==null?t.memoizedState:null}else t=wt.next;var e=Gt===null?rt.memoizedState:Gt.next;if(e!==null)Gt=e,wt=t;else{if(t===null)throw Error(J(310));wt=t,t={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Gt===null?rt.memoizedState=Gt=t:Gt=Gt.next=t}return Gt}function si(t,e){return typeof e=="function"?e(t):e}function pr(t){var e=Sg(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var i=wt,s=i.baseQueue,g=n.pending;if(g!==null){if(s!==null){var o=s.next;s.next=g.next,g.next=o}i.baseQueue=s=g,n.pending=null}if(s!==null){s=s.next,i=i.baseState;var r=o=g=null,a=s;do{var I=a.lane;if((Sa&I)===I)r!==null&&(r=r.next={lane:0,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null}),i=a.eagerReducer===t?a.eagerState:t(i,a.action);else{var l={lane:I,action:a.action,eagerReducer:a.eagerReducer,eagerState:a.eagerState,next:null};r===null?(o=r=l,g=i):r=r.next=l,rt.lanes|=I,Ja|=I}a=a.next}while(a!==null&&a!==s);r===null?g=i:r.next=o,Bn(i,e.memoizedState)||(_n=!0),e.memoizedState=i,e.baseState=g,e.baseQueue=r,n.lastRenderedState=i}return[e.memoizedState,n.dispatch]}function Br(t){var e=Sg(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,g=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do g=t(g,o.action),o=o.next;while(o!==s);Bn(g,e.memoizedState)||(_n=!0),e.memoizedState=g,e.baseQueue===null&&(e.baseState=g),n.lastRenderedState=g}return[g,i]}function tp(t,e,n){var i=e._getVersion;i=i(e._source);var s=e._workInProgressVersionPrimary;if(s!==null?t=s===i:(t=t.mutableReadLanes,(t=(Sa&t)===t)&&(e._workInProgressVersionPrimary=i,po.push(e))),t)return n(e._source);throw po.push(e),Error(J(350))}function JG(t,e,n,i){var s=Mt;if(s===null)throw Error(J(349));var g=e._getVersion,o=g(e._source),r=qr.current,a=r.useState(function(){return tp(s,e,n)}),I=a[1],l=a[0];a=Gt;var C=t.memoizedState,c=C.refs,A=c.getSnapshot,d=C.source;C=C.subscribe;var h=rt;return t.memoizedState={refs:c,source:e,subscribe:i},r.useEffect(function(){c.getSnapshot=n,c.setSnapshot=I;var u=g(e._source);if(!Bn(o,u)){u=n(e._source),Bn(l,u)||(I(u),u=us(h),s.mutableReadLanes|=u&s.pendingLanes),u=s.mutableReadLanes,s.entangledLanes|=u;for(var m=s.entanglements,f=u;0<f;){var p=31-Gs(f),B=1<<p;m[p]|=u,f&=~B}}},[n,e,i]),r.useEffect(function(){return i(e._source,function(){var u=c.getSnapshot,m=c.setSnapshot;try{m(u(e._source));var f=us(h);s.mutableReadLanes|=f&s.pendingLanes}catch(p){m(function(){throw p})}})},[e,i]),Bn(A,n)&&Bn(d,e)&&Bn(C,i)||(t={pending:null,dispatch:null,lastRenderedReducer:si,lastRenderedState:l},t.dispatch=I=lh.bind(null,rt,t),a.queue=t,a.baseQueue=null,l=tp(s,e,n),a.memoizedState=a.baseState=l),l}function DG(t,e,n){var i=Sg();return JG(i,t,e,n)}function br(t){var e=og();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:si,lastRenderedState:t},t=t.dispatch=lh.bind(null,rt,t),[e.memoizedState,t]}function cC(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=rt.updateQueue,e===null?(e={lastEffect:null},rt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function np(t){var e=og();return t={current:t},e.memoizedState=t}function AC(){return Sg().memoizedState}function iu(t,e,n,i){var s=og();rt.flags|=t,s.memoizedState=cC(1|e,n,void 0,i===void 0?null:i)}function ah(t,e,n,i){var s=Sg();i=i===void 0?null:i;var g=void 0;if(wt!==null){var o=wt.memoizedState;if(g=o.destroy,i!==null&&oh(i,o.deps)){cC(e,n,g,i);return}}rt.flags|=t,s.memoizedState=cC(1|e,n,g,i)}function ip(t,e){return iu(516,4,t,e)}function dC(t,e){return ah(516,4,t,e)}function zG(t,e){return ah(4,2,t,e)}function OG(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function jG(t,e,n){return n=n!=null?n.concat([t]):null,ah(4,2,OG.bind(null,e,t),n)}function Ih(){}function qG(t,e){var n=Sg();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&oh(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function $G(t,e){var n=Sg();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&oh(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function UV(t,e){var n=Vo();mg(98>n?98:n,function(){t(!0)}),mg(97<n?97:n,function(){var i=yn.transition;yn.transition=1;try{t(!1),e()}finally{yn.transition=i}})}function lh(t,e,n){var i=In(),s=us(t),g={lane:s,action:n,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?g.next=g:(g.next=o.next,o.next=g),e.pending=g,o=t.alternate,t===rt||o!==null&&o===rt)$r=CC=!0;else{if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var r=e.lastRenderedState,a=o(r,n);if(g.eagerReducer=o,g.eagerState=a,Bn(a,r))return}catch{}finally{}hs(t,s,i)}}var uC={readContext:Zn,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useMutableSource:Ot,useOpaqueIdentifier:Ot,unstable_isNewReconciler:!1},xV={readContext:Zn,useCallback:function(t,e){return og().memoizedState=[t,e===void 0?null:e],t},useContext:Zn,useEffect:ip,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,iu(4,2,OG.bind(null,e,t),n)},useLayoutEffect:function(t,e){return iu(4,2,t,e)},useMemo:function(t,e){var n=og();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=og();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t=i.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=lh.bind(null,rt,t),[i.memoizedState,t]},useRef:np,useState:br,useDebugValue:Ih,useDeferredValue:function(t){var e=br(t),n=e[0],i=e[1];return ip(function(){var s=yn.transition;yn.transition=1;try{i(t)}finally{yn.transition=s}},[t]),n},useTransition:function(){var t=br(!1),e=t[0];return t=UV.bind(null,t[1]),np(t),[t,e]},useMutableSource:function(t,e,n){var i=og();return i.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},JG(i,t,e,n)},useOpaqueIdentifier:function(){if(Ii){var t=!1,e=GV(function(){throw t||(t=!0,n("r:"+(hA++).toString(36))),Error(J(355))}),n=br(e)[1];return(rt.mode&2)===0&&(rt.flags|=516,cC(5,function(){n("r:"+(hA++).toString(36))},void 0,null)),e}return e="r:"+(hA++).toString(36),br(e),e},unstable_isNewReconciler:!1},WV={readContext:Zn,useCallback:qG,useContext:Zn,useEffect:dC,useImperativeHandle:jG,useLayoutEffect:zG,useMemo:$G,useReducer:pr,useRef:AC,useState:function(){return pr(si)},useDebugValue:Ih,useDeferredValue:function(t){var e=pr(si),n=e[0],i=e[1];return dC(function(){var s=yn.transition;yn.transition=1;try{i(t)}finally{yn.transition=s}},[t]),n},useTransition:function(){var t=pr(si)[0];return[AC().current,t]},useMutableSource:DG,useOpaqueIdentifier:function(){return pr(si)[0]},unstable_isNewReconciler:!1},wV={readContext:Zn,useCallback:qG,useContext:Zn,useEffect:dC,useImperativeHandle:jG,useLayoutEffect:zG,useMemo:$G,useReducer:Br,useRef:AC,useState:function(){return Br(si)},useDebugValue:Ih,useDeferredValue:function(t){var e=Br(si),n=e[0],i=e[1];return dC(function(){var s=yn.transition;yn.transition=1;try{i(t)}finally{yn.transition=s}},[t]),n},useTransition:function(){var t=Br(si)[0];return[AC().current,t]},useMutableSource:DG,useOpaqueIdentifier:function(){return Br(si)[0]},unstable_isNewReconciler:!1},NV=Rg.ReactCurrentOwner,_n=!1;function jt(t,e,n,i){e.child=t===null?MG(e,null,n,i):IC(e,t.child,n,i)}function sp(t,e,n,i,s){n=n.render;var g=e.ref;return fo(e,s),i=rh(t,e,n,i,g,s),t!==null&&!_n?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~s,Vi(t,e,s)):(e.flags|=1,jt(t,e,i,s),e.child)}function gp(t,e,n,i,s,g){if(t===null){var o=n.type;return typeof o=="function"&&!hh(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,eZ(t,e,o,i,s,g)):(t=Wl(n.type,null,i,e,e.mode,g),t.ref=e.ref,t.return=e,e.child=t)}return o=t.child,(s&g)===0&&(s=o.memoizedProps,n=n.compare,n=n!==null?n:ya,n(s,i)&&t.ref===e.ref)?Vi(t,e,g):(e.flags|=1,t=Fs(o,i),t.ref=e.ref,t.return=e,e.child=t)}function eZ(t,e,n,i,s,g){if(t!==null&&ya(t.memoizedProps,i)&&t.ref===e.ref)if(_n=!1,(g&s)!==0)(t.flags&16384)!==0&&(_n=!0);else return e.lanes=t.lanes,Vi(t,e,g);return su(t,e,n,i,g)}function BA(t,e,n){var i=e.pendingProps,s=i.children,g=t!==null?t.memoizedState:null;if(i.mode==="hidden"||i.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},kI(e,n);else if((n&1073741824)!==0)e.memoizedState={baseLanes:0},kI(e,g!==null?g.baseLanes:n);else return t=g!==null?g.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},kI(e,t),null;else g!==null?(i=g.baseLanes|n,e.memoizedState=null):i=n,kI(e,i);return jt(t,e,s,n),e.child}function tZ(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=128)}function su(t,e,n,i,s){var g=$t(n)?hg:Yt.current;return g=So(e,g),fo(e,s),n=rh(t,e,n,i,g,s),t!==null&&!_n?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~s,Vi(t,e,s)):(e.flags|=1,jt(t,e,n,s),e.child)}function op(t,e,n,i,s){if($t(n)){var g=!0;Fl(e)}else g=!1;if(fo(e,s),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),KG(e,n,i),eu(e,n,i,s),i=!0;else if(t===null){var o=e.stateNode,r=e.memoizedProps;o.props=r;var a=o.context,I=n.contextType;typeof I=="object"&&I!==null?I=Zn(I):(I=$t(n)?hg:Yt.current,I=So(e,I));var l=n.getDerivedStateFromProps,C=typeof l=="function"||typeof o.getSnapshotBeforeUpdate=="function";C||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(r!==i||a!==I)&&jf(e,o,i,I),is=!1;var c=e.memoizedState;o.state=c,Za(e,i,o,s),a=e.memoizedState,r!==i||c!==a||qt.current||is?(typeof l=="function"&&(aC(e,n,l,i),a=e.memoizedState),(r=is||Of(e,n,r,i,c,a,I))?(C||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=i,e.memoizedState=a),o.props=i,o.state=a,o.context=I,i=r):(typeof o.componentDidMount=="function"&&(e.flags|=4),i=!1)}else{o=e.stateNode,HG(t,e),r=e.memoizedProps,I=e.type===e.elementType?r:Xn(e.type,r),o.props=I,C=e.pendingProps,c=o.context,a=n.contextType,typeof a=="object"&&a!==null?a=Zn(a):(a=$t(n)?hg:Yt.current,a=So(e,a));var A=n.getDerivedStateFromProps;(l=typeof A=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(r!==C||c!==a)&&jf(e,o,i,a),is=!1,c=e.memoizedState,o.state=c,Za(e,i,o,s);var d=e.memoizedState;r!==C||c!==d||qt.current||is?(typeof A=="function"&&(aC(e,n,A,i),d=e.memoizedState),(I=is||Of(e,n,I,i,c,d,a))?(l||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,d,a),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,d,a)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),e.memoizedProps=i,e.memoizedState=d),o.props=i,o.state=d,o.context=a,i=I):(typeof o.componentDidUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),i=!1)}return gu(t,e,n,i,g,s)}function gu(t,e,n,i,s,g){tZ(t,e);var o=(e.flags&64)!==0;if(!i&&!o)return s&&Mf(e,n,!1),Vi(t,e,g);i=e.stateNode,NV.current=e;var r=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=IC(e,t.child,null,g),e.child=IC(e,null,r,g)):jt(t,e,r,g),e.memoizedState=i.state,s&&Mf(e,n,!0),e.child}function rp(t){var e=t.stateNode;e.pendingContext?Lf(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Lf(t,e.context,!1),tu(t,e.containerInfo)}var HI={dehydrated:null,retryLane:0};function ap(t,e,n){var i=e.pendingProps,s=it.current,g=!1,o;return(o=(e.flags&64)!==0)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(g=!0,e.flags&=-65):t!==null&&t.memoizedState===null||i.fallback===void 0||i.unstable_avoidThisFallback===!0||(s|=1),st(it,s&1),t===null?(i.fallback!==void 0&&nu(e),t=i.children,s=i.fallback,g?(t=Ip(e,t,s,n),e.child.memoizedState={baseLanes:n},e.memoizedState=HI,t):typeof i.unstable_expectedLoadTime=="number"?(t=Ip(e,t,s,n),e.child.memoizedState={baseLanes:n},e.memoizedState=HI,e.lanes=33554432,t):(n=mh({mode:"visible",children:t},e.mode,n,null),n.return=e,e.child=n)):t.memoizedState!==null?g?(i=Cp(t,e,i.children,i.fallback,n),g=e.child,s=t.child.memoizedState,g.memoizedState=s===null?{baseLanes:n}:{baseLanes:s.baseLanes|n},g.childLanes=t.childLanes&~n,e.memoizedState=HI,i):(n=lp(t,e,i.children,n),e.memoizedState=null,n):g?(i=Cp(t,e,i.children,i.fallback,n),g=e.child,s=t.child.memoizedState,g.memoizedState=s===null?{baseLanes:n}:{baseLanes:s.baseLanes|n},g.childLanes=t.childLanes&~n,e.memoizedState=HI,i):(n=lp(t,e,i.children,n),e.memoizedState=null,n)}function Ip(t,e,n,i){var s=t.mode,g=t.child;return e={mode:"hidden",children:e},(s&2)===0&&g!==null?(g.childLanes=0,g.pendingProps=e):g=mh(e,s,0,null),n=yo(n,s,i,null),g.return=t,n.return=t,g.sibling=n,t.child=g,n}function lp(t,e,n,i){var s=t.child;return t=s.sibling,n=Fs(s,{mode:"visible",children:n}),(e.mode&2)===0&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function Cp(t,e,n,i,s){var g=e.mode,o=t.child;t=o.sibling;var r={mode:"hidden",children:n};return(g&2)===0&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=r,o=n.lastEffect,o!==null?(e.firstEffect=n.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):n=Fs(o,r),t!==null?i=Fs(t,i):(i=yo(i,g,s,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,i}function cp(t,e){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),_G(t.return,e)}function bA(t,e,n,i,s,g){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s,lastEffect:g}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=s,o.lastEffect=g)}function Ap(t,e,n){var i=e.pendingProps,s=i.revealOrder,g=i.tail;if(jt(t,e,i.children,n),i=it.current,(i&2)!==0)i=i&1|2,e.flags|=64;else{if(t!==null&&(t.flags&64)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&cp(t,n);else if(t.tag===19)cp(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(st(it,i),(e.mode&2)===0)e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&lC(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),bA(e,!1,s,n,g,e.lastEffect);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&lC(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}bA(e,!0,n,null,g,e.lastEffect);break;case"together":bA(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Vi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ja|=e.lanes,(n&e.childLanes)!==0){if(t!==null&&e.child!==t.child)throw Error(J(153));if(e.child!==null){for(t=e.child,n=Fs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Fs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}return null}var nZ,ou,iZ,sZ;nZ=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ou=function(){};iZ=function(t,e,n,i){var s=t.memoizedProps;if(s!==i){t=e.stateNode,gg(ai.current);var g=null;switch(n){case"input":s=wd(t,s),i=wd(t,i),g=[];break;case"option":s=Ed(t,s),i=Ed(t,i),g=[];break;case"select":s=je({},s,{value:void 0}),i=je({},i,{value:void 0}),g=[];break;case"textarea":s=Qd(t,s),i=Qd(t,i),g=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=nC)}_d(n,i);var o;n=null;for(I in s)if(!i.hasOwnProperty(I)&&s.hasOwnProperty(I)&&s[I]!=null)if(I==="style"){var r=s[I];for(o in r)r.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(ua.hasOwnProperty(I)?g||(g=[]):(g=g||[]).push(I,null));for(I in i){var a=i[I];if(r=s!=null?s[I]:void 0,i.hasOwnProperty(I)&&a!==r&&(a!=null||r!=null))if(I==="style")if(r){for(o in r)!r.hasOwnProperty(o)||a&&a.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in a)a.hasOwnProperty(o)&&r[o]!==a[o]&&(n||(n={}),n[o]=a[o])}else n||(g||(g=[]),g.push(I,n)),n=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,r=r?r.__html:void 0,a!=null&&r!==a&&(g=g||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(g=g||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(ua.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&Me("scroll",t),g||r===a||(g=[])):typeof a=="object"&&a!==null&&a.$$typeof===Q0?a.toString():(g=g||[]).push(I,a))}n&&(g=g||[]).push("style",n);var I=g;(e.updateQueue=I)&&(e.flags|=4)}};sZ=function(t,e,n,i){n!==i&&(e.flags|=4)};function yr(t,e){if(!Ii)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function TV(t,e,n){var i=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return $t(e.type)&&sC(),null;case 3:return Uo(),Pe(qt),Pe(Yt),gh(),i=e.stateNode,i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(_I(e)?e.flags|=4:i.hydrate||(e.flags|=256)),ou(e),null;case 5:sh(e);var s=gg(Fa.current);if(n=e.type,t!==null&&e.stateNode!=null)iZ(t,e,n,i,s),t.ref!==e.ref&&(e.flags|=128);else{if(!i){if(e.stateNode===null)throw Error(J(166));return null}if(t=gg(ai.current),_I(e)){i=e.stateNode,n=e.type;var g=e.memoizedProps;switch(i[os]=e,i[iC]=g,n){case"dialog":Me("cancel",i),Me("close",i);break;case"iframe":case"object":case"embed":Me("load",i);break;case"video":case"audio":for(t=0;t<Tr.length;t++)Me(Tr[t],i);break;case"source":Me("error",i);break;case"img":case"image":case"link":Me("error",i),Me("load",i);break;case"details":Me("toggle",i);break;case"input":Af(i,g),Me("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!g.multiple},Me("invalid",i);break;case"textarea":uf(i,g),Me("invalid",i)}_d(n,g),t=null;for(var o in g)g.hasOwnProperty(o)&&(s=g[o],o==="children"?typeof s=="string"?i.textContent!==s&&(t=["children",s]):typeof s=="number"&&i.textContent!==""+s&&(t=["children",""+s]):ua.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Me("scroll",i));switch(n){case"input":NI(i),df(i,g,!0);break;case"textarea":NI(i),hf(i);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(i.onclick=nC)}i=t,e.updateQueue=i,i!==null&&(e.flags|=4)}else{switch(o=s.nodeType===9?s:s.ownerDocument,t===Xd.html&&(t=jv(n)),t===Xd.html?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[os]=e,t[iC]=i,nZ(t,e,!1,!1),e.stateNode=t,o=Hd(n,i),n){case"dialog":Me("cancel",t),Me("close",t),s=i;break;case"iframe":case"object":case"embed":Me("load",t),s=i;break;case"video":case"audio":for(s=0;s<Tr.length;s++)Me(Tr[s],t);s=i;break;case"source":Me("error",t),s=i;break;case"img":case"image":case"link":Me("error",t),Me("load",t),s=i;break;case"details":Me("toggle",t),s=i;break;case"input":Af(t,i),s=wd(t,i),Me("invalid",t);break;case"option":s=Ed(t,i);break;case"select":t._wrapperState={wasMultiple:!!i.multiple},s=je({},i,{value:void 0}),Me("invalid",t);break;case"textarea":uf(t,i),s=Qd(t,i),Me("invalid",t);break;default:s=i}_d(n,s);var r=s;for(g in r)if(r.hasOwnProperty(g)){var a=r[g];g==="style"?eG(t,a):g==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&qv(t,a)):g==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&ha(t,a):typeof a=="number"&&ha(t,""+a):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(ua.hasOwnProperty(g)?a!=null&&g==="onScroll"&&Me("scroll",t):a!=null&&x0(t,g,a,o))}switch(n){case"input":NI(t),df(t,i,!1);break;case"textarea":NI(t),hf(t);break;case"option":i.value!=null&&t.setAttribute("value",""+vs(i.value));break;case"select":t.multiple=!!i.multiple,g=i.value,g!=null?Ao(t,!!i.multiple,g,!1):i.defaultValue!=null&&Ao(t,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=nC)}xG(n,i)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(t&&e.stateNode!=null)sZ(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(J(166));n=gg(Fa.current),gg(ai.current),_I(e)?(i=e.stateNode,n=e.memoizedProps,i[os]=e,i.nodeValue!==n&&(e.flags|=4)):(i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[os]=e,e.stateNode=i)}return null;case 13:return Pe(it),i=e.memoizedState,(e.flags&64)!==0?(e.lanes=n,e):(i=i!==null,n=!1,t===null?e.memoizedProps.fallback!==void 0&&_I(e):n=t.memoizedState!==null,i&&!n&&(e.mode&2)!==0&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(it.current&1)!==0?Rt===0&&(Rt=3):((Rt===0||Rt===3)&&(Rt=4),Mt===null||(Ja&134217727)===0&&(Po&134217727)===0||Bo(Mt,Xt))),(i||n)&&(e.flags|=4),null);case 4:return Uo(),ou(e),t===null&&SG(e.stateNode.containerInfo),null;case 10:return nh(e),null;case 17:return $t(e.type)&&sC(),null;case 19:if(Pe(it),i=e.memoizedState,i===null)return null;if(g=(e.flags&64)!==0,o=i.rendering,o===null)if(g)yr(i,!1);else{if(Rt!==0||t!==null&&(t.flags&64)!==0)for(t=e.child;t!==null;){if(o=lC(t),o!==null){for(e.flags|=64,yr(i,!1),g=o.updateQueue,g!==null&&(e.updateQueue=g,e.flags|=4),i.lastEffect===null&&(e.firstEffect=null),e.lastEffect=i.lastEffect,i=n,n=e.child;n!==null;)g=n,t=i,g.flags&=2,g.nextEffect=null,g.firstEffect=null,g.lastEffect=null,o=g.alternate,o===null?(g.childLanes=0,g.lanes=t,g.child=null,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=o.childLanes,g.lanes=o.lanes,g.child=o.child,g.memoizedProps=o.memoizedProps,g.memoizedState=o.memoizedState,g.updateQueue=o.updateQueue,g.type=o.type,t=o.dependencies,g.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return st(it,it.current&1|2),e.child}t=t.sibling}i.tail!==null&&Qt()>cu&&(e.flags|=64,g=!0,yr(i,!1),e.lanes=33554432)}else{if(!g)if(t=lC(o),t!==null){if(e.flags|=64,g=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),yr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ii)return e=e.lastEffect=i.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*Qt()-i.renderingStartTime>cu&&n!==1073741824&&(e.flags|=64,g=!0,yr(i,!1),e.lanes=33554432);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=e.lastEffect,i.renderingStartTime=Qt(),n.sibling=null,e=it.current,st(it,g?e&1|2:e&1),n):null;case 23:case 24:return uh(),t!==null&&t.memoizedState!==null!=(e.memoizedState!==null)&&i.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(J(156,e.tag))}function EV(t){switch(t.tag){case 1:$t(t.type)&&sC();var e=t.flags;return e&4096?(t.flags=e&-4097|64,t):null;case 3:if(Uo(),Pe(qt),Pe(Yt),gh(),e=t.flags,(e&64)!==0)throw Error(J(285));return t.flags=e&-4097|64,t;case 5:return sh(t),null;case 13:return Pe(it),e=t.flags,e&4096?(t.flags=e&-4097|64,t):null;case 19:return Pe(it),null;case 4:return Uo(),null;case 10:return nh(t),null;case 23:case 24:return uh(),null;default:return null}}function Ch(t,e){try{var n="",i=e;do n+=hS(i),i=i.return;while(i);var s=n}catch(g){s=`
Error generating stack: `+g.message+`
`+g.stack}return{value:t,source:e,stack:s}}function ru(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var QV=typeof WeakMap=="function"?WeakMap:Map;function gZ(t,e,n){n=As(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){mC||(mC=!0,Au=i),ru(t,e)},n}function oZ(t,e,n){n=As(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;n.payload=function(){return ru(t,e),i(s)}}var g=t.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(n.callback=function(){typeof i!="function"&&(gi===null?gi=new Set([this]):gi.add(this),ru(t,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}var XV=typeof WeakSet=="function"?WeakSet:Set;function dp(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){ms(t,n)}else e.current=null}function YV(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&t!==null){var n=t.memoizedProps,i=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:Xn(e.type,n),i),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&q0(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(J(163))}function _V(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{if((t.tag&3)===3){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{var s=t;i=s.next,s=s.tag,(s&4)!==0&&(s&1)!==0&&(uZ(n,t),DV(n,t)),t=i}while(t!==e)}return;case 1:t=n.stateNode,n.flags&4&&(e===null?t.componentDidMount():(i=n.elementType===n.type?e.memoizedProps:Xn(n.type,e.memoizedProps),t.componentDidUpdate(i,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),e=n.updateQueue,e!==null&&zf(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}zf(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.flags&4&&xG(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&lG(n))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(J(163))}function up(t,e){for(var n=t;;){if(n.tag===5){var i=n.stateNode;if(e)i=i.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var s=n.memoizedProps.style;s=s!=null&&s.hasOwnProperty("display")?s.display:null,i.style.display=$v("display",s)}}else if(n.tag===6)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((n.tag!==23&&n.tag!==24||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function hp(t,e){if(cg&&typeof cg.onCommitFiberUnmount=="function")try{cg.onCommitFiberUnmount($0,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var n=t=t.next;do{var i=n,s=i.destroy;if(i=i.tag,s!==void 0)if((i&4)!==0)uZ(e,n);else{i=e;try{s()}catch(g){ms(i,g)}}n=n.next}while(n!==t)}break;case 1:if(dp(e),t=e.stateNode,typeof t.componentWillUnmount=="function")try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(g){ms(e,g)}break;case 5:dp(e);break;case 4:rZ(t,e)}}function mp(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function fp(t){return t.tag===5||t.tag===3||t.tag===4}function pp(t){e:{for(var e=t.return;e!==null;){if(fp(e))break e;e=e.return}throw Error(J(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var i=!1;break;case 3:e=e.containerInfo,i=!0;break;case 4:e=e.containerInfo,i=!0;break;default:throw Error(J(161))}n.flags&16&&(ha(e,""),n.flags&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||fp(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2)){n=n.stateNode;break e}}i?au(t,n,e):Iu(t,n,e)}function au(t,e,n){var i=t.tag,s=i===5||i===6;if(s)t=s?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=nC));else if(i!==4&&(t=t.child,t!==null))for(au(t,e,n),t=t.sibling;t!==null;)au(t,e,n),t=t.sibling}function Iu(t,e,n){var i=t.tag,s=i===5||i===6;if(s)t=s?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Iu(t,e,n),t=t.sibling;t!==null;)Iu(t,e,n),t=t.sibling}function rZ(t,e){for(var n=e,i=!1,s,g;;){if(!i){i=n.return;e:for(;;){if(i===null)throw Error(J(160));switch(s=i.stateNode,i.tag){case 5:g=!1;break e;case 3:s=s.containerInfo,g=!0;break e;case 4:s=s.containerInfo,g=!0;break e}i=i.return}i=!0}if(n.tag===5||n.tag===6){e:for(var o=t,r=n,a=r;;)if(hp(o,a),a.child!==null&&a.tag!==4)a.child.return=a,a=a.child;else{if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}g?(o=s,r=n.stateNode,o.nodeType===8?o.parentNode.removeChild(r):o.removeChild(r)):s.removeChild(n.stateNode)}else if(n.tag===4){if(n.child!==null){s=n.stateNode.containerInfo,g=!0,n.child.return=n,n=n.child;continue}}else if(hp(t,n),n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return,n.tag===4&&(i=!1)}n.sibling.return=n.return,n=n.sibling}}function yA(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do(i.tag&3)===3&&(t=i.destroy,i.destroy=void 0,t!==void 0&&t()),i=i.next;while(i!==n)}return;case 1:return;case 5:if(n=e.stateNode,n!=null){i=e.memoizedProps;var s=t!==null?t.memoizedProps:i;t=e.type;var g=e.updateQueue;if(e.updateQueue=null,g!==null){for(n[iC]=i,t==="input"&&i.type==="radio"&&i.name!=null&&zv(n,i),Hd(t,s),e=Hd(t,i),s=0;s<g.length;s+=2){var o=g[s],r=g[s+1];o==="style"?eG(n,r):o==="dangerouslySetInnerHTML"?qv(n,r):o==="children"?ha(n,r):x0(n,o,r,e)}switch(t){case"input":Nd(n,i);break;case"textarea":Ov(n,i);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,g=i.value,g!=null?Ao(n,!!i.multiple,g,!1):t!==!!i.multiple&&(i.defaultValue!=null?Ao(n,!!i.multiple,i.defaultValue,!0):Ao(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(J(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:n=e.stateNode,n.hydrate&&(n.hydrate=!1,lG(n.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(dh=Qt(),up(e.child,!0)),Bp(e);return;case 19:Bp(e);return;case 17:return;case 23:case 24:up(e,e.memoizedState!==null);return}throw Error(J(163))}function Bp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new XV),e.forEach(function(i){var s=jV.bind(null,t,i);n.has(i)||(n.add(i),i.then(s,s))})}}function HV(t,e){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var kV=Math.ceil,hC=Rg.ReactCurrentDispatcher,ch=Rg.ReactCurrentOwner,Ae=0,Mt=null,Ct=null,Xt=0,fg=0,lu=Es(0),Rt=0,sc=null,Mo=0,Ja=0,Po=0,Ah=0,Cu=null,dh=0,cu=1/0;function Jo(){cu=Qt()+500}var ne=null,mC=!1,Au=null,gi=null,Rs=!1,ea=null,Er=90,du=[],uu=[],xi=null,ta=0,hu=null,Vl=-1,Zi=0,Ul=0,na=null,xl=!1;function In(){return(Ae&48)!==0?Qt():Vl!==-1?Vl:Vl=Qt()}function us(t){if(t=t.mode,(t&2)===0)return 1;if((t&4)===0)return Vo()===99?1:2;if(Zi===0&&(Zi=Mo),VV.transition!==0){Ul!==0&&(Ul=Cu!==null?Cu.pendingLanes:0),t=Zi;var e=4186112&~Ul;return e&=-e,e===0&&(t=4186112&~t,e=t&-t,e===0&&(e=8192)),e}return t=Vo(),(Ae&4)!==0&&t===98?t=eC(12,Zi):(t=WS(t),t=eC(t,Zi)),t}function hs(t,e,n){if(50<ta)throw ta=0,hu=null,Error(J(185));if(t=gc(t,e),t===null)return null;jC(t,e,n),t===Mt&&(Po|=e,Rt===4&&Bo(t,Xt));var i=Vo();e===1?(Ae&8)!==0&&(Ae&48)===0?mu(t):(Rn(t,n),Ae===0&&(Jo(),ui())):((Ae&4)===0||i!==98&&i!==99||(xi===null?xi=new Set([t]):xi.add(t)),Rn(t,n)),Cu=t}function gc(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}function Rn(t,e){for(var n=t.callbackNode,i=t.suspendedLanes,s=t.pingedLanes,g=t.expirationTimes,o=t.pendingLanes;0<o;){var r=31-Gs(o),a=1<<r,I=g[r];if(I===-1){if((a&i)===0||(a&s)!==0){I=e,Jg(a);var l=He;g[r]=10<=l?I+250:6<=l?I+5e3:-1}}else I<=e&&(t.expiredLanes|=a);o&=~a}if(i=Ba(t,t===Mt?Xt:0),e=He,i===0)n!==null&&(n!==mA&&qd(n),t.callbackNode=null,t.callbackPriority=0);else{if(n!==null){if(t.callbackPriority===e)return;n!==mA&&qd(n)}e===15?(n=mu.bind(null,t),Gi===null?(Gi=[n],Sl=eh(nc,YG)):Gi.push(n),n=mA):e===14?n=Ga(99,mu.bind(null,t)):(n=wS(e),n=Ga(n,aZ.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function aZ(t){if(Vl=-1,Ul=Zi=0,(Ae&48)!==0)throw Error(J(327));var e=t.callbackNode;if(Qs()&&t.callbackNode!==e)return null;var n=Ba(t,t===Mt?Xt:0);if(n===0)return null;var i=n,s=Ae;Ae|=16;var g=cZ();(Mt!==t||Xt!==i)&&(Jo(),bo(t,i));do try{MV();break}catch(r){CZ(t,r)}while(1);if(th(),hC.current=g,Ae=s,Ct!==null?i=0:(Mt=null,Xt=0,i=Rt),(Mo&Po)!==0)bo(t,0);else if(i!==0){if(i===2&&(Ae|=64,t.hydrate&&(t.hydrate=!1,q0(t.containerInfo)),n=mG(t),n!==0&&(i=Qr(t,n))),i===1)throw e=sc,bo(t,0),Bo(t,n),Rn(t,Qt()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,i){case 0:case 1:throw Error(J(345));case 2:Os(t);break;case 3:if(Bo(t,n),(n&62914560)===n&&(i=dh+500-Qt(),10<i)){if(Ba(t,0)!==0)break;if(s=t.suspendedLanes,(s&n)!==n){In(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Hf(Os.bind(null,t),i);break}Os(t);break;case 4:if(Bo(t,n),(n&4186112)===n)break;for(i=t.eventTimes,s=-1;0<n;){var o=31-Gs(n);g=1<<o,o=i[o],o>s&&(s=o),n&=~g}if(n=s,n=Qt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*kV(n/1960))-n,10<n){t.timeoutHandle=Hf(Os.bind(null,t),n);break}Os(t);break;case 5:Os(t);break;default:throw Error(J(329))}}return Rn(t,Qt()),t.callbackNode===e?aZ.bind(null,t):null}function Bo(t,e){for(e&=~Ah,e&=~Po,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gs(e),i=1<<n;t[n]=-1,e&=~i}}function mu(t){if((Ae&48)!==0)throw Error(J(327));if(Qs(),t===Mt&&(t.expiredLanes&Xt)!==0){var e=Xt,n=Qr(t,e);(Mo&Po)!==0&&(e=Ba(t,e),n=Qr(t,e))}else e=Ba(t,0),n=Qr(t,e);if(t.tag!==0&&n===2&&(Ae|=64,t.hydrate&&(t.hydrate=!1,q0(t.containerInfo)),e=mG(t),e!==0&&(n=Qr(t,e))),n===1)throw n=sc,bo(t,0),Bo(t,e),Rn(t,Qt()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Os(t),Rn(t,Qt()),null}function KV(){if(xi!==null){var t=xi;xi=null,t.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,Rn(e,Qt())})}ui()}function IZ(t,e){var n=Ae;Ae|=1;try{return t(e)}finally{Ae=n,Ae===0&&(Jo(),ui())}}function lZ(t,e){var n=Ae;Ae&=-2,Ae|=8;try{return t(e)}finally{Ae=n,Ae===0&&(Jo(),ui())}}function kI(t,e){st(lu,fg),fg|=e,Mo|=e}function uh(){fg=lu.current,Pe(lu)}function bo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,vV(n)),Ct!==null)for(n=Ct.return;n!==null;){var i=n;switch(i.tag){case 1:i=i.type.childContextTypes,i!=null&&sC();break;case 3:Uo(),Pe(qt),Pe(Yt),gh();break;case 5:sh(i);break;case 4:Uo();break;case 13:Pe(it);break;case 19:Pe(it);break;case 10:nh(i);break;case 23:case 24:uh()}n=n.return}Mt=t,Ct=Fs(t.current,null),Xt=fg=Mo=e,Rt=0,sc=null,Ah=Po=Ja=0}function CZ(t,e){do{var n=Ct;try{if(th(),qr.current=uC,CC){for(var i=rt.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}CC=!1}if(Sa=0,Gt=wt=rt=null,$r=!1,ch.current=null,n===null||n.return===null){Rt=1,sc=e,Ct=null;break}e:{var g=t,o=n.return,r=n,a=e;if(e=Xt,r.flags|=2048,r.firstEffect=r.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a;if((r.mode&2)===0){var l=r.alternate;l?(r.updateQueue=l.updateQueue,r.memoizedState=l.memoizedState,r.lanes=l.lanes):(r.updateQueue=null,r.memoizedState=null)}var C=(it.current&1)!==0,c=o;do{var A;if(A=c.tag===13){var d=c.memoizedState;if(d!==null)A=d.dehydrated!==null;else{var h=c.memoizedProps;A=h.fallback===void 0?!1:h.unstable_avoidThisFallback!==!0?!0:!C}}if(A){var u=c.updateQueue;if(u===null){var m=new Set;m.add(I),c.updateQueue=m}else u.add(I);if((c.mode&2)===0){if(c.flags|=64,r.flags|=16384,r.flags&=-2981,r.tag===1)if(r.alternate===null)r.tag=17;else{var f=As(-1,1);f.tag=2,ds(r,f)}r.lanes|=1;break e}a=void 0,r=e;var p=g.pingCache;if(p===null?(p=g.pingCache=new QV,a=new Set,p.set(I,a)):(a=p.get(I),a===void 0&&(a=new Set,p.set(I,a))),!a.has(r)){a.add(r);var B=OV.bind(null,g,I,r);I.then(B,B)}c.flags|=4096,c.lanes=e;break e}c=c.return}while(c!==null);a=Error((co(r.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Rt!==5&&(Rt=2),a=Ch(a,r),c=o;do{switch(c.tag){case 3:g=a,c.flags|=4096,e&=-e,c.lanes|=e;var G=gZ(c,g,e);Df(c,G);break e;case 1:g=a;var y=c.type,U=c.stateNode;if((c.flags&64)===0&&(typeof y.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(gi===null||!gi.has(U)))){c.flags|=4096,e&=-e,c.lanes|=e;var V=oZ(c,g,e);Df(c,V);break e}}c=c.return}while(c!==null)}dZ(n)}catch(F){e=F,Ct===n&&n!==null&&(Ct=n=n.return);continue}break}while(1)}function cZ(){var t=hC.current;return hC.current=uC,t===null?uC:t}function Qr(t,e){var n=Ae;Ae|=16;var i=cZ();Mt===t&&Xt===e||bo(t,e);do try{LV();break}catch(s){CZ(t,s)}while(1);if(th(),Ae=n,hC.current=i,Ct!==null)throw Error(J(261));return Mt=null,Xt=0,Rt}function LV(){for(;Ct!==null;)AZ(Ct)}function MV(){for(;Ct!==null&&!RV();)AZ(Ct)}function AZ(t){var e=hZ(t.alternate,t,fg);t.memoizedProps=t.pendingProps,e===null?dZ(t):Ct=e,ch.current=null}function dZ(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&2048)===0){if(n=TV(n,e,fg),n!==null){Ct=n;return}if(n=e,n.tag!==24&&n.tag!==23||n.memoizedState===null||(fg&1073741824)!==0||(n.mode&4)===0){for(var i=0,s=n.child;s!==null;)i|=s.lanes|s.childLanes,s=s.sibling;n.childLanes=i}t!==null&&(t.flags&2048)===0&&(t.firstEffect===null&&(t.firstEffect=e.firstEffect),e.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(n=EV(e),n!==null){n.flags&=2047,Ct=n;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(e=e.sibling,e!==null){Ct=e;return}Ct=e=t}while(e!==null);Rt===0&&(Rt=5)}function Os(t){var e=Vo();return mg(99,PV.bind(null,t,e)),null}function PV(t,e){do Qs();while(ea!==null);if((Ae&48)!==0)throw Error(J(327));var n=t.finishedWork;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(J(177));t.callbackNode=null;var i=n.lanes|n.childLanes,s=i,g=t.pendingLanes&~s;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=s,t.mutableReadLanes&=s,t.entangledLanes&=s,s=t.entanglements;for(var o=t.eventTimes,r=t.expirationTimes;0<g;){var a=31-Gs(g),I=1<<a;s[a]=0,o[a]=-1,r[a]=-1,g&=~I}if(xi!==null&&(i&24)===0&&xi.has(t)&&xi.delete(t),t===Mt&&(Ct=Mt=null,Xt=0),1<n.flags?n.lastEffect!==null?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,i!==null){if(s=Ae,Ae|=32,ch.current=null,dA=Gl,o=Nf(),Jd(o)){if("selectionStart"in o)r={start:o.selectionStart,end:o.selectionEnd};else e:if(r=(r=o.ownerDocument)&&r.defaultView||window,(I=r.getSelection&&r.getSelection())&&I.rangeCount!==0){r=I.anchorNode,g=I.anchorOffset,a=I.focusNode,I=I.focusOffset;try{r.nodeType,a.nodeType}catch{r=null;break e}var l=0,C=-1,c=-1,A=0,d=0,h=o,u=null;t:for(;;){for(var m;h!==r||g!==0&&h.nodeType!==3||(C=l+g),h!==a||I!==0&&h.nodeType!==3||(c=l+I),h.nodeType===3&&(l+=h.nodeValue.length),(m=h.firstChild)!==null;)u=h,h=m;for(;;){if(h===o)break t;if(u===r&&++A===g&&(C=l),u===a&&++d===I&&(c=l),(m=h.nextSibling)!==null)break;h=u,u=h.parentNode}h=m}r=C===-1||c===-1?null:{start:C,end:c}}else r=null;r=r||{start:0,end:0}}else r=null;uA={focusedElem:o,selectionRange:r},Gl=!1,na=null,xl=!1,ne=i;do try{JV()}catch(F){if(ne===null)throw Error(J(330));ms(ne,F),ne=ne.nextEffect}while(ne!==null);na=null,ne=i;do try{for(o=t;ne!==null;){var f=ne.flags;if(f&16&&ha(ne.stateNode,""),f&128){var p=ne.alternate;if(p!==null){var B=p.ref;B!==null&&(typeof B=="function"?B(null):B.current=null)}}switch(f&1038){case 2:pp(ne),ne.flags&=-3;break;case 6:pp(ne),ne.flags&=-3,yA(ne.alternate,ne);break;case 1024:ne.flags&=-1025;break;case 1028:ne.flags&=-1025,yA(ne.alternate,ne);break;case 4:yA(ne.alternate,ne);break;case 8:r=ne,rZ(o,r);var G=r.alternate;mp(r),G!==null&&mp(G)}ne=ne.nextEffect}}catch(F){if(ne===null)throw Error(J(330));ms(ne,F),ne=ne.nextEffect}while(ne!==null);if(B=uA,p=Nf(),f=B.focusedElem,o=B.selectionRange,p!==f&&f&&f.ownerDocument&&ZG(f.ownerDocument.documentElement,f)){for(o!==null&&Jd(f)&&(p=o.start,B=o.end,B===void 0&&(B=p),"selectionStart"in f?(f.selectionStart=p,f.selectionEnd=Math.min(B,f.value.length)):(B=(p=f.ownerDocument||document)&&p.defaultView||window,B.getSelection&&(B=B.getSelection(),r=f.textContent.length,G=Math.min(o.start,r),o=o.end===void 0?G:Math.min(o.end,r),!B.extend&&G>o&&(r=o,o=G,G=r),r=wf(f,G),g=wf(f,o),r&&g&&(B.rangeCount!==1||B.anchorNode!==r.node||B.anchorOffset!==r.offset||B.focusNode!==g.node||B.focusOffset!==g.offset)&&(p=p.createRange(),p.setStart(r.node,r.offset),B.removeAllRanges(),G>o?(B.addRange(p),B.extend(g.node,g.offset)):(p.setEnd(g.node,g.offset),B.addRange(p)))))),p=[],B=f;B=B.parentNode;)B.nodeType===1&&p.push({element:B,left:B.scrollLeft,top:B.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<p.length;f++)B=p[f],B.element.scrollLeft=B.left,B.element.scrollTop=B.top}Gl=!!dA,uA=dA=null,t.current=n,ne=i;do try{for(f=t;ne!==null;){var y=ne.flags;if(y&36&&_V(f,ne.alternate,ne),y&128){p=void 0;var U=ne.ref;if(U!==null){var V=ne.stateNode;switch(ne.tag){case 5:p=V;break;default:p=V}typeof U=="function"?U(p):U.current=p}}ne=ne.nextEffect}}catch(F){if(ne===null)throw Error(J(330));ms(ne,F),ne=ne.nextEffect}while(ne!==null);ne=null,SV(),Ae=s}else t.current=n;if(Rs)Rs=!1,ea=t,Er=e;else for(ne=i;ne!==null;)e=ne.nextEffect,ne.nextEffect=null,ne.flags&8&&(y=ne,y.sibling=null,y.stateNode=null),ne=e;if(i=t.pendingLanes,i===0&&(gi=null),i===1?t===hu?ta++:(ta=0,hu=t):ta=0,n=n.stateNode,cg&&typeof cg.onCommitFiberRoot=="function")try{cg.onCommitFiberRoot($0,n,void 0,(n.current.flags&64)===64)}catch{}if(Rn(t,Qt()),mC)throw mC=!1,t=Au,Au=null,t;return(Ae&8)!==0||ui(),null}function JV(){for(;ne!==null;){var t=ne.alternate;xl||na===null||((ne.flags&8)!==0?pf(ne,na)&&(xl=!0):ne.tag===13&&HV(t,ne)&&pf(ne,na)&&(xl=!0));var e=ne.flags;(e&256)!==0&&YV(t,ne),(e&512)===0||Rs||(Rs=!0,Ga(97,function(){return Qs(),null})),ne=ne.nextEffect}}function Qs(){if(Er!==90){var t=97<Er?97:Er;return Er=90,mg(t,zV)}return!1}function DV(t,e){du.push(e,t),Rs||(Rs=!0,Ga(97,function(){return Qs(),null}))}function uZ(t,e){uu.push(e,t),Rs||(Rs=!0,Ga(97,function(){return Qs(),null}))}function zV(){if(ea===null)return!1;var t=ea;if(ea=null,(Ae&48)!==0)throw Error(J(331));var e=Ae;Ae|=32;var n=uu;uu=[];for(var i=0;i<n.length;i+=2){var s=n[i],g=n[i+1],o=s.destroy;if(s.destroy=void 0,typeof o=="function")try{o()}catch(a){if(g===null)throw Error(J(330));ms(g,a)}}for(n=du,du=[],i=0;i<n.length;i+=2){s=n[i],g=n[i+1];try{var r=s.create;s.destroy=r()}catch(a){if(g===null)throw Error(J(330));ms(g,a)}}for(r=t.current.firstEffect;r!==null;)t=r.nextEffect,r.nextEffect=null,r.flags&8&&(r.sibling=null,r.stateNode=null),r=t;return Ae=e,ui(),!0}function bp(t,e,n){e=Ch(n,e),e=gZ(t,e,1),ds(t,e),e=In(),t=gc(t,1),t!==null&&(jC(t,1,e),Rn(t,e))}function ms(t,e){if(t.tag===3)bp(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){bp(n,t,e);break}else if(n.tag===1){var i=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(gi===null||!gi.has(i))){t=Ch(e,t);var s=oZ(n,t,1);if(ds(n,s),s=In(),n=gc(n,1),n!==null)jC(n,1,s),Rn(n,s);else if(typeof i.componentDidCatch=="function"&&(gi===null||!gi.has(i)))try{i.componentDidCatch(e,t)}catch{}break}}n=n.return}}function OV(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,Mt===t&&(Xt&n)===n&&(Rt===4||Rt===3&&(Xt&62914560)===Xt&&500>Qt()-dh?bo(t,0):Ah|=n),Rn(t,e)}function jV(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=t.mode,(e&2)===0?e=1:(e&4)===0?e=Vo()===99?1:2:(Zi===0&&(Zi=Mo),e=Dg(62914560&~Zi),e===0&&(e=4194304))),n=In(),t=gc(t,e),t!==null&&(jC(t,e,n),Rn(t,n))}var hZ;hZ=function(t,e,n){var i=e.lanes;if(t!==null)if(t.memoizedProps!==e.pendingProps||qt.current)_n=!0;else if((n&i)!==0)_n=(t.flags&16384)!==0;else{switch(_n=!1,e.tag){case 3:rp(e),pA();break;case 5:qf(e);break;case 1:$t(e.type)&&Fl(e);break;case 4:tu(e,e.stateNode.containerInfo);break;case 10:i=e.memoizedProps.value;var s=e.type._context;st(gC,s._currentValue),s._currentValue=i;break;case 13:if(e.memoizedState!==null)return(n&e.child.childLanes)!==0?ap(t,e,n):(st(it,it.current&1),e=Vi(t,e,n),e!==null?e.sibling:null);st(it,it.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&64)!==0){if(i)return Ap(t,e,n);e.flags|=64}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),st(it,it.current),i)break;return null;case 23:case 24:return e.lanes=0,BA(t,e,n)}return Vi(t,e,n)}else _n=!1;switch(e.lanes=0,e.tag){case 2:if(i=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,s=So(e,Yt.current),fo(e,n),s=rh(null,e,i,t,s,n),e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,$t(i)){var g=!0;Fl(e)}else g=!1;e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,ih(e);var o=i.getDerivedStateFromProps;typeof o=="function"&&aC(e,i,o,t),s.updater=ic,e.stateNode=s,s._reactInternals=e,eu(e,i,t,n),e=gu(null,e,i,!0,g,n)}else e.tag=0,jt(null,e,s,n),e=e.child;return e;case 16:s=e.elementType;e:{switch(t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,g=s._init,s=g(s._payload),e.type=s,g=e.tag=$V(s),t=Xn(s,t),g){case 0:e=su(null,e,s,t,n);break e;case 1:e=op(null,e,s,t,n);break e;case 11:e=sp(null,e,s,t,n);break e;case 14:e=gp(null,e,s,Xn(s.type,t),i,n);break e}throw Error(J(306,s,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Xn(i,s),su(t,e,i,s,n);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Xn(i,s),op(t,e,i,s,n);case 3:if(rp(e),i=e.updateQueue,t===null||i===null)throw Error(J(282));if(i=e.pendingProps,s=e.memoizedState,s=s!==null?s.element:null,HG(t,e),Za(e,i,null,n),i=e.memoizedState.element,i===s)pA(),e=Vi(t,e,n);else{if(s=e.stateNode,(g=s.hydrate)&&(rs=mo(e.stateNode.containerInfo.firstChild),Si=e,g=Ii=!0),g){if(t=s.mutableSourceEagerHydrationData,t!=null)for(s=0;s<t.length;s+=2)g=t[s],g._workInProgressVersionPrimary=t[s+1],po.push(g);for(n=MG(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|1024,n=n.sibling}else jt(t,e,i,n),pA();e=e.child}return e;case 5:return qf(e),t===null&&nu(e),i=e.type,s=e.pendingProps,g=t!==null?t.memoizedProps:null,o=s.children,Od(i,s)?o=null:g!==null&&Od(i,g)&&(e.flags|=16),tZ(t,e),jt(t,e,o,n),e.child;case 6:return t===null&&nu(e),null;case 13:return ap(t,e,n);case 4:return tu(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=IC(e,null,i,n):jt(t,e,i,n),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Xn(i,s),sp(t,e,i,s,n);case 7:return jt(t,e,e.pendingProps,n),e.child;case 8:return jt(t,e,e.pendingProps.children,n),e.child;case 12:return jt(t,e,e.pendingProps.children,n),e.child;case 10:e:{i=e.type._context,s=e.pendingProps,o=e.memoizedProps,g=s.value;var r=e.type._context;if(st(gC,r._currentValue),r._currentValue=g,o!==null)if(r=o.value,g=Bn(r,g)?0:(typeof i._calculateChangedBits=="function"?i._calculateChangedBits(r,g):1073741823)|0,g===0){if(o.children===s.children&&!qt.current){e=Vi(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var a=r.dependencies;if(a!==null){o=r.child;for(var I=a.firstContext;I!==null;){if(I.context===i&&(I.observedBits&g)!==0){r.tag===1&&(I=As(-1,n&-n),I.tag=2,ds(r,I)),r.lanes|=n,I=r.alternate,I!==null&&(I.lanes|=n),_G(r.return,n),a.lanes|=n;break}I=I.next}}else o=r.tag===10&&r.type===e.type?null:r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}jt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,g=e.pendingProps,i=g.children,fo(e,n),s=Zn(s,g.unstable_observedBits),i=i(s),e.flags|=1,jt(t,e,i,n),e.child;case 14:return s=e.type,g=Xn(s,e.pendingProps),g=Xn(s.type,g),gp(t,e,s,g,i,n);case 15:return eZ(t,e,e.type,e.pendingProps,i,n);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Xn(i,s),t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,$t(i)?(t=!0,Fl(e)):t=!1,fo(e,n),KG(e,i,s),eu(e,i,s,n),gu(null,e,i,!0,t,n);case 19:return Ap(t,e,n);case 23:return BA(t,e,n);case 24:return BA(t,e,n)}throw Error(J(156,e.tag))};function qV(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function bn(t,e,n,i){return new qV(t,e,n,i)}function hh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function $V(t){if(typeof t=="function")return hh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===DC)return 11;if(t===zC)return 14}return 2}function Fs(t,e){var n=t.alternate;return n===null?(n=bn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Wl(t,e,n,i,s,g){var o=2;if(i=t,typeof t=="function")hh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ss:return yo(n.children,s,g,e);case Pv:o=8,s|=16;break;case W0:o=8,s|=1;break;case Mr:return t=bn(12,n,e,s|8),t.elementType=Mr,t.type=Mr,t.lanes=g,t;case Pr:return t=bn(13,n,e,s),t.type=Pr,t.elementType=Pr,t.lanes=g,t;case Ol:return t=bn(19,n,e,s),t.elementType=Ol,t.lanes=g,t;case X0:return mh(n,s,g,e);case Wd:return t=bn(24,n,e,s),t.elementType=Wd,t.lanes=g,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case w0:o=10;break e;case N0:o=9;break e;case DC:o=11;break e;case zC:o=14;break e;case T0:o=16,i=null;break e;case E0:o=22;break e}throw Error(J(130,t==null?t:typeof t,""))}return e=bn(o,n,e,s),e.elementType=t,e.type=i,e.lanes=g,e}function yo(t,e,n,i){return t=bn(7,t,i,e),t.lanes=n,t}function mh(t,e,n,i){return t=bn(23,t,i,e),t.elementType=X0,t.lanes=n,t}function vA(t,e,n){return t=bn(6,t,null,e),t.lanes=n,t}function GA(t,e,n){return e=bn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function e3(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=rA(0),this.expirationTimes=rA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rA(0),this.mutableSourceEagerHydrationData=null}function t3(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ng,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function fC(t,e,n,i){var s=e.current,g=In(),o=us(s);e:if(n){n=n._reactInternals;t:{if(Fg(n)!==n||n.tag!==1)throw Error(J(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break t;case 1:if($t(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break t}}r=r.return}while(r!==null);throw Error(J(171))}if(n.tag===1){var a=n.type;if($t(a)){n=wG(n,a,r);break e}}n=r}else n=Zs;return e.context===null?e.context=n:e.pendingContext=n,e=As(g,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),ds(s,e),hs(s,o,g),o}function ZA(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function yp(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function fh(t,e){yp(t,e),(t=t.alternate)&&yp(t,e)}function n3(){return null}function ph(t,e,n){var i=n!=null&&n.hydrationOptions!=null&&n.hydrationOptions.mutableSources||null;if(n=new e3(t,e,n!=null&&n.hydrate===!0),e=bn(3,null,null,e===2?7:e===1?3:0),n.current=e,e.stateNode=n,ih(e),t[Lo]=n.current,SG(t.nodeType===8?t.parentNode:t),i)for(t=0;t<i.length;t++){e=i[t];var s=e._getVersion;s=s(e._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[e,s]:n.mutableSourceEagerHydrationData.push(e,s)}this._internalRoot=n}ph.prototype.render=function(t){fC(t,this._internalRoot,null,null)};ph.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;fC(null,t,null,function(){e[Lo]=null})};function Da(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function i3(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new ph(t,0,e?{hydrate:!0}:void 0)}function oc(t,e,n,i,s){var g=n._reactRootContainer;if(g){var o=g._internalRoot;if(typeof s=="function"){var r=s;s=function(){var I=ZA(o);r.call(I)}}fC(e,o,t,s)}else{if(g=n._reactRootContainer=i3(n,i),o=g._internalRoot,typeof s=="function"){var a=s;s=function(){var I=ZA(o);a.call(I)}}lZ(function(){fC(e,o,t,s)})}return ZA(o)}rG=function(t){if(t.tag===13){var e=In();hs(t,4,e),fh(t,4)}};K0=function(t){if(t.tag===13){var e=In();hs(t,67108864,e),fh(t,67108864)}};aG=function(t){if(t.tag===13){var e=In(),n=us(t);hs(t,n,e),fh(t,n)}};IG=function(t,e){return e()};kd=function(t,e,n){switch(e){case"input":if(Nd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=tc(i);if(!s)throw Error(J(90));Dv(i),Nd(i,s)}}}break;case"textarea":Ov(t,n);break;case"select":e=n.value,e!=null&&Ao(t,!!n.multiple,e,!1)}};_0=IZ;iG=function(t,e,n,i,s){var g=Ae;Ae|=4;try{return mg(98,t.bind(null,e,n,i,s))}finally{Ae=g,Ae===0&&(Jo(),ui())}};H0=function(){(Ae&49)===0&&(KV(),Qs())};sG=function(t,e){var n=Ae;Ae|=2;try{return t(e)}finally{Ae=n,Ae===0&&(Jo(),ui())}};function mZ(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Da(e))throw Error(J(200));return t3(t,e,null,n)}var s3={Events:[Ma,no,tc,tG,nG,Qs,{current:!1}]},vr={findFiberByHostInstance:sg,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},g3={bundleType:vr.bundleType,version:vr.version,rendererPackageName:vr.rendererPackageName,rendererConfig:vr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Rg.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=oG(t),t===null?null:t.stateNode},findFiberByHostInstance:vr.findFiberByHostInstance||n3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var KI=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!KI.isDisabled&&KI.supportsFiber)try{$0=KI.inject(g3),cg=KI}catch{}}Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s3;Sn.createPortal=mZ;Sn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(J(188)):Error(J(268,Object.keys(t)));return t=oG(e),t=t===null?null:t.stateNode,t};Sn.flushSync=function(t,e){var n=Ae;if((n&48)!==0)return t(e);Ae|=1;try{if(t)return mg(99,t.bind(null,e))}finally{Ae=n,ui()}};Sn.hydrate=function(t,e,n){if(!Da(e))throw Error(J(200));return oc(null,t,e,!0,n)};Sn.render=function(t,e,n){if(!Da(e))throw Error(J(200));return oc(null,t,e,!1,n)};Sn.unmountComponentAtNode=function(t){if(!Da(t))throw Error(J(40));return t._reactRootContainer?(lZ(function(){oc(null,null,t,!1,function(){t._reactRootContainer=null,t[Lo]=null})}),!0):!1};Sn.unstable_batchedUpdates=IZ;Sn.unstable_createPortal=function(t,e){return mZ(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Sn.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Da(n))throw Error(J(200));if(t==null||t._reactInternals===void 0)throw Error(J(38));return oc(t,e,n,!1,i)};Sn.version="17.0.2";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=Sn})(ki);const wl=Fv(ki.exports),xo=Symbol(),fZ=t=>!!t[xo],o3=t=>!t[xo].c,LI=t=>{var e,n;(n=(e=t[xo]).c)==null||n.call(e)},Nl=(t,e)=>{const n=t[xo].o,i=e[xo].o;return n===i||t===i||fZ(n)&&Nl(n,e)},vp=t=>{const e={o:t,c:null},n=new Promise(i=>{e.c=()=>{e.c=null,i()},t.then(e.c,e.c)});return n[xo]=e,n};var r3=Object.defineProperty,a3=Object.defineProperties,I3=Object.getOwnPropertyDescriptors,Gp=Object.getOwnPropertySymbols,l3=Object.prototype.hasOwnProperty,C3=Object.prototype.propertyIsEnumerable,Zp=(t,e,n)=>e in t?r3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,c3=(t,e)=>{for(var n in e||(e={}))l3.call(e,n)&&Zp(t,n,e[n]);if(Gp)for(var n of Gp(e))C3.call(e,n)&&Zp(t,n,e[n]);return t},A3=(t,e)=>a3(t,I3(e));const RA=t=>"init"in t,pZ="r",BZ="w",Bh="c",bZ="s",d3="h";const u3=t=>{const e=new WeakMap,n=new WeakMap,i=new Map;let s,g;if(t)for(const[x,S]of t){const w={v:S,r:0,d:new Map};e.set(x,w)}const o=new WeakMap,r=(x,S,w)=>{let T=o.get(S);T||(T=new Map,o.set(S,T)),w.then(()=>{T.get(x)===w&&(T.delete(x),T.size||o.delete(S))}),T.set(x,w)},a=x=>{const S=new Set,w=o.get(x);return w&&(o.delete(x),w.forEach((T,Y)=>{LI(T),S.add(Y)})),S},I=new WeakMap,l=x=>{let S=I.get(x);return S||(S=new Map,I.set(x,S)),S},C=(x,S)=>{if(x){const w=l(x);let T=w.get(S);return T||(T=C(x.p,S),T&&("p"in T&&T.p.then(()=>w.delete(S)),w.set(S,T))),T}return e.get(S)},c=(x,S,w)=>{if(x)l(x).set(S,w);else{const T=e.get(S);e.set(S,w),i.has(S)||i.set(S,T)}},A=(x,S=new Map,w)=>{if(!w)return S;const T=new Map;let Y=!1;return w.forEach(Q=>{var _;const D=((_=C(x,Q))==null?void 0:_.r)||0;T.set(Q,D),S.get(Q)!==D&&(Y=!0)}),S.size===T.size&&!Y?S:T},d=(x,S,w,T,Y)=>{const Q=C(x,S);if(Q){if(Y&&(!("p"in Q)||!Nl(Q.p,Y)))return Q;"p"in Q&&LI(Q.p)}const _={v:w,r:(Q==null?void 0:Q.r)||0,d:A(x,Q==null?void 0:Q.d,T)};return!Q||!("v"in Q)||!Object.is(Q.v,w)?(++_.r,_.d.has(S)&&(_.d=new Map(_.d).set(S,_.r))):_.d!==Q.d&&(_.d.size!==Q.d.size||!Array.from(_.d.keys()).every(D=>Q.d.has(D)))&&Promise.resolve().then(()=>{z(x)}),c(x,S,_),_},h=(x,S,w,T,Y)=>{const Q=C(x,S);if(Q){if(Y&&(!("p"in Q)||!Nl(Q.p,Y)))return Q;"p"in Q&&LI(Q.p)}const _={e:w,r:(Q==null?void 0:Q.r)||0,d:A(x,Q==null?void 0:Q.d,T)};return c(x,S,_),_},u=(x,S,w,T)=>{const Y=C(x,S);if(Y&&"p"in Y){if(Nl(Y.p,w))return Y;LI(Y.p)}r(x,S,w);const Q={p:w,r:(Y==null?void 0:Y.r)||0,d:A(x,Y==null?void 0:Y.d,T)};return c(x,S,Q),Q},m=(x,S,w,T)=>{if(w instanceof Promise){const Y=vp(w.then(Q=>{d(x,S,Q,T,Y),z(x)}).catch(Q=>{if(Q instanceof Promise)return fZ(Q)?Q.then(()=>{p(x,S,!0)}):Q;h(x,S,Q,T,Y),z(x)}));return u(x,S,Y,T)}return d(x,S,w,T)},f=(x,S)=>{const w=C(x,S);if(w){const T=A3(c3({},w),{i:w.r});c(x,S,T)}},p=(x,S,w)=>{if(!w){const Y=C(x,S);if(Y&&(Y.r!==Y.i&&"p"in Y&&!o3(Y.p)||(Y.d.forEach((Q,_)=>{if(_!==S)if(!n.has(_))p(x,_);else{const D=C(x,_);D&&D.r===D.i&&p(x,_)}}),Array.from(Y.d).every(([Q,_])=>{const D=C(x,Q);return D&&"v"in D&&D.r===_}))))return Y}const T=new Set;try{const Y=S.read(Q=>{T.add(Q);const _=Q===S?C(x,Q):p(x,Q);if(_){if("e"in _)throw _.e;if("p"in _)throw _.p;return _.v}if(RA(Q))return Q.init;throw new Error("no atom init")});return m(x,S,Y,T)}catch(Y){if(Y instanceof Promise){const Q=vp(Y);return u(x,S,Q,T)}return h(x,S,Y,T)}},B=(x,S)=>p(S,x),G=x=>{let S=n.get(x);return S||(S=E(x)),S},y=(x,S)=>!S.l.size&&(!S.t.size||S.t.size===1&&S.t.has(x)),U=x=>{const S=n.get(x);S&&y(x,S)&&H(x)},V=(x,S)=>{const w=n.get(S);w==null||w.t.forEach(T=>{T!==S&&(f(x,T),V(x,T))})},F=(x,S,w)=>{let T=!0;const Y=(D,ge)=>{typeof ge=="boolean"&&(console.warn("[DEPRECATED] Please use { unstable_promise: true }"),ge={unstable_promise:ge});const te=p(x,D);if("e"in te)throw te.e;if("p"in te){if(ge!=null&&ge.unstable_promise)return te.p.then(()=>Y(D,ge));throw te.p}if("v"in te)return te.v;throw new Error("no value found")},Q=(D,ge)=>{let te;if(D===S){if(!RA(D))throw new Error("atom not writable");a(D).forEach(ae=>{ae!==x&&m(ae,D,ge)}),m(x,D,ge),V(x,D)}else te=F(x,D,ge);return T||z(x),te},_=S.write(Y,Q,w);return T=!1,x=void 0,_},W=(x,S,w)=>{const T=F(w,x,S);return z(w),T},M=x=>!!x.write,E=(x,S)=>{const w={t:new Set(S&&[S]),l:new Set};if(n.set(x,w),p(void 0,x).d.forEach((Y,Q)=>{const _=n.get(Q);_?_.t.add(x):Q!==x&&E(Q,x)}),M(x)&&x.onMount){const Y=_=>W(x,_),Q=x.onMount(Y);Q&&(w.u=Q)}return w},H=x=>{var S;const w=(S=n.get(x))==null?void 0:S.u;w&&w(),n.delete(x);const T=C(void 0,x);T&&T.d.forEach((Y,Q)=>{if(Q!==x){const _=n.get(Q);_&&(_.t.delete(x),y(Q,_)&&H(Q))}})},P=(x,S,w)=>{const T=new Set(S.d.keys());w==null||w.forEach((Y,Q)=>{if(T.has(Q)){T.delete(Q);return}const _=n.get(Q);_&&(_.t.delete(x),y(Q,_)&&H(Q))}),T.forEach(Y=>{const Q=n.get(Y);Q?Q.t.add(x):n.has(x)&&E(Y,x)})},z=x=>{if(x){l(x).forEach((w,T)=>{if(w!==e.get(T)){const Y=n.get(T);Y==null||Y.l.forEach(Q=>Q(x))}});return}for(;i.size;){const S=Array.from(i);i.clear(),S.forEach(([w,T])=>{const Y=C(void 0,w);Y&&Y.d!==(T==null?void 0:T.d)&&P(w,Y,T==null?void 0:T.d);const Q=n.get(w);Q==null||Q.l.forEach(_=>_())})}},re=x=>{l(x).forEach((w,T)=>{const Y=e.get(T);(w.r>((Y==null?void 0:Y.r)||0)||"v"in w&&w.r===(Y==null?void 0:Y.r)&&w.d!==(Y==null?void 0:Y.d))&&(e.set(T,w),w.d!==(Y==null?void 0:Y.d)&&P(T,w,Y==null?void 0:Y.d))})},ue=(x,S)=>{S&&re(S),z(void 0)},ie=(x,S)=>{const T=G(x).l;return T.add(S),()=>{T.delete(S),U(x)}},ce=(x,S)=>{for(const[w,T]of x)RA(w)&&(m(S,w,T),V(S,w));z(S)};return{[pZ]:B,[BZ]:W,[Bh]:ue,[bZ]:ie,[d3]:ce}},yZ=t=>({s:u3(t)}),FA=new Map,bh=t=>(FA.has(t)||FA.set(t,Z.exports.createContext(yZ())),FA.get(t));const h3=({children:t,initialValues:e,scope:n,unstable_enableVersionedWrite:i})=>{const[s,g]=Z.exports.useState();Z.exports.useEffect(()=>{s&&(o.current.s[Bh](null,s),delete s.p)},[s]);const o=Z.exports.useRef();o.current||(o.current=yZ(e),i&&(o.current.w=a=>{g(I=>{const l=I?{p:I}:{};return a(l),l})}));const r=bh(n);return Z.exports.createElement(r.Provider,{value:o.current},t)};let m3=0;function Yn(t,e){const n=`atom${++m3}`,i={toString:()=>n};return typeof t=="function"?i.read=t:(i.init=t,i.read=s=>s(i),i.write=(s,g,o)=>g(i,typeof o=="function"?o(s(i)):o)),e&&(i.write=e),i}const f3=t=>!!t.write;function Ai(t,e){"scope"in t&&(console.warn("atom.scope is deprecated. Please do useAtom(atom, scope) instead."),e=t.scope);const n=bh(e),{s:i,w:s}=Z.exports.useContext(n),g=Z.exports.useCallback(C=>{const c=i[pZ](t,C);if("e"in c)throw c.e;if("p"in c)throw c.p;if("v"in c)return c.v;throw new Error("no atom value")},[i,t]),[[o,r,a],I]=Z.exports.useReducer(Z.exports.useCallback((C,c)=>{const A=g(c);return Object.is(C[1],A)&&C[2]===t?C:[c,A,t]},[g,t]),void 0,()=>{const c=g(void 0);return[void 0,c,t]});a!==t&&I(void 0),Z.exports.useEffect(()=>{const C=i[bZ](t,I);return I(void 0),C},[i,t]),Z.exports.useEffect(()=>{i[Bh](t,o)});const l=Z.exports.useCallback(C=>{if(f3(t)){const c=A=>i[BZ](t,C,A);return s?s(c):c()}else throw new Error("not writable atom")},[i,s,t]);return Z.exports.useDebugValue(r),[r,l]}function L(){return L=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},L.apply(this,arguments)}function fu(t){return fu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fu(t)}function SA(t){return t&&fu(t)==="object"&&t.constructor===Object}function Wo(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{clone:!0},i=n.clone?L({},t):t;return SA(t)&&SA(e)&&Object.keys(e).forEach(function(s){s!=="__proto__"&&(SA(e[s])&&s in t?i[s]=Wo(t[s],e[s],n):i[s]=e[s])}),i}var vZ={exports:{}},p3="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",B3=p3,b3=B3;function GZ(){}function ZZ(){}ZZ.resetWarningCache=GZ;var y3=function(){function t(i,s,g,o,r,a){if(a!==b3){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:ZZ,resetWarningCache:GZ};return n.PropTypes=n,n};vZ.exports=y3();function ee(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Va(t){for(var e="https://material-ui.com/production-error/?code="+t,n=1;n<arguments.length;n+=1)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified Material-UI error #"+t+"; visit "+e+" for the full message."}var v3={exports:{}},Qe={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rc=60103,ac=60106,za=60107,Oa=60108,ja=60114,qa=60109,$a=60110,eI=60112,tI=60113,yh=60120,nI=60115,iI=60116,RZ=60121,FZ=60122,SZ=60117,VZ=60129,UZ=60131;if(typeof Symbol=="function"&&Symbol.for){var yt=Symbol.for;rc=yt("react.element"),ac=yt("react.portal"),za=yt("react.fragment"),Oa=yt("react.strict_mode"),ja=yt("react.profiler"),qa=yt("react.provider"),$a=yt("react.context"),eI=yt("react.forward_ref"),tI=yt("react.suspense"),yh=yt("react.suspense_list"),nI=yt("react.memo"),iI=yt("react.lazy"),RZ=yt("react.block"),FZ=yt("react.server.block"),SZ=yt("react.fundamental"),VZ=yt("react.debug_trace_mode"),UZ=yt("react.legacy_hidden")}function zn(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case rc:switch(t=t.type,t){case za:case ja:case Oa:case tI:case yh:return t;default:switch(t=t&&t.$$typeof,t){case $a:case eI:case iI:case nI:case qa:return t;default:return e}}case ac:return e}}}var G3=qa,Z3=rc,R3=eI,F3=za,S3=iI,V3=nI,U3=ac,x3=ja,W3=Oa,w3=tI;Qe.ContextConsumer=$a;Qe.ContextProvider=G3;Qe.Element=Z3;Qe.ForwardRef=R3;Qe.Fragment=F3;Qe.Lazy=S3;Qe.Memo=V3;Qe.Portal=U3;Qe.Profiler=x3;Qe.StrictMode=W3;Qe.Suspense=w3;Qe.isAsyncMode=function(){return!1};Qe.isConcurrentMode=function(){return!1};Qe.isContextConsumer=function(t){return zn(t)===$a};Qe.isContextProvider=function(t){return zn(t)===qa};Qe.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===rc};Qe.isForwardRef=function(t){return zn(t)===eI};Qe.isFragment=function(t){return zn(t)===za};Qe.isLazy=function(t){return zn(t)===iI};Qe.isMemo=function(t){return zn(t)===nI};Qe.isPortal=function(t){return zn(t)===ac};Qe.isProfiler=function(t){return zn(t)===ja};Qe.isStrictMode=function(t){return zn(t)===Oa};Qe.isSuspense=function(t){return zn(t)===tI};Qe.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===za||t===ja||t===VZ||t===Oa||t===tI||t===yh||t===UZ||typeof t=="object"&&t!==null&&(t.$$typeof===iI||t.$$typeof===nI||t.$$typeof===qa||t.$$typeof===$a||t.$$typeof===eI||t.$$typeof===SZ||t.$$typeof===RZ||t[0]===FZ)};Qe.typeOf=zn;(function(t){t.exports=Qe})(v3);var N3=typeof Symbol=="function"&&Symbol.for;const xZ=N3?Symbol.for("mui.nested"):"__THEME_NESTED__";var T3=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];function E3(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.disableGlobal,n=e===void 0?!1:e,i=t.productionPrefix,s=i===void 0?"jss":i,g=t.seed,o=g===void 0?"":g,r=o===""?"":"".concat(o,"-"),a=0,I=function(){return a+=1,a};return function(l,C){var c=C.options.name;if(c&&c.indexOf("Mui")===0&&!C.options.link&&!n){if(T3.indexOf(l.key)!==-1)return"Mui-".concat(l.key);var A="".concat(r).concat(c,"-").concat(l.key);return!C.options.theme[xZ]||o!==""?A:"".concat(A,"-").concat(I())}return"".concat(r).concat(s).concat(I())}}function WZ(t){var e=t.theme,n=t.name,i=t.props;if(!e||!e.props||!e.props[n])return i;var s=e.props[n],g;for(g in s)i[g]===void 0&&(i[g]=s[g]);return i}var Rp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sI=(typeof window>"u"?"undefined":Rp(window))==="object"&&(typeof document>"u"?"undefined":Rp(document))==="object"&&document.nodeType===9;function Fp(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vh(t,e,n){return e&&Fp(t.prototype,e),n&&Fp(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function pu(t,e){return pu=Object.setPrototypeOf||function(i,s){return i.__proto__=s,i},pu(t,e)}function Ic(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,pu(t,e)}function Bu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lc(t,e){if(t==null)return{};var n={},i=Object.keys(t),s,g;for(g=0;g<i.length;g++)s=i[g],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}var Q3={}.constructor;function bu(t){if(t==null||typeof t!="object")return t;if(Array.isArray(t))return t.map(bu);if(t.constructor!==Q3)return t;var e={};for(var n in t)e[n]=bu(t[n]);return e}function Gh(t,e,n){t===void 0&&(t="unnamed");var i=n.jss,s=bu(e),g=i.plugins.onCreateRule(t,s,n);return g||(t[0],null)}var Sp=function(e,n){for(var i="",s=0;s<e.length&&e[s]!=="!important";s++)i&&(i+=n),i+=e[s];return i},Ag=function(e,n){if(n===void 0&&(n=!1),!Array.isArray(e))return e;var i="";if(Array.isArray(e[0]))for(var s=0;s<e.length&&e[s]!=="!important";s++)i&&(i+=", "),i+=Sp(e[s]," ");else i=Sp(e,", ");return!n&&e[e.length-1]==="!important"&&(i+=" !important"),i};function Do(t){return t&&t.format===!1?{linebreak:"",space:""}:{linebreak:`
`,space:" "}}function Gr(t,e){for(var n="",i=0;i<e;i++)n+="  ";return n+t}function Ua(t,e,n){n===void 0&&(n={});var i="";if(!e)return i;var s=n,g=s.indent,o=g===void 0?0:g,r=e.fallbacks;n.format===!1&&(o=-1/0);var a=Do(n),I=a.linebreak,l=a.space;if(t&&o++,r)if(Array.isArray(r))for(var C=0;C<r.length;C++){var c=r[C];for(var A in c){var d=c[A];d!=null&&(i&&(i+=I),i+=Gr(A+":"+l+Ag(d)+";",o))}}else for(var h in r){var u=r[h];u!=null&&(i&&(i+=I),i+=Gr(h+":"+l+Ag(u)+";",o))}for(var m in e){var f=e[m];f!=null&&m!=="fallbacks"&&(i&&(i+=I),i+=Gr(m+":"+l+Ag(f)+";",o))}return!i&&!n.allowEmpty||!t?i:(o--,i&&(i=""+I+i+I),Gr(""+t+l+"{"+i,o)+Gr("}",o))}var X3=/([[\].#*$><+~=|^:(),"'`\s])/g,Vp=typeof CSS<"u"&&CSS.escape,Zh=function(t){return Vp?Vp(t):t.replace(X3,"\\$1")},wZ=function(){function t(n,i,s){this.type="style",this.isProcessed=!1;var g=s.sheet,o=s.Renderer;this.key=n,this.options=s,this.style=i,g?this.renderer=g.renderer:o&&(this.renderer=new o)}var e=t.prototype;return e.prop=function(i,s,g){if(s===void 0)return this.style[i];var o=g?g.force:!1;if(!o&&this.style[i]===s)return this;var r=s;(!g||g.process!==!1)&&(r=this.options.jss.plugins.onChangeValue(s,i,this));var a=r==null||r===!1,I=i in this.style;if(a&&!I&&!o)return this;var l=a&&I;if(l?delete this.style[i]:this.style[i]=r,this.renderable&&this.renderer)return l?this.renderer.removeProperty(this.renderable,i):this.renderer.setProperty(this.renderable,i,r),this;var C=this.options.sheet;return C&&C.attached,this},t}(),yu=function(t){Ic(e,t);function e(i,s,g){var o;o=t.call(this,i,s,g)||this;var r=g.selector,a=g.scoped,I=g.sheet,l=g.generateId;return r?o.selectorText=r:a!==!1&&(o.id=l(Bu(Bu(o)),I),o.selectorText="."+Zh(o.id)),o}var n=e.prototype;return n.applyTo=function(s){var g=this.renderer;if(g){var o=this.toJSON();for(var r in o)g.setProperty(s,r,o[r])}return this},n.toJSON=function(){var s={};for(var g in this.style){var o=this.style[g];typeof o!="object"?s[g]=o:Array.isArray(o)&&(s[g]=Ag(o))}return s},n.toString=function(s){var g=this.options.sheet,o=g?g.options.link:!1,r=o?L({},s,{allowEmpty:!0}):s;return Ua(this.selectorText,this.style,r)},vh(e,[{key:"selector",set:function(s){if(s!==this.selectorText){this.selectorText=s;var g=this.renderer,o=this.renderable;if(!(!o||!g)){var r=g.setSelector(o,s);r||g.replaceRule(o,this)}}},get:function(){return this.selectorText}}]),e}(wZ),Y3={onCreateRule:function(e,n,i){return e[0]==="@"||i.parent&&i.parent.type==="keyframes"?null:new yu(e,n,i)}},VA={indent:1,children:!0},_3=/@([\w-]+)/,H3=function(){function t(n,i,s){this.type="conditional",this.isProcessed=!1,this.key=n;var g=n.match(_3);this.at=g?g[1]:"unknown",this.query=s.name||"@"+this.at,this.options=s,this.rules=new Cc(L({},s,{parent:this}));for(var o in i)this.rules.add(o,i[o]);this.rules.process()}var e=t.prototype;return e.getRule=function(i){return this.rules.get(i)},e.indexOf=function(i){return this.rules.indexOf(i)},e.addRule=function(i,s,g){var o=this.rules.add(i,s,g);return o?(this.options.jss.plugins.onProcessRule(o),o):null},e.replaceRule=function(i,s,g){var o=this.rules.replace(i,s,g);return o&&this.options.jss.plugins.onProcessRule(o),o},e.toString=function(i){i===void 0&&(i=VA);var s=Do(i),g=s.linebreak;if(i.indent==null&&(i.indent=VA.indent),i.children==null&&(i.children=VA.children),i.children===!1)return this.query+" {}";var o=this.rules.toString(i);return o?this.query+" {"+g+o+g+"}":""},t}(),k3=/@media|@supports\s+/,K3={onCreateRule:function(e,n,i){return k3.test(e)?new H3(e,n,i):null}},UA={indent:1,children:!0},L3=/@keyframes\s+([\w-]+)/,vu=function(){function t(n,i,s){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var g=n.match(L3);g&&g[1]?this.name=g[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=s;var o=s.scoped,r=s.sheet,a=s.generateId;this.id=o===!1?this.name:Zh(a(this,r)),this.rules=new Cc(L({},s,{parent:this}));for(var I in i)this.rules.add(I,i[I],L({},s,{parent:this}));this.rules.process()}var e=t.prototype;return e.toString=function(i){i===void 0&&(i=UA);var s=Do(i),g=s.linebreak;if(i.indent==null&&(i.indent=UA.indent),i.children==null&&(i.children=UA.children),i.children===!1)return this.at+" "+this.id+" {}";var o=this.rules.toString(i);return o&&(o=""+g+o+g),this.at+" "+this.id+" {"+o+"}"},t}(),M3=/@keyframes\s+/,P3=/\$([\w-]+)/g,Gu=function(e,n){return typeof e=="string"?e.replace(P3,function(i,s){return s in n?n[s]:i}):e},Up=function(e,n,i){var s=e[n],g=Gu(s,i);g!==s&&(e[n]=g)},J3={onCreateRule:function(e,n,i){return typeof e=="string"&&M3.test(e)?new vu(e,n,i):null},onProcessStyle:function(e,n,i){return n.type!=="style"||!i||("animation-name"in e&&Up(e,"animation-name",i.keyframes),"animation"in e&&Up(e,"animation",i.keyframes)),e},onChangeValue:function(e,n,i){var s=i.options.sheet;if(!s)return e;switch(n){case"animation":return Gu(e,s.keyframes);case"animation-name":return Gu(e,s.keyframes);default:return e}}},D3=function(t){Ic(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.toString=function(s){var g=this.options.sheet,o=g?g.options.link:!1,r=o?L({},s,{allowEmpty:!0}):s;return Ua(this.key,this.style,r)},e}(wZ),z3={onCreateRule:function(e,n,i){return i.parent&&i.parent.type==="keyframes"?new D3(e,n,i):null}},O3=function(){function t(n,i,s){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=n,this.style=i,this.options=s}var e=t.prototype;return e.toString=function(i){var s=Do(i),g=s.linebreak;if(Array.isArray(this.style)){for(var o="",r=0;r<this.style.length;r++)o+=Ua(this.at,this.style[r]),this.style[r+1]&&(o+=g);return o}return Ua(this.at,this.style,i)},t}(),j3=/@font-face/,q3={onCreateRule:function(e,n,i){return j3.test(e)?new O3(e,n,i):null}},$3=function(){function t(n,i,s){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=n,this.style=i,this.options=s}var e=t.prototype;return e.toString=function(i){return Ua(this.key,this.style,i)},t}(),eU={onCreateRule:function(e,n,i){return e==="@viewport"||e==="@-ms-viewport"?new $3(e,n,i):null}},tU=function(){function t(n,i,s){this.type="simple",this.isProcessed=!1,this.key=n,this.value=i,this.options=s}var e=t.prototype;return e.toString=function(i){if(Array.isArray(this.value)){for(var s="",g=0;g<this.value.length;g++)s+=this.key+" "+this.value[g]+";",this.value[g+1]&&(s+=`
`);return s}return this.key+" "+this.value+";"},t}(),nU={"@charset":!0,"@import":!0,"@namespace":!0},iU={onCreateRule:function(e,n,i){return e in nU?new tU(e,n,i):null}},xp=[Y3,K3,J3,z3,q3,eU,iU],sU={process:!0},Wp={force:!0,process:!0},Cc=function(){function t(n){this.map={},this.raw={},this.index=[],this.counter=0,this.options=n,this.classes=n.classes,this.keyframes=n.keyframes}var e=t.prototype;return e.add=function(i,s,g){var o=this.options,r=o.parent,a=o.sheet,I=o.jss,l=o.Renderer,C=o.generateId,c=o.scoped,A=L({classes:this.classes,parent:r,sheet:a,jss:I,Renderer:l,generateId:C,scoped:c,name:i,keyframes:this.keyframes,selector:void 0},g),d=i;i in this.raw&&(d=i+"-d"+this.counter++),this.raw[d]=s,d in this.classes&&(A.selector="."+Zh(this.classes[d]));var h=Gh(d,s,A);if(!h)return null;this.register(h);var u=A.index===void 0?this.index.length:A.index;return this.index.splice(u,0,h),h},e.replace=function(i,s,g){var o=this.get(i),r=this.index.indexOf(o);o&&this.remove(o);var a=g;return r!==-1&&(a=L({},g,{index:r})),this.add(i,s,a)},e.get=function(i){return this.map[i]},e.remove=function(i){this.unregister(i),delete this.raw[i.key],this.index.splice(this.index.indexOf(i),1)},e.indexOf=function(i){return this.index.indexOf(i)},e.process=function(){var i=this.options.jss.plugins;this.index.slice(0).forEach(i.onProcessRule,i)},e.register=function(i){this.map[i.key]=i,i instanceof yu?(this.map[i.selector]=i,i.id&&(this.classes[i.key]=i.id)):i instanceof vu&&this.keyframes&&(this.keyframes[i.name]=i.id)},e.unregister=function(i){delete this.map[i.key],i instanceof yu?(delete this.map[i.selector],delete this.classes[i.key]):i instanceof vu&&delete this.keyframes[i.name]},e.update=function(){var i,s,g;if(typeof(arguments.length<=0?void 0:arguments[0])=="string"?(i=arguments.length<=0?void 0:arguments[0],s=arguments.length<=1?void 0:arguments[1],g=arguments.length<=2?void 0:arguments[2]):(s=arguments.length<=0?void 0:arguments[0],g=arguments.length<=1?void 0:arguments[1],i=null),i)this.updateOne(this.get(i),s,g);else for(var o=0;o<this.index.length;o++)this.updateOne(this.index[o],s,g)},e.updateOne=function(i,s,g){g===void 0&&(g=sU);var o=this.options,r=o.jss.plugins,a=o.sheet;if(i.rules instanceof t){i.rules.update(s,g);return}var I=i.style;if(r.onUpdate(s,i,a,g),g.process&&I&&I!==i.style){r.onProcessStyle(i.style,i,a);for(var l in i.style){var C=i.style[l],c=I[l];C!==c&&i.prop(l,C,Wp)}for(var A in I){var d=i.style[A],h=I[A];d==null&&d!==h&&i.prop(A,null,Wp)}}},e.toString=function(i){for(var s="",g=this.options.sheet,o=g?g.options.link:!1,r=Do(i),a=r.linebreak,I=0;I<this.index.length;I++){var l=this.index[I],C=l.toString(i);!C&&!o||(s&&(s+=a),s+=C)}return s},t}(),NZ=function(){function t(n,i){this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=L({},i,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),i.Renderer&&(this.renderer=new i.Renderer(this)),this.rules=new Cc(this.options);for(var s in n)this.rules.add(s,n[s]);this.rules.process()}var e=t.prototype;return e.attach=function(){return this.attached?this:(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy(),this)},e.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},e.addRule=function(i,s,g){var o=this.queue;this.attached&&!o&&(this.queue=[]);var r=this.rules.add(i,s,g);return r?(this.options.jss.plugins.onProcessRule(r),this.attached?(this.deployed&&(o?o.push(r):(this.insertRule(r),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0))),r):(this.deployed=!1,r)):null},e.replaceRule=function(i,s,g){var o=this.rules.get(i);if(!o)return this.addRule(i,s,g);var r=this.rules.replace(i,s,g);return r&&this.options.jss.plugins.onProcessRule(r),this.attached?(this.deployed&&this.renderer&&(r?o.renderable&&this.renderer.replaceRule(o.renderable,r):this.renderer.deleteRule(o)),r):(this.deployed=!1,r)},e.insertRule=function(i){this.renderer&&this.renderer.insertRule(i)},e.addRules=function(i,s){var g=[];for(var o in i){var r=this.addRule(o,i[o],s);r&&g.push(r)}return g},e.getRule=function(i){return this.rules.get(i)},e.deleteRule=function(i){var s=typeof i=="object"?i:this.rules.get(i);return!s||this.attached&&!s.renderable?!1:(this.rules.remove(s),this.attached&&s.renderable&&this.renderer?this.renderer.deleteRule(s.renderable):!0)},e.indexOf=function(i){return this.rules.indexOf(i)},e.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},e.update=function(){var i;return(i=this.rules).update.apply(i,arguments),this},e.updateOne=function(i,s,g){return this.rules.updateOne(i,s,g),this},e.toString=function(i){return this.rules.toString(i)},t}(),gU=function(){function t(){this.plugins={internal:[],external:[]},this.registry={}}var e=t.prototype;return e.onCreateRule=function(i,s,g){for(var o=0;o<this.registry.onCreateRule.length;o++){var r=this.registry.onCreateRule[o](i,s,g);if(r)return r}return null},e.onProcessRule=function(i){if(!i.isProcessed){for(var s=i.options.sheet,g=0;g<this.registry.onProcessRule.length;g++)this.registry.onProcessRule[g](i,s);i.style&&this.onProcessStyle(i.style,i,s),i.isProcessed=!0}},e.onProcessStyle=function(i,s,g){for(var o=0;o<this.registry.onProcessStyle.length;o++)s.style=this.registry.onProcessStyle[o](s.style,s,g)},e.onProcessSheet=function(i){for(var s=0;s<this.registry.onProcessSheet.length;s++)this.registry.onProcessSheet[s](i)},e.onUpdate=function(i,s,g,o){for(var r=0;r<this.registry.onUpdate.length;r++)this.registry.onUpdate[r](i,s,g,o)},e.onChangeValue=function(i,s,g){for(var o=i,r=0;r<this.registry.onChangeValue.length;r++)o=this.registry.onChangeValue[r](o,s,g);return o},e.use=function(i,s){s===void 0&&(s={queue:"external"});var g=this.plugins[s.queue];g.indexOf(i)===-1&&(g.push(i),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce(function(o,r){for(var a in r)a in o&&o[a].push(r[a]);return o},{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},t}(),oU=function(){function t(){this.registry=[]}var e=t.prototype;return e.add=function(i){var s=this.registry,g=i.options.index;if(s.indexOf(i)===-1){if(s.length===0||g>=this.index){s.push(i);return}for(var o=0;o<s.length;o++)if(s[o].options.index>g){s.splice(o,0,i);return}}},e.reset=function(){this.registry=[]},e.remove=function(i){var s=this.registry.indexOf(i);this.registry.splice(s,1)},e.toString=function(i){for(var s=i===void 0?{}:i,g=s.attached,o=lc(s,["attached"]),r=Do(o),a=r.linebreak,I="",l=0;l<this.registry.length;l++){var C=this.registry[l];g!=null&&C.attached!==g||(I&&(I+=a),I+=C.toString(o))}return I},vh(t,[{key:"index",get:function(){return this.registry.length===0?0:this.registry[this.registry.length-1].options.index}}]),t}(),ia=new oU,Zu=typeof globalThis<"u"?globalThis:typeof window<"u"&&window.Math===Math?window:typeof self<"u"&&self.Math===Math?self:Function("return this")(),Ru="2f1acc6c3a606b082e5eef5e54414ffb";Zu[Ru]==null&&(Zu[Ru]=0);var wp=Zu[Ru]++,Np=function(e){e===void 0&&(e={});var n=0,i=function(g,o){n+=1;var r="",a="";return o&&(o.options.classNamePrefix&&(a=o.options.classNamePrefix),o.options.jss.id!=null&&(r=String(o.options.jss.id))),e.minify?""+(a||"c")+wp+r+n:a+g.key+"-"+wp+(r?"-"+r:"")+"-"+n};return i},TZ=function(e){var n;return function(){return n||(n=e()),n}},rU=function(e,n){try{return e.attributeStyleMap?e.attributeStyleMap.get(n):e.style.getPropertyValue(n)}catch{return""}},aU=function(e,n,i){try{var s=i;if(Array.isArray(i)&&(s=Ag(i,!0),i[i.length-1]==="!important"))return e.style.setProperty(n,s,"important"),!0;e.attributeStyleMap?e.attributeStyleMap.set(n,s):e.style.setProperty(n,s)}catch{return!1}return!0},IU=function(e,n){try{e.attributeStyleMap?e.attributeStyleMap.delete(n):e.style.removeProperty(n)}catch{}},lU=function(e,n){return e.selectorText=n,e.selectorText===n},EZ=TZ(function(){return document.querySelector("head")});function CU(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.attached&&i.options.index>e.index&&i.options.insertionPoint===e.insertionPoint)return i}return null}function cU(t,e){for(var n=t.length-1;n>=0;n--){var i=t[n];if(i.attached&&i.options.insertionPoint===e.insertionPoint)return i}return null}function AU(t){for(var e=EZ(),n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===8&&i.nodeValue.trim()===t)return i}return null}function dU(t){var e=ia.registry;if(e.length>0){var n=CU(e,t);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if(n=cU(e,t),n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var i=t.insertionPoint;if(i&&typeof i=="string"){var s=AU(i);if(s)return{parent:s.parentNode,node:s.nextSibling}}return!1}function uU(t,e){var n=e.insertionPoint,i=dU(e);if(i!==!1&&i.parent){i.parent.insertBefore(t,i.node);return}if(n&&typeof n.nodeType=="number"){var s=n,g=s.parentNode;g&&g.insertBefore(t,s.nextSibling);return}EZ().appendChild(t)}var hU=TZ(function(){var t=document.querySelector('meta[property="csp-nonce"]');return t?t.getAttribute("content"):null}),Tp=function(e,n,i){try{"insertRule"in e?e.insertRule(n,i):"appendRule"in e&&e.appendRule(n)}catch{return!1}return e.cssRules[i]},Ep=function(e,n){var i=e.cssRules.length;return n===void 0||n>i?i:n},mU=function(){var e=document.createElement("style");return e.textContent=`
`,e},fU=function(){function t(n){this.getPropertyValue=rU,this.setProperty=aU,this.removeProperty=IU,this.setSelector=lU,this.hasInsertedRules=!1,this.cssRules=[],n&&ia.add(n),this.sheet=n;var i=this.sheet?this.sheet.options:{},s=i.media,g=i.meta,o=i.element;this.element=o||mU(),this.element.setAttribute("data-jss",""),s&&this.element.setAttribute("media",s),g&&this.element.setAttribute("data-meta",g);var r=hU();r&&this.element.setAttribute("nonce",r)}var e=t.prototype;return e.attach=function(){if(!(this.element.parentNode||!this.sheet)){uU(this.element,this.sheet.options);var i=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&i&&(this.hasInsertedRules=!1,this.deploy())}},e.detach=function(){if(!!this.sheet){var i=this.element.parentNode;i&&i.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent=`
`)}},e.deploy=function(){var i=this.sheet;if(!!i){if(i.options.link){this.insertRules(i.rules);return}this.element.textContent=`
`+i.toString()+`
`}},e.insertRules=function(i,s){for(var g=0;g<i.index.length;g++)this.insertRule(i.index[g],g,s)},e.insertRule=function(i,s,g){if(g===void 0&&(g=this.element.sheet),i.rules){var o=i,r=g;if(i.type==="conditional"||i.type==="keyframes"){var a=Ep(g,s);if(r=Tp(g,o.toString({children:!1}),a),r===!1)return!1;this.refCssRule(i,a,r)}return this.insertRules(o.rules,r),r}var I=i.toString();if(!I)return!1;var l=Ep(g,s),C=Tp(g,I,l);return C===!1?!1:(this.hasInsertedRules=!0,this.refCssRule(i,l,C),C)},e.refCssRule=function(i,s,g){i.renderable=g,i.options.parent instanceof NZ&&this.cssRules.splice(s,0,g)},e.deleteRule=function(i){var s=this.element.sheet,g=this.indexOf(i);return g===-1?!1:(s.deleteRule(g),this.cssRules.splice(g,1),!0)},e.indexOf=function(i){return this.cssRules.indexOf(i)},e.replaceRule=function(i,s){var g=this.indexOf(i);return g===-1?!1:(this.element.sheet.deleteRule(g),this.cssRules.splice(g,1),this.insertRule(s,g))},e.getRules=function(){return this.element.sheet.cssRules},t}(),pU=0,BU=function(){function t(n){this.id=pU++,this.version="10.9.0",this.plugins=new gU,this.options={id:{minify:!1},createGenerateId:Np,Renderer:sI?fU:null,plugins:[]},this.generateId=Np({minify:!1});for(var i=0;i<xp.length;i++)this.plugins.use(xp[i],{queue:"internal"});this.setup(n)}var e=t.prototype;return e.setup=function(i){return i===void 0&&(i={}),i.createGenerateId&&(this.options.createGenerateId=i.createGenerateId),i.id&&(this.options.id=L({},this.options.id,i.id)),(i.createGenerateId||i.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),i.insertionPoint!=null&&(this.options.insertionPoint=i.insertionPoint),"Renderer"in i&&(this.options.Renderer=i.Renderer),i.plugins&&this.use.apply(this,i.plugins),this},e.createStyleSheet=function(i,s){s===void 0&&(s={});var g=s,o=g.index;typeof o!="number"&&(o=ia.index===0?0:ia.index+1);var r=new NZ(i,L({},s,{jss:this,generateId:s.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:o}));return this.plugins.onProcessSheet(r),r},e.removeStyleSheet=function(i){return i.detach(),ia.remove(i),this},e.createRule=function(i,s,g){if(s===void 0&&(s={}),g===void 0&&(g={}),typeof i=="object")return this.createRule(void 0,i,s);var o=L({},g,{name:i,jss:this,Renderer:this.options.Renderer});o.generateId||(o.generateId=this.generateId),o.classes||(o.classes={}),o.keyframes||(o.keyframes={});var r=Gh(i,s,o);return r&&this.plugins.onProcessRule(r),r},e.use=function(){for(var i=this,s=arguments.length,g=new Array(s),o=0;o<s;o++)g[o]=arguments[o];return g.forEach(function(r){i.plugins.use(r)}),this},t}(),QZ=function(e){return new BU(e)},Rh=typeof CSS=="object"&&CSS!=null&&"number"in CSS;function XZ(t){var e=null;for(var n in t){var i=t[n],s=typeof i;if(s==="function")e||(e={}),e[n]=i;else if(s==="object"&&i!==null&&!Array.isArray(i)){var g=XZ(i);g&&(e||(e={}),e[n]=g)}}return e}/**
 * A better abstraction over CSS.
 *
 * @copyright Oleg Isonen (Slobodskoi) / Isonen 2014-present
 * @website https://github.com/cssinjs/jss
 * @license MIT
 */QZ();var YZ=Date.now(),xA="fnValues"+YZ,WA="fnStyle"+ ++YZ,bU=function(){return{onCreateRule:function(n,i,s){if(typeof i!="function")return null;var g=Gh(n,{},s);return g[WA]=i,g},onProcessStyle:function(n,i){if(xA in i||WA in i)return n;var s={};for(var g in n){var o=n[g];typeof o=="function"&&(delete n[g],s[g]=o)}return i[xA]=s,n},onUpdate:function(n,i,s,g){var o=i,r=o[WA];r&&(o.style=r(n)||{});var a=o[xA];if(a)for(var I in a)o.prop(I,a[I](n),g)}}};const yU=bU;var fs="@global",Fu="@global ",vU=function(){function t(n,i,s){this.type="global",this.at=fs,this.isProcessed=!1,this.key=n,this.options=s,this.rules=new Cc(L({},s,{parent:this}));for(var g in i)this.rules.add(g,i[g]);this.rules.process()}var e=t.prototype;return e.getRule=function(i){return this.rules.get(i)},e.addRule=function(i,s,g){var o=this.rules.add(i,s,g);return o&&this.options.jss.plugins.onProcessRule(o),o},e.replaceRule=function(i,s,g){var o=this.rules.replace(i,s,g);return o&&this.options.jss.plugins.onProcessRule(o),o},e.indexOf=function(i){return this.rules.indexOf(i)},e.toString=function(i){return this.rules.toString(i)},t}(),GU=function(){function t(n,i,s){this.type="global",this.at=fs,this.isProcessed=!1,this.key=n,this.options=s;var g=n.substr(Fu.length);this.rule=s.jss.createRule(g,i,L({},s,{parent:this}))}var e=t.prototype;return e.toString=function(i){return this.rule?this.rule.toString(i):""},t}(),ZU=/\s*,\s*/g;function _Z(t,e){for(var n=t.split(ZU),i="",s=0;s<n.length;s++)i+=e+" "+n[s].trim(),n[s+1]&&(i+=", ");return i}function RU(t,e){var n=t.options,i=t.style,s=i?i[fs]:null;if(!!s){for(var g in s)e.addRule(g,s[g],L({},n,{selector:_Z(g,t.selector)}));delete i[fs]}}function FU(t,e){var n=t.options,i=t.style;for(var s in i)if(!(s[0]!=="@"||s.substr(0,fs.length)!==fs)){var g=_Z(s.substr(fs.length),t.selector);e.addRule(g,i[s],L({},n,{selector:g})),delete i[s]}}function SU(){function t(n,i,s){if(!n)return null;if(n===fs)return new vU(n,i,s);if(n[0]==="@"&&n.substr(0,Fu.length)===Fu)return new GU(n,i,s);var g=s.parent;return g&&(g.type==="global"||g.options.parent&&g.options.parent.type==="global")&&(s.scoped=!1),!s.selector&&s.scoped===!1&&(s.selector=n),null}function e(n,i){n.type!=="style"||!i||(RU(n,i),FU(n,i))}return{onCreateRule:t,onProcessRule:e}}var Qp=/\s*,\s*/g,VU=/&/g,UU=/\$([\w-]+)/g;function xU(){function t(s,g){return function(o,r){var a=s.getRule(r)||g&&g.getRule(r);return a?a.selector:r}}function e(s,g){for(var o=g.split(Qp),r=s.split(Qp),a="",I=0;I<o.length;I++)for(var l=o[I],C=0;C<r.length;C++){var c=r[C];a&&(a+=", "),a+=c.indexOf("&")!==-1?c.replace(VU,l):l+" "+c}return a}function n(s,g,o){if(o)return L({},o,{index:o.index+1});var r=s.options.nestingLevel;r=r===void 0?1:r+1;var a=L({},s.options,{nestingLevel:r,index:g.indexOf(s)+1});return delete a.name,a}function i(s,g,o){if(g.type!=="style")return s;var r=g,a=r.options.parent,I,l;for(var C in s){var c=C.indexOf("&")!==-1,A=C[0]==="@";if(!(!c&&!A)){if(I=n(r,a,I),c){var d=e(C,r.selector);l||(l=t(a,o)),d=d.replace(UU,l);var h=r.key+"-"+C;"replaceRule"in a?a.replaceRule(h,s[C],L({},I,{selector:d})):a.addRule(h,s[C],L({},I,{selector:d}))}else A&&a.addRule(C,{},I).addRule(r.key,s[C],{selector:r.selector});delete s[C]}}return s}return{onProcessStyle:i}}var WU=/[A-Z]/g,wU=/^ms-/,wA={};function NU(t){return"-"+t.toLowerCase()}function HZ(t){if(wA.hasOwnProperty(t))return wA[t];var e=t.replace(WU,NU);return wA[t]=wU.test(e)?"-"+e:e}function pC(t){var e={};for(var n in t){var i=n.indexOf("--")===0?n:HZ(n);e[i]=t[n]}return t.fallbacks&&(Array.isArray(t.fallbacks)?e.fallbacks=t.fallbacks.map(pC):e.fallbacks=pC(t.fallbacks)),e}function TU(){function t(n){if(Array.isArray(n)){for(var i=0;i<n.length;i++)n[i]=pC(n[i]);return n}return pC(n)}function e(n,i,s){if(i.indexOf("--")===0)return n;var g=HZ(i);return i===g?n:(s.prop(g,n),null)}return{onProcessStyle:t,onChangeValue:e}}var X=Rh&&CSS?CSS.px:"px",MI=Rh&&CSS?CSS.ms:"ms",Eg=Rh&&CSS?CSS.percent:"%",EU={"animation-delay":MI,"animation-duration":MI,"background-position":X,"background-position-x":X,"background-position-y":X,"background-size":X,border:X,"border-bottom":X,"border-bottom-left-radius":X,"border-bottom-right-radius":X,"border-bottom-width":X,"border-left":X,"border-left-width":X,"border-radius":X,"border-right":X,"border-right-width":X,"border-top":X,"border-top-left-radius":X,"border-top-right-radius":X,"border-top-width":X,"border-width":X,"border-block":X,"border-block-end":X,"border-block-end-width":X,"border-block-start":X,"border-block-start-width":X,"border-block-width":X,"border-inline":X,"border-inline-end":X,"border-inline-end-width":X,"border-inline-start":X,"border-inline-start-width":X,"border-inline-width":X,"border-start-start-radius":X,"border-start-end-radius":X,"border-end-start-radius":X,"border-end-end-radius":X,margin:X,"margin-bottom":X,"margin-left":X,"margin-right":X,"margin-top":X,"margin-block":X,"margin-block-end":X,"margin-block-start":X,"margin-inline":X,"margin-inline-end":X,"margin-inline-start":X,padding:X,"padding-bottom":X,"padding-left":X,"padding-right":X,"padding-top":X,"padding-block":X,"padding-block-end":X,"padding-block-start":X,"padding-inline":X,"padding-inline-end":X,"padding-inline-start":X,"mask-position-x":X,"mask-position-y":X,"mask-size":X,height:X,width:X,"min-height":X,"max-height":X,"min-width":X,"max-width":X,bottom:X,left:X,top:X,right:X,inset:X,"inset-block":X,"inset-block-end":X,"inset-block-start":X,"inset-inline":X,"inset-inline-end":X,"inset-inline-start":X,"box-shadow":X,"text-shadow":X,"column-gap":X,"column-rule":X,"column-rule-width":X,"column-width":X,"font-size":X,"font-size-delta":X,"letter-spacing":X,"text-decoration-thickness":X,"text-indent":X,"text-stroke":X,"text-stroke-width":X,"word-spacing":X,motion:X,"motion-offset":X,outline:X,"outline-offset":X,"outline-width":X,perspective:X,"perspective-origin-x":Eg,"perspective-origin-y":Eg,"transform-origin":Eg,"transform-origin-x":Eg,"transform-origin-y":Eg,"transform-origin-z":Eg,"transition-delay":MI,"transition-duration":MI,"vertical-align":X,"flex-basis":X,"shape-margin":X,size:X,gap:X,grid:X,"grid-gap":X,"row-gap":X,"grid-row-gap":X,"grid-column-gap":X,"grid-template-rows":X,"grid-template-columns":X,"grid-auto-rows":X,"grid-auto-columns":X,"box-shadow-x":X,"box-shadow-y":X,"box-shadow-blur":X,"box-shadow-spread":X,"font-line-height":X,"text-shadow-x":X,"text-shadow-y":X,"text-shadow-blur":X};function kZ(t){var e=/(-[a-z])/g,n=function(o){return o[1].toUpperCase()},i={};for(var s in t)i[s]=t[s],i[s.replace(e,n)]=t[s];return i}var QU=kZ(EU);function sa(t,e,n){if(e==null)return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i]=sa(t,e[i],n);else if(typeof e=="object")if(t==="fallbacks")for(var s in e)e[s]=sa(s,e[s],n);else for(var g in e)e[g]=sa(t+"-"+g,e[g],n);else if(typeof e=="number"&&isNaN(e)===!1){var o=n[t]||QU[t];return o&&!(e===0&&o===X)?typeof o=="function"?o(e).toString():""+e+o:e.toString()}return e}function XU(t){t===void 0&&(t={});var e=kZ(t);function n(s,g){if(g.type!=="style")return s;for(var o in s)s[o]=sa(o,s[o],e);return s}function i(s,g){return sa(g,s,e)}return{onProcessStyle:n,onChangeValue:i}}function Su(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function YU(t){if(Array.isArray(t))return Su(t)}function KZ(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Fh(t,e){if(!!t){if(typeof t=="string")return Su(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Su(t,e)}}function _U(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cc(t){return YU(t)||KZ(t)||Fh(t)||_U()}var Xr="",Vu="",LZ="",MZ="",HU=sI&&"ontouchstart"in document.documentElement;if(sI){var NA={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},kU=document.createElement("p"),TA=kU.style,KU="Transform";for(var EA in NA)if(EA+KU in TA){Xr=EA,Vu=NA[EA];break}Xr==="Webkit"&&"msHyphens"in TA&&(Xr="ms",Vu=NA.ms,MZ="edge"),Xr==="Webkit"&&"-apple-trailing-word"in TA&&(LZ="apple")}var fe={js:Xr,css:Vu,vendor:LZ,browser:MZ,isTouch:HU};function LU(t){return t[1]==="-"||fe.js==="ms"?t:"@"+fe.css+"keyframes"+t.substr(10)}var MU={noPrefill:["appearance"],supportedProperty:function(e){return e!=="appearance"?!1:fe.js==="ms"?"-webkit-"+e:fe.css+e}},PU={noPrefill:["color-adjust"],supportedProperty:function(e){return e!=="color-adjust"?!1:fe.js==="Webkit"?fe.css+"print-"+e:e}},JU=/[-\s]+(.)?/g;function DU(t,e){return e?e.toUpperCase():""}function Sh(t){return t.replace(JU,DU)}function Ss(t){return Sh("-"+t)}var zU={noPrefill:["mask"],supportedProperty:function(e,n){if(!/^mask/.test(e))return!1;if(fe.js==="Webkit"){var i="mask-image";if(Sh(i)in n)return e;if(fe.js+Ss(i)in n)return fe.css+e}return e}},OU={noPrefill:["text-orientation"],supportedProperty:function(e){return e!=="text-orientation"?!1:fe.vendor==="apple"&&!fe.isTouch?fe.css+e:e}},jU={noPrefill:["transform"],supportedProperty:function(e,n,i){return e!=="transform"?!1:i.transform?e:fe.css+e}},qU={noPrefill:["transition"],supportedProperty:function(e,n,i){return e!=="transition"?!1:i.transition?e:fe.css+e}},$U={noPrefill:["writing-mode"],supportedProperty:function(e){return e!=="writing-mode"?!1:fe.js==="Webkit"||fe.js==="ms"&&fe.browser!=="edge"?fe.css+e:e}},ex={noPrefill:["user-select"],supportedProperty:function(e){return e!=="user-select"?!1:fe.js==="Moz"||fe.js==="ms"||fe.vendor==="apple"?fe.css+e:e}},tx={supportedProperty:function(e,n){if(!/^break-/.test(e))return!1;if(fe.js==="Webkit"){var i="WebkitColumn"+Ss(e);return i in n?fe.css+"column-"+e:!1}if(fe.js==="Moz"){var s="page"+Ss(e);return s in n?"page-"+e:!1}return!1}},nx={supportedProperty:function(e,n){if(!/^(border|margin|padding)-inline/.test(e))return!1;if(fe.js==="Moz")return e;var i=e.replace("-inline","");return fe.js+Ss(i)in n?fe.css+i:!1}},ix={supportedProperty:function(e,n){return Sh(e)in n?e:!1}},sx={supportedProperty:function(e,n){var i=Ss(e);return e[0]==="-"||e[0]==="-"&&e[1]==="-"?e:fe.js+i in n?fe.css+e:fe.js!=="Webkit"&&"Webkit"+i in n?"-webkit-"+e:!1}},gx={supportedProperty:function(e){return e.substring(0,11)!=="scroll-snap"?!1:fe.js==="ms"?""+fe.css+e:e}},ox={supportedProperty:function(e){return e!=="overscroll-behavior"?!1:fe.js==="ms"?fe.css+"scroll-chaining":e}},rx={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},ax={supportedProperty:function(e,n){var i=rx[e];return i&&fe.js+Ss(i)in n?fe.css+i:!1}},PZ={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},Ix=Object.keys(PZ),lx=function(e){return fe.css+e},Cx={supportedProperty:function(e,n,i){var s=i.multiple;if(Ix.indexOf(e)>-1){var g=PZ[e];if(!Array.isArray(g))return fe.js+Ss(g)in n?fe.css+g:!1;if(!s)return!1;for(var o=0;o<g.length;o++)if(!(fe.js+Ss(g[0])in n))return!1;return g.map(lx)}return!1}},JZ=[MU,PU,zU,OU,jU,qU,$U,ex,tx,nx,ix,sx,gx,ox,ax,Cx],Xp=JZ.filter(function(t){return t.supportedProperty}).map(function(t){return t.supportedProperty}),cx=JZ.filter(function(t){return t.noPrefill}).reduce(function(t,e){return t.push.apply(t,cc(e.noPrefill)),t},[]),Yr,eg={};if(sI){Yr=document.createElement("p");var QA=window.getComputedStyle(document.documentElement,"");for(var XA in QA)isNaN(XA)||(eg[QA[XA]]=QA[XA]);cx.forEach(function(t){return delete eg[t]})}function Uu(t,e){if(e===void 0&&(e={}),!Yr)return t;if(eg[t]!=null)return eg[t];(t==="transition"||t==="transform")&&(e[t]=t in Yr.style);for(var n=0;n<Xp.length&&(eg[t]=Xp[n](t,Yr.style,e),!eg[t]);n++);try{Yr.style[t]=""}catch{return!1}return eg[t]}var Qg={},Ax={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},dx=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g,ns;function ux(t,e,n){if(e==="var")return"var";if(e==="all")return"all";if(n==="all")return", all";var i=e?Uu(e):", "+Uu(n);return i||e||n}sI&&(ns=document.createElement("p"));function Yp(t,e){var n=e;if(!ns||t==="content")return e;if(typeof n!="string"||!isNaN(parseInt(n,10)))return n;var i=t+n;if(Qg[i]!=null)return Qg[i];try{ns.style[t]=n}catch{return Qg[i]=!1,!1}if(Ax[t])n=n.replace(dx,ux);else if(ns.style[t]===""&&(n=fe.css+n,n==="-ms-flex"&&(ns.style[t]="-ms-flexbox"),ns.style[t]=n,ns.style[t]===""))return Qg[i]=!1,!1;return ns.style[t]="",Qg[i]=n,Qg[i]}function hx(){function t(s){if(s.type==="keyframes"){var g=s;g.at=LU(g.at)}}function e(s){for(var g in s){var o=s[g];if(g==="fallbacks"&&Array.isArray(o)){s[g]=o.map(e);continue}var r=!1,a=Uu(g);a&&a!==g&&(r=!0);var I=!1,l=Yp(a,Ag(o));l&&l!==o&&(I=!0),(r||I)&&(r&&delete s[g],s[a||g]=l||o)}return s}function n(s,g){return g.type!=="style"?s:e(s)}function i(s,g){return Yp(g,Ag(s))||s}return{onProcessRule:t,onProcessStyle:n,onChangeValue:i}}function mx(){var t=function(n,i){return n.length===i.length?n>i?1:-1:n.length-i.length};return{onProcessStyle:function(n,i){if(i.type!=="style")return n;for(var s={},g=Object.keys(n).sort(t),o=0;o<g.length;o++)s[g[o]]=n[g[o]];return s}}}function fx(){return{plugins:[yU(),SU(),xU(),TU(),XU(),typeof window>"u"?null:hx(),mx()]}}function Ve(t,e){if(t==null)return{};var n=lc(t,e),i,s;if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(t);for(s=0;s<g.length;s++)i=g[s],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,i)||(n[i]=t[i]))}return n}function DZ(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.baseClasses,n=t.newClasses;if(t.Component,!n)return e;var i=L({},e);return Object.keys(n).forEach(function(s){n[s]&&(i[s]="".concat(e[s]," ").concat(n[s]))}),i}var px={set:function(e,n,i,s){var g=e.get(n);g||(g=new Map,e.set(n,g)),g.set(i,s)},get:function(e,n,i){var s=e.get(n);return s?s.get(i):void 0},delete:function(e,n,i){var s=e.get(n);s.delete(i)}};const go=px;var Bx=Ne.createContext(null);const zZ=Bx;function gI(){var t=Ne.useContext(zZ);return t}var bx=QZ(fx()),yx=E3(),vx=new Map,Gx={disableGeneration:!1,generateClassName:yx,jss:bx,sheetsCache:null,sheetsManager:vx,sheetsRegistry:null},Zx=Ne.createContext(Gx),_p=-1e9;function Rx(){return _p+=1,_p}var Fx={};const Sx=Fx;function Vx(t){var e=typeof t=="function";return{create:function(i,s){var g;try{g=e?t(i):t}catch(a){throw a}if(!s||!i.overrides||!i.overrides[s])return g;var o=i.overrides[s],r=L({},g);return Object.keys(o).forEach(function(a){r[a]=Wo(r[a],o[a])}),r},options:{}}}function Ux(t,e,n){var i=t.state,s=t.stylesOptions;if(s.disableGeneration)return e||{};i.cacheClasses||(i.cacheClasses={value:null,lastProp:null,lastJSS:{}});var g=!1;return i.classes!==i.cacheClasses.lastJSS&&(i.cacheClasses.lastJSS=i.classes,g=!0),e!==i.cacheClasses.lastProp&&(i.cacheClasses.lastProp=e,g=!0),g&&(i.cacheClasses.value=DZ({baseClasses:i.cacheClasses.lastJSS,newClasses:e,Component:n})),i.cacheClasses.value}function xx(t,e){var n=t.state,i=t.theme,s=t.stylesOptions,g=t.stylesCreator,o=t.name;if(!s.disableGeneration){var r=go.get(s.sheetsManager,g,i);r||(r={refs:0,staticSheet:null,dynamicStyles:null},go.set(s.sheetsManager,g,i,r));var a=L({},g.options,s,{theme:i,flip:typeof s.flip=="boolean"?s.flip:i.direction==="rtl"});a.generateId=a.serverGenerateClassName||a.generateClassName;var I=s.sheetsRegistry;if(r.refs===0){var l;s.sheetsCache&&(l=go.get(s.sheetsCache,g,i));var C=g.create(i,o);l||(l=s.jss.createStyleSheet(C,L({link:!1},a)),l.attach(),s.sheetsCache&&go.set(s.sheetsCache,g,i,l)),I&&I.add(l),r.staticSheet=l,r.dynamicStyles=XZ(C)}if(r.dynamicStyles){var c=s.jss.createStyleSheet(r.dynamicStyles,L({link:!0},a));c.update(e),c.attach(),n.dynamicSheet=c,n.classes=DZ({baseClasses:r.staticSheet.classes,newClasses:c.classes}),I&&I.add(c)}else n.classes=r.staticSheet.classes;r.refs+=1}}function Wx(t,e){var n=t.state;n.dynamicSheet&&n.dynamicSheet.update(e)}function wx(t){var e=t.state,n=t.theme,i=t.stylesOptions,s=t.stylesCreator;if(!i.disableGeneration){var g=go.get(i.sheetsManager,s,n);g.refs-=1;var o=i.sheetsRegistry;g.refs===0&&(go.delete(i.sheetsManager,s,n),i.jss.removeStyleSheet(g.staticSheet),o&&o.remove(g.staticSheet)),e.dynamicSheet&&(i.jss.removeStyleSheet(e.dynamicSheet),o&&o.remove(e.dynamicSheet))}}function Nx(t,e){var n=Ne.useRef([]),i,s=Ne.useMemo(function(){return{}},e);n.current!==s&&(n.current=s,i=t()),Ne.useEffect(function(){return function(){i&&i()}},[s])}function Vh(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.name,i=e.classNamePrefix,s=e.Component,g=e.defaultTheme,o=g===void 0?Sx:g,r=Ve(e,["name","classNamePrefix","Component","defaultTheme"]),a=Vx(t),I=n||i||"makeStyles";a.options={index:Rx(),name:n,meta:I,classNamePrefix:I};var l=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=gI()||o,d=L({},Ne.useContext(Zx),r),h=Ne.useRef(),u=Ne.useRef();Nx(function(){var f={name:n,state:{},stylesCreator:a,stylesOptions:d,theme:A};return xx(f,c),u.current=!1,h.current=f,function(){wx(f)}},[A,a]),Ne.useEffect(function(){u.current&&Wx(h.current,c),u.current=!0});var m=Ux(h.current,c.classes,s);return m};return l}function Tx(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function OZ(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=OZ(t[e]))&&(i&&(i+=" "),i+=n);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function Se(){for(var t=0,e,n,i="";t<arguments.length;)(e=arguments[t++])&&(n=OZ(e))&&(i&&(i+=" "),i+=n);return i}var jZ={exports:{}},xe={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pt=typeof Symbol=="function"&&Symbol.for,Uh=pt?Symbol.for("react.element"):60103,xh=pt?Symbol.for("react.portal"):60106,Ac=pt?Symbol.for("react.fragment"):60107,dc=pt?Symbol.for("react.strict_mode"):60108,uc=pt?Symbol.for("react.profiler"):60114,hc=pt?Symbol.for("react.provider"):60109,mc=pt?Symbol.for("react.context"):60110,Wh=pt?Symbol.for("react.async_mode"):60111,fc=pt?Symbol.for("react.concurrent_mode"):60111,pc=pt?Symbol.for("react.forward_ref"):60112,Bc=pt?Symbol.for("react.suspense"):60113,Ex=pt?Symbol.for("react.suspense_list"):60120,bc=pt?Symbol.for("react.memo"):60115,yc=pt?Symbol.for("react.lazy"):60116,Qx=pt?Symbol.for("react.block"):60121,Xx=pt?Symbol.for("react.fundamental"):60117,Yx=pt?Symbol.for("react.responder"):60118,_x=pt?Symbol.for("react.scope"):60119;function un(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Uh:switch(t=t.type,t){case Wh:case fc:case Ac:case uc:case dc:case Bc:return t;default:switch(t=t&&t.$$typeof,t){case mc:case pc:case yc:case bc:case hc:return t;default:return e}}case xh:return e}}}function qZ(t){return un(t)===fc}xe.AsyncMode=Wh;xe.ConcurrentMode=fc;xe.ContextConsumer=mc;xe.ContextProvider=hc;xe.Element=Uh;xe.ForwardRef=pc;xe.Fragment=Ac;xe.Lazy=yc;xe.Memo=bc;xe.Portal=xh;xe.Profiler=uc;xe.StrictMode=dc;xe.Suspense=Bc;xe.isAsyncMode=function(t){return qZ(t)||un(t)===Wh};xe.isConcurrentMode=qZ;xe.isContextConsumer=function(t){return un(t)===mc};xe.isContextProvider=function(t){return un(t)===hc};xe.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Uh};xe.isForwardRef=function(t){return un(t)===pc};xe.isFragment=function(t){return un(t)===Ac};xe.isLazy=function(t){return un(t)===yc};xe.isMemo=function(t){return un(t)===bc};xe.isPortal=function(t){return un(t)===xh};xe.isProfiler=function(t){return un(t)===uc};xe.isStrictMode=function(t){return un(t)===dc};xe.isSuspense=function(t){return un(t)===Bc};xe.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===Ac||t===fc||t===uc||t===dc||t===Bc||t===Ex||typeof t=="object"&&t!==null&&(t.$$typeof===yc||t.$$typeof===bc||t.$$typeof===hc||t.$$typeof===mc||t.$$typeof===pc||t.$$typeof===Xx||t.$$typeof===Yx||t.$$typeof===_x||t.$$typeof===Qx)};xe.typeOf=un;(function(t){t.exports=xe})(jZ);var wh=jZ.exports,Hx={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},kx={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Kx={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},$Z={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Nh={};Nh[wh.ForwardRef]=Kx;Nh[wh.Memo]=$Z;function Hp(t){return wh.isMemo(t)?$Z:Nh[t.$$typeof]||Hx}var Lx=Object.defineProperty,Mx=Object.getOwnPropertyNames,kp=Object.getOwnPropertySymbols,Px=Object.getOwnPropertyDescriptor,Jx=Object.getPrototypeOf,Kp=Object.prototype;function e1(t,e,n){if(typeof e!="string"){if(Kp){var i=Jx(e);i&&i!==Kp&&e1(t,i,n)}var s=Mx(e);kp&&(s=s.concat(kp(e)));for(var g=Hp(t),o=Hp(e),r=0;r<s.length;++r){var a=s[r];if(!kx[a]&&!(n&&n[a])&&!(o&&o[a])&&!(g&&g[a])){var I=Px(e,a);try{Lx(t,a,I)}catch{}}}}return t}var Dx=e1;function zx(t,e){if(typeof e=="function"){var n=e(t);return n}return L({},t,e)}function Ox(t){var e=t.children,n=t.theme,i=gI(),s=Ne.useMemo(function(){var g=i===null?n:zx(i,n);return g!=null&&(g[xZ]=i!==null),g},[n,i]);return Ne.createElement(zZ.Provider,{value:s},e)}var jx=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(i){var s=n.defaultTheme,g=n.withTheme,o=g===void 0?!1:g,r=n.name,a=Ve(n,["defaultTheme","withTheme","name"]),I=r,l=Vh(e,L({defaultTheme:s,Component:i,name:r||i.displayName,classNamePrefix:I},a)),C=Ne.forwardRef(function(A,d){A.classes;var h=A.innerRef,u=Ve(A,["classes","innerRef"]),m=l(L({},i.defaultProps,A)),f,p=u;return(typeof r=="string"||o)&&(f=gI()||s,r&&(p=WZ({theme:f,name:r,props:u})),o&&!p.theme&&(p.theme=f)),Ne.createElement(i,L({ref:h||d,classes:m},p))});return Dx(C,i),C}};const Xs=jx,qx="modulepreload",$x=function(t,e){return new URL(t,e).href},Lp={},Ti=function(e,n,i){return!n||n.length===0?e():Promise.all(n.map(s=>{if(s=$x(s,i),s in Lp)return;Lp[s]=!0;const g=s.endsWith(".css"),o=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const r=document.createElement("link");if(r.rel=g?"stylesheet":qx,g||(r.as="script",r.crossOrigin=""),r.href=s,document.head.appendChild(r),g)return new Promise((a,I)=>{r.addEventListener("load",a),r.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},e9="w";function Mp(t,e){const n=bh(e),{s:i,w:s}=Z.exports.useContext(n);return Z.exports.useCallback(o=>{const r=a=>i[e9](t,o,a);return s?s(r):r()},[i,s,t])}function Vn(t,e){return Ai(t,e)[0]}function t9(t,e){let n=null;const i=new Map,s=g=>{let o;if(e===void 0)o=i.get(g);else for(const[a,I]of i)if(e(a,g)){o=I;break}if(o!==void 0)if(n!=null&&n(o[1],g))i.delete(g);else return o[0];const r=t(g);return i.set(g,[r,Date.now()]),r};return s.remove=g=>{if(e===void 0)i.delete(g);else for(const[o]of i)if(e(o,g)){i.delete(o);break}},s.setShouldRemove=g=>{if(n=g,!!n)for(const[o,r]of i)n(r[1],o)&&i.delete(o)},s}const n9=(t,e)=>{do{const[n,...i]=e,s=t.get(n);if(!s)return;if(!i.length)return s[1];t=s[0],e=i}while(e.length)},i9=(t,e,n)=>{do{const[i,...s]=e;let g=t.get(i);if(g||(g=[new WeakMap],t.set(i,g)),!s.length){g[1]=n;return}t=g[0],e=s}while(e.length)},t1=()=>{const t=new WeakMap;return(n,i)=>{const s=n9(t,i);if(s)return s;const g=n();return i9(t,i,g),g}},s9=t1(),Pp=t=>!!t.write,g9=t=>typeof t=="function";function o9(t,e){return s9(()=>{const n=new WeakMap,i=(a,I)=>{let l=n.get(a);if(l)return l;const C=I&&n.get(I),c=[],A=[];return a.forEach((d,h)=>{const u=e?e(d):h;A[h]=u;const m=C&&C.atomList[C.keyList.indexOf(u)];if(m){c[h]=m;return}const f=Yn(()=>({})),p=G=>{const y=G(f),U=G(s),V=G(t),W=i(V,U.prev).keyList.indexOf(u);if(W<0||W>=V.length){if("prev"in y)return y.prev;throw new Error("splitAtom: index out of bounds for read")}return y.prev=V[W],V[W]},B=(G,y,U)=>{const V=G(s),F=G(t),M=i(F,V.prev).keyList.indexOf(u);if(M<0||M>=F.length)throw new Error("splitAtom: index out of bounds for write");const E=g9(U)?U(F[M]):U;y(t,[...F.slice(0,M),E,...F.slice(M+1)])};c[h]=Pp(t)?Yn(p,B):Yn(p)}),C&&C.keyList.length===A.length&&C.keyList.every((d,h)=>d===A[h])?l=C:l={atomList:c,keyList:A},n.set(a,l),l},s=Yn(()=>({})),g=a=>{const I=a(s),l=a(t),C=i(l,I.prev);return I.prev=l,C.atomList},o=(a,I,l)=>{const C=a(r).indexOf(l);if(C>=0){const c=a(t);I(t,[...c.slice(0,C),...c.slice(C+1)])}},r=Pp(t)?Yn(g,o):Yn(g);return r},e?[t,e]:[t])}var r9=Object.defineProperty,a9=Object.defineProperties,I9=Object.getOwnPropertyDescriptors,Jp=Object.getOwnPropertySymbols,l9=Object.prototype.hasOwnProperty,C9=Object.prototype.propertyIsEnumerable,Dp=(t,e,n)=>e in t?r9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,c9=(t,e)=>{for(var n in e||(e={}))l9.call(e,n)&&Dp(t,n,e[n]);if(Jp)for(var n of Jp(e))C9.call(e,n)&&Dp(t,n,e[n]);return t},A9=(t,e)=>a9(t,I9(e));const d9=t1();function u9(t){const e=()=>{const n=h9(t);return Yn(s=>{const g=[],o=n.map((r,a)=>{try{return s(r)}catch(I){if(I instanceof Promise)g[a]=I;else throw I}});if(g.length)throw Promise.all(g);return m9(t,o)})};return Array.isArray(t)?d9(e,t):e()}const h9=t=>Array.isArray(t)?t:Object.getOwnPropertyNames(t).map(e=>t[e]),m9=(t,e)=>Array.isArray(t)?e:Object.getOwnPropertyNames(t).reduce((n,i,s)=>A9(c9({},n),{[i]:e[s]}),{});function f9(t){try{t().removeItem||console.warn("Missing removeItem. In the next version, it will be required.")}catch{}return{getItem:e=>{const n=t().getItem(e);return n instanceof Promise?n.then(i=>JSON.parse(i||"")):JSON.parse(n||"")},setItem:(e,n)=>t().setItem(e,JSON.stringify(n)),removeItem:e=>{var n,i;return(i=(n=t()).removeItem)==null?void 0:i.call(n,e)}}}f9(()=>localStorage);function BC(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const n1=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),zp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);zp&&parseFloat(zp[1]);const p9="3.1.7";function Ei(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}typeof process!="object"||String(process)!=="[object process]"||process.browser;const B9=typeof window<"u"&&typeof window.orientation<"u",Op=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Op&&parseFloat(Op[1]);class b9{constructor(e,n){ee(this,"name",void 0),ee(this,"workerThread",void 0),ee(this,"isRunning",void 0),ee(this,"result",void 0),ee(this,"_resolve",void 0),ee(this,"_reject",void 0),this.name=e,this.workerThread=n,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Ei(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ei(this.isRunning),this.isRunning=!1,this._reject(e)}}const YA=new Map;function y9(t){Ei(t.source&&!t.url||!t.source&&t.url);let e=YA.get(t.source||t.url);return e||(t.url&&(e=v9(t.url),YA.set(t.url,e)),t.source&&(e=i1(t.source),YA.set(t.source,e))),Ei(e),e}function v9(t){if(!t.startsWith("http"))return t;const e=G9(t);return i1(e)}function i1(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function G9(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function s1(t,e=!0,n){const i=n||new Set;if(t){if(jp(t))i.add(t);else if(jp(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)s1(t[s],e,i)}}return n===void 0?Array.from(i):[]}function jp(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const _A=()=>{};class g1{static isSupported(){return typeof Worker<"u"}constructor(e){ee(this,"name",void 0),ee(this,"source",void 0),ee(this,"url",void 0),ee(this,"terminated",!1),ee(this,"worker",void 0),ee(this,"onMessage",void 0),ee(this,"onError",void 0),ee(this,"_loadableURL","");const{name:n,source:i,url:s}=e;Ei(i||s),this.name=n,this.source=i,this.url=s,this.onMessage=_A,this.onError=g=>console.log(g),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=_A,this.onError=_A,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||s1(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=y9({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}}class Z9{constructor(e){ee(this,"name","unnamed"),ee(this,"source",void 0),ee(this,"url",void 0),ee(this,"maxConcurrency",1),ee(this,"maxMobileConcurrency",1),ee(this,"onDebug",()=>{}),ee(this,"reuseWorkers",!0),ee(this,"props",{}),ee(this,"jobQueue",[]),ee(this,"idleQueue",[]),ee(this,"count",0),ee(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(s,g,o)=>s.done(o),i=(s,g)=>s.error(g)){const s=new Promise(g=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:g}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new b9(n.name,e);e.onMessage=s=>n.onMessage(i,s.type,s.payload),e.onError=s=>n.onError(i,s),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new g1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return B9?this.maxMobileConcurrency:this.maxConcurrency}}const R9={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class Ri{static isSupported(){return g1.isSupported()}static getWorkerFarm(e={}){return Ri._workerFarm=Ri._workerFarm||new Ri({}),Ri._workerFarm.setProps(e),Ri._workerFarm}constructor(e){ee(this,"props",void 0),ee(this,"workerPools",new Map),this.props={...R9},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:s}=e;let g=this.workerPools.get(n);return g||(g=new Z9({name:n,source:i,url:s}),g.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,g)),g}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ee(Ri,"_workerFarm",void 0);const F9="latest";function S9(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(t.module,"/dist/").concat(i)),!s){let g=t.version;g==="latest"&&(g=F9);const o=g?"@".concat(g):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return Ei(s),s}function V9(t,e=p9){Ei(t,"no worker provided");const n=t.version;return!(!e||!n)}function U9(t,e){return Ri.isSupported()?t.worker&&(e==null?void 0:e.worker):!1}async function x9(t,e,n,i,s){const g=t.id,o=S9(t,n),a=Ri.getWorkerFarm(n).getWorkerPool({name:g,url:o});n=JSON.parse(JSON.stringify(n));const I=await a.startJob("process-on-worker",W9.bind(null,s));return I.postMessage("process",{input:e,options:n}),await(await I.result).result}async function W9(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:g,options:o}=i;try{const r=await t(g,o);e.postMessage("done",{id:s,result:r})}catch(r){const a=r instanceof Error?r.message:"unknown error";e.postMessage("error",{id:s,error:a})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function o1(t){return t&&typeof t=="object"&&t.isBuffer}function w9(t){return o1(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function r1(t){if(o1(t))return w9(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function N9(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let g=0;g<i.length;++g)if(i[g]!==s[g])return!1;return!0}function T9(...t){const e=t.map(g=>g instanceof ArrayBuffer?new Uint8Array(g):g),n=e.reduce((g,o)=>g+o.byteLength,0),i=new Uint8Array(n);let s=0;for(const g of e)i.set(g,s),s+=g.byteLength;return i.buffer}async function E9(t){const e=[];for await(const n of t)e.push(n);return T9(...e)}function qp(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class $p{constructor(e,n){ee(this,"name",void 0),ee(this,"type",void 0),ee(this,"sampleSize",1),ee(this,"time",void 0),ee(this,"count",void 0),ee(this,"samples",void 0),ee(this,"lastTiming",void 0),ee(this,"lastSampleTime",void 0),ee(this,"lastSampleCount",void 0),ee(this,"_count",0),ee(this,"_time",0),ee(this,"_samples",0),ee(this,"_startTime",0),ee(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qp(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qp()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class vc{constructor(e){ee(this,"id",void 0),ee(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof $p?this.stats[n]=e:this.stats[n]=new $p(n,i)),this.stats[n]}}const Q9="Queued Requests",X9="Active Requests",Y9="Cancelled Requests",_9="Queued Requests Ever",H9="Active Requests Ever",k9={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class K9{constructor(e={}){ee(this,"props",void 0),ee(this,"stats",void 0),ee(this,"activeRequestCount",0),ee(this,"requestQueue",[]),ee(this,"requestMap",new Map),ee(this,"deferredUpdate",null),this.props={...k9,...e},this.stats=new vc({id:this.props.id}),this.stats.get(Q9),this.stats.get(X9),this.stats.get(Y9),this.stats.get(_9),this.stats.get(H9)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},s=new Promise(g=>(i.resolve=g,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:n,resolve:i}=e;let s=!1;const g=()=>{s||(s=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:g}):Promise.resolve({done:g})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let L9="";const eB={};function M9(t){for(const e in eB)if(t.startsWith(e)){const n=eB[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(L9).concat(t)),t}function P9(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const J9=t=>typeof t=="boolean",ga=t=>typeof t=="function",oI=t=>t!==null&&typeof t=="object",tB=t=>oI(t)&&t.constructor==={}.constructor,D9=t=>t&&typeof t[Symbol.iterator]=="function",z9=t=>t&&typeof t[Symbol.asyncIterator]=="function",rI=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,zo=t=>typeof Blob<"u"&&t instanceof Blob,O9=t=>t&&typeof t=="object"&&t.isBuffer,j9=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||oI(t)&&ga(t.tee)&&ga(t.cancel)&&ga(t.getReader),q9=t=>oI(t)&&ga(t.read)&&ga(t.pipe)&&J9(t.readable),a1=t=>j9(t)||q9(t),$9=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,eW=/^([-\w.]+\/[-\w.+]+)/;function tW(t){const e=eW.exec(t);return e?e[1]:t}function nB(t){const e=$9.exec(t);return e?e[1]:""}const nW=/\?.*/;function Gc(t){if(rI(t)){const e=HA(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:tW(n)||nB(e)}}return zo(t)?{url:HA(t.name||""),type:t.type||""}:typeof t=="string"?{url:HA(t),type:nB(t)}:{url:"",type:""}}function iW(t){return rI(t)?t.headers["content-length"]||-1:zo(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function HA(t){return t.replace(nW,"")}async function I1(t){if(rI(t))return t;const e={},n=iW(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:s}=Gc(t);s&&(e["content-type"]=s);const g=await oW(t);g&&(e["x-first-bytes"]=g),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function sW(t){if(!t.ok){const e=await gW(t);throw new Error(e)}}async function gW(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(60),"..."):e}catch{}return e}async function oW(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=g=>{var o;return i(g==null||(o=g.target)===null||o===void 0?void 0:o.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=rW(n);return"data:base64,".concat(i)}return null}function rW(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function iB(t,e){if(typeof t=="string"){t=M9(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await I1(t)}function Th(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Ys(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Th()}function aW(){return Ys()&&typeof document<"u"}const ps={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},IW=globalThis,lW=ps.self||ps.window||ps.global,_r=ps.window||ps.self||ps.global,CW=ps.document||{},zg=ps.process||{},cW=console,Eh=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ys();const Tl=globalThis;function AW(){return typeof Tl.orientation<"u"}function l1(t){if(!t&&!Ys())return"Node";if(Th(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s?"IE":Tl.chrome?"Chrome":Tl.safari?"Safari":Tl.mozInnerScreenX?"Firefox":"Unknown"}function dW(t,e){if(!t)throw new Error(e||"Assertion failed")}const uW=Object.freeze(Object.defineProperty({__proto__:null,VERSION:Eh,self:lW,window:_r,global:IW,document:CW,process:zg,console:cW,isBrowser:Ys,isBrowserMainThread:aW,getBrowser:l1,isMobile:AW,isElectron:Th,assert:dW},Symbol.toStringTag,{value:"Module"}));function hW(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class mW{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ee(this,"storage",void 0),ee(this,"id",void 0),ee(this,"config",{}),this.storage=hW(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function fW(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function pW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function kA(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const g=t.width*n,o=t.height*n,r=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(g/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(s,");"),"background-size:".concat(g,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),r]}let bC;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(bC||(bC={}));function sB(t){return typeof t=="string"?bC[t.toUpperCase()]||bC.WHITE:t}function BW(t,e,n){return!Ys&&typeof t=="string"&&(e&&(e=sB(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=sB(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function bW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const s of i)typeof t[s]=="function"&&(e.find(g=>s===g)||(t[s]=t[s].bind(t)))}function yC(t,e){if(!t)throw new Error(e||"Assertion failed")}function Xg(){let t;if(Ys&&"performance"in _r){var e,n;t=_r==null||(e=_r.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in zg){var i;const s=zg==null||(i=zg.hrtime)===null||i===void 0?void 0:i.call(zg);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Yg={debug:Ys&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},yW={enabled:!0,level:0};function pn(){}const gB={},oB={once:!0};class aI{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ee(this,"id",void 0),ee(this,"VERSION",Eh),ee(this,"_startTs",Xg()),ee(this,"_deltaTs",Xg()),ee(this,"_storage",void 0),ee(this,"userData",{}),ee(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new mW("__probe-".concat(this.id,"__"),yW),this.userData={},this.timeStamp("".concat(this.id," started")),bW(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Xg()-this._startTs).toPrecision(10))}getDelta(){return Number((Xg()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){yC(e,n)}warn(e){return this._getLogFunction(0,e,Yg.warn,arguments,oB)}error(e){return this._getLogFunction(0,e,Yg.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Yg.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Yg.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),g=2;g<i;g++)s[g-2]=arguments[g];return this._getLogFunction(e,n,Yg.debug||Yg.info,arguments,oB)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||pn,i&&[i],{tag:RW(n)}):pn}image(e){let{logLevel:n,priority:i,image:s,message:g="",scale:o=1}=e;return this._shouldLog(n||i)?Ys?ZW({image:s,message:g,scale:o}):GW({image:s,message:g,scale:o}):pn}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||pn)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=rB({logLevel:e,message:n,opts:i}),{collapsed:g}=i;return s.method=(g?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||pn)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=C1(e)}_getLogFunction(e,n,i,s,g){if(this._shouldLog(e)){g=rB({logLevel:e,message:n,args:s,opts:g}),i=i||g.method,yC(i),g.total=this.getTotal(),g.delta=this.getDelta(),this._deltaTs=Xg();const o=g.tag||g.message;if(g.once)if(!gB[o])gB[o]=Xg();else return pn;return n=vW(this.id,g.message,g),i.bind(console,n,...g.args)}return pn}}ee(aI,"VERSION",Eh);function C1(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return yC(Number.isFinite(e)&&e>=0),e}function rB(t){const{logLevel:e,message:n}=t;t.logLevel=C1(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return yC(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function vW(t,e,n){if(typeof e=="string"){const i=n.time?pW(fW(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=BW(e,n.color,n.background)}return e}function GW(t){let{image:e,message:n="",scale:i=1}=t,s=null;try{s=module.require("asciify-image")}catch{}return s?()=>s(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(g=>console.log(g)):pn}function ZW(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const g=new Image;return g.onload=()=>{const o=kA(g,n,i);console.log(...o)},g.src=e,pn}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...kA(e,n,i)),pn;if(s.toLowerCase()==="canvas"){const g=new Image;return g.onload=()=>console.log(...kA(g,n,i)),g.src=e.toDataURL(),pn}return pn}function RW(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const aB=new aI({id:"loaders.gl"});class FW{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class SW{constructor(){ee(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const c1={fetch:null,mimeType:void 0,nothrow:!1,log:new SW,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},VW={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function A1(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const d1=()=>{const t=A1();return t.globalOptions=t.globalOptions||{...c1},t.globalOptions};function UW(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],xW(t,n),wW(e,t,i)}function u1(t,e){const n=d1(),i=t||n;return typeof i.fetch=="function"?i.fetch:oI(i.fetch)?s=>iB(s,i):e!=null&&e.fetch?e==null?void 0:e.fetch:iB}function xW(t,e){IB(t,null,c1,VW,e);for(const n of e){const i=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},g=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};IB(i,n.id,s,g,e)}}function IB(t,e,n,i,s){const g=e||"Top level",o=e?"".concat(e,"."):"";for(const r in t){const a=!e&&oI(t[r]),I=r==="baseUri"&&!e,l=r==="workerUrl"&&e;if(!(r in n)&&!I&&!l){if(r in i)aB.warn("".concat(g," loader option '").concat(o).concat(r,"' no longer supported, use '").concat(i[r],"'"))();else if(!a){const C=WW(r,s);aB.warn("".concat(g," loader option '").concat(o).concat(r,"' not recognized. ").concat(C))()}}}}function WW(t,e){const n=t.toLowerCase();let i="";for(const s of e)for(const g in s.options){if(t===g)return"Did you mean '".concat(s.id,".").concat(g,"'?");const o=g.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(s.id,".").concat(g,"'?"))}return i}function wW(t,e,n){const s={...t.options||{}};return NW(s,n),s.log===null&&(s.log=new FW),lB(s,d1()),lB(s,e),s}function lB(t,e){for(const n in e)if(n in e){const i=e[n];tB(i)&&tB(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function NW(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Qh(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Xh(t){var e,n;BC(t,"null loader"),BC(Qh(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const h1=()=>{const t=A1();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function TW(t){const e=h1();t=Array.isArray(t)?t:[t];for(const n of t){const i=Xh(n);e.find(s=>i===s)||e.unshift(i)}}function EW(){return h1()}const QW=new aI({id:"loaders.gl"}),XW=/\.([^.]+)$/;async function YW(t,e=[],n,i){if(!m1(t))return null;let s=CB(t,e,{...n,nothrow:!0},i);if(s)return s;if(zo(t)&&(t=await t.slice(0,10).arrayBuffer(),s=CB(t,e,n,i)),!s&&!(n!=null&&n.nothrow))throw new Error(f1(t));return s}function CB(t,e=[],n,i){if(!m1(t))return null;if(e&&!Array.isArray(e))return Xh(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...EW()),HW(s);const g=_W(t,s,n,i);if(!g&&!(n!=null&&n.nothrow))throw new Error(f1(t));return g}function _W(t,e,n,i){const{url:s,type:g}=Gc(t),o=s||(i==null?void 0:i.url);let r=null,a="";if(n!=null&&n.mimeType&&(r=KA(e,n==null?void 0:n.mimeType),a="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),r=r||kW(e,o),a=a||(r?"matched url ".concat(o):""),r=r||KA(e,g),a=a||(r?"matched MIME type ".concat(g):""),r=r||LW(e,t),a=a||(r?"matched initial data ".concat(p1(t)):""),r=r||KA(e,n==null?void 0:n.fallbackMimeType),a=a||(r?"matched fallback MIME type ".concat(g):""),a){var I;QW.log(1,"selectLoader selected ".concat((I=r)===null||I===void 0?void 0:I.name,": ").concat(a,"."))}return r}function m1(t){return!(t instanceof Response&&t.status===204)}function f1(t){const{url:e,type:n}=Gc(t);let i="No valid loader found (";i+=e?"".concat(P9(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?p1(t):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function HW(t){for(const e of t)Xh(e)}function kW(t,e){const n=e&&XW.exec(e),i=n&&n[1];return i?KW(t,i):null}function KW(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function KA(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function LW(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(MW(e,n))return n}else if(ArrayBuffer.isView(e)){if(cB(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&cB(e,0,n))return n;return null}function MW(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function cB(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>PW(t,e,n,s))}function PW(t,e,n,i){if(i instanceof ArrayBuffer)return N9(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const s=xu(t,e,i.length);return i===s;default:return!1}}function p1(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?xu(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?xu(t,0,e):""}function xu(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let s="";for(let g=0;g<n;g++)s+=String.fromCharCode(i.getUint8(e+g));return s}const JW=256*1024;function*DW(t,e){const n=(e==null?void 0:e.chunkSize)||JW;let i=0;const s=new TextEncoder;for(;i<t.length;){const g=Math.min(t.length-i,n),o=t.slice(i,i+g);i+=g,yield s.encode(o)}}const zW=256*1024;function*OW(t,e={}){const{chunkSize:n=zW}=e;let i=0;for(;i<t.byteLength;){const s=Math.min(t.byteLength-i,n),g=new ArrayBuffer(s),o=new Uint8Array(t,i,s);new Uint8Array(g).set(o),i+=s,yield g}}const jW=1024*1024;async function*qW(t,e){const n=(e==null?void 0:e.chunkSize)||jW;let i=0;for(;i<t.size;){const s=i+n,g=await t.slice(i,s).arrayBuffer();i=s,yield g}}function AB(t,e){return n1?$W(t,e):ew(t)}async function*$W(t,e){const n=t.getReader();let i;try{for(;;){const s=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:g,value:o}=await s;if(g)return;yield r1(o)}}catch{n.releaseLock()}}async function*ew(t,e){for await(const n of t)yield r1(n)}function tw(t,e){if(typeof t=="string")return DW(t,e);if(t instanceof ArrayBuffer)return OW(t,e);if(zo(t))return qW(t,e);if(a1(t))return AB(t,e);if(rI(t))return AB(t.body,e);throw new Error("makeIterator")}const B1="Cannot convert supplied data type";function nw(t,e,n){if(e.text&&typeof t=="string")return t;if(O9(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+s)),i}throw new Error(B1)}async function iw(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return nw(t,e);if(zo(t)&&(t=await I1(t)),rI(t)){const s=t;return await sW(s),e.binary?await s.arrayBuffer():await s.text()}if(a1(t)&&(t=tw(t,n)),D9(t)||z9(t))return E9(t);throw new Error(B1)}function sw(t,e,n=null){if(n)return n;const i={fetch:u1(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function gw(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Yh(t,e,n,i){Ei(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Qh(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:s}=Gc(t),o=gw(e,i),r=await YW(t,o,n);return r?(n=UW(n,r,o,s),i=sw({url:s,parse:Yh,loaders:o},n,i),await ow(r,t,n,i)):null}async function ow(t,e,n,i){if(V9(t),e=await iw(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(U9(t,n))return await x9(t,e,n,i,Yh);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Ei(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function vC(t,e,n,i){!Array.isArray(e)&&!Qh(e)&&(n=e,e=void 0);const s=u1(n);let g=t;return typeof t=="string"&&(g=await s(t)),zo(t)&&(g=await s(t)),await Yh(g,e,n)}const rw="3.1.7",{_parseImageNode:aw}=globalThis,Wu=typeof Image<"u",wu=typeof ImageBitmap<"u",Iw=Boolean(aw),Nu=n1?!0:Iw;function lw(t){switch(t){case"auto":return wu||Wu||Nu;case"imagebitmap":return wu;case"image":return Wu;case"data":return Nu;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Cw(){if(wu)return"imagebitmap";if(Wu)return"image";if(Nu)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function cw(t){const e=dw(t);if(!e)throw new Error("Not an image");return e}function Aw(t){switch(cw(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function dw(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const uw=/^data:image\/svg\+xml/,hw=/\.svg((\?|#).*)?$/;function _h(t){return t&&(uw.test(t)||hw.test(t))}function mw(t,e){if(_h(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(g){throw new Error(g.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return b1(t,e)}function b1(t,e){if(_h(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function y1(t,e,n){const i=mw(t,n),s=self.URL||self.webkitURL,g=typeof i!="string"&&s.createObjectURL(i);try{return await fw(g||i,e)}finally{g&&s.revokeObjectURL(g)}}async function fw(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,s)=>{try{n.onload=()=>i(n),n.onerror=g=>s(new Error("Could not load image ".concat(t,": ").concat(g)))}catch(g){s(g)}})}const pw={};let dB=!0;async function Bw(t,e,n){let i;_h(n)?i=await y1(t,e,n):i=b1(t,n);const s=e&&e.imagebitmap;return await bw(i,s)}async function bw(t,e=null){if((yw(e)||!dB)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),dB=!1}return await createImageBitmap(t)}function yw(t){for(const e in t||pw)return!1;return!0}const ti=!1,oa=!0;function v1(t){const e=II(t);return vw(e)||Rw(e)||Gw(e)||Zw(e)}function vw(t){const e=II(t);return e.byteLength>=24&&e.getUint32(0,ti)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ti),height:e.getUint32(20,ti)}:null}function Gw(t){const e=II(t);return e.byteLength>=10&&e.getUint32(0,ti)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,oa),height:e.getUint16(8,oa)}:null}function Zw(t){const e=II(t);return e.byteLength>=14&&e.getUint16(0,ti)===16973&&e.getUint32(2,oa)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,oa),height:e.getUint32(22,oa)}:null}function Rw(t){const e=II(t);if(!(e.byteLength>=3&&e.getUint16(0,ti)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=Fw();let g=2;for(;g+9<e.byteLength;){const o=e.getUint16(g,ti);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(g+5,ti),width:e.getUint16(g+7,ti)};if(!i.has(o))return null;g+=2,g+=e.getUint16(g,ti)}return null}function Fw(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function II(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Sw(t,e){const{mimeType:n}=v1(t)||{},i=globalThis._parseImageNode;return BC(i),await i(t,n)}async function Vw(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:g}=n||{},o=Uw(s);let r;switch(o){case"imagebitmap":r=await Bw(t,e,g);break;case"image":r=await y1(t,e,g);break;case"data":r=await Sw(t);break;default:BC(!1)}return s==="data"&&(r=Aw(r)),r}function Uw(t){switch(t){case"auto":case"data":return Cw();default:return lw(t),t}}const xw=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],Ww=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],ww={image:{type:"auto",decode:!0}},G1={id:"image",module:"images",name:"Images",version:rw,mimeTypes:Ww,extensions:xw,parse:Vw,tests:[t=>Boolean(v1(new DataView(t)))],options:ww};var ke={exports:{}};const Nw=Sv(uW);(function(t){t.exports=Nw})(ke);const me=new aI({id:"deck"});let Tu={};function Tw(t){Tu=t}function Nt(t){me.level>0&&Tu[t]&&Tu[t].call(...arguments)}function Ew(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const Qw={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Ew,parseTextSync:JSON.parse},ra="8.6.7",El=ke.exports.global.deck&&ke.exports.global.deck.VERSION;if(El&&El!==ra)throw new Error("deck.gl - multiple versions detected: ".concat(El," vs ").concat(ra));El||(me.log(1,"deck.gl ".concat(ra))(),ke.exports.global.deck=Object.assign(ke.exports.global.deck||{},{VERSION:ra,version:ra,log:me,_registerLoggers:Tw}),TW([Qw,[G1,{imagebitmap:{premultiplyAlpha:"none"}}]]));const Xw=ke.exports.global.deck,se=new aI({id:"luma.gl"});function Kt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Yw="Invalid WebGLRenderingContext",_w="Requires WebGL2";function Zc(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function be(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function Hw(t){return be(t)?t:null}function Rc(t){return Kt(Zc(t),Yw),t}function Et(t){return Kt(be(t),_w),t}const Hr={};function kw(t){ke.exports.global.console&&ke.exports.global.console.error&&ke.exports.global.console.error(t)}function Kw(t){ke.exports.global.console&&ke.exports.global.console.log&&ke.exports.global.console.log(t)}function Lw(t,e){Hr[t]=!0,e!==void 0&&kw(e)}function Mw(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Hr[i]=!0);while(i!==0);for(i in Hr)if(Hr[i])return delete Hr[i],parseInt(i,10);return 0}}const lI=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const s=new t.VertexAttrib(n);this.attribs[i]=s}this.maxAttrib=0};lI.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};lI.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Vg=function(e){const n=this;this.gl=e,Mw(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(g){return g===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(g){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,g);const r=o.attribs[g];return r.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(g){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,g);const r=o.attribs[g];return r.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(g,o){switch(g){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(g,o){const a=n.currentVertexArrayObject.attribs[g];switch(o){case 34975:return a.buffer;case 34338:return a.enabled;case 34339:return a.size;case 34340:return a.stride;case 34341:return a.type;case 34922:return a.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(g,o,r,a,I,l){const C=n.currentVertexArrayObject;C.maxAttrib=Math.max(C.maxAttrib,g);const c=C.attribs[g];return c.buffer=n.currentArrayBuffer,c.size=o,c.type=r,c.normalized=a,c.stride=I,c.offset=l,c.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{Kw("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Vg.prototype.VERTEX_ARRAY_BINDING_OES=34229;Vg.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new lI(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Vg.prototype.createVertexArrayOES=function(){const e=new lI(this);return this.vertexArrayObjects.push(e),e};Vg.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Vg.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof lI&&e.hasBeenBound&&e.ext===this)};Vg.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){Lw(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const g=this.currentVertexArrayObject;if(s===g)return;(!s||g.elementArrayBuffer!==s.elementArrayBuffer)&&i.bindBuffer.call(n,34963,g.elementArrayBuffer);let o=this.currentArrayBuffer;const r=Math.max(s?s.maxAttrib:0,g.maxAttrib);for(let a=0;a<=r;a++){const I=g.attribs[a],l=s?s.attribs[a]:null;if((!s||I.enabled!==l.enabled)&&(I.enabled?i.enableVertexAttribArray.call(n,a):i.disableVertexAttribArray.call(n,a)),I.enabled){let C=!1;(!s||I.buffer!==l.buffer)&&(o!==I.buffer&&(i.bindBuffer.call(n,34962,I.buffer),o=I.buffer),C=!0),(C||I.cached!==l.cached)&&i.vertexAttribPointer.call(n,a,I.size,I.type,I.normalized,I.stride,I.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function Pw(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};const n=t.getExtension;t.getExtension=function(s){const g=n.call(this,s);return g||(s!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Vg(this)),this.__OESVertexArrayObject))}}const uB="OES_element_index",hB="WEBGL_draw_buffers",Jw="EXT_disjoint_timer_query",Dw="EXT_disjoint_timer_query_webgl2",zw="EXT_texture_filter_anisotropic",mB="WEBGL_debug_renderer_info",Ow=35723,jw=4352,qw=36795,$w=34047,eN=37445,tN=37446,_e=t=>be(t)?void 0:0,nN={[3074]:t=>be(t)?void 0:36064,[Ow]:t=>be(t)?void 0:jw,[35977]:_e,[32937]:_e,[qw]:(t,e)=>{const n=be(t)?t.getExtension(Dw):t.getExtension(Jw);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[eN]:(t,e)=>{const n=t.getExtension(mB);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[tN]:(t,e)=>{const n=t.getExtension(mB);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[$w]:(t,e)=>{const n=t.luma.extensions[zw];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:_e,[35071]:_e,[37447]:_e,[36063]:(t,e)=>{if(!be(t)){const n=t.getExtension(hB);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:_e,[35374]:_e,[35377]:_e,[34852]:t=>{if(!be(t)){const e=t.getExtension(hB);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(uB)?2147483647:65535,[33001]:t=>t.getExtension(uB)?16777216:65535,[33e3]:t=>16777216,[37157]:_e,[35373]:_e,[35657]:_e,[36183]:_e,[37137]:_e,[34045]:_e,[35978]:_e,[35979]:_e,[35968]:_e,[35376]:_e,[35375]:_e,[35659]:_e,[37154]:_e,[35371]:_e,[35658]:_e,[35076]:_e,[35077]:_e,[35380]:_e};function iN(t,e,n){const i=nN[n],s=typeof i=="function"?i(t,e,n):i;return s!==void 0?s:e(n)}const sN="OES_vertex_array_object",Z1="ANGLE_instanced_arrays",gN="WEBGL_draw_buffers",oN="EXT_disjoint_timer_query",rN="EXT_texture_filter_anisotropic",aN="VertexArray requires WebGL2 or OES_vertex_array_object extension";function IN(t,e){return{webgl2:be(t),ext:t.getExtension(e)}}const R1={[sN]:{meta:{suffix:"OES"},createVertexArray:()=>{Kt(!1,aN)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Z1]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Kt(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[gN]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Kt(!1)}},[oN]:{meta:{suffix:"EXT"},createQuery:()=>{Kt(!1)},deleteQuery:()=>{Kt(!1)},beginQuery:()=>{Kt(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},LA={readBuffer:(t,e,n)=>{be(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:s,ext:g}=IN(t,Z1);let o;switch(i){case 35069:o=s?void 0:!1;break;case 35070:o=!s&&!g?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!be(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,s)=>{if(!be(t))switch(s){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,s)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:s}=t.luma,g=s[rN];i=g&&g.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:iN,hint(t,e,n,i){return e(n,i)}};function lN(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(Pw(t),cN(t),dN(t,R1),AN(t,{target:e,target2:t}),e.polyfilled=!0),t}const CN=typeof global<"u"?global:window;CN.polyfillContext=lN;function cN(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function AN(t,{target:e,target2:n}){Object.keys(LA).forEach(i=>{if(typeof LA[i]=="function"){const s=t[i]?t[i].bind(t):()=>{},g=LA[i].bind(null,t,s);e[i]=g,n[i]=g}})}function dN(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&uN(t,{extension:n,target:t.luma,target2:t})}function uN(t,{extension:e,target:n,target2:i}){const s=R1[e];Kt(s);const{meta:g={}}=s,{suffix:o=""}=g,r=t.getExtension(e);for(const a of Object.keys(s)){const I=`${a}${o}`;let l=null;a==="meta"||typeof t[a]=="function"||(r&&typeof r[I]=="function"?l=(...C)=>r[I](...C):typeof s[a]=="function"&&(l=s[a].bind(n))),l&&(n[a]=l,i[a]=l)}}const Hh={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Oi=(t,e,n)=>e?t.enable(n):t.disable(n),fB=(t,e,n)=>t.hint(n,e),en=(t,e,n)=>t.pixelStorei(n,e),hN=(t,e)=>{const n=be(t)?36009:36160;return t.bindFramebuffer(n,e)},mN=(t,e)=>t.bindFramebuffer(36008,e);function Zr(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const fN={[3042]:Oi,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Oi,[2885]:(t,e)=>t.cullFace(e),[2929]:Oi,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Oi,[35723]:fB,[36006]:hN,[2886]:(t,e)=>t.frontFace(e),[33170]:fB,[2849]:(t,e)=>t.lineWidth(e),[32823]:Oi,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Oi,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Oi,[3088]:(t,e)=>t.scissor(...e),[2960]:Oi,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:en,[3317]:en,[37440]:en,[37441]:en,[37443]:en,[3330]:en,[3332]:en,[3331]:en,[36010]:mN,[3314]:en,[32878]:en,[3316]:en,[3315]:en,[32877]:en,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Zr(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Zr(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Zr(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Zr(e)&&e.length===3?[...e,...e]:e;const[n,i,s,g,o,r]=e;t.stencilFuncSeparate(1028,n,i,s),t.stencilFuncSeparate(1029,g,o,r)},stencilOp:(t,e)=>{e=Zr(e)&&e.length===3?[...e,...e]:e;const[n,i,s,g,o,r]=e;t.stencilOpSeparate(1028,n,i,s),t.stencilOpSeparate(1029,g,o,r)},viewport:(t,e)=>t.viewport(...e)};function nt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const pN={blendEquation:(t,e,n)=>t.blendEquationSeparate(nt(32777,e,n),nt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(nt(32969,e,n),nt(32968,e,n),nt(32971,e,n),nt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(nt(32824,e,n),nt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(nt(32938,e,n),nt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,nt(2962,e,n),nt(2967,e,n),nt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,nt(34816,e,n),nt(36003,e,n),nt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,nt(2964,e,n),nt(2965,e,n),nt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,nt(34817,e,n),nt(34818,e,n),nt(34819,e,n))},pB={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,s)=>t({[32773]:new Float32Array([e,n,i,s])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,s)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:s}),clearColor:(t,e,n,i,s)=>t({[3106]:new Float32Array([e,n,i,s])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,s)=>t({[3107]:[e,n,i,s]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,s)=>t({[3088]:new Int32Array([e,n,i,s])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(t,e,n,i,s)=>t({[2978]:[e,n,i,s]})},qn=(t,e)=>t.isEnabled(e),BB={[3042]:qn,[2884]:qn,[2929]:qn,[3024]:qn,[32823]:qn,[32926]:qn,[32928]:qn,[3089]:qn,[2960]:qn,[35977]:qn};function F1(t){for(const e in t)return!1;return!0}function BN(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}function bB(t,e){const n=t[e].bind(t);t[e]=function(...s){const g=s[0];return g in t.state.cache?t.state.enable?t.state.cache[g]:n(...s):n(...s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function bN(t,e,n){const i=t[e].bind(t);t[e]=function(...g){const{valueChanged:o,oldValue:r}=n(t.state._updateCache,...g);return o&&i(...g),r},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function yN(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class vN{constructor(e,{copyState:n=!1,log:i=()=>{}}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?ZN(e):Object.assign({},Hh),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Kt(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Qi(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const g in e){Kt(g!==void 0);const o=e[g],r=this.cache[g];BN(o,r)||(n=!0,i=r,s&&!(g in s)&&(s[g]=r),this.cache[g]=o)}return{valueChanged:n,oldValue:i}}}function S1(t,e={}){const{enable:n=!0,copyState:i}=e;if(Kt(i!==void 0),!t.state){const s=typeof global<"u"?global:window,{polyfillContext:g}=s;g&&g(t),t.state=new vN(t,{copyState:i}),yN(t);for(const o in pB){const r=pB[o];bN(t,o,r)}bB(t,"getParameter"),bB(t,"isEnabled")}return t.state.enable=n,t}function GN(t){t.state||S1(t,{copyState:!1}),t.state.push()}function yB(t){Kt(t.state),t.state.pop()}function Qi(t,e){if(Kt(Zc(t),"setParameters requires a WebGL context"),F1(e))return;const n={};for(const s in e){const g=Number(s),o=fN[s];o&&(typeof o=="string"?n[o]=!0:o(t,e[s],g))}const i=t.state&&t.state.cache;if(i)for(const s in n){const g=pN[s];g(t,e,i)}}function ZN(t,e){if(e=e||Hh,typeof e=="number"){const s=e,g=BB[s];return g?g(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const s of n){const g=BB[s];i[s]=g?g(t,Number(s)):t.getParameter(Number(s))}return i}function RN(t){Qi(t,Hh)}function Mn(t,e,n){if(F1(e))return n(t);const{nocatch:i=!0}=e;GN(t),Qi(t,e);let s;if(i)s=n(t),yB(t);else try{s=n(t)}finally{yB(t)}return s}function wo(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function MA(t,e,n=!0){const i=wo(t),s=t.drawingBufferWidth,g=t.drawingBufferHeight;return SN(e,i,s,g,n)}function FN(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function SN(t,e,n,i,s){const g=vB(t[0],e,n);let o=GB(t[1],e,i,s),r=vB(t[0]+1,e,n);const a=r===n-1?r:r-1;r=GB(t[1]+1,e,i,s);let I;return s?(r=r===0?r:r+1,I=o,o=r):I=r===i-1?r:r-1,{x:g,y:o,width:Math.max(a-g+1,1),height:Math.max(I-o+1,1)}}function vB(t,e,n){return Math.min(Math.round(t*e),n-1)}function GB(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const kh=ke.exports.isBrowser(),VN=kh&&typeof document<"u",V1={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function U1(t={}){Kt(kh,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},V1,t);const{width:e,height:n}=t;function i(r){if(t.throwOnError)throw new Error(r);return console.error(r),null}t.onError=i;let s;const{canvas:g}=t,o=wN({canvas:g,width:e,height:n,onError:i});return s=WN(o,t),s?(s=Kh(s,t),NN(s),s):null}function Kh(t,e={}){if(!t||t._instrumented)return t;t._version=t._version||TN(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},V1,e);const{manageState:n,debug:i}=e;return n&&S1(t,{copyState:!1,log:(...s)=>se.log(1,...s)()}),kh&&i&&(ke.exports.global.makeDebugContext?(t=ke.exports.global.makeDebugContext(t,e),se.level=Math.max(se.level,1)):se.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function UN(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),s=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),g=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:g||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function xN(t,e={}){if(t.canvas){const i=FN(e.useDevicePixels);EN(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function WN(t,e){const{onError:n}=e;let i=null;const s=a=>i=a.statusMessage||i;t.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:g=!0,webgl2:o=!0}=e;let r=null;return o&&(r=r||t.getContext("webgl2",e),r=r||t.getContext("experimental-webgl2",e)),g&&(r=r||t.getContext("webgl",e),r=r||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",s,!1),r?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),r):n(`Failed to create ${o&&!g?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`)}function wN({canvas:t,width:e=800,height:n=600,onError:i}){let s;return typeof t=="string"?(VN&&document.readyState==="complete"||i(`createGLContext called on canvas '${t}' before page was loaded`),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(n)?`${n}px`:"100%",document.body.insertBefore(s,document.body.firstChild)),s}function NN(t){const e=be(t)?"WebGL2":"WebGL1",n=UN(t),i=n?`(${n.vendor},${n.renderer})`:"",s=t.debug?" debug":"";se.info(1,`${e}${s} context ${i}`)()}function TN(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function EN(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,s="height"in n?n.height:t.canvas.clientHeight;(!i||!s)&&(se.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,s=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const g=t.luma.canvasSizeInfo;if(g.clientWidth!==i||g.clientHeight!==s||g.devicePixelRatio!==e){let o=e;const r=Math.floor(i*o),a=Math.floor(s*o);t.canvas.width=r,t.canvas.height=a,(t.drawingBufferWidth!==r||t.drawingBufferHeight!==a)&&(se.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/s),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(s*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:s,devicePixelRatio:e})}}const aa="8.5.10",QN="set luma.log.level=1 (or higher) to trace rendering";class XN{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new vc({id:e})),this.stats.get(e)}}const rg=new XN;if(ke.exports.global.luma&&ke.exports.global.luma.VERSION!==aa)throw new Error(`luma.gl - multiple VERSIONs detected: ${ke.exports.global.luma.VERSION} vs ${aa}`);ke.exports.global.luma||(ke.exports.isBrowser()&&se.log(1,`luma.gl ${aa} - ${QN}`)(),ke.exports.global.luma=ke.exports.global.luma||{VERSION:aa,version:aa,log:se,stats:rg,globals:{modules:{},nodeIO:{}}});ke.exports.global.luma;function YN(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function _N(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function O(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function PA(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return O(i!==void 0,`Accessing undefined constant GL.${e}`),i}function Bs(t,e){e=Number(e);for(const n in t)if(t[n]===e)return`GL.${n}`;return String(e)}const JA={};function Vs(t="id"){JA[t]=JA[t]||1;const e=JA[t]++;return`${t}-${e}`}function ZB(t){return O(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function No(t){let e=!0;for(const n in t){e=!1;break}return e}function x1(t,e,n,i){const s=`See luma.gl ${n} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,g=Object.getPrototypeOf(t);i.forEach(o=>{g.methodName||(g[o]=()=>{throw se.removed(`Calling removed method ${e}.${o}: `,s)(),new Error(o)})})}const _g="Resource subclass must define virtual methods";class Ki{constructor(e,n={}){Rc(e);const{id:i,userData:s={}}=n;this.gl=e,this.gl2=e,this.id=i||Vs(this.constructor.name),this.userData=s,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(e=this.handle){if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e,n={}){e=PA(this.gl,e),O(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const g=be(this.gl);if(!((!("webgl2"in s)||g)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){const r=s.webgl1,a="webgl2"in s?s.webgl2:s.webgl1;return g?a:r}}return this._getParameter(e,n)}getParameters(e={}){const{parameters:n,keys:i}=e,s=this.constructor.PARAMETERS||{},g=be(this.gl),o={},r=n||Object.keys(s);for(const a of r){const I=s[a];if(I&&(!("webgl2"in I)||g)&&(!("extension"in I)||this.gl.getExtension(I.extension))){const C=i?Bs(this.gl,a):a;o[C]=this.getParameter(a,e),i&&I.type==="GLenum"&&(o[C]=Bs(this.gl,o[C]))}}return o}setParameter(e,n){e=PA(this.gl,e),O(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const g=be(this.gl);if(!((!("webgl2"in s)||g)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(n=PA(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return x1(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(_g)}_deleteHandle(){throw new Error(_g)}_bindHandle(e){throw new Error(_g)}_getOptsFromHandle(){throw new Error(_g)}_getParameter(e,n){throw new Error(_g)}_setParameter(e,n){throw new Error(_g)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,n=rg.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get(`${e}s Created`).incrementCount(),n.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;rg.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,n=this.constructor.name){const i=rg.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const n=rg.get("Memory Usage");n.get("GPU Memory").subtractCount(this.byteLength),n.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const HN="Failed to deduce GL constant from typed array";function Eu(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(HN)}}function xa(t,{clamped:e=!0}={}){switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function kN({data:t,width:e,height:n,bytesPerPixel:i=4,temp:s}){const g=e*i;s=s||new Uint8Array(g);for(let o=0;o<n/2;++o){const r=o*g,a=(n-o-1)*g;s.set(t.subarray(r,r+g)),t.copyWithin(r,a,a+g),t.set(s,a)}}function KN({data:t,width:e,height:n}){const i=Math.round(e/2),s=Math.round(n/2),g=new Uint8Array(i*s*4);for(let o=0;o<s;o++)for(let r=0;r<i;r++)for(let a=0;a<4;a++)g[(o*i+r)*4+a]=t[(o*2*e+r*2)*4+a];return{data:g,width:i,height:s}}function Qu(t,e,n){const{removedProps:i={},deprecatedProps:s={},replacedProps:g={}}=n;for(const r in i)if(r in e){const I=i[r]?`${t}.${i[r]}`:"N/A";se.removed(`${t}.${r}`,I)()}for(const r in s)if(r in e){const a=s[r];se.deprecated(`${t}.${r}`,`${t}.${a}`)()}let o=null;for(const r in g)if(r in e){const a=g[r];se.deprecated(`${t}.${r}`,`${t}.${a}`)(),o=o||Object.assign({},e),o[a]=e[r],delete o[r]}return o||e}const LN={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},MN={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class on{static getBytesPerElement(e){return xa(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return O(e.size),xa(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new on(LN,...e)}constructor(...e){e.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return on.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return on.getBytesPerVertex(this)}_assign(e={}){return e=Qu("Accessor",e,MN),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const RB=10,W1={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},PN={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:W1},JN={removedProps:W1};class we extends Ki{constructor(e,n={}){super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/on.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/on.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Qu("Buffer",e,PN),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Qu("Buffer",e,JN),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new on(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:s=0}=e,g=e.byteLength||e.length;O(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),s!==0||g!==void 0?(Et(this.gl),this.gl.bufferSubData(this.target,i,n,s,g)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData({sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:s}){const{gl:g}=this;return Et(g),g.bindBuffer(36662,e.handle),g.bindBuffer(36663,this.handle),g.copyBufferSubData(36662,36663,n,i,s),g.bindBuffer(36662,null),g.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:s=0}={}){Et(this.gl);const g=xa(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),r=i;let a,I;e?(I=e.length,a=I-r):(a=Math.min(o,s||o),I=r+a);const l=Math.min(o,a);return s=s||l,O(s<=l),e=e||new g(I),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,s),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:s}={}){return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,s):(O(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:n=this.accessor&&this.accessor.index}={}){return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(RB,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,n=0,i=e.byteLength+n){O(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.usage),this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,RB),this.bytesUsed=i,this._trackAllocatedMemory(i);const g=Eu(e);return O(g),this.setAccessor(new on(this.accessor,{type:g})),this}_setByteLength(e,n=this.usage){O(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,n),this.gl.bindBuffer(s,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=xa(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new on(this.accessor,{type:Eu(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return se.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return se.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return se.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return se.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new on(this.accessor,e),this}}const Lh={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},w1={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},N1={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function DN(t,e){const n=Lh[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=be(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function zN(t,e){const n=Lh[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const ON=[9729,9728],FB=ke.exports.global.WebGLBuffer||function(){};class pg extends Ki{static isSupported(e,n={}){const{format:i,linearFiltering:s}=n;let g=!0;return i&&(g=g&&DN(e,i),g=g&&(!s||zN(e,i))),g}constructor(e,n){const{id:i=Vs("texture"),handle:s,target:g}=n;super(e,{id:i,handle:s}),this.target=g,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let n=e.data;if(n instanceof Promise)return n.then(f=>this.initialize(Object.assign({},e,{pixels:f,data:f}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:s=null,format:g=6408,border:o=0,recreate:r=!1,parameters:a={},pixelStore:I={},textureUnit:l=void 0}=e;n||(n=s);let{width:C,height:c,dataFormat:A,type:d,compressed:h=!1,mipmaps:u=!0}=e;const{depth:m=0}=e;return{width:C,height:c,compressed:h,dataFormat:A,type:d}=this._deduceParameters({format:g,type:d,dataFormat:A,compressed:h,data:n,width:C,height:c}),this.width=C,this.height=c,this.depth=m,this.format=g,this.type=d,this.dataFormat=A,this.border=o,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),u&&this._isNPOT()&&(se.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),u=!1,this._updateForNPOT(a)),this.mipmaps=u,this.setImageData({data:n,width:C,height:c,depth:m,format:g,type:d,dataFormat:A,border:o,mipmaps:u,parameters:I,compressed:h}),u&&this.generateMipmap(),this.setParameters(a),r&&(this.data=n),i&&(this._video={video:n,parameters:a,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:n,mipmaps:i=!1}){return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(e={}){return this._isNPOT()?(se.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Mn(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:s=0,format:g=this.format,border:o=this.border,offset:r=0,parameters:a={}}=e;let{data:I=null,type:l=this.type,width:C=this.width,height:c=this.height,dataFormat:A=this.dataFormat,compressed:d=!1}=e;I||(I=i),{type:l,dataFormat:A,compressed:d,width:C,height:c}=this._deduceParameters({format:g,type:l,dataFormat:A,compressed:d,data:I,width:C,height:c});const{gl:h}=this;h.bindTexture(this.target,this.handle);let u=null;({data:I,dataType:u}=this._getDataType({data:I,compressed:d}));let m;if(Mn(this.gl,a,()=>{switch(u){case"null":h.texImage2D(n,s,g,C,c,o,A,l,I);break;case"typed-array":h.texImage2D(n,s,g,C,c,o,A,l,I,r);break;case"buffer":m=Et(h),m.bindBuffer(35052,I.handle||I),m.texImage2D(n,s,g,C,c,o,A,l,r),m.bindBuffer(35052,null);break;case"browser-object":be(h)?h.texImage2D(n,s,g,C,c,o,A,l,I):h.texImage2D(n,s,g,A,l,I);break;case"compressed":for(const[f,p]of I.entries())h.compressedTexImage2D(n,f,p.format,p.width,p.height,o,p.data);break;default:O(!1,"Unknown image data type")}}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const f=w1[this.dataFormat]||4,p=N1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*f*p,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:g=0,width:o=this.width,height:r=this.height,level:a=0,format:I=this.format,type:l=this.type,dataFormat:C=this.dataFormat,compressed:c=!1,offset:A=0,border:d=this.border,parameters:h={}}){if({type:l,dataFormat:C,compressed:c,width:o,height:r}=this._deduceParameters({format:I,type:l,dataFormat:C,compressed:c,data:i,width:o,height:r}),O(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const u=i;i=u.data,o=u.shape[0],r=u.shape[1]}i instanceof we&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Mn(this.gl,h,()=>{if(c)this.gl.compressedTexSubImage2D(e,a,s,g,o,r,I,i);else if(i===null)this.gl.texSubImage2D(e,a,s,g,o,r,C,l,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,a,s,g,o,r,C,l,i,A);else if(i instanceof FB){const u=Et(this.gl);u.bindBuffer(35052,i),u.texSubImage2D(e,a,s,g,o,r,C,l,A),u.bindBuffer(35052,null)}else be(this.gl)?Et(this.gl).texSubImage2D(e,a,s,g,o,r,C,l,i):this.gl.texSubImage2D(e,a,s,g,C,l,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return se.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType({data:e,compressed:n=!1}){return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof we?{data:e.handle,dataType:"buffer"}:e instanceof FB?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:s,height:g,dataFormat:o,type:r,compressed:a}=e;const I=Lh[n];return o=o||I&&I.dataFormat,r=r||I&&I.types[0],a=a||I&&I.compressed,{width:s,height:g}=this._deduceImageSize(i,s,g),{dataFormat:o,type:r,compressed:a,width:s,height:g,format:n,data:i}}_deduceImageSize(e,n,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:n,height:i}:s={width:n>=0?n:1,height:i>=0?i:1},O(s,"Could not deduced texture size"),O(n===void 0||s.width===n,"Deduced texture width does not match supplied width"),O(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:O(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return be(this.gl)||!this.width||!this.height?!1:!ZB(this.width)||!ZB(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:ON.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let jN="";function qN(t,e){return O(typeof t=="string"),t=jN+t,new Promise((n,i)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>i(new Error(`Could not load image ${t}.`)),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=t}catch(s){i(s)}})}class An extends pg{static isSupported(e,n){return pg.isSupported(e,n)}constructor(e,n={}){Rc(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:qN(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Xu=[34069,34070,34071,34072,34073,34074];class T1 extends pg{constructor(e,n={}){Rc(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(e={}){const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage({face:e,data:n,x:i=0,y:s=0,mipmapLevel:g=0}){return this._subImage({target:e,data:n,x:i,y:s,mipmapLevel:g})}async setCubeMapImageData({width:e,height:n,pixels:i,data:s,border:g=0,format:o=6408,type:r=5121}){const{gl:a}=this,I=i||s,l=await Promise.all(Xu.map(C=>{const c=I[C];return Promise.all(Array.isArray(c)?c:[c])}));this.bind(),Xu.forEach((C,c)=>{l[c].length>1&&this.opts.mipmaps!==!1&&se.warn(`${this.id} has mipmap and multiple LODs.`)(),l[c].forEach((A,d)=>{e&&n?a.texImage2D(C,d,o,e,n,g,o,r,A):a.texImage2D(C,d,o,o,r,A)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:s,pixels:g,data:o,border:r=0,format:a=6408,type:I=5121}=e,{gl:l}=this,C=g||o;return this.bind(),C instanceof Promise?C.then(c=>this.setImageDataForFace(Object.assign({},e,{face:n,data:c,pixels:c}))):this.width||this.height?l.texImage2D(n,0,a,i,s,r,a,I,C):l.texImage2D(n,0,a,a,I,C),this}}T1.FACES=Xu;class E1 extends pg{static isSupported(e){return be(e)}constructor(e,n={}){Et(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData({level:e=0,dataFormat:n=6408,width:i,height:s,depth:g=1,border:o=0,format:r,type:a=5121,offset:I=0,data:l,parameters:C={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Mn(this.gl,C,()=>{ArrayBuffer.isView(l)&&this.gl.texImage3D(this.target,e,n,i,s,g,o,r,a,l),l instanceof we&&(this.gl.bindBuffer(35052,l.handle),this.gl.texImage3D(this.target,e,n,i,s,g,o,r,a,I))}),l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const c=w1[this.dataFormat]||4,A=N1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*c*A,"Texture")}return this.loaded=!0,this}}const Ps="EXT_color_buffer_float",SB={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Ps,bpp:2},[33327]:{gl2:Ps,bpp:4},[34842]:{gl2:Ps,bpp:8},[33326]:{gl2:Ps,bpp:4},[33328]:{gl2:Ps,bpp:8},[34836]:{gl2:Ps,bpp:16},[35898]:{gl2:Ps,bpp:4}};function $N(t,e,n){const i=n[e];if(!i)return!1;const s=be(t)&&i.gl2||i.gl1;return typeof s=="string"?t.getExtension(s):s}class oo extends Ki{static isSupported(e,{format:n}={format:null}){return!n||$N(e,n,SB)}static getSamplesForFormat(e,{format:n}){return e.getInternalformatParameter(36161,n,32937)}constructor(e,n={}){super(e,n),this.initialize(n),Object.seal(this)}initialize({format:e,width:n=1,height:i=1,samples:s=0}){return O(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&be(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*SB[this.format].bpp),this}resize({width:e,height:n}){return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const eT=256,tT=1024,nT=16384,VB=6144,UB=6145,xB=6146,WB=34041,Q1="clear: bad arguments";function Mh(t,{framebuffer:e=null,color:n=null,depth:i=null,stencil:s=null}={}){const g={};e&&(g.framebuffer=e);let o=0;n&&(o|=nT,n!==!0&&(g.clearColor=n)),i&&(o|=eT,i!==!0&&(g.clearDepth=i)),s&&(o|=tT,i!==!0&&(g.clearStencil=i)),O(o!==0,Q1),Mn(t,g,()=>{t.clear(o)})}function iT(t,{framebuffer:e=null,buffer:n=VB,drawBuffer:i=0,value:s=[0,0,0,0]}={}){Et(t),Mn(t,{framebuffer:e},()=>{switch(n){case VB:switch(s.constructor){case Int32Array:t.clearBufferiv(n,i,s);break;case Uint32Array:t.clearBufferuiv(n,i,s);break;case Float32Array:default:t.clearBufferfv(n,i,s)}break;case UB:t.clearBufferfv(UB,0,[s]);break;case xB:t.clearBufferiv(xB,0,[s]);break;case WB:const[g,o]=s;t.clearBufferfi(WB,0,g,o);break;default:O(!1,Q1)}})}function sT(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return O(!1),0}}function Fc(t,e={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:s=6408}=e;let{sourceAttachment:g=36064,target:o=null,sourceWidth:r,sourceHeight:a,sourceType:I}=e;const{framebuffer:l,deleteFramebuffer:C}=X1(t);O(l);const{gl:c,handle:A,attachments:d}=l;r=r||l.width,a=a||l.height,g===36064&&A===null&&(g=1028),O(d[g]),I=I||d[g].type,o=oT(o,I,s,r,a),I=I||Eu(o);const h=c.bindFramebuffer(36160,A);return c.readPixels(n,i,r,a,s,I,o),c.bindFramebuffer(36160,h||null),C&&l.delete(),o}function wB(t,{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=Fc(t,{sourceAttachment:e}),{width:s,height:g}=t;for(;g>n;)({data:i,width:s,height:g}=KN({data:i,width:s,height:g}));kN({data:i,width:s,height:g});const o=document.createElement("canvas");o.width=s,o.height=g;const r=o.getContext("2d"),a=r.createImageData(s,g);return a.data.set(i),r.putImageData(a,0,0),o.toDataURL()}function gT(t,e,n={}){const{sourceX:i=0,sourceY:s=0,targetMipmaplevel:g=0,targetInternalFormat:o=6408}=n;let{targetX:r,targetY:a,targetZ:I,width:l,height:C}=n;const{framebuffer:c,deleteFramebuffer:A}=X1(t);O(c);const{gl:d,handle:h}=c,u=typeof r<"u"||typeof a<"u"||typeof I<"u";r=r||0,a=a||0,I=I||0;const m=d.bindFramebuffer(36160,h);O(e);let f=null;if(e instanceof pg&&(f=e,l=Number.isFinite(l)?l:f.width,C=Number.isFinite(C)?C:f.height,f.bind(0),e=f.target),!u)d.copyTexImage2D(e,g,o,i,s,l,C,0);else switch(e){case 3553:case 34067:d.copyTexSubImage2D(e,g,r,a,i,s,l,C);break;case 35866:case 32879:Et(d).copyTexSubImage3D(e,g,r,a,I,i,s,l,C);break}return f&&f.unbind(),d.bindFramebuffer(36160,m||null),A&&c.delete(),f}function X1(t){return t instanceof At?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:dT(t),deleteFramebuffer:!0}}function oT(t,e,n,i,s){if(t)return t;e=e||5121;const g=xa(e,{clamped:!1}),o=sT(n);return new g(i*s*o)}const Te={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function rT(t){const e=new An(t,{format:6408,type:5126,dataFormat:6408}),n=new At(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const Y1={[Te.WEBGL2]:[!1,!0],[Te.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Te.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Te.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Te.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Te.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Te.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Te.FLOAT_BLEND]:["EXT_float_blend"],[Te.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Te.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Te.TEXTURE_FLOAT]:["OES_texture_float",!0],[Te.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Te.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Te.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Te.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Te.COLOR_ATTACHMENT_RGBA32F]:[rT,"EXT_color_buffer_float"],[Te.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Te.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Te.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Te.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Te.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Te.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},aT=2;function Yu(t,e){return Ph(t,e)}function Ph(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>_1(t,n))}function IT(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in Y1)t.luma.caps[e]===void 0&&(t.luma.caps[e]=_1(t,e));return t.luma.caps}function _1(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=lT(t,e)),t.luma.caps[e]||se.log(aT,`Feature: ${e} not supported`)(),t.luma.caps[e]}function lT(t,e){const n=Y1[e];O(n,e);let i;const s=be(t)&&n[1]||n[0];if(typeof s=="function")i=s(t);else if(Array.isArray(s)){i=!0;for(const g of s)i=i&&Boolean(t.getExtension(g))}else typeof s=="string"?i=Boolean(t.getExtension(s)):typeof s=="boolean"?i=s:O(!1);return i}const NB="Multiple render targets not supported";class At extends Ki{static isSupported(e,n={}){const{colorBufferFloat:i,colorBufferHalfFloat:s}=n;let g=!0;return i&&(g=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(g=g&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),g}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new At(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Et(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Et(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,n={}){super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:n=1,attachments:i=null,color:s=!0,depth:g=!0,stencil:o=!1,check:r=!0,readBuffer:a=void 0,drawBuffers:I=void 0}){if(O(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const l in i){const C=i[l];(Array.isArray(C)?C[0]:C).resize({width:e,height:n})}else i=this._createDefaultAttachments(s,g,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:a,drawBuffers:I}),i&&r&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:g=!0}){this.attach(e,{clearAttachments:s,resizeAttachments:g});const{gl:o}=this,r=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,r||null),this}resize(e={}){let{width:n,height:i}=e;if(this.handle===null)return O(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&se.log(2,`Resizing framebuffer ${this.id} to ${n}x${i}`)();for(const s in this.attachments)this.attachments[s].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e,{clearAttachments:n=!1,resizeAttachments:i=!0}={}){const s={};n&&Object.keys(this.attachments).forEach(o=>{s[o]=null}),Object.assign(s,e);const g=this.gl.bindFramebuffer(36160,this.handle);for(const o in s){O(o!==void 0,"Misspelled framebuffer binding point?");const r=Number(o),a=s[r];let I=a;if(!I)this._unattach(r);else if(I instanceof oo)this._attachRenderbuffer({attachment:r,renderbuffer:I});else if(Array.isArray(a)){const[l,C=0,c=0]=a;I=l,this._attachTexture({attachment:r,texture:l,layer:C,level:c})}else this._attachTexture({attachment:r,texture:I,layer:0,level:0});i&&I&&I.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,g||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(cT(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(e={}){const{color:n,depth:i,stencil:s,drawBuffers:g=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||s)&&Mh(this.gl,{color:n,depth:i,stencil:s}),g.forEach((r,a)=>{iT(this.gl,{drawBuffer:a,value:r})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(e={}){return se.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return se.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return se.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return se.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return se.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return se.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:n=0,y:i=0,width:s,height:g}){const o=Et(this.gl),r=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&s===void 0&&g===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,s,g),o.bindFramebuffer(36008,r),this}getAttachmentParameter(e,n,i){let s=this._getAttachmentParameterFallback(n);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&s>1e3&&(s=Bs(this.gl,s)),s}getAttachmentParameters(e=36064,n,i=this.constructor.ATTACHMENT_PARAMETERS||[]){const s={};for(const g of i){const o=n?Bs(this.gl,g):g;s[o]=this.getAttachmentParameter(e,g,n)}return s}getParameters(e=!0){const n=Object.keys(this.attachments),i={};for(const s of n){const g=Number(s),o=e?Bs(this.gl,g):g;i[o]=this.getAttachmentParameters(g,e)}return i}show(){return typeof window<"u"&&window.open(wB(this),"luma-debug-texture"),this}log(e=0,n=""){if(e>se.level||typeof window>"u")return this;n=n||`Framebuffer ${this.id}`;const i=wB(this,{targetMaxHeight:100});return se.image({logLevel:e,message:n,image:i},n)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,s,g){let o=null;return e&&(o=o||{},o[36064]=new An(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:s,height:g,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new oo(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:s,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new oo(this.gl,{id:`${this.id}-depth`,format:33189,width:s,height:g}),this.ownResources.push(o[36096])):i&&O(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof oo?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:n}){const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture({attachment:e=36064,texture:n,layer:i,level:s}){const{gl:g}=this;switch(g.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Et(g).framebufferTextureLayer(36160,e,n.target,s,i);break;case 34067:const r=CT(i);g.framebufferTexture2D(36160,e,r,n.handle,s);break;case 3553:g.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:O(!1,"Illegal texture type")}g.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(e){const n=Hw(this.gl);n?n.readBuffer(e):O(e===36064||e===1029,NB),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=Et(n);if(i)i.drawBuffers(e);else{const s=n.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):O(e.length===1&&(e[0]===36064||e[0]===1029),NB)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=IT(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function CT(t){return t<34069?t+34069:t}function cT(t){return(At.STATUS||{})[t]||`Framebuffer error ${t}`}const AT=[36049,36048,33296,33298,33299,33300,33301,33302,33303];At.ATTACHMENT_PARAMETERS=AT;function H1(t,e){O(t instanceof An||t instanceof T1||t instanceof E1);const n=t.constructor,{gl:i,width:s,height:g,format:o,type:r,dataFormat:a,border:I,mipmaps:l}=t,C=Object.assign({width:s,height:g,format:o,type:r,dataFormat:a,border:I,mipmaps:l},e);return new n(i,C)}function dT(t,e){const{gl:n,width:i,height:s,id:g}=t;return new At(n,Object.assign({},e,{id:`framebuffer-for-${g}`,width:i,height:s,attachments:{[36064]:t}}))}function Ql(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const uT=35632,hT=35633;function mT(t){switch(t){case uT:return"fragment";case hT:return"vertex";default:return"unknown type"}}function fT(t,e,n,i){const s=t.split(/\r?\n/),g={},o={},r=i||Ql(e)||"(unnamed)",a=`${mT(n)} shader ${r}`;for(let l=0;l<s.length;l++){const C=s[l];if(C.length<=1)continue;const c=C.split(":"),A=c[0],d=parseInt(c[2],10);if(isNaN(d))throw new Error(`GLSL compilation error in ${a}: ${t}`);A!=="WARNING"?g[d]=C:o[d]=C}const I=pT(e);return{shaderName:a,errors:TB(g,I),warnings:TB(o,I)}}function TB(t,e){let n="";for(let i=0;i<e.length;i++){const s=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+=`${s}
`,t[i+1])){const g=t[i+1],o=g.split(":",3),r=o[0],a=parseInt(o[1],10)||0,I=g.substring(o.join(":").length+1).trim();n+=k1(`^^^ ${r}: ${I}

`,a)}}return n}function pT(t,e=1,n=": "){const i=t.split(/\r?\n/),s=String(i.length+e-1).length;return i.map((g,o)=>{const r=String(o+e),a=r.length;return k1(r,s-a)+n+g})}function k1(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return`${n}${t}`}function K1(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const BT="Shader: GLSL source code must be a JavaScript string";class Wa extends Ki{static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return O(!1),"unknown"}}constructor(e,n){Rc(e),O(typeof n.source=="string",BT);const i=Ql(n.source,null)||n.id||Vs(`unnamed ${Wa.getTypeName(n.shaderType)}`);super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize({source:e}){const n=Ql(e,null);n&&(this.id=Vs(n)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Wa.getTypeName(this.shaderType)}:${this.id}`}getName(){return Ql(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100
${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:g,warnings:o}=fT(i,this.source,this.shaderType,this.id);throw se.error(`GLSL compilation errors in ${s}
${g}`)(),se.warn(`GLSL compilation warnings in ${s}
${o}`)(),new Error(`GLSL compilation errors in ${s}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class DA extends Wa{constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class zA extends Wa{constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const bT={[5126]:Le.bind(null,"uniform1fv",tn,1,xt),[35664]:Le.bind(null,"uniform2fv",tn,2,xt),[35665]:Le.bind(null,"uniform3fv",tn,3,xt),[35666]:Le.bind(null,"uniform4fv",tn,4,xt),[5124]:Le.bind(null,"uniform1iv",ji,1,xt),[35667]:Le.bind(null,"uniform2iv",ji,2,xt),[35668]:Le.bind(null,"uniform3iv",ji,3,xt),[35669]:Le.bind(null,"uniform4iv",ji,4,xt),[35670]:Le.bind(null,"uniform1iv",ji,1,xt),[35671]:Le.bind(null,"uniform2iv",ji,2,xt),[35672]:Le.bind(null,"uniform3iv",ji,3,xt),[35673]:Le.bind(null,"uniform4iv",ji,4,xt),[35674]:Le.bind(null,"uniformMatrix2fv",tn,4,yi),[35675]:Le.bind(null,"uniformMatrix3fv",tn,9,yi),[35676]:Le.bind(null,"uniformMatrix4fv",tn,16,yi),[35678]:vt,[35680]:vt,[5125]:Le.bind(null,"uniform1uiv",PI,1,xt),[36294]:Le.bind(null,"uniform2uiv",PI,2,xt),[36295]:Le.bind(null,"uniform3uiv",PI,3,xt),[36296]:Le.bind(null,"uniform4uiv",PI,4,xt),[35685]:Le.bind(null,"uniformMatrix2x3fv",tn,6,yi),[35686]:Le.bind(null,"uniformMatrix2x4fv",tn,8,yi),[35687]:Le.bind(null,"uniformMatrix3x2fv",tn,6,yi),[35688]:Le.bind(null,"uniformMatrix3x4fv",tn,12,yi),[35689]:Le.bind(null,"uniformMatrix4x2fv",tn,8,yi),[35690]:Le.bind(null,"uniformMatrix4x3fv",tn,12,yi),[35678]:vt,[35680]:vt,[35679]:vt,[35682]:vt,[36289]:vt,[36292]:vt,[36293]:vt,[36298]:vt,[36299]:vt,[36300]:vt,[36303]:vt,[36306]:vt,[36307]:vt,[36308]:vt,[36311]:vt},yT={},vT={},GT={},EB=[0];function Jh(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(EB[0]=t,t=EB);const s=t.length;if(s%e&&se.warn(`Uniform size should be multiples of ${e}`,t)(),t instanceof n)return t;let g=i[s];g||(g=new n(s),i[s]=g);for(let o=0;o<s;o++)g[o]=t[o];return g}function tn(t,e){return Jh(t,e,Float32Array,yT)}function ji(t,e){return Jh(t,e,Int32Array,vT)}function PI(t,e){return Jh(t,e,Uint32Array,GT)}function QB(t,e,n){const i=bT[n.type];if(!i)throw new Error(`Unknown GLSL uniform type ${n.type}`);return i().bind(null,t,e)}function ZT(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function RT(t,e,n){for(const i in t){const s=t[i];if((!n||Boolean(n[i]))&&!FT(s))throw e=e?`${e} `:"",console.error(`${e} Bad uniform ${i}`,s),new Error(`${e} Bad uniform ${i}`)}return!0}function FT(t){return Array.isArray(t)||ArrayBuffer.isView(t)?VT(t):isFinite(t)||t===!0||t===!1||t instanceof pg||t instanceof oo?!0:t instanceof At?Boolean(t.texture):!1}function ST(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let s=0,g=n.length;s<g;++s)i[s]=n[s]}else t[e]=n.slice();else t[e]=n}function VT(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function vt(){let t=null;return(e,n,i)=>{const s=t!==i;return s&&(e.uniform1i(n,i),t=i),s}}function Le(t,e,n,i){let s=null,g=null;return(o,r,a)=>{const I=e(a,n),l=I.length;let C=!1;if(s===null)s=new Float32Array(l),g=l,C=!0;else{O(g===l,"Uniform length cannot change.");for(let c=0;c<l;++c)if(I[c]!==s[c]){C=!0;break}}return C&&(i(o,t,r,I),s.set(I)),C}}function xt(t,e,n,i){t[e](n,i)}function yi(t,e,n,i){t[e](n,!1,i)}const UT=5120,xT=5121,WT=5122,wT=5123,XB=0,JI=1,NT=2,TT=3,DI=4,ET=5,QT=6,lt=5126,XT=35664,YT=35665,_T=35666,Rr=5124,HT=35667,kT=35668,KT=35669,Fr=5125,LT=36294,MT=36295,PT=36296,JT=35670,DT=35671,zT=35672,OT=35673,jT=35674,qT=35675,$T=35676,e5=35685,t5=35686,n5=35687,i5=35688,s5=35689,g5=35690,_u={[lt]:[lt,1,"float"],[XT]:[lt,2,"vec2"],[YT]:[lt,3,"vec3"],[_T]:[lt,4,"vec4"],[Rr]:[Rr,1,"int"],[HT]:[Rr,2,"ivec2"],[kT]:[Rr,3,"ivec3"],[KT]:[Rr,4,"ivec4"],[Fr]:[Fr,1,"uint"],[LT]:[Fr,2,"uvec2"],[MT]:[Fr,3,"uvec3"],[PT]:[Fr,4,"uvec4"],[JT]:[lt,1,"bool"],[DT]:[lt,2,"bvec2"],[zT]:[lt,3,"bvec3"],[OT]:[lt,4,"bvec4"],[jT]:[lt,8,"mat2"],[e5]:[lt,8,"mat2x3"],[t5]:[lt,8,"mat2x4"],[qT]:[lt,12,"mat3"],[n5]:[lt,12,"mat3x2"],[i5]:[lt,12,"mat3x4"],[$T]:[lt,16,"mat4"],[s5]:[lt,16,"mat4x2"],[g5]:[lt,16,"mat4x3"]};function o5(t){switch(t){case XB:return XB;case JI:return JI;case TT:return JI;case NT:return JI;case DI:return DI;case ET:return DI;case QT:return DI;default:return O(!1),0}}function YB(t){const e=_u[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function L1(t,e){switch(t){case UT:case xT:case WT:case wT:t=lt;break}for(const n in _u){const[i,s,g]=_u[n];if(i===t&&s===e)return{glType:n,name:g}}return null}class r5{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let s=0;s<i;s++){const{name:g,type:o,size:r}=n.getActiveAttrib(e.handle,s),a=n.getAttribLocation(e.handle,g);a>=0&&this._addAttribute(a,g,o,r)}this.attributeInfos.sort((s,g)=>s.location-g.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!be(n))return;const i=n.getProgramParameter(e.handle,35971);for(let s=0;s<i;s++){const{name:g,type:o,size:r}=n.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,g,o,r)}this.varyingInfos.sort((s,g)=>s.location-g.location)}_addAttribute(e,n,i,s){const{type:g,components:o}=YB(i),r={type:g,size:s*o};this._inferProperties(e,n,r);const a={location:e,name:n,accessor:new on(r)};this.attributeInfos.push(a),this.attributeInfosByLocation[e]=a,this.attributeInfosByName[a.name]=a}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,s){const{type:g,components:o}=YB(i),r=new on({type:g,size:s*o}),a={location:e,name:n,accessor:r};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}const _B=4,a5=35981,I5=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class M1 extends Ki{constructor(e,n={}){super(e,n),this.stubRemovedMethods("Program","v6.0",I5),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(e={}){const{hash:n,vs:i,fs:s,varyings:g,bufferMode:o=a5}=e;return this.hash=n||"",this.vs=typeof i=="string"?new DA(this.gl,{id:`${e.id}-vs`,source:i}):i,this.fs=typeof s=="string"?new zA(this.gl,{id:`${e.id}-fs`,source:s}):s,O(this.vs instanceof DA),O(this.fs instanceof zA),this.uniforms={},this._textureUniforms={},g&&g.length>0&&(Et(this.gl),this.varyings=g,this.gl2.transformFeedbackVaryings(this.handle,g,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new r5(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:n=4,vertexCount:i,offset:s=0,start:g,end:o,isIndexed:r=!1,indexType:a=5123,instanceCount:I=0,isInstanced:l=I>0,vertexArray:C=null,transformFeedback:c,framebuffer:A,parameters:d={},uniforms:h,samplers:u}){if((h||u)&&(se.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(h||{})),se.priority>=e){const m=A?A.id:"default",f=`mode=${Bs(this.gl,n)} verts=${i} instances=${I} indexType=${Bs(this.gl,a)} isInstanced=${l} isIndexed=${r} Framebuffer=${m}`;se.log(e,f)()}return O(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||l&&I===0?!1:(C.bindForDraw(i,I,()=>{if(A!==void 0&&(d=Object.assign({},d,{framebuffer:A})),c){const m=o5(n);c.begin(m)}this._bindTextures(),Mn(this.gl,d,()=>{r&&l?this.gl2.drawElementsInstanced(n,i,a,s,I):r&&be(this.gl)&&!isNaN(g)&&!isNaN(o)?this.gl2.drawRangeElements(n,g,o,i,a,s):r?this.gl.drawElements(n,i,a,s):l?this.gl2.drawArraysInstanced(n,s,i,I):this.gl.drawArrays(n,s,i)}),c&&c.end()}),!0)}setUniforms(e={}){se.priority>=2&&RT(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],s=this._uniformSetters[n];if(s){let g=i,o=!1;if(g instanceof At&&(g=g.texture),g instanceof pg)if(o=this.uniforms[n]!==i,o){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const r=g,{textureIndex:a}=s;r.bind(a),g=a,this._textureUniforms[n]=r}else g=s.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(s(g)||o)&&ST(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const s of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new DA({handle:s});break;case 35632:i.fs=new zA({handle:s});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Vs(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),se.time(_B,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),se.timeEnd(_B,`linkProgram for ${this._getName()}`)(),e.debug||se.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:s}=ZT(i.name);let g=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=QB(e,g,i),i.size>1)for(let o=0;o<i.size;o++)g=e.getUniformLocation(this.handle,`${s}[${o}]`),this._uniformSetters[`${s}[${o}]`]=QB(e,g,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const l5=34918,C5=34919,c5=35007,A5=36795,d5=35976,u5=35887,h5=36202;class GC extends Ki{static isSupported(e,n=[]){const i=be(e),s=Ph(e,Te.TIMER_QUERY);let g=i||s;for(const o of n)switch(o){case"queries":g=g&&i;break;case"timers":g=g&&s;break;default:O(!1)}return g}constructor(e,n={}){super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(c5)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?h5:u5)}beginTransformFeedbackQuery(){return this.begin(d5)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,C5);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(A5)}getResult(){return this.gl2.getQueryParameter(this.handle,l5)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const g=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(g)};requestAnimationFrame(g)}),this._pollingPromise}_createHandle(){return GC.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class P1 extends Ki{static isSupported(e){return be(e)}constructor(e,n={}){Et(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,No(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:s,byteSize:g,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=s,se.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,s,o,g),this)}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,s;return e instanceof we?s=e:(s=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||s.byteLength-n),{buffer:s,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,s,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n,i=0,s){const g=n&&n.handle;return!g||s===void 0?this.gl.bindBufferBase(35982,e,g):this.gl.bindBufferRange(35982,e,g,i,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let zI=null;function m5(t){return(!zI||zI.byteLength<t)&&(zI=new ArrayBuffer(t)),zI}function f5(t,e){const n=m5(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function p5({target:t,source:e,start:n=0,count:i=1}){const s=e.length,g=i*s;let o=0;for(let r=n;o<s;o++)t[r++]=e[o];for(;o<g;)o<g-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+g-o),o=g);return t}const B5="elements must be GL.ELEMENT_ARRAY_BUFFER";class gn extends Ki{static isSupported(e,n={}){return n.constantAttributeZero?be(e)||l1()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new gn(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return gn.MAX_ATTRIBUTES=gn.MAX_ATTRIBUTES||e.getParameter(34921),gn.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:gn._setConstantFloatArray(e,n,i);break;case Int32Array:gn._setConstantIntArray(e,n,i);break;case Uint32Array:gn._setConstantUintArray(e,n,i);break;default:O(!1)}}constructor(e,n={}){const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return gn.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,n={}){return O(!e||e.target===34963,B5),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:s,type:g,stride:o,offset:r,normalized:a,integer:I,divisor:l}=i,{gl:C,gl2:c}=this;return e=Number(e),this.bind(()=>{C.bindBuffer(34962,n.handle),I?(O(be(C)),c.vertexAttribIPointer(e,s,g,o,r)):C.vertexAttribPointer(e,s,g,a,o,r),C.enableVertexAttribArray(e),c.vertexAttribDivisor(e,l||0)}),this}enable(e,n=!0){return!n&&e===0&&!gn.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),s=i.byteLength*e,g=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new we(this.gl,s),o=o||this.buffer.reallocate(s),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const r=f5(n.constructor,g);p5({target:r,source:i,start:0,count:g}),this.buffer.subData(r),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:O(!1)}}static _setConstantIntArray(e,n,i){switch(O(be(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:O(!1)}}static _setConstantUintArray(e,n,i){switch(O(be(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:O(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:n}){return O(Number.isFinite(n)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(n,e);default:return this.gl.getVertexAttrib(n,e)}})}}const b5="VertexArray: attributes must be Buffers or constants (i.e. typed array)",y5=/^(.+)__LOCATION_([0-9]+)$/,v5=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class G5{constructor(e,n={}){const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new gn(e),x1(this,"VertexArray","v6.0",v5),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(e=null,n={}){return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n,i={}){if(n.target===34963)return this.setElementBuffer(n,i);const{location:s,accessor:g}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return s>=0&&(this.values[s]=n,this.accessors[s]=g,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,n,g)),this}setConstant(e,n,i={}){const{location:s,accessor:g}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return s>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[s]=n,this.accessors[s]=g,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new we(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof we&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof we&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),s=i()}),s}_resolveLocationAndAccessor(e,n,i,s){const g={location:-1,accessor:null},{location:o,name:r}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,se.once(3,()=>`unused value ${e} in ${this.id}`)(),g;const a=this._getAttributeInfo(r||o);if(!a)return g;const I=this.accessors[o]||{},l=on.resolve(a.accessor,I,i,s),{size:C,type:c}=l;return O(Number.isFinite(C)&&Number.isFinite(c)),{location:o,accessor:l}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=y5.exec(e),s=i?i[1]:e,g=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+g,name:s}:{location:-1}}_setAttribute(e,n){if(n instanceof we)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof we){const i=n[0],s=n[1];this.setBuffer(e,i,s)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof we){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(b5)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,i);for(let g=1;g<this.vertexArrayObject.MAX_ATTRIBUTES;g++)s=this.values[g],ArrayBuffer.isView(s)&&this._setConstantAttribute(g,s)}_setConstantAttributeZero(e,n){if(gn.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){gn.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],s=this.accessors[n];if(!i)return;const{divisor:g}=s,o=g>0;if(e.isInstanced=e.isInstanced||o,i instanceof we){const r=i;if(o){const a=r.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,a)}else{const a=r.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,a)}}}setElements(e=null,n={}){return se.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function Z5(t,e){const{maxElts:n=16,size:i=1}=e;let s="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(s+=`,${o%i===0?" ":""}`),s+=wa(t[o],e);const g=t.length>n?"...":"]";return`${s}${g}`}function wa(t,e={}){const{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return Z5(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const s=t.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function HB({header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}){O(e);const s=".*_.*",g=".*Matrix",o=e._uniformSetters,r={},a=Object.keys(o).sort();let I=0;for(const c of a)!c.match(s)&&!c.match(g)&&OA({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&I++;for(const c of a)c.match(g)&&OA({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&I++;for(const c of a)r[c]||OA({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&I++;let l=0;const C={};if(!i)for(const c in n){const A=n[c];r[c]||(l++,C[c]={Type:`NOT USED: ${A}`,[t]:wa(A)})}return{table:r,count:I,unusedTable:C,unusedCount:l}}function OA({table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:s}){const g=n[i],o=R5(g);return!s||!o?(t[i]={[e]:o?wa(g):"N/A","Uniform Type":o?g:"NOT PROVIDED"},!0):!1}function R5(t){return t!=null}function F5({vertexArray:t,header:e="Attributes"}){if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=kB(t,t.elements,null,e));const i=t.values;for(const s in i){const g=t._getAttributeInfo(s);if(g){let o=`${s}: ${g.name}`;const r=t.accessors[g.location];r&&(o=`${s}: ${S5(g.name,r)}`),n[o]=kB(t,i[s],r,e)}}return n}function kB(t,e,n,i){const{gl:s}=t;if(!e)return{[i]:"null","Format ":"N/A"};let g="NOT PROVIDED",o=1,r=0,a=0,I,l,C;if(n&&(g=n.type,o=n.size,g=String(g).replace("Array",""),I=g.indexOf("nt")!==-1),e instanceof we){const c=e,{data:A,changed:d}=c.getDebugData();l=d?"*":"",C=A,a=c.byteLength,r=a/A.BYTES_PER_ELEMENT/o;let h;return n?h=`${n.divisor>0?"I ":"P "} ${r} (x${o}=${a} bytes ${Bs(s,g)})`:(I=!0,h=`${a} bytes`),{[i]:`${l}${wa(C,{size:o,isInteger:I})}`,"Format ":h}}return C=e,o=e.length,g=String(e.constructor.name).replace("Array",""),I=g.indexOf("nt")!==-1,{[i]:`${wa(C,{size:o,isInteger:I})} (constant)`,"Format ":`${o}x${g} (constant)`}}function S5(t,e){const{type:n,size:i}=e,s=L1(n,i);return s?`${t} (${s.name})`:t}function V5(t){const e={},n=`Accessors for ${t.id}`;for(const i of t.attributeInfos)if(i){const s=KB(i);e[`in ${s}`]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const s=KB(i);e[`out ${s}`]={[n]:JSON.stringify(i.accessor)}}return e}function KB(t){const{type:e,size:n}=t.accessor,i=L1(e,n);return i?`${i.name} ${t.name}`:t.name}const LB=ke.exports.isBrowser()&&typeof document<"u";let U5=0;class x5{constructor(e={}){const{onCreateContext:n=u=>U1(u),onAddHTML:i=null,onInitialize:s=()=>{},onRender:g=()=>{},onFinalize:o=()=>{},onError:r,gl:a=null,glOptions:I={},debug:l=!1,createFramebuffer:C=!1,autoResizeViewport:c=!0,autoResizeDrawingBuffer:A=!0,stats:d=rg.get(`animation-loop-${U5++}`)}=e;let{useDevicePixels:h=!0}=e;"useDevicePixelRatio"in e&&(se.deprecated("useDevicePixelRatio","useDevicePixels")(),h=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:s,onRender:g,onFinalize:o,onError:r,gl:a,glOptions:I,debug:l,createFramebuffer:C},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=d,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:c,autoResizeDrawingBuffer:A,useDevicePixels:h}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return O(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=GC.isSupported(this.gl,["timers"])?new GC(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,n=1){const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return se.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=LB?new Promise((e,n)=>{if(LB&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):_N(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):YN(e)}_renderFrame(...e){if(this.display){this.display._renderFrame(...e);return}this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Kh(this.props.gl,e):this.onCreateContext(e),!Zc(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");RN(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&xN(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new At(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const CI="vs",Dh="fs";function ln(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const jA={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function W5(t){const e={};for(const n in t){const i=t[n],s=w5(i);e[n]=s}return e}function w5(t){let e=MB(t);return e==="object"?t?"type"in t?Object.assign({},t,jA[t.type]):"value"in t?(e=MB(t.value),Object.assign({type:e},t,jA[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},jA[e])}function MB(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const N5="vs",T5="fs";class PB{constructor({name:e,vs:n,fs:i,dependencies:s=[],uniforms:g,getUniforms:o,deprecations:r=[],defines:a={},inject:I={},vertexShader:l,fragmentShader:C}){ln(typeof e=="string"),this.name=e,this.vs=n||l,this.fs=i||C,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(r),this.defines=a,this.injections=E5(I),g&&(this.uniforms=W5(g))}getModuleSource(e){let n;switch(e){case N5:n=this.vs||"";break;case T5:n=this.fs||"";break;default:ln(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}
${n}// END MODULE_${this.name}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},i=this.uniforms;for(const s in i){const g=i[s];s in e&&!g.private?(g.validate&&ln(g.validate(e[s],g),`${this.name}: invalid ${s}`),n[s]=e[s]):n[s]=g.value}return n}}function E5(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const s=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[s][n]=i}return e}function Q5(t){return X5(D1(t))}function X5(t){const e={},n={};return J1({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i])}function J1({modules:t,level:e,moduleMap:n,moduleDepth:i}){if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e);for(const s of t)s.dependencies&&J1({modules:s.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function D1(t,e){return t.map(n=>(n instanceof PB||(ln(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${n}' and use it directly.`),ln(n.name,"shader module has no name"),n=new PB(n),n.dependencies=D1(n.dependencies)),n))}function Y5(t={}){const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s}const _5=7936,H5=7937,k5=7938,K5=35724,zh={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},js={};Object.keys(zh).forEach(t=>{js[t]=t});function L5(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function M5(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||_5),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||H5);return{gpuVendor:P5(n,i),vendor:n,renderer:i,version:t.getParameter(k5),shadingLanguageVersion:t.getParameter(K5)}}function P5(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const qA={};function JB(t,e,n={}){const i=zh[e];if(ln(i,e),!Y5(n))return!0;if(e in qA)return qA[e];const s=i[0],g=n.behavior||"enable",o=`#extension GL_${s} : ${g}
void main(void) {}`,r=t.createShader(35633);t.shaderSource(r,o),t.compileShader(r);const a=t.getShaderParameter(r,35713);return t.deleteShader(r),qA[e]=a,a}function J5(t,e){const n=zh[e];ln(n,e);const i=L5(t)&&n[1]||n[0],s=typeof i=="string"?Boolean(t.getExtension(i)):i;return ln(s===!1||s===!0),s}function OI(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>J5(t,n))}function D5(t){switch(M5(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function z5(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return OI(t,js.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),OI(t,js.GLSL_DERIVATIVES)&&JB(t,js.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),OI(t,js.GLSL_FRAG_DATA)&&JB(t,js.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),OI(t,js.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const O5=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,j5=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,q5={[CI]:O5,[Dh]:j5},Xl="__LUMA_INJECT_DECLARATIONS__",DB=/void\s+main\s*\([^)]*\)\s*\{\n?/,zB=/}\n?[^{}]*$/,$A=[];function OB(t,e,n,i=!1){const s=e===CI;for(const g in n){const o=n[g];o.sort((a,I)=>a.order-I.order),$A.length=o.length;for(let a=0,I=o.length;a<I;++a)$A[a]=o[a].injection;const r=`${$A.join(`
`)}
`;switch(g){case"vs:#decl":s&&(t=t.replace(Xl,r));break;case"vs:#main-start":s&&(t=t.replace(DB,a=>a+r));break;case"vs:#main-end":s&&(t=t.replace(zB,a=>r+a));break;case"fs:#decl":s||(t=t.replace(Xl,r));break;case"fs:#main-start":s||(t=t.replace(DB,a=>a+r));break;case"fs:#main-end":s||(t=t.replace(zB,a=>r+a));break;default:t=t.replace(g,a=>a+r)}}return t=t.replace(Xl,""),i&&(t=t.replace(/\}\s*$/,g=>g+q5[e])),t}function Hu(t){const e={};return ln(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?`${e[i]}
${n[i]}`:n[i]}),e}function To(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const z1=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],$5=[...z1,[To("attribute"),"in $1"],[To("varying"),"out $1"]],eE=[...z1,[To("varying"),"in $1"]],O1=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],tE=[...O1,[To("in"),"attribute $1"],[To("out"),"varying $1"]],nE=[...O1,[To("in"),"varying $1"]],ku="gl_FragColor",Ku=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,iE=/void\s+main\s*\([^)]*\)\s*\{\n?/;function sE(t,e,n){switch(e){case 300:return n?ZC(t,$5):gE(t);case 100:return n?ZC(t,tE):oE(t);default:throw new Error(`unknown GLSL version ${e}`)}}function ZC(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function gE(t){t=ZC(t,eE);const e=t.match(Ku);if(e){const n=e[1];t=t.replace(new RegExp(`\\b${ku}\\b`,"g"),n)}else{const n="fragmentColor";t=t.replace(iE,i=>`out vec4 ${n};
${i}`).replace(new RegExp(`\\b${ku}\\b`,"g"),n)}return t}function oE(t){t=ZC(t,nE);const e=t.match(Ku);if(e){const n=e[1];t=t.replace(Ku,"").replace(new RegExp(`\\b${n}\\b`,"g"),ku)}return t}const rE=`

${Xl}

`,j1={[CI]:"vertex",[Dh]:"fragment"},aE=`precision highp float;

`;function IE(t,e){const{vs:n,fs:i}=e,s=Q5(e.modules||[]);return{gl:t,vs:jB(t,Object.assign({},e,{source:n,type:CI,modules:s})),fs:jB(t,Object.assign({},e,{source:i,type:Dh,modules:s})),getUniforms:lE(s)}}function jB(t,{id:e,source:n,type:i,modules:s,defines:g={},hookFunctions:o=[],inject:r={},transpileToGLSL100:a=!1,prologue:I=!0,log:l}){ln(typeof n=="string","shader source must be a string");const C=i===CI,c=n.split(`
`);let A=100,d="",h=n;c[0].indexOf("#version ")===0?(A=300,d=c[0],h=c.slice(1).join(`
`)):d=`#version ${A}`;const u={};s.forEach(y=>{Object.assign(u,y.getDefines())}),Object.assign(u,g);let m=I?`${d}
${cE({id:e,source:n,type:i})}
${CE({type:i})}
${D5(t)}
${z5(t)}
${AE(u)}
${C?"":aE}
`:`${d}
`;const f=uE(o),p={},B={},G={};for(const y in r){const U=typeof r[y]=="string"?{injection:r[y],order:0}:r[y],V=y.match(/^(v|f)s:(#)?([\w-]+)$/);if(V){const F=V[2],W=V[3];F?W==="decl"?B[y]=[U]:G[y]=[U]:p[y]=[U]}else G[y]=[U]}for(const y of s){l&&y.checkDeprecations(h,l),m+=y.getModuleSource(i,A);const V=y.injections[i];for(const F in V){const W=F.match(/^(v|f)s:#([\w-]+)$/);if(W){const E=W[2]==="decl"?B:G;E[F]=E[F]||[],E[F].push(V[F])}else p[F]=p[F]||[],p[F].push(V[F])}}return m+=rE,m=OB(m,i,B),m+=dE(f[i],p),m+=h,m=OB(m,i,G),m=sE(m,a?100:A,C),m}function lE(t){return function(n){const i={};for(const s of t){const g=s.getUniforms(n,i);Object.assign(i,g)}return i}}function CE({type:t}){return`
#define SHADER_TYPE_${j1[t].toUpperCase()}
`}function cE({id:t,source:e,type:n}){return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${j1[n]}

`:""}function AE(t={}){let e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const s=t[i];(s||Number.isFinite(s))&&(n+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e===0&&(n+=`
`),n}function dE(t,e){let n="";for(const i in t){const s=t[i];if(n+=`void ${s.signature} {
`,s.header&&(n+=`  ${s.header}`),e[i]){const g=e[i];g.sort((o,r)=>o.order-r.order);for(const o of g)n+=`  ${o.injection}
`}s.footer&&(n+=`  ${s.footer}`),n+=`}
`}return n}function uE(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[s,g]=n.split(":"),o=n.replace(/\(.+/,"");e[s][o]=Object.assign(i,{signature:g})}),e}const hE="void main() {gl_FragColor = vec4(0);}",q1=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,mE=`#version 300 es
${q1}`;function $1(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,s,g]=n;if(!e.includes(i)||!s||!g)return null;const o=g.split(";")[0];return{qualifier:i,type:s,name:o}}function e2(t={}){const{version:e=100,input:n,inputType:i,output:s}=t;if(!n)return e===300?mE:e>300?`#version ${e}
${q1}`:hE;const g=BE(n,i);return e>=300?`#version ${e} ${e===300?"es":""}
in ${i} ${n};
out vec4 ${s};
void main() {
  ${s} = ${g};
}`:`varying ${i} ${n};
void main() {
  gl_FragColor = ${g};
}`}function fE(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ln(!1),null}}function pE(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ln(!1),null}}function BE(t,e){switch(e){case"float":return`vec4(${t}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${t}, 0.0, 1.0)`;case"vec3":return`vec4(${t}, 1.0)`;case"vec4":return t;default:return ln(!1),null}}const bE=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,yE={name:"fp32",vs:bE,fs:null};function Lt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const ct={};ct.EPSILON=1e-12;ct.debug=!1;ct.precision=4;ct.printTypes=!1;ct.printDegrees=!1;ct.printRowMajor=!0;function vE(t){return Math.round(t/ct.EPSILON)*ct.EPSILON}function GE(t,{precision:e=ct.precision||4}={}){return t=vE(t),"".concat(parseFloat(t.toPrecision(e)))}function Eo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ZE(t){return t.clone?t.clone():new Array(t.length)}function RE(t,e,n){if(Eo(t)){n=n||ZE(t);for(let i=0;i<n.length&&i<t.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function rn(t,e,n){return RE(t,i=>Math.max(e,Math.min(n,i)))}function dg(t,e,n){return Eo(t)?t.map((i,s)=>dg(i,e[s],n)):n*e+(1-n)*t}function bs(t,e,n){const i=ct.EPSILON;n&&(ct.EPSILON=n);try{if(t===e)return!0;if(Eo(t)&&Eo(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!bs(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):Number.isFinite(t)&&Number.isFinite(e)?Math.abs(t-e)<=ct.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ct.EPSILON=i}}function FE(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class Oh extends FE(Array){get ELEMENTS(){return Lt(!1),0}clone(){return new this.constructor().copy(this)}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}to(e){return e===this?this:Eo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ct)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+GE(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!bs(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){i===void 0&&(i=n,n=e,e=this);for(let s=0;s<this.ELEMENTS;++s){const g=e[s];this[s]=g+i*(n[s]-g)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(Array.isArray(e))return this.multiply(e);for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.scale(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}multiplyByScalar(e){return this.scale(e)}get elements(){return this}check(){if(ct.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}}function SE(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Zt(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Ia(t,e,n=""){if(ct.debug&&!SE(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}const qB={};function vo(t,e){qB[t]||(qB[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}class VE extends Oh{get ELEMENTS(){return Lt(!1),0}copy(e){return Lt(!1),this}get x(){return this[0]}set x(e){this[0]=Zt(e)}get y(){return this[1]}set y(e){this[1]=Zt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];n+=s*s}return Zt(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return Zt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Lt(e>=0&&e<this.ELEMENTS,"index is out of range"),Zt(this[e])}setComponent(e,n){return Lt(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var la=1e-6,Dn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function UE(){var t=new Dn(2);return Dn!=Float32Array&&(t[0]=0,t[1]=0),t}function RC(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function t2(t,e){return t[0]=-e[0],t[1]=-e[1],t}function n2(t,e,n,i){var s=e[0],g=e[1];return t[0]=s+i*(n[0]-s),t[1]=g+i*(n[1]-g),t}function xE(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[3]*s+n[6],t[1]=n[1]*i+n[4]*s+n[7],t}function WE(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t}(function(){var t=UE();return function(e,n,i,s,g,o){var r,a;for(n||(n=2),i||(i=0),s?a=Math.min(s*n+i,e.length):a=e.length,r=i;r<a;r+=n)t[0]=e[r],t[1]=e[r+1],g(t,t,o),e[r]=t[0],e[r+1]=t[1];return e}})();function wE(t,e,n){const i=e[0],s=e[1],g=n[3]*i+n[7]*s||1;return t[0]=(n[0]*i+n[4]*s)/g,t[1]=(n[1]*i+n[5]*s)/g,t}function i2(t,e,n){const i=e[0],s=e[1],g=e[2],o=n[3]*i+n[7]*s+n[11]*g||1;return t[0]=(n[0]*i+n[4]*s+n[8]*g)/o,t[1]=(n[1]*i+n[5]*s+n[9]*g)/o,t[2]=(n[2]*i+n[6]*s+n[10]*g)/o,t}function NE(t,e,n){const i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t[2]=e[2],t}function TE(t,e,n){const i=e[0],s=e[1],g=e[2];return t[0]=n[0]*i+n[3]*s+n[6]*g,t[1]=n[1]*i+n[4]*s+n[7]*g,t[2]=n[2]*i+n[5]*s+n[8]*g,t[3]=e[3],t}function s2(){var t=new Dn(3);return Dn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function EE(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function $B(t,e,n){var i=new Dn(3);return i[0]=t,i[1]=e,i[2]=n,i}function QE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function XE(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function YE(t,e){var n=e[0],i=e[1],s=e[2],g=n*n+i*i+s*s;return g>0&&(g=1/Math.sqrt(g)),t[0]=e[0]*g,t[1]=e[1]*g,t[2]=e[2]*g,t}function g2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Yl(t,e,n){var i=e[0],s=e[1],g=e[2],o=n[0],r=n[1],a=n[2];return t[0]=s*a-g*r,t[1]=g*o-i*a,t[2]=i*r-s*o,t}function o2(t,e,n){var i=e[0],s=e[1],g=e[2],o=n[3]*i+n[7]*s+n[11]*g+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*s+n[8]*g+n[12])/o,t[1]=(n[1]*i+n[5]*s+n[9]*g+n[13])/o,t[2]=(n[2]*i+n[6]*s+n[10]*g+n[14])/o,t}function r2(t,e,n){var i=e[0],s=e[1],g=e[2];return t[0]=i*n[0]+s*n[3]+g*n[6],t[1]=i*n[1]+s*n[4]+g*n[7],t[2]=i*n[2]+s*n[5]+g*n[8],t}function _E(t,e,n){var i=n[0],s=n[1],g=n[2],o=n[3],r=e[0],a=e[1],I=e[2],l=s*I-g*a,C=g*r-i*I,c=i*a-s*r,A=s*c-g*C,d=g*l-i*c,h=i*C-s*l,u=o*2;return l*=u,C*=u,c*=u,A*=2,d*=2,h*=2,t[0]=r+l+A,t[1]=a+C+d,t[2]=I+c+h,t}function HE(t,e,n,i){var s=[],g=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],g[0]=s[0],g[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),g[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=g[0]+n[0],t[1]=g[1]+n[1],t[2]=g[2]+n[2],t}function kE(t,e,n,i){var s=[],g=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],g[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),g[1]=s[1],g[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=g[0]+n[0],t[1]=g[1]+n[1],t[2]=g[2]+n[2],t}function KE(t,e,n,i){var s=[],g=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],g[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),g[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),g[2]=s[2],t[0]=g[0]+n[0],t[1]=g[1]+n[1],t[2]=g[2]+n[2],t}function LE(t,e){var n=t[0],i=t[1],s=t[2],g=e[0],o=e[1],r=e[2],a=Math.sqrt(n*n+i*i+s*s),I=Math.sqrt(g*g+o*o+r*r),l=a*I,C=l&&g2(t,e)/l;return Math.acos(Math.min(Math.max(C,-1),1))}var ME=QE,PE=EE;(function(){var t=s2();return function(e,n,i,s,g,o){var r,a;for(n||(n=3),i||(i=0),s?a=Math.min(s*n+i,e.length):a=e.length,r=i;r<a;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],g(t,t,o),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2];return e}})();const ed=[0,0,0],eb={};class j extends VE{static get ZERO(){return eb.ZERO=eb.ZERO||Object.freeze(new j(0,0,0,0))}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Eo(e)?this.copy(e):(ct.debug&&(Zt(e),Zt(n),Zt(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ct.debug&&(Zt(e.x),Zt(e.y),Zt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Zt(e)}angle(e){return LE(this,e)}cross(e){return Yl(this,this,e),this.check()}rotateX({radians:e,origin:n=ed}){return HE(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ed}){return kE(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ed}){return KE(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return o2(this,this,e),this.check()}transformAsVector(e){return i2(this,this,e),this.check()}transformByMatrix3(e){return r2(this,this,e),this.check()}transformByMatrix2(e){return NE(this,this,e),this.check()}transformByQuaternion(e){return _E(this,this,e),this.check()}}class a2 extends Oh{get ELEMENTS(){return Lt(!1),0}get RANK(){return Lt(!1),0}toString(){let e="[";if(ct.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=Zt(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[i+s];return n}setColumn(e,n){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=n[s];return this}}function JE(){var t=new Dn(9);return Dn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function DE(t,e){if(t===e){var n=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function zE(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=e[4],r=e[5],a=e[6],I=e[7],l=e[8],C=l*o-r*I,c=-l*g+r*a,A=I*g-o*a,d=n*C+i*c+s*A;return d?(d=1/d,t[0]=C*d,t[1]=(-l*i+s*I)*d,t[2]=(r*i-s*o)*d,t[3]=c*d,t[4]=(l*n-s*a)*d,t[5]=(-r*n+s*g)*d,t[6]=A*d,t[7]=(-I*n+i*a)*d,t[8]=(o*n-i*g)*d,t):null}function OE(t){var e=t[0],n=t[1],i=t[2],s=t[3],g=t[4],o=t[5],r=t[6],a=t[7],I=t[8];return e*(I*g-o*a)+n*(-I*s+o*r)+i*(a*s-g*r)}function tb(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3],r=e[4],a=e[5],I=e[6],l=e[7],C=e[8],c=n[0],A=n[1],d=n[2],h=n[3],u=n[4],m=n[5],f=n[6],p=n[7],B=n[8];return t[0]=c*i+A*o+d*I,t[1]=c*s+A*r+d*l,t[2]=c*g+A*a+d*C,t[3]=h*i+u*o+m*I,t[4]=h*s+u*r+m*l,t[5]=h*g+u*a+m*C,t[6]=f*i+p*o+B*I,t[7]=f*s+p*r+B*l,t[8]=f*g+p*a+B*C,t}function jE(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3],r=e[4],a=e[5],I=e[6],l=e[7],C=e[8],c=n[0],A=n[1];return t[0]=i,t[1]=s,t[2]=g,t[3]=o,t[4]=r,t[5]=a,t[6]=c*i+A*o+I,t[7]=c*s+A*r+l,t[8]=c*g+A*a+C,t}function qE(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3],r=e[4],a=e[5],I=e[6],l=e[7],C=e[8],c=Math.sin(n),A=Math.cos(n);return t[0]=A*i+c*o,t[1]=A*s+c*r,t[2]=A*g+c*a,t[3]=A*o-c*i,t[4]=A*r-c*s,t[5]=A*a-c*g,t[6]=I,t[7]=l,t[8]=C,t}function nb(t,e,n){var i=n[0],s=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function $E(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=n+n,r=i+i,a=s+s,I=n*o,l=i*o,C=i*r,c=s*o,A=s*r,d=s*a,h=g*o,u=g*r,m=g*a;return t[0]=1-C-d,t[3]=l-m,t[6]=c+u,t[1]=l+m,t[4]=1-I-d,t[7]=A-h,t[2]=c-u,t[5]=A+h,t[8]=1-I-C,t}const ib=Object.freeze([1,0,0,0,1,0,0,0,1]),eQ=Object.freeze([0,0,0,0,0,0,0,0,0]),tQ=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Hg={};class mt extends a2{static get IDENTITY(){return Hg.IDENTITY=Hg.IDENTITY||Object.freeze(new mt(ib)),Hg.IDENTITY}static get ZERO(){return Hg.ZERO=Hg.ZERO||Object.freeze(new mt(eQ)),Hg.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return tQ}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}set(e,n,i,s,g,o,r,a,I){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this[4]=g,this[5]=o,this[6]=r,this[7]=a,this[8]=I,this.check()}setRowMajor(e,n,i,s,g,o,r,a,I){return this[0]=e,this[1]=s,this[2]=r,this[3]=n,this[4]=g,this[5]=a,this[6]=i,this[7]=o,this[8]=I,this.check()}determinant(){return OE(this)}identity(){return this.copy(ib)}fromQuaternion(e){return $E(this,e),this.check()}transpose(){return DE(this,this),this.check()}invert(){return zE(this,this),this.check()}multiplyLeft(e){return tb(this,e,this),this.check()}multiplyRight(e){return tb(this,this,e),this.check()}rotate(e){return qE(this,this,e),this.check()}scale(e){return Array.isArray(e)?nb(this,this,e):nb(this,this,[e,e,e]),this.check()}translate(e){return jE(this,this,e),this.check()}transform(e,n){switch(e.length){case 2:n=xE(n||[-0,-0],e,this);break;case 3:n=r2(n||[-0,-0,-0],e,this);break;case 4:n=TE(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ia(n,e.length),n}transformVector(e,n){return vo("Matrix3.transformVector"),this.transform(e,n)}transformVector2(e,n){return vo("Matrix3.transformVector"),this.transform(e,n)}transformVector3(e,n){return vo("Matrix3.transformVector"),this.transform(e,n)}}function nQ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function iQ(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],g=e[6],o=e[7],r=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=g,t[11]=e[14],t[12]=s,t[13]=o,t[14]=r}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Lu(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=e[4],r=e[5],a=e[6],I=e[7],l=e[8],C=e[9],c=e[10],A=e[11],d=e[12],h=e[13],u=e[14],m=e[15],f=n*r-i*o,p=n*a-s*o,B=n*I-g*o,G=i*a-s*r,y=i*I-g*r,U=s*I-g*a,V=l*h-C*d,F=l*u-c*d,W=l*m-A*d,M=C*u-c*h,E=C*m-A*h,H=c*m-A*u,P=f*H-p*E+B*M+G*W-y*F+U*V;return P?(P=1/P,t[0]=(r*H-a*E+I*M)*P,t[1]=(s*E-i*H-g*M)*P,t[2]=(h*U-u*y+m*G)*P,t[3]=(c*y-C*U-A*G)*P,t[4]=(a*W-o*H-I*F)*P,t[5]=(n*H-s*W+g*F)*P,t[6]=(u*B-d*U-m*p)*P,t[7]=(l*U-c*B+A*p)*P,t[8]=(o*E-r*W+I*V)*P,t[9]=(i*W-n*E-g*V)*P,t[10]=(d*y-h*B+m*f)*P,t[11]=(C*B-l*y-A*f)*P,t[12]=(r*F-o*M-a*V)*P,t[13]=(n*M-i*F+s*V)*P,t[14]=(h*p-d*G-u*f)*P,t[15]=(l*G-C*p+c*f)*P,t):null}function sQ(t){var e=t[0],n=t[1],i=t[2],s=t[3],g=t[4],o=t[5],r=t[6],a=t[7],I=t[8],l=t[9],C=t[10],c=t[11],A=t[12],d=t[13],h=t[14],u=t[15],m=e*o-n*g,f=e*r-i*g,p=e*a-s*g,B=n*r-i*o,G=n*a-s*o,y=i*a-s*r,U=I*d-l*A,V=I*h-C*A,F=I*u-c*A,W=l*h-C*d,M=l*u-c*d,E=C*u-c*h;return m*E-f*M+p*W+B*F-G*V+y*U}function ug(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3],r=e[4],a=e[5],I=e[6],l=e[7],C=e[8],c=e[9],A=e[10],d=e[11],h=e[12],u=e[13],m=e[14],f=e[15],p=n[0],B=n[1],G=n[2],y=n[3];return t[0]=p*i+B*r+G*C+y*h,t[1]=p*s+B*a+G*c+y*u,t[2]=p*g+B*I+G*A+y*m,t[3]=p*o+B*l+G*d+y*f,p=n[4],B=n[5],G=n[6],y=n[7],t[4]=p*i+B*r+G*C+y*h,t[5]=p*s+B*a+G*c+y*u,t[6]=p*g+B*I+G*A+y*m,t[7]=p*o+B*l+G*d+y*f,p=n[8],B=n[9],G=n[10],y=n[11],t[8]=p*i+B*r+G*C+y*h,t[9]=p*s+B*a+G*c+y*u,t[10]=p*g+B*I+G*A+y*m,t[11]=p*o+B*l+G*d+y*f,p=n[12],B=n[13],G=n[14],y=n[15],t[12]=p*i+B*r+G*C+y*h,t[13]=p*s+B*a+G*c+y*u,t[14]=p*g+B*I+G*A+y*m,t[15]=p*o+B*l+G*d+y*f,t}function FC(t,e,n){var i=n[0],s=n[1],g=n[2],o,r,a,I,l,C,c,A,d,h,u,m;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*g+e[12],t[13]=e[1]*i+e[5]*s+e[9]*g+e[13],t[14]=e[2]*i+e[6]*s+e[10]*g+e[14],t[15]=e[3]*i+e[7]*s+e[11]*g+e[15]):(o=e[0],r=e[1],a=e[2],I=e[3],l=e[4],C=e[5],c=e[6],A=e[7],d=e[8],h=e[9],u=e[10],m=e[11],t[0]=o,t[1]=r,t[2]=a,t[3]=I,t[4]=l,t[5]=C,t[6]=c,t[7]=A,t[8]=d,t[9]=h,t[10]=u,t[11]=m,t[12]=o*i+l*s+d*g+e[12],t[13]=r*i+C*s+h*g+e[13],t[14]=a*i+c*s+u*g+e[14],t[15]=I*i+A*s+m*g+e[15]),t}function SC(t,e,n){var i=n[0],s=n[1],g=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*g,t[9]=e[9]*g,t[10]=e[10]*g,t[11]=e[11]*g,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gQ(t,e,n,i){var s=i[0],g=i[1],o=i[2],r=Math.hypot(s,g,o),a,I,l,C,c,A,d,h,u,m,f,p,B,G,y,U,V,F,W,M,E,H,P,z;return r<la?null:(r=1/r,s*=r,g*=r,o*=r,a=Math.sin(n),I=Math.cos(n),l=1-I,C=e[0],c=e[1],A=e[2],d=e[3],h=e[4],u=e[5],m=e[6],f=e[7],p=e[8],B=e[9],G=e[10],y=e[11],U=s*s*l+I,V=g*s*l+o*a,F=o*s*l-g*a,W=s*g*l-o*a,M=g*g*l+I,E=o*g*l+s*a,H=s*o*l+g*a,P=g*o*l-s*a,z=o*o*l+I,t[0]=C*U+h*V+p*F,t[1]=c*U+u*V+B*F,t[2]=A*U+m*V+G*F,t[3]=d*U+f*V+y*F,t[4]=C*W+h*M+p*E,t[5]=c*W+u*M+B*E,t[6]=A*W+m*M+G*E,t[7]=d*W+f*M+y*E,t[8]=C*H+h*P+p*z,t[9]=c*H+u*P+B*z,t[10]=A*H+m*P+G*z,t[11]=d*H+f*P+y*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function I2(t,e,n){var i=Math.sin(n),s=Math.cos(n),g=e[4],o=e[5],r=e[6],a=e[7],I=e[8],l=e[9],C=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=g*s+I*i,t[5]=o*s+l*i,t[6]=r*s+C*i,t[7]=a*s+c*i,t[8]=I*s-g*i,t[9]=l*s-o*i,t[10]=C*s-r*i,t[11]=c*s-a*i,t}function oQ(t,e,n){var i=Math.sin(n),s=Math.cos(n),g=e[0],o=e[1],r=e[2],a=e[3],I=e[8],l=e[9],C=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*s-I*i,t[1]=o*s-l*i,t[2]=r*s-C*i,t[3]=a*s-c*i,t[8]=g*i+I*s,t[9]=o*i+l*s,t[10]=r*i+C*s,t[11]=a*i+c*s,t}function l2(t,e,n){var i=Math.sin(n),s=Math.cos(n),g=e[0],o=e[1],r=e[2],a=e[3],I=e[4],l=e[5],C=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*s+I*i,t[1]=o*s+l*i,t[2]=r*s+C*i,t[3]=a*s+c*i,t[4]=I*s-g*i,t[5]=l*s-o*i,t[6]=C*s-r*i,t[7]=c*s-a*i,t}function rQ(t,e){var n=e[0],i=e[1],s=e[2],g=e[4],o=e[5],r=e[6],a=e[8],I=e[9],l=e[10];return t[0]=Math.hypot(n,i,s),t[1]=Math.hypot(g,o,r),t[2]=Math.hypot(a,I,l),t}function aQ(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=n+n,r=i+i,a=s+s,I=n*o,l=i*o,C=i*r,c=s*o,A=s*r,d=s*a,h=g*o,u=g*r,m=g*a;return t[0]=1-C-d,t[1]=l+m,t[2]=c-u,t[3]=0,t[4]=l-m,t[5]=1-I-d,t[6]=A+h,t[7]=0,t[8]=c+u,t[9]=A-h,t[10]=1-I-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function IQ(t,e,n,i,s,g,o){var r=1/(n-e),a=1/(s-i),I=1/(g-o);return t[0]=g*2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g*2*a,t[6]=0,t[7]=0,t[8]=(n+e)*r,t[9]=(s+i)*a,t[10]=(o+g)*I,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*g*2*I,t[15]=0,t}function lQ(t,e,n,i,s){var g=1/Math.tan(e/2),o;return t[0]=g/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function CQ(t,e,n,i,s,g,o){var r=1/(e-n),a=1/(i-s),I=1/(g-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*I,t[11]=0,t[12]=(e+n)*r,t[13]=(s+i)*a,t[14]=(o+g)*I,t[15]=1,t}function cQ(t,e,n,i){var s,g,o,r,a,I,l,C,c,A,d=e[0],h=e[1],u=e[2],m=i[0],f=i[1],p=i[2],B=n[0],G=n[1],y=n[2];return Math.abs(d-B)<la&&Math.abs(h-G)<la&&Math.abs(u-y)<la?nQ(t):(l=d-B,C=h-G,c=u-y,A=1/Math.hypot(l,C,c),l*=A,C*=A,c*=A,s=f*c-p*C,g=p*l-m*c,o=m*C-f*l,A=Math.hypot(s,g,o),A?(A=1/A,s*=A,g*=A,o*=A):(s=0,g=0,o=0),r=C*o-c*g,a=c*s-l*o,I=l*g-C*s,A=Math.hypot(r,a,I),A?(A=1/A,r*=A,a*=A,I*=A):(r=0,a=0,I=0),t[0]=s,t[1]=r,t[2]=l,t[3]=0,t[4]=g,t[5]=a,t[6]=C,t[7]=0,t[8]=o,t[9]=I,t[10]=c,t[11]=0,t[12]=-(s*d+g*h+o*u),t[13]=-(r*d+a*h+I*u),t[14]=-(l*d+C*h+c*u),t[15]=1,t)}function AQ(){var t=new Dn(4);return Dn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function dQ(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function C2(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function uQ(t){var e=t[0],n=t[1],i=t[2],s=t[3];return Math.hypot(e,n,i,s)}function hQ(t){var e=t[0],n=t[1],i=t[2],s=t[3];return e*e+n*n+i*i+s*s}function mQ(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=n*n+i*i+s*s+g*g;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=s*o,t[3]=g*o,t}function fQ(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function pQ(t,e,n,i){var s=e[0],g=e[1],o=e[2],r=e[3];return t[0]=s+i*(n[0]-s),t[1]=g+i*(n[1]-g),t[2]=o+i*(n[2]-o),t[3]=r+i*(n[3]-r),t}function cI(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*g+n[12]*o,t[1]=n[1]*i+n[5]*s+n[9]*g+n[13]*o,t[2]=n[2]*i+n[6]*s+n[10]*g+n[14]*o,t[3]=n[3]*i+n[7]*s+n[11]*g+n[15]*o,t}function BQ(t,e,n){var i=e[0],s=e[1],g=e[2],o=n[0],r=n[1],a=n[2],I=n[3],l=I*i+r*g-a*s,C=I*s+a*i-o*g,c=I*g+o*s-r*i,A=-o*i-r*s-a*g;return t[0]=l*I+A*-o+C*-a-c*-r,t[1]=C*I+A*-r+c*-o-l*-a,t[2]=c*I+A*-a+l*-r-C*-o,t[3]=e[3],t}(function(){var t=AQ();return function(e,n,i,s,g,o){var r,a;for(n||(n=4),i||(i=0),s?a=Math.min(s*n+i,e.length):a=e.length,r=i;r<a;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],t[3]=e[r+3],g(t,t,o),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3];return e}})();const sb=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),bQ=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),yQ=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),kg={};class Ee extends a2{static get IDENTITY(){return kg.IDENTITY=kg.IDENTITY||Object.freeze(new Ee(sb)),kg.IDENTITY}static get ZERO(){return kg.ZERO=kg.ZERO||Object.freeze(new Ee(bQ)),kg.ZERO}get INDICES(){return yQ}get ELEMENTS(){return 16}get RANK(){return 4}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,s,g,o,r,a,I,l,C,c,A,d,h,u){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this[4]=g,this[5]=o,this[6]=r,this[7]=a,this[8]=I,this[9]=l,this[10]=C,this[11]=c,this[12]=A,this[13]=d,this[14]=h,this[15]=u,this.check()}setRowMajor(e,n,i,s,g,o,r,a,I,l,C,c,A,d,h,u){return this[0]=e,this[1]=g,this[2]=I,this[3]=A,this[4]=n,this[5]=o,this[6]=l,this[7]=d,this[8]=i,this[9]=r,this[10]=C,this[11]=h,this[12]=s,this[13]=a,this[14]=c,this[15]=u,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sb)}fromQuaternion(e){return aQ(this,e),this.check()}frustum({left:e,right:n,bottom:i,top:s,near:g,far:o}){return o===1/0?Ee._computeInfinitePerspectiveOffCenter(this,e,n,i,s,g):IQ(this,e,n,i,s,g,o),this.check()}static _computeInfinitePerspectiveOffCenter(e,n,i,s,g,o){const r=2*o/(i-n),a=2*o/(g-s),I=(i+n)/(i-n),l=(g+s)/(g-s),C=-1,c=-1,A=-2*o;return e[0]=r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=I,e[9]=l,e[10]=C,e[11]=c,e[12]=0,e[13]=0,e[14]=A,e[15]=0,e}lookAt(e,n,i){return arguments.length===1&&({eye:e,center:n,up:i}=e),n=n||[0,0,0],i=i||[0,1,0],cQ(this,e,n,i),this.check()}ortho({left:e,right:n,bottom:i,top:s,near:g=.1,far:o=500}){return CQ(this,e,n,i,s,g,o),this.check()}orthographic({fovy:e=45*Math.PI/180,aspect:n=1,focalDistance:i=1,near:s=.1,far:g=500}){if(e>Math.PI*2)throw Error("radians");const o=e/2,r=i*Math.tan(o),a=r*n;return new Ee().ortho({left:-a,right:a,bottom:-r,top:r,near:s,far:g})}perspective({fovy:e=void 0,fov:n=45*Math.PI/180,aspect:i=1,near:s=.1,far:g=500}={}){if(e=e||n,e>Math.PI*2)throw Error("radians");return lQ(this,e,i,s,g),this.check()}determinant(){return sQ(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=null){const i=this.getScale(n||[-0,-0,-0]),s=1/i[0],g=1/i[1],o=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*g,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*g,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*g,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=null){const i=this.getScale(n||[-0,-0,-0]),s=1/i[0],g=1/i[1],o=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*g,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*g,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*g,e[8]=this[10]*o,e}transpose(){return iQ(this,this),this.check()}invert(){return Lu(this,this),this.check()}multiplyLeft(e){return ug(this,e,this),this.check()}multiplyRight(e){return ug(this,this,e),this.check()}rotateX(e){return I2(this,this,e),this.check()}rotateY(e){return oQ(this,this,e),this.check()}rotateZ(e){return l2(this,this,e),this.check()}rotateXYZ([e,n,i]){return this.rotateX(e).rotateY(n).rotateZ(i)}rotateAxis(e,n){return gQ(this,this,e,n),this.check()}scale(e){return Array.isArray(e)?SC(this,this,e):SC(this,this,[e,e,e]),this.check()}translate(e){return FC(this,this,e),this.check()}transform(e,n){return e.length===4?(n=cI(n||[-0,-0,-0,-0],e,this),Ia(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;switch(i){case 2:n=WE(n||[-0,-0],e,this);break;case 3:n=o2(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ia(n,e.length),n}transformAsVector(e,n){switch(e.length){case 2:n=wE(n||[-0,-0],e,this);break;case 3:n=i2(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ia(n,e.length),n}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}transformPoint(e,n){return vo("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,n)}transformVector(e,n){return vo("Matrix4.transformVector","3.0"),this.transformAsPoint(e,n)}transformDirection(e,n){return vo("Matrix4.transformDirection","3.0"),this.transformAsVector(e,n)}}function gb(){var t=new Dn(4);return Dn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vQ(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function c2(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function ob(t,e,n){var i=e[0],s=e[1],g=e[2],o=e[3],r=n[0],a=n[1],I=n[2],l=n[3];return t[0]=i*l+o*r+s*I-g*a,t[1]=s*l+o*a+g*r-i*I,t[2]=g*l+o*I+i*a-s*r,t[3]=o*l-i*r-s*a-g*I,t}function GQ(t,e,n){n*=.5;var i=e[0],s=e[1],g=e[2],o=e[3],r=Math.sin(n),a=Math.cos(n);return t[0]=i*a+o*r,t[1]=s*a+g*r,t[2]=g*a-s*r,t[3]=o*a-i*r,t}function ZQ(t,e,n){n*=.5;var i=e[0],s=e[1],g=e[2],o=e[3],r=Math.sin(n),a=Math.cos(n);return t[0]=i*a-g*r,t[1]=s*a+o*r,t[2]=g*a+i*r,t[3]=o*a-s*r,t}function RQ(t,e,n){n*=.5;var i=e[0],s=e[1],g=e[2],o=e[3],r=Math.sin(n),a=Math.cos(n);return t[0]=i*a+s*r,t[1]=s*a-i*r,t[2]=g*a+o*r,t[3]=o*a-g*r,t}function FQ(t,e){var n=e[0],i=e[1],s=e[2];return t[0]=n,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-s*s)),t}function _l(t,e,n,i){var s=e[0],g=e[1],o=e[2],r=e[3],a=n[0],I=n[1],l=n[2],C=n[3],c,A,d,h,u;return A=s*a+g*I+o*l+r*C,A<0&&(A=-A,a=-a,I=-I,l=-l,C=-C),1-A>la?(c=Math.acos(A),d=Math.sin(c),h=Math.sin((1-i)*c)/d,u=Math.sin(i*c)/d):(h=1-i,u=i),t[0]=h*s+u*a,t[1]=h*g+u*I,t[2]=h*o+u*l,t[3]=h*r+u*C,t}function SQ(t,e){var n=e[0],i=e[1],s=e[2],g=e[3],o=n*n+i*i+s*s+g*g,r=o?1/o:0;return t[0]=-n*r,t[1]=-i*r,t[2]=-s*r,t[3]=g*r,t}function VQ(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function A2(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var g=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[g*3+g]-e[o*3+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[g*3+o]-e[o*3+g])*i,t[g]=(e[g*3+s]+e[s*3+g])*i,t[o]=(e[o*3+s]+e[s*3+o])*i}return t}var UQ=dQ,xQ=C2,WQ=fQ,wQ=pQ,NQ=uQ,TQ=hQ,d2=mQ,EQ=function(){var t=s2(),e=$B(1,0,0),n=$B(0,1,0);return function(i,s,g){var o=g2(s,g);return o<-.999999?(Yl(t,e,s),PE(t)<1e-6&&Yl(t,n,s),YE(t,t),c2(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Yl(t,s,g),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,d2(i,i))}}();(function(){var t=gb(),e=gb();return function(n,i,s,g,o,r){return _l(t,i,o,r),_l(e,s,g,r),_l(n,t,e,2*r*(1-r)),n}})();(function(){var t=JE();return function(e,n,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],d2(e,A2(e,t))}})();const QQ=[0,0,0,1];class rb extends Oh{constructor(e=0,n=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,s){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this.check()}fromMatrix3(e){return A2(this,e),this.check()}identity(){return vQ(this),this.check()}fromAxisRotation(e,n){return c2(this,e,n),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Zt(e)}get y(){return this[1]}set y(e){this[1]=Zt(e)}get z(){return this[2]}set z(e){this[2]=Zt(e)}get w(){return this[3]}set w(e){this[3]=Zt(e)}len(){return NQ(this)}lengthSquared(){return TQ(this)}dot(e,n){if(n!==void 0)throw new Error("Quaternion.dot only takes one argument");return WQ(this,e)}rotationTo(e,n){return EQ(this,e,n),this.check()}add(e,n){if(n!==void 0)throw new Error("Quaternion.add only takes one argument");return UQ(this,this,e),this.check()}calculateW(){return FQ(this,this),this.check()}conjugate(){return VQ(this,this),this.check()}invert(){return SQ(this,this),this.check()}lerp(e,n,i){return wQ(this,e,n,i),this.check()}multiplyRight(e,n){return Lt(!n),ob(this,this,e),this.check()}multiplyLeft(e,n){return Lt(!n),ob(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return GQ(this,this,e),this.check()}rotateY(e){return ZQ(this,this,e),this.check()}rotateZ(e){return RQ(this,this,e),this.check()}scale(e){return xQ(this,this,e),this.check()}slerp(e,n,i){switch(arguments.length){case 1:({start:e=QQ,target:n,ratio:i}=arguments[0]);break;case 2:[n,i]=arguments,e=this;break}return _l(this,e,n,i),this.check()}transformVector4(e,n=e){return BQ(n,e,this),Ia(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e,n){return this.multiplyLeft(e,n)}multiply(e,n){return this.multiplyRight(e,n)}}const u2={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},ab=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,XQ={lightSources:{}};function td({color:t=[0,0,0],intensity:e=1}={}){return t.map(n=>n*e/255)}function YQ({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=td(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,g)=>{i[`lighting_uPointLight[${g}].color`]=td(s),i[`lighting_uPointLight[${g}].position`]=s.position,i[`lighting_uPointLight[${g}].attenuation`]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((s,g)=>{i[`lighting_uDirectionalLight[${g}].color`]=td(s),i[`lighting_uDirectionalLight[${g}].direction`]=s.direction}),i.lighting_uDirectionalLightCount=n.length,i}function h2(t=XQ){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},YQ({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return h2({lightSources:e})}return{}}const _Q={name:"lights",vs:ab,fs:ab,getUniforms:h2,defines:{MAX_LIGHTS:3}},HQ=new Uint8Array([0,255,255,255]),kQ={pickingSelectedColor:null,pickingHighlightColor:HQ,pickingActive:!1,pickingAttribute:!1};function KQ(t=kQ){const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const LQ=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,MQ=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,PQ={name:"picking",vs:LQ,fs:MQ,getUniforms:KQ},JQ=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,DQ={};function zQ(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:s.map(g=>g/255)}}function OQ(t=DQ){if(!("material"in t))return{};const{material:e}=t;return e?zQ(e):{lighting_uEnabled:!1}}const jQ={name:"gouraud-lighting",dependencies:[_Q],vs:JQ,defines:{LIGHTING_VERTEX:1},getUniforms:OQ},qQ=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,$Q={name:"transform",vs:qQ,fs:null};class Ug{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Ug(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:n="",fs:i="",defines:s={},inject:g={},varyings:o=[],bufferMode:r=35981,transpileToGLSL100:a=!1}=e,I=this._getModuleList(e.modules),l=this._getHash(n),C=this._getHash(i),c=I.map(p=>this._getHash(p.name)).sort(),A=o.map(p=>this._getHash(p)),d=Object.keys(s).sort(),h=Object.keys(g).sort(),u=[],m=[];for(const p of d)u.push(this._getHash(p)),u.push(this._getHash(s[p]));for(const p of h)m.push(this._getHash(p)),m.push(this._getHash(g[p]));const f=`${l}/${C}D${u.join("/")}M${c.join("/")}I${m.join("/")}V${A.join("/")}H${this.stateHash}B${r}${a?"T":""}`;if(!this._programCache[f]){const p=IE(this.gl,{vs:n,fs:i,modules:I,inject:g,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[f]=new M1(this.gl,{hash:f,vs:p.vs,fs:p.fs,varyings:o,bufferMode:r}),this._getUniforms[f]=p.getUniforms||(B=>{}),this._useCounts[f]=0}return this._useCounts[f]++,this._programCache[f]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let g=0,o=this._defaultModules.length;g<o;++g){const r=this._defaultModules[g],a=r.name;n[s++]=r,i[a]=!0}for(let g=0,o=e.length;g<o;++g){const r=e[g],a=r.name;i[a]||(n[s++]=r,i[a]=!0)}return n.length=s,n}}const eX={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function tX(t,e,n){const i={};let s=e.indices;for(const g in e.attributes){const o=e.attributes[g],r=nX(g,n);if(g==="indices")s=o;else if(o.constant)i[r]=o.value;else{const a=o.value,I={...o};delete I.value,i[r]=[new we(t,a),I],iX(g,I)}}if(s){const g=s.value||s;O(g instanceof Uint16Array||g instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};i.indices=[new we(t,{data:g,target:34963}),o]}return i}function nX(t,e){const{attributeMap:n=eX}=e||{};return n&&n[t]||t}function iX(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}O(Number.isFinite(e.size),`attribute ${t} needs size`)}const Kg=2,sX=1e4,gX="Model needs drawMode and vertexCount",Ib=()=>{},oX={};class Fn{constructor(e,n={}){const{id:i=Vs("model")}=n;O(Zc(e)),this.id=i,this.gl=e,this.id=n.id||Vs("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Ug.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:s,modules:g,defines:o,inject:r,varyings:a,bufferMode:I,transpileToGLSL100:l}=e;this.programProps={program:n,vs:i,fs:s,modules:g,defines:o,inject:r,varyings:a,bufferMode:I,transpileToGLSL100:l},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},O(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),gX)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:s,modules:g,defines:o,inject:r,varyings:a,bufferMode:I,transpileToGLSL100:l}=e;this.programProps={program:n,vs:i,fs:s,modules:g,defines:o,inject:r,varyings:a,bufferMode:I,transpileToGLSL100:l},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return O(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return O(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=tX(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(No(e))return this;const n={};for(const i in e){const s=e[i];n[i]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(n),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Mh(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:s={},attributes:g={},transformFeedback:o=this.transformFeedback,parameters:r={},vertexArray:a=this.vertexArray}=e;this.setAttributes(g),this.updateModuleSettings(n),this.setUniforms(s);let I;se.priority>=Kg&&(I=this._logDrawCallStart(Kg));const l=this.vertexArray.getDrawParams(),{isIndexed:C=l.isIndexed,indexType:c=l.indexType,indexOffset:A=l.indexOffset,vertexArrayInstanced:d=l.isInstanced}=this.props;d&&!this.isInstanced&&se.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:h,instanceCount:u}=this,{onBeforeRender:m=Ib,onAfterRender:f=Ib}=this.props;m(),this.program.setUniforms(this.uniforms);const p=this.program.draw(Object.assign(oX,e,{logPriority:I,uniforms:null,framebuffer:i,parameters:r,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:o,isIndexed:C,indexType:c,isInstanced:h,instanceCount:u,offset:C?A:0}));return f(),se.priority>=Kg&&this._logDrawCallEnd(I,a,i),p}transform(e={}){const{discard:n=!0,feedbackBuffers:i,unbindModels:s=[]}=e;let{parameters:g}=e;i&&this._setFeedbackBuffers(i),n&&(g=Object.assign({},g,{[35977]:n})),s.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:g}))}finally{s.forEach(o=>o.vertexArray.bindBuffers())}return this}render(e={}){return se.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:s,modules:g,inject:o,defines:r,varyings:a,bufferMode:I,transpileToGLSL100:l}=this.programProps;n=this.programManager.get({vs:i,fs:s,modules:g,inject:o,defines:r,varyings:a,bufferMode:I,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}O(n instanceof M1,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new G5(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof we&&n.delete()}}_setAnimationProps(e){this.animated&&O(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(No(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new P1(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:sX;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),se.group(Kg,`>>> DRAWING MODEL ${this.id}`,{collapsed:se.level<=2})(),e}_logDrawCallEnd(e,n,i,s){if(e===void 0)return;const g=F5({vertexArray:n,header:`${this.id} attributes`,attributes:this._attributes}),{table:o,unusedTable:r,unusedCount:a}=HB({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:I,count:l}=HB({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});l>0&&se.log("MISSING UNIFORMS",Object.keys(I))(),a>0&&se.log("UNUSED UNIFORMS",Object.keys(r))();const C=V5(this.vertexArray.configuration);se.table(e,g)(),se.table(e,o)(),se.table(e+1,C)(),s&&s.log({logLevel:Kg,message:`Rendered to ${s.id}`}),se.groupEnd(Kg,`>>> DRAWING MODEL ${this.id}`)()}}class rX{constructor(e,n={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(e={}){const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(e={}){const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:s}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof we?i:i.buffer:null}getData(e={}){const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&O(be(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const g=this.feedbackMap[s];s in n&&(i[g]=s)}Object.assign(i,e.feedbackBuffers);for(const s in i){const g=i[s];if(typeof g=="string"){const o=n[g],{byteLength:r,usage:a,accessor:I}=o;i[s]=this._createNewBuffer(s,{byteLength:r,usage:a,accessor:I})}}return i}_setupBuffers(e={}){const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,{model:n}){const{program:i}=n;e.transformFeedback=new P1(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const s in this.feedbackMap){const g=this.feedbackMap[s];n[s]=e.feedbackBuffers[g],i[g]=e.sourceBuffers[s],O(i[g]instanceof we)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new we(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const aX="transform_uSampler_",VC="transform_uSize_",lb="transform_position";function IX({vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}){let g=Object.keys(e).length,o=null;const r={};let a=t,I={};if(g>0||n){const l=a.split(`
`),C=l.slice();if(l.forEach((c,A,d)=>{if(g>0){const h=dX(c,e);if(h){const{updatedLine:u,inject:m}=h;C[A]=u,I=Hu([I,m]),Object.assign(r,h.samplerTextureMap),g--}}n&&!o&&(o=AX(c,n))}),n){O(i);const c=`${VC}${n}`,A=`uniform vec2 ${c};
`,d=`     vec2 ${lb} = transform_getPos(${c});
     gl_Position = vec4(${lb}, 0, 1.);
`;I=Hu([I,{"vs:#decl":A,"vs:#main-start":d}])}a=C.join(`
`)}return{vs:a,targetTextureType:o,inject:I,samplerTextureMap:r}}function lX({sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}){const i={};let s,g;e&&({width:s,height:g}=n,i[`${VC}${e}`]=[s,g]);for(const o in t)({width:s,height:g}=t[o]),i[`${VC}${o}`]=[s,g];return i}function CX(t){return $1(t,["attribute","in"])}function cX(t){const e=`${aX}${t}`,n=`${VC}${t}`,i=`  uniform sampler2D ${e};
  uniform vec2 ${n};`;return{samplerName:e,sizeName:n,uniformDeclerations:i}}function AX(t,e){const n=$1(t,["varying","out"]);return n&&n.name===e?n.type:null}function dX(t,e){const n={},i=CX(t);if(!i)return null;const{type:s,name:g}=i;if(g&&e[g]){const o=`// ${t} => Replaced by Transform with a sampler`,{samplerName:r,sizeName:a,uniformDeclerations:I}=cX(g),l=fE(s),C=`  ${s} ${g} = transform_getInput(${r}, ${a}).${l};
`;return n[r]=g,{updatedLine:o,inject:{"vs:#decl":I,"vs:#main-start":C},samplerTextureMap:n}}return null}const uX={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},hX="transform_output";class mX{constructor(e,n={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(e={}){const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(e={}){const{sourceBuffers:n,sourceTextures:i,framebuffer:s,targetTexture:g}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),r=Object.assign({},e.uniforms),a=Object.assign({},e.parameters);let I=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const C in this.samplerTextureMap){const c=this.samplerTextureMap[C];r[C]=i[c]}this._setSourceTextureParameters();const l=lX({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:g});Object.assign(r,l)}return this.hasTargetTexture&&(I=!1,a.viewport=[0,0,s.width,s.height]),{attributes:o,framebuffer:s,uniforms:r,discard:I,parameters:a}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:n}=this.bindings[this.currentIndex],i=Fc(n);if(!e)return i;const s=i.constructor,g=pE(this.targetTextureType),o=new s(i.length*g/4);let r=0;for(let a=0;a<i.length;a+=4)for(let I=0;I<g;I++)o[r++]=i[a+I];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof An)return i;const s=n[i];return s?(this._targetRefTexName=i,this._createNewTexture(s)):null}_setupTextures(e={}){const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:s}=e,g=this._createTargetTexture({sourceTextures:i,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:g}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,s,g)=>{g[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new we(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:s,targetTexture:g}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,i),g){e.targetTexture=g;const{width:o,height:r}=g,{framebuffer:a}=e;a?(a.update({attachments:{[36064]:g},resizeAttachments:!1}),a.resize({width:o,height:r})):e.framebuffer=new At(this.gl,{id:"transform-framebuffer",width:o,height:r,attachments:{[36064]:g}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(uX)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=H1(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:s,uniforms:g,targetTextureType:o,inject:r,samplerTextureMap:a}=IX({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),I=Hu([e.inject||{},r]);this.targetTextureType=o,this.samplerTextureMap=a;const l=e._fs||e2({version:K1(s),input:this.targetTextureVarying,inputType:o,output:hX}),C=this.hasSourceTextures||this.targetTextureVarying?[$Q].concat(e.modules||[]):e.modules;return{vs:s,fs:l,modules:C,uniforms:g,inject:I}}}class jh{static isSupported(e){return be(e)}constructor(e,n={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(e={}){const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();O(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const s=i.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(e={}){const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Fn(n,Object.assign({},e,{fs:e.fs||e2({version:K1(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=s.updateModelProps(n);return n}_buildResourceTransforms(e,n){fX(n)&&(this.bufferTransform=new rX(e,n)),pX(n)&&(this.textureTransform=new mX(e,n)),O(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=Object.assign(n,s.getDrawOptions(n));return n}}function fX(t){return!!(!No(t.feedbackBuffers)||!No(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function pX(t){return!!(!No(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const Cb={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class hi{static get DRAW_MODE(){return Cb}constructor(e={}){const{id:n=Vs("geometry"),drawMode:i=Cb.TRIANGLES,attributes:s={},indices:g=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(s,g),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let s=e[i];s=ArrayBuffer.isView(s)?{value:s}:s,O(ArrayBuffer.isView(s.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!s.size&&(s.size=3),i==="indices"?(O(!this.indices),this.indices=s):this.attributes[i]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const s in e){const g=e[s],{value:o,size:r,constant:a}=g;!a&&o&&r>=1&&(i=Math.min(i,o.length/r))}return O(Number.isFinite(i)),i}}let BX=1,bX=1;class m2{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:g=1}=e,o=BX++,r={time:0,delay:n,duration:i,rate:s,repeat:g};return this._setChannelTime(r,this.time),this.channels.set(o,r),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:g,channel:o}=s;g.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=bX++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const yX=`
struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,vX=`
#define SMOOTH_EDGE_RADIUS 0.5

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,GX={name:"geometry",vs:yX,fs:vX},Ce={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ce,"IDENTITY",{get:()=>me.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const oi={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Us={common:0,meters:1,pixels:2},cb={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ZX=Object.keys(Ce).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Ce[t],";")).join(""),RX=Object.keys(oi).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(oi[t],";")).join(""),FX=Object.keys(Us).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Us[t],";")).join(""),SX="".concat(ZX,`
`).concat(RX,`
`).concat(FX,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);
      return 1.0 / cos(radians(y));
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size(position_world.z),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
`);function VX(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Sc(t){let e={},n;return i=>{for(const s in i)if(!VX(i[s],e[s])){n=t(i),e=i;break}return n}}const Ab=[0,0,0,0],UX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],WX=[0,0,0],wX=[0,0,0],NX=Sc(QX);function f2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wX;n.length<3&&(n=[n[0],n[1],0]);let i=n,s,g=!0;switch(e===Ce.LNGLAT_OFFSETS||e===Ce.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case oi.WEB_MERCATOR:(e===Ce.LNGLAT||e===Ce.CARTESIAN)&&(s=[0,0,0],g=!1);break;case oi.WEB_MERCATOR_AUTO_OFFSET:e===Ce.LNGLAT?i=s:e===Ce.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case oi.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case oi.GLOBE:g=!1,s=null;break;default:g=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:g}}function TX(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:s}=t;let{viewMatrix:g,viewProjectionMatrix:o}=t,r=Ab,a=Ab,I=t.cameraPosition;const{geospatialOrigin:l,shaderCoordinateOrigin:C,offsetMode:c}=f2(t,e,n);return c&&(a=t.projectPosition(l||C),I=[I[0]-a[0],I[1]-a[1],I[2]-a[2]],a[3]=1,r=cI([],a,o),g=i||g,o=ug([],s,g),o=ug([],o,UX)),{viewMatrix:g,viewProjectionMatrix:o,projectionCenter:r,originCommon:a,cameraPosCommon:I,shaderCoordinateOrigin:C,geospatialOrigin:l}}function EX(){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Ce.DEFAULT,coordinateOrigin:s,autoWrapLongitude:g=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};i===Ce.DEFAULT&&(i=t.isGeospatial?Ce.LNGLAT:Ce.CARTESIAN);const o=NX({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.project_uWrapLongitude=g,o.project_uModelMatrix=n||xX,o}function QX(t){let{viewport:e,devicePixelRatio:n,coordinateSystem:i,coordinateOrigin:s}=t;const{projectionCenter:g,viewProjectionMatrix:o,originCommon:r,cameraPosCommon:a,shaderCoordinateOrigin:I,geospatialOrigin:l}=TX(e,i,s),C=e.getDistanceScales(),c=[e.width*n,e.height*n],A=cI([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:I,project_uCommonOrigin:r.slice(0,3),project_uCenter:g,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:c,project_uDevicePixelRatio:n,project_uFocalDistance:A,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:WX,project_uScale:e.scale,project_uViewProjectionMatrix:o,project_uCameraPosition:a};if(l){const h=e.getDistanceScales(l);switch(i){case Ce.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=h.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=h.unitsPerMeter2;break;case Ce.LNGLAT:case Ce.LNGLAT_OFFSETS:e._pseudoMeters||(d.project_uCommonUnitsPerMeter=h.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=h.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=h.unitsPerDegree2;break;case Ce.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,h.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,h.unitsPerMeter2[2]];break}}return d}const XX={};function YX(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XX;return t.viewport?EX(t):{}}const qh={name:"project",dependencies:[yE,GX],vs:SX,getUniforms:YX},_X=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    mat3 rotation = project_get_orientation_matrix(projectedPosition);
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,_s={name:"project32",dependencies:[qh],vs:_X};function HX(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Go(t,e){const n=cI([],e,t);return C2(n,n,1/n[3]),n}function db(t,e){const n=t%e;return n<0?e+n:n}function ub(t,e,n){return t<e?e:t>n?n:t}function kX(t){return Math.log(t)*Math.LOG2E}const $h=Math.log2||kX;function Wi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Hn=Math.PI,p2=Hn/4,Pn=Hn/180,Mu=180/Hn,Na=512,Pu=4003e4,jI=85.051129,KX=1.5;function LX(t){return $h(t)}function xs([t,e]){Wi(Number.isFinite(t)),Wi(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Pn,i=e*Pn,s=Na*(n+Hn)/(2*Hn),g=Na*(Hn+Math.log(Math.tan(p2+i*.5)))/(2*Hn);return[s,g]}function Qo([t,e]){const n=t/Na*(2*Hn)-Hn,i=2*(Math.atan(Math.exp(e/Na*(2*Hn)-Hn))-p2);return[n*Mu,i*Mu]}function MX({latitude:t}){Wi(Number.isFinite(t));const e=Math.cos(t*Pn);return LX(Pu*e)-9}function Ju({latitude:t,longitude:e,highPrecision:n=!1}){Wi(Number.isFinite(t)&&Number.isFinite(e));const i={},s=Na,g=Math.cos(t*Pn),o=s/360,r=o/g,a=s/Pu/g;if(i.unitsPerMeter=[a,a,a],i.metersPerUnit=[1/a,1/a,1/a],i.unitsPerDegree=[o,r,a],i.degreesPerUnit=[1/o,1/r,1/a],n){const I=Pn*Math.tan(t*Pn)/g,l=o*I/2,C=s/Pu*I,c=C/r*a;i.unitsPerDegree2=[0,l,C],i.unitsPerMeter2=[c,0,c]}return i}function B2(t,e){const[n,i,s]=t,[g,o,r]=e,{unitsPerMeter:a,unitsPerMeter2:I}=Ju({longitude:n,latitude:i,highPrecision:!0}),l=xs(t);l[0]+=g*(a[0]+I[0]*o),l[1]+=o*(a[1]+I[1]*o);const C=Qo(l),c=(s||0)+(r||0);return Number.isFinite(s)||Number.isFinite(r)?[C[0],C[1],c]:C}function PX({height:t,pitch:e,bearing:n,altitude:i,scale:s,center:g=null}){const o=HX();return FC(o,o,[0,0,-i]),I2(o,o,-e*Pn),l2(o,o,n*Pn),s/=t,SC(o,o,[s,s,s]),g&&FC(o,o,XE([],g)),o}function JX({width:t,height:e,fovy:n=UC(KX),altitude:i,pitch:s=0,nearZMultiplier:g=1,farZMultiplier:o=1}){i!==void 0&&(n=UC(i));const r=.5*n*Pn,a=b2(n),I=s*Pn,l=Math.sin(r)*a/Math.sin(Math.min(Math.max(Math.PI/2-I-r,.01),Math.PI-.01)),C=Math.sin(I)*l+a;return{fov:2*r,aspect:t/e,focalDistance:a,near:g,far:C*o}}function UC(t){return 2*Math.atan(.5/t)*Mu}function b2(t){return .5/Math.tan(.5*t*Pn)}function y2(t,e){const[n,i,s=0]=t;return Wi(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),Go(e,[n,i,s,1])}function Vc(t,e,n=0){const[i,s,g]=t;if(Wi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(g))return Go(e,[i,s,g,1]);const o=Go(e,[i,s,0,1]),r=Go(e,[i,s,1,1]),a=o[2],I=r[2],l=a===I?0:((n||0)-a)/(I-a);return n2([],o,r,l)}function DX({width:t,height:e,bounds:n,minExtent:i=0,maxZoom:s=24,padding:g=0,offset:o=[0,0]}){const[[r,a],[I,l]]=n;if(Number.isFinite(g)){const y=g;g={top:y,bottom:y,left:y,right:y}}else Wi(Number.isFinite(g.top)&&Number.isFinite(g.bottom)&&Number.isFinite(g.left)&&Number.isFinite(g.right));const C=xs([r,ub(l,-jI,jI)]),c=xs([I,ub(a,-jI,jI)]),A=[Math.max(Math.abs(c[0]-C[0]),i),Math.max(Math.abs(c[1]-C[1]),i)],d=[t-g.left-g.right-Math.abs(o[0])*2,e-g.top-g.bottom-Math.abs(o[1])*2];Wi(d[0]>0&&d[1]>0);const h=d[0]/A[0],u=d[1]/A[1],m=(g.right-g.left)/2/h,f=(g.bottom-g.top)/2/u,p=[(c[0]+C[0])/2+m,(c[1]+C[1])/2+f],B=Qo(p),G=Math.min(s,$h(Math.abs(Math.min(h,u))));return Wi(Number.isFinite(G)),{longitude:B[0],latitude:B[1],zoom:G}}const hb=Math.PI/180;function zX(t,e=0){const{width:n,height:i,unproject:s}=t,g={targetZ:e},o=s([0,i],g),r=s([n,i],g);let a,I;const l=t.fovy?.5*t.fovy*hb:Math.atan(.5/t.altitude),C=(90-t.pitch)*hb;return l>C-.01?(a=mb(t,0,e),I=mb(t,n,e)):(a=s([0,0],g),I=s([n,0],g)),[o,r,I,a]}function mb(t,e,n){const{pixelUnprojectionMatrix:i}=t,s=Go(i,[e,0,1,1]),g=Go(i,[e,t.height,1,1]),r=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(g[2]-s[2]),a=n2([],s,g,r),I=Qo(a);return I[2]=n,I}const fb=512;function OX({width:t,height:e,longitude:n,latitude:i,zoom:s,pitch:g=0,bearing:o=0}){(n<-180||n>180)&&(n=db(n+180,360)-180),(o<-180||o>180)&&(o=db(o+180,360)-180);const r=$h(e/fb);if(s<=r)s=r,i=0;else{const a=e/2/Math.pow(2,s),I=Qo([0,a])[1];if(i<I)i=I;else{const l=Qo([0,fb-a])[1];i>l&&(i=l)}}return{width:t,height:e,longitude:n,latitude:i,zoom:s,pitch:g,bearing:o}}const jX=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,qX=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,$X=Sc(sY),eY=Sc(gY),tY=[0,0,0,1],nY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function iY(t,e){const[n,i,s]=t,g=Vc([n,i,s],e);return Number.isFinite(s)?g:[g[0],g[1],0]}function sY(t){let{viewport:e,center:n}=t;return new Ee(e.viewProjectionMatrix).invert().transform(n)}function gY(t){let{viewport:e,shadowMatrices:n}=t;const i=[],s=e.pixelUnprojectionMatrix,g=e.isGeospatial?void 0:1,o=[[0,0,g],[e.width,0,g],[0,e.height,g],[e.width,e.height,g],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(r=>iY(r,s));for(const r of n){const a=r.clone().translate(new j(e.center).negate()),I=o.map(C=>a.transform(C)),l=new Ee().ortho({left:Math.min(...I.map(C=>C[0])),right:Math.max(...I.map(C=>C[0])),bottom:Math.min(...I.map(C=>C[1])),top:Math.max(...I.map(C=>C[1])),near:Math.min(...I.map(C=>-C[2])),far:Math.max(...I.map(C=>-C[2]))});i.push(l.multiplyRight(r))}return i}function oY(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||tY,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=$X({viewport:t.viewport,center:e.project_uCenter}),s=[],g=eY({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let o=0;o<t.shadowMatrices.length;o++){const r=g[o],a=r.clone().translate(new j(t.viewport.center).negate());e.project_uCoordinateSystem===Ce.LNGLAT&&e.project_uProjectionMode===oi.WEB_MERCATOR?(g[o]=a,s[o]=i):(g[o]=r.clone().multiplyRight(nY),s[o]=a.transform(i))}for(let o=0;o<g.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=g[o],n["shadow_uProjectCenters[".concat(o,"]")]=s[o],t.shadowMaps&&t.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=t.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=t.dummyShadowMap;return n}const nd={name:"shadow",dependencies:[qh],vs:jX,fs:qX,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){const{shadowEnabled:n=!0}=t;return n&&t.shadowMatrices&&t.shadowMatrices.length>0?oY(t,e):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}},Hs={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...PQ},rY=[qh],aY=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function IY(t){const e=Ug.getDefaultProgramManager(t);for(const n of rY)e.addDefaultModule(n);for(const n of aY)e.addShaderHook(n);return e}const lY=[255,255,255],CY=1;let cY=0;class AY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n=lY}=e,{intensity:i=CY}=e;this.id=e.id||"ambient-".concat(cY++),this.color=n,this.intensity=i,this.type="ambient"}}const dY=[255,255,255],uY=1,hY=[0,0,-1];let mY=0;class pb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n=dY}=e,{intensity:i=uY}=e,{direction:s=hY}=e,{_shadow:g=!1}=e;this.id=e.id||"directional-".concat(mY++),this.color=n,this.intensity=i,this.type="directional",this.direction=new j(s).normalize().toArray(),this.shadow=g}getProjectedLight(){return this}}class v2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n="effect"}=e;this.id=n,this.props={...e}}preRender(){}getModuleParameters(){}cleanup(){}}class fY{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i="pass"}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(){}cleanup(){}}class em extends fY{render(e){const n=this.gl;return Qi(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{viewports:n,views:i,onViewportActive:s,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const o=this.gl;g&&BY(o);const r=[];for(const a of n){const I=a.viewport||a,l=i&&i[I.id];s(I);const C=this._getDrawLayerParams(I,e);e.view=l;const c=I.subViewports||[I];for(const A of c){e.viewport=A;const d=this._drawLayersInViewport(o,e,C);r.push(d)}}return r}_getDrawLayerParams(e,n){let{layers:i,pass:s,layerFilter:g,effects:o,moduleParameters:r}=n;const a=[],I=G2(),l={viewport:e,isPicking:s.startsWith("picking"),renderPass:s},C={};for(let c=0;c<i.length;c++){const A=i[c],d=this._shouldDrawLayer(A,l,g,C),h=I(A,d),u={shouldDrawLayer:d,layerRenderIndex:h};d&&(u.moduleParameters=this._getModuleParameters(A,o,s,r),u.layerParameters=this.getLayerParameters(A,c,e)),a[c]=u}return a}_drawLayersInViewport(e,n,i){let{layers:s,pass:g,viewport:o,view:r}=n;const a=pY(e,{viewport:o});if(r&&r.props.clear){const l=r.props.clear===!0?{color:!0,depth:!0}:r.props.clear;Mn(e,{scissorTest:!0,scissor:a},()=>Mh(e,l))}const I={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Qi(e,{viewport:a});for(let l=0;l<s.length;l++){const C=s[l],{shouldDrawLayer:c,layerRenderIndex:A,moduleParameters:d,layerParameters:h}=i[l];if(c&&C.props.pickable&&I.pickableCount++,C.isComposite)I.compositeCount++;else if(c){I.visibleCount++,d.viewport=o;try{C.drawLayer({moduleParameters:d,uniforms:{layerIndex:A},parameters:h})}catch(u){C.raiseError(u,"drawing ".concat(C," to ").concat(g))}}}return I}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n){return e.props.parameters}_shouldDrawLayer(e,n,i,s){if(!(this.shouldDrawLayer(e)&&e.props.visible))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const r=n.layer.id;if(r in s||(s[r]=i(n)),!s[r])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,s){const g=Object.assign(Object.create(e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:wo(this.gl)});if(n)for(const o of n)Object.assign(g,o.getModuleParameters(e));return Object.assign(g,this.getModuleParameters(e,n),s)}}function G2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={},i=(s,g)=>{const o=s.props._offset,r=s.id,a=s.parent&&s.parent.id;let I;if(a&&!(a in e)&&i(s.parent,!1),a in n){const l=n[a]=n[a]||G2(e[a],e);I=l(s,g),n[r]=l}else Number.isFinite(o)?(I=o+(e[a]||0),n[r]=null):I=t;return g&&I>=t&&(t=I+1),e[r]=I,I};return i}function pY(t,e){let{viewport:n}=e;const i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,s=n,g=wo(t);return[s.x*g,(i-s.y-s.height)*g,s.width*g,s.height*g]}function BY(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Qi(t,{viewport:[0,0,e,n]}),t.clear(16640)}class bY extends em{constructor(e,n){super(e,n),this.shadowMap=new An(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new oo(e,{format:33189,width:1,height:1}),this.fbo=new At(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Mn(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],s=wo(this.gl),g=i.width*s,o=i.height*s;(g!==n.width||o!==n.height)&&n.resize({width:g,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const yY={color:[255,255,255],intensity:1},Bb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],vY=[0,0,0,200/255];class Z2 extends v2{constructor(e){super(e),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=vY,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,n){let{layers:i,layerFilter:s,viewports:g,onViewportActive:o,views:r}=n;if(!!this.shadow){this.shadowMatrices=this._createLightMatrix(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Ug.getDefaultProgramManager(e),nd&&this.programManager.addDefaultModule(nd)),this.dummyShadowMap||(this.dummyShadowMap=new An(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:i,layerFilter:s,viewports:g,onViewportActive:o,views:r,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(nd),this.programManager=null)}_createLightMatrix(){const e=[];for(const n of this.directionalLights){const i=new Ee().lookAt({eye:new j(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new bY(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new AY(yY),this.directionalLights.push(new pb(Bb[0]),new pb(Bb[1])))}}class GY{constructor(e){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}setProps(e){Object.assign(this.props,e)}allocate(e,n,i){let{size:s=1,type:g,padding:o=0,copy:r=!1,initialize:a=!1,maxCount:I}=i;const l=g||e&&e.constructor||Float32Array,C=n*s+o;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,C)}let c;I&&(c=I*s+o);const A=this._allocate(l,C,a,c);return e&&r?A.set(e):a||A.fill(0,0,4),this._release(e),A}release(e){this._release(e)}_allocate(e,n,i,s){let g=Math.max(Math.ceil(n*this.props.overAlloc),1);g>s&&(g=s);const o=this._pool,r=e.BYTES_PER_ELEMENT*g,a=o.findIndex(I=>I.byteLength>=r);if(a>=0){const I=new e(o.splice(a,1)[0],0,g);return i&&I.fill(0),I}return new e(g)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:s}=i,g=n.findIndex(o=>o.byteLength>=s);g<0?n.push(i):(g>0||n.length<this.props.poolSize)&&n.splice(g,0,i),n.length>this.props.poolSize&&n.shift()}}const Xo=new GY;function kr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ZY(t,e){const n=t%e;return n<0?e+n:n}function RY(t){return[t[12],t[13],t[14]]}function FY(t){const e={};return e.left=Lg(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),e.right=Lg(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),e.bottom=Lg(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),e.top=Lg(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),e.near=Lg(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),e.far=Lg(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]),e}const bb=new j;function Lg(t,e,n,i){bb.set(t,e,n);const s=bb.len();return{distance:i/s,normal:new j(-t/s,-e/s,-n/s)}}function SY(t){return t-Math.fround(t)}let Sr;function id(t,e){let{size:n=1,startIndex:i=0,endIndex:s}=e;Number.isFinite(s)||(s=t.length);const g=(s-i)/n;Sr=Xo.allocate(Sr,g,{type:Float32Array,size:n*2});let o=i,r=0;for(;o<s;){for(let a=0;a<n;a++){const I=t[o++];Sr[r+a]=I,Sr[r+a+n]=SY(I)}r+=n*2}return Sr.subarray(0,g*n*2)}const VY=Math.PI/180,UY=kr(),sd=[0,0,0],xY=0,WY={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Ws{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=null,x:i=0,y:s=0,width:g=1,height:o=1}=e;this.id=n||this.constructor.displayName||"viewport",this.x=i,this.y=s,this.width=g||1,this.height=o||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?oi.WEB_MERCATOR:oi.WEB_MERCATOR_AUTO_OFFSET:oi.IDENTITY}equals(e){return e instanceof Ws?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&bs(e.projectionMatrix,this.projectionMatrix)&&bs(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.projectPosition(e),s=y2(i,this.pixelProjectionMatrix),[g,o]=s,r=n?o:this.height-o;return e.length===2?[g,r]:[g,r,s[2]]}unproject(e){let{topLeft:n=!0,targetZ:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[s,g,o]=e,r=n?g:this.height-g,a=i&&i*this.distanceScales.unitsPerMeter[2],I=Vc([s,r,o],this.pixelUnprojectionMatrix,a),[l,C,c]=this.unprojectPosition(I);return Number.isFinite(o)?[l,C,c]:Number.isFinite(i)?[l,C,i]:[l,C]}projectPosition(e){const[n,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,s]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,s]}projectFlat(e){return this.isGeospatial?xs(e):e}unprojectFlat(e){return this.isGeospatial?Qo(e):e}getBounds(){const n={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},i=this.unproject([0,0],n),s=this.unproject([this.width,0],n),g=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],s[0],g[0],o[0]),Math.min(i[1],s[1],g[1],o[1]),Math.max(i[0],s[0],g[0],o[0]),Math.max(i[1],s[1],g[1],o[1])]}getDistanceScales(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return e?Ju({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:n,y:i,width:s=1,height:g=1}=e;return n<this.x+this.width&&this.x<n+s&&i<this.y+this.height&&this.y<i+g}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,FY(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix(e){let{orthographic:n,fovyRadians:i,aspect:s,focalDistance:g,near:o,far:r}=e;return n?new Ee().orthographic({fovy:i,aspect:s,focalDistance:g,near:o,far:r}):new Ee().perspective({fovy:i,aspect:s,near:o,far:r})}_initViewMatrix(e){const{viewMatrix:n=UY,longitude:i=null,latitude:s=null,zoom:g=null,position:o=null,modelMatrix:r=null,focalDistance:a=1,distanceScales:I=null}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(i),this.zoom=g,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?MX({latitude:s})+Math.log2(a):xY);const l=Math.pow(2,this.zoom);this.scale=l,this.distanceScales=this.isGeospatial?Ju({latitude:s,longitude:i}):I||WY,this.focalDistance=a,this.distanceScales.metersPerUnit=new j(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new j(this.distanceScales.unitsPerMeter),this.position=sd,this.meterOffset=sd,o&&(this.position=o,this.modelMatrix=r,this.meterOffset=r?r.transformVector(o):o),this.isGeospatial?(this.longitude=i,this.latitude=s,this.center=this._getCenterInWorld({longitude:i,latitude:s})):this.center=o?this.projectPosition(o):[0,0,0],this.viewMatrixUncentered=n,this.viewMatrix=new Ee().multiplyRight(this.viewMatrixUncentered).translate(new j(this.center||sd).negate())}_getCenterInWorld(e){let{longitude:n,latitude:i}=e;const{meterOffset:s,distanceScales:g}=this,o=new j(this.projectPosition([n,i,0]));if(s){const r=new j(s).scale(g.unitsPerMeter);o.add(r)}return o}_initProjectionMatrix(e){const{projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:g=75,near:o=.1,far:r=1e3,focalDistance:a=1}=e;this.projectionMatrix=n||this._createProjectionMatrix({orthographic:i,fovyRadians:s||g*VY,aspect:this.width/this.height,focalDistance:a,near:o,far:r})}_initPixelMatrices(){const e=kr();ug(e,e,this.projectionMatrix),ug(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=Lu([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=RY(this.viewMatrixInverse);const n=kr(),i=kr();SC(n,n,[this.width/2,-this.height/2,1]),FC(n,n,[1,-1,0]),ug(i,n,this.viewProjectionMatrix),this.pixelProjectionMatrix=i,this.viewportMatrix=n,this.pixelUnprojectionMatrix=Lu(kr(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||me.warn("Pixel project matrix not invertible")()}}Ws.displayName="Viewport";const wY=512,NY=4003e4,TY=Math.PI/180;function yb(t){const e=Math.cos(t*TY);return wY/NY/e}class Yo extends Ws{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:n=0,longitude:i=0,zoom:s=11,pitch:g=0,bearing:o=0,nearZMultiplier:r=.1,farZMultiplier:a=1.01,orthographic:I=!1,projectionMatrix:l,repeat:C=!1,worldOffset:c=0,legacyMeterSizes:A=!1}=e;let{width:d,height:h,altitude:u=1.5}=e;const m=Math.pow(2,s);d=d||1,h=h||1;let f,p=null;l?(u=l[5]/2,f=UC(u)):(e.fovy?(f=e.fovy,u=b2(f)):f=UC(u),p=JX({width:d,height:h,pitch:g,fovy:f,nearZMultiplier:r,farZMultiplier:a}));let B=PX({height:h,pitch:g,bearing:o,scale:m,altitude:u});c&&(B=new Ee().translate([512*c,0,0]).multiplyLeft(B)),super({...e,width:d,height:h,viewMatrix:B,longitude:i,latitude:n,zoom:s,...p,fovy:f,focalDistance:u}),this.latitude=n,this.longitude=i,this.zoom=s,this.pitch=g,this.bearing=o,this.altitude=u,this.fovy=f,this.orthographic=I,this._subViewports=C?[]:null,this._pseudoMeters=A,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=n;s<=i;s++){const g=s?new Yo({...this,worldOffset:s}):this;this._subViewports.push(g)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),s=(e[2]||0)*yb(e[1]);return[n,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),s=(e[2]||0)/yb(i);return[n,i,s]}addMetersToLngLat(e,n){return B2(e,n)}panByPosition(e,n){const i=Vc(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),g=RC([],s,t2([],i)),o=RC([],this.center,g),[r,a]=this.unprojectFlat(o);return{longitude:r,latitude:a}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=zX(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:i,height:s}=this,{longitude:g,latitude:o,zoom:r}=DX({width:i,height:s,bounds:e,...n});return new Yo({width:i,height:s,longitude:g,latitude:o,zoom:r})}}Yo.displayName="WebMercatorViewport";function gd(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=e.projectPosition(t);if(n&&e instanceof Yo){const[s,g,o=0]=t,r=e.getDistanceScales([s,g]);i[2]=o*r.unitsPerMeter[2]}return i}function EY(t){const e={...t};let{coordinateSystem:n}=t;const{viewport:i,coordinateOrigin:s,fromCoordinateSystem:g,fromCoordinateOrigin:o}=t;return n===Ce.DEFAULT&&(n=i.isGeospatial?Ce.LNGLAT:Ce.CARTESIAN),g===void 0&&(e.fromCoordinateSystem=n),o===void 0&&(e.fromCoordinateOrigin=s),e.coordinateSystem=n,e}function R2(t,e){let{viewport:n,modelMatrix:i,coordinateSystem:s,coordinateOrigin:g,offsetMode:o}=e,[r,a,I=0]=t;switch(i&&([r,a,I]=cI([],[r,a,I,1],i)),s){case Ce.LNGLAT:return gd([r,a,I],n,o);case Ce.LNGLAT_OFFSETS:return gd([r+g[0],a+g[1],I+(g[2]||0)],n,o);case Ce.METER_OFFSETS:return gd(B2(g,[r,a,I]),n,o);case Ce.CARTESIAN:default:return n.isGeospatial?[r+g[0],a+g[1],I+g[2]]:n.projectPosition([r,a,I])}}function QY(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:s,modelMatrix:g,fromCoordinateSystem:o,fromCoordinateOrigin:r}=EY(e),{geospatialOrigin:a,shaderCoordinateOrigin:I,offsetMode:l}=f2(n,i,s),C=R2(t,{viewport:n,modelMatrix:g,coordinateSystem:o,coordinateOrigin:r,offsetMode:l});if(l){const c=n.projectPosition(a||I);ME(C,C,c)}return C}const Og={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Uc={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")};function xc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(t)?F2(t,e,[]):e(t)?[t]:[]}function F2(t,e,n){let i=-1;for(;++i<t.length;){const s=t[i];Array.isArray(s)?F2(s,e,n):e(s)&&n.push(s)}return n}function XY(t){let{target:e,source:n,start:i=0,count:s=1}=t;const g=n.length,o=s*g;let r=0;for(let a=i;r<g;r++)e[a++]=n[r];for(;r<o;)r<o-r?(e.copyWithin(i+r,i,i+r),r*=2):(e.copyWithin(i+r,i,i+o-r),r=o);return e}class YY{constructor(e,n,i){this.id=e,this.context=i,this._loadCount=0,this._subscribers=new Set,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=vC(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(g=>{this._loadCount===i&&(this.isLoaded=!0,this._error=null,this._content=g)}).catch(g=>{this._loadCount===i&&(this.isLoaded=!0,this._error=g||!0)})):(this.isLoaded=!0,this._error=null,this._content=e);for(const g of this._subscribers)g.onChange(this.getData())}}class _Y{constructor(e){let{gl:n,protocol:i}=e;this.protocol=i||"resource://",this._context={gl:n,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:n,data:i,forceUpdate:s=!1,persistent:g=!0}=e,o=this._resources[n];o?o.setData(i,s):(o=new YY(n,i,this._context),this._resources[n]=o),o.persistent=g}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:n}=e;const i=this._consumers[n];if(i){for(const s in i){const g=i[s];g.resource&&g.resource.unsubscribe(g)}delete this._consumers[n],this.prune()}}subscribe(e){let{resourceId:n,onChange:i,consumerId:s,requestId:g="default"}=e;const{_resources:o,protocol:r}=this;n.startsWith(r)&&(n=n.replace(r,""),o[n]||this.add({resourceId:n,data:null,persistent:!1}));const a=o[n];if(this._track(s,g,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,s){const g=this._consumers,o=g[e]=g[e]||{},r=o[n]||{};r.resource&&(r.resource.unsubscribe(r),r.resource=null,this.prune()),i&&(o[n]=r,r.onChange=s,r.resource=i,i.subscribe(r))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const HY="layerManager.setLayers",kY="layerManager.activateViewport",KY=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class LY{constructor(e){let{deck:n,stats:i,viewport:s,timeline:g}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new _Y({gl:e,protocol:"deck://"}),this.context={...KY,layerManager:this,gl:e,deck:n,programManager:e&&IY(e),stats:i||new vc({id:"deck.gl"}),viewport:s||new Ws({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:g||new m2,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Nt(HY,this,n,e),this.lastRenderedLayers=e,e=xc(e,Boolean);for(const i of e)i.context=this.context;return this._updateLayers(this.layers,e),this}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this.lastRenderedLayers,e)),this._nextLayers=null}activateViewport(e){return Nt(kY,this,e),e&&(this.context.viewport=e),this}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?me.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const s=[];this._updateSublayersRecursively(n,i,s),this._finalizeOldLayers(i);let g=!1;for(const o of s)if(o.hasUniformTransition()){g=!0;break}this._needsUpdate=g,this.layers=s}_updateSublayersRecursively(e,n,i){for(const s of e){s.context=this.context;const g=n[s.id];g===null&&me.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;let o=null;try{this._debug&&g!==s&&s.validateProps(),g?(this._transferLayerState(g,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),o=s.isComposite&&s.getSubLayers()}catch(r){this._handleError("matching",r,s)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Og.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Og.MATCHED,n!==e&&(e.lifecycle=Og.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Og.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Og.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Oo(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],s=e[n];if(!(i===s||Array.isArray(i)&&Array.isArray(s)&&Oo(i,s)))return!1}return!0}class MY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return typeof e=="string"?this.views.find(n=>n.id===e):e}getViewState(e){const n=this.getView(e),i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let g=i.length-1;g>=0;--g){const o=i[g];if(o.containsPixel(s)){const r=e.slice();return r[0]-=o.x,r[1]-=o.y,o.unproject(r,n)}}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=xc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Oo(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):me.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){n.viewId=e,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(n)}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:g=>e._getViewport(g,{width:g.width,height:g.height}),...n})}_updateController(e,n,i,s){let g=e.controller;return g?(g={...n,...e.props,...g,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height},s?s.setProps(g):s=this._createController(e,g),s):null}_rebuildViewports(){const{width:e,height:n,views:i}=this,s=this.controllers;this._viewports=[],this.controllers={};let g=!1;for(let o=i.length;o--;){const r=i[o],a=this.getViewState(r),I=r.makeViewport({width:e,height:n,viewState:a});let l=s[r.id];r.controller&&!l&&(g=!0),(g||!r.controller)&&l&&(l.finalize(),l=null),this.controllers[r.id]=this._updateController(r,a,I,l),this._viewports.unshift(I)}for(const o in s)s[o]&&!this.controllers[o]&&s[o].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,s)=>!e[s].equals(n[s]))}}const PY=/([0-9]+\.?[0-9]*)(%|px)/;function qI(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=t.match(PY);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function $I(t,e){return t.relative?Math.round(t.position*e):t.position}function Cn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Bg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=null,x:i=0,y:s=0,width:g="100%",height:o="100%",viewportInstance:r,type:a=Ws}=e;Cn(!r||r instanceof Ws),this.viewportInstance=r,this.id=n||this.constructor.displayName||"view",this.type=a,this.props={...e,id:this.id},this._parseDimensions({x:i,y:s,width:g,height:o}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance):Oo(this.props,e.props)}makeViewport(e){let{width:n,height:i,viewState:s}=e;if(this.viewportInstance)return this.viewportInstance;s=this.filterViewState(s);const g=this.getDimensions({width:n,height:i});return this._getViewport(s,g)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions(e){let{width:n,height:i}=e;return{x:$I(this._x,n),y:$I(this._y,i),width:$I(this._width,n),height:$I(this._height,i)}}_getControllerProps(e){let n=this.props.controller;return n?n===!0?e:(typeof n=="function"&&(n={type:n}),{...e,...n}):null}_getViewport(e,n){const{type:i}=this;return new i({...e,...this.props,...n})}_parseDimensions(e){let{x:n,y:i,width:s,height:g}=e;this._x=qI(n),this._y=qI(i),this._width=qI(s),this._height=qI(g)}}function el(){}const JY={onStart:el,onUpdate:el,onInterrupt:el,onEnd:el};class AI{constructor(e){this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings={...JY,...e},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{timeline:e,settings:n}=this;this._handle=e.addChannel({delay:e.getTime(),duration:n.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Ca=()=>{},xC={BREAK:1,SNAP_TO_END:2,IGNORE:3},vb={transitionEasing:t=>t,transitionInterruption:xC.BREAK,onTransitionStart:Ca,onTransitionInterrupt:Ca,onTransitionEnd:Ca};class DY{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ControllerState=e,this.props={...vb,...n},this.propsInTransition=null,this.transition=new AI(n.timeline),this.onViewStateChange=n.onViewStateChange||Ca,this.onStateChange=n.onStateChange||Ca,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(e={...vb,...e},this.props=e,this._shouldIgnoreViewportChange(i,e))return n;if(this._isTransitionEnabled(e)){const{interruption:s,endProps:g}=this.transition.settings,o={...i,...s===xC.SNAP_TO_END?g:this.propsInTransition||i};this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===xC.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=new this.ControllerState(e),s=new this.ControllerState(n).shortestPathFrom(i),{transitionInterpolator:g}=n,o=g.getDuration?g.getDuration(e,n):n.transitionDuration;if(o===0)return;const r=n.transitionInterpolator.initializeProps(e,s);this.propsInTransition={},this.duration=o,this.transition.start({duration:o,easing:n.transitionEasing,interpolator:n.transitionInterpolator,interruption:n.transitionInterruption,startProps:r.start,endProps:r.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e(n)}}_onTransitionUpdate(e){const{time:n,settings:{interpolator:i,startProps:s,endProps:g,duration:o,easing:r}}=e,a=r(n/o),I=i.interpolateProps(s,g,a);this.propsInTransition=new this.ControllerState({...this.props,...I}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class zY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Array.isArray(e)&&(e={compare:e,extract:e,required:e});const{compare:n,extract:i,required:s}=e;this._propsToCompare=n,this._propsToExtract=i,this._requiredProps=s}arePropsEqual(e,n){for(const i of this._propsToCompare||Object.keys(n))if(!(i in e)||!(i in n)||!bs(e[i],n[i]))return!1;return!0}initializeProps(e,n){let i;if(this._propsToExtract){const s={},g={};for(const o of this._propsToExtract)s[o]=e[o],g[o]=n[o];i={start:s,end:g}}else i={start:e,end:n};return this._checkRequiredProps(i.start),this._checkRequiredProps(i.end),i}interpolateProps(e,n,i){return n}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Cn(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const Gb=["longitude","latitude","zoom","bearing","pitch"],OY=["longitude","latitude","zoom"];class Zb extends zY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Array.isArray(e)?e:e.transitionProps;super(n||{compare:Gb,extract:Gb,required:OY}),this.opts=e}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:s,around:g}=this.opts;if(s&&g){const o=s(e),r=s(n),a=o.unproject(g);i.start.around=g,Object.assign(i.end,{around:r.project(a),aroundPosition:a,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const s={};for(const g of this._propsToExtract)s[g]=dg(e[g]||0,n[g]||0,i);if(n.aroundPosition){const g=this.opts.makeViewport({...n,...s});Object.assign(s,g.panByPosition(n.aroundPosition,dg(e.around,n.around,i)))}return s}}const qi={transitionDuration:0},jY={transitionDuration:300,transitionEasing:t=>t,transitionInterruption:xC.BREAK},qY=300,tl=t=>1-(1-t)*(1-t),Mg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]};class S2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new DY(e,{...n,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)});const i=this.linearTransitionProps;this._transition=i&&{...jY,transitionInterpolator:new Zb({transitionProps:i})},this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}get linearTransitionProps(){return null}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.setProps(this.controllerStateProps)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const{ControllerState:n}=this;this.controllerState=new n({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){const{x:n,y:i}=this.controllerStateProps,{offsetCenter:s}=e;return[s.x-n,s.y-i]}isPointInBounds(e,n){const{width:i,height:s}=this.controllerStateProps;if(n&&n.handled)return!1;const g=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return g&&n&&n.stopPropagation(),g}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),"makeViewport"in e&&(this.makeViewport=e.makeViewport),"dragMode"in e&&(this.dragMode=e.dragMode),this.controllerStateProps=e,"eventManager"in e&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:n}=e;n===!0&&(n=qY),this.inertia=n;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:g=!0,doubleClickZoom:o=!0,touchZoom:r=!0,touchRotate:a=!1,keyboard:I=!0}=e,l=Boolean(this.onViewStateChange);this.toggleEvents(Mg.WHEEL,l&&i),this.toggleEvents(Mg.PAN,l&&(s||g)),this.toggleEvents(Mg.PINCH,l&&(r||a)),this.toggleEvents(Mg.TRIPLE_PAN,l&&a),this.toggleEvents(Mg.DOUBLE_TAP,l&&o),this.toggleEvents(Mg.KEYBOARD,l&&I),this.scrollZoom=i,this.dragPan=s,this.dragRotate=g,this.doubleClickZoom=o,this.touchZoom=r,this.touchRotate=a,this.keyboard=I}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={...e.getViewportProps(),...n},g=this.controllerState!==e;if(this._state=e.getState(),this._setInteractionState(i),g){const o=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange&&(e.interactionState=this._interactionState,this.onViewStateChange(e))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(s,qi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,qi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],g=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(g,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:tl},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,qi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],g=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(g,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:tl},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:s=!1}=this.scrollZoom,{delta:g}=e;let o=2/(1+Math.exp(-Math.abs(g*i)));g<0&&o!==0&&(o=1/o);const r=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(r,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,qi,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,qi,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*n/2],g=this.controllerState.rotate({pos:s});this.updateViewport(g,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:tl},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(i,qi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:this._startPinchRotation-i})}return this.updateViewport(n,qi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n,_lastPinchEvent:i}=this;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const s=this.getCenter(e);let g=this.controllerState.rotateEnd();const o=Math.log2(e.scale),r=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),a=Math.pow(2,o+r*n/2);g=g.zoom({pos:s,scale:a}).zoomEnd(),this.updateViewport(g,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:tl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:g,rotateSpeedY:o}=this.keyboard,{controllerState:r}=this;let a;const I={};switch(e.srcEvent.code){case"Minus":a=n?r.zoomOut(i).zoomOut(i):r.zoomOut(i),I.isZooming=!0;break;case"Equal":a=n?r.zoomIn(i).zoomIn(i):r.zoomIn(i),I.isZooming=!0;break;case"ArrowLeft":n?(a=r.rotateLeft(g),I.isRotating=!0):(a=r.moveLeft(s),I.isPanning=!0);break;case"ArrowRight":n?(a=r.rotateRight(g),I.isRotating=!0):(a=r.moveRight(s),I.isPanning=!0);break;case"ArrowUp":n?(a=r.rotateUp(o),I.isRotating=!0):(a=r.moveUp(s),I.isPanning=!0);break;case"ArrowDown":n?(a=r.rotateDown(o),I.isRotating=!0):(a=r.moveDown(s),I.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),I),!0}_getTransitionProps(e){const{_transition:n}=this;return n?e?{...n,transitionInterpolator:new Zb({...e,transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport})}:n:qi}}class V2{constructor(e){this._viewportProps=this._applyConstraints(e)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}const Rb=5,$Y=1.2,Js={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60};class e_ extends V2{constructor(){let{makeViewport:e,width:n,height:i,latitude:s,longitude:g,zoom:o,bearing:r=Js.bearing,pitch:a=Js.pitch,altitude:I=Js.altitude,maxZoom:l=Js.maxZoom,minZoom:C=Js.minZoom,maxPitch:c=Js.maxPitch,minPitch:A=Js.minPitch,startPanLngLat:d,startZoomLngLat:h,startRotatePos:u,startBearing:m,startPitch:f,startZoom:p,normalize:B}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Cn(Number.isFinite(g)),Cn(Number.isFinite(s)),Cn(Number.isFinite(o)),super({width:n,height:i,latitude:s,longitude:g,zoom:o,bearing:r,pitch:a,altitude:I,maxZoom:l,minZoom:C,maxPitch:c,minPitch:A,normalize:B}),this._state={startPanLngLat:d,startZoomLngLat:h,startRotatePos:u,startBearing:m,startPitch:f,startZoom:p},this.makeViewport=e}panStart(e){let{pos:n}=e;return this._getUpdatedState({startPanLngLat:this._unproject(n)})}pan(e){let{pos:n,startPos:i}=e;const s=this._state.startPanLngLat||this._unproject(i);if(!s)return this;const o=this.makeViewport(this._viewportProps).panByPosition(s,n);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:n}=e;return this._getUpdatedState({startRotatePos:n,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate(e){let{pos:n,deltaAngleX:i=0,deltaAngleY:s=0}=e;const{startRotatePos:g,startBearing:o,startPitch:r}=this._state;if(!g||!Number.isFinite(o)||!Number.isFinite(r))return this;let a;return n?a=this._calculateNewPitchAndBearing({...this._getRotationParams(n,g),startBearing:o,startPitch:r}):a={bearing:o+i,pitch:r+s},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:n}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(n),startZoom:this._viewportProps.zoom})}zoom(e){let{pos:n,startPos:i,scale:s}=e,{startZoom:g,startZoomLngLat:o}=this._state;Number.isFinite(g)||(g=this._viewportProps.zoom,o=this._unproject(i)||this._unproject(n));const r=this._calculateNewZoom({scale:s,startZoom:g}),a=this.makeViewport({...this._viewportProps,zoom:r});return this._getUpdatedState({zoom:r,...a.panByPosition(o,n)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this._viewportProps.bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this._viewportProps.bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this._viewportProps.pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this._viewportProps.pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this._viewportProps},{bearing:s,longitude:g}=i;return Math.abs(s-n.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(g-n.longitude)>180&&(i.longitude=g<0?g+360:g-360),i}_zoomFromCenter(e){const{width:n,height:i}=this._viewportProps;return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this._viewportProps;return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...e})}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s}=e;e.zoom=rn(s,i,n);const{maxPitch:g,minPitch:o,pitch:r}=e;e.pitch=rn(r,o,g);const{normalize:a=!0}=e;return a&&Object.assign(e,OX(e)),e}_unproject(e){const n=this.makeViewport(this._viewportProps);return e&&n.unproject(e)}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:s,minZoom:g}=this._viewportProps,o=i+Math.log2(n);return rn(o,g,s)}_calculateNewPitchAndBearing(e){let{deltaScaleX:n,deltaScaleY:i,startBearing:s,startPitch:g}=e;i=rn(i,-1,1);const{minPitch:o,maxPitch:r}=this._viewportProps,a=s+180*n;let I=g;return i>0?I=g+i*(r-g):i<0&&(I=g-i*(o-g)),{pitch:I,bearing:a}}_getRotationParams(e,n){const i=e[0]-n[0],s=e[1]-n[1],g=e[1],o=n[1],{width:r,height:a}=this._viewportProps,I=i/r;let l=0;return s>0?Math.abs(a-o)>Rb&&(l=s/(o-a)*$Y):s<0&&o>Rb&&(l=1-g/o),l=Math.min(1,Math.max(-1,l)),{deltaScaleX:I,deltaScaleY:l}}}class t_ extends S2{constructor(e){e.dragMode=e.dragMode||"pan",super(e_,e)}setProps(e){const n=this.controllerStateProps;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state}))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch"]}}class U2 extends Bg{constructor(e){super({...e,type:Yo})}get controller(){return this._getControllerProps({type:t_})}}U2.displayName="MapView";const n_=new Z2;class i_{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Oo(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.cleanup(),this.effects=e,this._createInternalEffects()}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some(e=>e instanceof Z2)||this._internalEffects.push(n_)}}class s_ extends em{}const Fb={blendFunc:[1,0,32771,0],blendEquation:32774};class x2 extends em{render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:n,layerFilter:i,views:s,viewports:g,onViewportActive:o,pickingFBO:r,deviceRect:{x:a,y:I,width:l,height:C},pass:c="picking",redrawReason:A,pickZ:d}=e;const h=this.gl;this.pickZ=d;const u=!d&&{byLayer:new Map,byAlpha:[]};this._colors=u;const m=Mn(h,{scissorTest:!0,scissor:[a,I,l,C],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Fb,blend:!d},()=>super.render({target:r,layers:n,layerFilter:i,views:s,viewports:g,onViewportActive:o,pass:c,redrawReason:A}));return this._colors=null,{decodePickingColor:u&&o_.bind(null,u),stats:m}}shouldDrawLayer(e){return e.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const s={...e.props.parameters};return this.pickZ?s.blend=!1:(Object.assign(s,Fb),s.blend=!0,s.blendColor=g_(this._colors,e,i)),s}}function g_(t,e,n){const{byLayer:i,byAlpha:s}=t;let g;if(i.has(e)){const o=i.get(e);o.viewports.push(n),g=o.a}else if(g=i.size+1,g<=255){const o={a:g,layer:e,viewports:[n]};i.set(e,o),s[g]=o}else me.warn("Too many pickable layers, only picking the first 255")(),g=0;return[0,0,0,g/255]}function o_(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const r_="deckRenderer.renderLayers";class a_{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new s_(e),this.pickLayersPass=new x2(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||At.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,s=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,Nt(r_,this,s,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const s of e)s.preRender(this.gl,n),s.postRender&&(i=s);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new At(this.gl),new At(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,s={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const g of e)if(g.postRender){if(g===this.lastPostProcessEffect){s.target=n.target,g.postRender(this.gl,s);break}const o=g.postRender(this.gl,s);s.inputBuffer=o,s.swapBuffer=o===i[0]?i[1]:i[0]}}}const I_={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function l_(t){let{pickedColors:e,decodePickingColor:n,deviceX:i,deviceY:s,deviceRadius:g,deviceRect:o}=t;if(e){const{x:r,y:a,width:I,height:l}=o;let C=g*g,c=-1,A=0;for(let d=0;d<l;d++){const h=d+a-s,u=h*h;if(u>C)A+=4*I;else for(let m=0;m<I;m++){if(e[A+3]-1>=0){const p=m+r-i,B=p*p+u;B<=C&&(C=B,c=A)}A+=4}}if(c>=0){const d=e.slice(c,c+4),h=n(d);if(h){const u=Math.floor(c/4/I),m=c/4-u*I;return{...h,pickedColor:d,pickedX:r+m,pickedY:a+u}}me.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return I_}function C_(t){let{pickedColors:e,decodePickingColor:n}=t;const i=new Map;if(e){for(let s=0;s<e.length;s+=4)if(e[s+3]-1>=0){const o=e.slice(s,s+4),r=o.join(",");if(!i.has(r)){const a=n(o);a?i.set(r,{...a,pickedColor:o}):me.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function W2(t){let{pickInfo:e,viewports:n,pixelRatio:i,x:s,y:g,z:o}=t,r=n[0];n.length>1&&(r=A_((e==null?void 0:e.pickedViewports)||n,{x:s,y:g}));const a=r&&r.unproject([s-r.x,g-r.y,o]);return{color:null,layer:null,viewport:r,index:-1,picked:!1,x:s,y:g,pixel:[s,g],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:null,pixelRatio:i}}function c_(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:s}=t,{pickedColor:g,pickedLayer:o,pickedObjectIndex:r}=e,a=o?[o]:[];if(i==="hover"){const C=n.index,c=n.layerId,A=o&&o.props.id;if(A!==c||r!==C){if(A!==c){const d=s.find(h=>h.props.id===c);d&&a.unshift(d)}n.layerId=A,n.index=r,n.info=null}}const I=W2(t),l=new Map;return l.set(null,I),a.forEach(C=>{let c={...I};C===o&&(c.color=g,c.index=r,c.picked=!0),c=w2({layer:C,info:c,mode:i}),C===o&&i==="hover"&&(n.info=c),l.set(c.layer.id,c),i==="hover"&&c.layer.updateAutoHighlight(c)}),l}function w2(t){let{layer:e,info:n,mode:i}=t;for(;e&&n;){const s=n.layer||null;n.sourceLayer=s,n.layer=e,n=e.getPickingInfo({info:n,mode:i,sourceLayer:s}),e=e.parent}return n}function A_(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class d_{constructor(e){this.gl=e,this.pickingFBO=null,this.pickLayersPass=new x2(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:n,y:i,layers:s,viewports:g}=e,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const r=o&&o.layer&&o.layer.id,a=o&&o.viewport&&o.viewport.id,I=r?s.find(A=>A.id===r):null,l=a&&g.find(A=>A.id===a)||g[0],C=l&&l.unproject([n-l.x,i-l.y]);return{...o,...{x:n,y:i,viewport:l,coordinate:C,layer:I}}}_resizeBuffer(){const{gl:e}=this;return this.pickingFBO||(this.pickingFBO=new At(e),At.isSupported(e,{colorBufferFloat:!0})&&(this.depthFBO=new At(e),this.depthFBO.attach({[36064]:new An(e,{format:be(e)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.pickingFBO}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject(e){let{layers:n,views:i,viewports:s,x:g,y:o,radius:r=0,depth:a=1,mode:I="query",unproject3D:l,onViewportActive:C}=e;if(n=this._getPickable(n),!n)return{result:[],emptyInfo:W2({viewports:s,x:g,y:o})};this._resizeBuffer();const c=wo(this.gl),A=MA(this.gl,[g,o],!0),d=[A.x+Math.floor(A.width/2),A.y+Math.floor(A.height/2)],h=Math.round(r*c),{width:u,height:m}=this.pickingFBO,f=this._getPickingRect({deviceX:d[0],deviceY:d[1],deviceRadius:h,deviceWidth:u,deviceHeight:m});let p;const B=[],G=new Set;for(let y=0;y<a;y++){const U=f&&this._drawAndSample({layers:n,views:i,viewports:s,onViewportActive:C,deviceRect:f,pass:"picking:".concat(I),redrawReason:I}),V=l_({...U,deviceX:d[0],deviceY:d[1],deviceRadius:h,deviceRect:f});let F;V.pickedLayer&&l&&this.depthFBO&&(F=this._drawAndSample({layers:[V.pickedLayer],views:i,viewports:s,onViewportActive:C,deviceRect:{x:V.pickedX,y:V.pickedY,width:1,height:1},pass:"picking:".concat(I),redrawReason:"pick-z",pickZ:!0}).pickedColors[0]),V.pickedLayer&&y+1<a&&(G.add(V.pickedLayer),V.pickedLayer.disablePickingIndex(V.pickedObjectIndex)),p=c_({pickInfo:V,lastPickedInfo:this.lastPickedInfo,mode:I,layers:n,viewports:s,x:g,y:o,z:F,pixelRatio:c});for(const W of p.values())W.layer&&B.push(W);if(!V.pickedColor)break}for(const y of G)y.restorePickingColors();return{result:B,emptyInfo:p&&p.get(null)}}_pickVisibleObjects(e){let{layers:n,views:i,viewports:s,x:g,y:o,width:r=1,height:a=1,mode:I="query",maxObjects:l=null,onViewportActive:C}=e;if(n=this._getPickable(n),!n)return[];this._resizeBuffer();const c=wo(this.gl),A=MA(this.gl,[g,o],!0),d=A.x,h=A.y+A.height,u=MA(this.gl,[g+r,o+a],!0),m=u.x+u.width,f=u.y,p={x:d,y:f,width:m-d,height:h-f},B=this._drawAndSample({layers:n,views:i,viewports:s,onViewportActive:C,deviceRect:p,pass:"picking:".concat(I),redrawReason:I}),G=C_(B),y=new Map,U=Number.isFinite(l);for(let V=0;V<G.length&&!(U&&y.size>=l);V++){const F=G[V];let W={color:F.pickedColor,layer:null,index:F.pickedObjectIndex,picked:!0,x:g,y:o,width:r,height:a,pixelRatio:c};W=w2({layer:F.pickedLayer,info:W,mode:I}),y.has(W.object)||y.set(W.object,W)}return Array.from(y.values())}_drawAndSample(e){let{layers:n,views:i,viewports:s,onViewportActive:g,deviceRect:o,pass:r,redrawReason:a,pickZ:I}=e;const l=I?this.depthFBO:this.pickingFBO,{decodePickingColor:C}=this.pickLayersPass.render({layers:n,layerFilter:this.layerFilter,views:i,viewports:s,onViewportActive:g,pickingFBO:l,deviceRect:o,pass:r,redrawReason:a,pickZ:I}),{x:c,y:A,width:d,height:h}=o,u=new(I?Float32Array:Uint8Array)(d*h*4);return Fc(l,{sourceX:c,sourceY:A,sourceWidth:d,sourceHeight:h,target:u}),{pickedColors:u,decodePickingColor:C}}_getPickingRect(e){let{deviceX:n,deviceY:i,deviceRadius:s,deviceWidth:g,deviceHeight:o}=e;const r=Math.max(0,n-s),a=Math.max(0,i-s),I=Math.min(g,n+s+1)-r,l=Math.min(o,i+s+1)-a;return I<=0||l<=0?null:{x:r,y:a,width:I,height:l}}}const u_={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class h_{constructor(e){const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,u_),n.appendChild(this.el)),this.isVisible=!1}setTooltip(e,n,i){const s=this.el;if(typeof e=="string")s.innerText=e;else if(e)"text"in e&&(s.innerText=e.text),"html"in e&&(s.innerHTML=e.html),"className"in e&&(s.className=e.className),Object.assign(s.style,e.style);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}remove(){this.el&&this.el.remove()}}var N2={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,s){var g=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),r="function",a=Math.round,I=Math.abs,l=Date.now;function C(b,v,R){return setTimeout(p(b,R),v)}function c(b,v,R){return Array.isArray(b)?(A(b,R[v],R),!0):!1}function A(b,v,R){var N;if(!!b)if(b.forEach)b.forEach(v,R);else if(b.length!==s)for(N=0;N<b.length;)v.call(R,b[N],N,b),N++;else for(N in b)b.hasOwnProperty(N)&&v.call(R,b[N],N,b)}function d(b,v,R){var N="DEPRECATED METHOD: "+v+`
`+R+` AT 
`;return function(){var K=new Error("get-stack-trace"),$=K&&K.stack?K.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ye=e.console&&(e.console.warn||e.console.log);return ye&&ye.call(e.console,N,$),b.apply(this,arguments)}}var h;typeof Object.assign!="function"?h=function(v){if(v===s||v===null)throw new TypeError("Cannot convert undefined or null to object");for(var R=Object(v),N=1;N<arguments.length;N++){var K=arguments[N];if(K!==s&&K!==null)for(var $ in K)K.hasOwnProperty($)&&(R[$]=K[$])}return R}:h=Object.assign;var u=d(function(v,R,N){for(var K=Object.keys(R),$=0;$<K.length;)(!N||N&&v[K[$]]===s)&&(v[K[$]]=R[K[$]]),$++;return v},"extend","Use `assign`."),m=d(function(v,R){return u(v,R,!0)},"merge","Use `assign`.");function f(b,v,R){var N=v.prototype,K;K=b.prototype=Object.create(N),K.constructor=b,K._super=N,R&&h(K,R)}function p(b,v){return function(){return b.apply(v,arguments)}}function B(b,v){return typeof b==r?b.apply(v&&v[0]||s,v):b}function G(b,v){return b===s?v:b}function y(b,v,R){A(W(v),function(N){b.addEventListener(N,R,!1)})}function U(b,v,R){A(W(v),function(N){b.removeEventListener(N,R,!1)})}function V(b,v){for(;b;){if(b==v)return!0;b=b.parentNode}return!1}function F(b,v){return b.indexOf(v)>-1}function W(b){return b.trim().split(/\s+/g)}function M(b,v,R){if(b.indexOf&&!R)return b.indexOf(v);for(var N=0;N<b.length;){if(R&&b[N][R]==v||!R&&b[N]===v)return N;N++}return-1}function E(b){return Array.prototype.slice.call(b,0)}function H(b,v,R){for(var N=[],K=[],$=0;$<b.length;){var ye=v?b[$][v]:b[$];M(K,ye)<0&&N.push(b[$]),K[$]=ye,$++}return R&&(v?N=N.sort(function(bt,Ht){return bt[v]>Ht[v]}):N=N.sort()),N}function P(b,v){for(var R,N,K=v[0].toUpperCase()+v.slice(1),$=0;$<g.length;){if(R=g[$],N=R?R+K:v,N in b)return N;$++}return s}var z=1;function re(){return z++}function ue(b){var v=b.ownerDocument||b;return v.defaultView||v.parentWindow||e}var ie=/mobile|tablet|ip(ad|hone|od)|android/i,ce="ontouchstart"in e,x=P(e,"PointerEvent")!==s,S=ce&&ie.test(navigator.userAgent),w="touch",T="pen",Y="mouse",Q="kinect",_=25,D=1,ge=2,te=4,he=8,ae=1,Be=2,Ge=4,pe=8,at=16,Ie=Be|Ge,Ze=pe|at,Vt=Ie|Ze,et=["x","y"],tt=["clientX","clientY"];function Ue(b,v){var R=this;this.manager=b,this.callback=v,this.element=b.element,this.target=b.options.inputTarget,this.domHandler=function(N){B(b.options.enable,[b])&&R.handler(N)},this.init()}Ue.prototype={handler:function(){},init:function(){this.evEl&&y(this.element,this.evEl,this.domHandler),this.evTarget&&y(this.target,this.evTarget,this.domHandler),this.evWin&&y(ue(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&U(this.element,this.evEl,this.domHandler),this.evTarget&&U(this.target,this.evTarget,this.domHandler),this.evWin&&U(ue(this.element),this.evWin,this.domHandler)}};function ve(b){var v,R=b.options.inputClass;return R?v=R:x?v=Nn:S?v=le:ce?v=zt:v=Dt,new v(b,Xe)}function Xe(b,v,R){var N=R.pointers.length,K=R.changedPointers.length,$=v&D&&N-K===0,ye=v&(te|he)&&N-K===0;R.isFirst=!!$,R.isFinal=!!ye,$&&(b.session={}),R.eventType=v,Je(b,R),b.emit("hammer.input",R),b.recognize(R),b.session.prevInput=R}function Je(b,v){var R=b.session,N=v.pointers,K=N.length;R.firstInput||(R.firstInput=Pi(v)),K>1&&!R.firstMultiple?R.firstMultiple=Pi(v):K===1&&(R.firstMultiple=!1);var $=R.firstInput,ye=R.firstMultiple,dt=ye?ye.center:$.center,bt=v.center=It(N);v.timeStamp=l(),v.deltaTime=v.timeStamp-$.timeStamp,v.angle=Wn(dt,bt),v.distance=gt(dt,bt),_t(R,v),v.offsetDirection=xn(v.deltaX,v.deltaY);var Ht=Fe(v.deltaTime,v.deltaX,v.deltaY);v.overallVelocityX=Ht.x,v.overallVelocityY=Ht.y,v.overallVelocity=I(Ht.x)>I(Ht.y)?Ht.x:Ht.y,v.scale=ye?sr(ye.pointers,N):1,v.rotation=ye?wn(ye.pointers,N):0,v.maxPointers=R.prevInput?v.pointers.length>R.prevInput.maxPointers?v.pointers.length:R.prevInput.maxPointers:v.pointers.length,Ut(R,v);var jn=b.element;V(v.srcEvent.target,jn)&&(jn=v.srcEvent.target),v.target=jn}function _t(b,v){var R=v.center,N=b.offsetDelta||{},K=b.prevDelta||{},$=b.prevInput||{};(v.eventType===D||$.eventType===te)&&(K=b.prevDelta={x:$.deltaX||0,y:$.deltaY||0},N=b.offsetDelta={x:R.x,y:R.y}),v.deltaX=K.x+(R.x-N.x),v.deltaY=K.y+(R.y-N.y)}function Ut(b,v){var R=b.lastInterval||v,N=v.timeStamp-R.timeStamp,K,$,ye,dt;if(v.eventType!=he&&(N>_||R.velocity===s)){var bt=v.deltaX-R.deltaX,Ht=v.deltaY-R.deltaY,jn=Fe(N,bt,Ht);$=jn.x,ye=jn.y,K=I(jn.x)>I(jn.y)?jn.x:jn.y,dt=xn(bt,Ht),b.lastInterval=v}else K=R.velocity,$=R.velocityX,ye=R.velocityY,dt=R.direction;v.velocity=K,v.velocityX=$,v.velocityY=ye,v.direction=dt}function Pi(b){for(var v=[],R=0;R<b.pointers.length;)v[R]={clientX:a(b.pointers[R].clientX),clientY:a(b.pointers[R].clientY)},R++;return{timeStamp:l(),pointers:v,center:It(v),deltaX:b.deltaX,deltaY:b.deltaY}}function It(b){var v=b.length;if(v===1)return{x:a(b[0].clientX),y:a(b[0].clientY)};for(var R=0,N=0,K=0;K<v;)R+=b[K].clientX,N+=b[K].clientY,K++;return{x:a(R/v),y:a(N/v)}}function Fe(b,v,R){return{x:v/b||0,y:R/b||0}}function xn(b,v){return b===v?ae:I(b)>=I(v)?b<0?Be:Ge:v<0?pe:at}function gt(b,v,R){R||(R=et);var N=v[R[0]]-b[R[0]],K=v[R[1]]-b[R[1]];return Math.sqrt(N*N+K*K)}function Wn(b,v,R){R||(R=et);var N=v[R[0]]-b[R[0]],K=v[R[1]]-b[R[1]];return Math.atan2(K,N)*180/Math.PI}function wn(b,v){return Wn(v[1],v[0],tt)+Wn(b[1],b[0],tt)}function sr(b,v){return gt(v[0],v[1],tt)/gt(b[0],b[1],tt)}var gr={mousedown:D,mousemove:ge,mouseup:te},or="mousedown",de="mousemove mouseup";function Dt(){this.evEl=or,this.evWin=de,this.pressed=!1,Ue.apply(this,arguments)}f(Dt,Ue,{handler:function(v){var R=gr[v.type];R&D&&v.button===0&&(this.pressed=!0),R&ge&&v.which!==1&&(R=te),this.pressed&&(R&te&&(this.pressed=!1),this.callback(this.manager,R,{pointers:[v],changedPointers:[v],pointerType:Y,srcEvent:v}))}});var rr={pointerdown:D,pointermove:ge,pointerup:te,pointercancel:he,pointerout:he},Ks={2:w,3:T,4:Y,5:Q},mn="pointerdown",Ls="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(mn="MSPointerDown",Ls="MSPointerMove MSPointerUp MSPointerCancel");function Nn(){this.evEl=mn,this.evWin=Ls,Ue.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}f(Nn,Ue,{handler:function(v){var R=this.store,N=!1,K=v.type.toLowerCase().replace("ms",""),$=rr[K],ye=Ks[v.pointerType]||v.pointerType,dt=ye==w,bt=M(R,v.pointerId,"pointerId");$&D&&(v.button===0||dt)?bt<0&&(R.push(v),bt=R.length-1):$&(te|he)&&(N=!0),!(bt<0)&&(R[bt]=v,this.callback(this.manager,$,{pointers:R,changedPointers:[v],pointerType:ye,srcEvent:v}),N&&R.splice(bt,1))}});var mi={touchstart:D,touchmove:ge,touchend:te,touchcancel:he},ar="touchstart",Jc="touchstart touchmove touchend touchcancel";function Ir(){this.evTarget=ar,this.evWin=Jc,this.started=!1,Ue.apply(this,arguments)}f(Ir,Ue,{handler:function(v){var R=mi[v.type];if(R===D&&(this.started=!0),!!this.started){var N=Dc.call(this,v,R);R&(te|he)&&N[0].length-N[1].length===0&&(this.started=!1),this.callback(this.manager,R,{pointers:N[0],changedPointers:N[1],pointerType:w,srcEvent:v})}}});function Dc(b,v){var R=E(b.touches),N=E(b.changedTouches);return v&(te|he)&&(R=H(R.concat(N),"identifier",!0)),[R,N]}var zc={touchstart:D,touchmove:ge,touchend:te,touchcancel:he},oe="touchstart touchmove touchend touchcancel";function le(){this.evTarget=oe,this.targetIds={},Ue.apply(this,arguments)}f(le,Ue,{handler:function(v){var R=zc[v.type],N=De.call(this,v,R);!N||this.callback(this.manager,R,{pointers:N[0],changedPointers:N[1],pointerType:w,srcEvent:v})}});function De(b,v){var R=E(b.touches),N=this.targetIds;if(v&(D|ge)&&R.length===1)return N[R[0].identifier]=!0,[R,R];var K,$,ye=E(b.changedTouches),dt=[],bt=this.target;if($=R.filter(function(Ht){return V(Ht.target,bt)}),v===D)for(K=0;K<$.length;)N[$[K].identifier]=!0,K++;for(K=0;K<ye.length;)N[ye[K].identifier]&&dt.push(ye[K]),v&(te|he)&&delete N[ye[K].identifier],K++;if(!!dt.length)return[H($.concat(dt),"identifier",!0),dt]}var qe=2500,We=25;function zt(){Ue.apply(this,arguments);var b=p(this.handler,this);this.touch=new le(this.manager,b),this.mouse=new Dt(this.manager,b),this.primaryTouch=null,this.lastTouches=[]}f(zt,Ue,{handler:function(v,R,N){var K=N.pointerType==w,$=N.pointerType==Y;if(!($&&N.sourceCapabilities&&N.sourceCapabilities.firesTouchEvents)){if(K)Ye.call(this,R,N);else if($&&Ji.call(this,N))return;this.callback(v,R,N)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ye(b,v){b&D?(this.primaryTouch=v.changedPointers[0].identifier,xg.call(this,v)):b&(te|he)&&xg.call(this,v)}function xg(b){var v=b.changedPointers[0];if(v.identifier===this.primaryTouch){var R={x:v.clientX,y:v.clientY};this.lastTouches.push(R);var N=this.lastTouches,K=function(){var $=N.indexOf(R);$>-1&&N.splice($,1)};setTimeout(K,qe)}}function Ji(b){for(var v=b.srcEvent.clientX,R=b.srcEvent.clientY,N=0;N<this.lastTouches.length;N++){var K=this.lastTouches[N],$=Math.abs(v-K.x),ye=Math.abs(R-K.y);if($<=We&&ye<=We)return!0}return!1}var Wg=P(o.style,"touchAction"),wg=Wg!==s,ZI="compute",RI="auto",fi="manipulation",ot="none",Di="pan-x",Ms="pan-y",Tn=OF();function lr(b,v){this.manager=b,this.set(v)}lr.prototype={set:function(b){b==ZI&&(b=this.compute()),wg&&this.manager.element.style&&Tn[b]&&(this.manager.element.style[Wg]=b),this.actions=b.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var b=[];return A(this.manager.recognizers,function(v){B(v.options.enable,[v])&&(b=b.concat(v.getTouchAction()))}),Oc(b.join(" "))},preventDefaults:function(b){var v=b.srcEvent,R=b.offsetDirection;if(this.manager.session.prevented){v.preventDefault();return}var N=this.actions,K=F(N,ot)&&!Tn[ot],$=F(N,Ms)&&!Tn[Ms],ye=F(N,Di)&&!Tn[Di];if(K){var dt=b.pointers.length===1,bt=b.distance<2,Ht=b.deltaTime<250;if(dt&&bt&&Ht)return}if(!(ye&&$)&&(K||$&&R&Ie||ye&&R&Ze))return this.preventSrc(v)},preventSrc:function(b){this.manager.session.prevented=!0,b.preventDefault()}};function Oc(b){if(F(b,ot))return ot;var v=F(b,Di),R=F(b,Ms);return v&&R?ot:v||R?v?Di:Ms:F(b,fi)?fi:RI}function OF(){if(!wg)return!1;var b={},v=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(R){b[R]=v?e.CSS.supports("touch-action",R):!0}),b}var FI=1,fn=2,Ng=4,zi=8,pi=zi,Cr=16,On=32;function Bi(b){this.options=h({},this.defaults,b||{}),this.id=re(),this.manager=null,this.options.enable=G(this.options.enable,!0),this.state=FI,this.simultaneous={},this.requireFail=[]}Bi.prototype={defaults:{},set:function(b){return h(this.options,b),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(b){if(c(b,"recognizeWith",this))return this;var v=this.simultaneous;return b=SI(b,this),v[b.id]||(v[b.id]=b,b.recognizeWith(this)),this},dropRecognizeWith:function(b){return c(b,"dropRecognizeWith",this)?this:(b=SI(b,this),delete this.simultaneous[b.id],this)},requireFailure:function(b){if(c(b,"requireFailure",this))return this;var v=this.requireFail;return b=SI(b,this),M(v,b)===-1&&(v.push(b),b.requireFailure(this)),this},dropRequireFailure:function(b){if(c(b,"dropRequireFailure",this))return this;b=SI(b,this);var v=M(this.requireFail,b);return v>-1&&this.requireFail.splice(v,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(b){return!!this.simultaneous[b.id]},emit:function(b){var v=this,R=this.state;function N(K){v.manager.emit(K,b)}R<zi&&N(v.options.event+tf(R)),N(v.options.event),b.additionalEvent&&N(b.additionalEvent),R>=zi&&N(v.options.event+tf(R))},tryEmit:function(b){if(this.canEmit())return this.emit(b);this.state=On},canEmit:function(){for(var b=0;b<this.requireFail.length;){if(!(this.requireFail[b].state&(On|FI)))return!1;b++}return!0},recognize:function(b){var v=h({},b);if(!B(this.options.enable,[this,v])){this.reset(),this.state=On;return}this.state&(pi|Cr|On)&&(this.state=FI),this.state=this.process(v),this.state&(fn|Ng|zi|Cr)&&this.tryEmit(v)},process:function(b){},getTouchAction:function(){},reset:function(){}};function tf(b){return b&Cr?"cancel":b&zi?"end":b&Ng?"move":b&fn?"start":""}function nf(b){return b==at?"down":b==pe?"up":b==Be?"left":b==Ge?"right":""}function SI(b,v){var R=v.manager;return R?R.get(b):b}function En(){Bi.apply(this,arguments)}f(En,Bi,{defaults:{pointers:1},attrTest:function(b){var v=this.options.pointers;return v===0||b.pointers.length===v},process:function(b){var v=this.state,R=b.eventType,N=v&(fn|Ng),K=this.attrTest(b);return N&&(R&he||!K)?v|Cr:N||K?R&te?v|zi:v&fn?v|Ng:fn:On}});function VI(){En.apply(this,arguments),this.pX=null,this.pY=null}f(VI,En,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vt},getTouchAction:function(){var b=this.options.direction,v=[];return b&Ie&&v.push(Ms),b&Ze&&v.push(Di),v},directionTest:function(b){var v=this.options,R=!0,N=b.distance,K=b.direction,$=b.deltaX,ye=b.deltaY;return K&v.direction||(v.direction&Ie?(K=$===0?ae:$<0?Be:Ge,R=$!=this.pX,N=Math.abs(b.deltaX)):(K=ye===0?ae:ye<0?pe:at,R=ye!=this.pY,N=Math.abs(b.deltaY))),b.direction=K,R&&N>v.threshold&&K&v.direction},attrTest:function(b){return En.prototype.attrTest.call(this,b)&&(this.state&fn||!(this.state&fn)&&this.directionTest(b))},emit:function(b){this.pX=b.deltaX,this.pY=b.deltaY;var v=nf(b.direction);v&&(b.additionalEvent=this.options.event+v),this._super.emit.call(this,b)}});function jc(){En.apply(this,arguments)}f(jc,En,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.scale-1)>this.options.threshold||this.state&fn)},emit:function(b){if(b.scale!==1){var v=b.scale<1?"in":"out";b.additionalEvent=this.options.event+v}this._super.emit.call(this,b)}});function qc(){Bi.apply(this,arguments),this._timer=null,this._input=null}f(qc,Bi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[RI]},process:function(b){var v=this.options,R=b.pointers.length===v.pointers,N=b.distance<v.threshold,K=b.deltaTime>v.time;if(this._input=b,!N||!R||b.eventType&(te|he)&&!K)this.reset();else if(b.eventType&D)this.reset(),this._timer=C(function(){this.state=pi,this.tryEmit()},v.time,this);else if(b.eventType&te)return pi;return On},reset:function(){clearTimeout(this._timer)},emit:function(b){this.state===pi&&(b&&b.eventType&te?this.manager.emit(this.options.event+"up",b):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}});function $c(){En.apply(this,arguments)}f($c,En,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ot]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.rotation)>this.options.threshold||this.state&fn)}});function eA(){En.apply(this,arguments)}f(eA,En,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ie|Ze,pointers:1},getTouchAction:function(){return VI.prototype.getTouchAction.call(this)},attrTest:function(b){var v=this.options.direction,R;return v&(Ie|Ze)?R=b.overallVelocity:v&Ie?R=b.overallVelocityX:v&Ze&&(R=b.overallVelocityY),this._super.attrTest.call(this,b)&&v&b.offsetDirection&&b.distance>this.options.threshold&&b.maxPointers==this.options.pointers&&I(R)>this.options.velocity&&b.eventType&te},emit:function(b){var v=nf(b.offsetDirection);v&&this.manager.emit(this.options.event+v,b),this.manager.emit(this.options.event,b)}});function UI(){Bi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}f(UI,Bi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fi]},process:function(b){var v=this.options,R=b.pointers.length===v.pointers,N=b.distance<v.threshold,K=b.deltaTime<v.time;if(this.reset(),b.eventType&D&&this.count===0)return this.failTimeout();if(N&&K&&R){if(b.eventType!=te)return this.failTimeout();var $=this.pTime?b.timeStamp-this.pTime<v.interval:!0,ye=!this.pCenter||gt(this.pCenter,b.center)<v.posThreshold;this.pTime=b.timeStamp,this.pCenter=b.center,!ye||!$?this.count=1:this.count+=1,this._input=b;var dt=this.count%v.taps;if(dt===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=pi,this.tryEmit()},v.interval,this),fn):pi}return On},failTimeout:function(){return this._timer=C(function(){this.state=On},this.options.interval,this),On},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function bi(b,v){return v=v||{},v.recognizers=G(v.recognizers,bi.defaults.preset),new tA(b,v)}bi.VERSION="2.0.7",bi.defaults={domEvents:!1,touchAction:ZI,enable:!0,inputTarget:null,inputClass:null,preset:[[$c,{enable:!1}],[jc,{enable:!1},["rotate"]],[eA,{direction:Ie}],[VI,{direction:Ie},["swipe"]],[UI],[UI,{event:"doubletap",taps:2},["tap"]],[qc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var jF=1,sf=2;function tA(b,v){this.options=h({},bi.defaults,v||{}),this.options.inputTarget=this.options.inputTarget||b,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=b,this.input=ve(this),this.touchAction=new lr(this,this.options.touchAction),gf(this,!0),A(this.options.recognizers,function(R){var N=this.add(new R[0](R[1]));R[2]&&N.recognizeWith(R[2]),R[3]&&N.requireFailure(R[3])},this)}tA.prototype={set:function(b){return h(this.options,b),b.touchAction&&this.touchAction.update(),b.inputTarget&&(this.input.destroy(),this.input.target=b.inputTarget,this.input.init()),this},stop:function(b){this.session.stopped=b?sf:jF},recognize:function(b){var v=this.session;if(!v.stopped){this.touchAction.preventDefaults(b);var R,N=this.recognizers,K=v.curRecognizer;(!K||K&&K.state&pi)&&(K=v.curRecognizer=null);for(var $=0;$<N.length;)R=N[$],v.stopped!==sf&&(!K||R==K||R.canRecognizeWith(K))?R.recognize(b):R.reset(),!K&&R.state&(fn|Ng|zi)&&(K=v.curRecognizer=R),$++}},get:function(b){if(b instanceof Bi)return b;for(var v=this.recognizers,R=0;R<v.length;R++)if(v[R].options.event==b)return v[R];return null},add:function(b){if(c(b,"add",this))return this;var v=this.get(b.options.event);return v&&this.remove(v),this.recognizers.push(b),b.manager=this,this.touchAction.update(),b},remove:function(b){if(c(b,"remove",this))return this;if(b=this.get(b),b){var v=this.recognizers,R=M(v,b);R!==-1&&(v.splice(R,1),this.touchAction.update())}return this},on:function(b,v){if(b!==s&&v!==s){var R=this.handlers;return A(W(b),function(N){R[N]=R[N]||[],R[N].push(v)}),this}},off:function(b,v){if(b!==s){var R=this.handlers;return A(W(b),function(N){v?R[N]&&R[N].splice(M(R[N],v),1):delete R[N]}),this}},emit:function(b,v){this.options.domEvents&&qF(b,v);var R=this.handlers[b]&&this.handlers[b].slice();if(!(!R||!R.length)){v.type=b,v.preventDefault=function(){v.srcEvent.preventDefault()};for(var N=0;N<R.length;)R[N](v),N++}},destroy:function(){this.element&&gf(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function gf(b,v){var R=b.element;if(!!R.style){var N;A(b.options.cssProps,function(K,$){N=P(R.style,$),v?(b.oldCssProps[N]=R.style[N],R.style[N]=K):R.style[N]=b.oldCssProps[N]||""}),v||(b.oldCssProps={})}}function qF(b,v){var R=n.createEvent("Event");R.initEvent(b,!0,!0),R.gesture=v,v.target.dispatchEvent(R)}h(bi,{INPUT_START:D,INPUT_MOVE:ge,INPUT_END:te,INPUT_CANCEL:he,STATE_POSSIBLE:FI,STATE_BEGAN:fn,STATE_CHANGED:Ng,STATE_ENDED:zi,STATE_RECOGNIZED:pi,STATE_CANCELLED:Cr,STATE_FAILED:On,DIRECTION_NONE:ae,DIRECTION_LEFT:Be,DIRECTION_RIGHT:Ge,DIRECTION_UP:pe,DIRECTION_DOWN:at,DIRECTION_HORIZONTAL:Ie,DIRECTION_VERTICAL:Ze,DIRECTION_ALL:Vt,Manager:tA,Input:Ue,TouchAction:lr,TouchInput:le,MouseInput:Dt,PointerEventInput:Nn,TouchMouseInput:zt,SingleTouchInput:Ir,Recognizer:Bi,AttrRecognizer:En,Tap:UI,Pan:VI,Swipe:eA,Pinch:jc,Rotate:$c,Press:qc,on:y,off:U,each:A,merge:m,extend:u,assign:h,inherit:f,bindFn:p,prefixed:P});var $F=typeof e<"u"?e:typeof self<"u"?self:{};$F.Hammer=bi,typeof s=="function"&&s.amd?s(function(){return bi}):t.exports?t.exports=bi:e[i]=bi})(window,document,"Hammer")})(N2);const sn=N2.exports,T2=1,E2=2,Du=4,m_={mousedown:T2,mousemove:E2,mouseup:Du};function f_(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function p_(t){const e=t.prototype.handler;t.prototype.handler=function(i){const s=this.store;i.button>0&&i.type==="pointerdown"&&(f_(s,g=>g.pointerId===i.pointerId)||s.push(i)),e.call(this,i)}}function B_(t){t.prototype.handler=function(n){let i=m_[n.type];i&T2&&n.button>=0&&(this.pressed=!0),i&E2&&n.which===0&&(i=Du),this.pressed&&(i&Du&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}p_(sn.PointerEventInput);B_(sn.MouseInput);const b_=sn.Manager,y_=sn?[[sn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[sn.Rotate,{enable:!1}],[sn.Pinch,{enable:!1}],[sn.Swipe,{enable:!1}],[sn.Pan,{threshold:0,enable:!1}],[sn.Press,{enable:!1}],[sn.Tap,{event:"doubletap",taps:2,enable:!1}],[sn.Tap,{event:"anytap",enable:!1}],[sn.Tap,{enable:!1}]]:null,Sb={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},v_={doubletap:["tap"]},G_={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},tm={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Z_={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Vb={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},R_=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ro=typeof window<"u"?window:global;let Q2=!1;try{const t={get passive(){return Q2=!0,!0}};ro.addEventListener("test",t,t),ro.removeEventListener("test",t,t)}catch{}const F_=R_.indexOf("firefox")!==-1,{WHEEL_EVENTS:S_}=tm,Ub="wheel",xb=4.000244140625,V_=40,U_=.25;class x_{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.events=S_.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,Q2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Ub&&(this.options.enable=n)}handleEvent(e){if(!this.options.enable)return;let n=e.deltaY;ro.WheelEvent&&(F_&&e.deltaMode===ro.WheelEvent.DOM_DELTA_PIXEL&&(n/=ro.devicePixelRatio),e.deltaMode===ro.WheelEvent.DOM_DELTA_LINE&&(n*=V_));const i={x:e.clientX,y:e.clientY};n!==0&&n%xb===0&&(n=Math.floor(n/xb)),e.shiftKey&&n&&(n=n*U_),this._onWheel(e,-n,i)}_onWheel(e,n,i){this.callback({type:Ub,center:i,delta:n,srcEvent:e,pointerType:"mouse",target:e.target})}}const{MOUSE_EVENTS:W_}=tm,Wb="pointermove",wb="pointerover",Nb="pointerout",Tb="pointerleave";class w_{constructor(e,n,i={}){this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=W_.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Wb&&(this.enableMoveEvent=n),e===wb&&(this.enableOverEvent=n),e===Nb&&(this.enableOutEvent=n),e===Tb&&(this.enableLeaveEvent=n)}handleEvent(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this.callback({type:wb,srcEvent:e,pointerType:"mouse",target:e.target})}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this.callback({type:Nb,srcEvent:e,pointerType:"mouse",target:e.target})}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this.callback({type:Tb,srcEvent:e,pointerType:"mouse",target:e.target})}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this.callback({type:Wb,srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1;break}}}const{KEY_EVENTS:N_}=tm,Eb="keydown",Qb="keyup";class T_{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=N_.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=i.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Eb&&(this.enableDownEvent=n),e===Qb&&(this.enableUpEvent=n)}handleEvent(e){const n=e.target||e.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&e.type==="keydown"&&this.callback({type:Eb,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&e.type==="keyup"&&this.callback({type:Qb,srcEvent:e,key:e.key,target:e.target}))}}const Xb="contextmenu";class E_{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Xb&&(this.options.enable=n)}handleEvent(e){!this.options.enable||this.callback({type:Xb,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const zu=1,WC=2,Ou=4,Q_={pointerdown:zu,pointermove:WC,pointerup:Ou,mousedown:zu,mousemove:WC,mouseup:Ou},X_=1,Y_=2,__=3,H_=0,k_=1,K_=2,L_=1,M_=2,P_=4;function J_(t){const e=Q_[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:s}=t.srcEvent;let g=!1,o=!1,r=!1;return e===Ou||e===WC&&!Number.isFinite(n)?(g=s===X_,o=s===Y_,r=s===__):e===WC?(g=Boolean(n&L_),o=Boolean(n&P_),r=Boolean(n&M_)):e===zu&&(g=i===H_,o=i===k_,r=i===K_),{leftButton:g,middleButton:o,rightButton:r}}function D_(t,e){const{srcEvent:n}=t;if(!t.center&&!Number.isFinite(n.clientX))return null;const i=t.center||{x:n.clientX,y:n.clientY},s=e.getBoundingClientRect(),g=s.width/e.offsetWidth||1,o=s.height/e.offsetHeight||1,r={x:(i.x-s.left-e.clientLeft)/g,y:(i.y-s.top-e.clientTop)/o};return{center:i,offsetCenter:r}}const Yb={srcElement:"root",priority:0};class z_{constructor(e){this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}isEmpty(){return!this._active}add(e,n,i,s=!1,g=!1){const{handlers:o,handlersByElement:r}=this;i&&(typeof i!="object"||i.addEventListener)&&(i={srcElement:i}),i=i?Object.assign({},Yb,i):Yb;let a=r.get(i.srcElement);a||(a=[],r.set(i.srcElement,a));const I={type:e,handler:n,srcElement:i.srcElement,priority:i.priority};s&&(I.once=!0),g&&(I.passive=!0),o.push(I),this._active=this._active||!I.passive;let l=a.length-1;for(;l>=0&&!(a[l].priority>=I.priority);)l--;a.splice(l+1,0,I)}remove(e,n){const{handlers:i,handlersByElement:s}=this;for(let g=i.length-1;g>=0;g--){const o=i[g];if(o.type===e&&o.handler===n){i.splice(g,1);const r=s.get(o.srcElement);r.splice(r.indexOf(o),1),r.length===0&&s.delete(o.srcElement)}}this._active=i.some(g=>!g.passive)}handleEvent(e){if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let s=!1;const g=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},r=[];for(let a=0;a<i.length;a++){const{type:I,handler:l,once:C}=i[a];if(l(Object.assign({},e,{type:I,stopPropagation:g,stopImmediatePropagation:o})),C&&r.push(i[a]),s)break}for(let a=0;a<r.length;a++){const{type:I,handler:l}=r[a];this.remove(I,l)}}}_normalizeEvent(e){const n=this.eventManager.element;return Object.assign({},e,J_(e),D_(e,n),{handled:!1,rootElement:n})}}const O_={events:null,recognizers:null,recognizerOptions:{},Manager:b_,touchAction:"none",tabIndex:0};class j_{constructor(e=null,n={}){this.options=Object.assign({},O_,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);const{events:i}=n;i&&this.on(i)}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||y_}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Sb).forEach(s=>{const g=this.manager.get(s);g&&Sb[s].forEach(o=>{g.recognizeWith(o)})});for(const s in n.recognizerOptions){const g=this.manager.get(s);if(g){const o=n.recognizerOptions[s];delete o.enable,g.set(o)}}this.wheelInput=new x_(e,this._onOtherEvent,{enable:!1}),this.moveInput=new w_(e,this._onOtherEvent,{enable:!1}),this.keyInput=new T_(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new E_(e,this._onOtherEvent,{enable:!1});for(const[s,g]of this.events)g.isEmpty()||(this._toggleRecognizer(g.recognizerName,!0),this.manager.on(s,g.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const s=i.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const g=v_[e];g&&!this.options.recognizers&&g.forEach(o=>{const r=i.get(o);n?(r.requireFailure(e),s.dropRequireFailure(o)):r.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,s,g){if(typeof e!="string"){i=n;for(const l in e)this._addEventHandler(l,e[l],i,s,g);return}const{manager:o,events:r}=this,a=Vb[e]||e;let I=r.get(a);I||(I=new z_(this),r.set(a,I),I.recognizerName=Z_[a]||a,o&&o.on(a,I.handleEvent)),I.add(e,n,i,s,g),I.isEmpty()||this._toggleRecognizer(I.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,s=Vb[e]||e,g=i.get(s);if(!!g&&(g.remove(e,n),g.isEmpty())){const{recognizerName:o}=g;let r=!1;for(const a of i.values())if(a.recognizerName===o&&!a.isEmpty()){r=!0;break}r||this._toggleRecognizer(o,!1)}}_onBasicInput(e){const{srcEvent:n}=e,i=G_[n.type];i&&this.manager.emit(i,e)}_onOtherEvent(e){this.manager.emit(e.type,e)}}function Ds(){}const q_=t=>{let{isDragging:e}=t;return e?"grabbing":"grab"};function $_(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(v2)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,eventRecognizerOptions:t.object,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onInteractionStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}}const X2={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:Ds,onResize:Ds,onViewStateChange:Ds,onInteractionStateChange:Ds,onBeforeRender:Ds,onAfterRender:Ds,onLoad:Ds,onError:(t,e)=>me.error(t)(),_onMetrics:null,getCursor:q_,debug:!1,drawPickingColors:!1};class jo{constructor(e){e={...X2,...e},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&me.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),ke.exports.getBrowser()==="IE"&&me.warn("IE 11 support will be deprecated in v8.0")(),e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new vc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Xo.setProps(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),!this.props.canvas&&!this.props.gl&&this.canvas&&(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&me.removed("onLayerHover","onHover")(),"onLayerClick"in e&&me.removed("onLayerClick","onClick")(),e.initialViewState&&!Oo(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),g=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||s||g||o,n}redraw(e){if(!this.layerManager)return;const n=e||this.needsRedraw({clearRedrawFlags:!0});!n||(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const g=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,...i});return s.get(n).timeEnd(),g}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Cn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;let{width:n,height:i}=e;(n||n===0)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.width=n),(i||i===0)&&(i=Number.isFinite(i)?"".concat(i,"px"):i,this.canvas.style.position="absolute",this.canvas.style.height=i)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:e,height:n}=this;this.viewManager.setProps({width:e,height:n}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:e}=this;if(!e)return!1;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;return n!==this.width||i!==this.height?(this.width=n,this.height=i,!0):!1}_createAnimationLoop(e){const{width:n,height:i,gl:s,glOptions:g,debug:o,onError:r,onBeforeRender:a,onAfterRender:I,useDevicePixels:l,autoResizeDrawingBuffer:C}=e;return new x5({width:n,height:i,useDevicePixels:l,autoResizeDrawingBuffer:C,autoResizeViewport:!1,gl:s,onCreateContext:c=>U1({...g,...c,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:c=>this._setGLContext(c.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:I,onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new U2({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_onPointerMove(e){const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e,n.mode="hover"}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.interactiveState.isHovering=n.length>0;let s=i,g=!1;for(const o of n)s=o,g=o.layer.onHover(o,e.event);if(!g&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Kh(e,{enable:!0,copyState:!0})),this.tooltip=new h_(this.canvas),Qi(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new m2;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new j_(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in cb)this.eventManager.on(s,this._onEvent);this.viewManager=new MY({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new LY(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new i_,this.deckRenderer=new a_(e),this.deckPicker=new d_(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Qi(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),me.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.interactiveState.isDragging=e.isDragging,this.props.onInteractionStateChange(e)}_onEvent(e){const n=cb[e.type],i=e.offsetCenter;if(!n||!i)return;const s=this.layerManager.getLayers(),g=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=g,r=o&&(o[n.handler]||o.props[n.handler]),a=this.props[n.handler];let I=!1;r&&(I=r.call(o,g,e)),!I&&a&&a(g,e)}_onPointerDown(e){const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=rg.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}jo.getPropTypes=$_;jo.defaultProps=X2;jo.VERSION=Xw.VERSION;class od{constructor(e,n){this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:s}=n;let g=i;if(i&&i.length!==s){g=new Float32Array(s);const o=n.elementOffset||0;for(let r=0;r<s;++r)g[r]=i[o+r]}return g}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function e4(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Hl(t){return t.stride||t.size*t.bytesPerElement}function Y2(t,e){e.offset&&me.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Hl(t),i="vertexOffset"in e?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,g=i*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:g,stride:n}}function t4(t,e){const n=Y2(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class n4{constructor(e,n){this.gl=e,this.id=n.id,this.size=n.size;const i=n.logicalType||n.type,s=i===5130;let{defaultValue:g}=n;g=Number.isFinite(g)?[g]:g||new Array(this.size).fill(0),n.defaultValue=g;let o=i;s?o=5126:!o&&n.isIndexed?o=e&&Yu(e,Te.ELEMENT_INDEX_UINT32)?5125:5123:o||(o=5126),n.logicalType=i,n.type=o;let r=e4(i||o||5126);this.shaderAttributes={},this.doublePrecision=s,s&&n.fp64===!1&&(r=Float32Array),n.bytesPerElement=r.BYTES_PER_ELEMENT,this.defaultType=r,this.value=null,this.settings=n,this.state={externalBuffer:null,bufferAccessor:n,allocatedValue:null,constant:!1},this._buffer=null,this.setData(n)}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new we(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Hl(e):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Xo.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},s=this.value instanceof Float64Array,g=t4(this.getAccessor(),n||{});return i[e]=new od(this,g.high),i["".concat(e,"64Low")]=s?new od(this,g.low):new Float32Array(this.size),i}if(n){const i=Y2(this.getAccessor(),n);return{[e]:new od(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(e){const{state:n}=this;ArrayBuffer.isView(e)?e={value:e}:e instanceof we&&(e={buffer:e});const i={...this.settings,...e};if(n.bufferAccessor=i,e.constant){let s=e.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this._normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(e.buffer){const s=e.buffer;n.externalBuffer=s,n.constant=!1,this.value=e.value;const g=e.value instanceof Float64Array;i.type=e.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(g?2:1),i.stride=Hl(i)}else if(e.value){this._checkExternalBuffer(e);let s=e.value;n.externalBuffer=null,n.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=Hl(i);const{buffer:g,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=id(s,i));const r=s.byteLength+o+i.stride*2;g.byteLength<r&&g.reallocate(r),g.setAccessor(null),g.subData({data:s,offset:o}),i.type=e.type||g.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{value:n}=this,{startOffset:i=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?id(n,{size:this.size,startIndex:i,endIndex:s}):n.subarray(i,s),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let{numInstances:n,copy:i=!1}=e;const{state:s}=this,g=s.allocatedValue,o=Xo.allocate(g,n+1,{size:this.size,type:this.defaultType,copy:i});this.value=o;const{buffer:r,byteOffset:a}=this;return r.byteLength<o.byteLength+a&&(r.reallocate(o.byteLength+a),i&&g&&r.subData({data:g instanceof Float64Array?id(g,this):g,offset:a})),s.allocatedValue=o,s.constant=!1,s.externalBuffer=null,s.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!e.constant&&n){const i=this.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&me.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:s,size:g}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=s[0],n;switch(g){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=g;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:s[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==n[s])return!1;return!0}}const _b=[],Hb=[];function dI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,i=_b;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Hb.length=t.length,i=Hb):i=_b,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),s.index=e-1),{iterable:i,objectInfo:s}}function _2(t){return t&&t[Symbol.asyncIterator]}function H2(t,e){let{size:n,stride:i,offset:s,startIndices:g,nested:o}=e;const r=t.BYTES_PER_ELEMENT,a=i?i/r:n,I=s?s/r:0,l=Math.floor((t.length-I)/a);return(C,c)=>{let{index:A,target:d}=c;if(!g){const f=A*a+I;for(let p=0;p<n;p++)d[p]=t[f+p];return d}const h=g[A],u=g[A+1]||l;let m;if(o){m=new Array(u-h);for(let f=h;f<u;f++){const p=f*a+I;d=new Array(n);for(let B=0;B<n;B++)d[B]=t[p+B];m[f-h]=d}}else if(a===n)m=t.subarray(h*n+I,u*n+I);else{m=new t.constructor((u-h)*n);let f=0;for(let p=h;p<u;p++){const B=p*a+I;for(let G=0;G<n;G++)m[f++]=t[B+G]}}return m}}const i4=[],kl=[[0,1/0]];function s4(t,e){if(t===kl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let s=0;for(let g=0;g<i;g++){const o=t[g];o[1]<e[0]?(n.push(o),s=g+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(s,0,e),n}function rd(t){let{source:e,target:n,start:i=0,end:s,size:g,getData:o}=t;s=s||n.length;const r=e.length,a=s-i;if(r>a){n.set(e.subarray(0,a),i);return}if(n.set(e,i),!o)return;let I=r;for(;I<a;){const l=o(I,e);for(let C=0;C<g;C++)n[i+I]=l[C]||0,I++}}function g4(t){let{source:e,target:n,size:i,getData:s,sourceStartIndices:g,targetStartIndices:o}=t;if(!Array.isArray(o))return rd({source:e,target:n,size:i,getData:s}),n;let r=0,a=0;const I=s&&((C,c)=>s(C+a,c)),l=Math.min(g.length,o.length);for(let C=1;C<l;C++){const c=g[C]*i,A=o[C]*i;rd({source:e.subarray(r,c),target:n,start:a,end:A,size:i,getData:I}),r=c,a=A}return a<n.length&&rd({source:[],target:n,start:a,size:i,getData:I}),n}const o4={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function k2(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",{...o4[t.type],...e,...t}):null}function K2(t,e){return e.getBuffer()?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function L2(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function M2(t){t.push(t.shift())}function nm(t,e){const{doublePrecision:n,settings:i,value:s,size:g}=t,o=n&&s instanceof Float64Array?2:1;return(i.noAlloc?s.length:e*g)*o}function P2(t){let{buffer:e,numInstances:n,attribute:i,fromLength:s,fromStartIndices:g,getData:o=f=>f}=t;const r=i.doublePrecision&&i.value instanceof Float64Array?2:1,a=i.size*r,I=i.byteOffset,l=i.startIndices,C=g&&l,c=nm(i,n),A=i.state.constant;if(!C&&s>=c)return;const d=A?i.value:i.getBuffer().getData({srcByteOffset:I});if(i.settings.normalized&&!A){const f=o;o=(p,B)=>i._normalizeConstant(f(p,B))}const h=A?(f,p)=>o(d,p):(f,p)=>o(d.subarray(f,f+a),p),u=e.getData({length:s}),m=new Float32Array(c);g4({source:u,target:m,sourceStartIndices:g,targetStartIndices:l,size:a,getData:h}),e.byteLength<m.byteLength+I&&e.reallocate(m.byteLength+I),e.subData({data:m,offset:I})}class im extends n4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n);const{transition:i=!1,noAlloc:s=!1,update:g=null,accessor:o=null,transform:r=null,startIndices:a=null}=n;Object.assign(this.settings,{transition:i,noAlloc:s,update:g||o&&this._autoUpdater,accessor:o,transform:r}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:kl,startIndices:a}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,s=Array.isArray(n)?e[n.find(g=>e[g])]:e[n];return k2(s,i)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,n=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:s=1/0}=n;this.state.updateRanges=s4(this.state.updateRanges,[i,s])}else this.state.updateRanges=kl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=i4}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}update(e){this.setData(e)}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate({numInstances:e,copy:n.updateRanges!==kl}),!0):!1}updateBuffer(e){let{numInstances:n,data:i,props:s,context:g}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:r,noAlloc:a}}=this;let I=!0;if(r){for(const[l,C]of o)r.call(g,this,{data:i,startRow:l,endRow:C,props:s,numInstances:n});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,C]of o){const c=Number.isFinite(l)?this.getVertexOffset(l):0,A=Number.isFinite(C)?this.getVertexOffset(C):a||!Number.isFinite(n)?this.value.length:n*this.size;super.updateSubBuffer({startOffset:c,endOffset:A})}this._checkAttributeArray()}else I=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),I}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),ArrayBuffer.isView(e)&&(e={value:e}),s.transform||n!==this.startIndices){Cn(ArrayBuffer.isView(e.value),"invalid ".concat(s.accessor));const o=e.size&&e.size!==this.size;return i.binaryAccessor=H2(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:n,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,n){let{data:i,startRow:s,endRow:g,props:o,numInstances:r}=n;if(e.constant)return;const{settings:a,state:I,value:l,size:C,startIndices:c}=e,{accessor:A,transform:d}=a,h=I.binaryAccessor||(typeof A=="function"?A:o[A]);Cn(typeof h=="function",'accessor "'.concat(A,'" is not a function'));let u=e.getVertexOffset(s);const{iterable:m,objectInfo:f}=dI(i,s,g);for(const p of m){f.index++;let B=h(p,f);if(d&&(B=d.call(this,B)),c){const G=(f.index<c.length-1?c[f.index+1]:r)-c[f.index];if(B&&Array.isArray(B[0])){let y=u;for(const U of B)e._normalizeValue(U,l,y),y+=C}else B&&B.length>C?l.set(B,u):(e._normalizeValue(B,f.target,0),XY({target:l,source:f.target,start:u,count:G}));u+=G*C}else e._normalizeValue(B,l,u),u+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class r4{constructor(e){let{gl:n,attribute:i,timeline:s}=e;this.gl=n,this.type="interpolation",this.transition=new AI(s),this.attribute=i,this.attributeInTransition=new im(n,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=I4(n,i);const g={byteLength:0,usage:35050};this.buffers=[new we(n,g),new we(n,g)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}const{gl:i,buffers:s,attribute:g}=this;M2(s);const o={numInstances:n,attribute:g,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const r of s)P2({buffer:r,...o});this.currentStartIndices=g.startIndices,this.currentLength=nm(g,n),this.attributeInTransition.update({buffer:s[1],value:g.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/g.size),sourceBuffers:{aFrom:s[0],aTo:K2(i,g)},feedbackBuffers:{vCurrent:s[1]}})}update(){const e=this.transition.update();if(e){const{time:n,settings:{duration:i,easing:s}}=this.transition,g=s(n/i);this.transform.run({uniforms:{time:g}})}return e}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}}const a4=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function I4(t,e){const n=L2(e.size);return new jh(t,{vs:a4,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class l4{constructor(e){let{gl:n,attribute:i,timeline:s}=e;this.gl=n,this.type="spring",this.transition=new AI(s),this.attribute=i,this.attributeInTransition=new im(n,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=c4(n),this.framebuffer=A4(n,this.texture),this.transform=C4(n,i,this.framebuffer);const g={byteLength:0,usage:35050};this.buffers=[new we(n,g),new we(n,g),new we(n,g)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:s,attribute:g}=this,o={numInstances:n,attribute:g,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const r of s)P2({buffer:r,...o});this.currentStartIndices=g.startIndices,this.currentLength=nm(g,n),this.attributeInTransition.update({buffer:s[1],value:g.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/g.size),sourceBuffers:{aTo:K2(i,g)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:s}=this;return s.update()?(n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.settings.stiffness,damping:s.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),M2(e),this.attributeInTransition.update({buffer:e[1],value:this.attribute.value}),Fc(i)[0]>0||s.end(),!0):!1}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}function C4(t,e,n){const i=L2(e.size);return new jh(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function c4(t){return new An(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function A4(t,e){return new At(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const d4={interpolation:r4,spring:l4};class u4{constructor(e,n){let{id:i,timeline:s}=n;this.id=i,this.gl=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=jh.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:n,transitions:i,numInstances:s}=e;this.numInstances=s||1;for(const g in n){const o=n[g],r=o.getTransitionSetting(i);!r||this._updateAttribute(g,o,r)}for(const g in this.transitions){const o=n[g];(!o||!o.getTransitionSetting(i))&&this._removeTransition(g)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const s=this.transitions[e];let g=!s||s.type!==i.type;if(g){if(!this.isSupported){me.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);const o=d4[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(me.error("unsupported transition type '".concat(i.type,"'"))(),g=!1)}(g||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const kb="attributeManager.invalidate",h4="attributeManager.updateStart",m4="attributeManager.updateEnd",f4="attribute.updateStart",p4="attribute.allocate",B4="attribute.updateEnd";class b4{constructor(e){let{id:n="attribute-manager",stats:i,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new u4(e,{id:"".concat(n,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){return this.needsRedraw=!0,this}add(e,n){this._add(e,n)}addInstanced(e,n){this._add(e,n,{instanced:1})}remove(e){for(let n=0;n<e.length;n++){const i=e[n];this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}}invalidate(e,n){const i=this._invalidateTrigger(e,n);Nt(kb,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Nt(kb,this,"all")}update(){let{data:e,numInstances:n,startIndices:i=null,transitions:s,props:g={},buffers:o={},context:r={}}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=!1;Nt(h4,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const I in this.attributes){const l=this.attributes[I],C=l.settings.accessor;l.startIndices=i,g[I]&&me.removed("props.".concat(I),"data.attributes.".concat(I))(),l.setExternalBuffer(o[I])||l.setBinaryValue(o[C],e.startIndices)||!o[C]&&l.setConstantValue(g[C])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:n,data:e,props:g,context:r})),this.needsRedraw|=l.needsRedraw()}a&&Nt(m4,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:n,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const g in n){const o=n[g];o.needsRedraw(e)&&!i.hasAttribute(g)&&(s[g]=o)}return s}getShaderAttributes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const i={};for(const s in e)n[s]||Object.assign(i,e[s].getShaderAttributes());return i}getAccessors(){return this.updateTriggers}_add(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n&&me.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const s in e){const g=e[s];this.attributes[s]=this._createAttribute(s,g,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const s={...n,id:e,isIndexed:n.isIndexed||n.elements||!1,constant:n.constant||!1,size:n.elements&&1||n.size||1,value:n.value||null,divisor:n.instanced||i.instanced?1:n.divisor||0};return new im(this.gl,s)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:s}=this,g=s[e];return g&&g.forEach(o=>{const r=i[o];r&&r.setNeedsUpdate(r.id,n)}),g}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Nt(f4,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Nt(p4,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Nt(B4,n,i))}}class y4 extends AI{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:s,easing:g}}=this,o=g(e/s);this._value=dg(n,i,o)}}const Kb=1e-5;function Lb(t,e,n,i,s){const g=e-t,r=(n-e)*s,a=-g*i;return r+a+g+e}function v4(t,e,n,i,s){if(Array.isArray(n)){const g=[];for(let o=0;o<n.length;o++)g[o]=Lb(t[o],e[o],n[o],i,s);return g}return Lb(t,e,n,i,s)}function Mb(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const s=t[i]-e[i];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class G4 extends AI{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:s}=this.settings,{_prevValue:g=e,_currValue:o=e}=this;let r=v4(g,o,n,i,s);const a=Mb(r,n),I=Mb(r,o);a<Kb&&I<Kb&&(r=n,this.end()),this._prevValue=o,this._currValue=r}}const Z4={interpolation:y4,spring:G4};class R4{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,s){const{transitions:g}=this;if(g.has(e)){const a=g.get(e),{value:I=a.settings.fromValue}=a;n=I,this.remove(e)}if(s=k2(s),!s)return;const o=Z4[s.type];if(!o){me.error("unsupported transition type '".concat(s.type,"'"))();return}const r=new o(this.timeline);r.start({...s,fromValue:n,toValue:i}),g.set(e,r)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}const{COMPONENT:F4}=Uc;function S4(t){const e=sm(t);for(const n in e){const i=e[n],{validate:s}=i;if(s&&!s(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function V4(t,e){const n=J2({newProps:t,oldProps:e,propTypes:sm(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=x4(t,e);let s=!1;return i||(s=W4(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:s,extensionsChanged:w4(t,e),transitionsChanged:U4(t,e)}}function U4(t,e){if(!t.transitions)return null;const n={},i=sm(t);for(const s in t.transitions){const g=i[s],o=g&&g.type;(o==="number"||o==="color"||o==="array")&&ju(t[s],e[s],g)&&(n[s]=!0)}return n}function J2(){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(e===t)return null;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const g of Object.keys(t))if(!(g in n)){if(!(g in e))return"".concat(s,".").concat(g," added");const o=ju(t[g],e[g],i[g]);if(o)return"".concat(s,".").concat(g," ").concat(o)}for(const g of Object.keys(e))if(!(g in n)){if(!(g in t))return"".concat(s,".").concat(g," dropped");if(!Object.hasOwnProperty.call(t,g)){const o=ju(t[g],e[g],i[g]);if(o)return"".concat(s,".").concat(g," ").concat(o)}}return null}function ju(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function x4(t,e){if(e===null)return"oldProps is null, initial diff";let n=null;const{dataComparator:i,_dataDiff:s}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function W4(t,e){if(e===null)return"oldProps is null, initial diff";if("all"in t.updateTriggers&&Pb(t,e,"all"))return{all:!0};const n={};let i=!1;for(const s in t.updateTriggers)s!=="all"&&Pb(t,e,s)&&(n[s]=!0,i=n);return i}function w4(t,e){if(e===null)return"oldProps is null, initial diff";const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(n[s]))return!0;return!1}function Pb(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let s=e.updateTriggers[n];return s=s==null?{}:s,J2({oldProps:s,newProps:i,triggerName:n})}function sm(t){const e=t[F4],n=e&&e.constructor;return n?n._propTypes:{}}const N4="count(): argument not an object",T4="count(): argument not a container";function E4(t){if(!X4(t))throw new Error(N4);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Q4(t))return Object.keys(t).length;throw new Error(T4)}function Q4(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function X4(t){return t!==null&&typeof t=="object"}function Y4(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(s=>s.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];n.inject=i}return n}const _4={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},qu={};function H4(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof An)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const s=new An(n,{...e,parameters:{..._4,...i,...t.props.textureParameters}});return qu[s.id]=!0,s}function k4(t){!t||!(t instanceof An)||qu[t.id]&&(t.delete(),delete qu[t.id])}const K4={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Ta(t)&&(t.length===3||t.length===4)},equal(t,e,n){return ad(t,e)}},accessor:{validate(t,e){const n=wC(t);return n==="function"||n===wC(e.value)},equal(t,e,n){return typeof e=="function"?!0:ad(t,e)}},array:{validate(t,e){return e.optional&&!t||Ta(t)},equal(t,e,n){return n.compare?ad(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n?n.props:{};return i&&t?i(t):t}},image:{transform:(t,e,n)=>H4(n,t),release:t=>{k4(t)}}};function ad(t,e){if(t===e)return!0;if(!Ta(t)||!Ta(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function L4(t){const e={},n={},i={};for(const[s,g]of Object.entries(t))if(g&&g.deprecatedFor)i[s]=Array.isArray(g.deprecatedFor)?g.deprecatedFor:[g.deprecatedFor];else{const o=M4(s,g);e[s]=o,n[s]=o.value}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function M4(t,e){switch(wC(e)){case"object":return Vr(t,e);case"array":return Vr(t,{type:"array",value:e,compare:!1});case"boolean":return Vr(t,{type:"boolean",value:e});case"number":return Vr(t,{type:"number",value:e});case"function":return Vr(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Vr(t,e){return"type"in e?{name:t,...K4[e.type],...e}:"value"in e?{name:t,type:wC(e.value),...e}:{name:t,type:"object",value:e}}function Ta(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function wC(t){return Ta(t)?"array":t===null?"null":typeof t}const{COMPONENT:$u,ASYNC_ORIGINAL:NC,ASYNC_RESOLVED:Kr,ASYNC_DEFAULTS:Kl}=Uc;function P4(){const t=this,e=D2(t.constructor),n=Object.create(e);n[$u]=t,n[NC]={},n[Kr]={};for(let i=0;i<arguments.length;++i){const s=arguments[i];for(const g in s)n[g]=s[g]}return Object.freeze(n),n}function D2(t){const e=TC(t,"_mergedDefaultProps");return e||(J4(t),t._mergedDefaultProps)}function J4(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=D2(n),s=TC(t,"defaultProps")||{},g=L4(s),o=D4(g.defaultProps,i,t),r={...n._propTypes,...g.propTypes};O4(o,r);const a={...n._deprecatedProps,...g.deprecatedProps};z4(o,a),t._mergedDefaultProps=o,t._propTypes=r,t._deprecatedProps=a}function D4(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const s=q4(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:s}}),i}function z4(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const s="".concat(this.id,": ").concat(n);for(const g of e[n])z2(this,g)||(this[g]=i);me.deprecated(s,e[n].join("/"))()}})}function O4(t,e){const n={},i={};for(const s in e){const g=e[s],{name:o,value:r}=g;g.async&&(n[o]=r,i[o]=j4(o))}t[Kl]=n,t[NC]={},Object.defineProperties(t,i)}function j4(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||_2(e)?this[NC][t]=e:this[Kr][t]=e},get(){if(this[Kr]){if(t in this[Kr])return this[Kr][t]||this[Kl][t];if(t in this[NC]){const e=this[$u]&&this[$u].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Kl][t]}}return this[Kl][t]}}}function z2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function TC(t,e){return z2(t,e)&&t[e]}function q4(t){const e=TC(t,"layerName")||TC(t,"componentName");return e||me.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}const{ASYNC_ORIGINAL:$4,ASYNC_RESOLVED:eH,ASYNC_DEFAULTS:tH}=Uc,nH=Object.freeze({});class O2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=nH,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[eH]||{},i=e[$4]||e,s=e[tH]||{};for(const g in n){const o=n[g];this._createAsyncPropData(g,s[g]),this._updateAsyncProp(g,o),n[g]=this.getAsyncProp(g)}for(const g in i){const o=i[g];this._createAsyncPropData(g,s[g]),this._updateAsyncProp(g,o)}}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"){var i;const s=(i=this.layer)===null||i===void 0?void 0:i.props.fetch;s&&(n=s(n,{propName:e,layer:this.layer}))}if(n instanceof Promise){this._watchPromise(e,n);return}if(_2(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this.freezeAsyncOldProps();const i=this.asyncProps[e];n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount}_setAsyncPropValue(e,n,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&n!==void 0&&(this.freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];i.pendingLoadCount++;const s=i.pendingLoadCount;n.then(g=>{var o;g=this._postProcessValue(i,g),this._setAsyncPropValue(e,g,s);const r=(o=this.layer)===null||o===void 0?void 0:o.props.onDataLoad;e==="data"&&r&&r(g,{propName:e,layer:this.layer})}).catch(g=>{var o;(o=this.layer)===null||o===void 0||o.raiseError(g,"loading ".concat(e," of ").concat(this.layer))})}async _resolveAsyncIterable(e,n){var i;e!=="data"&&this._setPropValue(e,n);const s=this.asyncProps[e];s.pendingLoadCount++;const g=s.pendingLoadCount;let o=[],r=0;for await(const I of n){const{dataTransform:l}=this.component?this.component.props:{};l?o=l(I,o):o=o.concat(I),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:r,endRow:o.length}]}),r=o.length,this._setAsyncPropValue(e,o,g)}const a=(i=this.layer)===null||i===void 0?void 0:i.props.onDataLoad;a&&a(o,{propName:e,layer:this.layer})}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}const{ASYNC_ORIGINAL:Jb,ASYNC_RESOLVED:Db,ASYNC_DEFAULTS:iH}=Uc,sH={};let gH=0;class gm{constructor(){this.props=P4.apply(this,arguments),this.id=this.props.id,this.count=gH++,this.lifecycle=Og.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}clone(e){const{props:n}=this,i={};for(const s in n[iH])s in n[Db]?i[s]=n[Db][s]:s in n[Jb]&&(i[s]=n[Jb][s]);return new this.constructor({...n,...i,...e})}get stats(){return this.internalState.stats}_initState(){this.internalState=new O2({})}}gm.componentName="Component";gm.defaultProps=sH;class oH extends O2{constructor(e){let{attributeManager:n,layer:i}=e;super(i),this.attributeManager=n,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}}const rH="layer.changeFlag",aH="layer.initialize",IH="layer.update",lH="layer.finalize",CH="layer.matched",zb=2**24-1,cH=Object.freeze([]),AH=Sc(t=>{let{oldViewport:e,viewport:n}=t;return e.equals(n)});let $n=new Uint8ClampedArray(0);const dH={data:{type:"data",value:cH,async:!0},dataComparator:null,_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,e)=>{let{propName:n,layer:i,loaders:s,loadOptions:g,signal:o}=e;const{resourceManager:r}=i.context;if(g=g||i.getLoadOptions(),s=s||i.props.loaders,o){var a;g={...g,fetch:{...(a=g)===null||a===void 0?void 0:a.fetch,signal:o}}}let I=r.contains(t);return!I&&!g&&(r.add({resourceId:t,data:vC(t,s),persistent:!1}),I=!0),I?r.subscribe({resourceId:t,onChange:l=>i.internalState.reloadAsyncProp(n,l),consumerId:i.id,requestId:n}):vC(t,s,g)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Ce.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:t=>{let{layerIndex:e}=t;return[0,-e*100]},compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class hn extends gm{toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}raiseError(e,n){var i,s;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(s=this.props).onError)!==null&&i!==void 0&&i.call(s,e))){var g,o;(g=this.context)===null||g===void 0||(o=g.onError)===null||o===void 0||o.call(g,e,this)}}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.internalState&&(this.internalState.needsRedraw=e)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(e){const{viewport:n}=this.context,i=R2(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,g,o]=y2(i,n.pixelProjectionMatrix);return e.length===2?[s,g]:[s,g,o]}unproject(e){const{viewport:n}=this.context;return n.unproject(e)}projectPosition(e){return QY(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ce.DEFAULT||e===Ce.LNGLAT||e===Ce.CARTESIAN}onHover(e,n){return this.props.onHover?this.props.onHover(e,n):!1}onClick(e,n){return this.props.onClick?this.props.onClick(e,n):!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Cn(e instanceof Uint8Array);const[n,i,s]=e;return n+i*256+s*65536-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(e){for(const n of this.props.extensions)e=Y4(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){let{oldProps:n,props:i,context:s,changeFlags:g}=e;return g.propsOrDataChanged}updateState(e){let{oldProps:n,props:i,context:s,changeFlags:g}=e;const o=this.getAttributeManager();if(g.dataChanged&&o){const{dataChanged:I}=g;if(Array.isArray(I))for(const l of I)o.invalidateAll(l);else o.invalidateAll()}const r=n.highlightedObjectIndex>=0||n.pickable,a=i.highlightedObjectIndex>=0||i.pickable;if(r!==a&&o){const{pickingColors:I,instancePickingColors:l}=o.attributes,C=I||l;C&&(a&&C.constant&&(C.constant=!1,o.invalidate(C.id)),!C.value&&!a&&(C.constant=!0,C.value=[0,0,0]))}}finalizeState(){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo(e){let{info:n,mode:i}=e;const{index:s}=n;return s>=0&&Array.isArray(this.props.data)&&(n.object=this.props.data[s]),n}activateViewport(e){const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!AH({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(e){const n=this.getAttributeManager();if(!n)return;const i=this.getNumInstances(e),s=this.getStartIndices(e);n.update({data:e.data,numInstances:i,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this,ignoreUnknownAttributes:!0});const g=n.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(g)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const s in n)Object.defineProperty(i,s,{value:n[s]});return i}return this.props}calculateInstancePickingColors(e,n){let{numInstances:i}=n;if(e.constant)return;const s=Math.floor($n.length/3);if(this.internalState.usesPickingColorCache=!0,s<i){i>zb&&me.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$n=Xo.allocate($n,i,{size:3,copy:!0,maxCount:Math.max(i,zb)});const g=Math.floor($n.length/3),o=[];for(let r=s;r<g;r++)this.encodePickingColor(r,o),$n[r*3+0]=o[0],$n[r*3+1]=o[1],$n[r*3+2]=o[2]}e.value=$n.subarray(0,i*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),s=e.userData.excludeAttributes||{},g=i.getShaderAttributes(n,s);e.setAttributes(g)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,g=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(o-g),offset:g})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;this.internalState.usesPickingColorCache&&i.value.buffer!==$n.buffer&&(i.value=$n.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0})}getNumInstances(e){return e=e||this.props,e.numInstances!==void 0?e.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:E4(e.data)}getStartIndices(e){return e=e||this.props,e.startIndices!==void 0?e.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){Nt(aH,this),this._initState(),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const e=this.needsUpdate();Nt(IH,this,e),e&&this._updateState()}_updateState(){const e=this.props,n=this.context.viewport,i=this._updateUniformTransition();this.internalState.propsInTransition=i,this.context.viewport=this.internalState.viewport||n,this.props=i;try{const s=this._getUpdateParams(),g=this.getModels();if(this.context.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const r of this.props.extensions)r.updateState.call(this,s,r);const o=this.getModels()[0]!==g[0];this._updateModules(s,o),this.isComposite?this._renderLayers(s):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=n,this.props=e,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){Nt(lH,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}drawLayer(e){let{moduleParameters:n=null,uniforms:i={},parameters:s={}}=e;this._updateAttributeTransition();const g=this.props;this.props=this.internalState.propsInTransition||g;const{opacity:o}=this.props;i.opacity=Math.pow(o,1/2.2);try{n&&this.setModuleParameters(n);const{getPolygonOffset:r}=this.props,a=r&&r(i)||[0,0];Qi(this.context.gl,{polygonOffset:a}),Mn(this.context.gl,s,()=>{const I={moduleParameters:n,uniforms:i,parameters:s,context:this.context};for(const l of this.props.extensions)l.draw.call(this,I,l);this.draw(I)})}finally{this.props=g}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(e){const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let g=!1;switch(s){case"dataChanged":Array.isArray(n[s])&&(n[s]=Array.isArray(e[s])?n[s].concat(e[s]):e[s],g=!0);default:n[s]||(n[s]=e[s],g=!0)}g&&Nt(rH,this,s,e)}const i=n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged;n.propsOrDataChanged=i,n.somethingChanged=i||e.viewportChanged||e.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(e,n){const i=V4(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],e.transitions[s]);return this.setChangeFlags(i)}validateProps(){S4(this.props)}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}updateAutoHighlight(e){this.props.autoHighlight&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_updateModules(e,n){let{props:i,oldProps:s}=e;const{autoHighlight:g,highlightedObjectIndex:o,highlightColor:r}=i;if(n||s.autoHighlight!==g||s.highlightedObjectIndex!==o||s.highlightColor!==r){const a={};g||(a.pickingSelectedColor=null),Array.isArray(r)&&(a.pickingHighlightColor=r),Number.isInteger(o)&&(a.pickingSelectedColor=o>=0?this.encodePickingColor(o):null),this.setModuleParameters(a)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),s=i&&i.getNeedsRedraw(e);return n=n||s,n}_getAttributeManager(){return new b4(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){Cn(!this.internalState&&!this.state),Cn(isFinite(this.props.coordinateSystem));const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new oH({attributeManager:e,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(me.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new R4(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){Nt(CH,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}hn.layerName="Layer";hn.defaultProps=dH;const uH="compositeLayer.renderLayers";class Un extends hn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:n}=e;const{object:i}=n;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(n.object=i.__source.object,n.index=i.__source.index),n}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,s)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{opacity:n,pickable:i,visible:s,parameters:g,getPolygonOffset:o,highlightedObjectIndex:r,autoHighlight:a,highlightColor:I,coordinateSystem:l,coordinateOrigin:C,wrapLongitude:c,positionFormat:A,modelMatrix:d,extensions:h,fetch:u,_subLayerProps:m}=this.props,f={opacity:n,pickable:i,visible:s,parameters:g,getPolygonOffset:o,highlightedObjectIndex:r,autoHighlight:a,highlightColor:I,coordinateSystem:l,coordinateOrigin:C,wrapLongitude:c,positionFormat:A,modelMatrix:d,extensions:h,fetch:u},p=m&&m[e.id],B=p&&p.updateTriggers,G=e.id||"sublayer";if(p){const y=this.constructor._propTypes,U=e.type?e.type._propTypes:{};for(const V in p){const F=U[V]||y[V];F&&F.type==="accessor"&&(p[V]=this.getSubLayerAccessor(p[V]))}}Object.assign(f,e,p),f.id="".concat(this.props.id,"-").concat(G),f.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,...B};for(const y of h){const U=y.getSubLayerProps.call(this,y);U&&Object.assign(f,U,{updateTriggers:Object.assign(f.updateTriggers,U.updateTriggers)})}return f}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const n=!e||this.needsUpdate();n&&(e=this.renderLayers(),e=xc(e,Boolean),this.internalState.subLayers=e),Nt(uH,this,n,e);for(const i of e)i.parent=this}}Un.layerName="CompositeLayer";class om{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.opts=e}equals(e){return this===e?!0:this.constructor===e.constructor&&Oo(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n={}}=e.constructor,i={updateTriggers:{}};for(const s in n)if(s in this.props){const g=n[s],o=this.props[s];i[s]=o,g&&g.type==="accessor"&&(i.updateTriggers[s]=this.props.updateTriggers[s],typeof o=="function"&&(i[s]=this.getSubLayerAccessor(o,!0)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e){}}const $i={rotationX:0,rotationOrbit:0,zoom:0,target:[0,0,0],minRotationX:-90,maxRotationX:90,minZoom:-1/0,maxZoom:1/0};class hH extends V2{constructor(e){let{makeViewport:n,width:i,height:s,rotationX:g=$i.rotationX,rotationOrbit:o=$i.rotationOrbit,target:r=$i.target,zoom:a=$i.zoom,minRotationX:I=$i.minRotationX,maxRotationX:l=$i.maxRotationX,minZoom:C=$i.minZoom,maxZoom:c=$i.maxZoom,startPanPosition:A,startRotatePos:d,startRotationX:h,startRotationOrbit:u,startZoomPosition:m,startZoom:f}=e;super({width:i,height:s,rotationX:g,rotationOrbit:o,target:r,zoom:a,minRotationX:I,maxRotationX:l,minZoom:C,maxZoom:c}),this._state={startPanPosition:A,startRotatePos:d,startRotationX:h,startRotationOrbit:u,startZoomPosition:m,startZoom:f},this.makeViewport=n}panStart(e){let{pos:n}=e;return this._getUpdatedState({startPanPosition:this._unproject(n)})}pan(e){let{pos:n,startPosition:i}=e;const s=this._state.startPanPosition||i;if(!s)return this;const o=this.makeViewport(this._viewportProps).panByPosition(s,n);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart(e){let{pos:n}=e;return this._getUpdatedState({startRotatePos:n,startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}rotate(e){let{pos:n,deltaAngleX:i=0,deltaAngleY:s=0}=e;const{startRotatePos:g,startRotationX:o,startRotationOrbit:r}=this._state,{width:a,height:I}=this._viewportProps;if(!g||!Number.isFinite(o)||!Number.isFinite(r))return this;let l;if(n){let C=(n[0]-g[0])/a;const c=(n[1]-g[1])/I;(o<-90||o>90)&&(C*=-1),l={rotationX:o+c*180,rotationOrbit:r+C*180}}else l={rotationX:o+s,rotationOrbit:r+i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this._viewportProps},{rotationOrbit:s}=i;return Math.abs(s-n.rotationOrbit)>180&&(i.rotationOrbit=s<0?s+360:s-360),i}zoomStart(e){let{pos:n}=e;return this._getUpdatedState({startZoomPosition:this._unproject(n),startZoom:this._viewportProps.zoom})}zoom(e){let{pos:n,startPos:i,scale:s}=e;const{zoom:g}=this._viewportProps;let{startZoom:o,startZoomPosition:r}=this._state;Number.isFinite(o)||(o=g,r=this._unproject(i)||this._unproject(n));const a=this._calculateNewZoom({scale:s,startZoom:o}),I=this.makeViewport({...this._viewportProps,zoom:a});return this._getUpdatedState({zoom:a,...I.panByPosition(r,n)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this._viewportProps.rotationX-e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this._viewportProps.rotationX+e})}_unproject(e){const n=this.makeViewport(this._viewportProps);return e&&n.unproject(e)}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:s,minZoom:g}=this._viewportProps;Number.isFinite(i)||(i=this._viewportProps.zoom);const o=i+Math.log2(n);return rn(o,g,s)}_panFromCenter(e){const{width:n,height:i,target:s}=this._viewportProps;return this.pan({startPosition:s,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({...this._viewportProps,...this._state,...e})}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s,maxRotationX:g,minRotationX:o,rotationOrbit:r}=e;return e.zoom=rn(s,i,n),e.rotationX=rn(e.rotationX,o,g),(r<-180||r>180)&&(e.rotationOrbit=ZY(r+180,360)-180),e}}class mH extends hH{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s}=e;return e.zoom=Array.isArray(s)?[rn(s[0],i,n),rn(s[1],i,n)]:rn(s,i,n),e}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:s,minZoom:g}=this._viewportProps;!i&&i!==0&&(i=this._viewportProps.zoom);let o=Math.log2(n);if(Array.isArray(i)){let[r,a]=i;switch(this.zoomAxis){case"X":r=rn(r+o,g,s);break;case"Y":a=rn(a+o,g,s);break;default:let I=Math.min(r+o,a+o);I<g&&(o+=g-I),I=Math.max(r+o,a+o),I>s&&(o+=s-I),r+=o,a+=o}return[r,a]}return rn(i+o,g,s)}}class fH extends S2{constructor(e){e.dragMode=e.dragMode||"pan",super(mH,e)}_onPanRotate(e){return!1}get linearTransitionProps(){return["target","zoom"]}}const pH=new Ee().lookAt({eye:[0,0,1]});function BH(t){let{width:e,height:n,near:i,far:s}=t;return e=e||1,n=n||1,new Ee().ortho({left:-e/2,right:e/2,bottom:-n/2,top:n/2,near:i,far:s})}class bH extends Ws{constructor(e){const{width:n,height:i,near:s=.1,far:g=1e3,zoom:o=0,target:r=[0,0,0],flipY:a=!0}=e,I=Array.isArray(o)?o[0]:o,l=Array.isArray(o)?o[1]:o,C=Math.min(I,l),c=Math.pow(2,C);if(super({...e,longitude:null,position:r,viewMatrix:pH.clone().scale([c,c*(a?-1:1),c]),projectionMatrix:BH({width:n,height:i,near:s,far:g}),zoom:C}),I!==l){const A=Math.pow(2,I),d=Math.pow(2,l);this.distanceScales={unitsPerMeter:[A/c,d/c,1],metersPerUnit:[c/A,c/d,1]}}}projectFlat(e){let[n,i]=e;const{unitsPerMeter:s}=this.distanceScales;return[n*s[0],i*s[1]]}unprojectFlat(e){let[n,i]=e;const{metersPerUnit:s}=this.distanceScales;return[n*s[0],i*s[1]]}panByPosition(e,n){const i=Vc(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),g=RC([],s,t2([],i));return{target:RC([],this.center,g)}}}class rm extends Bg{constructor(e){super({...e,type:bH})}get controller(){return this._getControllerProps({type:fH})}}rm.displayName="OrthographicView";class j2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{attributes:n={}}=e;this.typedArrayManager=Xo,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e),Object.seal(this)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:s,geometryBuffer:g,positionFormat:o,dataChanged:r,normalize:a=!0}=this.opts;if(this.data=n,this.getGeometry=s,this.positionSize=g&&g.size||(o==="XY"?2:3),this.buffers=i,this.normalize=a,g&&(Cn(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(g),a||(i.positions=g)),this.geometryBuffer=i.positions,Array.isArray(r))for(const I of r)this._rebuildGeometry(I);else this._rebuildGeometry()}updatePartialGeometry(e){let{startRow:n,endRow:i}=e;this._rebuildGeometry({startRow:n,endRow:i})}normalizeGeometry(e){return e}updateGeometryAttributes(e,n,i){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}getGeometryFromBuffer(e){const n=e.value||e;return Cn(ArrayBuffer.isView(n)),H2(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices})}_allocate(e,n){const{attributes:i,buffers:s,_attributeDefs:g,typedArrayManager:o}=this;for(const r in g)if(r in s)o.release(i[r]),i[r]=null;else{const a=g[r];a.copy=n,i[r]=o.allocate(i[r],e,a)}}_forEachGeometry(e,n,i){const{data:s,getGeometry:g}=this,{iterable:o,objectInfo:r}=dI(s,n,i);for(const a of o){r.index++;const I=g(a,r);e(I,r.index)}}_rebuildGeometry(e){if(!this.data||!this.getGeometry)return;let{indexStarts:n,vertexStarts:i,instanceCount:s}=this;const{data:g,geometryBuffer:o}=this,{startRow:r=0,endRow:a=1/0}=e||{},I={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((C,c)=>{C=this.normalizeGeometry(C),I[c]=C,i[c+1]=i[c]+this.getGeometrySize(C)},r,a),s=i[i.length-1];else if(o.buffer instanceof we){const C=o.stride||this.positionSize*4;i=g.startIndices,s=i[g.length]||o.buffer.byteLength/C}else{const C=o.value||o,c=o.stride/C.BYTES_PER_ELEMENT||this.positionSize;i=g.startIndices,s=i[g.length]||C.length/c}this._allocate(s,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=s;const l={};this._forEachGeometry((C,c)=>{C=I[c]||C,l.vertexStart=i[c],l.indexStart=n[c];const A=c<i.length-1?i[c+1]:s;l.geometrySize=A-i[c],l.geometryIndex=c,this.updateGeometryAttributes(C,l)},r,a),this.vertexCount=n[n.length-1]}}const q={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795},yH=new Uint16Array([0,2,1,0,3,2]),vH=new Float32Array([0,1,0,0,1,0,1,1]);function GH(t,e){if(!e)return ZH(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),s=Math.ceil(n/e)+1,g=Math.ceil(i/e)+1,o=(s-1)*(g-1)*6,r=new Uint32Array(o),a=new Float32Array(s*g*2),I=new Float64Array(s*g*3);let l=0,C=0;for(let c=0;c<s;c++){const A=c/(s-1);for(let d=0;d<g;d++){const h=d/(g-1),u=RH(t,A,h);I[l*3+0]=u[0],I[l*3+1]=u[1],I[l*3+2]=u[2]||0,a[l*2+0]=A,a[l*2+1]=1-h,c>0&&d>0&&(r[C++]=l-g,r[C++]=l-g-1,r[C++]=l-1,r[C++]=l-g,r[C++]=l-1,r[C++]=l),l++}}return{vertexCount:o,positions:I,indices:r,texCoords:a}}function ZH(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:yH,texCoords:vH}}function RH(t,e,n){return dg(dg(t[0],t[1],n),dg(t[3],t[2],n),e)}const FH=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,SH=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,VH=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(SH,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),UH={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Ce.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class Wc extends hn{getShaders(){return super.getShaders({vs:FH,fs:VH,modules:[_s,Hs]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState(e){let{props:n,oldProps:i,changeFlags:s}=e;if(s.extensionsChanged){var g;const{gl:r}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}const o=this.getAttributeManager();if(n.bounds!==i.bounds){const r=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const I in a)r&&r[I]!==a[I]&&o.invalidate(I);this.setState({mesh:a,...this._getCoordinateUniforms()})}else n._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{info:n}=e;const{image:i}=this.props;if(!n.color||!i)return n.bitmap=null,n;const{width:s,height:g}=i;n.index=0;const o=xH(n.color),r=[Math.floor(o[0]*s),Math.floor(o[1]*g)];return n.bitmap={size:{width:s,height:g},uv:o,pixel:r},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return Number.isFinite(e[0])&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),GH(n,this.context.viewport.resolution)}_getModel(e){return e?new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:s,coordinateConversion:g,bounds:o,disablePicking:r}=this.state,{image:a,desaturate:I,transparentColor:l,tintColor:C}=this.props;i.pickingActive&&r||a&&s&&s.setUniforms(n).setUniforms({bitmapTexture:a,desaturate:I,transparentColor:l.map(c=>c/255),tintColor:C.slice(0,3).map(c=>c/255),coordinateConversion:g,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=Ce;let{_imageCoordinateSystem:s}=this.props;if(s!==i){const{bounds:g}=this.props;if(!Number.isFinite(g[0]))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(s=s===e?e:n,s===e&&o===n)return{coordinateConversion:-1,bounds:g};if(s===n&&o===e){const r=xs([g[0],g[1]]),a=xs([g[2],g[3]]);return{coordinateConversion:1,bounds:[r[0],r[1],a[0],a[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Wc.layerName="BitmapLayer";Wc.defaultProps=UH;function xH(t){const[e,n,i]=t,s=(i&240)/256,g=(i&15)/16;return[(e+g)/256,(n+s)/256]}const WH=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,wH=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,NH=1024,TH=4,Ob=()=>{},EH={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function QH(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function XH(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function Ea(t){return t&&(t.id||t.url)}function YH(t,e,n,i){const s=e.width,g=e.height,o=H1(e,{width:n,height:i});return gT(e,o,{targetY:0,width:s,height:g}),e.delete(),o}function jb(t,e,n){for(let i=0;i<e.length;i++){const{icon:s,xOffset:g}=e[i],o=Ea(s);t[o]={...s,x:g,y:n}}}function _H(t){let{icons:e,buffer:n,mapping:i={},xOffset:s=0,yOffset:g=0,rowHeight:o=0,canvasWidth:r}=t,a=[];for(let I=0;I<e.length;I++){const l=e[I],C=Ea(l);if(!i[C]){const{height:c,width:A}=l;s+A+n>r&&(jb(i,a,g),s=0,g=o+g+n,o=0,a=[]),a.push({icon:l,xOffset:s}),s=s+A+n,o=Math.max(o,c)}}return a.length>0&&jb(i,a,g),{mapping:i,rowHeight:o,xOffset:s,yOffset:g,canvasWidth:r,canvasHeight:QH(o+g+n)}}function HH(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:s,objectInfo:g}=dI(t);for(const o of s){g.index++;const r=e(o,g),a=Ea(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");!i[a]&&(!n[a]||r.url!==n[a].url)&&(i[a]={...r,source:o,sourceIndex:g.index})}return i}class kH{constructor(e,n){let{onUpdate:i=Ob,onError:s=Ob}=n;this.gl=e,this.onUpdate=i,this.onError=s,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=TH,this._canvasWidth=NH,this._canvasHeight=0,this._canvas=null}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Ea(e):e;return this._mapping[n]||{}}setProps(e){let{loadOptions:n,autoPacking:i,iconAtlas:s,iconMapping:g,data:o,getIcon:r}=e;n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),r&&(this._getIcon=r),g&&(this._mapping=g),s&&this._updateIconAtlas(s),this._autoPacking&&(o||r)&&typeof document<"u"&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}get isLoaded(){return this._pendingCount===0}_updateIconAtlas(e){var n;(n=this._texture)===null||n===void 0||n.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}_updateAutoPacking(e){const n=Object.values(HH(e,this._getIcon,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:s,yOffset:g,rowHeight:o,canvasHeight:r}=_H({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=i,this._xOffset=s,this._yOffset=g,this._canvasHeight=r,this._texture||(this._texture=new An(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:EH})),this._texture.height!==this._canvasHeight&&(this._texture=YH(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(n)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,vC(i.url,G1,this._loadOptions).then(s=>{const g=Ea(i),{x:o,y:r,width:a,height:I}=this._mapping[g],l=XH(n,s,a,I);this._texture.setSubImageData({data:l,x:o,y:r,width:a,height:I}),this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const q2=[0,0,0,255],KH={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:q2},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class wc extends hn{getShaders(){return super.getShaders({vs:WH,fs:wH,modules:[_s,Hs]})}initializeState(){this.state={iconManager:new kH(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:q2},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){let{oldProps:n,props:i,changeFlags:s}=e;super.updateState({props:i,oldProps:n,changeFlags:s});const g=this.getAttributeManager(),{iconAtlas:o,iconMapping:r,data:a,getIcon:I}=i,{iconManager:l}=this.state;l.setProps({loadOptions:i.loadOptions});let C=!1;if(o||this.internalState.isAsyncPropLoading("iconAtlas")?(n.iconAtlas!==i.iconAtlas&&l.setProps({iconAtlas:o,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(l.setProps({iconMapping:r}),C=!0)):l.setProps({autoPacking:!0}),(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&l.setProps({data:a,getIcon:I}),C&&(g.invalidate("instanceOffsets"),g.invalidate("instanceIconFrames"),g.invalidate("instanceColorModes")),s.extensionsChanged){var A;const{gl:d}=this.context;(A=this.state.model)===null||A===void 0||A.delete(),this.state.model=this._getModel(d),g.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw(e){let{uniforms:n}=e;const{sizeScale:i,sizeMinPixels:s,sizeMaxPixels:g,sizeUnits:o,billboard:r,alphaCutoff:a}=this.props,{iconManager:I}=this.state,l=I.getTexture();l&&this.state.model.setUniforms(n).setUniforms({iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:Us[o],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:g,billboard:r,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const{onIconError:n}=this.getCurrentLayer().props;n?n(e):me.error(e.error)()}getInstanceOffset(e){const n=this.state.iconManager.getIconMapping(e);return[n.width/2-n.anchorX||0,n.height/2-n.anchorY||0]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const n=this.state.iconManager.getIconMapping(e);return[n.x||0,n.y||0,n.width||0,n.height||0]}}wc.layerName="IconLayer";wc.defaultProps=KH;const LH=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,MH=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,PH=[0,0,0,255],JH={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:PH},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class ca extends hn{getShaders(){return super.getShaders({vs:LH,fs:MH,modules:[_s,Hs]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:s}=e;if(super.updateState({props:n,oldProps:i,changeFlags:s}),s.extensionsChanged){var g;const{gl:o}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{widthUnits:i,widthScale:s,widthMinPixels:g,widthMaxPixels:o,wrapLongitude:r}=this.props;this.state.model.setUniforms(n).setUniforms({widthUnits:Us[i],widthScale:s,widthMinPixels:g,widthMaxPixels:o,useShortestPath:r?1:0}).draw(),r&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}ca.layerName="LineLayer";ca.defaultProps=JH;const DH=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,zH=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,qb=[0,0,0,255],OH={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:qb},getLineColor:{type:"accessor",value:qb},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class am extends hn{getShaders(){return super.getShaders({vs:DH,fs:zH,modules:[_s,Hs]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:s}=e;if(super.updateState({props:n,oldProps:i,changeFlags:s}),s.extensionsChanged){var g;const{gl:o}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{radiusUnits:i,radiusScale:s,radiusMinPixels:g,radiusMaxPixels:o,stroked:r,filled:a,billboard:I,antialiasing:l,lineWidthUnits:C,lineWidthScale:c,lineWidthMinPixels:A,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(n).setUniforms({stroked:r?1:0,filled:a,billboard:I,antialiasing:l,radiusUnits:Us[i],radiusScale:s,radiusMinPixels:g,radiusMaxPixels:o,lineWidthUnits:Us[C],lineWidthScale:c,lineWidthMinPixels:A,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}am.layerName="ScatterplotLayer";am.defaultProps=OH;const $2={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function eR(t,e,n={}){return jH(t,n)!==e?($H(t,n),!0):!1}function jH(t,e={}){return Math.sign(qH(t,e))}function qH(t,e={}){const{start:n=0,end:i=t.length}=e,s=e.size||2;let g=0;for(let o=n,r=i-s;o<i;o+=s)g+=(t[o]-t[r])*(t[o+1]+t[r+1]),r=o;return g/2}function $H(t,e){const{start:n=0,end:i=t.length,size:s=2}=e,g=(i-n)/s,o=Math.floor(g/2);for(let r=0;r<o;++r){const a=n+r*s,I=n+(g-1-r)*s;for(let l=0;l<s;++l){const C=t[a+l];t[a+l]=t[I+l],t[I+l]=C}}}function kn(t,e){const n=e.length,i=t.length;if(i>0){let s=!0;for(let g=0;g<n;g++)if(t[i-n+g]!==e[g]){s=!1;break}if(s)return!1}for(let s=0;s<n;s++)t[i+s]=e[s];return!0}function e0(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Qa(t,e,n,i,s=[]){const g=i+e*n;for(let o=0;o<n;o++)s[o]=t[g+o];return s}function t0(t,e,n,i,s=[]){let g,o;if(n&8)g=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)g=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)g=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)g=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let r=0;r<t.length;r++)s[r]=(o&1)===r?i[o]:g*(e[r]-t[r])+t[r];return s}function Ll(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function tR(t,e={}){const{size:n=2,broken:i=!1,gridResolution:s=10,gridOffset:g=[0,0],startIndex:o=0,endIndex:r=t.length}=e,a=(r-o)/n;let I=[];const l=[I],C=Qa(t,0,n,o);let c,A;const d=iR(C,s,g,[]),h=[];kn(I,C);for(let u=1;u<a;u++){for(c=Qa(t,u,n,o,c),A=Ll(c,d);A;){t0(C,c,A,d,h);const m=Ll(h,d);m&&(t0(C,h,m,d,h),A=m),kn(I,h),e0(C,h),tk(d,s,A),i&&I.length>n&&(I=[],l.push(I),kn(I,C)),A=Ll(c,d)}kn(I,c),e0(C,c)}return i?l:l[0]}const $b=0,ek=1;function nl(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function nR(t,e,n={}){if(!t.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:g=[0,0],edgeTypes:o=!1}=n,r=[],a=[{pos:t,types:o&&new Array(t.length/i).fill(ek),holes:e||[]}],I=[[],[]];let l=[];for(;a.length;){const{pos:C,types:c,holes:A}=a.shift();nk(C,i,A[0]||C.length,I),l=iR(I[0],s,g,l);const d=Ll(I[1],l);if(d){let h=ey(C,c,i,0,A[0]||C.length,l,d);const u={pos:h[0].pos,types:h[0].types,holes:[]},m={pos:h[1].pos,types:h[1].types,holes:[]};a.push(u,m);for(let f=0;f<A.length;f++)h=ey(C,c,i,A[f],A[f+1]||C.length,l,d),h[0]&&(u.holes.push(u.pos.length),u.pos=nl(u.pos,h[0].pos),o&&(u.types=nl(u.types,h[0].types))),h[1]&&(m.holes.push(m.pos.length),m.pos=nl(m.pos,h[1].pos),o&&(m.types=nl(m.types,h[1].types)))}else{const h={positions:C};o&&(h.edgeTypes=c),A.length&&(h.holeIndices=A),r.push(h)}}return r}function ey(t,e,n,i,s,g,o){const r=(s-i)/n,a=[],I=[],l=[],C=[],c=[];let A,d,h;const u=Qa(t,r-1,n,i);let m=Math.sign(o&8?u[1]-g[3]:u[0]-g[2]),f=e&&e[r-1],p=0,B=0;for(let G=0;G<r;G++)A=Qa(t,G,n,i,A),d=Math.sign(o&8?A[1]-g[3]:A[0]-g[2]),h=e&&e[i/n+G],d&&m&&m!==d&&(t0(u,A,o,g,c),kn(a,c)&&l.push(f),kn(I,c)&&C.push(f)),d<=0?(kn(a,A)&&l.push(h),p-=d):l.length&&(l[l.length-1]=$b),d>=0?(kn(I,A)&&C.push(h),B+=d):C.length&&(C[C.length-1]=$b),e0(u,A),m=d,f=h;return[p?{pos:a,types:e&&l}:null,B?{pos:I,types:e&&C}:null]}function iR(t,e,n,i){const s=Math.floor((t[0]-n[0])/e)*e+n[0],g=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=s,i[1]=g,i[2]=s+e,i[3]=g+e,i}function tk(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function nk(t,e,n,i){let s=1/0,g=-1/0,o=1/0,r=-1/0;for(let a=0;a<n;a+=e){const I=t[a],l=t[a+1];s=I<s?I:s,g=I>g?I:g,o=l<o?l:o,r=l>r?l:r}return i[0][0]=s,i[0][1]=o,i[1][0]=g,i[1][1]=r,i}const ik=85.051129;function sk(t,e={}){const{size:n=2,startIndex:i=0,endIndex:s=t.length,normalize:g=!0}=e,o=t.slice(i,s);sR(o,n,0,s-i);const r=tR(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(g)for(const a of r)gR(a,n);return r}function gk(t,e,n={}){const{size:i=2,normalize:s=!0,edgeTypes:g=!1}=n;e=e||[];const o=[],r=[];let a=0,I=0;for(let C=0;C<=e.length;C++){const c=e[C]||t.length,A=I,d=ok(t,i,a,c);for(let h=d;h<c;h++)o[I++]=t[h];for(let h=a;h<d;h++)o[I++]=t[h];sR(o,i,A,I),rk(o,i,A,I,n.maxLatitude),a=c,r[C]=I}r.pop();const l=nR(o,r,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:g});if(s)for(const C of l)gR(C.positions,i);return l}function ok(t,e,n,i){let s=-1,g=-1;for(let o=n+1;o<i;o+=e){const r=Math.abs(t[o]);r>s&&(s=r,g=o-1)}return g}function rk(t,e,n,i,s=ik){const g=t[n],o=t[i-e];if(Math.abs(g-o)>180){const r=Qa(t,0,e,n);r[0]+=Math.round((o-g)/360)*360,kn(t,r),r[1]=Math.sign(r[1])*s,kn(t,r),r[0]=g,kn(t,r)}}function sR(t,e,n,i){let s=t[0],g;for(let o=n;o<i;o+=e){g=t[o];const r=g-s;(r>180||r<-180)&&(g-=Math.round(r/360)*360),t[o]=s=g}}function gR(t,e){let n;const i=t.length/e;for(let g=0;g<i&&(n=t[g*e],(n+180)%360===0);g++);const s=-Math.round(n/360)*360;if(s!==0)for(let g=0;g<i;g++)t[g*e]+=s}function ak(t,e,n,i){let s=t;if(Array.isArray(t[0])){const g=t.length*e;s=new Array(g);for(let o=0;o<t.length;o++)for(let r=0;r<e;r++)s[o*e+r]=t[o][r]||0}return n?tR(s,{size:e,gridResolution:n}):i?sk(s,{size:e}):s}const Ik=1,lk=2,Id=4;class Ck extends j2{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):()=>null}normalizeGeometry(e){return this.normalize?ak(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}get(e){return this.attributes[e]}getGeometrySize(e){if(Array.isArray(e[0])){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Array.isArray(e[0]))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const{segmentTypes:i}=this.attributes,s=this.isClosed(e),{vertexStart:g,geometrySize:o}=n;i.fill(0,g,g+o),s?(i[g]=Id,i[g+o-2]=Id):(i[g]+=Ik,i[g+o-2]+=lk),i[g+o-1]=Id}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i)return;const{vertexStart:s,geometrySize:g}=n,o=new Array(3);for(let r=s,a=0;a<g;r++,a++)this.getPointOnPath(e,a,o),i[r*3]=o[0],i[r*3+1]=o[1],i[r*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{positionSize:s}=this;n*s>=e.length&&(n+=1-e.length/s);const g=n*s;return i[0]=e[g],i[1]=e[g+1],i[2]=s===3&&e[g+2]||0,i}isClosed(e){if(!this.normalize)return this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}const ck=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ak=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,oR=[0,0,0,255],dk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:oR},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ld={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Nc extends hn{getShaders(){return super.getShaders({vs:ck,fs:Ak,modules:[_s,Hs]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:ld,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ld,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:ld,defaultValue:oR},instancePickingColors:{size:3,type:5121,accessor:(i,s)=>{let{index:g,target:o}=s;return this.encodePickingColor(i&&i.__source?i.__source.index:g,o)}}}),this.setState({pathTesselator:new Ck({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&me.removed("getDashArray","PathStyleExtension")()}updateState(e){let{oldProps:n,props:i,changeFlags:s}=e;super.updateState({props:i,oldProps:n,changeFlags:s});const g=this.getAttributeManager();if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,I=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:I.getPath,buffers:I,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:s.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),s.dataChanged||g.invalidateAll()}if(s.extensionsChanged){var r;const{gl:a}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(a),g.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(g=>g.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw(e){let{uniforms:n}=e;const{jointRounded:i,capRounded:s,billboard:g,miterLimit:o,widthUnits:r,widthScale:a,widthMinPixels:I,widthMaxPixels:l}=this.props;this.state.model.setUniforms(n).setUniforms({jointType:Number(i),capType:Number(s),billboard:g,widthUnits:Us[r],widthScale:a,miterLimit:o,widthMinPixels:I,widthMaxPixels:l}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}Nc.layerName="PathLayer";Nc.defaultProps=dk;var Im={exports:{}};Im.exports=Tc;Im.exports.default=Tc;function Tc(t,e,n){n=n||2;var i=e&&e.length,s=i?e[0]*n:t.length,g=rR(t,0,s,n,!0),o=[];if(!g||g.next===g.prev)return o;var r,a,I,l,C,c,A;if(i&&(g=pk(t,e,g,n)),t.length>80*n){r=I=t[0],a=l=t[1];for(var d=n;d<s;d+=n)C=t[d],c=t[d+1],C<r&&(r=C),c<a&&(a=c),C>I&&(I=C),c>l&&(l=c);A=Math.max(I-r,l-a),A=A!==0?1/A:0}return Xa(g,o,n,r,a,A),o}function rR(t,e,n,i,s){var g,o;if(s===s0(t,e,n,i)>0)for(g=e;g<n;g+=i)o=ty(g,t[g],t[g+1],o);else for(g=n-i;g>=e;g-=i)o=ty(g,t[g],t[g+1],o);return o&&Ec(o,o.next)&&(_a(o),o=o.next),o}function ws(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Ec(n,n.next)||$e(n.prev,n,n.next)===0)){if(_a(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Xa(t,e,n,i,s,g,o){if(!!t){!o&&g&&Gk(t,i,s,g);for(var r=t,a,I;t.prev!==t.next;){if(a=t.prev,I=t.next,g?hk(t,i,s,g):uk(t)){e.push(a.i/n),e.push(t.i/n),e.push(I.i/n),_a(t),t=I.next,r=I.next;continue}if(t=I,t===r){o?o===1?(t=mk(ws(t),e,n),Xa(t,e,n,i,s,g,2)):o===2&&fk(t,e,n,i,s,g):Xa(ws(t),e,n,i,s,g,1);break}}}}function uk(t){var e=t.prev,n=t,i=t.next;if($e(e,n,i)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(ao(e.x,e.y,n.x,n.y,i.x,i.y,s.x,s.y)&&$e(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function hk(t,e,n,i){var s=t.prev,g=t,o=t.next;if($e(s,g,o)>=0)return!1;for(var r=s.x<g.x?s.x<o.x?s.x:o.x:g.x<o.x?g.x:o.x,a=s.y<g.y?s.y<o.y?s.y:o.y:g.y<o.y?g.y:o.y,I=s.x>g.x?s.x>o.x?s.x:o.x:g.x>o.x?g.x:o.x,l=s.y>g.y?s.y>o.y?s.y:o.y:g.y>o.y?g.y:o.y,C=n0(r,a,e,n,i),c=n0(I,l,e,n,i),A=t.prevZ,d=t.nextZ;A&&A.z>=C&&d&&d.z<=c;){if(A!==t.prev&&A!==t.next&&ao(s.x,s.y,g.x,g.y,o.x,o.y,A.x,A.y)&&$e(A.prev,A,A.next)>=0||(A=A.prevZ,d!==t.prev&&d!==t.next&&ao(s.x,s.y,g.x,g.y,o.x,o.y,d.x,d.y)&&$e(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;A&&A.z>=C;){if(A!==t.prev&&A!==t.next&&ao(s.x,s.y,g.x,g.y,o.x,o.y,A.x,A.y)&&$e(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&ao(s.x,s.y,g.x,g.y,o.x,o.y,d.x,d.y)&&$e(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function mk(t,e,n){var i=t;do{var s=i.prev,g=i.next.next;!Ec(s,g)&&aR(s,i,i.next,g)&&Ya(s,g)&&Ya(g,s)&&(e.push(s.i/n),e.push(i.i/n),e.push(g.i/n),_a(i),_a(i.next),i=t=g),i=i.next}while(i!==t);return ws(i)}function fk(t,e,n,i,s,g){var o=t;do{for(var r=o.next.next;r!==o.prev;){if(o.i!==r.i&&Fk(o,r)){var a=IR(o,r);o=ws(o,o.next),a=ws(a,a.next),Xa(o,e,n,i,s,g),Xa(a,e,n,i,s,g);return}r=r.next}o=o.next}while(o!==t)}function pk(t,e,n,i){var s=[],g,o,r,a,I;for(g=0,o=e.length;g<o;g++)r=e[g]*i,a=g<o-1?e[g+1]*i:t.length,I=rR(t,r,a,i,!1),I===I.next&&(I.steiner=!0),s.push(Rk(I));for(s.sort(Bk),g=0;g<s.length;g++)n=bk(s[g],n),n=ws(n,n.next);return n}function Bk(t,e){return t.x-e.x}function bk(t,e){var n=yk(t,e);if(!n)return e;var i=IR(n,t),s=ws(n,n.next);return ws(i,i.next),e===n?s:e}function yk(t,e){var n=e,i=t.x,s=t.y,g=-1/0,o;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var r=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(r<=i&&r>g){if(g=r,r===i){if(s===n.y)return n;if(s===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===g)return o;var a=o,I=o.x,l=o.y,C=1/0,c;n=o;do i>=n.x&&n.x>=I&&i!==n.x&&ao(s<l?i:g,s,I,l,s<l?g:i,s,n.x,n.y)&&(c=Math.abs(s-n.y)/(i-n.x),Ya(n,t)&&(c<C||c===C&&(n.x>o.x||n.x===o.x&&vk(o,n)))&&(o=n,C=c)),n=n.next;while(n!==a);return o}function vk(t,e){return $e(t.prev,t,e.prev)<0&&$e(e.next,t,t.next)<0}function Gk(t,e,n,i){var s=t;do s.z===null&&(s.z=n0(s.x,s.y,e,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,Zk(s)}function Zk(t){var e,n,i,s,g,o,r,a,I=1;do{for(n=t,t=null,g=null,o=0;n;){for(o++,i=n,r=0,e=0;e<I&&(r++,i=i.nextZ,!!i);e++);for(a=I;r>0||a>0&&i;)r!==0&&(a===0||!i||n.z<=i.z)?(s=n,n=n.nextZ,r--):(s=i,i=i.nextZ,a--),g?g.nextZ=s:t=s,s.prevZ=g,g=s;n=i}g.nextZ=null,I*=2}while(o>1);return t}function n0(t,e,n,i,s){return t=32767*(t-n)*s,e=32767*(e-i)*s,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Rk(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function ao(t,e,n,i,s,g,o,r){return(s-o)*(e-r)-(t-o)*(g-r)>=0&&(t-o)*(i-r)-(n-o)*(e-r)>=0&&(n-o)*(g-r)-(s-o)*(i-r)>=0}function Fk(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Sk(t,e)&&(Ya(t,e)&&Ya(e,t)&&Vk(t,e)&&($e(t.prev,t,e.prev)||$e(t,e.prev,e))||Ec(t,e)&&$e(t.prev,t,t.next)>0&&$e(e.prev,e,e.next)>0)}function $e(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ec(t,e){return t.x===e.x&&t.y===e.y}function aR(t,e,n,i){var s=sl($e(t,e,n)),g=sl($e(t,e,i)),o=sl($e(n,i,t)),r=sl($e(n,i,e));return!!(s!==g&&o!==r||s===0&&il(t,n,e)||g===0&&il(t,i,e)||o===0&&il(n,t,i)||r===0&&il(n,e,i))}function il(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function sl(t){return t>0?1:t<0?-1:0}function Sk(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&aR(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ya(t,e){return $e(t.prev,t,t.next)<0?$e(t,e,t.next)>=0&&$e(t,t.prev,e)>=0:$e(t,e,t.prev)<0||$e(t,t.next,e)<0}function Vk(t,e){var n=t,i=!1,s=(t.x+e.x)/2,g=(t.y+e.y)/2;do n.y>g!=n.next.y>g&&n.next.y!==n.y&&s<(n.next.x-n.x)*(g-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function IR(t,e){var n=new i0(t.i,t.x,t.y),i=new i0(e.i,e.x,e.y),s=t.next,g=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,g.next=i,i.prev=g,i}function ty(t,e,n,i){var s=new i0(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function _a(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function i0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Tc.deviation=function(t,e,n,i){var s=e&&e.length,g=s?e[0]*n:t.length,o=Math.abs(s0(t,0,g,n));if(s)for(var r=0,a=e.length;r<a;r++){var I=e[r]*n,l=r<a-1?e[r+1]*n:t.length;o-=Math.abs(s0(t,I,l,n))}var C=0;for(r=0;r<i.length;r+=3){var c=i[r]*n,A=i[r+1]*n,d=i[r+2]*n;C+=Math.abs((t[c]-t[d])*(t[A+1]-t[c+1])-(t[c]-t[A])*(t[d+1]-t[c+1]))}return o===0&&C===0?0:Math.abs((C-o)/o)};function s0(t,e,n,i){for(var s=0,g=e,o=n-i;g<n;g+=i)s+=(t[o]-t[g])*(t[g+1]+t[o+1]),o=g;return s}Tc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var g=0;g<t[s].length;g++)for(var o=0;o<e;o++)n.vertices.push(t[s][g][o]);s>0&&(i+=t[s-1].length,n.holes.push(i))}return n};const gl=$2.CLOCKWISE,ny=$2.COUNTER_CLOCKWISE,as={isClosed:!0};function Uk(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function xk(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Wk(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function wk(t,e,n,i){for(let s=0;s<e;s++)if(t[n+s]!==t[i-e+s])return!1;return!0}function iy(t,e,n,i,s){let g=e;const o=n.length;for(let r=0;r<o;r++)for(let a=0;a<i;a++)t[g++]=n[r][a]||0;if(!Wk(n))for(let r=0;r<i;r++)t[g++]=n[0][r]||0;return as.start=e,as.end=g,as.size=i,eR(t,s,as),g}function sy(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,g=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;g=g||n.length;const r=g-s;if(r<=0)return e;let a=e;for(let I=0;I<r;I++)t[a++]=n[s+I];if(!wk(n,i,s,g))for(let I=0;I<i;I++)t[a++]=n[s+I];return as.start=e,as.end=a,as.size=i,eR(t,o,as),a}function lR(t,e){Uk(t);const n=[],i=[];if(t.positions){const{positions:s,holeIndices:g}=t;if(g){let o=0;for(let r=0;r<=g.length;r++)o=sy(n,o,s,e,g[r-1],g[r],r===0?gl:ny),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=s}if(Number.isFinite(t[0]))return sy(n,0,t,e,0,n.length,gl),n;if(!xk(t)){let s=0;for(const[g,o]of t.entries())s=iy(n,s,o,e,g===0?gl:ny),i.push(s);return i.pop(),{positions:n,holeIndices:i}}return iy(n,0,t,e,gl),n}function Nk(t,e,n){let i=null;t.holeIndices&&(i=t.holeIndices.map(g=>g/e));let s=t.positions||t;if(n){const g=s.length;s=s.slice();const o=[];for(let r=0;r<g;r+=e){o[0]=s[r],o[1]=s[r+1];const a=n(o);s[r]=a[0],s[r+1]=a[1]}}return Im.exports(s,i,e)}class Tk extends j2{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;n&&(this.vertexCount=(n.value||n).length)}normalizeGeometry(e){if(this.normalize){if(e=lR(e,this.positionSize),this.opts.resolution)return nR(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return gk(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}getGeometrySize(e){if(Array.isArray(e)&&!Number.isFinite(e[0])){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return(e.positions||e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):()=>null}updateGeometryAttributes(e,n){if(Array.isArray(e)&&!Number.isFinite(e[0]))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,n){let{geometryIndex:i,vertexStart:s,indexStart:g}=n;const{attributes:o,indexStarts:r,typedArrayManager:a}=this;let I=o.indices;if(!I)return;let l=g;const C=Nk(e,this.positionSize,this.opts.preproject);I=a.allocate(I,g+C.length,{copy:!0});for(let c=0;c<C.length;c++)I[l++]=C[c]+s;r[i+1]=g+C.length,o.indices=I}_updatePositions(e,n){let{vertexStart:i,geometrySize:s}=n;const{attributes:{positions:g},positionSize:o}=this;if(!g)return;const r=e.positions||e;for(let a=i,I=0;I<s;a++,I++){const l=r[I*o],C=r[I*o+1],c=o>2?r[I*o+2]:0;g[a*3]=l,g[a*3+1]=C,g[a*3+2]=c}}_updateVertexValid(e,n){let{vertexStart:i,geometrySize:s}=n;const{attributes:{vertexValid:g},positionSize:o}=this,r=e&&e.holeIndices;if(e&&e.edgeTypes?g.set(e.edgeTypes,i):g.fill(1,i,i+s),r)for(let a=0;a<r.length;a++)g[i+r[a]/o-1]=0;g[i+s-1]=0}}const CR=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;

#ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
    geometry.normal = normal;
  }

  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ek=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(CR,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),Qk=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(CR,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),Xk=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,EC=[0,0,0,255],Yk={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:EC},getLineColor:{type:"accessor",value:EC},material:!0},ol={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class uI extends hn{getShaders(e){return super.getShaders({vs:e==="top"?Ek:Qk,fs:Xk,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[_s,jQ,Hs]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===Ce.DEFAULT&&(i=Ce.LNGLAT),this.setState({numInstances:0,polygonTesselator:new Tk({preproject:i===Ce.LNGLAT&&n.projectFlat,fp64:this.use64bitPositions(),IndexType:!e||Ph(e,Te.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const s=this.getAttributeManager(),g=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:g},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ol,accessor:"getPolygon",update:this.calculatePositions,noAlloc:g,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:g},elevations:{size:1,transition:ol,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ol,accessor:"getFillColor",defaultValue:EC,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ol,accessor:"getLineColor",defaultValue:EC,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,r)=>{let{index:a,target:I}=r;return this.encodePickingColor(o&&o.__source?o.__source.index:a,I)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(g=>g.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw(e){let{uniforms:n}=e;const{extruded:i,filled:s,wireframe:g,elevationScale:o}=this.props,{topModel:r,sideModel:a,polygonTesselator:I}=this.state,l={...n,extruded:Boolean(i),elevationScale:o};a&&(a.setInstanceCount(I.instanceCount-1),a.setUniforms(l),g&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),s&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),r&&(r.setVertexCount(I.vertexCount),r.setUniforms(l).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:s}=e,g=this.getAttributeManager();if(s.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var r;(r=this.state.models)===null||r===void 0||r.forEach(a=>a.delete()),this.setState(this._getModels(this.context.gl)),g.invalidateAll()}}updateGeometry(e){let{props:n,oldProps:i,changeFlags:s}=e;if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,r=n.data.attributes||{};o.updateGeometry({data:n.data,normalize:n._normalize,geometryBuffer:r.getPolygon,buffers:r,getGeometry:n.getPolygon,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:s}=this.props;let g,o;if(i){const r=this.getShaders("top");r.defines.NON_INSTANCED_MODEL=1,g=new Fn(e,{...r,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return s&&(o=new Fn(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new hi({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,g].filter(Boolean),topModel:g,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}uI.layerName="SolidPolygonLayer";uI.defaultProps=Yk;function cR(t){let{data:e,getIndex:n,dataRange:i,replace:s}=t;const{startRow:g=0,endRow:o=1/0}=i,r=e.length;let a=r,I=r;for(let A=0;A<r;A++){const d=n(e[A]);if(a>A&&d>=g&&(a=A),d>=o){I=A;break}}let l=a;const C=I-a!==s.length,c=C&&e.slice(I);for(let A=0;A<s.length;A++)e[l++]=s[A];if(C){for(let A=0;A<c.length;A++)e[l++]=c[A];e.length=l}return{startRow:a,endRow:a+s.length}}const AR=[0,0,0,255],_k=[0,0,0,255],Hk={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:_k},getLineColor:{type:"accessor",value:AR},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class QC extends Un{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&me.removed("getLineDashArray","PathStyleExtension")()}updateState(e){let{oldProps:n,props:i,changeFlags:s}=e;const g=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(g&&Array.isArray(s.dataChanged)){const o=this.state.paths.slice(),r=s.dataChanged.map(a=>cR({data:o,getIndex:I=>I.__source.index,dataRange:a,replace:this._getPaths(a)}));this.setState({paths:o,pathsDiff:r})}else g&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{data:n,getPolygon:i,positionFormat:s,_normalize:g}=this.props,o=[],r=s==="XY"?2:3,{startRow:a,endRow:I}=e,{iterable:l,objectInfo:C}=dI(n,a,I);for(const c of l){C.index++;let A=i(c,C);g&&(A=lR(A,r));const{holeIndices:d}=A,h=A.positions||A;if(d)for(let u=0;u<=d.length;u++){const m=h.slice(d[u-1]||0,d[u]||h.length);o.push(this.getSubLayerRow({path:m},c,C.index))}else o.push(this.getSubLayerRow({path:h},c,C.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:s,extruded:g,wireframe:o,_normalize:r,_windingOrder:a,elevationScale:I,transitions:l,positionFormat:C}=this.props,{lineWidthUnits:c,lineWidthScale:A,lineWidthMinPixels:d,lineWidthMaxPixels:h,lineJointRounded:u,lineMiterLimit:m,lineDashJustified:f}=this.props,{getFillColor:p,getLineColor:B,getLineWidth:G,getLineDashArray:y,getElevation:U,getPolygon:V,updateTriggers:F,material:W}=this.props,{paths:M,pathsDiff:E}=this.state,H=this.getSubLayerClass("fill",uI),P=this.getSubLayerClass("stroke",Nc),z=this.shouldRenderSubLayer("fill",M)&&new H({_dataDiff:n,extruded:g,elevationScale:I,filled:s,wireframe:o,_normalize:r,_windingOrder:a,getElevation:U,getFillColor:p,getLineColor:g&&o?B:AR,material:W,transitions:l},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:F.getPolygon,getElevation:F.getElevation,getFillColor:F.getFillColor,lineColors:g&&o,getLineColor:F.getLineColor}}),{data:e,positionFormat:C,getPolygon:V}),re=!g&&i&&this.shouldRenderSubLayer("stroke",M)&&new P({_dataDiff:E&&(()=>E),widthUnits:c,widthScale:A,widthMinPixels:d,widthMaxPixels:h,jointRounded:u,miterLimit:m,dashJustified:f,_pathType:"loop",transitions:l&&{getWidth:l.getLineWidth,getColor:l.getLineColor,getPath:l.getPolygon},getColor:this.getSubLayerAccessor(B),getWidth:this.getSubLayerAccessor(G),getDashArray:this.getSubLayerAccessor(y)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:F.getLineWidth,getColor:F.getLineColor,getDashArray:F.getLineDashArray}}),{data:M,positionFormat:C,getPath:ue=>ue.path});return[!g&&z,re,g&&z]}}QC.layerName="PolygonLayer";QC.defaultProps=Hk;function kk(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?Kk(t,i,n):null}function Kk(t,e,n){const i={properties:{...t.properties[e]}};for(const s in t.numericProps)i.properties[s]=t.numericProps[s].value[n];return i}function Lk(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const s=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(s.length*3);const g=[];for(let o=0;o<s.length;o++)e(s[o],g),n[i][o*3+0]=g[0],n[i][o*3+1]=g[1],n[i][o*3+2]=g[2]}return n}const Mk=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,gy=192/256,oy=[],Pk={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class lm extends wc{getShaders(){return{...super.getShaders(),fs:Mk}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,i)=>{let{index:s,target:g}=i;return this.encodePickingColor(s,g)}}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:s}=n;s!==i.outlineColor&&(s=s.map(g=>g/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!n.sdf&&n.outlineWidth&&me.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:s}=this.props,{outlineColor:g}=this.state;e.uniforms={...e.uniforms,buffer:gy,outlineBuffer:s?Math.max(i,gy*(1-s)):-1,gamma:i,sdf:Boolean(n),outlineColor:g},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).map(n=>super.getInstanceOffset(n)):oy}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).map(n=>super.getInstanceIconFrame(n)):oy}}lm.layerName="MultiIconLayer";lm.defaultProps=Pk;var Cm={exports:{}};Cm.exports=hI;Cm.exports.default=hI;var Zo=1e20;function hI(t,e,n,i,s,g){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=s||"sans-serif",this.fontWeight=g||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,r=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(r*r),this.gridInner=new Float64Array(r*r),this.f=new Float64Array(r),this.z=new Float64Array(r+1),this.v=new Uint16Array(r),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Jk(t,e,n,i,s,g,o){g.fill(Zo,0,e*n),o.fill(0,0,e*n);for(var r=(e-i)/2,a=0;a<s;a++)for(var I=0;I<i;I++){var l=(a+r)*e+I+r,C=t.data[4*(a*i+I)+3]/255;if(C===1)g[l]=0,o[l]=Zo;else if(C===0)g[l]=Zo,o[l]=0;else{var c=Math.max(0,.5-C),A=Math.max(0,C-.5);g[l]=c*c,o[l]=A*A}}}function Dk(t,e,n,i,s,g,o){for(var r=0;r<e*n;r++){var a=Math.sqrt(i[r])-Math.sqrt(s[r]);t[r]=Math.round(255-255*(a/g+o))}}hI.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,s=2*this.buffer,g,o,r,a,I,l,C,c;e&&this.useMetrics?(I=Math.floor(n.actualBoundingBoxAscent),c=this.buffer+Math.ceil(n.actualBoundingBoxAscent),l=this.buffer,C=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),a=Math.min(this.size-l,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),g=o+s,r=a+s,this.ctx.textBaseline="alphabetic"):(g=o=this.size,r=a=this.size,I=19*this.fontSize/24,l=C=0,c=this.middle,this.ctx.textBaseline="middle");var A;o&&a&&(this.ctx.clearRect(C,l,o,a),this.ctx.fillText(t,this.buffer,c),A=this.ctx.getImageData(C,l,o,a));var d=new Uint8ClampedArray(g*r);return Jk(A,g,r,o,a,this.gridOuter,this.gridInner),ry(this.gridOuter,g,r,this.f,this.v,this.z),ry(this.gridInner,g,r,this.f,this.v,this.z),Dk(d,g,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:o,height:a,sdfWidth:g,sdfHeight:r,top:I,left:0,advance:i}}};hI.prototype.draw=function(t){return this._draw(t,!1).data};hI.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function ry(t,e,n,i,s,g){for(var o=0;o<e;o++)ay(t,o,e,n,i,s,g);for(var r=0;r<n;r++)ay(t,r*e,1,e,i,s,g)}function ay(t,e,n,i,s,g,o){var r,a,I,l;for(g[0]=0,o[0]=-Zo,o[1]=Zo,r=0;r<i;r++)s[r]=t[e+r*n];for(r=1,a=0,I=0;r<i;r++){do l=g[a],I=(s[r]-s[l]+r*r-l*l)/(r-l)/2;while(I<=o[a]&&--a>-1);a++,g[a]=r,o[a]=I,o[a+1]=Zo}for(r=0,a=0;r<i;r++){for(;o[a+1]<r;)a++;l=g[a],t[e+r*n]=s[l]+(r-l)*(r-l)}}const zk=32,Ok=[];function jk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function qk(t){let{characterSet:e,getFontWidth:n,fontHeight:i,buffer:s,maxCanvasWidth:g,mapping:o={},xOffset:r=0,yOffset:a=0}=t,I=0,l=r,C=0;for(const A of e)if(!o[A]){const d=n(A,C++);l+d+s*2>g&&(l=0,I++),o[A]={x:l+s,y:a+I*(i+s*2)+s,width:d,height:i},l+=d+s*2}const c=i+s*2;return{mapping:o,xOffset:l,yOffset:a+I*c,canvasHeight:jk(a+(I+1)*c)}}function dR(t,e,n,i){let s=0;for(let g=e;g<n;g++){const o=t[g];let r=null;const a=i&&i[o];a&&(r=a.width),s+=r}return s}function uR(t,e,n,i,s,g){let o=e,r=0;for(let a=e;a<n;a++){const I=dR(t,a,a+1,s);r+I>i&&(o<a&&g.push(a),o=a,r=0),r+=I}return r}function $k(t,e,n,i,s,g){let o=e,r=e,a=e,I=0;for(let l=e;l<n;l++)if((t[l]===" "||t[l+1]===" "||l+1===n)&&(a=l+1),a>r){let C=dR(t,r,a,s);I+C>i&&(o<r&&(g.push(r),o=r,I=0),C>i&&(C=uR(t,r,a,i,s,g),o=g[g.length-1])),r=a,I+=C}return I}function eK(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,g=arguments.length>5?arguments[5]:void 0;g===void 0&&(g=t.length);const o=[];return e==="break-all"?uR(t,s,g,n,i,o):$k(t,s,g,n,i,o),o}function tK(t,e,n,i,s,g){let o=0,r=0;for(let a=e;a<n;a++){const I=t[a],l=i[I];l?(r||(r=l.height),s[a]=o+l.width/2,o+=l.width):(me.warn("Missing character: ".concat(I," (").concat(I.codePointAt(0),")"))(),s[a]=o,o+=zk)}g[0]=o,g[1]=r}function Iy(t,e,n,i,s){t=Array.from(t);const g=t.length,o=new Array(g),r=new Array(g),a=new Array(g),I=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,l=[0,0],C=[];let c=0,A=0,d=0;for(let h=0;h<=g;h++){const u=t[h];if((u===`
`||h===g)&&(d=h),d>A){const m=I?eK(t,n,i,s,A,d):Ok;for(let f=0;f<=m.length;f++){const p=f===0?A:m[f-1],B=f<m.length?m[f]:d;tK(t,p,B,s,o,C);for(let G=p;G<B;G++)r[G]=c+C[1]/2,a[G]=C[0];c=c+C[1]*e,l[0]=Math.max(l[0],C[0])}A=d}u===`
`&&(o[A]=0,r[A]=0,a[A]=0,A++)}return l[1]=c,{x:o,y:r,rowWidth:a,size:l}}function nK(t){let{value:e,length:n,stride:i,offset:s,startIndices:g,characterSet:o}=t;const r=e.BYTES_PER_ELEMENT,a=i?i/r:1,I=s?s/r:0,l=g[n]||Math.ceil((e.length-I)/a),C=o&&new Set,c=new Array(n);let A=e;if(a>1||I>0){A=new e.constructor(l);for(let d=0;d<l;d++)A[d]=e[d*a+I]}for(let d=0;d<n;d++){const h=g[d],u=g[d+1]||l,m=A.subarray(h,u);c[d]=String.fromCodePoint.apply(null,m),C&&m.forEach(C.add,C)}if(C)for(const d of C)o.add(String.fromCodePoint(d));return{texts:c,characterCount:l}}class hR{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;this.limit=e,this.clear()}clear(){this._cache={},this._order=[]}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}_deleteCache(e){delete this._cache[e]}_deleteOrder(e){const n=this._order.findIndex(i=>i===e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function iK(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const mR=iK(),fR="Monaco, monospace",pR="normal",BR=64,bR=4,yR=.25,vR=12,ly=1024,sK=.9,Cy=1.2,GR=3;let XC=new hR(GR);const gK=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function oK(t,e){const n=XC.get(t);if(!n)return e;const i=[],s=n.mapping;let g=Object.keys(s);g=new Set(g);let o=e;return o instanceof Array&&(o=new Set(o)),o.forEach(r=>{g.has(r)||i.push(r)}),i}function rK(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function cy(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="baseline",t.textAlign="left"}function aK(t){me.assert(Number.isFinite(t)&&t>=GR,"Invalid cache limit"),XC=new hR(t)}class IK{constructor(){this.props={fontFamily:fR,fontWeight:pR,characterSet:mR,fontSize:BR,buffer:bR,sdf:!1,cutoff:yR,radius:vR},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return Cy}setProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gK.forEach(o=>{o in e&&(this.props[o]=e[o])});const n=this._key;this._key=this._getKey();const i=oK(this._key,this.props.characterSet),s=XC.get(this._key);if(s&&i.length===0){this._key!==n&&(this._atlas=s);return}const g=this._generateFontAtlas(this._key,i,s);this._atlas=g,XC.set(this._key,g)}_generateFontAtlas(e,n,i){const{fontFamily:s,fontWeight:g,fontSize:o,buffer:r,sdf:a,radius:I,cutoff:l}=this.props;let C=i&&i.data;C||(C=document.createElement("canvas"),C.width=ly);const c=C.getContext("2d");cy(c,s,o,g);const{mapping:A,canvasHeight:d,xOffset:h,yOffset:u}=qk({getFontWidth:m=>c.measureText(m).width,fontHeight:o*Cy,buffer:r,characterSet:n,maxCanvasWidth:ly,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(C.height!==d){const m=c.getImageData(0,0,C.width,C.height);C.height=d,c.putImageData(m,0,0)}if(cy(c,s,o,g),a){const m=new Cm.exports(o,r,I,l,s,g),f=c.getImageData(0,0,m.size,m.size);for(const p of n)rK(m.draw(p),f),c.putImageData(f,A[p].x-r,A[p].y+r)}else for(const m of n)c.fillText(m,A[m].x,A[m].y+o*sK);return{xOffset:h,yOffset:u,mapping:A,data:C,width:C.width,height:C.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:s,sdf:g,radius:o,cutoff:r}=this.props;return g?"".concat(e," ").concat(n," ").concat(i," ").concat(s," ").concat(o," ").concat(r):"".concat(e," ").concat(n," ").concat(i," ").concat(s)}}const lK=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,CK=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,cK={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class cm extends hn{getShaders(){return super.getShaders({vs:lK,fs:CK,modules:[_s,Hs]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:s}=e;if(super.updateState({props:n,oldProps:i,changeFlags:s}),s.extensionsChanged){var g;const{gl:o}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{billboard:i,sizeScale:s,sizeUnits:g,sizeMinPixels:o,sizeMaxPixels:r,getLineWidth:a}=this.props;let{padding:I}=this.props;I.length<4&&(I=[I[0],I[1],I[0],I[1]]),this.state.model.setUniforms(n).setUniforms({billboard:i,stroked:Boolean(a),padding:I,sizeUnits:Us[g],sizeScale:s,sizeMinPixels:o,sizeMaxPixels:r}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}cm.layerName="TextBackgroundLayer";cm.defaultProps=cK;const Ay={fontSize:BR,buffer:bR,sdf:!1,radius:vR,cutoff:yR,smoothing:.1},dy={start:1,middle:0,end:-1},uy={top:1,center:0,bottom:-1},Cd=[0,0,0,255],AK=1,dK=["fontSize","buffer","sdf","radius","cutoff"],uK={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Cd},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:mR},fontFamily:fR,fontWeight:pR,lineHeight:AK,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Cd},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Cd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class qo extends Un{initializeState(){this.state={styleVersion:0,fontAtlasManager:new IK}}updateState(e){let{props:n,oldProps:i,changeFlags:s}=e;const g=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText),o=this.state.characterSet;g&&this._updateText();const r=o!==this.state.characterSet||this._fontChanged(i,n);r&&this._updateFontAtlas(i,n),(r||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo(e){let{info:n}=e;return n.object=n.index>=0?this.props.data[n.index]:null,n}_updateFontAtlas(e,n){const{fontSettings:i,fontFamily:s,fontWeight:g}=n,{fontAtlasManager:o,characterSet:r}=this.state;o.setProps({...Ay,...i,characterSet:r,fontFamily:s,fontWeight:g})}_fontChanged(e,n){if(e.fontFamily!==n.fontFamily||e.fontWeight!==n.fontWeight)return!0;if(e.fontSettings===n.fontSettings)return!1;const i=e.fontSettings||{},s=n.fontSettings||{};return dK.some(g=>i[g]!==s[g])}_updateText(){const{data:e,characterSet:n}=this.props,i=e.attributes&&e.attributes.getText;let{getText:s}=this.props,{startIndices:g}=e,o;const r=n==="auto"&&new Set;if(i&&g){const{texts:a,characterCount:I}=nK({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:g,characterSet:r});o=I,s=(l,C)=>{let{index:c}=C;return a[c]}}else{const{iterable:a,objectInfo:I}=dI(e);g=[0],o=0;for(const l of a){I.index++;const C=Array.from(s(l,I)||"");r&&C.forEach(r.add,r),o+=C.length,g.push(o)}}this.setState({getText:s,startIndices:g,numInstances:o,characterSet:r||n})}getBoundingRect(e,n){const i=this.state.fontAtlasManager.mapping,{getText:s}=this.state,{wordBreak:g,maxWidth:o,lineHeight:r,getTextAnchor:a,getAlignmentBaseline:I}=this.props,l=s(e,n)||"",{size:[C,c]}=Iy(l,r,g,o,i),A=dy[typeof a=="function"?a(e,n):a],d=uy[typeof I=="function"?I(e,n):I];return[(A-1)*C/2,(d-1)*c/2,C,c]}getIconOffsets(e,n){const i=this.state.fontAtlasManager.mapping,{getText:s}=this.state,{wordBreak:g,maxWidth:o,lineHeight:r,getTextAnchor:a,getAlignmentBaseline:I}=this.props,l=s(e,n)||"",{x:C,y:c,rowWidth:A,size:[d,h]}=Iy(l,r,g,o,i),u=dy[typeof a=="function"?a(e,n):a],m=uy[typeof I=="function"?I(e,n):I],f=C.length,p=new Array(f*2);let B=0;for(let G=0;G<f;G++){const y=(1-u)*(d-A[G])/2;p[B++]=(u-1)*d/2+y+C[G],p[B++]=(m-1)*h/2+c[G]}return p}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:s,texture:g,mapping:o},styleVersion:r}=this.state,{data:a,_dataDiff:I,getPosition:l,getColor:C,getSize:c,getAngle:A,getPixelOffset:d,getBackgroundColor:h,getBorderColor:u,getBorderWidth:m,backgroundPadding:f,background:p,billboard:B,fontSettings:G,outlineWidth:y,outlineColor:U,sizeScale:V,sizeUnits:F,sizeMinPixels:W,sizeMaxPixels:M,transitions:E,updateTriggers:H}=this.props,P=this.getSubLayerClass("characters",lm),z=this.getSubLayerClass("background",cm);return[p&&new z({getFillColor:h,getLineColor:u,getLineWidth:m,padding:f,getPosition:l,getSize:c,getAngle:A,getPixelOffset:d,billboard:B,sizeScale:V/this.state.fontAtlasManager.props.fontSize,sizeUnits:F,sizeMinPixels:W,sizeMaxPixels:M,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getSize:E.getSize,getFillColor:E.getBackgroundColor,getLineColor:E.getBorderColor,getLineWidth:E.getBorderWidth,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:H.getPosition,getAngle:H.getAngle,getSize:H.getSize,getFillColor:H.getBackgroundColor,getLineColor:H.getBorderColor,getLineWidth:H.getBorderWidth,getPixelOffset:H.getPixelOffset,getBoundingRect:{getText:H.getText,getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:r}}}),{data:a.attributes?{length:a.length,attributes:a.attributes.background||{}}:a,_dataDiff:I,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new P({sdf:G.sdf,smoothing:Number.isFinite(G.smoothing)?G.smoothing:Ay.smoothing,outlineWidth:y,outlineColor:U,iconAtlas:g,iconMapping:o,getPosition:l,getColor:C,getSize:c,getAngle:A,getPixelOffset:d,billboard:B,sizeScale:V*s,sizeUnits:F,sizeMinPixels:W*s,sizeMaxPixels:M*s,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getColor:E.getColor,getSize:E.getSize,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:H.getText,getPosition:H.getPosition,getAngle:H.getAngle,getColor:H.getColor,getSize:H.getSize,getPixelOffset:H.getPixelOffset,getIconOffsets:{getText:H.getText,getTextAnchor:H.getTextAnchor,getAlignmentBaseline:H.getAlignmentBaseline,styleVersion:r}}}),{data:a,_dataDiff:I,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets.bind(this),getIcon:i})]}static set fontAtlasCacheLimit(e){aK(e)}}qo.layerName="TextLayer";qo.defaultProps=uK;const Ml={circle:{type:am,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:wc,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:qo,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Pl={type:Nc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},g0={type:uI,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ur(t){let{type:e,props:n}=t;const i={};for(const s in n)i[s]=e.defaultProps[n[s]];return i}function cd(t,e){const{transitions:n,updateTriggers:i}=t.props,s={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const g in e){const o=e[g];let r=t.props[g];g.startsWith("get")&&(r=t.getSubLayerAccessor(r),s.updateTriggers[o]=i[g],n&&(s.transitions[o]=n[g])),s[o]=r}return s}function hK(t){if(Array.isArray(t))return t;switch(me.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return me.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function hy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:g=t.length}=n;for(let o=s;o<g;o++){const r=t[o];me.assert(r&&r.geometry,"GeoJSON does not have geometry");const{geometry:a}=r;if(a.type==="GeometryCollection"){me.assert(Array.isArray(a.geometries),"GeoJSON does not have geometries array");const{geometries:I}=a;for(let l=0;l<I.length;l++){const C=I[l];my(C,i,e,r,o)}}else my(a,i,e,r,o)}return i}function my(t,e,n,i,s){const{type:g,coordinates:o}=t,{pointFeatures:r,lineFeatures:a,polygonFeatures:I,polygonOutlineFeatures:l}=e;if(!fK(g,o)){me.warn("".concat(g," coordinates are malformed"))();return}switch(g){case"Point":r.push(n({geometry:t},i,s));break;case"MultiPoint":o.forEach(C=>{r.push(n({geometry:{type:"Point",coordinates:C}},i,s))});break;case"LineString":a.push(n({geometry:t},i,s));break;case"MultiLineString":o.forEach(C=>{a.push(n({geometry:{type:"LineString",coordinates:C}},i,s))});break;case"Polygon":I.push(n({geometry:t},i,s)),o.forEach(C=>{l.push(n({geometry:{type:"LineString",coordinates:C}},i,s))});break;case"MultiPolygon":o.forEach(C=>{I.push(n({geometry:{type:"Polygon",coordinates:C}},i,s)),C.forEach(c=>{l.push(n({geometry:{type:"LineString",coordinates:c}},i,s))})});break}}const mK={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function fK(t,e){let n=mK[t];for(me.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function ZR(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function rl(t){return t.geometry.coordinates}function pK(t,e){const n=ZR(),{pointFeatures:i,lineFeatures:s,polygonFeatures:g,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=rl,n.lines.data=s,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=rl,n.polygons.data=g,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=rl,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=rl,n}function BK(t,e){const n=ZR(),{points:i,lines:s,polygons:g}=t,o=Lk(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{getPath:s.positions,instancePickingColors:{size:3,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.lines._pathType="open",n.polygons.data={length:g.polygonIndices.value.length-1,startIndices:g.polygonIndices.value,attributes:{getPolygon:g.positions,pickingColors:{size:3,value:o.polygons}},properties:g.properties,numericProps:g.numericProps,featureIds:g.featureIds},n.polygons._normalize=!1,g.triangles&&(n.polygons.data.attributes.indices=g.triangles.value),n.polygonsOutline.data={length:g.primitivePolygonIndices.value.length-1,startIndices:g.primitivePolygonIndices.value,attributes:{getPath:g.positions,instancePickingColors:{size:3,value:o.polygons}},properties:g.properties,numericProps:g.numericProps,featureIds:g.featureIds},n.polygonsOutline._pathType="open",n}const bK=["points","linestrings","polygons"],yK={...Ur(Ml.circle),...Ur(Ml.icon),...Ur(Ml.text),...Ur(Pl),...Ur(g0),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Am extends Un{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&me.removed("getLineDashArray","PathStyleExtension")()}updateState(e){let{props:n,changeFlags:i}=e;if(!i.dataChanged)return;const{data:s}=this.props,g=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:g}),g?this._updateStateBinary({props:n,changeFlags:i}):this._updateStateJSON({props:n,changeFlags:i})}_updateStateBinary(e){let{props:n,changeFlags:i}=e;const s=BK(n.data,this.encodePickingColor);this.setState({layerProps:s})}_updateStateJSON(e){let{props:n,changeFlags:i}=e;const s=hK(n.data),g=this.getSubLayerRow.bind(this);let o={};const r={};if(Array.isArray(i.dataChanged)){const I=this.state.features;for(const l in I)o[l]=I[l].slice(),r[l]=[];for(const l of i.dataChanged){const C=hy(s,g,l);for(const c in I)r[c].push(cR({data:o[c],getIndex:A=>A.__source.index,dataRange:l,replace:C[c]}))}}else o=hy(s,g);const a=pK(o,r);this.setState({features:o,featuresDiff:r,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{sourceLayer:i}=n;return n.featureType=bK.find(s=>i.id.startsWith("".concat(this.id,"-").concat(s,"-"))),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(n)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,s="polygons-fill",g=this.shouldRenderSubLayer(s,i.polygons.data)&&this.getSubLayerClass(s,g0.type);if(g){const o=cd(this,g0.props),r=e&&n;return r||delete o.getLineColor,o.updateTriggers.lineColors=r,new g(o,this.getSubLayerProps({id:s,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,s="polygons-stroke",g="linestrings",o=!e&&n&&this.shouldRenderSubLayer(s,i.polygonsOutline.data)&&this.getSubLayerClass(s,Pl.type),r=this.shouldRenderSubLayer(g,i.lines.data)&&this.getSubLayerClass(g,Pl.type);if(o||r){const a=cd(this,Pl.props);return[o&&new o(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),i.polygonsOutline),r&&new r(a,this.getSubLayerProps({id:g,updateTriggers:a.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=n.points.data.findIndex(r=>r.__source.index===s));const g=new Set(e.split("+")),o=[];for(const r of g){const a="points-".concat(r),I=Ml[r],l=I&&this.shouldRenderSubLayer(a,n.points.data)&&this.getSubLayerClass(a,I.type);if(l){const C=cd(this,I.props);o.push(new l(C,this.getSubLayerProps({id:a,updateTriggers:C.updateTriggers,highlightedObjectIndex:s}),n.points))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&n,i,s,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:g,index:o}=s,r=kk(g,o);return e(r,s)}}}Am.layerName="GeoJsonLayer";Am.defaultProps=yK;class vK{constructor(e){let{x:n,y:i,z:s}=e;this.x=n,this.y=i,this.z=s,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||me.error("byteLength not defined in tile data")(),e}async _loadData(e){let{getData:n,requestScheduler:i,onLoad:s,onError:g}=e;const{x:o,y:r,z:a,bbox:I}=this,l=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,c=await i.scheduleRequest(this,h=>h.isSelected?1:-1);if(!c){this._isCancelled=!0;return}if(this._isCancelled){c.done();return}let A=null,d;try{A=await n({x:o,y:r,z:a,bbox:I,signal:C})}catch(h){d=h||!0}finally{c.done()}if(l===this._loaderId){if(this._loader=void 0,this.content=A,this._isCancelled&&!A){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,d?g(d,this):s(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}}const Tt=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),fy=new j,GK=new j;class dm{constructor(e=[0,0,0],n=[0,0,0],i=null){i=i||fy.copy(e).add(n).scale(.5),this.center=new j(i),this.halfDiagonal=new j(n).subtract(this.center),this.minimum=new j(e),this.maximum=new j(n)}clone(){return new dm(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=GK.from(e.normal),s=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),g=this.center.dot(i)+e.distance;return g-s>0?Tt.INSIDE:g+s<0?Tt.OUTSIDE:Tt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=fy.from(e).subtract(this.center),{halfDiagonal:i}=this;let s=0,g;return g=Math.abs(n.x)-i.x,g>0&&(s+=g*g),g=Math.abs(n.y)-i.y,g>0&&(s+=g*g),g=Math.abs(n.z)-i.z,g>0&&(s+=g*g),s}}const xr=new j,py=new j;class um{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new j,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=xr.from(n),this.center=new j().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new um(this.center,this.radius)}union(e){const n=this.center,i=this.radius,s=e.center,g=e.radius,o=xr.copy(s).subtract(n),r=o.magnitude();if(i>=r+g)return this.clone();if(g>=r+i)return e.clone();const a=(i+r+g)*.5;return py.copy(o).scale((-i+a)/r).add(n),this.center.copy(py),this.radius=a,this}expand(e){e=xr.from(e);const n=e.subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const n=rQ(xr,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){e=xr.from(e);const n=e.subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,g=e.normal.dot(n)+e.distance;return g<-i?Tt.OUTSIDE:g<i?Tt.INTERSECTING:Tt.INSIDE}}const ZK=new j,RK=new j,al=new j,Il=new j,ll=new j,FK=new j,SK=new j,vi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class hm{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new j().from(e),this.halfAxes=new mt(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new j(e).len(),new j(n).len(),new j(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new j(e).normalize(),g=new j(n).normalize(),o=new j(i).normalize();return new rb().fromMatrix3(new mt([...s,...g,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const s=new rb(i),g=new mt().fromQuaternion(s);return g[0]=g[0]*n[0],g[1]=g[1]*n[0],g[2]=g[2]*n[0],g[3]=g[3]*n[1],g[4]=g[4]*n[1],g[5]=g[5]*n[1],g[6]=g[6]*n[2],g[7]=g[7]*n[2],g[8]=g[8]*n[2],this.center=new j().from(e),this.halfAxes=g,this}clone(){return new hm(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new um){const n=this.halfAxes,i=n.getColumn(0,al),s=n.getColumn(1,Il),g=n.getColumn(2,ll),o=ZK.copy(i).add(s).add(g);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,s=this.halfAxes,g=i.x,o=i.y,r=i.z,a=Math.abs(g*s[vi.COLUMN0ROW0]+o*s[vi.COLUMN0ROW1]+r*s[vi.COLUMN0ROW2])+Math.abs(g*s[vi.COLUMN1ROW0]+o*s[vi.COLUMN1ROW1]+r*s[vi.COLUMN1ROW2])+Math.abs(g*s[vi.COLUMN2ROW0]+o*s[vi.COLUMN2ROW1]+r*s[vi.COLUMN2ROW2]),I=i.dot(n)+e.distance;return I<=-a?Tt.OUTSIDE:I>=a?Tt.INSIDE:Tt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=RK.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,al),g=i.getColumn(1,Il),o=i.getColumn(2,ll),r=s.magnitude(),a=g.magnitude(),I=o.magnitude();s.normalize(),g.normalize(),o.normalize();let l=0,C;return C=Math.abs(n.dot(s))-r,C>0&&(l+=C*C),C=Math.abs(n.dot(g))-a,C>0&&(l+=C*C),C=Math.abs(n.dot(o))-I,C>0&&(l+=C*C),l}computePlaneDistances(e,n,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;const o=this.center,r=this.halfAxes,a=r.getColumn(0,al),I=r.getColumn(1,Il),l=r.getColumn(2,ll),C=FK.copy(a).add(I).add(l).add(o),c=SK.copy(C).subtract(e);let A=n.dot(c);return s=Math.min(A,s),g=Math.max(A,g),C.copy(o).add(a).add(I).subtract(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),C.copy(o).add(a).subtract(I).add(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),C.copy(o).add(a).subtract(I).subtract(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),o.copy(C).subtract(a).add(I).add(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),o.copy(C).subtract(a).add(I).subtract(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),o.copy(C).subtract(a).subtract(I).add(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),o.copy(C).subtract(a).subtract(I).subtract(l),c.copy(C).subtract(e),A=n.dot(c),s=Math.min(A,s),g=Math.max(A,g),i[0]=s,i[1]=g,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,al);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Il);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,ll);return s.transformAsPoint(e),this.halfAxes=new mt([...n,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const By=new j,by=new j;class ys{constructor(e=[0,0,1],n=0){this.normal=new j,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Lt(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=By.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,s){return this.normal.set(e,n,i),Lt(bs(this.normal.len(),1)),this.distance=s,this}clone(e){return new ys(this.normal,this.distance)}equals(e){return bs(this.distance,e.distance)&&bs(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=by.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=By.from(e);const i=this.getPointDistance(e),s=by.copy(this.normal).scale(i);return e.subtract(s).to(n)}}const yy=[new j([1,0,0]),new j([0,1,0]),new j([0,0,1])],vy=new j,VK=new j;new ys(new j(1,0,0),0);class Io{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(e=[]){this.planes=e,Lt(this.planes.every(n=>n instanceof ys))}fromBoundingSphere(e){this.planes.length=2*yy.length;const n=e.center,i=e.radius;let s=0;for(const g of yy){let o=this.planes[s],r=this.planes[s+1];o||(o=this.planes[s]=new ys),r||(r=this.planes[s+1]=new ys);const a=vy.copy(g).scale(-i).add(n);-g.dot(a),o.fromPointNormal(a,g);const I=vy.copy(g).scale(i).add(n),l=VK.copy(g).negate();-l.dot(I),r.fromPointNormal(I,l),s+=2}return this}computeVisibility(e){Lt(e);let n=Tt.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Tt.OUTSIDE:return Tt.OUTSIDE;case Tt.INTERSECTING:n=Tt.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Lt(e,"boundingVolume is required."),Lt(Number.isFinite(n),"parentPlaneMask is required."),n===Io.MASK_OUTSIDE||n===Io.MASK_INSIDE)return n;let i=Io.MASK_INSIDE;const s=this.planes;for(let g=0;g<this.planes.length;++g){const o=g<31?1<<g:0;if(g<31&&(n&o)===0)continue;const r=s[g],a=e.intersectPlane(r);if(a===Tt.OUTSIDE)return Io.MASK_OUTSIDE;a===Tt.INTERSECTING&&(i|=o)}return i}}new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;const ei=new mt,UK=new mt,xK=new mt,Cl=new mt,Gy=new mt;function WK(t,e={}){const n=u2.EPSILON20,i=10;let s=0,g=0;const o=UK,r=xK;o.identity(),r.copy(t);const a=n*wK(r);for(;g<i&&NK(r)>a;)TK(r,Cl),Gy.copy(Cl).transpose(),r.multiplyRight(Cl),r.multiplyLeft(Gy),o.multiplyRight(Cl),++s>2&&(++g,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=r.toTarget(e.diagonal),e}function wK(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const o0=[1,0,0],r0=[2,2,1];function NK(t){let e=0;for(let n=0;n<3;++n){const i=t[ei.getElementIndex(r0[n],o0[n])];e+=2*i*i}return Math.sqrt(e)}function TK(t,e){const n=u2.EPSILON15;let i=0,s=1;for(let I=0;I<3;++I){const l=Math.abs(t[ei.getElementIndex(r0[I],o0[I])]);l>i&&(s=I,i=l)}const g=o0[s],o=r0[s];let r=1,a=0;if(Math.abs(t[ei.getElementIndex(o,g)])>n){const I=t[ei.getElementIndex(o,o)],l=t[ei.getElementIndex(g,g)],C=t[ei.getElementIndex(o,g)],c=(I-l)/2/C;let A;c<0?A=-1/(-c+Math.sqrt(1+c*c)):A=1/(c+Math.sqrt(1+c*c)),r=1/Math.sqrt(1+A*A),a=A*r}return mt.IDENTITY.to(e),e[ei.getElementIndex(g,g)]=e[ei.getElementIndex(o,o)]=r,e[ei.getElementIndex(o,g)]=a,e[ei.getElementIndex(g,o)]=-a,e}const es=new j,EK=new j,QK=new j,XK=new j,YK=new j,_K=new mt,HK={diagonal:new mt,unitary:new mt};function kK(t,e=new hm){if(!t||t.length===0)return e.halfAxes=new mt([0,0,0,0,0,0,0,0,0]),e.center=new j,e;const n=t.length,i=new j(0,0,0);for(const F of t)i.add(F);const s=1/n;i.multiplyByScalar(s);let g=0,o=0,r=0,a=0,I=0,l=0;for(const F of t){const W=es.copy(F).subtract(i);g+=W.x*W.x,o+=W.x*W.y,r+=W.x*W.z,a+=W.y*W.y,I+=W.y*W.z,l+=W.z*W.z}g*=s,o*=s,r*=s,a*=s,I*=s,l*=s;const C=_K;C[0]=g,C[1]=o,C[2]=r,C[3]=o,C[4]=a,C[5]=I,C[6]=r,C[7]=I,C[8]=l;const{unitary:c}=WK(C,HK),A=e.halfAxes.copy(c);let d=A.getColumn(0,QK),h=A.getColumn(1,XK),u=A.getColumn(2,YK),m=-Number.MAX_VALUE,f=-Number.MAX_VALUE,p=-Number.MAX_VALUE,B=Number.MAX_VALUE,G=Number.MAX_VALUE,y=Number.MAX_VALUE;for(const F of t)es.copy(F),m=Math.max(es.dot(d),m),f=Math.max(es.dot(h),f),p=Math.max(es.dot(u),p),B=Math.min(es.dot(d),B),G=Math.min(es.dot(h),G),y=Math.min(es.dot(u),y);d=d.multiplyByScalar(.5*(B+m)),h=h.multiplyByScalar(.5*(G+f)),u=u.multiplyByScalar(.5*(y+p)),e.center.copy(d).add(h).add(u);const U=EK.set(m-B,f-G,p-y).multiplyByScalar(.5),V=new mt([U[0],0,0,0,U[1],0,0,0,U[2]]);return e.halfAxes.multiplyRight(V),e}const lo=512,Zy=3,RR=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],FR=RR.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),KK=FR.concat([[.25,.5],[.75,.5]]);class Co{constructor(e,n,i){this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new Co(e,n,i),new Co(e,n+1,i),new Co(e+1,n,i),new Co(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:s,minZ:g,maxZ:o,bounds:r,offset:a,project:I}=e,l=this.getBoundingVolume(s,a,I);if(r&&!this.insideBounds(r)||i.computeVisibility(l)<0)return!1;if(!this.childVisible){let{z:c}=this;if(c<o&&c>=g){const A=l.distanceTo(n.cameraPosition)*n.scale/n.height;c+=Math.floor(Math.log2(A))}if(c>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const c of this.children)c.update(e);return!0}getSelected(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds(e){let[n,i,s,g]=e;const o=Math.pow(2,this.z),r=lo/o;return this.x*r<s&&this.y*r<g&&(this.x+1)*r>n&&(this.y+1)*r>i}getBoundingVolume(e,n,i){if(i){const a=this.z<1?KK:this.z<2?FR:RR,I=[];for(const l of a){const C=a0(this.x+l[0],this.y+l[1],this.z);C[2]=e[0],I.push(i(C)),e[0]!==e[1]&&(C[2]=e[1],I.push(i(C)))}return kK(I)}const s=Math.pow(2,this.z),g=lo/s,o=this.x*g+n*lo,r=lo-(this.y+1)*g;return new dm([o,r,e[0]],[o+g,r+g,e[1]])}}function LK(t,e,n,i){const s=t.resolution?t.projectPosition:null,g=Object.values(t.getFrustumPlanes()).map(A=>{let{normal:d,distance:h}=A;return new ys(d.clone().negate(),h)}),o=new Io(g),r=t.distanceScales.unitsPerMeter[2],a=n&&n[0]*r||0,I=n&&n[1]*r||0,l=t.pitch<=60?e:0;if(i){const[A,d,h,u]=i,m=xs([A,u]),f=xs([h,d]);i=[m[0],lo-m[1],f[0],lo-f[1]]}const C=new Co(0,0,0),c={viewport:t,project:s,cullingVolume:o,elevationBounds:[a,I],minZ:l,maxZ:e,bounds:i,offset:0};if(C.update(c),t.subViewports&&t.subViewports.length>1){for(c.offset=-1;C.update(c)&&!(--c.offset<-Zy););for(c.offset=1;C.update(c)&&!(++c.offset>Zy););}return C.getSelected()}const Xi=512,MK=[-1/0,-1/0,1/0,1/0],PK={type:"url",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equals:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function SR(t,e){const n=[e.transformPoint([t[0],t[1]]),e.transformPoint([t[2],t[1]]),e.transformPoint([t[0],t[3]]),e.transformPoint([t[2],t[3]])];return[Math.min(...n.map(s=>s[0])),Math.min(...n.map(s=>s[1])),Math.max(...n.map(s=>s[0])),Math.max(...n.map(s=>s[1]))]}function JK(t,e){if(!t||!t.length)return null;if(Array.isArray(t)){const g=Math.abs(e.x+e.y)%t.length;t=t[g]}const{x:n,y:i,z:s}=e;return t.replace(/\{x\}/g,n).replace(/\{y\}/g,i).replace(/\{z\}/g,s).replace(/\{-y\}/g,Math.pow(2,s)-i-1)}function DK(t,e,n){let i;if(e&&e.length===2){const[s,g]=e,o=t.getBounds({z:s}),r=t.getBounds({z:g});i=[Math.min(o[0],r[0]),Math.min(o[1],r[1]),Math.max(o[2],r[2]),Math.max(o[3],r[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function zK(t,e,n){return n?SR(t,n).map(s=>s*e/Xi):t.map(i=>i*e/Xi)}function mm(t,e){return Math.pow(2,t)*Xi/e}function a0(t,e,n){const i=mm(n,Xi),s=t/i*360-180,g=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(g)-Math.exp(-g)));return[s,o]}function Ry(t,e,n,i){const s=mm(n,i);return[t/s*Xi,e/s*Xi]}function OK(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Xi;if(t.isGeospatial){const[I,l]=a0(e,n,i),[C,c]=a0(e+1,n+1,i);return{west:I,north:l,east:C,south:c}}const[g,o]=Ry(e,n,i,s),[r,a]=Ry(e+1,n+1,i,s);return{left:g,top:o,right:r,bottom:a}}function jK(t,e,n,i,s){const g=DK(t,null,i),o=mm(e,n),[r,a,I,l]=zK(g,o,s),C=[];for(let c=Math.floor(r);c<I;c++)for(let A=Math.floor(a);A<l;A++)C.push({x:c,y:A,z:e});return C}function qK(t){let{viewport:e,maxZoom:n,minZoom:i,zRange:s,extent:g,tileSize:o=Xi,modelMatrix:r,modelMatrixInverse:a,zoomOffset:I=0}=t,l=e.isGeospatial?Math.round(e.zoom+Math.log2(Xi/o))+I:Math.ceil(e.zoom)+I;if(Number.isFinite(i)&&l<i){if(!g)return[];l=i}Number.isFinite(n)&&l>n&&(l=n);let C=g;return r&&a&&g&&!e.isGeospatial&&(C=SR(g,r)),e.isGeospatial?LK(e,l,s,g):jK(e,l,o,C||MK,a)}const $K=0,VR=1,UR=3,eL=4,Fy=5,tL="never",fm="best-available",nL=5;class iL{constructor(e){this.opts=e,this.onTileLoad=n=>{this.opts.onTileLoad(n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new K9({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ee,this._modelMatrixInverse=new Ee,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);this._selectedTiles.includes(n)?n.setNeedsReload():this._cache.delete(e)}}update(e){let{zRange:n,modelMatrix:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new Ee(i),g=!s.equals(this._modelMatrix);if(!e.equals(this._viewport)||g){g&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e;const r=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=r.map(a=>this._getTile(a,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(r=>this._getTile({x:r.x,y:r.y,z:r.z})));const o=this.updateTileStates();return this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}getTileIndices(e){let{viewport:n,maxZoom:i,minZoom:s,zRange:g,modelMatrix:o,modelMatrixInverse:r}=e;const{tileSize:a,extent:I,zoomOffset:l}=this.opts;return qK({viewport:n,maxZoom:i,minZoom:s,zRange:g,tileSize:a,extent:I,modelMatrix:o,modelMatrixInverse:r,zoomOffset:l})}getTileMetadata(e){let{x:n,y:i,z:s}=e;const{tileSize:g}=this.opts;return{bbox:OK(this._viewport,n,i,s,g)}}getParentIndex(e){return e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),e.z-=1,e}updateTileStates(){this._updateTileStates(this.selectedTiles);const{maxRequests:e}=this.opts,n=[];let i=0,s=!1;for(const g of this._cache.values()){const o=Boolean(g.state&VR);g.isVisible!==o&&(s=!0,g.isVisible=o),g.isSelected=g.state===Fy,g.isLoading&&(i++,g.isSelected||n.push(g))}if(e>0)for(;i>e&&n.length>0;)n.shift().abort(),i--;return s}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children.length=0;for(const n of e.values()){const i=this._getNearestAncestor(n.x,n.y,n.z);n.parent=i,i&&i.children.push(n)}}_updateTileStates(e){const{_cache:n}=this,i=this.opts.refinementStrategy||fm;for(const s of n.values())s.state=$K;for(const s of e)s.state=Fy;if(i!==tL){for(const s of e)gL(s,i);for(const s of e)sL(s)&&xR(s)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:nL*this.selectedTiles.length),s=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>s){for(const[o,r]of e)if(r.isVisible||(this._cacheByteSize-=n.maxCacheByteSize?r.byteLength:0,e.delete(o),this.opts.onTileUnload(r)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,r)=>o.z-r.z),this._dirty=!1)}_getTile(e,n){let{x:i,y:s,z:g}=e;const o="".concat(i,",").concat(s,",").concat(g);let r=this._cache.get(o),a=!1;return!r&&n?(r=new vK({x:i,y:s,z:g}),Object.assign(r,this.getTileMetadata(r)),a=!0,this._cache.set(o,r),this._dirty=!0):r&&r.needsReload&&(a=!0),a&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e,n,i){const{_minZoom:s=0}=this;let g={x:e,y:n,z:i};for(;g.z>s;){g=this.getParentIndex(g);const o=this._getTile(g);if(o)return o}return null}}function sL(t){let e=t;for(;e;){if(e.state&VR===0)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function gL(t,e){let n,i=UR;for(;n=t.parent;){if(t.isLoaded&&(i=eL,e===fm))return;n.state=Math.max(n.state,i),t=n}}function xR(t){for(const e of t.children)e.state=Math.max(e.state,UR),e.isLoaded||xR(e)}const oL={data:[],dataComparator:PK.equals,renderSubLayers:{type:"function",value:t=>new Am(t),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:t=>console.error(t),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:fm,zRange:null,maxRequests:6,zoomOffset:0};class pm extends Un{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e;(e=this.state.tileset)===null||e===void 0||e.finalize()}get isLoaded(){const{tileset:e}=this.state;return e.selectedTiles.every(n=>n.isLoaded&&n.layers&&n.layers.every(i=>i.isLoaded))}shouldUpdateState(e){let{changeFlags:n}=e;return n.somethingChanged}updateState(e){let{props:n,changeFlags:i}=e,{tileset:s}=this.state;const g=i.propsOrDataChanged||i.updateTriggersChanged,o=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getTileData);s?g&&(s.setOptions(this._getTilesetOptions(n)),o?s.reloadAll():this.state.tileset.tiles.forEach(r=>{r.layers=null})):(s=new iL(this._getTilesetOptions(n)),this.setState({tileset:s})),this._updateTileset()}_getTilesetOptions(e){const{tileSize:n,maxCacheSize:i,maxCacheByteSize:s,refinementStrategy:g,extent:o,maxZoom:r,minZoom:a,maxRequests:I,zoomOffset:l}=e;return{maxCacheSize:i,maxCacheByteSize:s,maxZoom:r,minZoom:a,tileSize:n,refinementStrategy:g,extent:o,maxRequests:I,zoomOffset:l,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:g}=e,o=this.state.isLoaded!==g,r=this.state.frameNumber!==s;g&&(o||r)&&this._onViewportLoad(),r&&this.setState({frameNumber:s}),this.state.isLoaded=g}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,e.isVisible&&this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,n.isVisible&&this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:s}=this.props,{signal:g}=e;return e.url=JK(n,e),i?i(e):e.url?s(e.url,{propName:"data",layer:this,signal:g}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let{info:n,sourceLayer:i}=e;return n.tile=i.props.tile,n}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.content,_offset:0,tile:e});e.layers=xc(i,Boolean).map(s=>s.clone({tile:e,...n}))}return e.layers})}filterSubLayer(e){let{layer:n}=e;return n.props.tile.isVisible}}pm.layerName="TileLayer";pm.defaultProps=oL;const rL=typeof window<"u"?Z.exports.useLayoutEffect:Z.exports.useEffect,aL=rL;function YC(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function I0(t){return t&&(typeof t=="function"?Z.exports.createElement(Bg,{},t):Array.isArray(t)?t.map(I0):t.type===Ne.Fragment?I0(t.props.children):(YC(t.type,Bg),t))}function IL(t){let{children:e,layers:n,views:i}=t;const s=[],g=[],o={};return Ne.Children.forEach(I0(e),r=>{if(r){const a=r.type;if(YC(a,hn)){const I=lL(a,r.props);g.push(I)}else s.push(r);if(a!==Bg&&YC(a,Bg)&&r.props.id){const I=new a(r.props);o[I.id]=I}}}),Object.keys(o).length>0&&(Array.isArray(i)?i.forEach(r=>{o[r.id]=r}):i&&(o[i.id]=i),i=Object.values(o)),n=g.length>0?[...g,...n]:n,{layers:n,children:s,views:i}}function lL(t,e){const n={},i=t.defaultProps||{};for(const s in e)i[s]!==e[s]&&(n[s]=e[s]);return new t(n)}const CL={position:"absolute",zIndex:-1};function WR(t,e){return t&&(typeof t=="function"?t(e):Array.isArray(t)?t.map(n=>WR(n,e)):cL(t)?(e.style=CL,Z.exports.cloneElement(t,e)):AL(t)?Z.exports.cloneElement(t,e):t)}function cL(t){const e=t&&t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function AL(t){const e=t&&t.type;return e&&e.deckGLViewProps}function dL(t){let{children:e,deck:n,ContextProvider:i}=t;const{viewManager:s}=n||{};if(!s||!s.views.length)return[];const g={},o=s.views[0].id;for(const r of e){let a=o,I=r;YC(r.type,Bg)&&(a=r.props.id||o,I=r.props.children);const l=s.getViewport(a),C=s.getViewState(a);if(l){const{x:c,y:A,width:d,height:h}=l;I=WR(I,{x:c,y:A,width:d,height:h,viewport:l,viewState:C}),g[a]||(g[a]={viewport:l,children:[]}),g[a].children.push(I)}}return Object.keys(g).map(r=>{const{viewport:a,children:I}=g[r],{x:l,y:C,width:c,height:A}=a,d={position:"absolute",left:l,top:C,width:c,height:A},h="view-".concat(r),u=Z.exports.createElement("div",{key:h,id:h,style:d},...I);if(i){const m={viewport:a,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:f=>{f.viewId=r,n._onViewStateChange(f)}};return Z.exports.createElement(i,{key:h,value:m},u)}return u})}const uL={mixBlendMode:null};function hL(t){let{width:e,height:n,style:i}=t;const s={position:"absolute",zIndex:0,left:0,top:0,width:e,height:n},g={left:0,top:0};if(i)for(const o in i)o in uL?g[o]=i[o]:s[o]=i[o];return{containerStyle:s,canvasStyle:g}}function mL(t){const e={pickObject:n=>t.deck.pickObject(n),pickMultipleObjects:n=>t.deck.pickMultipleObjects(n),pickObjects:n=>t.deck.pickObjects(n)};return Object.defineProperty(e,"deck",{get:()=>t.deck}),e}function wR(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function fL(t,e){const n=e.Deck||jo,i=new n({...e,style:null,width:"100%",height:"100%",_customRender:s=>{t.redrawReason=s;const g=i.viewManager.getViewports();t.lastRenderedViewports!==g?t.forceUpdate(o=>o+1):wR(t)}});return i}const Bm=Z.exports.forwardRef((t,e)=>{const i=Z.exports.useRef({}).current,[s,g]=Z.exports.useState(0);i.forceUpdate=g;const o=Z.exports.useRef(null),r=Z.exports.useRef(null),a=Z.exports.useMemo(()=>IL(t),[t.layers,t.views,t.children]);let I=!0;const l=y=>I&&t.viewState?(i.viewStateUpdateRequested=y,null):(i.viewStateUpdateRequested=null,t.onViewStateChange(y)),C=y=>{I?i.interactionStateUpdateRequested=y:(i.interactionStateUpdateRequested=null,t.onInteractionStateChange(y))},c=Z.exports.useMemo(()=>{const y={...t,style:null,width:"100%",height:"100%",layers:a.layers,views:a.views,onViewStateChange:l,onInteractionStateChange:C};return i.deck&&i.deck.setProps(y),y},[t]);Z.exports.useEffect(()=>(i.deck=fL(i,{...c,parent:o.current,canvas:r.current}),()=>i.deck.finalize()),[]),aL(()=>{wR(i);const{viewStateUpdateRequested:y,interactionStateUpdateRequested:U}=i;y&&l(y),U&&C(U)}),Z.exports.useImperativeHandle(e,()=>mL(i),[]);const{viewManager:A}=i.deck||{},d=A&&A.getViewports(),{ContextProvider:h,width:u,height:m,id:f,style:p}=t,{containerStyle:B,canvasStyle:G}=Z.exports.useMemo(()=>hL({width:u,height:m,style:p}),[u,m,p]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===d||i.version!==s){i.lastRenderedViewports=d,i.version=s;const y=dL({children:a.children,deck:i.deck,ContextProvider:h}),U=Z.exports.createElement("canvas",{key:"canvas",id:f||"deckgl-overlay",ref:r,style:G});i.control=Z.exports.createElement("div",{id:"".concat(f||"deckgl","-wrapper"),ref:o,style:B},[U,y])}return I=!1,i.control});Bm.propTypes=jo.getPropTypes(vZ.exports);Bm.defaultProps=jo.defaultProps;const pL=Bm;var BL={},NR={},di={};(function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+n+"]*",s=new RegExp("^"+i+"$"),g=function(r,a){const I=[];let l=a.exec(r);for(;l;){const C=[];C.startIndex=a.lastIndex-l[0].length;const c=l.length;for(let A=0;A<c;A++)C.push(l[A]);I.push(C),l=a.exec(r)}return I},o=function(r){const a=s.exec(r);return!(a===null||typeof a>"u")};t.isExist=function(r){return typeof r<"u"},t.isEmptyObject=function(r){return Object.keys(r).length===0},t.merge=function(r,a,I){if(a){const l=Object.keys(a),C=l.length;for(let c=0;c<C;c++)I==="strict"?r[l[c]]=[a[l[c]]]:r[l[c]]=a[l[c]]}},t.getValue=function(r){return t.isExist(r)?r:""},t.buildOptions=function(r,a,I){let l={};if(!r)return a;for(let C=0;C<I.length;C++)r[I[C]]!==void 0?l[I[C]]=r[I[C]]:l[I[C]]=a[I[C]];return l},t.isTagNameInArrayMode=function(r,a,I){return a===!1?!1:a instanceof RegExp?a.test(r):typeof a=="function"?!!a(r,I):a==="strict"},t.isName=o,t.getAllMatches=g,t.nameRegexp=i})(di);const zs=di,l0=function(t,e,n){const i={};if(!e.alwaysCreateTextNode&&(!t.child||zs.isEmptyObject(t.child))&&(!t.attrsMap||zs.isEmptyObject(t.attrsMap)))return zs.isExist(t.val)?t.val:"";if(zs.isExist(t.val)&&!(typeof t.val=="string"&&(t.val===""||t.val===e.cdataPositionChar))){const g=zs.isTagNameInArrayMode(t.tagname,e.arrayMode,n);i[e.textNodeName]=g?[t.val]:t.val}zs.merge(i,t.attrsMap,e.arrayMode);const s=Object.keys(t.child);for(let g=0;g<s.length;g++){const o=s[g];if(t.child[o]&&t.child[o].length>1){i[o]=[];for(let r in t.child[o])t.child[o].hasOwnProperty(r)&&i[o].push(l0(t.child[o][r],e,o))}else{const r=l0(t.child[o][0],e,o),a=e.arrayMode===!0&&typeof r=="object"||zs.isTagNameInArrayMode(o,e.arrayMode,n);i[o]=a?[r]:r}}return i};NR.convertToJson=l0;var bg={},bL=function(t,e,n){this.tagname=t,this.parent=e,this.child={},this.attrsMap={},this.val=n,this.addChild=function(i){Array.isArray(this.child[i.tagname])?this.child[i.tagname].push(i):this.child[i.tagname]=[i]}};const yL=/^[-+]?0x[a-fA-F0-9]+$/,vL=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const GL={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function ZL(t,e={}){if(e=Object.assign({},GL,e),!t||typeof t!="string")return t;let n=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(n))return t;if(e.hex&&yL.test(n))return Number.parseInt(n,16);{const i=vL.exec(n);if(i){const s=i[1],g=i[2];let o=RL(i[3]);const r=i[4]||i[6];if(!e.leadingZeros&&g.length>0&&s&&n[2]!==".")return t;if(!e.leadingZeros&&g.length>0&&!s&&n[1]!==".")return t;{const a=Number(n),I=""+a;return I.search(/[eE]/)!==-1||r?e.eNotation?a:t:n.indexOf(".")!==-1?I==="0"&&o===""||I===o||s&&I==="-"+o?a:t:g?o===I||s+o===I?a:t:n===I||n===s+I?a:t}}else return t}}function RL(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}var FL=ZL;const ag=di,SL=di.buildOptions,cl=bL,VL=FL;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,ag.nameRegexp);!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const TR={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",numParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(t,e){return t},attrValueProcessor:function(t,e){return t},stopNodes:[],alwaysCreateTextNode:!1};bg.defaultOptions=TR;const ER=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","numParseOptions","stopNodes","alwaysCreateTextNode"];bg.props=ER;function Al(t,e,n){return e&&(n.trimValues&&(e=e.trim()),e=n.tagValueProcessor(e,t),e=QR(e,n.parseNodeValue,n.numParseOptions)),e}function UL(t,e){if(e.ignoreNameSpace){const n=t.split(":"),i=t.charAt(0)==="/"?"/":"";if(n[0]==="xmlns")return"";n.length===2&&(t=i+n[1])}return t}function QR(t,e,n){if(e&&typeof t=="string"){const i=t.trim();return i==="true"?!0:i==="false"?!1:VL(t,n)}else return ag.isExist(t)?t:""}const xL=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])(.*?)\\3)?`,"g");function Sy(t,e){if(!e.ignoreAttributes&&typeof t=="string"){t=t.replace(/\r?\n/g," ");const n=ag.getAllMatches(t,xL),i=n.length,s={};for(let g=0;g<i;g++){const o=UL(n[g][1],e);o.length&&(n[g][4]!==void 0?(e.trimValues&&(n[g][4]=n[g][4].trim()),n[g][4]=e.attrValueProcessor(n[g][4],o),s[e.attributeNamePrefix+o]=QR(n[g][4],e.parseAttributeValue,e.numParseOptions)):e.allowBooleanAttributes&&(s[e.attributeNamePrefix+o]=!0))}if(!Object.keys(s).length)return;if(e.attrNodeName){const g={};return g[e.attrNodeName]=s,g}return s}}const WL=function(t,e){t=t.replace(/\r\n?/g,`
`),e=SL(e,TR,ER);const n=new cl("!xml");let i=n,s="";for(let g=0;g<t.length;g++)if(t[g]==="<")if(t[g+1]==="/"){const r=Wr(t,">",g,"Closing Tag is not closed.");let a=t.substring(g+2,r).trim();if(e.ignoreNameSpace){const I=a.indexOf(":");I!==-1&&(a=a.substr(I+1))}i&&(i.val?i.val=ag.getValue(i.val)+""+Al(a,s,e):i.val=Al(a,s,e)),e.stopNodes.length&&e.stopNodes.includes(i.tagname)&&(i.child=[],i.attrsMap==null&&(i.attrsMap={}),i.val=t.substr(i.startIndex+1,g-i.startIndex-1)),i=i.parent,s="",g=r}else if(t[g+1]==="?")g=Wr(t,"?>",g,"Pi Tag is not closed.");else if(t.substr(g+1,3)==="!--")g=Wr(t,"-->",g,"Comment is not closed.");else if(t.substr(g+1,2)==="!D"){const r=Wr(t,">",g,"DOCTYPE is not closed.");t.substring(g,r).indexOf("[")>=0?g=t.indexOf("]>",g)+1:g=r}else if(t.substr(g+1,2)==="!["){const r=Wr(t,"]]>",g,"CDATA is not closed.")-2,a=t.substring(g+9,r);if(s&&(i.val=ag.getValue(i.val)+""+Al(i.tagname,s,e),s=""),e.cdataTagName){const I=new cl(e.cdataTagName,i,a);i.addChild(I),i.val=ag.getValue(i.val)+e.cdataPositionChar,a&&(I.val=a)}else i.val=(i.val||"")+(a||"");g=r+2}else{const r=wL(t,g+1);let a=r.data;const I=r.index,l=a.indexOf(" ");let C=a,c=!0;if(l!==-1&&(C=a.substr(0,l).replace(/\s\s*$/,""),a=a.substr(l+1)),e.ignoreNameSpace){const A=C.indexOf(":");A!==-1&&(C=C.substr(A+1),c=C!==r.data.substr(A+1))}if(i&&s&&i.tagname!=="!xml"&&(i.val=ag.getValue(i.val)+""+Al(i.tagname,s,e)),a.length>0&&a.lastIndexOf("/")===a.length-1){C[C.length-1]==="/"?(C=C.substr(0,C.length-1),a=C):a=a.substr(0,a.length-1);const A=new cl(C,i,"");C!==a&&(A.attrsMap=Sy(a,e)),i.addChild(A)}else{const A=new cl(C,i);e.stopNodes.length&&e.stopNodes.includes(A.tagname)&&(A.startIndex=I),C!==a&&c&&(A.attrsMap=Sy(a,e)),i.addChild(A),i=A}s="",g=I}else s+=t[g];return n};function wL(t,e){let n,i="";for(let s=e;s<t.length;s++){let g=t[s];if(n)g===n&&(n="");else if(g==='"'||g==="'")n=g;else{if(g===">")return{data:i,index:s};g==="	"&&(g=" ")}i+=g}}function Wr(t,e,n,i){const s=t.indexOf(e,n);if(s===-1)throw new Error(i);return s+e.length-1}bg.getTraversalObj=WL;var XR={};const Qc=di,NL={allowBooleanAttributes:!1},TL=["allowBooleanAttributes"];XR.validate=function(t,e){e=Qc.buildOptions(e,NL,TL);const n=[];let i=!1,s=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let g=0;g<t.length;g++)if(t[g]==="<"&&t[g+1]==="?"){if(g+=2,g=Vy(t,g),g.err)return g}else if(t[g]==="<"){let o=g;if(g++,t[g]==="!"){g=Uy(t,g);continue}else{let r=!1;t[g]==="/"&&(r=!0,g++);let a="";for(;g<t.length&&t[g]!==">"&&t[g]!==" "&&t[g]!=="	"&&t[g]!==`
`&&t[g]!=="\r";g++)a+=t[g];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),g--),!KL(a)){let C;return a.trim().length===0?C="Invalid space after '<'.":C="Tag '"+a+"' is an invalid name.",ht("InvalidTag",C,nn(t,g))}const I=XL(t,g);if(I===!1)return ht("InvalidAttr","Attributes for '"+a+"' have open quote.",nn(t,g));let l=I.value;if(g=I.index,l[l.length-1]==="/"){const C=g-l.length;l=l.substring(0,l.length-1);const c=xy(l,e);if(c===!0)i=!0;else return ht(c.err.code,c.err.msg,nn(t,C+c.err.line))}else if(r)if(I.tagClosed){if(l.trim().length>0)return ht("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",nn(t,o));{const C=n.pop();if(a!==C.tagName){let c=nn(t,C.tagStartPos);return ht("InvalidTag","Expected closing tag '"+C.tagName+"' (opened in line "+c.line+", col "+c.col+") instead of closing tag '"+a+"'.",nn(t,o))}n.length==0&&(s=!0)}}else return ht("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",nn(t,g));else{const C=xy(l,e);if(C!==!0)return ht(C.err.code,C.err.msg,nn(t,g-l.length+C.err.line));if(s===!0)return ht("InvalidXml","Multiple possible root nodes found.",nn(t,g));n.push({tagName:a,tagStartPos:o}),i=!0}for(g++;g<t.length;g++)if(t[g]==="<")if(t[g+1]==="!"){g++,g=Uy(t,g);continue}else if(t[g+1]==="?"){if(g=Vy(t,++g),g.err)return g}else break;else if(t[g]==="&"){const C=HL(t,g);if(C==-1)return ht("InvalidChar","char '&' is not expected.",nn(t,g));g=C}t[g]==="<"&&g--}}else{if(t[g]===" "||t[g]==="	"||t[g]===`
`||t[g]==="\r")continue;return ht("InvalidChar","char '"+t[g]+"' is not expected.",nn(t,g))}if(i){if(n.length==1)return ht("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",nn(t,n[0].tagStartPos));if(n.length>0)return ht("InvalidXml","Invalid '"+JSON.stringify(n.map(g=>g.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return ht("InvalidXml","Start tag expected.",1);return!0};function Vy(t,e){const n=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const i=t.substr(n,e-n);if(e>5&&i==="xml")return ht("InvalidXml","XML declaration allowed only at the start of the document.",nn(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function Uy(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let n=1;for(e+=8;e<t.length;e++)if(t[e]==="<")n++;else if(t[e]===">"&&(n--,n===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const EL='"',QL="'";function XL(t,e){let n="",i="",s=!1;for(;e<t.length;e++){if(t[e]===EL||t[e]===QL)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){s=!0;break}n+=t[e]}return i!==""?!1:{value:n,index:e,tagClosed:s}}const YL=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function xy(t,e){const n=Qc.getAllMatches(t,YL),i={};for(let s=0;s<n.length;s++){if(n[s][1].length===0)return ht("InvalidAttr","Attribute '"+n[s][2]+"' has no space in starting.",dl(n[s]));if(n[s][3]===void 0&&!e.allowBooleanAttributes)return ht("InvalidAttr","boolean attribute '"+n[s][2]+"' is not allowed.",dl(n[s]));const g=n[s][2];if(!kL(g))return ht("InvalidAttr","Attribute '"+g+"' is an invalid name.",dl(n[s]));if(!i.hasOwnProperty(g))i[g]=1;else return ht("InvalidAttr","Attribute '"+g+"' is repeated.",dl(n[s]))}return!0}function _L(t,e){let n=/\d/;for(t[e]==="x"&&(e++,n=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(n))break}return-1}function HL(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,_L(t,e);let n=0;for(;e<t.length;e++,n++)if(!(t[e].match(/\w/)&&n<20)){if(t[e]===";")break;return-1}return e}function ht(t,e,n){return{err:{code:t,msg:e,line:n.line||n,col:n.col}}}function kL(t){return Qc.isName(t)}function KL(t){return Qc.isName(t)}function nn(t,e){const n=t.substring(0,e).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function dl(t){return t.startIndex+t[1].length}var Ad={},Wy;function LL(){if(Wy)return Ad;Wy=1;const t=function(C){return String.fromCharCode(C)},e={nilChar:t(176),missingChar:t(201),nilPremitive:t(175),missingPremitive:t(200),emptyChar:t(178),emptyValue:t(177),boundryChar:t(179),objStart:t(198),arrStart:t(204),arrayEnd:t(185)},n=[e.nilChar,e.nilPremitive,e.missingChar,e.missingPremitive,e.boundryChar,e.emptyChar,e.emptyValue,e.arrayEnd,e.objStart,e.arrStart],i=function(C,c,A){if(typeof c=="string")return C&&C[0]&&C[0].val!==void 0?s(C[0].val):s(C);{const d=r(C);if(d===!0){let h="";if(Array.isArray(c)){h+=e.arrStart;const u=c[0],m=C.length;if(typeof u=="string")for(let f=0;f<m;f++){const p=s(C[f].val);h=g(h,p)}else for(let f=0;f<m;f++){const p=i(C[f],u,A);h=g(h,p)}h+=e.arrayEnd}else{h+=e.objStart;const u=Object.keys(c);Array.isArray(C)&&(C=C[0]);for(let m in u){const f=u[m];let p;!A.ignoreAttributes&&C.attrsMap&&C.attrsMap[f]?p=i(C.attrsMap[f],c[f],A):f===A.textNodeName?p=i(C.val,c[f],A):p=i(C.child[f],c[f],A),h=g(h,p)}}return h}else return d}},s=function(C){switch(C){case void 0:return e.missingPremitive;case null:return e.nilPremitive;case"":return e.emptyValue;default:return C}},g=function(C,c){return!o(c[0])&&!o(C[C.length-1])&&(C+=e.boundryChar),C+c},o=function(C){return n.indexOf(C)!==-1};function r(C){return C===void 0?e.missingChar:C===null?e.nilChar:C.child&&Object.keys(C.child).length===0&&(!C.attrsMap||Object.keys(C.attrsMap).length===0)?e.emptyChar:!0}const a=bg,I=di.buildOptions,l=function(C,c,A){return A=I(A,a.defaultOptions,a.props),i(C,c,A)};return Ad.convert2nimn=l,Ad}var dd={},wy;function ML(){if(wy)return dd;wy=1;const t=di,e=di.buildOptions,n=bg,i=function(o,r){return r=e(r,n.defaultOptions,n.props),r.indentBy=r.indentBy||"",s(o,r)},s=function(o,r,a){let I="{";const l=Object.keys(o.child);for(let C=0;C<l.length;C++){const c=l[C];if(o.child[c]&&o.child[c].length>1){I+='"'+c+'" : [ ';for(let A in o.child[c])I+=s(o.child[c][A],r)+" , ";I=I.substr(0,I.length-1)+" ] "}else I+='"'+c+'" : '+s(o.child[c][0],r)+" ,"}return t.merge(I,o.attrsMap),t.isEmptyObject(I)?t.isExist(o.val)?o.val:"":(t.isExist(o.val)&&(typeof o.val=="string"&&(o.val===""||o.val===r.cdataPositionChar)||(I+='"'+r.textNodeName+'" : '+g(o.val))),I[I.length-1]===","&&(I=I.substr(0,I.length-2)),I+"}")};function g(o){return o===!0||o===!1||!isNaN(o)?o:'"'+o+'"'}return dd.convertToJsonString=i,dd}var ud,Ny;function PL(){if(Ny)return ud;Ny=1;const t=di.buildOptions,e={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(d){return d},attrValueProcessor:function(d){return d}},n=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor","rootNodeName"];function i(d){this.options=t(d,e,n),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.options.cdataTagName?this.isCDATA=A:this.isCDATA=function(){return!1},this.replaceCDATAstr=g,this.replaceCDATAarr=o,this.processTextOrObjNode=s,this.options.format?(this.indentate=C,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=l,this.buildObjNode=a):(this.buildTextNode=I,this.buildObjNode=r),this.buildTextValNode=I,this.buildObjectNode=r}i.prototype.parse=function(d){return Array.isArray(d)&&this.options.rootNodeName&&this.options.rootNodeName.length>1&&(d={[this.options.rootNodeName]:d}),this.j2x(d,0).val},i.prototype.j2x=function(d,h){let u="",m="";for(let f in d)if(!(typeof d[f]>"u"))if(d[f]===null)m+=this.indentate(h)+"<"+f+"/"+this.tagEndChar;else if(d[f]instanceof Date)m+=this.buildTextNode(d[f],f,"",h);else if(typeof d[f]!="object"){const p=this.isAttribute(f);p?u+=" "+p+'="'+this.options.attrValueProcessor(""+d[f])+'"':this.isCDATA(f)?d[this.options.textNodeName]?m+=this.replaceCDATAstr(d[this.options.textNodeName],d[f]):m+=this.replaceCDATAstr("",d[f]):f===this.options.textNodeName?d[this.options.cdataTagName]||(m+=this.options.tagValueProcessor(""+d[f])):m+=this.buildTextNode(d[f],f,"",h)}else if(Array.isArray(d[f]))if(this.isCDATA(f))m+=this.indentate(h),d[this.options.textNodeName]?m+=this.replaceCDATAarr(d[this.options.textNodeName],d[f]):m+=this.replaceCDATAarr("",d[f]);else{const p=d[f].length;for(let B=0;B<p;B++){const G=d[f][B];typeof G>"u"||(G===null?m+=this.indentate(h)+"<"+f+"/"+this.tagEndChar:typeof G=="object"?m+=this.processTextOrObjNode(G,f,h):m+=this.buildTextNode(G,f,"",h))}}else if(this.options.attrNodeName&&f===this.options.attrNodeName){const p=Object.keys(d[f]),B=p.length;for(let G=0;G<B;G++)u+=" "+p[G]+'="'+this.options.attrValueProcessor(""+d[f][p[G]])+'"'}else m+=this.processTextOrObjNode(d[f],f,h);return{attrStr:u,val:m}};function s(d,h,u){const m=this.j2x(d,u+1);return d[this.options.textNodeName]!==void 0&&Object.keys(d).length===1?this.buildTextNode(m.val,h,m.attrStr,u):this.buildObjNode(m.val,h,m.attrStr,u)}function g(d,h){return d=this.options.tagValueProcessor(""+d),this.options.cdataPositionChar===""||d===""?d+"<![CDATA["+h+"]]"+this.tagEndChar:d.replace(this.options.cdataPositionChar,"<![CDATA["+h+"]]"+this.tagEndChar)}function o(d,h){if(d=this.options.tagValueProcessor(""+d),this.options.cdataPositionChar===""||d==="")return d+"<![CDATA["+h.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let u in h)d=d.replace(this.options.cdataPositionChar,"<![CDATA["+h[u]+"]]>");return d+this.newLine}function r(d,h,u,m){return u&&d.indexOf("<")===-1?this.indentate(m)+"<"+h+u+">"+d+"</"+h+this.tagEndChar:this.indentate(m)+"<"+h+u+this.tagEndChar+d+this.indentate(m)+"</"+h+this.tagEndChar}function a(d,h,u,m){return d!==""?this.buildObjectNode(d,h,u,m):this.indentate(m)+"<"+h+u+"/"+this.tagEndChar}function I(d,h,u,m){return this.indentate(m)+"<"+h+u+">"+this.options.tagValueProcessor(d)+"</"+h+this.tagEndChar}function l(d,h,u,m){return d!==""?this.buildTextValNode(d,h,u,m):this.indentate(m)+"<"+h+u+"/"+this.tagEndChar}function C(d){return this.options.indentBy.repeat(d)}function c(d){return d.startsWith(this.options.attributeNamePrefix)?d.substr(this.attrPrefixLen):!1}function A(d){return d===this.options.cdataTagName}return ud=i,ud}(function(t){const e=NR,n=bg,i=bg,s=di.buildOptions,g=XR;t.parse=function(o,r={},a){if(a){a===!0&&(a={});const C=g.validate(o,a);if(C!==!0)throw Error(C.err.msg)}r.parseTrueNumberOnly&&r.parseNodeValue!==!1&&!r.numParseOptions&&(r.numParseOptions={leadingZeros:!1});let I=s(r,i.defaultOptions,i.props);const l=n.getTraversalObj(o,I);return e.convertToJson(l,I)},t.convertTonimn=LL().convert2nimn,t.getTraversalObj=n.getTraversalObj,t.convertToJson=e.convertToJson,t.convertToJsonString=ML().convertToJsonString,t.validate=g.validate,t.j2xParser=PL(),t.parseToNimn=function(o,r,a){return t.convertTonimn(t.getTraversalObj(o,a),r,a)}})(BL);const C0=new Map;function JL(t,e){C0.set(t,e)}async function DL(t){if(!C0.has(t.id))throw new Error(`Compression codec ${t.id} is not supported by Zarr.js yet.`);return(await C0.get(t.id)()).fromConfig(t)}function bm(t){return new Proxy(t,{set(e,n,i,s){return e.setItem(n,i)},get(e,n,i){return e.getItem(n)},deleteProperty(e,n){return e.deleteItem(n)},has(e,n){return e.containsItem(n)}})}function zL(t){return typeof t=="object"&&t!==null&&"__zarr__"in t}function hd(t){return zL(t)&&t.__zarr__==="KeyError"}class li extends Error{constructor(e){super(`path ${e} contains an array`),this.__zarr__="ContainsArrayError",Object.setPrototypeOf(this,li.prototype)}}class wi extends Error{constructor(e){super(`path ${e} contains a group`),this.__zarr__="ContainsGroupError",Object.setPrototypeOf(this,wi.prototype)}}class ym extends Error{constructor(e){super(`array not found at path ${e}`),this.__zarr__="ArrayNotFoundError",Object.setPrototypeOf(this,ym.prototype)}}class Xc extends Error{constructor(e){super(`ground not found at path ${e}`),this.__zarr__="GroupNotFoundError",Object.setPrototypeOf(this,Xc.prototype)}}class kt extends Error{constructor(e){super(e),this.__zarr__="PermissionError",Object.setPrototypeOf(this,kt.prototype)}}class mI extends Error{constructor(e){super(`key ${e} not present`),this.__zarr__="KeyError",Object.setPrototypeOf(this,mI.prototype)}}class vm extends RangeError{constructor(e,n){super(`too many indices for array; expected ${n.length}, got ${e.length}`),this.__zarr__="TooManyIndicesError",Object.setPrototypeOf(this,vm.prototype)}}class yg extends RangeError{constructor(e){super(e),this.__zarr__="BoundsCheckError",Object.setPrototypeOf(this,yg.prototype)}}class _C extends RangeError{constructor(e,n,i,s){super(`slice arguments slice(${e}, ${n}, ${i}) invalid: ${s}`),this.__zarr__="InvalidSliceError",Object.setPrototypeOf(this,_C.prototype)}}class Gm extends Error{constructor(){super("Negative step size is not supported when indexing."),this.__zarr__="NegativeStepError",Object.setPrototypeOf(this,Gm.prototype)}}class Ft extends Error{constructor(e){super(e),this.__zarr__="ValueError",Object.setPrototypeOf(this,Ft.prototype)}}class Zm extends Error{constructor(e){super(e),this.__zarr__="HTTPError",Object.setPrototypeOf(this,Zm.prototype)}}function Yi(t,e=void 0,n=null){if(t===void 0)throw new _C(t,e,n,"The first argument must not be undefined");if(typeof t=="string"&&t!==":"||typeof e=="string"&&e!==":")throw new _C(t,e,n,'Arguments can only be integers, ":" or null');return e===void 0&&(e=t,t=null),{start:t===":"?null:t,stop:e===":"?null:e,step:n,_slice:!0}}function OL(t,e,n,i){if(t<0?(t+=i,t<0&&(t=n<0?-1:0)):t>=i&&(t=n<0?i-1:i),e<0?(e+=i,e<0&&(e=n<0?-1:0)):e>=i&&(e=n<0?i-1:i),n<0){if(e<t){const s=Math.floor((t-e-1)/-n+1);return[t,e,n,s]}}else if(t<e){const s=Math.floor((e-t-1)/n+1);return[t,e,n,s]}return[t,e,n,0]}function YR(t,e){let n,i,s;t.step===null?s=1:s=t.step,t.start===null?n=s<0?Number.MAX_SAFE_INTEGER:0:(n=t.start,n<0&&(n+=e)),t.stop===null?i=s<0?-Number.MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER:(i=t.stop,i<0&&(i+=e));const g=OL(n,i,s,e);if(n=g[0],i=g[1],s=g[2],e=g[3],s===0)throw new Error("Step size 0 is invalid");return[n,i,s,e]}function _R(t){return Array.isArray(t)?t:[t]}function jL(t,e){if(t.length>e.length)throw new vm(t,e)}function vg(t,e){const n=[],i=[];for(let s=0;s<t.length;s++){const g=t[s];if(typeof g=="number")n.push(g);else{const o=YR(g,e[s]),r=o[3];i.push(r),n.push(o)}}return[n,i]}function Ns(t,e,n=!1){t=qL(t,e);for(let i=0;i<t.length;i++){const s=t[i];if(typeof s=="number")n?t[i]=Yi(s,s+1,1):t[i]=Rm(s,e[i]);else{if(HR(s))throw new TypeError("Integer array selections are not supported (yet)");(s===":"||s===null)&&(t[i]=Yi(null,null,1))}}return t}function qL(t,e){t=_R(t);let n=-1,i=0;for(let s=0;s<t.length;s++)t[s]==="..."&&(n=s,i+=1);if(i>1)throw new RangeError("an index can only have a single ellipsis ('...')");if(i===1){const s=n,g=t.length-(s+1),o=t.length-1;if(o>=e.length)t=t.filter(r=>r!=="...");else{const r=e.length-o;let a=t.slice(0,s).concat(new Array(r).fill(null));g>0&&(a=a.concat(t.slice(t.length-g))),t=a}}if(t.length<e.length){const s=e.length-t.length;t=t.concat(new Array(s).fill(null))}return jL(t,e),t}function Rm(t,e){if(t<0&&(t=e+t),t>=e||t<0)throw new yg(`index out of bounds for dimension with length ${e}`);return t}function $L(t){return typeof t=="number"}function HR(t){if(!Array.isArray(t))return!1;for(const e of t)if(typeof e!="number")return!1;return!0}function Fm(t){return t!==null&&t._slice===!0}function eM(t){return Fm(t)&&(t.step===null||t.step===1)}function tM(t){t=_R(t);for(let e=0;e<t.length;e++){const n=t[e];if(!(HR(n)||eM(n)||n==="..."))return!1}return!0}function*nM(...t){if(t.length===0)return;const e=t.map(i=>i()),n=e.map(i=>i.next());for(let i=0;;){if(n[i].done){if(e[i]=t[i](),n[i]=e[i].next(),++i>=e.length)return}else yield n.map(({value:s})=>s),i=0;n[i]=e[i].next()}}class Ty{constructor(e,n){e=Ns(e,n.shape),this.dimIndexers=[];const i=n.shape;for(let s=0;s<i.length;s++){let g=e[s];const o=i[s],r=n.chunks[s];if(g===null&&(g=Yi(null)),$L(g))this.dimIndexers.push(new iM(g,o,r));else if(Fm(g))this.dimIndexers.push(new Ey(g,o,r));else throw new RangeError(`Unspported selection item for basic indexing; expected integer or slice, got ${g}`)}this.shape=[];for(const s of this.dimIndexers)s instanceof Ey&&this.shape.push(s.numItems);this.dropAxes=null}*iter(){const e=this.dimIndexers.map(i=>()=>i.iter()),n=nM(...e);for(const i of n){const s=[],g=[],o=[];for(const r of i)s.push(r.dimChunkIndex),g.push(r.dimChunkSelection),r.dimOutSelection!==null&&o.push(r.dimOutSelection);yield{chunkCoords:s,chunkSelection:g,outSelection:o}}}}class iM{constructor(e,n,i){e=Rm(e,n),this.dimSelection=e,this.dimLength=n,this.dimChunkLength=i,this.numItems=1}*iter(){const e=Math.floor(this.dimSelection/this.dimChunkLength),n=e*this.dimChunkLength,i=this.dimSelection-n;yield{dimChunkIndex:e,dimChunkSelection:i,dimOutSelection:null}}}class Ey{constructor(e,n,i){const[s,g,o]=YR(e,n);if(this.start=s,this.stop=g,this.step=o,this.step<1)throw new Gm;this.dimLength=n,this.dimChunkLength=i,this.numItems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.numChunks=Math.ceil(this.dimLength/this.dimChunkLength)}*iter(){const e=Math.floor(this.start/this.dimChunkLength),n=Math.ceil(this.stop/this.dimChunkLength);for(let i=e;i<n;i++){const s=i*this.dimChunkLength,g=Math.min(this.dimLength,(i+1)*this.dimChunkLength),o=g-s;let r,a,I;if(this.start<s){r=0;const A=(s-this.start)%this.step;A>0&&(r+=this.step-A),I=Math.ceil((s-this.start)/this.step)}else r=this.start-s,I=0;this.stop>g?a=o:a=this.stop-s;const l=Yi(r,a,this.step),C=Math.ceil((a-r)/this.step),c=Yi(I,I+C);yield{dimChunkIndex:i,dimChunkSelection:l,dimOutSelection:c}}}}const $o=typeof process<"u"&&process.versions&&process.versions.node;function Qy(){}function vn(t){if(t===null)return"";for(t instanceof String&&(t=t.valueOf()),t=t.replace(/\\/g,"/");t.length>0&&t[0]==="/";)t=t.slice(1);for(;t.length>0&&t[t.length-1]==="/";)t=t.slice(0,t.length-1);t=t.replace(/\/\/+/g,"/");const e=t.split("/");for(const n of e)if(n==="."||n==="..")throw Error("path containing '.' or '..' segment not allowed");return t}function Sm(t){return typeof t=="number"&&(t=[t]),t.map(e=>Math.floor(e))}function sM(t,e){if(t===null||t===!0)throw new Error("Chunk guessing is not supported yet");return t===!1?e:(typeof t=="number"&&(t=[t]),t.length<e.length&&(t=t.concat(e.slice(t.length))),t.map((n,i)=>n===-1||n===null?e[i]:Math.floor(n)))}function gM(t){return t=t.toUpperCase(),t}function Xy(t,e){if(t===null)return!0;Array.isArray(t)||(t=[t]);for(let n=0;n<Math.min(t.length,e.length);n++){const i=t[n];if(i!==null){if(Fm(i)){const s=i,g=s.step===1||s.step===null;if(s.start===null&&s.stop===null&&g||s.stop-s.start===e[n]&&g)continue;return!1}return!1}}return!0}function oM(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function rM(t){const e=t.length,n=Array(e);let i=1;for(let s=e-1;s>=0;s--)n[s]=i,i*=t[s];return n}function md(t,e){const n=typeof t=="string"?new URL(t):t;n.pathname.endsWith("/")||(n.pathname+="/");const i=new URL(e,n);return i.search=n.search,i.href}function kR(t){const e=t.BYTES_PER_ELEMENT;if(e===1)return;if($o){const o=Buffer.from(t.buffer,t.byteOffset,t.length*e);e===2&&o.swap16(),e===4&&o.swap32(),e===8&&o.swap64();return}const n=new Uint8Array(t.buffer,t.byteOffset,t.length*e),i=e/2,s=e-1;let g;for(let o=0;o<n.length;o+=e)for(let r=0;r<i;r++)g=n[o+r],n[o+r]=n[o+s-r],n[o+s-r]=g}function aM(t){const e=t.slice();return kR(e),e}function IM(t,e,n){let i=0;const s=n[0],g=n[1],o=g;for(let r=0;r<g;r++)for(let a=0;a<s;a++)e[a*o+r]=t[i++]}function lM(t,e,n){let i=0;const s=n[0],g=n[1],o=n[2],r=o*g,a=o;for(let I=0;I<o;I++)for(let l=0;l<g;l++)for(let C=0;C<s;C++)e[C*r+l*a+I]=t[i++]}function CM(t,e,n){let i=0;const s=n[0],g=n[1],o=n[2],r=n[3],a=r*o*g,I=r*o,l=r;for(let C=0;C<r;C++)for(let c=0;c<o;c++)for(let A=0;A<g;A++)for(let d=0;d<s;d++)e[d*a+A*I+c*l+C]=t[i++]}function cM(t,e,n){const i=n.length,s=n.reduce((r,a)=>r*a),g=n.map((r,a)=>a+1===i?1:n.slice(a+1).reduce((I,l)=>I*l,1)),o=Array(i).fill(0);for(let r=0;r<s;r++){let a=0;for(let I=0;I<i;I++)a+=o[I]*g[I];e[a]=t[r],o[0]+=1;for(let I=0;I<i;I++)if(o[I]===n[I]){if(I+1===i)return;o[I]=0,o[I+1]+=1}}}const AM={[0]:Qy,[1]:Qy,[2]:IM,[3]:lM,[4]:CM};function dM(t,e,n){return(AM[n.length]||cM)(t,e,n)}function Vm(t){return t===null?!1:t instanceof ArrayBuffer||typeof SharedArrayBuffer=="function"&&t instanceof SharedArrayBuffer?!0:$o?t.toString().startsWith("[object ArrayBuffer]")||t.toString().startsWith("[object SharedArrayBuffer]"):!1}const HC=".zarray",Um=".zgroup",KR=".zattrs";async function Gn(t,e=null){e=vn(e);const i=Ts(e)+HC;return t.containsItem(i)}async function cn(t,e=null){e=vn(e);const i=Ts(e)+Um;return t.containsItem(i)}function Ts(t){return t.length>0?t+"/":""}async function LR(t,e,n,i){if(e.length===0)return;const s=e.split("/");let g="";for(const o of s.slice(0,s.length-1))g+=o,await Gn(t,g)?await c0(t,g,i):await cn(t,g)||await c0(t,g),g+="/"}async function c0(t,e=null,n=!1){if(e=vn(e),n)throw Error("Group overwriting not implemented yet :(");if(await Gn(t,e))throw new li(e);if(await cn(t,e))throw new wi(e);const i={zarr_format:2},s=Ts(e)+Um;await t.setItem(s,JSON.stringify(i))}async function Aa(t,e=null,n=null,i=!1){e=vn(e),await LR(t,e,n,i),await c0(t,e,i)}async function uM(t,e,n,i,s,g,o,r,a,I,l,C){if(a)throw Error("Array overwriting not implemented yet :(");if(await Gn(t,s))throw new li(s);if(await cn(t,s))throw new wi(s);if(i=i,e=Sm(e),n=sM(n,e),r=gM(r),o=o,l!==null&&l.length>0)throw Error("Filters are not supported yet");let c=o;typeof o=="number"&&(Number.isNaN(o)&&(c="NaN"),Number.POSITIVE_INFINITY===o&&(c="Infinity"),Number.NEGATIVE_INFINITY===o&&(c="-Infinity")),l=null;const A={zarr_format:2,shape:e,chunks:n,dtype:i,fill_value:c,order:r,compressor:g,filters:l};C&&(A.dimension_separator=C);const d=Ts(s)+HC;await t.setItem(d,JSON.stringify(A))}async function Jl(t,e,n,i,s=null,g=null,o=null,r="C",a=!1,I=null,l=null,C){s=vn(s),await LR(t,s,I,a),await uM(t,e,n,i,s,g,o,r,a,I,l,C)}function kC(t){if(typeof t!="string"){if($o&&Buffer.isBuffer(t))return JSON.parse(t.toString());if(Vm(t)){const e=new TextDecoder,n=new Uint8Array(t);return JSON.parse(e.decode(n))}else return t}return JSON.parse(t)}class MR{constructor(e,n,i,s=!0){this.store=e,this.key=n,this.readOnly=i,this.cache=s,this.cachedValue=null}async asObject(){if(this.cache&&this.cachedValue!==null)return this.cachedValue;const e=await this.getNoSync();return this.cache&&(this.cachedValue=e),e}async getNoSync(){try{const e=await this.store.getItem(this.key);return kC(e)}catch{return{}}}async setNoSync(e,n){const i=await this.getNoSync();return i[e]=n,await this.putNoSync(i),!0}async putNoSync(e){await this.store.setItem(this.key,JSON.stringify(e)),this.cache&&(this.cachedValue=e)}async delNoSync(e){const n=await this.getNoSync();return delete n[e],await this.putNoSync(n),!0}async put(e){if(this.readOnly)throw new kt("attributes are read-only");return this.putNoSync(e)}async setItem(e,n){if(this.readOnly)throw new kt("attributes are read-only");return this.setNoSync(e,n)}async getItem(e){return(await this.asObject())[e]}async deleteItem(e){if(this.readOnly)throw new kt("attributes are read-only");return this.delNoSync(e)}async containsItem(e){return(await this.asObject())[e]!==void 0}proxy(){return bm(this)}}const hM={"|b":Int8Array,"|B":Uint8Array,"|u1":Uint8Array,"|i1":Int8Array,"<b":Int8Array,"<B":Uint8Array,"<u1":Uint8Array,"<i1":Int8Array,"<u2":Uint16Array,"<i2":Int16Array,"<u4":Uint32Array,"<i4":Int32Array,"<f4":Float32Array,"<f8":Float64Array,">b":Int8Array,">B":Uint8Array,">u1":Uint8Array,">i1":Int8Array,">u2":Uint16Array,">i2":Int16Array,">u4":Uint32Array,">i4":Int32Array,">f4":Float32Array,">f8":Float64Array};function ri(t){const e=hM[t];if(!e)throw Error(`Dtype not recognized or not supported in zarr.js, got ${t}.`);return e}function PR(t){if(t instanceof Uint8Array)return"|u1";if(t instanceof Int8Array)return"|i1";if(t instanceof Uint16Array)return"<u2";if(t instanceof Int16Array)return"<i2";if(t instanceof Uint32Array)return"<u4";if(t instanceof Int32Array)return"<i4";if(t instanceof Float32Array)return"<f4";if(t instanceof Float64Array)return"<f8";throw new Ft("Mapping for TypedArray to Dtypestring not known")}function xm(t){return t.byteLength!==void 0?t.constructor:xm(t[0])}function mM(t,e,n){const i=Ns(n,e),[s,g]=vg(i,e);return[A0(t,e,s),g]}function A0(t,e,n){const i=n[0];if(typeof i=="number")return e.length===1?t[i]:A0(t[i],e.slice(1),n.slice(1));const[s,g,o,r]=i;if(r===0)return new(xm(t))(0);if(e.length===1){if(o===1)return t.slice(s,g);const I=new t.constructor(r);for(let l=0;l<r;l++)I[l]=t[s+l*o];return I}let a=new Array(r);for(let I=0;I<r;I++)a[I]=A0(t[s+I*o],e.slice(1),n.slice(1));return r>0&&typeof a[0]=="number"&&(a=t[0].constructor.from(a)),a}function fM(t,e,n,i){const s=Ns(i,n,!0),[g,o]=vg(s,n);Wm(t,e,n,g)}function pM(t,e,n,i,s){const g=Ns(s,n,!1),[o,r]=vg(g,n);if(JSON.stringify(r)!==JSON.stringify(i))throw new Ft(`Shape mismatch in target and source NestedArray: ${r} and ${i}`);d0(t,e,n,o)}function d0(t,e,n,i){const s=i[0];if(typeof e=="number"){Wm(t,e,n,i.map(I=>typeof I=="number"?[I,I+1,1,1]:I));return}if(typeof s=="number"){d0(t[s],e,n.slice(1),i.slice(1));return}const[g,o,r,a]=s;if(n.length===1){if(r===1)t.set(e,g);else for(let I=0;I<a;I++)t[g+I*r]=e[I];return}for(let I=0;I<a;I++)d0(t[g+I*r],e[I],n.slice(1),i.slice(1))}function Wm(t,e,n,i){const s=i[0],[g,o,r,a]=s;if(n.length===1){if(r===1)t.fill(e,g,o);else for(let I=0;I<a;I++)t[g+I*r]=e;return}for(let I=0;I<a;I++)Wm(t[g+I*r],e,n.slice(1),i.slice(1))}function BM(t,e,n){n===void 0&&(n=xm(t));const i=e.reduce((g,o)=>g*o,1),s=new n(i);return JR(t,e,s,0),s}function JR(t,e,n,i){if(e.length===1){n.set(t,i);return}if(e.length===2){for(let o=0;o<e[0];o++)n.set(t[o],i+e[1]*o);return t}const s=e.slice(1),g=s.reduce((o,r)=>o*r,1);for(let o=0;o<e[0];o++)JR(t[o],s,n,i+g*o);return t}class Fi{constructor(e,n,i){const s=e!==null&&!!e.BYTES_PER_ELEMENT;if(n===void 0){if(!s)throw new Ft("Shape argument is required unless you pass in a TypedArray");n=[e.length]}if(i===void 0){if(!s)throw new Ft("Dtype argument is required unless you pass in a TypedArray");i=PR(e)}if(n=Sm(n),this.shape=n,this.dtype=i,s&&n.length!==1&&(e=e.buffer),this.shape.length===0)this.data=new(ri(i))(1);else if($o&&Buffer.isBuffer(e)||Vm(e)||e===null){const g=n.reduce((a,I)=>a*I,1);e===null&&(e=new ArrayBuffer(g*parseInt(i[i.length-1],10)));const o=e.byteLength/parseInt(i[i.length-1],10);if(g!==o)throw new Error(`Buffer has ${o} of dtype ${i}, shape is too large or small ${n} (flat=${g})`);const r=ri(i);this.data=DR(e,r,n)}else this.data=e}get(e){const[n,i]=mM(this.data,this.shape,e);return i.length===0?n:new Fi(n,i,this.dtype)}set(e=null,n){e===null&&(e=[Yi(null)]),typeof n=="number"?this.shape.length===0?this.data[0]=n:fM(this.data,n,this.shape,e):pM(this.data,n.data,this.shape,n.shape,e)}flatten(){return this.shape.length===1?this.data:BM(this.data,this.shape,ri(this.dtype))}static arange(e,n="<i4"){const i=ri(n),s=bM([e],i);return new Fi(s,[e],n)}}function bM(t,e){const n=t.reduce((s,g)=>s*g,1),i=new e(n);return i.set([...Array(n).keys()]),i}function DR(t,e,n,i=0){if(n.length===1)return new e(t.slice(i,i+n[0]*e.BYTES_PER_ELEMENT));const s=new Array(n[0]);if(n.length===2){for(let r=0;r<n[0];r++)s[r]=new e(t.slice(i+n[1]*r*e.BYTES_PER_ELEMENT,i+n[1]*(r+1)*e.BYTES_PER_ELEMENT));return s}const g=n.slice(1),o=g.reduce((r,a)=>r*a,1);for(let r=0;r<n[0];r++)s[r]=DR(t,e,g,i+o*r*e.BYTES_PER_ELEMENT);return s}function yM(t,e,n,i,s){const g=Ns(i,n,!0),[o]=vg(g,n);zR(s,t,e,o)}function vM(t,e,n,i,s,g,o){const r=Ns(i,n,!1),[a,I]=vg(r,n);if(JSON.stringify(I)!==JSON.stringify(o))throw new Ft(`Shape mismatch in target and source RawArray: ${I} and ${o}`);u0(t,e,a,s,g)}function GM(t,e,n,i,s,g,o,r){const a=Ns(i,n,!0),[I]=vg(a,n),l=Ns(r,o,!1),[C]=vg(l,o);h0(t,e,I,s,g,C)}function zR(t,e,n,i){const[s,...g]=i,[o,...r]=n,[a,I,l,C]=s;if(n.length===1){if(l===1&&o===1)e.fill(t,a,a+C);else for(let c=0;c<C;c++)e[o*(a+l*c)]=t;return}for(let c=0;c<C;c++)zR(t,e.subarray(o*(a+l*c)),r,g)}function u0(t,e,n,i,s){if(n.length===0){t.set(i);return}const[g,...o]=n,[r,...a]=e;if(typeof g=="number"){u0(t.subarray(g*r),a,o,i,s);return}const[I,...l]=s,[C,c,A,d]=g;if(e.length===1){if(A===1&&r===1&&I===1)t.set(i.subarray(0,d),C);else for(let h=0;h<d;h++)t[r*(C+A*h)]=i[I*h];return}for(let h=0;h<d;h++)u0(t.subarray(r*(C+h*A)),a,o,i.subarray(I*h),l)}function h0(t,e,n,i,s,g){if(g.length===0){t.set(i.subarray(0,t.length));return}const[o,...r]=n,[a,...I]=g,[l,...C]=e,[c,...A]=s;if(typeof a=="number"){h0(t,e,n,i.subarray(c*a),A,I);return}const[d,h,u,m]=o,[f,p,B,G]=a;if(e.length===1&&s.length===1){if(u===1&&l===1&&B===1&&c===1)t.set(i.subarray(f,f+m),d);else for(let y=0;y<m;y++)t[l*(d+u*y)]=i[c*(f+B*y)];return}for(let y=0;y<m;y++)h0(t.subarray(l*(d+y*u)),C,r,i.subarray(c*(f+y*B)),A,I)}class tg{constructor(e,n,i,s){const g=e!==null&&!!e.BYTES_PER_ELEMENT;if(n===void 0){if(!g)throw new Ft("Shape argument is required unless you pass in a TypedArray");n=[e.length]}if(n=Sm(n),i===void 0){if(!g)throw new Ft("Dtype argument is required unless you pass in a TypedArray");i=PR(e)}if(s===void 0&&(s=rM(n)),this.shape=n,this.dtype=i,this.strides=s,g&&n.length!==1&&(e=e.buffer),this.shape.length===0)this.data=new(ri(i))(1);else if($o&&Buffer.isBuffer(e)||Vm(e)||e===null){const o=n.reduce((I,l)=>I*l,1);e===null&&(e=new ArrayBuffer(o*parseInt(i[i.length-1],10)));const r=e.byteLength/parseInt(i[i.length-1],10);if(o!==r)throw new Error(`Buffer has ${r} of dtype ${i}, shape is too large or small ${n} (flat=${o})`);const a=ri(i);this.data=new a(e)}else this.data=e}set(e=null,n,i){e===null&&(e=[Yi(null)]),typeof n=="number"?this.shape.length===0?this.data[0]=n:yM(this.data,this.strides,this.shape,e,n):n instanceof tg&&i?GM(this.data,this.strides,this.shape,e,n.data,n.strides,n.shape,i):vM(this.data,this.strides,this.shape,e,n.data,n.strides,n.shape)}}var OR={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function s(a,I,l){this.fn=a,this.context=I,this.once=l||!1}function g(a,I,l,C,c){if(typeof l!="function")throw new TypeError("The listener must be a function");var A=new s(l,C||a,c),d=n?n+I:I;return a._events[d]?a._events[d].fn?a._events[d]=[a._events[d],A]:a._events[d].push(A):(a._events[d]=A,a._eventsCount++),a}function o(a,I){--a._eventsCount===0?a._events=new i:delete a._events[I]}function r(){this._events=new i,this._eventsCount=0}r.prototype.eventNames=function(){var I=[],l,C;if(this._eventsCount===0)return I;for(C in l=this._events)e.call(l,C)&&I.push(n?C.slice(1):C);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(l)):I},r.prototype.listeners=function(I){var l=n?n+I:I,C=this._events[l];if(!C)return[];if(C.fn)return[C.fn];for(var c=0,A=C.length,d=new Array(A);c<A;c++)d[c]=C[c].fn;return d},r.prototype.listenerCount=function(I){var l=n?n+I:I,C=this._events[l];return C?C.fn?1:C.length:0},r.prototype.emit=function(I,l,C,c,A,d){var h=n?n+I:I;if(!this._events[h])return!1;var u=this._events[h],m=arguments.length,f,p;if(u.fn){switch(u.once&&this.removeListener(I,u.fn,void 0,!0),m){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,l),!0;case 3:return u.fn.call(u.context,l,C),!0;case 4:return u.fn.call(u.context,l,C,c),!0;case 5:return u.fn.call(u.context,l,C,c,A),!0;case 6:return u.fn.call(u.context,l,C,c,A,d),!0}for(p=1,f=new Array(m-1);p<m;p++)f[p-1]=arguments[p];u.fn.apply(u.context,f)}else{var B=u.length,G;for(p=0;p<B;p++)switch(u[p].once&&this.removeListener(I,u[p].fn,void 0,!0),m){case 1:u[p].fn.call(u[p].context);break;case 2:u[p].fn.call(u[p].context,l);break;case 3:u[p].fn.call(u[p].context,l,C);break;case 4:u[p].fn.call(u[p].context,l,C,c);break;default:if(!f)for(G=1,f=new Array(m-1);G<m;G++)f[G-1]=arguments[G];u[p].fn.apply(u[p].context,f)}}return!0},r.prototype.on=function(I,l,C){return g(this,I,l,C,!1)},r.prototype.once=function(I,l,C){return g(this,I,l,C,!0)},r.prototype.removeListener=function(I,l,C,c){var A=n?n+I:I;if(!this._events[A])return this;if(!l)return o(this,A),this;var d=this._events[A];if(d.fn)d.fn===l&&(!c||d.once)&&(!C||d.context===C)&&o(this,A);else{for(var h=0,u=[],m=d.length;h<m;h++)(d[h].fn!==l||c&&!d[h].once||C&&d[h].context!==C)&&u.push(d[h]);u.length?this._events[A]=u.length===1?u[0]:u:o(this,A)}return this},r.prototype.removeAllListeners=function(I){var l;return I?(l=n?n+I:I,this._events[l]&&o(this,l)):(this._events=new i,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,r.EventEmitter=r,t.exports=r})(OR);var ZM=OR.exports;class jR extends Error{constructor(e){super(e),this.name="TimeoutError"}}function RM(t,e,n,i){let s;const g=new Promise((o,r)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===Number.POSITIVE_INFINITY){o(t);return}i={customTimers:{setTimeout,clearTimeout},...i},s=i.customTimers.setTimeout.call(void 0,()=>{if(typeof n=="function"){try{o(n())}catch(l){r(l)}return}const a=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,I=n instanceof Error?n:new jR(a);typeof t.cancel=="function"&&t.cancel(),r(I)},e),(async()=>{try{o(await t)}catch(a){r(a)}finally{i.customTimers.clearTimeout.call(void 0,s)}})()});return g.clear=()=>{clearTimeout(s),s=void 0},g}function FM(t,e,n){let i=0,s=t.length;for(;s>0;){const g=Math.trunc(s/2);let o=i+g;n(t[o],e)<=0?(i=++o,s-=g+1):s=g}return i}class SM{constructor(){Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:[]})}enqueue(e,n){var i;n={priority:0,...n};const s={priority:n.priority,run:e};if(this.size&&((i=this._queue[this.size-1])===null||i===void 0?void 0:i.priority)>=n.priority){this._queue.push(s);return}const g=FM(this._queue,s,(o,r)=>r.priority-o.priority);this._queue.splice(g,0,s)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}const ul=()=>{},VM=new jR;class Yy extends ZM{constructor(e){var n,i,s,g;if(super(),Object.defineProperty(this,"_carryoverConcurrencyCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isIntervalIgnored",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalCap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalEnd",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_timeoutId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queueClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pendingCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_concurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isPaused",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_resolveEmpty",{enumerable:!0,configurable:!0,writable:!0,value:ul}),Object.defineProperty(this,"_resolveIdle",{enumerable:!0,configurable:!0,writable:!0,value:ul}),Object.defineProperty(this,"_timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_throwOnTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:SM,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(i=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(g=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&g!==void 0?g:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=ul,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=ul,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((i,s)=>{const g=async()=>{this._pendingCount++,this._intervalCount++;try{const r=await(this._timeout===void 0&&n.timeout===void 0?e():RM(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(VM)}));i(r),this.emit("completed",r)}catch(o){s(o),this.emit("error",o)}this._next()};this._queue.enqueue(g,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async i=>this.add(i,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onSizeLessThan(e){if(!(this._queue.size<e))return new Promise(n=>{const i=()=>{this._queue.size<e&&(this.removeListener("next",i),n())};this.on("next",i)})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}class er{constructor(e,n=null,i,s=!1,g=null,o=!0,r=!0){this.store=e,this._chunkStore=g,this.path=vn(n),this.keyPrefix=Ts(this.path),this.readOnly=s,this.cacheMetadata=o,this.cacheAttrs=r,this.meta=i,this.meta.compressor!==null?this.compressor=DL(this.meta.compressor):this.compressor=null;const a=this.keyPrefix+KR;this.attrs=new MR(this.store,a,this.readOnly,r)}get chunkStore(){return this._chunkStore?this._chunkStore:this.store}get name(){return this.path.length>0?this.path[0]!=="/"?"/"+this.path:this.path:null}get basename(){const e=this.name;if(e===null)return null;const n=e.split("/");return n[n.length-1]}get shape(){return this.meta.shape}get chunks(){return this.meta.chunks}get chunkSize(){return this.chunks.reduce((e,n)=>e*n,1)}get dtype(){return this.meta.dtype}get fillValue(){const e=this.meta.fill_value;return e==="NaN"?NaN:e==="Infinity"?1/0:e==="-Infinity"?-1/0:this.meta.fill_value}get nDims(){return this.meta.shape.length}get size(){return this.meta.shape.reduce((e,n)=>e*n,1)}get length(){return this.shape[0]}get _chunkDataShape(){if(this.shape.length===0)return[1];{const e=[];for(let n=0;n<this.shape.length;n++)e[n]=Math.ceil(this.shape[n]/this.chunks[n]);return e}}get chunkDataShape(){return this._chunkDataShape}get numChunks(){return this.chunkDataShape.reduce((e,n)=>e*n,1)}static async create(e,n=null,i=!1,s=null,g=!0,o=!0){const r=await this.loadMetadataForConstructor(e,n);return new er(e,n,r,i,s,g,o)}static async loadMetadataForConstructor(e,n){try{n=vn(n);const i=Ts(n),s=await e.getItem(i+HC);return kC(s)}catch(i){throw await cn(e,n)?new wi(n!=null?n:""):new Error("Failed to load metadata for ZarrArray:"+i.toString())}}async reloadMetadata(){const e=this.keyPrefix+HC,n=this.store.getItem(e);return this.meta=kC(await n),this.meta}async refreshMetadata(){this.cacheMetadata||await this.reloadMetadata()}get(e=null,n={}){return this.getBasicSelection(e,!1,n)}getRaw(e=null,n={}){return this.getBasicSelection(e,!0,n)}async getBasicSelection(e,n=!1,{concurrencyLimit:i=10,progressCallback:s}={}){if(this.cacheMetadata||await this.reloadMetadata(),this.shape.length===0)throw new Error("Shape [] indexing is not supported yet");return this.getBasicSelectionND(e,n,i,s)}getBasicSelectionND(e,n,i,s){const g=new Ty(e,this);return this.getSelection(g,n,i,s)}async getSelection(e,n,i,s){const g=this.dtype,o=e.shape,r=e.shape.reduce((l,C)=>l*C,1);if(n&&r===this.chunkSize){const l=e.iter(),C=l.next();if(C.done===!1&&l.next().done===!0){const c=C.value;return await this.decodeDirectToRawArray(c,o,r)}}const a=n?new tg(null,o,g):new Fi(null,o,g);if(r===0)return a;const I=new Yy({concurrency:i});if(s){let l=0,C=0;for(const c of e.iter())C+=1;s({progress:0,queueSize:C});for(const c of e.iter())(async()=>(await I.add(()=>this.chunkGetItem(c.chunkCoords,c.chunkSelection,a,c.outSelection,e.dropAxes)),l+=1,s({progress:l,queueSize:C})))()}else for(const l of e.iter())I.add(()=>this.chunkGetItem(l.chunkCoords,l.chunkSelection,a,l.outSelection,e.dropAxes));return await I.onIdle(),a.shape.length===0?a.data[0]:a}async chunkGetItem(e,n,i,s,g){if(e.length!==this._chunkDataShape.length)throw new Ft(`Inconsistent shapes: chunkCoordsLength: ${e.length}, cDataShapeLength: ${this.chunkDataShape.length}`);const o=this.chunkKey(e);try{const r=await this.chunkStore.getItem(o),a=await this.decodeChunk(r);if(i instanceof Fi){if(tM(s)&&Xy(n,this.chunks)&&!this.meta.filters){i.set(s,this.toNestedArray(a));return}const l=this.toNestedArray(a).get(n);if(g!==null)throw new Error("Drop axes is not supported yet");i.set(s,l)}else i.set(s,this.chunkBufferToRawArray(a),n)}catch(r){if(hd(r))this.fillValue!==null&&i.set(s,this.fillValue);else throw r}}async getRawChunk(e,n){if(e.length!==this.shape.length)throw new Error(`Chunk coordinates ${e.join(".")} do not correspond to shape ${this.shape}.`);try{for(let r=0;r<e.length;r++){const a=Math.ceil(this.shape[r]/this.chunks[r]);e[r]=Rm(e[r],a)}}catch(r){throw r instanceof yg?new yg(`index ${e.join(".")} is out of bounds for shape: ${this.shape} and chunks ${this.chunks}`):r}const i=this.chunkKey(e),s=this.chunkStore.getItem(i,n==null?void 0:n.storeOptions),g=await this.decodeChunk(await s),o=this.chunks.filter(r=>r!==1);return new tg(g,o,this.dtype)}chunkKey(e){var n;const i=(n=this.meta.dimension_separator)!==null&&n!==void 0?n:".";return this.keyPrefix+e.join(i)}ensureByteArray(e){return typeof e=="string"?new Uint8Array(Buffer.from(e).buffer):new Uint8Array(e)}toTypedArray(e){return new(ri(this.dtype))(e)}toNestedArray(e){const n=this.ensureByteArray(e).buffer;return new Fi(n,this.chunks,this.dtype)}async decodeChunk(e){let n=this.ensureByteArray(e);if(this.compressor!==null&&(n=await(await this.compressor).decode(n)),this.dtype.includes(">")&&kR(this.toTypedArray(n.buffer)),this.meta.order==="F"&&this.nDims>1){const i=this.toTypedArray(n.buffer),s=new(ri(this.dtype))(i.length);return dM(i,s,this.chunks),s.buffer}return n.buffer}chunkBufferToRawArray(e){return new tg(e,this.chunks,this.dtype)}async decodeDirectToRawArray({chunkCoords:e},n,i){const s=this.chunkKey(e);try{const g=await this.chunkStore.getItem(s);return new tg(await this.decodeChunk(g),n,this.dtype)}catch(g){if(hd(g)){const o=new(ri(this.dtype))(i);return new tg(o.fill(this.fillValue),n)}else throw g}}async set(e=null,n,i={}){await this.setBasicSelection(e,n,i)}async setBasicSelection(e,n,{concurrencyLimit:i=10,progressCallback:s}={}){if(this.readOnly)throw new kt("Object is read only");if(this.cacheMetadata||await this.reloadMetadata(),this.shape.length===0)throw new Error("Shape [] indexing is not supported yet");await this.setBasicSelectionND(e,n,i,s)}async setBasicSelectionND(e,n,i,s){const g=new Ty(e,this);await this.setSelection(g,n,i,s)}getChunkValue(e,n,i,s){let g;if(s.length===0)g=i;else if(typeof i=="number")g=i;else if(g=i.get(e.outSelection),n.dropAxes!==null)throw new Error("Handling drop axes not supported yet");return g}async setSelection(e,n,i,s){const g=e.shape;if(g.length!==0){if(typeof n!="number")if(n instanceof Fi){if(!oM(n.shape,g))throw new Ft(`Shape mismatch in source NestedArray and set selection: ${n.shape} and ${g}`)}else throw new Error("Unknown data type for setting :(")}const o=new Yy({concurrency:i});if(s){let r=0;for(const I of e.iter())r+=1;let a=0;s({progress:0,queueSize:r});for(const I of e.iter()){const l=this.getChunkValue(I,e,n,g);(async()=>(await o.add(()=>this.chunkSetItem(I.chunkCoords,I.chunkSelection,l)),a+=1,s({progress:a,queueSize:r})))()}}else for(const r of e.iter()){const a=this.getChunkValue(r,e,n,g);o.add(()=>this.chunkSetItem(r.chunkCoords,r.chunkSelection,a))}await o.onIdle()}async chunkSetItem(e,n,i){if(this.meta.order==="F"&&this.nDims>1)throw new Error("Setting content for arrays in F-order is not supported.");const s=this.chunkKey(e);let g=null;const o=ri(this.dtype),r=this.chunkSize;if(Xy(n,this.chunks))typeof i=="number"?(g=new o(r),g.fill(i)):g=i.flatten();else{let I;try{const C=await this.chunkStore.getItem(s),c=await this.decodeChunk(C);I=this.toTypedArray(c)}catch(C){if(hd(C))I=new o(r),this.fillValue!==null&&I.fill(this.fillValue);else throw C}const l=new Fi(I,this.chunks,this.dtype);l.set(n,i),g=l.flatten()}const a=await this.encodeChunk(g);this.chunkStore.setItem(s,a)}async encodeChunk(e){if(this.dtype.includes(">")&&(e=aM(e)),this.compressor!==null){const n=new Uint8Array(e.buffer);return(await(await this.compressor).encode(n)).buffer}return e.buffer}}class UM{constructor(e={}){this.root=e}proxy(){return bm(this)}getParent(e){let n=this.root;const i=e.split("/");for(const s of i.slice(0,i.length-1))if(n=n[s],!n)throw Error(e);return[n,i[i.length-1]]}requireParent(e){let n=this.root;const i=e.split("/");for(const s of i.slice(0,i.length-1))n[s]===void 0&&(n[s]={}),n=n[s];return[n,i[i.length-1]]}getItem(e){const[n,i]=this.getParent(e),s=n[i];if(s===void 0)throw new mI(e);return s}setItem(e,n){const[i,s]=this.requireParent(e);return i[s]=n,!0}deleteItem(e){const[n,i]=this.getParent(e);return delete n[i]}containsItem(e){try{return this.getItem(e)!==void 0}catch{return!1}}keys(){throw new Error("Method not implemented.")}}var ni;(function(t){t.HEAD="HEAD",t.GET="GET",t.PUT="PUT"})(ni||(ni={}));const xM=[ni.HEAD,ni.GET,ni.PUT];class qR{constructor(e,n={}){this.url=e;const{fetchOptions:i={},supportedMethods:s=xM}=n;this.fetchOptions=i,this.supportedMethods=new Set(s)}keys(){throw new Error("Method not implemented.")}async getItem(e,n){const i=md(this.url,e),s=await fetch(i,{...this.fetchOptions,...n});if(s.status===404)throw new mI(e);if(s.status!==200)throw new Zm(String(s.status));return $o?Buffer.from(await s.arrayBuffer()):s.arrayBuffer()}async setItem(e,n){if(!this.supportedMethods.has(ni.PUT))throw new Error("HTTP PUT no a supported method for store.");const i=md(this.url,e);return typeof n=="string"&&(n=new TextEncoder().encode(n).buffer),(await fetch(i,{...this.fetchOptions,method:ni.PUT,body:n})).status.toString()[0]==="2"}deleteItem(e){throw new Error("Method not implemented.")}async containsItem(e){const n=md(this.url,e),i=this.supportedMethods.has(ni.HEAD)?ni.HEAD:ni.GET;return(await fetch(n,{...this.fetchOptions,method:i})).status===200}}async function tr({shape:t,chunks:e=!0,dtype:n="<i4",compressor:i=null,fillValue:s=null,order:g="C",store:o,overwrite:r=!1,path:a,chunkStore:I,filters:l,cacheMetadata:C=!0,cacheAttrs:c=!0,readOnly:A=!1,dimensionSeparator:d}){return o=Ha(o),await Jl(o,t,e,n,a,i,s,g,r,I,l,d),await er.create(o,a,A,I,C,c)}async function WM(t,e={}){return e.fillValue=null,tr({shape:t,...e})}async function wM(t,e={}){return e.fillValue=0,tr({shape:t,...e})}async function NM(t,e={}){return e.fillValue=1,tr({shape:t,...e})}async function TM(t,e,n={}){return n.fillValue=e,tr({shape:t,...n})}async function _y(t,e={}){let n=null;t instanceof Fi?(n=t.shape,e.dtype=e.dtype===void 0?t.dtype:e.dtype):n=t.byteLength;const i=e.readOnly===void 0?!1:e.readOnly;e.readOnly=!1;const s=await tr({shape:n,...e});return await s.set(null,t),s.readOnly=i,s}async function EM({shape:t,mode:e="a",chunks:n=!0,dtype:i="<i4",compressor:s=null,fillValue:g=null,order:o="C",store:r,overwrite:a=!1,path:I=null,chunkStore:l,filters:C,cacheMetadata:c=!0,cacheAttrs:A=!0,dimensionSeparator:d}={}){if(r=Ha(r),l===void 0&&(l=Ha(r)),I=vn(I),e==="r"||e==="r+"){if(!await Gn(r,I))throw await cn(r,I)?new wi(I):new ym(I)}else if(e==="w"){if(t===void 0)throw new Ft("Shape can not be undefined when creating a new array");await Jl(r,t,n,i,I,s,g,o,a,l,C,d)}else if(e==="a"){if(!await Gn(r,I)){if(await cn(r,I))throw new wi(I);if(t===void 0)throw new Ft("Shape can not be undefined when creating a new array");await Jl(r,t,n,i,I,s,g,o,a,l,C,d)}}else if(e==="w-"||e==="x"){if(await Gn(r,I))throw new li(I);if(await cn(r,I))throw new wi(I);if(t===void 0)throw new Ft("Shape can not be undefined when creating a new array");await Jl(r,t,n,i,I,s,g,o,a,l,C,d)}else throw new Ft(`Invalid mode argument: ${e}`);const h=e==="r";return er.create(r,I,h,l,c,A)}function Ha(t){return t===void 0?new UM:typeof t=="string"?new qR(t):t}class Ig{constructor(e,n=null,i,s=!1,g=null,o=!0){this.store=e,this._chunkStore=g,this.path=vn(n),this.keyPrefix=Ts(this.path),this.readOnly=s,this.meta=i;const r=this.keyPrefix+KR;this.attrs=new MR(this.store,r,this.readOnly,o)}get name(){return this.path.length>0?this.path[0]!=="/"?"/"+this.path:this.path:"/"}get basename(){const e=this.name.split("/");return e[e.length-1]}get chunkStore(){return this._chunkStore?this._chunkStore:this.store}static async create(e,n=null,i=!1,s=null,g=!0){const o=await this.loadMetadataForConstructor(e,n);return new Ig(e,n,o,i,s,g)}static async loadMetadataForConstructor(e,n){n=vn(n);const i=Ts(n);try{const s=await e.getItem(i+Um);return kC(s)}catch{throw await Gn(e,n)?new li(n):new Xc(n)}}itemPath(e){const n=typeof e=="string"&&e.length>0&&e[0]==="/",i=vn(e);return!n&&this.path.length>0?this.keyPrefix+i:i}async createGroup(e,n=!1){if(this.readOnly)throw new kt("group is read only");const i=this.itemPath(e);return await Aa(this.store,i,this._chunkStore,n),Ig.create(this.store,i,this.readOnly,this._chunkStore,this.attrs.cache)}async requireGroup(e,n=!1){if(this.readOnly)throw new kt("group is read only");const i=this.itemPath(e);return await cn(this.store,i)||await Aa(this.store,i,this._chunkStore,n),Ig.create(this.store,i,this.readOnly,this._chunkStore,this.attrs.cache)}getOptsForArrayCreation(e,n={}){const i=this.itemPath(e);return n.path=i,n.cacheAttrs===void 0&&(n.cacheAttrs=this.attrs.cache),n.store=this.store,n.chunkStore=this.chunkStore,n}array(e,n,i,s){if(this.readOnly)throw new kt("group is read only");return i=this.getOptsForArrayCreation(e,i),i.overwrite=s===void 0?i.overwrite:s,_y(n,i)}empty(e,n,i={}){if(this.readOnly)throw new kt("group is read only");return i=this.getOptsForArrayCreation(e,i),WM(n,i)}zeros(e,n,i={}){if(this.readOnly)throw new kt("group is read only");return i=this.getOptsForArrayCreation(e,i),wM(n,i)}ones(e,n,i={}){if(this.readOnly)throw new kt("group is read only");return i=this.getOptsForArrayCreation(e,i),NM(n,i)}full(e,n,i,s={}){if(this.readOnly)throw new kt("group is read only");return s=this.getOptsForArrayCreation(e,s),TM(n,i,s)}createDataset(e,n,i,s){if(this.readOnly)throw new kt("group is read only");s=this.getOptsForArrayCreation(e,s);let g;if(i===void 0){if(n===void 0)throw new Ft("Shape must be set if no data is passed to CreateDataset");g=tr({shape:n,...s})}else g=_y(i,s);return g}async getItem(e){const n=this.itemPath(e);if(await Gn(this.store,n))return er.create(this.store,n,this.readOnly,this.chunkStore,void 0,this.attrs.cache);if(await cn(this.store,n))return Ig.create(this.store,n,this.readOnly,this._chunkStore,this.attrs.cache);throw new mI(e)}async setItem(e,n){return await this.array(e,n,{},!0),!0}async deleteItem(e){throw this.readOnly?new kt("group is read only"):new Error("Method not implemented.")}async containsItem(e){const n=this.itemPath(e);return await Gn(this.store,n)||cn(this.store,n)}proxy(){return bm(this)}}async function wm(t,e=null,n="a",i,s=!0){if(t=Ha(t),i!==void 0&&(i=Ha(t)),e=vn(e),n==="r"||n==="r+"){if(!await cn(t,e))throw await Gn(t,e)?new li(e):new Xc(e)}else if(n==="w")await Aa(t,e,i,!0);else if(n==="a"){if(!await cn(t,e)){if(await Gn(t,e))throw new li(e);await Aa(t,e,i)}}else if(n==="w-"||n==="x"){if(await Gn(t,e))throw new li(e);if(await cn(t,e))throw new wi(e);await Aa(t,e,i)}else throw new Ft(`Invalid mode argument: ${n}`);const g=n==="r";return Ig.create(t,e,g,i,s)}var Yc={exports:{}},fI={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QM=Z.exports,$R=60103;fI.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var Hy=Symbol.for;$R=Hy("react.element"),fI.Fragment=Hy("react.fragment")}var XM=QM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,YM=Object.prototype.hasOwnProperty,_M={key:!0,ref:!0,__self:!0,__source:!0};function eF(t,e,n){var i,s={},g=null,o=null;n!==void 0&&(g=""+n),e.key!==void 0&&(g=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)YM.call(e,i)&&!_M.hasOwnProperty(i)&&(s[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:$R,type:t,key:g,ref:o,props:s,_owner:XM.current}}fI.jsx=eF;fI.jsxs=eF;(function(t){t.exports=fI})(Yc);const k=Yc.exports.jsx,Ke=Yc.exports.jsxs,ks=Yc.exports.Fragment;var HM=`#define SHADER_NAME xr-layer-fragment-shader
precision highp float;precision highp int;precision highp SAMPLER_TYPE;
#define GLSLIFY 1
uniform SAMPLER_TYPE channel0;uniform SAMPLER_TYPE channel1;uniform SAMPLER_TYPE channel2;uniform SAMPLER_TYPE channel3;uniform SAMPLER_TYPE channel4;uniform SAMPLER_TYPE channel5;in vec2 vTexCoord;uniform vec2 contrastLimits[6];void main(){float intensity0=float(texture(channel0,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity0,contrastLimits[0],0);float intensity1=float(texture(channel1,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity1,contrastLimits[1],1);float intensity2=float(texture(channel2,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity2,contrastLimits[2],2);float intensity3=float(texture(channel3,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity3,contrastLimits[3],3);float intensity4=float(texture(channel4,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity4,contrastLimits[4],4);float intensity5=float(texture(channel5,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity5,contrastLimits[5],5);DECKGL_MUTATE_COLOR(gl_FragColor,intensity0,intensity1,intensity2,intensity3,intensity4,intensity5,vTexCoord);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(gl_FragColor,geometry);}`,kM=`#define GLSLIFY 1
#define SHADER_NAME xr-layer-vertex-shader
attribute vec2 texCoords;attribute vec3 positions;attribute vec3 positions64Low;attribute vec3 instancePickingColors;varying vec2 vTexCoord;void main(void){geometry.worldPosition=positions;geometry.uv=texCoords;geometry.pickingColor=instancePickingColors;gl_Position=project_position_to_clipspace(positions,positions64Low,vec3(0.),geometry.position);DECKGL_FILTER_GL_POSITION(gl_Position,geometry);vTexCoord=texCoords;vec4 color=vec4(0.);DECKGL_FILTER_COLOR(color,geometry);}`,KM=`#define GLSLIFY 1
float apply_contrast_limits(float intensity,vec2 contrastLimits){return max(0.,(intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0])));}`,LM={name:"channel-intensity-module",defines:{SAMPLER_TYPE:"usampler2D",COLORMAP_FUNCTION:""},fs:KM};const MM=255,ky=[0,0,0],tF=6,PM="-apple-system, 'Helvetica Neue', Arial, sans-serif",Ky={Uint8:{format:q.R8UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_BYTE,max:2**8-1,sampler:"usampler2D"},Uint16:{format:q.R16UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_SHORT,max:2**16-1,sampler:"usampler2D"},Uint32:{format:q.R32UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_INT,max:2**32-1,sampler:"usampler2D"},Float32:{format:q.R32F,dataFormat:q.RED,type:q.FLOAT,max:3.4*10**38,sampler:"sampler2D"},Int8:{format:q.R8I,dataFormat:q.RED_INTEGER,type:q.BYTE,max:2**(8-1)-1,sampler:"isampler2D"},Int16:{format:q.R16I,dataFormat:q.RED_INTEGER,type:q.SHORT,max:2**(16-1)-1,sampler:"isampler2D"},Int32:{format:q.R32I,dataFormat:q.RED_INTEGER,type:q.INT,max:2**(32-1)-1,sampler:"isampler2D"},Float64:{format:q.R32F,dataFormat:q.RED,type:q.FLOAT,max:3.4*10**38,sampler:"sampler2D",cast:t=>new Float32Array(t)}},JM=["jet","hsv","hot","cool","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","alpha","viridis","inferno","magma","plasma","warm","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"];var Ci;(function(t){t.MAX_INTENSITY_PROJECTION="Maximum Intensity Projection",t.MIN_INTENSITY_PROJECTION="Minimum Intensity Projection",t.ADDITIVE="Additive"})(Ci||(Ci={}));function DM(t){return[...Array(t).keys()]}function Nm(t,e,n){for(let i=0;i<n;i+=1)t.push(e);return t}function Tm(t){const e=Ky[t];if(!e){const n=Object.keys(Ky);throw Error(`Dtype not supported, got ${t}. Must be one of ${n}.`)}return e}function nF({contrastLimits:t=[],channelsVisible:e,domain:n,dtype:i}){const s=n&&n[1]||Tm(i).max,g=t.map((a,I)=>e[I]?a:[s,s]),o=tF-g.length;if(o<0)throw Error(`${g.lengths} channels passed in, but only 6 are allowed.`);return Nm(g,[s,s],o).reduce((a,I)=>a.concat(I),[])}function zM(t){var s,g;const{x:e,y:n,z:i}=(g=(s=t==null?void 0:t.meta)==null?void 0:s.physicalSizes)!=null?g:{};if((e==null?void 0:e.size)&&(n==null?void 0:n.size)&&(i==null?void 0:i.size)){const o=Math.min(i.size,e.size,n.size),r=[e.size/o,n.size/o,i.size/o];return new Ee().scale(r)}return new Ee().identity()}const Ly={fs:HM,vs:kM};function OM(t,e){const n=Yu(t,Te.TEXTURE_FLOAT),i=Yu(t,Te.TEXTURE_FILTER_LINEAR_FLOAT);if(!n)throw new Error("WebGL1 context does not support floating point textures.  Unable to display raster data.");return!i&&e===q.LINEAR?(console.warn("LINEAR filtering not supported in WebGL1 context.  Falling back to NEAREST."),q.NEAREST):e}function My(t,e,n){if(!be(e))return{format:q.LUMINANCE,dataFormat:q.LUMINANCE,type:q.FLOAT,sampler:"sampler2D",shaderModule:Ly,filter:OM(e,n),cast:r=>new Float32Array(r)};const i=n===q.LINEAR,s={...Ly},g=`#version 300 es
`;return s.fs=g.concat(s.fs),s.vs=g.concat(s.vs),{...Tm(i?"Float32":t),shaderModule:s,filter:n,cast:i?r=>new Float32Array(r):r=>r}}const jM={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:Ce.CARTESIAN,channelData:{type:"object",value:{},compare:!0},bounds:{type:"array",value:[0,0,1,1],compare:!0},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint16",compare:!0},interpolation:{type:"number",value:q.NEAREST,compare:!0}},nr=class extends hn{getShaders(){const{dtype:t,interpolation:e}=this.props,{shaderModule:n,sampler:i}=My(t,this.context.gl,e),s=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),g={...LM,inject:{}};return s||(g.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders({...n,defines:{SAMPLER_TYPE:i},modules:[_s,Hs,g]})}_isHookDefinedByExtensions(t){const{extensions:e}=this.props;return e==null?void 0:e.some(n=>{const i=n.getShaders(),{inject:s={},modules:g=[]}=i,o=s[t],r=g.some(a=>a==null?void 0:a.inject[t]);return o||r})}initializeState(){const{gl:t}=this.context;t.pixelStorei(q.UNPACK_ALIGNMENT,1),t.pixelStorei(q.PACK_ALIGNMENT,1),this.getAttributeManager().add({positions:{size:3,type:q.DOUBLE,fp64:this.use64bitPositions(),update:this.calculatePositions,noAlloc:!0}}),this.setState({numInstances:1,positions:new Float64Array(12)});const n=Ug.getDefaultProgramManager(t),i="fs:DECKGL_MUTATE_COLOR(inout vec4 rgba, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5, vec2 vTexCoord)",s="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";n._hookFunctions.includes(i)||n.addShaderHook(i),n._hookFunctions.includes(s)||n.addShaderHook(s)}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(t=>t&&t.delete())}updateState({props:t,oldProps:e,changeFlags:n,...i}){var g,o;if(super.updateState({props:t,oldProps:e,changeFlags:n,...i}),n.extensionsChanged||t.interpolation!==e.interpolation){const{gl:r}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}(t.channelData!==e.channelData&&((g=t.channelData)==null?void 0:g.data)!==((o=e.channelData)==null?void 0:o.data)||t.interpolation!==e.interpolation)&&this.loadChannelTextures(t.channelData);const s=this.getAttributeManager();t.bounds!==e.bounds&&s.invalidate("positions")}_getModel(t){return t?new Fn(t,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:q.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,1,0,0,1,0,1,1])}}),isInstanced:!1}):null}calculatePositions(t){const{positions:e}=this.state,{bounds:n}=this.props;e[0]=n[0],e[1]=n[1],e[2]=0,e[3]=n[0],e[4]=n[3],e[5]=0,e[6]=n[2],e[7]=n[3],e[8]=0,e[9]=n[2],e[10]=n[1],e[11]=0,t.value=e}draw({uniforms:t}){const{textures:e,model:n}=this.state;if(e&&n){const{contrastLimits:i,domain:s,dtype:g,channelsVisible:o}=this.props,r=Object.values(e).filter(I=>I).length,a=nF({contrastLimits:i.slice(0,r),channelsVisible:o.slice(0,r),domain:s,dtype:g});n.setUniforms({...t,contrastLimits:a,...e}).draw()}}loadChannelTextures(t){const e={channel0:null,channel1:null,channel2:null,channel3:null,channel4:null,channel5:null};this.state.textures&&Object.values(this.state.textures).forEach(n=>n&&n.delete()),t&&Object.keys(t).length>0&&t.data&&(t.data.forEach((n,i)=>{e[`channel${i}`]=this.dataToTexture(n,t.width,t.height)},this),this.setState({textures:e}))}dataToTexture(t,e,n){var g,o;const{interpolation:i}=this.props,s=My(this.props.dtype,this.context.gl,i);return new An(this.context.gl,{width:e,height:n,data:(o=(g=s.cast)==null?void 0:g.call(s,t))!=null?o:t,mipmaps:!1,parameters:{[q.TEXTURE_MIN_FILTER]:s.filter,[q.TEXTURE_MAG_FILTER]:s.filter,[q.TEXTURE_WRAP_S]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_T]:q.CLAMP_TO_EDGE},format:s.format,dataFormat:s.dataFormat,type:s.type})}};nr.layerName="XRLayer";nr.defaultProps=jM;const Ui={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},iF={...Wc.defaultProps,pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:Ce.CARTESIAN},qM=(t,e)=>{const n=e?"true":"false",i=`vec3(${(e||[0,0,0]).map(s=>String(s/255)).join(",")})`;switch(t){case Ui.RGB:return`color[3] = (${n} && (color.rgb == ${i})) ? 0.0 : color.a;`;case Ui.WhiteIsZero:return`          float value = 1.0 - (color.r / 256.0);
          color = vec4(value, value, value, (${n} && vec3(value, value, value) == ${i}) ? 0.0 : color.a);
        `;case Ui.BlackIsZero:return`          float value = (color.r / 256.0);
          color = vec4(value, value, value, (${n} && vec3(value, value, value) == ${i}) ? 0.0 : color.a);
        `;case Ui.YCbCr:return`          float y = color[0];
          float cb = color[1];
          float cr = color[2];
          color[0] = (y + (1.40200 * (cr - .5)));
          color[1] = (y - (0.34414 * (cb - .5)) - (0.71414 * (cr - .5)));
          color[2] = (y + (1.77200 * (cb - .5)));
          color[3] = (${n} && distance(color.rgb, ${i}) < 0.01) ? 0.0 : color.a;
        `;default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),""}},$M=t=>{switch(t){case Ui.RGB:return[0,0,0,0];case Ui.WhiteIsZero:return[255,255,255,0];case Ui.BlackIsZero:return[0,0,0,0];case Ui.YCbCr:return[16,128,128,0];default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),[0,0,0,0]}};class Em extends Wc{_getModel(e){const{photometricInterpretation:n,transparentColorInHook:i}=this.props,s=qM(n,i);return e?new Fn(e,{...this.getShaders(),id:this.props.id,geometry:new hi({drawMode:q.TRIANGLES,vertexCount:6}),isInstanced:!1,inject:{"fs:DECKGL_FILTER_COLOR":s}}):null}}const pI=class extends Un{initializeState(t){const{gl:e}=this.context;e.pixelStorei(q.UNPACK_ALIGNMENT,1),e.pixelStorei(q.PACK_ALIGNMENT,1),super.initializeState(t)}renderLayers(){const{photometricInterpretation:t,transparentColor:e}=this.props,n=$M(t);return new Em(this.props,{transparentColor:n,transparentColorInHook:e,id:`${this.props.id}-wrapped`})}};pI.layerName="BitmapLayer";pI.PHOTOMETRIC_INTERPRETATIONS=Ui;pI.defaultProps={...iF,image:{type:"object",value:{},compare:!0},transparentColor:{type:"array",value:[0,0,0],compare:!0},photometricInterpretation:{type:"number",value:2,compare:!0}};Em.defaultProps=iF;Em.layerName="BitmapLayerWrapper";function _o(t){const e=t[t.length-1];return e===3||e===4}function eP(t){const e=new Map(t.map((n,i)=>[n,i]));if(e.size!==t.length)throw Error("Labels must be unique, found duplicated label.");return n=>{const i=e.get(n);if(i===void 0)throw Error("Invalid dimension.");return i}}function BI(t){const e=_o(t.shape),[n,i]=t.shape.slice(e?-3:-2);return{height:n,width:i}}const sF="__vivSignalAborted";function tP(t){const{bbox:{left:e,top:n,right:i,bottom:s},x:g,y:o,z:r}=t.tile,{data:a,id:I,loader:l,maxZoom:C}=t;if([e,s,i,n].some(u=>u<0)||!a)return null;const c=l[0],{height:A,width:d}=BI(c),h=[e,a.height<c.tileSize?A:s,a.width<c.tileSize?d:i,n];if(_o(c.shape)){const{photometricInterpretation:u=2}=c.meta;return new pI(t,{image:a,photometricInterpretation:u,bounds:h,id:`tile-sub-layer-${h}-${I}`,tileId:{x:g,y:o,z:r}})}return new nr(t,{channelData:a,bounds:h,id:`tile-sub-layer-${h}-${I}`,tileId:{x:g,y:o,z:r},interpolation:r===C?q.NEAREST:q.LINEAR})}const nP={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:Ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},renderSubLayers:{type:"function",value:tP,compare:!1},dtype:{type:"string",value:"Uint16",compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},interpolation:{type:"number",value:null,compare:!0}};class Qm extends pm{_updateTileset(){this.props.viewportId||super._updateTileset(),(this.props.viewportId&&this.context.viewport.id===this.props.viewportId||!this.state.tileset._viewport)&&super._updateTileset()}}Qm.layerName="MultiscaleImageLayerBase";Qm.defaultProps=nP;var iP=`#define GLSLIFY 1
uniform float majorLensAxis;uniform float minorLensAxis;uniform vec2 lensCenter;uniform bool lensEnabled;uniform int lensSelection;uniform vec3 lensBorderColor;uniform float lensBorderRadius;uniform vec3 colors[6];bool frag_in_lens_bounds(vec2 vTexCoord){return pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.)<(1.-lensBorderRadius);}bool frag_on_lens_bounds(vec2 vTexCoord){float ellipseDistance=pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.);return ellipseDistance<=1.&&ellipseDistance>=(1.-lensBorderRadius);}float get_use_color_float(vec2 vTexCoord,int channelIndex){bool isFragInLensBounds=frag_in_lens_bounds(vTexCoord);bool inLensAndUseLens=lensEnabled&&isFragInLensBounds;return float(int((inLensAndUseLens&&channelIndex==lensSelection)||(!inLensAndUseLens)));}void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5,vec2 vTexCoord){float useColorValue=0.;useColorValue=get_use_color_float(vTexCoord,0);rgb+=max(0.,min(1.,intensity0))*max(vec3(colors[0]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,1);rgb+=max(0.,min(1.,intensity1))*max(vec3(colors[1]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,2);rgb+=max(0.,min(1.,intensity2))*max(vec3(colors[2]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,3);rgb+=max(0.,min(1.,intensity3))*max(vec3(colors[3]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,4);rgb+=max(0.,min(1.,intensity4))*max(vec3(colors[4]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,5);rgb+=max(0.,min(1.,intensity5))*max(vec3(colors[5]),(1.-useColorValue)*vec3(1.,1.,1.));}`,sP={name:"lens-module",fs:iP,inject:{"fs:DECKGL_MUTATE_COLOR":`
   vec3 rgb = rgba.rgb;
   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5, vTexCoord);
   rgba = vec4(rgb, 1.);
  `,"fs:#main-end":`
      bool isFragOnLensBounds = frag_on_lens_bounds(vTexCoord);
     gl_FragColor = (lensEnabled && isFragOnLensBounds) ? vec4(lensBorderColor, 1.) : gl_FragColor;
  `}};const Py=[[0,0,255],[0,255,0],[255,0,255],[255,255,0],[255,128,0],[0,255,255],[255,255,255],[255,0,0]];function gF(t){if(t>Py.length)throw new Error("Too many colors");return Py.slice(0,t)}function Xm({colors:t,channelsVisible:e}){const n=t.map((g,o)=>e[o]?g.map(r=>r/MM):ky),i=tF-n.length;return Nm(n,ky,i).reduce((g,o)=>g.concat(o),[])}const jg={lensEnabled:{type:"boolean",value:!1,compare:!0},lensSelection:{type:"number",value:0,compare:!0},lensRadius:{type:"number",value:100,compare:!0},lensBorderColor:{type:"array",value:[255,255,255],compare:!0},lensBorderRadius:{type:"number",value:.02,compare:!0},colors:{type:"array",value:null,compare:!0}},oF=class extends om{getShaders(){return{...super.getShaders(),modules:[sP]}}initializeState(){const t=this.getCurrentLayer();if(t.isComposite)return;const e=()=>{const{viewportId:n}=t.props,{lensRadius:i=jg.lensRadius.value}=this.props;if(!n){t.setState({unprojectLensBounds:[0,0,0,0]});return}const{mousePosition:s}=t.context,g=t.context.deck.viewManager.views.filter(a=>a.id===n)[0],o=t.context.deck.viewManager.viewState[n],r=g.makeViewport({...o,viewState:o});if(s&&r.containsPixel(s)){const a={x:s.x-r.x,y:s.y-r.y},l=[[a.x-i,a.y],[a.x,a.y+i],[a.x+i,a.y],[a.x,a.y-i]].map((C,c)=>r.unproject(C)[c%2]);t.setState({unprojectLensBounds:l})}else t.setState({unprojectLensBounds:[0,0,0,0]})};this.context.deck&&this.context.deck.eventManager.on({pointermove:e,pointerleave:e,wheel:e}),this.setState({onMouseMove:e,unprojectLensBounds:[0,0,0,0]})}draw(){var y;const{unprojectLensBounds:t=[0,0,0,0]}=this.state,{bounds:e,lensEnabled:n=jg.lensEnabled.value,lensSelection:i=jg.lensSelection.value,lensBorderColor:s=jg.lensBorderColor.value,lensBorderRadius:g=jg.lensBorderRadius.value,colors:o,channelsVisible:r}=this.props,[a,I,l,C]=t,[c,A,d,h]=e,u=(a-c)/(d-c),m=(I-h)/(A-h),f=(l-c)/(d-c),p=(C-h)/(A-h),B=Xm({channelsVisible:r||this.selections.map(()=>!0),colors:o||gF(this.props.selections.length)}),G={majorLensAxis:(f-u)/2,minorLensAxis:(m-p)/2,lensCenter:[(f+u)/2,(m+p)/2],lensEnabled:n,lensSelection:i,lensBorderColor:s,lensBorderRadius:g,colors:B};(y=this.state.model)==null||y.setUniforms(G)}finalizeState(){var t,e,n;this.context.deck&&this.context.deck.eventManager.off({pointermove:(t=this.state)==null?void 0:t.onMouseMove,pointerleave:(e=this.state)==null?void 0:e.onMouseMove,wheel:(n=this.state)==null?void 0:n.onMouseMove})}};oF.extensionName="LensExtension";oF.defaultProps=jg;var gP=`#define GLSLIFY 1
vec4 apply_transparent_color_1540259130(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform vec3 transparentColor;uniform bool useTransparentColor;uniform float opacity;uniform vec3 colors[6];void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5){rgb+=max(0.0,min(1.0,intensity0))*vec3(colors[0]);rgb+=max(0.0,min(1.0,intensity1))*vec3(colors[1]);rgb+=max(0.0,min(1.0,intensity2))*vec3(colors[2]);rgb+=max(0.0,min(1.0,intensity3))*vec3(colors[3]);rgb+=max(0.0,min(1.0,intensity4))*vec3(colors[4]);rgb+=max(0.0,min(1.0,intensity5))*vec3(colors[5]);}vec4 apply_opacity(vec3 rgb){return vec4(apply_transparent_color_1540259130(rgb,transparentColor,useTransparentColor,opacity));}`,oP={name:"color-palette-module",fs:gP,inject:{"fs:DECKGL_MUTATE_COLOR":`
   vec3 rgb = rgba.rgb;
   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5);
   rgba = apply_opacity(rgb);
  `}};const Dl={colors:{type:"array",value:null,compare:!0},opacity:{type:"number",value:1,compare:!0},transparentColor:{type:"array",value:null,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},bI=class extends om{getShaders(){return{...super.getShaders(),modules:[oP]}}draw(){var r;const{colors:t,channelsVisible:e,opacity:n=Dl.opacity.value,transparentColor:i=Dl.transparentColor.value,useTransparentColor:s=Dl.useTransparentColor.value}=this.props,o={colors:Xm({channelsVisible:e||this.selections.map(()=>!0),colors:t||gF(this.props.selections.length)}),opacity:n,transparentColor:(i||[0,0,0]).map(a=>a/255),useTransparentColor:Boolean(s)};(r=this.state.model)==null||r.setUniforms(o)}};bI.extensionName="ColorPaletteExtension";bI.defaultProps=Dl;var rP=`#define GLSLIFY 1
vec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}vec4 apply_transparent_color_452471729(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform float opacity;uniform bool useTransparentColor;vec4 colormap(float intensity){return vec4(apply_transparent_color_452471729(COLORMAP_FUNCTION(min(1.,intensity)).xyz,COLORMAP_FUNCTION(0.).xyz,useTransparentColor,opacity));}`,aP={name:"additive-colormap",fs:rP,inject:{"fs:DECKGL_MUTATE_COLOR":`
  float intensityCombo = 0.;
  intensityCombo += max(0.,intensity0);
  intensityCombo += max(0.,intensity1);
  intensityCombo += max(0.,intensity2);
  intensityCombo += max(0.,intensity3);
  intensityCombo += max(0.,intensity4);
  intensityCombo += max(0.,intensity5);
  rgba = colormap(intensityCombo);
`}};const zl={colormap:{type:"string",value:"viridis",compare:!0},opacity:{type:"number",value:1,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},rF=class extends om{getShaders(){var t;return{defines:{COLORMAP_FUNCTION:((t=this==null?void 0:this.props)==null?void 0:t.colormap)||zl.colormap.value},modules:[aP]}}updateState({props:t,oldProps:e,changeFlags:n,...i}){if(super.updateState({props:t,oldProps:e,changeFlags:n,...i}),t.colormap!==e.colormap){const{gl:s}=this.context;this.state.model&&(this.state.model.delete(),this.setState({model:this._getModel(s)}))}}draw(){var i;const{useTransparentColor:t=zl.useTransparentColor.value,opacity:e=zl.opacity.value}=this.props,n={opacity:e,useTransparentColor:t};(i=this.state.model)==null||i.setUniforms(n)}};rF.extensionName="AdditiveColormapExtension";rF.defaultProps=zl;const IP={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:Ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},selections:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16"},compare:!0},onClick:{type:"function",value:null,compare:!0},onViewportLoad:{type:"function",value:null,compare:!0},interpolation:{type:"number",value:q.NEAREST,compare:!0},extensions:{type:"array",value:[new bI],compare:!0}},yI=class extends Un{finalizeState(){this.state.abortController.abort()}updateState({props:t,oldProps:e}){const n=t.loader!==e.loader,i=t.selections!==e.selections;if(n||i){const{loader:s,selections:g=[],onViewportLoad:o}=this.props,r=new AbortController;this.setState({abortController:r});const{signal:a}=r,I=C=>s.getRaster({selection:C,signal:a}),l=g.map(I);Promise.all(l).then(C=>{const c={data:C.map(A=>A.data),width:C[0].width,height:C[0].height};_o(s.shape)&&(c.data=c.data[0],c.data.length===c.width*c.height*3&&(c.format=q.RGB,c.dataFormat=q.RGB)),o&&o(c),this.setState({...c})}).catch(C=>{if(C!==sF)throw C})}}getPickingInfo({info:t,sourceLayer:e}){return t.sourceLayer=e,t.tile=e.props.tile,t}renderLayers(){const{loader:t,id:e}=this.props,{dtype:n}=t,{width:i,height:s,data:g}=this.state;if(!(i&&s))return null;const o=[0,s,i,0];if(_o(t.shape)){const{photometricInterpretation:r=2}=t.meta;return new pI(this.props,{image:this.state,photometricInterpretation:r,bounds:o,id:`image-sub-layer-${o}-${e}`})}return new nr(this.props,{channelData:{data:g,height:s,width:i},bounds:o,id:`image-sub-layer-${o}-${e}`,dtype:n})}};yI.layerName="ImageLayer";yI.defaultProps=IP;const lP={pickable:{type:"boolean",value:!0,compare:!0},onHover:{type:"function",value:null,compare:!1},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},maxRequests:{type:"number",value:10,compare:!0},onClick:{type:"function",value:null,compare:!0},refinementStrategy:{type:"string",value:null,compare:!0},excludeBackground:{type:"boolean",value:!1,compare:!0},extensions:{type:"array",value:[new bI],compare:!0}},Ym=class extends Un{renderLayers(){const{loader:t,selections:e,opacity:n,viewportId:i,onTileError:s,onHover:g,id:o,onClick:r,modelMatrix:a,excludeBackground:I,refinementStrategy:l}=this.props,{tileSize:C,dtype:c}=t[0],A=async({x:y,y:U,z:V,signal:F})=>{if(!e||e.length===0)return null;const W=Math.round(-V),M=E=>{const H={x:y,y:U,selection:E,signal:F};return t[W].getTile(H)};try{const E=await Promise.all(e.map(M)),H={data:E.map(P=>P.data),width:E[0].width,height:E[0].height};return _o(t[W].shape)&&(H.data=H.data[0],H.data.length===H.width*H.height*3&&(H.format=q.RGB,H.dataFormat=q.RGB)),H}catch(E){if(E===sF)return null;throw E}},{height:d,width:h}=BI(t[0]),u=new Qm(this.props,{id:`Tiled-Image-${o}`,getTileData:A,dtype:c,tileSize:C,zoomOffset:Math.round(Math.log2(a?a.getScale()[0]:1)),extent:[0,0,h,d],minZoom:Math.round(-(t.length-1)),maxZoom:0,refinementStrategy:l||(n===1?"best-available":"no-overlap"),updateTriggers:{getTileData:[t,e]},onTileError:s||t[0].onTileError}),m=t[t.length-1],f=typeof m.getRaster=="function",p=a?a.clone():new Ee;return[f&&!I&&new yI(this.props,{id:`Background-Image-${o}`,loader:m,modelMatrix:p.scale(2**(t.length-1)),visible:!i||this.context.viewport.id===i,onHover:g,onClick:r,interpolation:q.LINEAR,onViewportLoad:null}),u]}};Ym.layerName="MultiscaleImageLayer";Ym.defaultProps=lP;const CP={pickable:{type:"boolean",value:!0,compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),getRasterSize:()=>({height:0,width:0}),dtype:"<u2"},compare:!0},id:{type:"string",value:"",compare:!0},boundingBox:{type:"array",value:[[0,0],[0,1],[1,1],[1,0]],compare:!0},boundingBoxColor:{type:"array",value:[255,0,0],compare:!0},boundingBoxOutlineWidth:{type:"number",value:1,compare:!0},viewportOutlineColor:{type:"array",value:[255,190,0],compare:!0},viewportOutlineWidth:{type:"number",value:2,compare:!0},overviewScale:{type:"number",value:1,compare:!0},zoom:{type:"number",value:1,compare:!0}},aF=class extends Un{renderLayers(){const{loader:t,id:e,zoom:n,boundingBox:i,boundingBoxColor:s,boundingBoxOutlineWidth:g,viewportOutlineColor:o,viewportOutlineWidth:r,overviewScale:a}=this.props,{width:I,height:l}=BI(t[0]),C=t.length-1,c=t[C],A=new yI(this.props,{id:`viewport-${e}`,modelMatrix:new Ee().scale(2**C*a),loader:c}),d=new QC({id:`bounding-box-overview-${e}`,coordinateSystem:Ce.CARTESIAN,data:[i],getPolygon:m=>m,filled:!1,stroked:!0,getLineColor:s,getLineWidth:g*2**n}),h=new QC({id:`viewport-outline-${e}`,coordinateSystem:Ce.CARTESIAN,data:[[[0,0],[I*a,0],[I*a,l*a],[0,l*a]]],getPolygon:m=>m,filled:!1,stroked:!0,getLineColor:o,getLineWidth:r*2**n});return[A,d,h]}};aF.layerName="OverviewLayer";aF.defaultProps=CP;function cP(t){const e=new rm().makeViewport({viewState:t,height:t.height,width:t.width});return[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])]}function AP(t,e,n){const i=t[2][0]-t[0][0];switch(e){case"bottom-right":{const s=t[2][1]-(t[2][1]-t[0][1])*n,g=t[2][0]-i*n;return[s,g]}case"top-right":{const s=(t[2][1]-t[0][1])*n,g=t[2][0]-i*n;return[s,g]}case"top-left":{const s=(t[2][1]-t[0][1])*n,g=i*n;return[s,g]}case"bottom-left":{const s=t[2][1]-(t[2][1]-t[0][1])*n,g=i*n;return[s,g]}default:throw new Error(`Position ${e} not found`)}}const dP={pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},unit:{type:"string",value:"",compare:!0},size:{type:"number",value:1,compare:!0},position:{type:"string",value:"bottom-right",compare:!0},length:{type:"number",value:.085,compare:!0}},IF=class extends Un{renderLayers(){const{id:t,unit:e,size:n,position:i,viewState:s,length:g}=this.props,o=cP(s),{zoom:r}=s,I=(o[2][0]-o[0][0])*.05,l=Math.max(2**(-r+1.5),(o[2][1]-o[0][1])*.007),C=I*n,[c,A]=AP(o,i,g),d=new ca({id:`scale-bar-length-${t}`,coordinateSystem:Ce.CARTESIAN,data:[[[A,c],[A+I,c]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),h=new ca({id:`scale-bar-height-left-${t}`,coordinateSystem:Ce.CARTESIAN,data:[[[A,c-l],[A,c+l]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),u=new ca({id:`scale-bar-height-right-${t}`,coordinateSystem:Ce.CARTESIAN,data:[[[A+I,c-l],[A+I,c+l]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),m=new qo({id:`units-label-layer-${t}`,coordinateSystem:Ce.CARTESIAN,data:[{text:C.toPrecision(5)+e,position:[A+I*.5,c+l*4]}],getColor:[220,220,220,255],getSize:12,fontFamily:PM,sizeUnits:"meters",sizeScale:2**-r,characterSet:[...e.split(""),...DM(10).map(f=>String(f)),".","e","+"]});return[d,h,u,m]}};IF.layerName="ScaleBarLayer";IF.defaultProps=dP;var uP=`#version 300 es
#define GLSLIFY 1
#define SHADER_NAME xr-layer-vertex-shader
in vec3 positions;uniform vec3 eye_pos;uniform mat4 proj;uniform mat4 model;uniform mat4 view;uniform mat4 scale;uniform mat4 resolution;out vec3 vray_dir;flat out vec3 transformed_eye;void main(){gl_Position=proj*view*model*scale*resolution*vec4(positions,1.);/*This first diagram is a skewed volume(i.e a "shear" model matrix applied)top down with the eye marked as #,all in world space^___|__\\|\\\\|\\|____|||
#
This next diagram shows the volume after the inverse model matrix has placed it back in model coordinates,but the eye still in world space.^___|___|||||||__|__||||
#
Finally,we apply the inverse model matrix transformation to the eye as well to bring it too into world space.Notice that the ray here matches the "voxels" through which the first ray also passes,as desired.^____/__|/||/||/____|///
#
*/transformed_eye=(inverse(resolution)*inverse(scale)*inverse(model)*(vec4(eye_pos,1.))).xyz;vray_dir=positions-transformed_eye;}`,hP=`#version 300 es
precision highp int;precision highp float;precision highp SAMPLER_TYPE;
#define GLSLIFY 1
uniform highp SAMPLER_TYPE volume0;uniform highp SAMPLER_TYPE volume1;uniform highp SAMPLER_TYPE volume2;uniform highp SAMPLER_TYPE volume3;uniform highp SAMPLER_TYPE volume4;uniform highp SAMPLER_TYPE volume5;uniform vec3 scaledDimensions;uniform mat4 scale;uniform vec3 normals[NUM_PLANES];uniform float distances[NUM_PLANES];uniform vec3 colors[6];uniform vec2 xSlice;uniform vec2 ySlice;uniform vec2 zSlice;uniform vec2 contrastLimits[6];in vec3 vray_dir;flat in vec3 transformed_eye;out vec4 color;vec2 intersect_box(vec3 orig,vec3 dir){vec3 box_min=vec3(xSlice[0],ySlice[0],zSlice[0]);vec3 box_max=vec3(xSlice[1],ySlice[1],zSlice[1]);vec3 inv_dir=1./dir;vec3 tmin_tmp=(box_min-orig)*inv_dir;vec3 tmax_tmp=(box_max-orig)*inv_dir;vec3 tmin=min(tmin_tmp,tmax_tmp);vec3 tmax=max(tmin_tmp,tmax_tmp);float t0=max(tmin.x,max(tmin.y,tmin.z));float t1=min(tmax.x,min(tmax.y,tmax.z));vec2 val=vec2(t0,t1);return val;}float linear_to_srgb(float x){if(x<=0.0031308f){return 12.92f*x;}return 1.055f*pow(x,1.f/2.4f)-0.055f;}float wang_hash(int seed){seed=(seed ^ 61)^(seed>>16);seed*=9;seed=seed ^(seed>>4);seed*=0x27d4eb2d;seed=seed ^(seed>>15);return float(seed % 2147483647)/float(2147483647);}void main(void){vec3 ray_dir=normalize(vray_dir);vec2 t_hit=intersect_box(transformed_eye,ray_dir);if(t_hit.x>t_hit.y){discard;}t_hit.x=max(t_hit.x,0.);vec3 dt_vec=1./(scale*vec4(abs(ray_dir),1.)).xyz;float dt=1.*min(dt_vec.x,min(dt_vec.y,dt_vec.z));float offset=wang_hash(int(gl_FragCoord.x+640.*gl_FragCoord.y));vec3 p=transformed_eye+(t_hit.x+offset*dt)*ray_dir;_BEFORE_RENDERfor(float t=t_hit.x;t<t_hit.y;t+=dt){float canShow=1.;for(int i=0;i<NUM_PLANES;i+=1){canShow*=max(0.,sign(dot(normals[i],p)+distances[i]));}float canShowXCoordinate=max(p.x-0.,0.)*max(1.-p.x,0.);float canShowYCoordinate=max(p.y-0.,0.)*max(1.-p.y,0.);float canShowZCoordinate=max(p.z-0.,0.)*max(1.-p.z,0.);float canShowCoordinate=float(ceil(canShowXCoordinate*canShowYCoordinate*canShowZCoordinate));canShow=canShowCoordinate*canShow;float intensityValue0=float(texture(volume0,p).r);DECKGL_PROCESS_INTENSITY(intensityValue0,contrastLimits[0],0);intensityValue0=canShow*intensityValue0;float intensityValue1=float(texture(volume1,p).r);DECKGL_PROCESS_INTENSITY(intensityValue1,contrastLimits[1],1);intensityValue1=canShow*intensityValue1;float intensityValue2=float(texture(volume2,p).r);DECKGL_PROCESS_INTENSITY(intensityValue2,contrastLimits[2],2);intensityValue2=canShow*intensityValue2;float intensityValue3=float(texture(volume3,p).r);DECKGL_PROCESS_INTENSITY(intensityValue3,contrastLimits[3],3);intensityValue3=canShow*intensityValue3;float intensityValue4=float(texture(volume4,p).r);DECKGL_PROCESS_INTENSITY(intensityValue4,contrastLimits[4],4);intensityValue4=canShow*intensityValue4;float intensityValue5=float(texture(volume5,p).r);DECKGL_PROCESS_INTENSITY(intensityValue5,contrastLimits[5],5);intensityValue5=canShow*intensityValue5;_RENDERp+=ray_dir*dt;}_AFTER_RENDERcolor.r=linear_to_srgb(color.r);color.g=linear_to_srgb(color.g);color.b=linear_to_srgb(color.b);}`,mP=`#define GLSLIFY 1
vec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}float apply_contrast_limits(float intensity,vec2 contrastLimits){float contrastLimitsAppliedToIntensity=(intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0]));return max(0.,contrastLimitsAppliedToIntensity);}vec4 colormap(float intensity,float opacity){return vec4(COLORMAP_FUNCTION(min(1.,intensity)).xyz,opacity);}`,Jy={name:"channel-intensity-module",fs:mP};const fP={[Ci.MAX_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] > maxVals[i]) {
          maxVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      vec3 rgbCombo = vec3(0.0);
      for(int i = 0; i < 6; i++) {
        rgbCombo += max(0.0, min(1.0, maxVals[i])) * vec3(colors[i]);
      }
      color = vec4(rgbCombo, 1.0);
    `},[Ci.MIN_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] < minVals[i]) {
          minVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      vec3 rgbCombo = vec3(0.0);
      for(int i = 0; i < 6; i++) {
        rgbCombo += max(0.0, min(1.0, minVals[i])) * vec3(colors[i]);
      }
      color = vec4(rgbCombo, 1.0);
    `},[Ci.ADDITIVE]:{_BEFORE_RENDER:"",_RENDER:`      vec3 rgbCombo = vec3(0.0);
      vec3 hsvCombo = vec3(0.0);
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        float intensityValue = intensityArray[i];
        rgbCombo += max(0.0, min(1.0, intensityValue)) * colors[i];
        total += intensityValue;
      }
      // Do not go past 1 in opacity.
      total = min(total, 1.0);
      vec4 val_color = vec4(rgbCombo, total);
      // Opacity correction
      val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
      color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
      color.a += (1.0 - color.a) * val_color.a;
      if (color.a >= 0.95) {
        break;
      }
    `,_AFTER_RENDER:""}},pP={[Ci.MAX_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] > maxVals[i]) {
          maxVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        total += maxVals[i];
      }
      // Do not go past 1 in opacity/colormap value.
      total = min(total, 1.0);
      color = colormap(total, total);
    `},[Ci.MIN_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] < minVals[i]) {
          minVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        total += minVals[i];
      }
      // Do not go past 1 in opacity/colormap value.
      total = min(total, 1.0);
      color = colormap(total, total);
    `},[Ci.ADDITIVE]:{_BEFORE_RENDER:"",_RENDER:`    float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
		float total = 0.0;

		for(int i = 0; i < 6; i++) {
			total += intensityArray[i];
		}
		// Do not go past 1 in opacity/colormap value.
		total = min(total, 1.0);

		vec4 val_color = colormap(total, total);

		// Opacity correction
		val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
		color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
		color.a += (1.0 - color.a) * val_color.a;
		if (color.a >= 0.95) {
			break;
		}
    p += ray_dir * dt;
    `,_AFTER_RENDER:""}},BP=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0],Dy=1,bP={pickable:!1,coordinateSystem:Ce.CARTESIAN,channelData:{type:"object",value:{},compare:!0},colors:{type:"array",value:[],compare:!0},contrastLimits:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint8",compare:!0},colormap:{type:"string",value:"",compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},renderingMode:{type:"string",value:Ci.ADDITIVE,compare:!0},resolutionMatrix:{type:"object",value:new Ee,compare:!0}};function zy(){const t=Tm("Float32");return{...t,sampler:t.sampler.replace("2D","3D"),cast:e=>new Float32Array(e)}}function yP(t){const e=JM.filter(s=>s!==(t||"viridis")).map(s=>s.replace(/-/g,"_")),n=new RegExp(`vec4 (${e.join("(_([0-9]*))?|")})\\(float x_[0-9]+\\){([^}]+)}`,"g");return{...Jy,fs:Jy.fs.replace(n,""),defines:{COLORMAP_FUNCTION:t||"viridis"}}}const _m=class extends hn{initializeState(){const{gl:t}=this.context;t.pixelStorei(q.UNPACK_ALIGNMENT,1),t.pixelStorei(q.PACK_ALIGNMENT,1);const e=Ug.getDefaultProgramManager(t),n="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";e._hookFunctions.includes(n)||e.addShaderHook(n)}_isHookDefinedByExtensions(t){const{extensions:e}=this.props;return e==null?void 0:e.some(n=>{const i=n.getShaders(),{inject:s={},modules:g=[]}=i,o=s[t],r=g.some(a=>a==null?void 0:a.inject[t]);return o||r})}getShaders(){const{colormap:t,renderingMode:e,clippingPlanes:n}=this.props,{sampler:i}=zy(),{_BEFORE_RENDER:s,_RENDER:g,_AFTER_RENDER:o}=t?pP[e]:fP[e],r=yP(t),a=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),I={...r,inject:{}};return a||(I.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders({vs:uP,fs:hP.replace("_BEFORE_RENDER",s).replace("_RENDER",g).replace("_AFTER_RENDER",o),defines:{SAMPLER_TYPE:i,COLORMAP_FUNCTION:t||"viridis",NUM_PLANES:String(n.length||Dy)},modules:[I]})}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(t=>t&&t.delete())}updateState({props:t,oldProps:e,changeFlags:n}){var i,s;if(n.extensionsChanged||t.colormap!==e.colormap||t.renderingMode!==e.renderingMode||t.clippingPlanes.length!==e.clippingPlanes.length){const{gl:g}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(g)})}t.channelData&&((i=t==null?void 0:t.channelData)==null?void 0:i.data)!==((s=e==null?void 0:e.channelData)==null?void 0:s.data)&&this.loadTexture(t.channelData)}_getModel(t){return t?new Fn(t,{...this.getShaders(),geometry:new hi({drawMode:t.TRIANGLE_STRIP,attributes:{positions:new Float32Array(BP)}})}):null}draw({uniforms:t}){const{textures:e,model:n,scaleMatrix:i}=this.state,{contrastLimits:s,colors:g,xSlice:o,ySlice:r,zSlice:a,modelMatrix:I,channelsVisible:l,domain:C,dtype:c,clippingPlanes:A,resolutionMatrix:d}=this.props,{viewMatrix:h,viewMatrixInverse:u,projectionMatrix:m}=this.context.viewport;if(e&&n&&i){const f=nF({contrastLimits:s,channelsVisible:l,domain:C,dtype:c}),p=Xm({colors:g,channelsVisible:l}),B=i.clone().invert(),G=d.clone().invert(),y=Nm(A.map(F=>F.clone().transform(B).transform(G)),new ys([1,0,0]),A.length||Dy),U=y.map(F=>F.normal).flat(),V=y.map(F=>F.distance);n.setUniforms({...t,...e,contrastLimits:f,colors:p,xSlice:new Float32Array(o?o.map(F=>F/i[0]/d[0]):[0,1]),ySlice:new Float32Array(r?r.map(F=>F/i[5]/d[5]):[0,1]),zSlice:new Float32Array(a?a.map(F=>F/i[10]/d[10]):[0,1]),eye_pos:new Float32Array([u[12],u[13],u[14]]),view:h,proj:m,scale:i,resolution:d,model:I||new Ee,normals:U,distances:V}).draw()}}loadTexture(t){const e={volume0:null,volume1:null,volume2:null,volume3:null,volume4:null,volume5:null};if(this.state.textures&&Object.values(this.state.textures).forEach(n=>n&&n.delete()),t&&Object.keys(t).length>0&&t.data){const{height:n,width:i,depth:s}=t;t.data.forEach((g,o)=>{e[`volume${o}`]=this.dataToTexture(g,i,n,s)},this),this.setState({textures:e,scaleMatrix:new Ee().scale(this.props.physicalSizeScalingMatrix.transformPoint([i,n,s]))})}}dataToTexture(t,e,n,i){var o,r;const s=zy();return new E1(this.context.gl,{width:e,height:n,depth:i,data:(r=(o=s.cast)==null?void 0:o.call(s,t))!=null?r:t,format:s.dataFormat,dataFormat:s.format,type:s.type,mipmaps:!1,parameters:{[q.TEXTURE_MIN_FILTER]:q.LINEAR,[q.TEXTURE_MAG_FILTER]:q.LINEAR,[q.TEXTURE_WRAP_S]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_T]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_R]:q.CLAMP_TO_EDGE}})}};_m.layerName="XR3DLayer";_m.defaultProps=bP;async function vP({source:t,selection:e,onUpdate:n=()=>{},downsampleDepth:i=1,signal:s}){const{shape:g,labels:o,dtype:r}=t,{height:a,width:I}=BI(t),l=g[o.indexOf("z")],C=Math.max(1,Math.floor(l/i)),c=a*I,A=`${r}Array`,d=globalThis[A],h=new d(c*C);return await Promise.all(new Array(C).fill(0).map(async(u,m)=>{const f={...e,z:m*i},{data:p}=await t.getRaster({selection:f,signal:s});let B=0;for(n();B<c;){const G=m*c+(c-B-1),y=(I-B-1)%I+I*Math.floor(B/I);h[G]=p[y],B+=1}n()})),{data:h,height:a,width:I,depth:C}}const Oy=(t,e,n)=>new qo({id:`text-${n}`,coordinateSystem:Ce.CARTESIAN,data:[{text:t,position:e.position}],getColor:[220,220,220,255],getSize:25,sizeUnits:"meters",sizeScale:2**-e.zoom,fontFamily:"Helvetica"}),GP={pickable:!1,coordinateSystem:Ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},colors:{type:"array",value:[],compare:!0},colormap:{type:"string",value:"",compare:!0},selections:{type:"array",value:[],compare:!0},resolution:{type:"number",value:0,compare:!0},domain:{type:"array",value:[],compare:!0},loader:{type:"object",value:[{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16",shape:[1],labels:["z"]}],compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},renderingMode:{type:"string",value:Ci.MAX_INTENSITY_PROJECTION,compare:!0},onUpdate:{type:"function",value:()=>{},compare:!0},useProgressIndicator:{type:"boolean",value:!0,compare:!0},useWebGL1Warning:{type:"boolean",value:!0,compare:!0}},lF=class extends Un{clearState(){this.setState({height:null,width:null,depth:null,data:null,physicalSizeScalingMatrix:null,resolutionMatrix:null,progress:0,abortController:null})}finalizeState(){this.state.abortController.abort()}updateState({oldProps:t,props:e}){const n=e.loader!==t.loader,i=e.resolution!==t.resolution,s=e.selections!==t.selections;if(i&&this.clearState(),n||s||i){const{loader:g,selections:o=[],resolution:r,onViewportLoad:a}=this.props,I=g[r];let l=0;const C=(I.shape[I.labels.indexOf("z")]>>r)*o.length,c=()=>{l+=.5/C,this.props.onUpdate&&this.props.onUpdate({progress:l}),this.setState({progress:l})},A=new AbortController;this.setState({abortController:A});const{signal:d}=A,h=o.map(m=>vP({selection:m,source:I,onUpdate:c,downsampleDepth:2**r,signal:d})),u=zM(g[r]);Promise.all(h).then(m=>{a&&a(m);const f={data:m.map(p=>p.data),width:m[0].width,height:m[0].height,depth:m[0].depth};this.setState({...f,physicalSizeScalingMatrix:u,resolutionMatrix:new Ee().scale(2**r)})})}}renderLayers(){const{loader:t,id:e,resolution:n,useProgressIndicator:i,useWebGL1Warning:s}=this.props,{dtype:g}=t[n],{data:o,width:r,height:a,depth:I,progress:l,physicalSizeScalingMatrix:C,resolutionMatrix:c}=this.state,{gl:A}=this.context;if(!be(A)&&s){const{viewport:d}=this.context;return Oy(["Volume rendering is only available on browsers that support WebGL2. If you","are using Safari, you can turn on WebGL2 by navigating in the top menubar","to check Develop > Experimental Features > WebGL 2.0 and then refreshing","the page."].join(`
`),d,e)}if(!(r&&a)&&i){const{viewport:d}=this.context;return Oy(`Loading Volume ${String((l||0)*100).slice(0,5)}%...`,d,e)}return new _m(this.props,{channelData:{data:o,width:r,height:a,depth:I},id:`XR3DLayer-${0}-${a}-${r}-${0}-${n}-${e}`,physicalSizeScalingMatrix:C,parameters:{[q.CULL_FACE]:!0,[q.CULL_FACE_MODE]:q.FRONT,[q.DEPTH_TEST]:!1,blendFunc:[q.SRC_ALPHA,q.ONE],blend:!0},resolutionMatrix:c,dtype:g})}};lF.layerName="VolumeLayer";lF.defaultProps=GP;const ZP="KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIGRlY29kZVJvd0FjYyhyb3csIHN0cmlkZSkgewogICAgbGV0IGxlbmd0aCA9IHJvdy5sZW5ndGggLSBzdHJpZGU7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGRvIHsKICAgICAgZm9yIChsZXQgaSA9IHN0cmlkZTsgaSA+IDA7IGktLSkgewogICAgICAgIHJvd1tvZmZzZXQgKyBzdHJpZGVdICs9IHJvd1tvZmZzZXRdOwogICAgICAgIG9mZnNldCsrOwogICAgICB9CgogICAgICBsZW5ndGggLT0gc3RyaWRlOwogICAgfSB3aGlsZSAobGVuZ3RoID4gMCk7CiAgfQoKICBmdW5jdGlvbiBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSkgewogICAgbGV0IGluZGV4ID0gMDsKICAgIGxldCBjb3VudCA9IHJvdy5sZW5ndGg7CiAgICBjb25zdCB3YyA9IGNvdW50IC8gYnl0ZXNQZXJTYW1wbGU7CgogICAgd2hpbGUgKGNvdW50ID4gc3RyaWRlKSB7CiAgICAgIGZvciAobGV0IGkgPSBzdHJpZGU7IGkgPiAwOyAtLWkpIHsKICAgICAgICByb3dbaW5kZXggKyBzdHJpZGVdICs9IHJvd1tpbmRleF07CiAgICAgICAgKytpbmRleDsKICAgICAgfQogICAgICBjb3VudCAtPSBzdHJpZGU7CiAgICB9CgogICAgY29uc3QgY29weSA9IHJvdy5zbGljZSgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3YzsgKytpKSB7CiAgICAgIGZvciAobGV0IGIgPSAwOyBiIDwgYnl0ZXNQZXJTYW1wbGU7ICsrYikgewogICAgICAgIHJvd1soYnl0ZXNQZXJTYW1wbGUgKiBpKSArIGJdID0gY29weVsoKGJ5dGVzUGVyU2FtcGxlIC0gYiAtIDEpICogd2MpICsgaV07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5UHJlZGljdG9yKGJsb2NrLCBwcmVkaWN0b3IsIHdpZHRoLCBoZWlnaHQsIGJpdHNQZXJTYW1wbGUsCiAgICBwbGFuYXJDb25maWd1cmF0aW9uKSB7CiAgICBpZiAoIXByZWRpY3RvciB8fCBwcmVkaWN0b3IgPT09IDEpIHsKICAgICAgcmV0dXJuIGJsb2NrOwogICAgfQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYml0c1BlclNhbXBsZS5sZW5ndGg7ICsraSkgewogICAgICBpZiAoYml0c1BlclNhbXBsZVtpXSAlIDggIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIG9ubHkgbXVsdGlwbGUgb2YgOCBiaXRzIGFyZSBzdXBwb3J0ZWQuJyk7CiAgICAgIH0KICAgICAgaWYgKGJpdHNQZXJTYW1wbGVbaV0gIT09IGJpdHNQZXJTYW1wbGVbMF0pIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIGFsbCBzYW1wbGVzIG11c3QgaGF2ZSB0aGUgc2FtZSBzaXplLicpOwogICAgICB9CiAgICB9CgogICAgY29uc3QgYnl0ZXNQZXJTYW1wbGUgPSBiaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgIGNvbnN0IHN0cmlkZSA9IHBsYW5hckNvbmZpZ3VyYXRpb24gPT09IDIgPyAxIDogYml0c1BlclNhbXBsZS5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7ICsraSkgewogICAgICAvLyBMYXN0IHN0cmlwIHdpbGwgYmUgdHJ1bmNhdGVkIGlmIGhlaWdodCAlIHN0cmlwSGVpZ2h0ICE9IDAKICAgICAgaWYgKGkgKiBzdHJpZGUgKiB3aWR0aCAqIGJ5dGVzUGVyU2FtcGxlID49IGJsb2NrLmJ5dGVMZW5ndGgpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgcm93OwogICAgICBpZiAocHJlZGljdG9yID09PSAyKSB7IC8vIGhvcml6b250YWwgcHJlZGljdGlvbgogICAgICAgIHN3aXRjaCAoYml0c1BlclNhbXBsZVswXSkgewogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICByb3cgPSBuZXcgVWludDhBcnJheSgKICAgICAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQxNkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQzMkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDQsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcmVkaWN0b3IgMiBub3QgYWxsb3dlZCB3aXRoICR7Yml0c1BlclNhbXBsZVswXX0gYml0cyBwZXIgc2FtcGxlLmApOwogICAgICAgIH0KICAgICAgICBkZWNvZGVSb3dBY2Mocm93LCBzdHJpZGUpOwogICAgICB9IGVsc2UgaWYgKHByZWRpY3RvciA9PT0gMykgeyAvLyBob3Jpem9udGFsIGZsb2F0aW5nIHBvaW50CiAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkoCiAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgKTsKICAgICAgICBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBibG9jazsKICB9CgogIGNsYXNzIEJhc2VEZWNvZGVyIHsKICAgIGFzeW5jIGRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpIHsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuZGVjb2RlQmxvY2soYnVmZmVyKTsKICAgICAgY29uc3QgcHJlZGljdG9yID0gZmlsZURpcmVjdG9yeS5QcmVkaWN0b3IgfHwgMTsKICAgICAgaWYgKHByZWRpY3RvciAhPT0gMSkgewogICAgICAgIGNvbnN0IGlzVGlsZWQgPSAhZmlsZURpcmVjdG9yeS5TdHJpcE9mZnNldHM7CiAgICAgICAgY29uc3QgdGlsZVdpZHRoID0gaXNUaWxlZCA/IGZpbGVEaXJlY3RvcnkuVGlsZVdpZHRoIDogZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICAgIGNvbnN0IHRpbGVIZWlnaHQgPSBpc1RpbGVkID8gZmlsZURpcmVjdG9yeS5UaWxlTGVuZ3RoIDogKAogICAgICAgICAgZmlsZURpcmVjdG9yeS5Sb3dzUGVyU3RyaXAgfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGFwcGx5UHJlZGljdG9yKAogICAgICAgICAgZGVjb2RlZCwgcHJlZGljdG9yLCB0aWxlV2lkdGgsIHRpbGVIZWlnaHQsIGZpbGVEaXJlY3RvcnkuQml0c1BlclNhbXBsZSwKICAgICAgICAgIGZpbGVEaXJlY3RvcnkuUGxhbmFyQ29uZmlndXJhdGlvbiwKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWNvZGVkOwogICAgfQogIH0KCiAgY2xhc3MgUmF3RGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogIH0KCiAgbGV0IEEsST1udWxsO2Z1bmN0aW9uIGcoKXtyZXR1cm4gbnVsbCE9PUkmJkkuYnVmZmVyPT09QS5tZW1vcnkuYnVmZmVyfHwoST1uZXcgVWludDhBcnJheShBLm1lbW9yeS5idWZmZXIpKSxJfWxldCBCPTA7bGV0IFE9bnVsbDtmdW5jdGlvbiBDKCl7cmV0dXJuIG51bGwhPT1RJiZRLmJ1ZmZlcj09PUEubWVtb3J5LmJ1ZmZlcnx8KFE9bmV3IEludDMyQXJyYXkoQS5tZW1vcnkuYnVmZmVyKSksUX1hc3luYyBmdW5jdGlvbiBFKEkpe3ZvaWQgMD09PUkmJihJPSIiLnJlcGxhY2UoL1wuanMkLywiX2JnLndhc20iKSk7KCJzdHJpbmciPT10eXBlb2YgSXx8ImZ1bmN0aW9uIj09dHlwZW9mIFJlcXVlc3QmJkkgaW5zdGFuY2VvZiBSZXF1ZXN0fHwiZnVuY3Rpb24iPT10eXBlb2YgVVJMJiZJIGluc3RhbmNlb2YgVVJMKSYmKEk9ZmV0Y2goSSkpO2NvbnN0e2luc3RhbmNlOmcsbW9kdWxlOkJ9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKEEsSSl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFJlc3BvbnNlJiZBIGluc3RhbmNlb2YgUmVzcG9uc2Upe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyl0cnl7cmV0dXJuIGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKEEsSSl9Y2F0Y2goSSl7aWYoImFwcGxpY2F0aW9uL3dhc20iPT1BLmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKSl0aHJvdyBJO2NvbnNvbGUud2FybigiYFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nYCBmYWlsZWQgYmVjYXVzZSB5b3VyIHNlcnZlciBkb2VzIG5vdCBzZXJ2ZSB3YXNtIHdpdGggYGFwcGxpY2F0aW9uL3dhc21gIE1JTUUgdHlwZS4gRmFsbGluZyBiYWNrIHRvIGBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZWAgd2hpY2ggaXMgc2xvd2VyLiBPcmlnaW5hbCBlcnJvcjpcbiIsSSk7fWNvbnN0IGc9YXdhaXQgQS5hcnJheUJ1ZmZlcigpO3JldHVybiBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShnLEkpfXtjb25zdCBnPWF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKEEsSSk7cmV0dXJuIGcgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5JbnN0YW5jZT97aW5zdGFuY2U6Zyxtb2R1bGU6QX06Z319KGF3YWl0IEkse30pO3JldHVybiBBPWcuZXhwb3J0cyxFLl9fd2JpbmRnZW5fd2FzbV9tb2R1bGU9QixBfXZhciBEPU9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGRlY29tcHJlc3M6ZnVuY3Rpb24oSSxRKXt0cnl7Y29uc3QgRj1BLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoLTE2KTt2YXIgRT1mdW5jdGlvbihBLEkpe2NvbnN0IFE9SSgxKkEubGVuZ3RoKTtyZXR1cm4gZygpLnNldChBLFEvMSksQj1BLmxlbmd0aCxRfShJLEEuX193YmluZGdlbl9tYWxsb2MpLEQ9QjtBLmRlY29tcHJlc3MoRixFLEQsUSk7dmFyIGk9QygpW0YvNCswXSx3PUMoKVtGLzQrMV0sRz0obz1pLE49dyxnKCkuc3ViYXJyYXkoby8xLG8vMStOKSkuc2xpY2UoKTtyZXR1cm4gQS5fX3diaW5kZ2VuX2ZyZWUoaSwxKncpLEd9ZmluYWxseXtBLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoMTYpO312YXIgbyxOO30sZGVmYXVsdDpFfSk7Y29uc3QgaT1bNjIsMCwwLDAsNjMsNTIsNTMsNTQsNTUsNTYsNTcsNTgsNTksNjAsNjEsMCwwLDAsMCwwLDAsMCwwLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5LDIwLDIxLDIyLDIzLDI0LDI1LDAsMCwwLDAsMCwwLDI2LDI3LDI4LDI5LDMwLDMxLDMyLDMzLDM0LDM1LDM2LDM3LDM4LDM5LDQwLDQxLDQyLDQzLDQ0LDQ1LDQ2LDQ3LDQ4LDQ5LDUwLDUxXTtmdW5jdGlvbiB3KEEpe3JldHVybiBpW0EtNDNdfWNvbnN0IEc9ZnVuY3Rpb24oQSl7bGV0IEksZz1BLmVuZHNXaXRoKCI9PSIpPzI6QS5lbmRzV2l0aCgiPSIpPzE6MCxCPUEubGVuZ3RoLFE9bmV3IFVpbnQ4QXJyYXkoQi80KjMpO2ZvcihsZXQgZz0wLEM9MDtnPEI7Zys9NCxDKz0zKUk9dyhBLmNoYXJDb2RlQXQoZykpPDwxOHx3KEEuY2hhckNvZGVBdChnKzEpKTw8MTJ8dyhBLmNoYXJDb2RlQXQoZysyKSk8PDZ8dyhBLmNoYXJDb2RlQXQoZyszKSksUVtDXT1JPj4xNixRW0MrMV09ST4+OCYyNTUsUVtDKzJdPTI1NSZJO3JldHVybiBRLnN1YmFycmF5KDAsUS5sZW5ndGgtZyl9KCJBR0Z6YlFFQUFBQUJXUTVnQW45L0FYOWdBMzkvZndGL1lBSi9md0JnQVg4QVlBTi9mMzhBWUFGL0FYOWdCSDkvZjM4QVlBUi9mMzkvQVg5Z0JuOS9mMzkvZndCZ0FYOEJmbUFBQUdBRmYzOS9mMzhBWUFWL2YzOS9md0YvWUFKK2Z3Ri9BMjFzQlFnSUN3TUJBZ1VNQVFBQkFBSUFCUUFDQWdZR0RRWURBZ0FDQUFBRUJBUUNBZ1lHQUFZQkJnSUhBd1FEQkFRREF3QURCUU1EQkFRRUJBUUNBZ0FIQUFRQUFnTUJBZ2NGQkFJREFRVUNBZ0lEQWdJREF3Y0NBUUFBQkFJQUNnQUFBUUFGQWdBREJRa0pDUU1DQkFVQmNBRXJLd1VEQVFBUkJna0Jmd0ZCZ0lEQUFBc0hYd1VHYldWdGIzSjVBZ0FLWkdWamIyMXdjbVZ6Y3dBbkgxOWZkMkpwYm1SblpXNWZZV1JrWDNSdlgzTjBZV05yWDNCdmFXNTBaWElBWWhGZlgzZGlhVzVrWjJWdVgyMWhiR3h2WXdCTUQxOWZkMkpwYm1SblpXNWZabkpsWlFCV0NUQUJBRUVCQ3lwcUpEVUNabVZETlFGbVpVTmhhMnBYREQxcFZCb2hTVnRUYUdkZlhERU9YbGhxYVFzY1FXQWJQMlFLc3VnQmJOTXFBZ2gvQVg0Q1FBSkFBa0FDUUNBQVFmVUJUd1JBSUFCQnpmOTdUdzBDSUFCQkMyb2lBRUY0Y1NFR1FaQ253QUFvQWdBaUNFVU5BVUVBSUFacklRUUNRQUpBQW45QkFDQUFRUWgySWdCRkRRQWFRUjhnQmtILy8vOEhTdzBBR2lBR1FRWWdBR2NpQUd0QkgzRjJRUUZ4SUFCQkFYUnJRVDVxQ3lJSFFRSjBRWnlwd0FCcUtBSUFJZ0FFUUNBR1FRQkJHU0FIUVFGMmEwRWZjU0FIUVI5R0czUWhBZ05BQWtBZ0FFRUVhaWdDQUVGNGNTSUZJQVpKRFFBZ0JTQUdheUlGSUFSUERRQWdBQ0VESUFVaUJBMEFRUUFoQkF3REN5QUFRUlJxS0FJQUlnVWdBU0FGSUFBZ0FrRWRka0VFY1dwQkVHb29BZ0FpQUVjYklBRWdCUnNoQVNBQ1FRRjBJUUlnQUEwQUN5QUJCRUFnQVNFQURBSUxJQU1OQWd0QkFDRURRUUlnQjBFZmNYUWlBRUVBSUFCcmNpQUljU0lBUlEwRElBQkJBQ0FBYTNGb1FRSjBRWnlwd0FCcUtBSUFJZ0JGRFFNTEEwQWdBQ0FESUFCQkJHb29BZ0JCZUhFaUFpQUdUeUFDSUFacklnSWdCRWx4SWdFYklRTWdBaUFFSUFFYklRUWdBQ2dDRUNJQ0JIOGdBZ1VnQUVFVWFpZ0NBQXNpQUEwQUN5QURSUTBDQzBHY3FzQUFLQUlBSWdBZ0JrOUJBQ0FFSUFBZ0JtdFBHdzBCSUFNb0FoZ2hCd0pBQWtBZ0F5QURLQUlNSWdGR0JFQWdBMEVVUVJBZ0EwRVVhaUlDS0FJQUlnRWJhaWdDQUNJQURRRkJBQ0VCREFJTElBTW9BZ2dpQUNBQk5nSU1JQUVnQURZQ0NBd0JDeUFDSUFOQkVHb2dBUnNoQWdOQUlBSWhCU0FBSWdGQkZHb2lBaWdDQUNJQVJRUkFJQUZCRUdvaEFpQUJLQUlRSVFBTElBQU5BQXNnQlVFQU5nSUFDd0pBSUFkRkRRQUNRQ0FESUFNb0FoeEJBblJCbktuQUFHb2lBQ2dDQUVjRVFDQUhRUkJCRkNBSEtBSVFJQU5HRzJvZ0FUWUNBQ0FCUlEwQ0RBRUxJQUFnQVRZQ0FDQUJEUUJCa0tmQUFFR1FwOEFBS0FJQVFYNGdBeWdDSEhkeE5nSUFEQUVMSUFFZ0J6WUNHQ0FES0FJUUlnQUVRQ0FCSUFBMkFoQWdBQ0FCTmdJWUN5QURRUlJxS0FJQUlnQkZEUUFnQVVFVWFpQUFOZ0lBSUFBZ0FUWUNHQXNDUUNBRVFSQlBCRUFnQXlBR1FRTnlOZ0lFSUFNZ0Jtb2lCU0FFUVFGeU5nSUVJQVFnQldvZ0JEWUNBQ0FFUVlBQ1R3UkFJQVZDQURjQ0VDQUZBbjlCQUNBRVFRaDJJZ0JGRFFBYVFSOGdCRUgvLy84SFN3MEFHaUFFUVFZZ0FHY2lBR3RCSDNGMlFRRnhJQUJCQVhSclFUNXFDeUlBTmdJY0lBQkJBblJCbktuQUFHb2hBZ0pBQWtBQ1FBSkFRWkNud0FBb0FnQWlBVUVCSUFCQkgzRjBJZ1p4QkVBZ0FpZ0NBQ0lDUVFScUtBSUFRWGh4SUFSSERRRWdBaUVBREFJTFFaQ253QUFnQVNBR2NqWUNBQ0FDSUFVMkFnQU1Bd3NnQkVFQVFSa2dBRUVCZG10QkgzRWdBRUVmUmh0MElRRURRQ0FDSUFGQkhYWkJCSEZxUVJCcUlnWW9BZ0FpQUVVTkFpQUJRUUYwSVFFZ0FDRUNJQUJCQkdvb0FnQkJlSEVnQkVjTkFBc0xJQUFvQWdnaUFpQUZOZ0lNSUFBZ0JUWUNDQ0FGUVFBMkFoZ2dCU0FBTmdJTUlBVWdBallDQ0F3RUN5QUdJQVUyQWdBTElBVWdBallDR0NBRklBVTJBZ3dnQlNBRk5nSUlEQUlMSUFSQkEzWWlBa0VEZEVHVXA4QUFhaUVBQW45QmpLZkFBQ2dDQUNJQlFRRWdBblFpQW5FRVFDQUFLQUlJREFFTFFZeW53QUFnQVNBQ2NqWUNBQ0FBQ3lFQ0lBQWdCVFlDQ0NBQ0lBVTJBZ3dnQlNBQU5nSU1JQVVnQWpZQ0NBd0JDeUFESUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQU5xSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBMEVJYWc4TEFrQUNRRUdNcDhBQUtBSUFJZ0ZCRUNBQVFRdHFRWGh4SUFCQkMwa2JJZ1pCQTNZaUFIWWlBa0VEY1VVRVFDQUdRWnlxd0FBb0FnQk5EUU1nQWcwQlFaQ253QUFvQWdBaUFFVU5BeUFBUVFBZ0FHdHhhRUVDZEVHY3FjQUFhaWdDQUNJQlFRUnFLQUlBUVhoeElBWnJJUVFnQVNFQ0EwQWdBU2dDRUNJQVJRUkFJQUZCRkdvb0FnQWlBRVVOQkFzZ0FFRUVhaWdDQUVGNGNTQUdheUlCSUFRZ0FTQUVTU0lCR3lFRUlBQWdBaUFCR3lFQ0lBQWhBUXdBQ3dBTEFrQWdBa0YvYzBFQmNTQUFhaUlBUVFOMFFZeW53QUJxSWdOQkVHb29BZ0FpQWtFSWFpSUZLQUlBSWdRZ0EwRUlhaUlEUndSQUlBUWdBellDRENBRElBUTJBZ2dNQVF0QmpLZkFBQ0FCUVg0Z0FIZHhOZ0lBQ3lBQ0lBQkJBM1FpQUVFRGNqWUNCQ0FBSUFKcUlnQWdBQ2dDQkVFQmNqWUNCQ0FGRHdzQ1FFRUNJQUIwSWdSQkFDQUVhM0lnQWlBQWRIRWlBRUVBSUFCcmNXZ2lBa0VEZEVHTXA4QUFhaUlEUVJCcUtBSUFJZ0JCQ0dvaUJTZ0NBQ0lFSUFOQkNHb2lBMGNFUUNBRUlBTTJBZ3dnQXlBRU5nSUlEQUVMUVl5bndBQWdBVUYrSUFKM2NUWUNBQXNnQUNBR1FRTnlOZ0lFSUFBZ0Jtb2lBeUFDUVFOMElnSWdCbXNpQVVFQmNqWUNCQ0FBSUFKcUlBRTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlFUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQ0FuOUJqS2ZBQUNnQ0FDSUdRUUVnQkVFZmNYUWlCSEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCQ0FHY2pZQ0FDQUFDeUVFSUFBZ0FqWUNDQ0FFSUFJMkFnd2dBaUFBTmdJTUlBSWdCRFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQVRZQ0FDQUZEd3NnQWlnQ0dDRUhBa0FDUUNBQ0lBSW9BZ3dpQVVZRVFDQUNRUlJCRUNBQ1FSUnFJZ0VvQWdBaUF4dHFLQUlBSWdBTkFVRUFJUUVNQWdzZ0FpZ0NDQ0lBSUFFMkFnd2dBU0FBTmdJSURBRUxJQUVnQWtFUWFpQURHeUVEQTBBZ0F5RUZJQUFpQVVFVWFpSURLQUlBSWdCRkJFQWdBVUVRYWlFRElBRW9BaEFoQUFzZ0FBMEFDeUFGUVFBMkFnQUxJQWRGRFFNZ0FpQUNLQUljUVFKMFFaeXB3QUJxSWdBb0FnQkhCRUFnQjBFUVFSUWdCeWdDRUNBQ1JodHFJQUUyQWdBZ0FVVU5CQXdEQ3lBQUlBRTJBZ0FnQVEwQ1FaQ253QUJCa0tmQUFDZ0NBRUYrSUFJb0FoeDNjVFlDQUF3REN3SkFBa0FDUUFKQUFrQkJuS3JBQUNnQ0FDSUFJQVpKQkVCQm9LckFBQ2dDQUNJQUlBWkxEUU5CQUNFQ0lBWkJyNEFFYWlJQVFSQjJRQUFpQVVGL1JnMEdJQUZCRUhRaUJVVU5Ca0dzcXNBQUlBQkJnSUI4Y1NJRVFheXF3QUFvQWdCcUlnQTJBZ0JCc0tyQUFFR3dxc0FBS0FJQUlnRWdBQ0FCSUFCTEd6WUNBRUdvcXNBQUtBSUFJZ05GRFFGQnRLckFBQ0VBQTBBZ0FDZ0NBQ0lCSUFBb0FnUWlCMm9nQlVZTkF5QUFLQUlJSWdBTkFBc01CQXRCcEtyQUFDZ0NBQ0VDQW44Z0FDQUdheUlCUVE5TkJFQkJwS3JBQUVFQU5nSUFRWnlxd0FCQkFEWUNBQ0FDSUFCQkEzSTJBZ1FnQUNBQ2FpSUJRUVJxSVFBZ0FTZ0NCRUVCY2d3QkMwR2Nxc0FBSUFFMkFnQkJwS3JBQUNBQ0lBWnFJZ1EyQWdBZ0JDQUJRUUZ5TmdJRUlBQWdBbW9nQVRZQ0FDQUNRUVJxSVFBZ0JrRURjZ3NoQVNBQUlBRTJBZ0FnQWtFSWFnOExRY2lxd0FBb0FnQWlBRUVBSUFBZ0JVMGJSUVJBUWNpcXdBQWdCVFlDQUF0QnpLckFBRUgvSHpZQ0FFRzBxc0FBSUFVMkFnQkJ3S3JBQUVFQU5nSUFRYmlxd0FBZ0JEWUNBRUdncDhBQVFaU253QUEyQWdCQnFLZkFBRUdjcDhBQU5nSUFRWnlud0FCQmxLZkFBRFlDQUVHd3A4QUFRYVNud0FBMkFnQkJwS2ZBQUVHY3A4QUFOZ0lBUWJpbndBQkJyS2ZBQURZQ0FFR3NwOEFBUWFTbndBQTJBZ0JCd0tmQUFFRzBwOEFBTmdJQVFiU253QUJCcktmQUFEWUNBRUhJcDhBQVFieW53QUEyQWdCQnZLZkFBRUcwcDhBQU5nSUFRZENud0FCQnhLZkFBRFlDQUVIRXA4QUFRYnlud0FBMkFnQkIyS2ZBQUVITXA4QUFOZ0lBUWN5bndBQkJ4S2ZBQURZQ0FFSGdwOEFBUWRTbndBQTJBZ0JCMUtmQUFFSE1wOEFBTmdJQVFkeW53QUJCMUtmQUFEWUNBRUhvcDhBQVFkeW53QUEyQWdCQjVLZkFBRUhjcDhBQU5nSUFRZkNud0FCQjVLZkFBRFlDQUVIc3A4QUFRZVNud0FBMkFnQkIrS2ZBQUVIc3A4QUFOZ0lBUWZTbndBQkI3S2ZBQURZQ0FFR0FxTUFBUWZTbndBQTJBZ0JCL0tmQUFFSDBwOEFBTmdJQVFZaW93QUJCL0tmQUFEWUNBRUdFcU1BQVFmeW53QUEyQWdCQmtLakFBRUdFcU1BQU5nSUFRWXlvd0FCQmhLakFBRFlDQUVHWXFNQUFRWXlvd0FBMkFnQkJsS2pBQUVHTXFNQUFOZ0lBUWFDb3dBQkJsS2pBQURZQ0FFR29xTUFBUVp5b3dBQTJBZ0JCbktqQUFFR1VxTUFBTmdJQVFiQ293QUJCcEtqQUFEWUNBRUdrcU1BQVFaeW93QUEyQWdCQnVLakFBRUdzcU1BQU5nSUFRYXlvd0FCQnBLakFBRFlDQUVIQXFNQUFRYlNvd0FBMkFnQkJ0S2pBQUVHc3FNQUFOZ0lBUWNpb3dBQkJ2S2pBQURZQ0FFRzhxTUFBUWJTb3dBQTJBZ0JCMEtqQUFFSEVxTUFBTmdJQVFjU293QUJCdktqQUFEWUNBRUhZcU1BQVFjeW93QUEyQWdCQnpLakFBRUhFcU1BQU5nSUFRZUNvd0FCQjFLakFBRFlDQUVIVXFNQUFRY3lvd0FBMkFnQkI2S2pBQUVIY3FNQUFOZ0lBUWR5b3dBQkIxS2pBQURZQ0FFSHdxTUFBUWVTb3dBQTJBZ0JCNUtqQUFFSGNxTUFBTmdJQVFmaW93QUJCN0tqQUFEWUNBRUhzcU1BQVFlU293QUEyQWdCQmdLbkFBRUgwcU1BQU5nSUFRZlNvd0FCQjdLakFBRFlDQUVHSXFjQUFRZnlvd0FBMkFnQkIvS2pBQUVIMHFNQUFOZ0lBUVpDcHdBQkJoS25BQURZQ0FFR0VxY0FBUWZ5b3dBQTJBZ0JCbUtuQUFFR01xY0FBTmdJQVFZeXB3QUJCaEtuQUFEWUNBRUdvcXNBQUlBVTJBZ0JCbEtuQUFFR01xY0FBTmdJQVFhQ3F3QUFnQkVGWWFpSUFOZ0lBSUFVZ0FFRUJjallDQkNBQUlBVnFRU2cyQWdSQnhLckFBRUdBZ0lBQk5nSUFEQU1MSUFCQkRHb29BZ0FnQlNBRFRYSWdBU0FEUzNJTkFTQUFJQVFnQjJvMkFnUkJxS3JBQUVHb3FzQUFLQUlBSWdCQkQycEJlSEVpQVVGNGFqWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0JHb2lCQ0FBSUFGcmFrRUlhaUlETmdJQUlBRkJmR29nQTBFQmNqWUNBQ0FBSUFScVFTZzJBZ1JCeEtyQUFFR0FnSUFCTmdJQURBSUxRYUNxd0FBZ0FDQUdheUlDTmdJQVFhaXF3QUJCcUtyQUFDZ0NBQ0lBSUFacUlnRTJBZ0FnQVNBQ1FRRnlOZ0lFSUFBZ0JrRURjallDQkNBQVFRaHFJUUlNQWd0QnlLckFBRUhJcXNBQUtBSUFJZ0FnQlNBQUlBVkpHellDQUNBRUlBVnFJUUZCdEtyQUFDRUFBa0FEUUNBQklBQW9BZ0JIQkVBZ0FDZ0NDQ0lBRFFFTUFnc0xJQUJCREdvb0FnQU5BQ0FBSUFVMkFnQWdBQ0FBS0FJRUlBUnFOZ0lFSUFVZ0JrRURjallDQkNBRklBWnFJUUFnQVNBRmF5QUdheUVHQWtBQ1FDQUJRYWlxd0FBb0FnQkhCRUJCcEtyQUFDZ0NBQ0FCUmcwQklBRkJCR29vQWdBaUFrRURjVUVCUmdSQUlBRWdBa0Y0Y1NJQ0VCRWdBaUFHYWlFR0lBRWdBbW9oQVFzZ0FTQUJLQUlFUVg1eE5nSUVJQUFnQmtFQmNqWUNCQ0FBSUFacUlBWTJBZ0FnQmtHQUFrOEVRQ0FBUWdBM0FoQWdBQUovUVFBZ0JrRUlkaUlDUlEwQUdrRWZJQVpCLy8vL0Iwc05BQm9nQmtFR0lBSm5JZ0pyUVI5eGRrRUJjU0FDUVFGMGEwRSthZ3NpQVRZQ0hDQUJRUUowUVp5cHdBQnFJUUlDUUFKQUFrQUNRRUdRcDhBQUtBSUFJZ1JCQVNBQlFSOXhkQ0lEY1FSQUlBSW9BZ0FpQWtFRWFpZ0NBRUY0Y1NBR1J3MEJJQUloQkF3Q0MwR1FwOEFBSUFNZ0JISTJBZ0FnQWlBQU5nSUFEQU1MSUFaQkFFRVpJQUZCQVhaclFSOXhJQUZCSDBZYmRDRUJBMEFnQWlBQlFSMTJRUVJ4YWtFUWFpSURLQUlBSWdSRkRRSWdBVUVCZENFQklBUWlBa0VFYWlnQ0FFRjRjU0FHUncwQUN3c2dCQ2dDQ0NJQ0lBQTJBZ3dnQkNBQU5nSUlJQUJCQURZQ0dDQUFJQVEyQWd3Z0FDQUNOZ0lJREFVTElBTWdBRFlDQUFzZ0FDQUNOZ0lZSUFBZ0FEWUNEQ0FBSUFBMkFnZ01Bd3NnQmtFRGRpSUJRUU4wUVpTbndBQnFJUUlDZjBHTXA4QUFLQUlBSWdSQkFTQUJkQ0lCY1FSQUlBSW9BZ2dNQVF0QmpLZkFBQ0FCSUFSeU5nSUFJQUlMSVFFZ0FpQUFOZ0lJSUFFZ0FEWUNEQ0FBSUFJMkFnd2dBQ0FCTmdJSURBSUxRYWlxd0FBZ0FEWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0Jtb2lBallDQUNBQUlBSkJBWEkyQWdRTUFRdEJwS3JBQUNBQU5nSUFRWnlxd0FCQm5LckFBQ2dDQUNBR2FpSUNOZ0lBSUFBZ0FrRUJjallDQkNBQUlBSnFJQUkyQWdBTElBVkJDR29QQzBHMHFzQUFJUUFEUUFKQUlBQW9BZ0FpQVNBRFRRUkFJQUVnQUNnQ0JHb2lCeUFEU3cwQkN5QUFLQUlJSVFBTUFRc0xRYWlxd0FBZ0JUWUNBRUdncXNBQUlBUkJXR29pQURZQ0FDQUZJQUJCQVhJMkFnUWdBQ0FGYWtFb05nSUVRY1Nxd0FCQmdJQ0FBVFlDQUNBRElBZEJZR3BCZUhGQmVHb2lBQ0FBSUFOQkVHcEpHeUlCUVJzMkFnUkJ0S3JBQUNrQ0FDRUpJQUZCRUdwQnZLckFBQ2tDQURjQ0FDQUJJQWszQWdoQndLckFBRUVBTmdJQVFiaXF3QUFnQkRZQ0FFRzBxc0FBSUFVMkFnQkJ2S3JBQUNBQlFRaHFOZ0lBSUFGQkhHb2hBQU5BSUFCQkJ6WUNBQ0FISUFCQkJHb2lBRXNOQUFzZ0FTQURSZzBBSUFFZ0FTZ0NCRUYrY1RZQ0JDQURJQUVnQTJzaUJVRUJjallDQkNBQklBVTJBZ0FnQlVHQUFrOEVRQ0FEUWdBM0FoQWdBMEVjYWdKL1FRQWdCVUVJZGlJQVJRMEFHa0VmSUFWQi8vLy9CMHNOQUJvZ0JVRUdJQUJuSWdCclFSOXhka0VCY1NBQVFRRjBhMEUrYWdzaUFEWUNBQ0FBUVFKMFFaeXB3QUJxSVFFQ1FBSkFBa0FDUUVHUXA4QUFLQUlBSWdSQkFTQUFRUjl4ZENJSGNRUkFJQUVvQWdBaUJFRUVhaWdDQUVGNGNTQUZSdzBCSUFRaEFBd0NDMEdRcDhBQUlBUWdCM0kyQWdBZ0FTQUROZ0lBSUFOQkdHb2dBVFlDQUF3REN5QUZRUUJCR1NBQVFRRjJhMEVmY1NBQVFSOUdHM1FoQVFOQUlBUWdBVUVkZGtFRWNXcEJFR29pQnlnQ0FDSUFSUTBDSUFGQkFYUWhBU0FBSVFRZ0FFRUVhaWdDQUVGNGNTQUZSdzBBQ3dzZ0FDZ0NDQ0lCSUFNMkFnd2dBQ0FETmdJSUlBTkJHR3BCQURZQ0FDQURJQUEyQWd3Z0F5QUJOZ0lJREFNTElBY2dBellDQUNBRFFSaHFJQVEyQWdBTElBTWdBellDRENBRElBTTJBZ2dNQVFzZ0JVRURkaUlCUVFOMFFaU253QUJxSVFBQ2YwR01wOEFBS0FJQUlnUkJBU0FCZENJQmNRUkFJQUFvQWdnTUFRdEJqS2ZBQUNBQklBUnlOZ0lBSUFBTElRRWdBQ0FETmdJSUlBRWdBellDRENBRElBQTJBZ3dnQXlBQk5nSUlDMEdncXNBQUtBSUFJZ0FnQmswTkFFR2dxc0FBSUFBZ0Jtc2lBallDQUVHb3FzQUFRYWlxd0FBb0FnQWlBQ0FHYWlJQk5nSUFJQUVnQWtFQmNqWUNCQ0FBSUFaQkEzSTJBZ1FnQUVFSWFnOExJQUlQQ3lBQklBYzJBaGdnQWlnQ0VDSUFCRUFnQVNBQU5nSVFJQUFnQVRZQ0dBc2dBa0VVYWlnQ0FDSUFSUTBBSUFGQkZHb2dBRFlDQUNBQUlBRTJBaGdMQWtBZ0JFRVFUd1JBSUFJZ0JrRURjallDQkNBQ0lBWnFJZ01nQkVFQmNqWUNCQ0FESUFScUlBUTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlGUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQkFuOUJqS2ZBQUNnQ0FDSUdRUUVnQlVFZmNYUWlCWEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCU0FHY2pZQ0FDQUFDeUVGSUFBZ0FUWUNDQ0FGSUFFMkFnd2dBU0FBTmdJTUlBRWdCVFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQkRZQ0FBd0JDeUFDSUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQUpxSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBa0VJYWd2aEVBSVNmd0orSXdCQmdBRnJJZ1lrQUNBR0lBTTJBaXdnQmlBQ05nSW9Ba0FDZndKQUFrQUNRQUpBSUFFdEFFZEZCRUFnQVNrRE9DRVlJQUZDQURjRE9BSi9JQmhDLy84RGcxQkZCRUFnR0VJd2lLY2hFU0FZUWhDSXB5RU1JQmhDSUlpbkRBRUxJQVpCSUdvZ0FTQUdRU2hxRUNzZ0JpOEJJRVVFUUVFQklRME1CZ3RCQXlFTklBWXZBU0lpRENJQ0lBRXZBVUJQRFFVZ0FpQUJMd0ZDUmcwQ0lBRXZBVVFnREVILy93TnhSZzBESUFGQkdHb29BZ0JGRFFVZ0FVRW9haUFCUVJCcUlnY2dEQkFtR2lBQktBSVlJZ0lnREVILy93TnhJZ3BORFFRZ0J5Z0NBQ0FLUVFKMGFpSUNMUUFDSVJFZ0FpOEJBQXNoRXlBR1FSaHFJQUZCS0dvUVFpQUdLQUlZSVFJQ1FDQUdLQUljSWdjZ0JVMEVRQ0FIRFFGQkFTRVNRUUVoRFNBRklRZEJBUXdIQ3lBRlJRUkFRUUVoRFVFQUlRZEJBUXdIQ3lBRUlBSWdCUkJMR2lBQlFUQnFJZ0lnQWlnQ0FDQUZhallDQUVHSWc4QUFJUVJCQUNFTlFRQWhCMEVCREFZTElBUWdBaUFIRUVzZ0FVRXdhaUlDSUFJb0FnQWdCMm8yQWdBZ0Iyb2hCQ0FGSUFkcklRZEJBQ0VOUVFFTUJRc2dBRUVDT2dBSUlBQkNBRGNDQUF3RkN5QUJJQUV0QUVZaUIwRUJhaUlDT2dBS0lBRkJBU0FIUVE5eGRFRUNhanNCUUNBQlFYOGdBa0VQY1hSQmYzTTdBUWdnQVVFUWFpQUhFQTFCQUNFTVFRQWhEU0FGSVFkQkFBd0RDeUFCUVFFNkFFZEJBaUVOREFFTElBb2dBa0hvaHNBQUVEWUFDMEVBSVF3Z0JTRUhRUUFMSVFJZ0JrRTRha0VBTmdJQUlBWkNBRGNETUNBR1FjZ0Fha0VBTmdJQUlBWkNBRGNEUUNBR1Fmd0Fha0VBTmdJQUlBWkI5QUJxUVFBMkFnQWdCa0hzQUdwQkFEWUNBQ0FHUWVRQWFrRUFOZ0lBSUFaQjNBQnFRUUEyQWdBZ0JrSFlpY0FBTmdKNElBWkIySW5BQURZQ2NDQUdRZGlKd0FBMkFtZ2dCa0hZaWNBQU5nSmdJQVpCMkluQUFEWUNXQ0FHUVFBMkFsUWdCa0hZaWNBQU5nSlFBa0FDZndKQUlBSkZEUUFnQVVFUWFpRVVJQUZCS0dvaEZTQUdRY2dBYWlFWElBWkJQbW9oRmdKQUFrQUNRQUpBQWtBQ1FBSkFBa0FEUUFKQUFrQWdCdzBBSUFaQkVHb2dGUkJDSUFZb0FoUkZEUUJCQUNFSERBRUxJQUVnQmtFb2FoQVlRUUFoQ3lBWElSQkJBQ0VPQWtBQ1FBSkFBa0FDUUFKQUFrQUNRQUpBQTBBZ0FTMEFDeUlDSUFFdEFBb2lDRWtOQVNBQklBSWdDR3M2QUFzZ0JrRXdhaUFMYWlJS0lBRXZBUWdpQWlBQktRTUFJQWl0aVNJWXAzRTdBUUFnQVNBWUlBS3RRbitGUW9DQWZJU0ROd01BSUE0RVFDQU9RWDlxUVFWTERRVWdCeUFMSUJacUx3RUFJZ0pKRFFZZ0VDQUVOZ0lBSUJCQkJHb2dBallDQUNBSElBSnJJUWNnQWlBRWFpRUVDeUFCTHdGQUlnSWdEbXBCLy84RGNTQUJMd0VJSUFFdEFFaHJRZi8vQTNGR0RRSWdDaThCQUNJS0lBRXZBVUpHSUFvZ0FrOXlEUUlnQ2lBQkx3RkVSZzBDSUFFb0FpUWlBaUFLVFEwR0lBY2dBU2dDSENBS1FRRjBhaThCQUNJQ1NRMENJQTVCQVdvaERpQUxJQlpxUVFKcUlBSTdBUUFnRUVFSWFpRVFJQXRCQW1vaUMwRU1SdzBBQzBFR0lRNUJCU0VRSUFZdkFUb2hDQXdIQ3lBT0RRRkJBU0FOSUJJYklRME1DQXNnRGtFQmFpRU9DeUFPUVFkUERRTWdCa0V3YWlBT1FYOXFJaEJCQVhScUx3RUFJUWdnRUEwRUlBd2hDZ3dGQ3lBT1FYOXFRUVpCbUlUQUFCQTJBQXRCNklIQUFFRWpRZmlDd0FBUVNBQUxJQW9nQWtHb2hNQUFFRFlBQ3lBT1FRWkJ1SVRBQUJBM0FBc2dCa0hRQUdvaEFpQUdRVEJxSVFzRFFDQUdRUWhxSUJRZ0ZDQUxMd0VBSWdvZ0FpZ0NBQ0FDUVFScUtBSUFFQ2tnREJBaklBWXRBQW9oRVNBR0x3RUlJUk1nQVNBQkx3RkFRUUZxT3dGQUlBdEJBbW9oQ3lBQ1FRaHFJUUlnQ2lFTUlCQkJmMm9pRUEwQUN5QU9RUU4wSUFacVFVQnJJZ0lvQWdRaENTQUNRUUEyQWdRZ0FpZ0NBQ0VQSUFKQmlJUEFBRFlDQUFzZ0NDSU1JQUV2QVVKR0RRTUNRQ0FCTHdGRUlBaEhCRUFnQ0NBQkx3RkFJZ0pORFFGQkF5RU5RUUFNRFFzZ0FVRUJPZ0JIUVFJaERVRUFEQXdMQW44Z0J3Si9Ba0FDUUNBQ0lBaEhCRUFnQVNnQ0pDSUNJQWhMRFFFZ0NDQUNRZGlFd0FBUU5nQUxJQUVvQWlRaUFpQUtRZi8vQTNFaUNFME5DQ0FISUFFb0Fod2dDRUVCZEdvdkFRQkJBV3BCLy84RGNTSUNUdzBCSUE4RVFDQUJLQUlzSWdJZ0NVa05DaUFCS0FJb0lBOGdDUkJMR2lBQklBazJBakFnQVNBSk5nSTBDMEVBSVE4Z0ZSQXpJUXRCQVF3REN5QUhJQUVvQWh3Z0NFRUJkR292QVFBaUFra0VRRUVBSVE4Z0ZTQVVJQXdRSmlFTFFRRU1Bd3NnRkNBTUlBUWdBaEFwSVFzZ0Fnd0JDeUFQUlFSQUlBRW9BaXdpQ0NBQktBSTBJZ2xKRFFrZ0ZTZ0NBQ0VQQ3lBSlJRMEVJQWtnQWtzTkNTQVBMUUFBSVFzZ0JDQVBJQWtRU3lBQ0lBbEdEUW9nQ1dvZ0N6b0FBQ0FDQ3lJSmF5RUhJQWtnQkNJUGFpRUVRUUFMSUFFb0FoaEIveDlOQkVBZ0JpQVVJQXNnQ2hBaklBRXZBVUFoRUNBR0xRQUNJUkVnQmk4QkFDRVRBa0FnQVMwQUNpSUlRUXRMRFFBZ0VDQUJMd0VJSWdvZ0FTMEFTR3RCLy84RGNVY05BQ0FCSUFoQkFXbzZBQW9nQVNBS1FRRjBRUUZ5T3dFSUN5QUJJQkJCQVdvN0FVQUxRUUFoRWtVTkFRc0xRZ0VoR1NBUFJRMEtJQUVvQWl3aUFpQUpTUTBISUFFb0FpZ2dEeUFKRUVzYUlBRWdDVFlDTUNBQklBazJBalFNQ2d0QkFFRUFRWWlGd0FBUU5nQUxJQUVRTkF3R0N5QUlJQUpCeUlUQUFCQTJBQXNnQ1NBQ1FlaUV3QUFRTndBTElBa2dDRUg0aE1BQUVEY0FDeUFKSUFKQm1JWEFBQkEzQUF0QkFFRUFRYWlGd0FBUU5nQUxJQWtnQWtHNGhjQUFFRGNBQzBFQUN5RU1RUUFoRTBFQUlSRUxJQUFnQlNBSGF6WUNCQ0FBSUFNZ0JpZ0NMQ0lDYXpZQ0FDQUFRUUFnRFNBRElBSkxHeUFOSUExQkFVWWJPZ0FJSUFFZ0RLMUMvLzhEZzBJUWhpQVpoQ0FUclVMLy93T0RRaUNHaENBUnJVTC9BWU5DTUlhRU53TTRDeUFHUVlBQmFpUUFDOVlRQWhGL0FuNGpBRUdBQVdzaUJpUUFJQVlnQXpZQ0xDQUdJQUkyQWlnQ1FBSi9Ba0FDUUFKQUFrQWdBUzBBUjBVRVFDQUJLUU00SVJjZ0FVSUFOd000QW44Z0YwTC8vd09EVUVVRVFDQVhRakNJcHlFUklCZENFSWluSVF3Z0YwSWdpS2NNQVFzZ0JrRWdhaUFCSUFaQktHb1FMaUFHTHdFZ1JRUkFRUUVoRFF3R0MwRURJUTBnQmk4QklpSU1JZ0lnQVM4QlFFOE5CU0FDSUFFdkFVSkdEUUlnQVM4QlJDQU1RZi8vQTNGR0RRTWdBVUVZYWlnQ0FFVU5CU0FCUVNocUlBRkJFR29pQnlBTUVDWWFJQUVvQWhnaUFpQU1RZi8vQTNFaUNVME5CQ0FIS0FJQUlBbEJBblJxSWdJdEFBSWhFU0FDTHdFQUN5RVNJQVpCR0dvZ0FVRW9haEJDSUFZb0FoZ2hBZ0pBSUFZb0Fod2lCeUFGVFFSQUlBY05BVUVCSVFoQkFTRU5JQVVoQjBFQkRBY0xJQVZGQkVCQkFTRU5RUUFoQjBFQkRBY0xJQVFnQWlBRkVFc2FJQUZCTUdvaUFpQUNLQUlBSUFWcU5nSUFRWWlEd0FBaEJFRUFJUTFCQUNFSFFRRU1CZ3NnQkNBQ0lBY1FTeUFCUVRCcUlnSWdBaWdDQUNBSGFqWUNBQ0FIYWlFRUlBVWdCMnNoQjBFQUlRMUJBUXdGQ3lBQVFRSTZBQWdnQUVJQU53SUFEQVVMSUFFZ0FTMEFSaUlIUVFGcUlnSTZBQW9nQVVFQklBZEJEM0YwUVFKcU93RkFJQUZCZnlBQ1FROXhkRUYvY3pzQkNDQUJRUkJxSUFjUURVRUFJUXhCQUNFTklBVWhCMEVBREFNTElBRkJBVG9BUjBFQ0lRME1BUXNnQ1NBQ1FlaUd3QUFRTmdBTFFRQWhEQ0FGSVFkQkFBc2hBaUFHUVRocVFRQTJBZ0FnQmtJQU53TXdJQVpCeUFCcVFRQTJBZ0FnQmtJQU53TkFJQVpCL0FCcVFRQTJBZ0FnQmtIMEFHcEJBRFlDQUNBR1Fld0Fha0VBTmdJQUlBWkI1QUJxUVFBMkFnQWdCa0hjQUdwQkFEWUNBQ0FHUWRpSndBQTJBbmdnQmtIWWljQUFOZ0p3SUFaQjJJbkFBRFlDYUNBR1FkaUp3QUEyQW1BZ0JrSFlpY0FBTmdKWUlBWkJBRFlDVkNBR1FkaUp3QUEyQWxBQ1FBSi9Ba0FnQWtVTkFDQUJRUkJxSVJNZ0FVRW9haUVVSUFaQnlBQnFJUllnQmtFK2FpRVZBa0FDUUFKQUFrQUNRQUpBQWtBQ1FBTkFBa0FDUUNBSERRQWdCa0VRYWlBVUVFSWdCaWdDRkVVTkFFRUFJUWNNQVFzZ0FTQUdRU2hxRUNCQkFDRUxJQlloRUVFQUlRNENRQUpBQWtBQ1FBSkFBa0FDUUFKQUFrQURRQ0FCTFFBTElnSWdBUzBBQ2lJSlNRMEJJQUVnQWlBSmF6b0FDeUFCSUFFcEF3QWlGeUFKclVJL2c0ZzNBd0FnQmtFd2FpQUxhaUlKSUFFdkFRZ2dGNmR4T3dFQUlBNEVRQ0FPUVg5cVFRVkxEUVVnQnlBTElCVnFMd0VBSWdKSkRRWWdFQ0FFTmdJQUlCQkJCR29nQWpZQ0FDQUhJQUpySVFjZ0FpQUVhaUVFQ3lBQkx3RkFJZ0lnRG1wQi8vOERjU0FCTHdFSUlBRXRBRWhyUWYvL0EzRkdEUUlnQ1M4QkFDSUpJQUV2QVVKR0lBa2dBazl5RFFJZ0NTQUJMd0ZFUmcwQ0lBRW9BaVFpQWlBSlRRMEdJQWNnQVNnQ0hDQUpRUUYwYWk4QkFDSUNTUTBDSUE1QkFXb2hEaUFMSUJWcVFRSnFJQUk3QVFBZ0VFRUlhaUVRSUF0QkFtb2lDMEVNUncwQUMwRUdJUTVCQlNFUUlBWXZBVG9oQ0F3SEN5QU9EUUZCQVNBTklBZ2JJUTBNQ0FzZ0RrRUJhaUVPQ3lBT1FRZFBEUU1nQmtFd2FpQU9RWDlxSWhCQkFYUnFMd0VBSVFnZ0VBMEVJQXdoQ1F3RkN5QU9RWDlxUVFaQm1JVEFBQkEyQUF0QjZJSEFBRUVqUWZpQ3dBQVFTQUFMSUFrZ0FrR29oTUFBRURZQUN5QU9RUVpCdUlUQUFCQTNBQXNnQmtIUUFHb2hBaUFHUVRCcUlRc0RRQ0FHUVFocUlCTWdFeUFMTHdFQUlna2dBaWdDQUNBQ1FRUnFLQUlBRUNrZ0RCQWpJQVl0QUFvaEVTQUdMd0VJSVJJZ0FTQUJMd0ZBUVFGcU93RkFJQXRCQW1vaEN5QUNRUWhxSVFJZ0NTRU1JQkJCZjJvaUVBMEFDeUFPUVFOMElBWnFRVUJySWdJb0FnUWhDaUFDUVFBMkFnUWdBaWdDQUNFUElBSkJpSVBBQURZQ0FBc2dDQ0lNSUFFdkFVSkdEUU1DUUNBQkx3RkVJQWhIQkVBZ0NDQUJMd0ZBSWdKTkRRRkJBeUVOUVFBTURRc2dBVUVCT2dCSFFRSWhEVUVBREF3TEFuOGdCd0ovQWtBQ1FDQUNJQWhIQkVBZ0FTZ0NKQ0lDSUFoTERRRWdDQ0FDUWRpRXdBQVFOZ0FMSUFFb0FpUWlBaUFKUWYvL0EzRWlDRTBOQ0NBSElBRW9BaHdnQ0VFQmRHb3ZBUUJCQVdwQi8vOERjU0lDVHcwQklBOEVRQ0FCS0FJc0lnSWdDa2tOQ2lBQktBSW9JQThnQ2hCTEdpQUJJQW8yQWpBZ0FTQUtOZ0kwQzBFQUlROGdGQkF6SVF0QkFRd0RDeUFISUFFb0Fod2dDRUVCZEdvdkFRQWlBa2tFUUVFQUlROGdGQ0FUSUF3UUppRUxRUUVNQXdzZ0V5QU1JQVFnQWhBcElRc2dBZ3dCQ3lBUFJRUkFJQUVvQWl3aUNDQUJLQUkwSWdwSkRRa2dGQ2dDQUNFUEN5QUtSUTBFSUFvZ0Frc05DU0FQTFFBQUlRc2dCQ0FQSUFvUVN5QUNJQXBHRFFvZ0Ntb2dDem9BQUNBQ0N5SUtheUVISUFvZ0JDSVBhaUVFUVFBTElBRW9BaGhCL3g5TkJFQWdCaUFUSUFzZ0NSQWpJQUV2QVVBaEVDQUdMUUFDSVJFZ0JpOEJBQ0VTQWtBZ0FTMEFDaUlJUVF0TERRQWdFQ0FCTHdFSUlna2dBUzBBU0d0Qi8vOERjVWNOQUNBQklBaEJBV282QUFvZ0FTQUpRUUYwUVFGeU93RUlDeUFCSUJCQkFXbzdBVUFMUVFBaENFVU5BUXNMUWdFaEdDQVBSUTBLSUFFb0Fpd2lBaUFLU1EwSElBRW9BaWdnRHlBS0VFc2FJQUVnQ2pZQ01DQUJJQW8yQWpRTUNndEJBRUVBUVlpRndBQVFOZ0FMSUFFUU5Bd0dDeUFJSUFKQnlJVEFBQkEyQUFzZ0NpQUNRZWlFd0FBUU53QUxJQW9nQ0VINGhNQUFFRGNBQ3lBS0lBSkJtSVhBQUJBM0FBdEJBRUVBUWFpRndBQVFOZ0FMSUFvZ0FrRzRoY0FBRURjQUMwRUFDeUVNUVFBaEVrRUFJUkVMSUFBZ0JTQUhhellDQkNBQUlBTWdCaWdDTENJQ2F6WUNBQ0FBUVFBZ0RTQURJQUpMR3lBTklBMUJBVVliT2dBSUlBRWdESzFDLy84RGcwSVFoaUFZaENBU3JVTC8vd09EUWlDR2hDQVJyVUwvQVlOQ01JYUVOd000Q3lBR1FZQUJhaVFBQzZvSUFRWi9Jd0JCOEFCcklnVWtBQ0FGSUFNMkFnd2dCU0FDTmdJSVFRRWhCeUFCSVFZQ1FDQUJRWUVDU1EwQVFRQWdBV3NoQ1VHQUFpRUlBMEFDUUNBSUlBRlBEUUJCQUNFSElBQWdDR29zQUFCQnYzOU1EUUFnQ0NFR0RBSUxJQWhCZjJvaEJrRUFJUWNnQ0VFQlJnMEJJQWdnQ1dvZ0JpRUlRUUZIRFFBTEN5QUZJQVkyQWhRZ0JTQUFOZ0lRSUFWQkFFRUZJQWNiTmdJY0lBVkI4SXZBQUVIQWtzQUFJQWNiTmdJWUFrQUNmd0pBQWtBZ0FpQUJTeUlISUFNZ0FVdHlSUVJBSUFJZ0Ewc05BUUpBSUFKRklBRWdBa1p5UlFSQUlBRWdBazBOQVNBQUlBSnFMQUFBUVVCSURRRUxJQU1oQWdzZ0JTQUNOZ0lnSUFKQkFDQUJJQUpIRzBVRVFDQUNJUWNNQXdzZ0FVRUJhaUVEQTBBQ1FDQUNJQUZQRFFBZ0FDQUNhaXdBQUVGQVNBMEFJQUloQnlBRlFTUnFEQVVMSUFKQmYyb2hCeUFDUVFGR0RRTWdBaUFEUmlBSElRSkZEUUFMREFJTElBVWdBaUFESUFjYk5nSW9JQVZCeEFCcVFRTTJBZ0FnQlVIY0FHcEJIVFlDQUNBRlFkUUFha0VkTmdJQUlBVkNBemNDTkNBRlFlaVN3QUEyQWpBZ0JVRWNOZ0pNSUFVZ0JVSElBR28yQWtBZ0JTQUZRUmhxTmdKWUlBVWdCVUVRYWpZQ1VDQUZJQVZCS0dvMkFrZ01Bd3NnQlVIa0FHcEJIVFlDQUNBRlFkd0Fha0VkTmdJQUlBVkIxQUJxUVJ3MkFnQWdCVUhFQUdwQkJEWUNBQ0FGUWdRM0FqUWdCVUdrazhBQU5nSXdJQVZCSERZQ1RDQUZJQVZCeUFCcU5nSkFJQVVnQlVFWWFqWUNZQ0FGSUFWQkVHbzJBbGdnQlNBRlFReHFOZ0pRSUFVZ0JVRUlhallDU0F3Q0N5QUZRU1JxQ3lFSUFrQWdBU0FIUmcwQVFRRWhBd0pBQWtBQ1FDQUFJQWRxSWdZc0FBQWlBa0YvVEFSQVFRQWhBeUFBSUFGcUlnRWhBQ0FCSUFaQkFXcEhCRUFnQmkwQUFVRS9jU0VESUFaQkFtb2hBQXNnQWtFZmNTRUpJQUpCL3dGeFFkOEJTdzBCSUFNZ0NVRUdkSEloQWd3Q0N5QUZJQUpCL3dGeE5nSWtJQVZCS0dvaEFRd0NDMEVBSVFvZ0FTRUdJQUFnQVVjRVFDQUFMUUFBUVQ5eElRb2dBRUVCYWlFR0N5QUtJQU5CQm5SeUlRQWdBa0gvQVhGQjhBRkpCRUFnQUNBSlFReDBjaUVDREFFTFFRQWhBaUFCSUFaSEJIOGdCaTBBQUVFL2NRVkJBQXNnQ1VFU2RFR0FnUEFBY1NBQVFRWjBjbklpQWtHQWdNUUFSZzBDQ3lBRklBSTJBaVJCQVNFRElBVkJLR29oQVNBQ1FZQUJTUTBBUVFJaEF5QUNRWUFRU1EwQVFRTkJCQ0FDUVlDQUJFa2JJUU1MSUFVZ0J6WUNLQ0FGSUFNZ0IybzJBaXdnQlVIRUFHcEJCVFlDQUNBRlFld0Fha0VkTmdJQUlBVkI1QUJxUVIwMkFnQWdCVUhjQUdwQkhqWUNBQ0FGUWRRQWFrRWZOZ0lBSUFWQ0JUY0NOQ0FGUWZpVHdBQTJBakFnQlNBQk5nSllJQVVnQ0RZQ1VDQUZRUncyQWt3Z0JTQUZRY2dBYWpZQ1FDQUZJQVZCR0dvMkFtZ2dCU0FGUVJCcU5nSmdJQVVnQlVFZ2FqWUNTQXdCQzBIOGk4QUFRU3NnQkJCSUFBc2dCVUV3YWlBRUVGRUFDOUlJQVFWL0lBQkJlR29pQVNBQVFYeHFLQUlBSWdOQmVIRWlBR29oQWdKQUFrQWdBMEVCY1EwQUlBTkJBM0ZGRFFFZ0FTZ0NBQ0lESUFCcUlRQWdBU0FEYXlJQlFhU3F3QUFvQWdCR0JFQWdBaWdDQkVFRGNVRURSdzBCUVp5cXdBQWdBRFlDQUNBQ0lBSW9BZ1JCZm5FMkFnUWdBU0FBUVFGeU5nSUVJQUFnQVdvZ0FEWUNBQThMSUFFZ0F4QVJDd0pBSUFKQkJHb2lCQ2dDQUNJRFFRSnhCRUFnQkNBRFFYNXhOZ0lBSUFFZ0FFRUJjallDQkNBQUlBRnFJQUEyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQVNBQUlBSnFJZ0JCQVhJMkFnUWdBQ0FCYWlBQU5nSUFJQUZCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUEyQWdBUEMwR29xc0FBSUFFMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFCcUlnQTJBZ0FnQVNBQVFRRnlOZ0lFUWFTcXdBQW9BZ0FnQVVZRVFFR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFDMEhFcXNBQUtBSUFJZ0lnQUU4TkFrR29xc0FBS0FJQUlnQkZEUUlDUUVHZ3FzQUFLQUlBSWdOQktVa05BRUcwcXNBQUlRRURRQ0FCS0FJQUlnUWdBRTBFUUNBRUlBRW9BZ1JxSUFCTERRSUxJQUVvQWdnaUFRMEFDd3RCektyQUFBSi9RZjhmUWJ5cXdBQW9BZ0FpQUVVTkFCcEJBQ0VCQTBBZ0FVRUJhaUVCSUFBb0FnZ2lBQTBBQ3lBQlFmOGZJQUZCL3g5TEd3czJBZ0FnQXlBQ1RRMENRY1Nxd0FCQmZ6WUNBQThMUWFTcXdBQWdBVFlDQUVHY3FzQUFRWnlxd0FBb0FnQWdBR29pQURZQ0FDQUJJQUJCQVhJMkFnUWdBQ0FCYWlBQU5nSUFEd3RCektyQUFBSi9Ba0FnQUVHQUFrOEVRQ0FCUWdBM0FoQWdBVUVjYWdKL1FRQWdBRUVJZGlJQ1JRMEFHa0VmSUFCQi8vLy9CMHNOQUJvZ0FFRUdJQUpuSWdKclFSOXhka0VCY1NBQ1FRRjBhMEUrYWdzaUF6WUNBQ0FEUVFKMFFaeXB3QUJxSVFJQ1FBSkFBa0FDUUFKQVFaQ253QUFvQWdBaUJFRUJJQU5CSDNGMElnVnhCRUFnQWlnQ0FDSUNRUVJxS0FJQVFYaHhJQUJIRFFFZ0FpRUREQUlMUVpDbndBQWdCQ0FGY2pZQ0FDQUNJQUUyQWdBTUF3c2dBRUVBUVJrZ0EwRUJkbXRCSDNFZ0EwRWZSaHQwSVFRRFFDQUNJQVJCSFhaQkJIRnFRUkJxSWdVb0FnQWlBMFVOQWlBRVFRRjBJUVFnQXlJQ1FRUnFLQUlBUVhoeElBQkhEUUFMQ3lBREtBSUlJZ0FnQVRZQ0RDQURJQUUyQWdnZ0FVRVlha0VBTmdJQUlBRWdBellDRENBQklBQTJBZ2dNQWdzZ0JTQUJOZ0lBQ3lBQlFSaHFJQUkyQWdBZ0FTQUJOZ0lNSUFFZ0FUWUNDQXRCektyQUFFSE1xc0FBS0FJQVFYOXFJZ0EyQWdBZ0FBMERRYnlxd0FBb0FnQWlBQTBCUWY4ZkRBSUxJQUJCQTNZaUFrRURkRUdVcDhBQWFpRUFBbjlCaktmQUFDZ0NBQ0lEUVFFZ0FuUWlBbkVFUUNBQUtBSUlEQUVMUVl5bndBQWdBaUFEY2pZQ0FDQUFDeUVDSUFBZ0FUWUNDQ0FDSUFFMkFnd2dBU0FBTmdJTUlBRWdBallDQ0E4TFFRQWhBUU5BSUFGQkFXb2hBU0FBS0FJSUlnQU5BQXNnQVVIL0h5QUJRZjhmU3hzTE5nSUFDd3VXQndFS2Z5QUFLQUlRSVFNQ1FBSkFBa0FnQUNnQ0NDSU1RUUZIQkVBZ0EwRUJSZzBCREFNTElBTkJBVWNOQVFzZ0FTQUNhaUVEQWtBQ1FDQUFRUlJxS0FJQUlnaEZCRUFnQVNFRURBRUxJQUVoQkFOQUlBTWdCQ0lIUmcwQ0lBZEJBV29oQkFKQUlBY3NBQUFpQmtGL1NnMEFJQVpCL3dGeElRa0NmeUFESUFSR0JFQkJBQ0VLSUFNTUFRc2dCeTBBQVVFL2NTRUtJQWRCQW1vaUJBc2hCaUFKUWVBQlNRMEFBbjhnQXlBR1JnUkFRUUFoQ3lBRERBRUxJQVl0QUFCQlAzRWhDeUFHUVFGcUlnUUxJUVlnQ1VId0FVa05BQ0FESUFaR0JIOUJBQVVnQmtFQmFpRUVJQVl0QUFCQlAzRUxJQWxCRW5SQmdJRHdBSEVnQ2tFTWRISWdDMEVHZEhKeVFZQ0F4QUJHRFFNTElBUWdCMnNnQldvaEJTQUlRWDlxSWdnTkFBc0xJQU1nQkVZTkFBSkFJQVFzQUFBaUIwRi9TZzBBQW44Z0F5QUVRUUZxUmdSQUlBTWhDRUVBREFFTElBUkJBbW9oQ0NBRUxRQUJRVDl4UVFaMEN5QUhRZjhCY1VIZ0FVa05BQUovSUFNZ0NFWUVRQ0FESVFaQkFBd0JDeUFJUVFGcUlRWWdDQzBBQUVFL2NRc2dCMEgvQVhGQjhBRkpEUUFnQjBIL0FYRWhCM0loQkNBRElBWkdCSDlCQUFVZ0JpMEFBRUUvY1FzZ0IwRVNkRUdBZ1BBQWNTQUVRUVowY25KQmdJREVBRVlOQVFzQ1FDQUZSU0FDSUFWR2NrVUVRRUVBSVFNZ0JTQUNUdzBCSUFFZ0JXb3NBQUJCUUVnTkFRc2dBU0VEQ3lBRklBSWdBeHNoQWlBRElBRWdBeHNoQVFzZ0RFRUJSZzBBREFFTEFrQWdBZ1JBUVFBaEJDQUNJUVVnQVNFREEwQWdCQ0FETFFBQVFjQUJjVUdBQVVacUlRUWdBMEVCYWlFRElBVkJmMm9pQlEwQUN5QUNJQVJySUFBb0Fnd2lCazhOQWtFQUlRUWdBaUVGSUFFaEF3TkFJQVFnQXkwQUFFSEFBWEZCZ0FGR2FpRUVJQU5CQVdvaEF5QUZRWDlxSWdVTkFBc01BUXRCQUNFRUlBQW9BZ3dpQmcwQURBRUxRUUFoQXlBRUlBSnJJQVpxSWdRaEJRSkFBa0FDUUVFQUlBQXRBQ0FpQmlBR1FRTkdHMEVEY1VFQmF3NERBUUFCQWdzZ0JFRUJkaUVESUFSQkFXcEJBWFloQlF3QkMwRUFJUVVnQkNFREN5QURRUUZxSVFNQ1FBTkFJQU5CZjJvaUF3UkFJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQkRBSUxDeUFBS0FJRUlRUWdBQ2dDR0NBQklBSWdBQ2dDSENnQ0RCRUJBQTBBSUFWQkFXb2hBeUFBS0FJY0lRRWdBQ2dDR0NFQUEwQWdBMEYvYWlJRFJRUkFRUUFQQ3lBQUlBUWdBU2dDRUJFQUFFVU5BQXNMUVFFUEN5QUFLQUlZSUFFZ0FpQUFRUnhxS0FJQUtBSU1FUUVBQzdzR0FRUi9JQUFnQVdvaEFnSkFBa0FnQUVFRWFpZ0NBQ0lEUVFGeERRQWdBMEVEY1VVTkFTQUFLQUlBSWdNZ0FXb2hBU0FBSUFOcklnQkJwS3JBQUNnQ0FFWUVRQ0FDS0FJRVFRTnhRUU5IRFFGQm5LckFBQ0FCTmdJQUlBSWdBaWdDQkVGK2NUWUNCQ0FBSUFGQkFYSTJBZ1FnQWlBQk5nSUFEd3NnQUNBREVCRUxBa0FnQWtFRWFpZ0NBQ0lEUVFKeEJFQWdBa0VFYWlBRFFYNXhOZ0lBSUFBZ0FVRUJjallDQkNBQUlBRnFJQUUyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQUNBQklBSnFJZ0ZCQVhJMkFnUWdBQ0FCYWlBQk5nSUFJQUJCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUUyQWdBUEMwR29xc0FBSUFBMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFGcUlnRTJBZ0FnQUNBQlFRRnlOZ0lFSUFCQnBLckFBQ2dDQUVjTkFrR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFEd3RCcEtyQUFDQUFOZ0lBUVp5cXdBQkJuS3JBQUNnQ0FDQUJhaUlCTmdJQUlBQWdBVUVCY2pZQ0JDQUFJQUZxSUFFMkFnQVBDeUFCUVlBQ1R3UkFJQUJDQURjQ0VDQUFRUnhxQW45QkFDQUJRUWgySWdKRkRRQWFRUjhnQVVILy8vOEhTdzBBR2lBQlFRWWdBbWNpQW10QkgzRjJRUUZ4SUFKQkFYUnJRVDVxQ3lJRE5nSUFJQU5CQW5SQm5LbkFBR29oQWdKQUFrQUNRQUpBUVpDbndBQW9BZ0FpQkVFQklBTkJIM0YwSWdWeEJFQWdBaWdDQUNJQ1FRUnFLQUlBUVhoeElBRkhEUUVnQWlFRERBSUxRWkNud0FBZ0JDQUZjallDQUNBQ0lBQTJBZ0FNQXdzZ0FVRUFRUmtnQTBFQmRtdEJIM0VnQTBFZlJodDBJUVFEUUNBQ0lBUkJIWFpCQkhGcVFSQnFJZ1VvQWdBaUEwVU5BaUFFUVFGMElRUWdBeUlDUVFScUtBSUFRWGh4SUFGSERRQUxDeUFES0FJSUlnRWdBRFlDRENBRElBQTJBZ2dnQUVFWWFrRUFOZ0lBSUFBZ0F6WUNEQ0FBSUFFMkFnZ1BDeUFGSUFBMkFnQUxJQUJCR0dvZ0FqWUNBQ0FBSUFBMkFnd2dBQ0FBTmdJSUR3c2dBVUVEZGlJQ1FRTjBRWlNud0FCcUlRRUNmMEdNcDhBQUtBSUFJZ05CQVNBQ2RDSUNjUVJBSUFFb0FnZ01BUXRCaktmQUFDQUNJQU55TmdJQUlBRUxJUUlnQVNBQU5nSUlJQUlnQURZQ0RDQUFJQUUyQWd3Z0FDQUNOZ0lJQ3d1cUJnRUhmd0pBQWtBQ1FBSkFBa0FDUUFKQUFrQWdBRUdBZ0FSUEJFQWdBRUdBZ0FoSkRRRWdBRUcxMlhOcVFiWGJLMGtnQUVIaWkzUnFRZUlMU1hJZ0FFR2ZxSFJxUVo4WVNTQUFRZDdpZEdwQkRrbHljaUFBUWY3Ly93QnhRWjd3Q2tZZ0FFR2lzblZxUVNKSmNpQUFRY3VSZFdwQkMwbHljZzBDSUFCQjhJTTRTUThMSUFCQmdQNERjVUVJZGlFR1FlaVV3QUFoQVNBQVFmOEJjU0VIQTBBQ1FDQUJRUUpxSVFVZ0FpQUJMUUFCSWdScUlRTWdCaUFCTFFBQUlnRkhCRUFnQVNBR1N3MEJJQU1oQWlBRklnRkJ1cFhBQUVjTkFnd0JDeUFESUFKSkRRUWdBMEdpQWtzTkJTQUNRYnFWd0FCcUlRRUNRQU5BSUFSRkRRRWdCRUYvYWlFRUlBRXRBQUFnQVVFQmFpRUJJQWRIRFFBTFFRQWhCQXdFQ3lBRElRSWdCU0lCUWJxVndBQkhEUUVMQ3lBQVFmLy9BM0VoQTBIY2w4QUFJUUZCQVNFRUEwQWdBVUVCYWlFQUFuOGdBQ0FCTFFBQUlnSkJHSFJCR0hVaUJVRUFUZzBBR2lBQVFaR2F3QUJHRFFZZ0FTMEFBU0FGUWY4QWNVRUlkSEloQWlBQlFRSnFDeUVCSUFNZ0Ftc2lBMEVBU0EwQ0lBUkJBWE1oQkNBQlFaR2F3QUJIRFFBTERBRUxJQUJCZ1A0RGNVRUlkaUVHUVpHYXdBQWhBU0FBUWY4QmNTRUhBMEFDUUNBQlFRSnFJUVVnQWlBQkxRQUJJZ1JxSVFNZ0JpQUJMUUFBSWdGSEJFQWdBU0FHU3cwQklBTWhBaUFGSWdGQjNackFBRWNOQWd3QkN5QURJQUpKRFFZZ0EwR3ZBVXNOQnlBQ1FkMmF3QUJxSVFFQ1FBTkFJQVJGRFFFZ0JFRi9haUVFSUFFdEFBQWdBVUVCYWlFQklBZEhEUUFMUVFBaEJBd0RDeUFESVFJZ0JTSUJRZDJhd0FCSERRRUxDeUFBUWYvL0EzRWhBMEdNbk1BQUlRRkJBU0VFQTBBZ0FVRUJhaUVBQW44Z0FDQUJMUUFBSWdKQkdIUkJHSFVpQlVFQVRnMEFHaUFBUWErZndBQkdEUWdnQVMwQUFTQUZRZjhBY1VFSWRISWhBaUFCUVFKcUN5RUJJQU1nQW1zaUEwRUFTQTBCSUFSQkFYTWhCQ0FCUWErZndBQkhEUUFMQ3lBRVFRRnhEd3NnQWlBRFFjaVV3QUFRT0FBTElBTkJvZ0pCeUpUQUFCQTNBQXRCL0l2QUFFRXJRZGlVd0FBUVNBQUxJQUlnQTBISWxNQUFFRGdBQ3lBRFFhOEJRY2lVd0FBUU53QUxRZnlMd0FCQkswSFlsTUFBRUVnQUM3RUZBUWQvUVN0QmdJREVBQ0FBS0FJQUlnbEJBWEVpQlJzaENpQUVJQVZxSVFnQ1FDQUpRUVJ4UlFSQVFRQWhBUXdCQ3lBQ0JFQWdBaUVHSUFFaEJRTkFJQWNnQlMwQUFFSEFBWEZCZ0FGR2FpRUhJQVZCQVdvaEJTQUdRWDlxSWdZTkFBc0xJQUlnQ0dvZ0Iyc2hDQXNDUUFKQUlBQW9BZ2hCQVVjRVFDQUFJQW9nQVNBQ0VFWU5BUXdDQ3lBQVFReHFLQUlBSWdZZ0NFMEVRQ0FBSUFvZ0FTQUNFRVlOQVF3Q0N3SkFBa0FDUUFKQUlBbEJDSEVFUUNBQUtBSUVJUWtnQUVFd05nSUVJQUF0QUNBaEN5QUFRUUU2QUNBZ0FDQUtJQUVnQWhCR0RRVkJBQ0VGSUFZZ0NHc2lBU0VDUVFFZ0FDMEFJQ0lHSUFaQkEwWWJRUU54UVFGckRnTUNBUUlEQzBFQUlRVWdCaUFJYXlJR0lRZ0NRQUpBQWtCQkFTQUFMUUFnSWdjZ0IwRURSaHRCQTNGQkFXc09Bd0VBQVFJTElBWkJBWFloQlNBR1FRRnFRUUYySVFnTUFRdEJBQ0VJSUFZaEJRc2dCVUVCYWlFRkEwQWdCVUYvYWlJRlJRMEVJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQUMwRUJEd3NnQVVFQmRpRUZJQUZCQVdwQkFYWWhBZ3dCQzBFQUlRSWdBU0VGQ3lBRlFRRnFJUVVDUUFOQUlBVkJmMm9pQlVVTkFTQUFLQUlZSUFBb0FnUWdBQ2dDSENnQ0VCRUFBRVVOQUF0QkFROExJQUFvQWdRaEFTQUFLQUlZSUFNZ0JDQUFLQUljS0FJTUVRRUFEUUVnQWtFQmFpRUhJQUFvQWh3aEFpQUFLQUlZSVFNRFFDQUhRWDlxSWdjRVFDQURJQUVnQWlnQ0VCRUFBRVVOQVF3REN3c2dBQ0FMT2dBZ0lBQWdDVFlDQkVFQUR3c2dBQ2dDQkNFRklBQWdDaUFCSUFJUVJnMEFJQUFvQWhnZ0F5QUVJQUFvQWh3b0Fnd1JBUUFOQUNBSVFRRnFJUWNnQUNnQ0hDRUJJQUFvQWhnaEFBTkFJQWRCZjJvaUIwVUVRRUVBRHdzZ0FDQUZJQUVvQWhBUkFBQkZEUUFMQzBFQkR3c2dBQ2dDR0NBRElBUWdBRUVjYWlnQ0FDZ0NEQkVCQUF2MEJRRUtmeU1BUVRCcklnTWtBQ0FEUVNScUlBRTJBZ0FnQTBFRE9nQW9JQU5DZ0lDQWdJQUVOd01JSUFNZ0FEWUNJQ0FEUVFBMkFoZ2dBMEVBTmdJUUFuOENRQUpBQWtBZ0FpZ0NDQ0lFQkVBZ0FpZ0NBQ0VHSUFJb0FnUWlDQ0FDUVF4cUtBSUFJZ1VnQlNBSVN4c2lCVVVOQVNBQUlBWW9BZ0FnQmlnQ0JDQUJLQUlNRVFFQURRTWdCa0VNYWlFQUlBSW9BaFFoQnlBQ0tBSVFJUW9nQlNFSkEwQWdBeUFFUVJ4cUxRQUFPZ0FvSUFNZ0JFRUVhaWtDQUVJZ2lUY0RDQ0FFUVJocUtBSUFJUUpCQUNFTFFRQWhBUUpBQWtBQ1FDQUVRUlJxS0FJQVFRRnJEZ0lBQWdFTElBSWdCMDhFUUNBQ0lBZEJ0SkRBQUJBMkFBc2dBa0VEZENBS2FpSU1LQUlFUVNCSERRRWdEQ2dDQUNnQ0FDRUNDMEVCSVFFTElBTWdBallDRkNBRElBRTJBaEFnQkVFUWFpZ0NBQ0VDQWtBQ1FBSkFJQVJCREdvb0FnQkJBV3NPQWdBQ0FRc2dBaUFIVHdSQUlBSWdCMEcwa01BQUVEWUFDeUFDUVFOMElBcHFJZ0VvQWdSQklFY05BU0FCS0FJQUtBSUFJUUlMUVFFaEN3c2dBeUFDTmdJY0lBTWdDellDR0NBRUtBSUFJZ0VnQjBrRVFDQUtJQUZCQTNScUlnRW9BZ0FnQTBFSWFpQUJLQUlFRVFBQURRVWdDVUYvYWlJSlJRMEVJQVJCSUdvaEJDQUFRWHhxSVFFZ0FDZ0NBQ0VDSUFCQkNHb2hBQ0FES0FJZ0lBRW9BZ0FnQWlBREtBSWtLQUlNRVFFQVJRMEJEQVVMQ3lBQklBZEJwSkRBQUJBMkFBc2dBaWdDQUNFR0lBSW9BZ1FpQ0NBQ1FSUnFLQUlBSWdVZ0JTQUlTeHNpQlVVTkFDQUNLQUlRSVFRZ0FDQUdLQUlBSUFZb0FnUWdBU2dDREJFQkFBMENJQVpCREdvaEFDQUZJUUlEUUNBRUtBSUFJQU5CQ0dvZ0JFRUVhaWdDQUJFQUFBMERJQUpCZjJvaUFrVU5BaUFFUVFocUlRUWdBRUY4YWlFQklBQW9BZ0FoQ1NBQVFRaHFJUUFnQXlnQ0lDQUJLQUlBSUFrZ0F5Z0NKQ2dDREJFQkFFVU5BQXNNQWd0QkFDRUZDeUFJSUFWTEJFQWdBeWdDSUNBR0lBVkJBM1JxSWdBb0FnQWdBQ2dDQkNBREtBSWtLQUlNRVFFQURRRUxRUUFNQVF0QkFRc2dBMEV3YWlRQUM0MEZBUWQvQWtBZ0FVSE0vM3RMRFFCQkVDQUJRUXRxUVhoeElBRkJDMGtiSVFJZ0FFRjhhaUlGS0FJQUlnWkJlSEVoQXdKQUFrQUNRQUpBQWtBQ1FDQUdRUU54QkVBZ0FFRjRhaUlISUFOcUlRZ2dBeUFDVHcwQlFhaXF3QUFvQWdBZ0NFWU5Ba0drcXNBQUtBSUFJQWhHRFFNZ0NFRUVhaWdDQUNJR1FRSnhEUVlnQmtGNGNTSUdJQU5xSWdNZ0FrOE5CQXdHQ3lBQ1FZQUNTU0FESUFKQkJISkpjaUFESUFKclFZR0FDRTl5RFFVTUJBc2dBeUFDYXlJQlFSQkpEUU1nQlNBQ0lBWkJBWEZ5UVFKeU5nSUFJQUlnQjJvaUJDQUJRUU55TmdJRUlBZ2dDQ2dDQkVFQmNqWUNCQ0FFSUFFUUJnd0RDMEdncXNBQUtBSUFJQU5xSWdNZ0FrME5BeUFGSUFJZ0JrRUJjWEpCQW5JMkFnQWdBaUFIYWlJQklBTWdBbXNpQkVFQmNqWUNCRUdncXNBQUlBUTJBZ0JCcUtyQUFDQUJOZ0lBREFJTFFaeXF3QUFvQWdBZ0Eyb2lBeUFDU1EwQ0FrQWdBeUFDYXlJQlFROU5CRUFnQlNBR1FRRnhJQU55UVFKeU5nSUFJQU1nQjJvaUFTQUJLQUlFUVFGeU5nSUVRUUFoQVF3QkN5QUZJQUlnQmtFQmNYSkJBbkkyQWdBZ0FpQUhhaUlFSUFGQkFYSTJBZ1FnQXlBSGFpSUNJQUUyQWdBZ0FpQUNLQUlFUVg1eE5nSUVDMEdrcXNBQUlBUTJBZ0JCbktyQUFDQUJOZ0lBREFFTElBZ2dCaEFSSUFNZ0Ftc2lBVUVRVHdSQUlBVWdBaUFGS0FJQVFRRnhja0VDY2pZQ0FDQUNJQWRxSWdRZ0FVRURjallDQkNBRElBZHFJZ0lnQWlnQ0JFRUJjallDQkNBRUlBRVFCZ3dCQ3lBRklBTWdCU2dDQUVFQmNYSkJBbkkyQWdBZ0F5QUhhaUlCSUFFb0FnUkJBWEkyQWdRTElBQWhCQXdCQ3lBQkVBQWlBa1VOQUNBQ0lBQWdBVUY4UVhnZ0JTZ0NBQ0lFUVFOeEd5QUVRWGh4YWlJRUlBUWdBVXNiRUVzZ0FCQUVEd3NnQkF2MEJBRUpmeU1BUVRCcklnUWtBQUpBQW44Z0FnUkFJQVJCS0dvaENRTkFBa0FnQUNnQ0NDMEFBRVVOQUNBQUtBSUFRY2lOd0FCQkJDQUFLQUlFS0FJTUVRRUFSUTBBUVFFTUF3c2dCRUVLTmdJb0lBUkNpb0NBZ0JBM0F5QWdCQ0FDTmdJY1FRQWhCU0FFUVFBMkFoZ2dCQ0FDTmdJVUlBUWdBVFlDRUVFQklRY2dBU0VHSUFJaUF5RUlBbjhDUUFKQUEwQWdCU0FHYWlFR0lBUWdCMnBCSjJvdEFBQWhDZ0pBQWtBQ1FDQURRUWROQkVBZ0EwVU5BU0FJSUFWcklRdEJBQ0VEQTBBZ0F5QUdhaTBBQUNBS1JnMEVJQXNnQTBFQmFpSURSdzBBQ3d3QkN5QUVRUWhxSUFvZ0JpQURFQlFnQkNnQ0NFRUJSZzBCSUFRb0Fod2hDQXNnQkNBSU5nSVlEQVFMSUFRb0Fnd2hBeUFFS0FJa0lRY2dCQ2dDR0NFRkN5QUVJQU1nQldwQkFXb2lCVFlDR0FKQUFrQWdCU0FIU1FSQUlBUW9BaFFoQXd3QkN5QUVLQUlVSWdNZ0JVa05BQ0FIUVFWUERRTWdCU0FIYXlJR0lBUW9BaEJxSWdnZ0NVWU5BU0FJSUFrZ0J4QkVSUTBCQ3lBRUtBSWNJZ2dnQlVrZ0F5QUlTWElOQXlBSUlBVnJJUU1nQkNnQ0VDRUdEQUVMQ3lBQUtBSUlRUUU2QUFBZ0JrRUJhZ3dDQ3lBSFFRUkJzSkxBQUJBM0FBc2dBQ2dDQ0VFQU9nQUFJQUlMSVFNZ0FDZ0NCQ0VHSUFBb0FnQWhCUUpBQWtBZ0EwVWdBaUFEUm5KRkJFQWdBaUFEU3dSQUlBRWdBMm9pQnl3QUFFRy9mMG9OQWdzZ0FTQUNRUUFnQTBITWpjQUFFQU1BQ3lBRklBRWdBeUFHS0FJTUVRRUFSUTBCUVFFTUJBdEJBU0FGSUFFZ0F5QUdLQUlNRVFFQURRTWFJQWNzQUFCQnYzOU1EUVFMSUFFZ0Eyb2hBU0FDSUFOcklnSU5BQXNMUVFBTElBUkJNR29rQUE4TElBRWdBaUFESUFKQjNJM0FBQkFEQUF1NkF3RUVmeU1BUVJCcklnSWtBQ0FBS0FJQUlRUUNRQUpBQWtBQ2Z3SkFBa0FnQVVHQUFVOEVRQ0FDUVFBMkFnd2dBVUdBRUVrTkFTQUNRUXhxSVFBZ0FVR0FnQVJKQkVBZ0FpQUJRVDl4UVlBQmNqb0FEaUFDSUFGQkRIWkI0QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUExQkF5RUJEQVlMSUFJZ0FVRS9jVUdBQVhJNkFBOGdBaUFCUVJKMlFmQUJjam9BRENBQ0lBRkJCblpCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0UvY1VHQUFYSTZBQTFCQkNFQkRBVUxJQVFvQWdnaUFDQUVRUVJxS0FJQVJ3UkFJQVFvQWdBaEJRd0VDd0pBSUFCQkFXb2lBeUFBU1EwQUlBQkJBWFFpQlNBRElBVWdBMHNiSWdOQkNDQURRUWhMR3lFRElBQUVRQ0FEUVFCSURRRWdCQ2dDQUNJRlJRMERJQVVnQUVFQklBTVFWUXdFQ3lBRFFRQk9EUUlMRUYwQUN5QUNJQUZCUDNGQmdBRnlPZ0FOSUFJZ0FVRUdka0hBQVhJNkFBd2dBa0VNYWlFQVFRSWhBUXdEQ3lBRFFRRVFXUXNpQlFSQUlBUWdCVFlDQUNBRVFRUnFJQU0yQWdBZ0JDZ0NDQ0VBREFFTElBTkJBUkJqQUFzZ0FDQUZhaUFCT2dBQUlBUWdCQ2dDQ0VFQmFqWUNDQXdCQ3lBRUlBQWdBQ0FCYWhBZkN5QUNRUkJxSkFCQkFBdTBBd0VFZnlBQVFRQTJBZ2dnQUVFVWFrRUFOZ0lBSUFGQkQzRWhCQ0FBUVF4cUlRSkJBQ0VCQTBBZ0FDZ0NCQ0FCUmdSQUlBQWdBUkE4SUFBb0FnZ2hBUXNnQUNnQ0FDQUJRUUowYWlJQklBTTZBQUlnQVVFQU93RUFJQUFnQUNnQ0NFRUJhallDQ0NBQUtBSVVJZ0VnQUNnQ0VFWUVRQ0FDSUFFUU95QUFLQUlVSVFFTElBQW9BZ3dnQVVFQmRHcEJBVHNCQUNBQUlBQW9BaFJCQVdvMkFoUWdBQ2dDQ0NFQklBTkJBV29pQlNFRElBVkIvLzhEY1NBRWRrVU5BQXNnQUNnQ0JDQUJSZ1JBSUFBZ0FSQThJQUFvQWdnaEFRc2dBQ2dDQUNBQlFRSjBhaUlCUVFBNkFBSWdBVUVBT3dFQUlBQWdBQ2dDQ0VFQmFqWUNDQ0FBS0FJVUlnRWdBQ2dDRUVZRVFDQUNJQUVRT3lBQUtBSVVJUUVMSUFBb0Fnd2dBVUVCZEdwQkFEc0JBQ0FBSUFBb0FoUkJBV28yQWhRZ0FDZ0NDQ0lCSUFBb0FnUkdCRUFnQUNBQkVEd2dBQ2dDQ0NFQkN5QUFLQUlBSUFGQkFuUnFJZ0ZCQURvQUFpQUJRUUE3QVFBZ0FDQUFLQUlJUVFGcU5nSUlJQUFvQWhRaUFTQUFLQUlRUmdSQUlBSWdBUkE3SUFBb0FoUWhBUXNnQUNnQ0RDQUJRUUYwYWtFQU93RUFJQUFnQUNnQ0ZFRUJhallDRkF2K0F3SURmd0YrSUFFb0FoaEJKeUFCUVJ4cUtBSUFLQUlRRVFBQVJRUkFRZlFBSVFOQkFpRUNBa0FDUUFKQUFrQUNRQUpBSUFBb0FnQWlBRUYzYWc0ZkJRRURBd0FEQXdNREF3TURBd01EQXdNREF3TURBd01EQXdRREF3TURCQUlMUWZJQUlRTU1CQXRCN2dBaEF3d0RDeUFBUWR3QVJnMEJDd0ovQW40Q1FDQUFFQTlGQkVBZ0FCQUhSUTBCUVFFTUF3c2dBRUVCY21kQkFuWkJCM090UW9DQWdJRFFBSVFNQVFzZ0FFRUJjbWRCQW5aQkIzT3RRb0NBZ0lEUUFJUUxJUVZCQXdzaEFpQUFJUU1NQVFzZ0FDRURDd05BSUFJaEJFSGNBQ0VBUVFFaEFnSkFBbjRDUUFKQUFrQUNRQ0FFUVFGckRnTUJCUUFDQ3dKQUFrQUNRQUpBSUFWQ0lJaW5RZjhCY1VFQmF3NEZBd0lCQUFZRkMwSDFBQ0VBSUFWQy8vLy8vNDlnZzBLQWdJQ0FNSVFNQmd0Qit3QWhBQ0FGUXYvLy8vK1BZSU5DZ0lDQWdDQ0VEQVVMUVRCQjF3QWdBeUFGcHlJRVFRSjBRUnh4ZGtFUGNTSUFRUXBKR3lBQWFpRUFJQVZDZjN4Qy8vLy8vdytESUFWQ2dJQ0FnSENEaENBRURRUWFJQVZDLy8vLy80OWdnMEtBZ0lDQUVJUU1CQXRCL1FBaEFDQUZRdi8vLy8rUFlJTU1Bd3RCQUNFQ0lBTWhBQXdEQ3lBQktBSVlRU2NnQVNnQ0hDZ0NFQkVBQUE4TElBVkMvLy8vLzQ5Z2cwS0FnSUNBd0FDRUN5RUZRUU1oQWdzZ0FTZ0NHQ0FBSUFFb0Fod29BaEFSQUFCRkRRQUxDMEVCQzZBREFRVi9Ba0FDUUVFQVFROGdBRUdrbWdSSkd5SUJJQUZCQ0dvaUFTQUJRUUowUVppZ3dBQnFLQUlBUVF0MElBQkJDM1FpQWtzYklnRWdBVUVFYWlJQklBRkJBblJCbUtEQUFHb29BZ0JCQzNRZ0Frc2JJZ0VnQVVFQ2FpSUJJQUZCQW5SQm1LREFBR29vQWdCQkMzUWdBa3NiSWdFZ0FVRUJhaUlCSUFGQkFuUkJtS0RBQUdvb0FnQkJDM1FnQWtzYklnTkJBblJCbUtEQUFHb29BZ0JCQzNRaUFTQUNSaUFCSUFKSmFpQURhaUlDUVI1TkJFQkJzUVVoQkNBQ1FSNUhCRUFnQWtFQ2RFR2NvTUFBYWlnQ0FFRVZkaUVFQzBFQUlRRWdBa0YvYWlJRElBSk5CRUFnQTBFZlR3MERJQU5CQW5SQm1LREFBR29vQWdCQi8vLy9BSEVoQVFzQ1FDQUVJQUpCQW5SQm1LREFBR29vQWdCQkZYWWlBMEVCYWtZTkFDQUFJQUZySVFJZ0EwR3hCU0FEUWJFRlN4c2hCU0FFUVg5cUlRRkJBQ0VBQTBBZ0F5QUZSZzBESUFBZ0EwR1VvY0FBYWkwQUFHb2lBQ0FDU3cwQklBRWdBMEVCYWlJRFJ3MEFDeUFCSVFNTElBTkJBWEVQQ3lBQ1FSOUIySi9BQUJBMkFBc2dCVUd4QlVIb244QUFFRFlBQ3lBRFFSOUIrSi9BQUJBMkFBdm9BZ0VGZndKQVFjMy9leUFBUVJBZ0FFRVFTeHNpQUdzZ0FVME5BQ0FBUVJBZ0FVRUxha0Y0Y1NBQlFRdEpHeUlFYWtFTWFoQUFJZ0pGRFFBZ0FrRjRhaUVCQWtBZ0FFRi9haUlESUFKeFJRUkFJQUVoQUF3QkN5QUNRWHhxSWdVb0FnQWlCa0Y0Y1NBQ0lBTnFRUUFnQUd0eFFYaHFJZ0lnQUNBQ2FpQUNJQUZyUVJCTEd5SUFJQUZySWdKcklRTWdCa0VEY1FSQUlBQWdBeUFBS0FJRVFRRnhja0VDY2pZQ0JDQUFJQU5xSWdNZ0F5Z0NCRUVCY2pZQ0JDQUZJQUlnQlNnQ0FFRUJjWEpCQW5JMkFnQWdBQ0FBS0FJRVFRRnlOZ0lFSUFFZ0FoQUdEQUVMSUFFb0FnQWhBU0FBSUFNMkFnUWdBQ0FCSUFKcU5nSUFDd0pBSUFCQkJHb29BZ0FpQVVFRGNVVU5BQ0FCUVhoeElnSWdCRUVRYWswTkFDQUFRUVJxSUFRZ0FVRUJjWEpCQW5JMkFnQWdBQ0FFYWlJQklBSWdCR3NpQkVFRGNqWUNCQ0FBSUFKcUlnSWdBaWdDQkVFQmNqWUNCQ0FCSUFRUUJnc2dBRUVJYWlFREN5QURDNFVEQVFSL0FrQUNRQ0FCUVlBQ1R3UkFJQUJCR0dvb0FnQWhCQUpBQWtBZ0FDQUFLQUlNSWdKR0JFQWdBRUVVUVJBZ0FFRVVhaUlDS0FJQUlnTWJhaWdDQUNJQkRRRkJBQ0VDREFJTElBQW9BZ2dpQVNBQ05nSU1JQUlnQVRZQ0NBd0JDeUFDSUFCQkVHb2dBeHNoQXdOQUlBTWhCU0FCSWdKQkZHb2lBeWdDQUNJQlJRUkFJQUpCRUdvaEF5QUNLQUlRSVFFTElBRU5BQXNnQlVFQU5nSUFDeUFFUlEwQ0lBQWdBRUVjYWlnQ0FFRUNkRUdjcWNBQWFpSUJLQUlBUndSQUlBUkJFRUVVSUFRb0FoQWdBRVliYWlBQ05nSUFJQUpGRFFNTUFnc2dBU0FDTmdJQUlBSU5BVUdRcDhBQVFaQ253QUFvQWdCQmZpQUFLQUljZDNFMkFnQVBDeUFBUVF4cUtBSUFJZ0lnQUVFSWFpZ0NBQ0lBUndSQUlBQWdBallDRENBQ0lBQTJBZ2dQQzBHTXA4QUFRWXlud0FBb0FnQkJmaUFCUVFOMmQzRTJBZ0FNQVFzZ0FpQUVOZ0lZSUFBb0FoQWlBUVJBSUFJZ0FUWUNFQ0FCSUFJMkFoZ0xJQUJCRkdvb0FnQWlBRVVOQUNBQ1FSUnFJQUEyQWdBZ0FDQUNOZ0lZQ3d1akF3SUVmd0orSXdCQlFHb2lBaVFBUVFFaEJBSkFJQUF0QUFRTkFDQUFMUUFGSVFVZ0FDZ0NBQ0lETFFBQVFRUnhSUVJBSUFNb0FoaEI4WTNBQUVIempjQUFJQVViUVFKQkF5QUZHeUFEUVJ4cUtBSUFLQUlNRVFFQURRRWdBQ2dDQUNJREtBSVlRYzZtd0FCQkJ5QURRUnhxS0FJQUtBSU1FUUVBRFFFZ0FDZ0NBQ0lES0FJWVFhZU13QUJCQWlBRFFSeHFLQUlBS0FJTUVRRUFEUUVnQVNBQUtBSUFRWlNnd0FBb0FnQVJBQUFoQkF3QkN5QUZSUVJBSUFNb0FoaEI3STNBQUVFRElBTkJIR29vQWdBb0Fnd1JBUUFOQVNBQUtBSUFJUU1MSUFKQkFUb0FGeUFDUVRScVFiQ053QUEyQWdBZ0FpQURLUUlZTndNSUlBSWdBa0VYYWpZQ0VDQURLUUlJSVFZZ0F5a0NFQ0VISUFJZ0F5MEFJRG9BT0NBQ0lBYzNBeWdnQWlBR053TWdJQUlnQXlrQ0FEY0RHQ0FDSUFKQkNHbzJBakFnQWtFSWFrSE9wc0FBUVFjUUN3MEFJQUpCQ0dwQnA0ekFBRUVDRUFzTkFDQUJJQUpCR0dwQmxLREFBQ2dDQUJFQUFBMEFJQUlvQWpCQjc0M0FBRUVDSUFJb0FqUW9BZ3dSQVFBaEJBc2dBRUVCT2dBRklBQWdCRG9BQkNBQ1FVQnJKQUFMNWdJQ0JuOEJmaU1BUVRCcklnUWtBQ0FFUVJCcUVDb2dCQ0FFS0FJVUlnVTJBaHdnQkNBRUtBSVFJZ1kyQWhnZ0JFRUlhaUFEUVFBUVFDQUVLUU1JSVFvZ0FFRUFOZ0lJSUFBZ0NqY0NBQUpBQWtBZ0F3UkFRUUFoQmtFQUlRVURRQ0FBSUFWQmdDQVFPaUFBSUFNZ0FDZ0NCQ0lISUFjZ0Ewc2JFRThnQmlBQ1N3MENJQUFvQWdBaENDQUFLQUlJSWdjZ0JVa05BeUFFUVNCcUlBUkJHR29pQ1NnQ0FDQUJJQVpxSUFJZ0Jtc2dCU0FJYWlBSElBVnJJQWtvQWdRb0Fnd1JDQUFnQkNnQ0pDQUZhaUVISUFRb0FpQWhDQ0FBS0FJSUlnVWdCMDhFUUNBQUtBSUFHaUFBSUFjMkFnZ2dCeUVGQ3lBRUxRQW9RUUpIQkVBZ0JpQUlhaUVHSUFVZ0Ewa05BUXNMSUFRb0FoZ2hCaUFFS0FJY0lRVUxJQVlnQlNnQ0FCRURBQ0FFS0FJY0lnQW9BZ2dhSUFRb0FoZ2hBU0FBS0FJRUJFQWdBUkFFQ3lBRVFUQnFKQUFQQ3lBR0lBSkJ5SUhBQUJBNUFBc2dCU0FIUWRpQndBQVFPUUFMMkFJQkJYOENRQUpBQWtBQ1FBSkFJQUpCQTJwQmZIRWdBbXNpQkVVTkFDQURJQVFnQkNBRFN4c2lCVVVOQUVFQUlRUWdBVUgvQVhFaEJnSkFBMEFnQWlBRWFpMEFBQ0FHUmcwQklBVWdCRUVCYWlJRVJ3MEFDeUFGSUFOQmVHb2lCRTBOQWd3REMwRUJJUWNNQXdzZ0EwRjRhaUVFUVFBaEJRc2dBVUgvQVhGQmdZS0VDR3doQmdOQUlBSWdCV29pQjBFRWFpZ0NBQ0FHY3lJSVFYOXpJQWhCLy8zN2QycHhJQWNvQWdBZ0JuTWlCMEYvY3lBSFFmLzkrM2RxY1hKQmdJR0NoSGh4UlFSQUlBVkJDR29pQlNBRVRRMEJDd3NnQlNBRFN3MENDMEVBSVFZQ2YwRUFJQU1nQlVZTkFCb2dBaUFGYWlFQ0lBTWdCV3NoQmtFQUlRUWdBVUgvQVhFaEFRSkFBMEFnQWlBRWFpMEFBQ0FCUmcwQklBWWdCRUVCYWlJRVJ3MEFDMEVBREFFTElBUWhCa0VCQ3lFSElBVWdCbW9oQkFzZ0FDQUVOZ0lFSUFBZ0J6WUNBQThMSUFVZ0EwSG9rTUFBRURrQUM3NENBZ1YvQVg0akFFRXdheUlFSkFCQkp5RUNBa0FnQUVLUXpnQlVCRUFnQUNFSERBRUxBMEFnQkVFSmFpQUNhaUlEUVh4cUlBQWdBRUtRemdDQUlnZENrTTRBZm4ybklnVkIvLzhEY1VIa0FHNGlCa0VCZEVHbWpzQUFhaThBQURzQUFDQURRWDVxSUFVZ0JrSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBZ0FrRjhhaUVDSUFCQy84SFhMMVlnQnlFQURRQUxDeUFIcHlJRFFlTUFTZ1JBSUFKQmZtb2lBaUFFUVFscWFpQUhweUlESUFOQi8vOERjVUhrQUc0aUEwSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBTEFrQWdBMEVLVGdSQUlBSkJmbW9pQWlBRVFRbHFhaUFEUVFGMFFhYU93QUJxTHdBQU93QUFEQUVMSUFKQmYyb2lBaUFFUVFscWFpQURRVEJxT2dBQUN5QUJRZkNMd0FCQkFDQUVRUWxxSUFKcVFTY2dBbXNRQ0NBRVFUQnFKQUFMb3dJQ0JIOEJmaU1BUVVCcUlnUWtBQUpBQWtBQ1FDQUNJQU5xSWdNZ0FrOEVRQ0FCS0FJRUlRVWdCRUVZYWtLQmdJQ0FFRGNEQUNBRUtBSWNJZ0pCZjJvaUJpQUVLQUlZYWtFQUlBSnJJZ2R4clNBRlFRRjBJZ1VnQXlBRklBTkxHeUlEUVFnZ0EwRUlTeHV0ZmlJSVFpQ0lweUFDUlhJTkFTQUNhVUVCUmdSQUlBaW5JQVpxSUFkeElRTU1Bd3NnQkVFd2FoQXdBQXNnQkVFSWFpQURRUUFRV2lBQUlBUXBBd2czQWdSQkFTRUNEQUlMUVFBaEFnc2dCRUV3YWlBQkVFMGdCRUVnYWlBRElBSWdCRUV3YWhBbFFRRWhBaUFFUVNocUtBSUFJUU1nQkNnQ0pDRUZJQVFvQWlCQkFVY0VRQ0FCSUFVZ0F4QmFRUUFoQWd3QkN5QUVRUkJxSUFVZ0F4QmFJQUFnQkNrREVEY0NCQXNnQUNBQ05nSUFJQVJCUUdza0FBdXVBZ0VJZnlNQVFUQnJJZ0VrQUVHQUlDRUNJQUZCR0dvUUx5QUJLQUljSVFRZ0FTZ0NHQ0VGSUFGQkVHb1FNaUFCS0FJVUlRWWdBU2dDRUNFSElBRkJDR3BCZ0NCQkFSQkFJQUZCZ0NBMkFpZ2dBU0FCS0FJTUlnZzJBaVFnQVNBQktBSUlJZ00yQWlBZ0NFR0JJRThFUUNBQlFTQnFRWUFnRUVVZ0FTZ0NJQ0VESUFFb0FpZ2hBZ3NnQUVFQU93QkhJQUJCQURzQk9DQUFJQU0yQWlnZ0FDQUZOZ0lRSUFCQkNEb0FSaUFBUVFBNkFBc2dBRUlBTndNQUlBQkJNR3BDQURjREFDQUFRU3hxSUFJMkFnQWdBRUVrYWtFQU5nSUFJQUJCSUdvZ0JqWUNBQ0FBUVJ4cUlBYzJBZ0FnQUVFWWFrRUFOZ0lBSUFCQkZHb2dCRFlDQUNBQVFRazZBQW9nQUVHQUFqc0JRaUFBUVlFQ093RkVJQUJCZ2dJN0FVQWdBRUgvQXpzQkNDQUJRVEJxSkFBTHh3SUNCWDhCZmlNQVFSQnJJZ01rQUNBQUxRQUxJUUlnQTBJQU53TUlJQUVvQWdBaEJRSkFBa0FnQUFKL0lBRW9BZ1FpQkVIQUFDQUNheUlHUWZnQmNVRURkaUlDU1FSQUlBUkJDVThOQWlBRFFRaHFJQVVnQkJCTEdpQUJRUUEyQWdRZ0FVR0lnOEFBTmdJQUlBUkJBM1FNQVFzZ0JrSC9BWEZCeUFCUERRSWdBMEVJYWlBRklBSVFTeG9nQVNBRUlBSnJOZ0lFSUFFZ0FpQUZhallDQUNBR1FmZ0JjUXNnQUMwQUN5SUJham9BQ3lBQUlBQXBBd0FnQXlrRENDSUhRamlHSUFkQ0tJWkNnSUNBZ0lDQXdQOEFnNFFnQjBJWWhrS0FnSUNBZ09BL2d5QUhRZ2lHUW9DQWdJRHdINE9FaENBSFFnaUlRb0NBZ1BnUGd5QUhRaGlJUW9DQS9BZURoQ0FIUWlpSVFvRCtBNE1nQjBJNGlJU0VoQ0FCUVQ5eHJZaUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSFloY0FBRURjQUN5QUNRUWhCeUlYQUFCQTNBQXVxQWdFRGZ5TUFRWUFCYXlJRUpBQUNRQUpBQW44Q1FDQUJLQUlBSWdOQkVIRkZCRUFnQUNnQ0FDRUNJQU5CSUhFTkFTQUNyU0FCRUJVTUFnc2dBQ2dDQUNFQ1FRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFkY0FhaUFEUVFwSkd6b0FBQ0FBUVg5cUlRQWdBa0VFZGlJQ0RRQUxJQUJCZ0FGcUlnSkJnUUZQRFFJZ0FVR2tqc0FBUVFJZ0FDQUVha0dBQVdwQkFDQUFheEFJREFFTFFRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFUZHFJQU5CQ2trYk9nQUFJQUJCZjJvaEFDQUNRUVIySWdJTkFBc2dBRUdBQVdvaUFrR0JBVThOQWlBQlFhU093QUJCQWlBQUlBUnFRWUFCYWtFQUlBQnJFQWdMSUFSQmdBRnFKQUFQQ3lBQ1FZQUJRWlNPd0FBUU9RQUxJQUpCZ0FGQmxJN0FBQkE1QUF1eEFnRUVmeU1BUVVCcUlnSWtBQ0FCS0FJRUlnTkZCRUFnQVVFRWFpRURJQUVvQWdBaEJDQUNRUUEyQWlBZ0FrSUJOd01ZSUFJZ0FrRVlhallDSkNBQ1FUaHFJQVJCRUdvcEFnQTNBd0FnQWtFd2FpQUVRUWhxS1FJQU53TUFJQUlnQkNrQ0FEY0RLQ0FDUVNScVFkaUp3QUFnQWtFb2FoQUpHaUFDUVJCcUlnUWdBaWdDSURZQ0FDQUNJQUlwQXhnM0F3Z0NRQ0FCS0FJRUlnVkZEUUFnQVVFSWFpZ0NBRVVOQUNBRkVBUUxJQU1nQWlrRENEY0NBQ0FEUVFocUlBUW9BZ0EyQWdBZ0F5Z0NBQ0VEQ3lBQlFRRTJBZ1FnQVVFTWFpZ0NBQ0VFSUFGQkNHb2lBU2dDQUNFRklBRkNBRGNDQUVFTVFRUVFXU0lCUlFSQVFReEJCQkJqQUFzZ0FTQUVOZ0lJSUFFZ0JUWUNCQ0FCSUFNMkFnQWdBRUdRaThBQU5nSUVJQUFnQVRZQ0FDQUNRVUJySkFBTC9BRUJBbjhqQUVFUWF5SUNKQUFnQUNnQ0FDQUNRUUEyQWd3Q2Z3SkFBa0FnQVVHQUFVOEVRQ0FCUVlBUVNRMEJJQUpCREdvaEFDQUJRWUNBQkU4TkFpQUNJQUZCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0hnQVhJNkFBd2dBaUFCUVFaMlFUOXhRWUFCY2pvQURVRUREQU1MSUFJZ0FUb0FEQ0FDUVF4cUlRQkJBUXdDQ3lBQ0lBRkJQM0ZCZ0FGeU9nQU5JQUlnQVVFR2RrSEFBWEk2QUF3Z0FrRU1haUVBUVFJTUFRc2dBaUFCUVQ5eFFZQUJjam9BRHlBQ0lBRkJFblpCOEFGeU9nQU1JQUlnQVVFR2RrRS9jVUdBQVhJNkFBNGdBaUFCUVF4MlFUOXhRWUFCY2pvQURVRUVDeUVCSUFBZ0FSQUxJQUpCRUdva0FBdjVBUUVDZnlNQVFSQnJJZ0lrQUNBQ1FRQTJBZ3dDZndKQUFrQWdBVUdBQVU4RVFDQUJRWUFRU1EwQklBSkJER29oQXlBQlFZQ0FCRThOQWlBQ0lBRkJQM0ZCZ0FGeU9nQU9JQUlnQVVFTWRrSGdBWEk2QUF3Z0FpQUJRUVoyUVQ5eFFZQUJjam9BRFVFRERBTUxJQUlnQVRvQURDQUNRUXhxSVFOQkFRd0NDeUFDSUFGQlAzRkJnQUZ5T2dBTklBSWdBVUVHZGtIQUFYSTZBQXdnQWtFTWFpRURRUUlNQVFzZ0FpQUJRVDl4UVlBQmNqb0FEeUFDSUFGQkVuWkI4QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUE0Z0FpQUJRUXgyUVQ5eFFZQUJjam9BRFVFRUN5RUJJQUFnQXlBQkVBc2dBa0VRYWlRQUMvd0JBUU4vSXdCQklHc2lCQ1FBQWtBZ0FrRUJhaUlESUFKUEJFQWdBU2dDQkNJQ1FRRjBJZ1VnQXlBRklBTkxHeUlEUVFRZ0EwRUVTeHNpQTBILy8vLy9BM0VnQTBaQkFYUWhCU0FEUVFKMElRTUNRQ0FDQkVBZ0JFRVlha0VDTmdJQUlBUWdBa0VDZERZQ0ZDQUVJQUVvQWdBMkFoQU1BUXNnQkVFQU5nSVFDeUFFSUFNZ0JTQUVRUkJxRUNWQkFTRUNJQVJCQ0dvb0FnQWhBeUFFS0FJRUlRVWdCQ2dDQUVFQlJ3UkFJQUVnQlRZQ0FDQUJJQU5CQW5ZMkFnUkJBQ0VDREFJTElBQWdCVFlDQkNBQVFRaHFJQU0yQWdBTUFRc2dBQ0FETmdJRUlBQkJDR3BCQURZQ0FFRUJJUUlMSUFBZ0FqWUNBQ0FFUVNCcUpBQUw4QUVCQkg4akFFRWdheUlFSkFBQ1FDQUNRUUZxSWdNZ0FrOEVRQ0FCS0FJRUlnVkJBWFFpQWlBRElBSWdBMHNiSWdOQkJDQURRUVJMR3lJRElBTnFJZ1lnQTA5QkFYUWhBd0pBSUFVRVFDQUVRUmhxUVFJMkFnQWdCQ0FDTmdJVUlBUWdBU2dDQURZQ0VBd0JDeUFFUVFBMkFoQUxJQVFnQmlBRElBUkJFR29RSlVFQklRSWdCRUVJYWlnQ0FDRURJQVFvQWdRaEJTQUVLQUlBUVFGSEJFQWdBU0FGTmdJQUlBRWdBMEVCZGpZQ0JFRUFJUUlNQWdzZ0FDQUZOZ0lFSUFCQkNHb2dBellDQUF3QkN5QUFJQU0yQWdRZ0FFRUlha0VBTmdJQVFRRWhBZ3NnQUNBQ05nSUFJQVJCSUdva0FBdlpBUUVEZndKQUlBQkJCR29vQWdBaUJDQUFRUWhxS0FJQUlnTnJJQUlnQVdzaUJVOEVRQ0FBS0FJQUlRUU1BUXNDZndKQUFrQWdBeUFGYWlJQ0lBTkpEUUFnQkVFQmRDSURJQUlnQXlBQ1N4c2lBa0VJSUFKQkNFc2JJUUlnQkFSQUlBSkJBRWdOQVNBQUtBSUFJZ05GRFFJZ0F5QUVRUUVnQWhCVkRBTUxJQUpCQUU0TkFRc1FYUUFMSUFKQkFSQlpDeUlFQkVBZ0FDQUVOZ0lBSUFCQkJHb2dBallDQUNBQVFRaHFLQUlBSVFNTUFRc2dBa0VCRUdNQUN5QURJQVJxSUFFZ0JSQkxHaUFBUVFocUlnQWdBQ2dDQUNBRmFqWUNBQXZvQVFFRmZ5TUFRUkJySWdNa0FDQUFMUUFMSVFJZ0EwSUFOd01JSUFFb0FnQWhCUUpBQWtBZ0FBSi9JQUVvQWdRaUJFSEFBQ0FDYXlJR1FmZ0JjVUVEZGlJQ1NRUkFJQVJCQ1U4TkFpQURRUWhxSUFVZ0JCQkxHaUFCUVFBMkFnUWdBVUdJZzhBQU5nSUFJQVJCQTNRTUFRc2dCa0gvQVhGQnlBQlBEUUlnQTBFSWFpQUZJQUlRU3hvZ0FTQUVJQUpyTmdJRUlBRWdBaUFGYWpZQ0FDQUdRZmdCY1FzZ0FDMEFDeUlCYWpvQUN5QUFJQUFwQXdBZ0F5a0RDQ0FCUVQ5eHJZYUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSDRoY0FBRURjQUN5QUNRUWhCNklYQUFCQTNBQXZjQVFFRWZ5TUFRVUJxSWdJa0FDQUJRUVJxSVFRZ0FTZ0NCRVVFUUNBQktBSUFJUU1nQWtFQU5nSWdJQUpDQVRjREdDQUNJQUpCR0dvMkFpUWdBa0U0YWlBRFFSQnFLUUlBTndNQUlBSkJNR29nQTBFSWFpa0NBRGNEQUNBQ0lBTXBBZ0EzQXlnZ0FrRWtha0hZaWNBQUlBSkJLR29RQ1JvZ0FrRVFhaUlESUFJb0FpQTJBZ0FnQWlBQ0tRTVlOd01JQWtBZ0FTZ0NCQ0lGUlEwQUlBRkJDR29vQWdCRkRRQWdCUkFFQ3lBRUlBSXBBd2czQWdBZ0JFRUlhaUFES0FJQU5nSUFDeUFBUVpDTHdBQTJBZ1FnQUNBRU5nSUFJQUpCUUdza0FBdVlBZ0VDZnlNQVFTQnJJZ1FrQUVFQklRVkJpS2ZBQUVHSXA4QUFLQUlBUVFGcU5nSUFBa0FDUUFKQVFkQ3F3QUFvQWdCQkFVY0VRRUhRcXNBQVFvR0FnSUFRTndNQURBRUxRZFNxd0FCQjFLckFBQ2dDQUVFQmFpSUZOZ0lBSUFWQkFrc05BUXNnQkNBRE5nSWNJQVFnQWpZQ0dDQUVRZkNKd0FBMkFoUWdCRUh3aWNBQU5nSVFRZnltd0FBb0FnQWlBa0YvVEEwQVFmeW13QUFnQWtFQmFpSUNOZ0lBUWZ5bXdBQkJoS2ZBQUNnQ0FDSURCSDlCZ0tmQUFDZ0NBQ0FFUVFocUlBQWdBU2dDRUJFQ0FDQUVJQVFwQXdnM0F4QWdCRUVRYWlBREtBSU1FUUlBUWZ5bXdBQW9BZ0FGSUFJTFFYOXFOZ0lBSUFWQkFVME5BUXNBQ3lNQVFSQnJJZ0lrQUNBQ0lBRTJBZ3dnQWlBQU5nSUlBQXZNQVFFQ2Z5QUJRUlJxS0FJQUlnVWdBMEgvL3dOeElnUkxCRUFnQVNnQ0RDQUVRUUYwYWk4QkFDRUZJQUVvQWdnaUJDQUJLQUlFUmdSQUlBRWdCQkE4SUFFb0FnZ2hCQXNnQVNnQ0FDQUVRUUowYWlJRUlBSTZBQUlnQkNBRE93RUFJQUVnQVNnQ0NFRUJhallDQ0NBQktBSVVJZ1FnQVVFUWFpZ0NBRVlFUUNBQlFReHFJQVFRT3lBQktBSVVJUVFMSUFFb0Fnd2dCRUVCZEdvZ0JVRUJhanNCQUNBQklBRW9BaFJCQVdvMkFoUWdBQ0FDT2dBQ0lBQWdBenNCQUE4TElBUWdCVUg0aHNBQUVEWUFDOFFCQVFKL0l3QkJFR3NpQWlRQUlBSWdBYTFDZ0lDQWdCQkNBQ0FCS0FJWVFjV213QUJCQ1NBQlFSeHFLQUlBS0FJTUVRRUFHNFEzQXdBZ0FpQUFOZ0lNSUFJZ0FrRU1haEFTSUFJdEFBUWhBU0FDTFFBRkJFQWdBVUgvQVhFaEFDQUNBbjlCQVNBQURRQWFJQUlvQWdBaUFFRWNhaWdDQUNnQ0RDRUJJQUFvQWhnaEF5QUFMUUFBUVFSeFJRUkFJQU5COTQzQUFFRUNJQUVSQVFBTUFRc2dBMEgyamNBQVFRRWdBUkVCQUFzaUFUb0FCQXNnQWtFUWFpUUFJQUZCL3dGeFFRQkhDNm9CQVFKL0FrQUNRQUpBSUFJRVFFRUJJUVFnQVVFQVRnMEJEQUlMSUFBZ0FUWUNCRUVCSVFRTUFRc0NRQUpBQWtBQ1FBSkFJQU1vQWdBaUJVVUVRQ0FCUlEwQkRBTUxJQU1vQWdRaUF3MEJJQUVOQWdzZ0FpRUREQU1MSUFVZ0F5QUNJQUVRVlNJRFJRMEJEQUlMSUFFZ0FoQlpJZ01OQVFzZ0FDQUJOZ0lFSUFJaEFRd0NDeUFBSUFNMkFnUkJBQ0VFREFFTFFRQWhBUXNnQUNBRU5nSUFJQUJCQ0dvZ0FUWUNBQXVmQVFFRGZ5QUFRZ0EzQWdnQ1FDQUJRUlJxS0FJQUlnUWdBa0gvL3dOeElnTkxCRUFnQVNnQ0RDQURRUUYwYWk4QkFDRURJQUFvQWdRaEJDQUFRUUEyQWdRZ0FDZ0NBQ0VGSUFCQkFUWUNBQ0FFSUFOSkRRRWdBU0FDSUFVZ0F4QXBJQUFvQWdRRVFDQUFLQUlBRUFRTElBQWdBellDRENBQUlBUTJBZ1FnQUNBRk5nSUFEd3NnQXlBRVFiaUd3QUFRTmdBTElBTWdCRUhJaHNBQUVEY0FDNGNCQVFKL0l3QkJNR3NpQkNRQUlBUkJJR29pQlNBQ05nSUlJQVVnQWpZQ0JDQUZJQUUyQWdBZ0JFRUlhaUFFUVNCcUVFNGdCRUVRYWlBRUtBSUlJZ0VnQkNnQ0RDSUNJQU1RRXlBQ0JFQWdBUkFFQ3lBRVFTaHFJQVJCR0dvb0FnQTJBZ0FnQkNBRUtRTVFOd01nSUFRZ0JFRWdhaEJPSUFBZ0JDa0RBRGNEQUNBRVFUQnFKQUFMZ2dFQkJuOGpBRUVRYXlJREpBQWdBQ0FBS0FJSUlBRVFPaUFBS0FJQUlRVWdBQ2dDQ0NFQ0lBTkJDR3BCQVNBQkVGb2dBaUFGYWlFRUlBTW9BZ3dpQmlBREtBSUlJZ2RMQkVBZ0JDQUdJQWRyRUZJZ0JTQUNJQVpxSUFkcklnSnFJUVFMSUFBZ0FRUi9JQVJCQURvQUFDQUNRUUZxQlNBQ0N6WUNDQ0FEUVJCcUpBQUxqZ0VCQTM4Z0FDZ0NDQ0lFSUFGQi8vOERjU0lGU3dSQUlBTUVRQ0FBS0FJQUlRUWdBa0YvYWlFRklBRWhBQU5BSUFRZ0FFSC8vd054UVFKMGFpSUdMd0VBSVFBZ0F5QUZhaUFHTFFBQ09nQUFJQUFnQVNBQUlBRkIvLzhEY1VrYklRQWdBMEYvYWlJRERRQUxJQUl0QUFBUEMwRUFRUUJCbUlmQUFCQTJBQXNnQlVFQmFpQUVRWWlId0FBUU53QUxhQUVDZnlNQVFkQUFheUlDSkFBakFFRXdheUlCSkFBZ0FVRUlPZ0FQSUFGQk1Hb2tBQ0FDRUJkQjBBQkJDQkJaSWdFRVFDQUJJQUpCMEFBUVN4b2dBVUVCT2dCSUlBQkJwSVBBQURZQ0JDQUFJQUUyQWdBZ0FrSFFBR29rQUE4TFFkQUFRUWdRWXdBTGdBRUNBbjhCZmlBQkxRQUxJZ1FnQVMwQUNpSURTUVJBSUFFZ0FoQVlJQUV0QUFzaEJDQUJMUUFLSVFNTElBUWdBMEgvQVhGSkJIOUJBQVVnQVNBRUlBTnJPZ0FMSUFFZ0FTa0RBQ0FEcllraUJTQUJMd0VJSWdHdFFuK0ZRb0NBZklTRE53TUFJQUVnQmFkeElRTkJBUXNoQVNBQUlBTTdBUUlnQUNBQk93RUFDNklCQVFOL0l3QkJFR3NpQVNRQUlBQW9BZ0FpQWtFVWFpZ0NBQ0VEQWtBQ2Z3SkFBa0FnQWlnQ0JBNENBQUVEQ3lBRERRSkJBQ0VDUWZDSndBQU1BUXNnQXcwQklBSW9BZ0FpQXlnQ0JDRUNJQU1vQWdBTElRTWdBU0FDTmdJRUlBRWdBellDQUNBQlFmeUt3QUFnQUNnQ0JDZ0NDQ0FBS0FJSUVDSUFDeUFCUVFBMkFnUWdBU0FDTmdJQUlBRkI2SXJBQUNBQUtBSUVLQUlJSUFBb0FnZ1FJZ0FMZ1FFQkEzOGdBU2dDQkNJRElBSlBCRUFDUUNBRFJRMEFJQUVvQWdBaEJBSkFBa0FnQWtVRVFFRUJJUU1nQkJBRURBRUxJQVFnQTBFQklBSVFWU0lEUlEwQkN5QUJJQUkyQWdRZ0FTQUROZ0lBREFFTElBQWdBallDQkNBQVFRaHFRUUUyQWdCQkFTRUZDeUFBSUFVMkFnQVBDMEdVaU1BQVFTUkJ1SWpBQUJCSUFBdDFBZ0ovQVg0Z0FTMEFDeUlFSUFFdEFBb2lBMGtFUUNBQklBSVFJQ0FCTFFBTElRUWdBUzBBQ2lFREN5QUVJQU5CL3dGeFNRUi9RUUFGSUFFZ0JDQURhem9BQ3lBQklBRXBBd0FpQlNBRHJVSS9nNGczQXdBZ0FTOEJDQ0FGcDNFaEEwRUJDeUVCSUFBZ0F6c0JBaUFBSUFFN0FRQUxNQUVCZndKQUFrQkJnSUFCUVFJUVdTSUJEUUVNQUF0QmdJQUJRUUlRWXdBTElBQWdBVFlDQUNBQVFZQWdOZ0lFQzRZQkFRRi9Jd0JCUUdvaUFTUUFJQUZCS3pZQ0RDQUJRWUNCd0FBMkFnZ2dBVUdzZ2NBQU5nSVVJQUVnQURZQ0VDQUJRU3hxUVFJMkFnQWdBVUU4YWtFaE5nSUFJQUZDQWpjQ0hDQUJRYXlNd0FBMkFoZ2dBVUVkTmdJMElBRWdBVUV3YWpZQ0tDQUJJQUZCRUdvMkFqZ2dBU0FCUVFocU5nSXdJQUZCR0dwQjhJREFBQkJSQUF0eEFRTi9Jd0JCSUdzaUFpUUFBa0FnQUNBQkVCa05BQ0FCUVJ4cUtBSUFJUU1nQVNnQ0dDQUNRUnhxUVFBMkFnQWdBa0h3aThBQU5nSVlJQUpDQVRjQ0RDQUNRZlNMd0FBMkFnZ2dBeUFDUVFocUVBa05BQ0FBUVFScUlBRVFHU0FDUVNCcUpBQVBDeUFDUVNCcUpBQkJBUXN3QVFGL0FrQUNRRUdBd0FCQkFoQlpJZ0VOQVF3QUMwR0F3QUJCQWhCakFBc2dBQ0FCTmdJQUlBQkJnQ0EyQWdRTGV3RUNmd0pBQWtBZ0FDZ0NCQ0lCQkVBZ0FDZ0NEQ0lDSUFGUERRRWdBQ2dDQUNJQklBSnFJQUV0QUFBNkFBQWdBRUVBTmdJSUlBQWdBQ2dDREVFQmFqWUNEQ0FBS0FJRVJRMENJQUFvQWdBdEFBQVBDMEVBUVFCQmlJYkFBQkEyQUFzZ0FpQUJRWmlHd0FBUU5nQUxRUUJCQUVHb2hzQUFFRFlBQzJnQkFuOGdBQ0FBTFFCR0lnRkJBV29pQWpvQUNpQUFRUUVnQVVFUGNYUkJBbW9pQVRzQlFDQUFRWDhnQWtFUGNYUkJmM003QVFnZ0FFRVlhaWdDQUNBQlFmLy9BM0VpQVU4RVFDQUFJQUUyQWhnTElBQkJKR29vQWdBZ0FVOEVRQ0FBSUFFMkFpUUxDMUFCQVg4Z0FFRVVhaWdDQUNJQlJTQUJRUUowUlhKRkJFQWdBQ2dDRUJBRUN5QUFRU0JxS0FJQUlnRkZJQUZCQVhSRmNrVUVRQ0FBS0FJY0VBUUxJQUJCTEdvb0FnQUVRQ0FBS0FJb0VBUUxDMndCQVg4akFFRXdheUlESkFBZ0F5QUJOZ0lFSUFNZ0FEWUNBQ0FEUVJ4cVFRSTJBZ0FnQTBFc2FrRWNOZ0lBSUFOQ0FqY0NEQ0FEUVlDTndBQTJBZ2dnQTBFY05nSWtJQU1nQTBFZ2FqWUNHQ0FESUFNMkFpZ2dBeUFEUVFScU5nSWdJQU5CQ0dvZ0FoQlJBQXRzQVFGL0l3QkJNR3NpQXlRQUlBTWdBVFlDQkNBRElBQTJBZ0FnQTBFY2FrRUNOZ0lBSUFOQkxHcEJIRFlDQUNBRFFnSTNBZ3dnQTBITWtjQUFOZ0lJSUFOQkhEWUNKQ0FESUFOQklHbzJBaGdnQXlBRFFRUnFOZ0lvSUFNZ0F6WUNJQ0FEUVFocUlBSVFVUUFMYkFFQmZ5TUFRVEJySWdNa0FDQURJQUUyQWdRZ0F5QUFOZ0lBSUFOQkhHcEJBallDQUNBRFFTeHFRUncyQWdBZ0EwSUNOd0lNSUFOQmdKTEFBRFlDQ0NBRFFSdzJBaVFnQXlBRFFTQnFOZ0lZSUFNZ0EwRUVhallDS0NBRElBTTJBaUFnQTBFSWFpQUNFRkVBQzJ3QkFYOGpBRUV3YXlJREpBQWdBeUFCTmdJRUlBTWdBRFlDQUNBRFFSeHFRUUkyQWdBZ0EwRXNha0VjTmdJQUlBTkNBamNDRENBRFFheVJ3QUEyQWdnZ0EwRWNOZ0lrSUFNZ0EwRWdhallDR0NBRElBTkJCR28yQWlnZ0F5QUROZ0lnSUFOQkNHb2dBaEJSQUF0Y0FRRi9Jd0JCRUdzaUF5UUFBa0FnQUNnQ0JDQUJheUFDVHdSQUlBTkJBRFlDQUF3QkN5QURJQUFnQVNBQ0VCWWdBeWdDQUVFQlJ3MEFJQU5CQ0dvb0FnQWlBQVJBSUFNb0FnUWdBQkJqQUFzUVhRQUxJQU5CRUdva0FBdGFBUUYvSXdCQkVHc2lBaVFBQWtBZ0FDZ0NCQ0FCYTBFQlR3UkFJQUpCQURZQ0FBd0JDeUFDSUFBZ0FSQWVJQUlvQWdCQkFVY05BQ0FDUVFocUtBSUFJZ0FFUUNBQ0tBSUVJQUFRWXdBTEVGMEFDeUFDUVJCcUpBQUxXZ0VCZnlNQVFSQnJJZ0lrQUFKQUlBQW9BZ1FnQVd0QkFVOEVRQ0FDUVFBMkFnQU1BUXNnQWlBQUlBRVFIU0FDS0FJQVFRRkhEUUFnQWtFSWFpZ0NBQ0lBQkVBZ0FpZ0NCQ0FBRUdNQUN4QmRBQXNnQWtFUWFpUUFDMWtCQVg4akFFRWdheUlDSkFBZ0FpQUFLQUlBTmdJRUlBSkJHR29nQVVFUWFpa0NBRGNEQUNBQ1FSQnFJQUZCQ0dvcEFnQTNBd0FnQWlBQktRSUFOd01JSUFKQkJHcEIySW5BQUNBQ1FRaHFFQWtnQWtFZ2FpUUFDMFlBQWtCQkNDQUNTUVJBQW45QkNDQUNTUVJBSUFJZ0F4QVFEQUVMSUFNUUFBc2lBZzBCUVFBUEN5QUFJQU1RQ2c4TElBSWdBQ0FESUFFZ0FTQURTeHNRU3lBQUVBUUxXUUVCZnlNQVFTQnJJZ0lrQUNBQ0lBQW9BZ0EyQWdRZ0FrRVlhaUFCUVJCcUtRSUFOd01BSUFKQkVHb2dBVUVJYWlrQ0FEY0RBQ0FDSUFFcEFnQTNBd2dnQWtFRWFrSHdqOEFBSUFKQkNHb1FDU0FDUVNCcUpBQUxXUUFDUUFKQUFrQWdBVUYvU2dSQUFrQWdBZ1JBSUFFTkFRd0VDeUFCUlEwRElBRkJBUkJaSWdJTkJBd0NDeUFCRUVjaUFrVU5BUXdEQ3hCZEFBc2dBVUVCRUdNQUMwRUJJUUlMSUFBZ0FUWUNCQ0FBSUFJMkFnQUxWZ0VCZnlNQVFTQnJJZ0lrQUNBQ0lBQTJBZ1FnQWtFWWFpQUJRUkJxS1FJQU53TUFJQUpCRUdvZ0FVRUlhaWtDQURjREFDQUNJQUVwQWdBM0F3Z2dBa0VFYWtId2o4QUFJQUpCQ0dvUUNTQUNRU0JxSkFBTFdRRURmd0pBSUFFb0Fnd2lBaUFCS0FJSUlnTlBCRUFnQVNnQ0JDSUVJQUpKRFFFZ0FTZ0NBQ0VCSUFBZ0FpQURhellDQkNBQUlBRWdBMm8yQWdBUEN5QURJQUpCMkliQUFCQTRBQXNnQWlBRVFkaUd3QUFRTndBTFZRRUJmeUFBUVJCcUlBQXRBRVlRRFNBQVFRQTZBRWNnQUVFQU93RTRJQUJCTUdwQ0FEY0RBQ0FBUVFBNkFBc2dBRUlBTndNQUlBQWdBQzBBUmtFQmFpSUJPZ0FLSUFCQmZ5QUJRUTl4ZEVGL2N6c0JDQXREQVFOL0FrQWdBa1VOQUFOQUlBQXRBQUFpQkNBQkxRQUFJZ1ZHQkVBZ0FFRUJhaUVBSUFGQkFXb2hBU0FDUVg5cUlnSU5BUXdDQ3dzZ0JDQUZheUVEQ3lBREMwVUJBWDhqQUVFUWF5SUNKQUFnQWlBQUlBRVFMUUpBSUFJb0FnQkJBVVlFUUNBQ1FRaHFLQUlBSWdCRkRRRWdBaWdDQkNBQUVHTUFDeUFDUVJCcUpBQVBDeEJkQUF0S0FBSi9JQUZCZ0lERUFFY0VRRUVCSUFBb0FoZ2dBU0FBUVJ4cUtBSUFLQUlRRVFBQURRRWFDeUFDUlFSQVFRQVBDeUFBS0FJWUlBSWdBeUFBUVJ4cUtBSUFLQUlNRVFFQUN3c21BUUYvQWtBZ0FCQUFJZ0ZGRFFBZ0FVRjhhaTBBQUVFRGNVVU5BQ0FCSUFBUVVnc2dBUXRIQVFGL0l3QkJJR3NpQXlRQUlBTkJGR3BCQURZQ0FDQURRZkNMd0FBMkFoQWdBMElCTndJRUlBTWdBVFlDSENBRElBQTJBaGdnQXlBRFFSaHFOZ0lBSUFNZ0FoQlJBQXRFQVFKL0lBRW9BZ1FoQWlBQktBSUFJUU5CQ0VFRUVGa2lBVVVFUUVFSVFRUVFZd0FMSUFFZ0FqWUNCQ0FCSUFNMkFnQWdBRUdnaThBQU5nSUVJQUFnQVRZQ0FBdGJBUU4vSXdCQkVHc2lBU1FBSUFBb0Fnd2lBa1VFUUVHQWlzQUFRU3RCeUlyQUFCQklBQXNnQUNnQ0NDSURSUVJBUVlDS3dBQkJLMEhZaXNBQUVFZ0FDeUFCSUFJMkFnZ2dBU0FBTmdJRUlBRWdBellDQUNBQkVGQUFDek1CQVg4Z0FnUkFJQUFoQXdOQUlBTWdBUzBBQURvQUFDQUJRUUZxSVFFZ0EwRUJhaUVESUFKQmYyb2lBZzBBQ3dzZ0FBc3NBQUpBSUFCQmZFMEVRQ0FBUlFSQVFRUWhBQXdDQ3lBQUlBQkJmVWxCQW5RUVdTSUFEUUVMQUFzZ0FBc3hBUUYvSUFFb0FnUWlBZ1JBSUFBZ0FqWUNCQ0FBUVFocVFRRTJBZ0FnQUNBQktBSUFOZ0lBRHdzZ0FFRUFOZ0lBQ3pFQkFYOGdBQ0FCS0FJRUlBRW9BZ2dpQWtzRWZ5QUJJQUlRUlNBQktBSUlCU0FDQ3pZQ0JDQUFJQUVvQWdBMkFnQUxLQUVCZnlBQUtBSUlJZ0lnQVU4RVFDQUFLQUlBR2lBQUlBRTJBZ2dQQ3lBQUlBRWdBbXNRS0Fzc0FRRi9Jd0JCRUdzaUFTUUFJQUZCQ0dvZ0FFRUlhaWdDQURZQ0FDQUJJQUFwQWdBM0F3QWdBUkFzQUFzMEFRRi9Jd0JCRUdzaUFpUUFJQUlnQVRZQ0RDQUNJQUEyQWdnZ0FrRzhqTUFBTmdJRUlBSkI4SXZBQURZQ0FDQUNFRW9BQ3lFQUlBRUVRQU5BSUFCQkFEb0FBQ0FBUVFGcUlRQWdBVUYvYWlJQkRRQUxDd3NnQVFGL0FrQWdBQ2dDQUNJQlJRMEFJQUJCQkdvb0FnQkZEUUFnQVJBRUN3c2dBUUYvQWtBZ0FDZ0NCQ0lCUlEwQUlBQkJDR29vQWdCRkRRQWdBUkFFQ3dzTUFDQUFJQUVnQWlBREVENExDd0FnQVFSQUlBQVFCQXNMRWdBZ0FDZ0NBQ0FCSUFFZ0Ftb1FIMEVBQ3hRQUlBQW9BZ0FnQVNBQUtBSUVLQUlNRVFBQUN4a0FBbjlCQ0NBQlNRUkFJQUVnQUJBUURBRUxJQUFRQUFzTEVBQWdBQ0FDTmdJRUlBQWdBVFlDQUFzVEFDQUFRYUNMd0FBMkFnUWdBQ0FCTmdJQUN4QUFJQUVnQUNnQ0FDQUFLQUlFRUFVTEVRQkJ6SXZBQUVFUlFlQ0x3QUFRU0FBTERnQWdBQ2dDQUJvRFFBd0FDd0FMQ3dBZ0FEVUNBQ0FCRUJVTERRQWdBQ2dDQUNBQklBSVFDd3NMQUNBQU1RQUFJQUVRRlFzTEFDQUFJd0JxSkFBakFBc1pBQ0FBSUFGQitLYkFBQ2dDQUNJQVFRNGdBQnNSQWdBQUN3MEFJQUZCeEpEQUFFRUNFQVVMQ1FBZ0FFRUFPZ0JIQ3djQUlBQXRBRWNMRFFCQzlQbWU1dTZqcXZuK0FBc05BRUwzdU83NnFzelY3dVVBQ3d3QVF1blFvdHZNb3VxN1Jnc0RBQUVMQXdBQkN3dmZKZ0VBUVlDQXdBQUwxU1l2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZMjl5WlM5emNtTXZZV3hzYjJNdmJHRjViM1YwTG5KekFBQVFBSEFBQUFBTEFRQUFPUUFBQUdOaGJHeGxaQ0JnVW1WemRXeDBPanAxYm5keVlYQW9LV0FnYjI0Z1lXNGdZRVZ5Y21BZ2RtRnNkV1VBQVFBQUFBQUFBQUFCQUFBQUFnQUFBSE55WXk5c2FXSXVjbk1BQUx3QUVBQUtBQUFBR3dBQUFBNEFBQUM4QUJBQUNnQUFBQndBQUFBU0FBQUFZWE56WlhKMGFXOXVJR1poYVd4bFpEb2diV2xrSUR3OUlITmxiR1l1YkdWdUtDa3ZWWE5sY25NdlptMDRNVE12TG5KMWMzUjFjQzkwYjI5c1kyaGhhVzV6TDNOMFlXSnNaUzE0T0RaZk5qUXRZWEJ3YkdVdFpHRnlkMmx1TDJ4cFlpOXlkWE4wYkdsaUwzTnlZeTl5ZFhOMEwyeHBZbkpoY25rdlkyOXlaUzl6Y21NdmMyeHBZMlV2Ylc5a0xuSnpDd0VRQUcwQUFBRDlCQUFBQ1FBQUFBTUFBQUJRQUFBQUNBQUFBQVFBQUFBRkFBQUFCZ0FBQUFjQUFBQUlBQUFBVUFBQUFBZ0FBQUFKQUFBQUNnQUFBQXNBQUFBTUFBQUFMMVZ6WlhKekwyWnRPREV6THk1allYSm5ieTl5WldkcGMzUnllUzl6Y21NdloybDBhSFZpTG1OdmJTMHhaV05qTmpJNU9XUmlPV1ZqT0RJekwzZGxaWHBzTFRBdU1TNDBMM055WXk5a1pXTnZaR1V1Y25NQUFNQUJFQUJXQUFBQVdnSUFBQjhBQUFEQUFSQUFWZ0FBQUcwQ0FBQWJBQUFBd0FFUUFGWUFBQUNDQWdBQUpnQUFBTUFCRUFCV0FBQUFxd0lBQUJFQUFBREFBUkFBVmdBQUFLMENBQUFSQUFBQXdBRVFBRllBQUFDNUFnQUFHUUFBQU1BQkVBQldBQUFBelFJQUFDSUFBQURBQVJBQVZnQUFBTThDQUFBYkFBQUF3QUVRQUZZQUFBRFFBZ0FBRlFBQUFNQUJFQUJXQUFBQTBRSUFBQlVBQUFEQUFSQUFWZ0FBQVBvQ0FBQU5BQUFBd0FFUUFGWUFBQUJGQXdBQUVRQUFBTUFCRUFCV0FBQUFTd01BQUJFQUFBREFBUkFBVmdBQUFJb0RBQUFSQUFBQXdBRVFBRllBQUFDUUF3QUFFUUFBQU1BQkVBQldBQUFBdkFNQUFDY0FBQURBQVJBQVZnQUFBTHdEQUFBSkFBQUF3QUVRQUZZQUFBQy9Bd0FBQ1FBQUFNQUJFQUJXQUFBQXhnTUFBQlVBQUFEQUFSQUFWZ0FBQU1rREFBQVlBQUFBd0FFUUFGWUFBQURTQXdBQUNnQUFBTUFCRUFCV0FBQUErQU1BQUFvQUFBREFBUkFBVmdBQUFBVUVBQUFWQUFBQXdBRVFBRllBQUFBTkJBQUFGZ0FBQU1BQkVBQldBQUFBR0FRQUFBa0FBQUF2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZV3hzYjJNdmMzSmpMM0poZDE5MlpXTXVjbk5VY21sbFpDQjBieUJ6YUhKcGJtc2dkRzhnWVNCc1lYSm5aWElnWTJGd1lXTnBkSG1vQXhBQWJBQUFBTVVCQUFBSkFBQUFUV0Y0YVcxMWJTQmpiMlJsSUhOcGVtVWdNVElnY21WeGRXbHlaV1FzSUdkdmRDQUFTQVFRQUNNQUFBQXZWWE5sY25NdlptMDRNVE12TG1OaGNtZHZMM0psWjJsemRISjVMM055WXk5bmFYUm9kV0l1WTI5dExURmxZMk0yTWprNVpHSTVaV000TWpNdmQyVmxlbXd0TUM0eExqUXZjM0pqTDJ4cFlpNXljd0IwQkJBQVV3QUFBRTBBQUFBRkFBQUFEd0FBQUFRQUFBQUVBQUFBRUFBQUFCRUFBQUFTQUFBQUR3QUFBQUFBQUFBQkFBQUFFd0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1ZzYVdKeVlYSjVMM04wWkM5emNtTXZjR0Z1YVdOcmFXNW5Mbkp6QUNzRkVBQWNBQUFBN1FFQUFCOEFBQUFyQlJBQUhBQUFBTzRCQUFBZUFBQUFGQUFBQUJBQUFBQUVBQUFBRlFBQUFCWUFBQUFQQUFBQUNBQUFBQVFBQUFBWEFBQUFHQUFBQUJrQUFBQU1BQUFBQkFBQUFCb0FBQUFQQUFBQUNBQUFBQVFBQUFBYkFBQUFiR2xpY21GeWVTOWhiR3h2WXk5emNtTXZjbUYzWDNabFl5NXljMk5oY0dGamFYUjVJRzkyWlhKbWJHOTNBQUFBc0FVUUFCd0FBQUFlQWdBQUJRQUFBR0F1TGdEeEJSQUFBZ0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1U2SUFBQUFQQUZFQUFBQUFBQUp3WVFBQUlBQUFBaUFBQUFBQUFBQUFFQUFBQWpBQUFBYVc1a1pYZ2diM1YwSUc5bUlHSnZkVzVrY3pvZ2RHaGxJR3hsYmlCcGN5QWdZblYwSUhSb1pTQnBibVJsZUNCcGN5QUFBRXdHRUFBZ0FBQUFiQVlRQUJJQUFBQnNhV0p5WVhKNUwyTnZjbVV2YzNKakwyWnRkQzlpZFdsc1pHVnljeTV5Y3lJQUFBQU1BQUFBQkFBQUFDUUFBQUFsQUFBQUpnQUFBQ0FnSUNDUUJoQUFJQUFBQURJQUFBQWhBQUFBa0FZUUFDQUFBQUF6QUFBQUVnQUFBQ0I3Q2l3S0xDQWdleUI5SUgxc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDJadGRDOXVkVzB1Y25QNUJoQUFHd0FBQUdVQUFBQVVBQUFBTUhnd01EQXhNREl3TXpBME1EVXdOakEzTURnd09URXdNVEV4TWpFek1UUXhOVEUyTVRjeE9ERTVNakF5TVRJeU1qTXlOREkxTWpZeU56STRNamt6TURNeE16SXpNek0wTXpVek5qTTNNemd6T1RRd05ERTBNalF6TkRRME5UUTJORGMwT0RRNU5UQTFNVFV5TlRNMU5EVTFOVFkxTnpVNE5UazJNRFl4TmpJMk16WTBOalUyTmpZM05qZzJPVGN3TnpFM01qY3pOelEzTlRjMk56YzNPRGM1T0RBNE1UZ3lPRE00TkRnMU9EWTROemc0T0RrNU1Ea3hPVEk1TXprME9UVTVOamszT1RnNU9RQUFJZ0FBQUFRQUFBQUVBQUFBSndBQUFDZ0FBQUFwQUFBQWJHbGljbUZ5ZVM5amIzSmxMM055WXk5bWJYUXZiVzlrTG5KekFBZ0lFQUFiQUFBQVZRUUFBQkVBQUFBSUNCQUFHd0FBQUY4RUFBQWtBQUFBS0Nsc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDNOc2FXTmxMMjFsYldOb2NpNXljd0FBUmdnUUFDQUFBQUJhQUFBQUJRQUFBSEpoYm1kbElITjBZWEowSUdsdVpHVjRJQ0J2ZFhRZ2IyWWdjbUZ1WjJVZ1ptOXlJSE5zYVdObElHOW1JR3hsYm1kMGFDQjRDQkFBRWdBQUFJb0lFQUFpQUFBQWNtRnVaMlVnWlc1a0lHbHVaR1Y0SUx3SUVBQVFBQUFBaWdnUUFDSUFBQUJ6YkdsalpTQnBibVJsZUNCemRHRnlkSE1nWVhRZ0lHSjFkQ0JsYm1SeklHRjBJQURjQ0JBQUZnQUFBUElJRUFBTkFBQUFiR2xpY21GeWVTOWpiM0psTDNOeVl5OXpkSEl2Y0dGMGRHVnliaTV5Y3dBUUNSQUFId0FBQUxBQkFBQW1BQUFBV3k0dUxsMWllWFJsSUdsdVpHVjRJQ0JwY3lCdmRYUWdiMllnWW05MWJtUnpJRzltSUdBQUFFVUpFQUFMQUFBQVVBa1FBQllBQUFEd0JSQUFBUUFBQUdKbFoybHVJRHc5SUdWdVpDQW9JRHc5SUNrZ2QyaGxiaUJ6YkdsamFXNW5JR0FBQUlBSkVBQU9BQUFBamdrUUFBUUFBQUNTQ1JBQUVBQUFBUEFGRUFBQkFBQUFJR2x6SUc1dmRDQmhJR05vWVhJZ1ltOTFibVJoY25rN0lHbDBJR2x6SUdsdWMybGtaU0FnS0dKNWRHVnpJQ2tnYjJZZ1lFVUpFQUFMQUFBQXhBa1FBQ1lBQUFEcUNSQUFDQUFBQVBJSkVBQUdBQUFBOEFVUUFBRUFBQUJzYVdKeVlYSjVMMk52Y21VdmMzSmpMM1Z1YVdOdlpHVXZjSEpwYm5SaFlteGxMbkp6QUFBQUlBb1FBQ1VBQUFBS0FBQUFIQUFBQUNBS0VBQWxBQUFBR2dBQUFEWUFBQUFBQVFNRkJRWUdBd2NHQ0FnSkVRb2NDeGtNRkEwUURnMFBCQkFERWhJVENSWUJGd1VZQWhrREdnY2NBaDBCSHhZZ0F5c0RMQUl0Q3k0Qk1BTXhBaklCcHdLcEFxb0Vxd2o2QXZzRi9RVCtBLzhKclhoNWk0MmlNRmRZaTR5UUhCM2REZzlMVFB2OExpOC9YRjFmdGVLRWpZNlJrcW14dXJ2RnhzbkszdVRsL3dBRUVSSXBNVFEzT2pzOVNVcGRoSTZTcWJHMHVydkd5czdQNU9VQUJBME9FUklwTVRRNk8wVkdTVXBlWkdXRWtadWR5YzdQRFJFcFJVbFhaR1dOa2FtMHVydkZ5ZC9rNWZBTkVVVkpaR1dBaExLOHZyL1YxL0R4ZzRXTHBLYSt2OFhIenMvYTIwaVl2YzNHenM5SlRrOVhXVjVmaVk2UHNiYTN2OEhHeDljUkZoZGJYUGIzL3YrQURXMXgzdDhPRHg5dWJ4d2RYMzErcnErN3ZQb1dGeDRmUmtkT1QxaGFYRjUrZjdYRjFOWGM4UEgxY25PUGRIV1dMMThtTGkrbnI3ZS94OC9YMzVwQWw1Z3dqeC9Bd2M3L1RrOWFXd2NJRHhBbkwrN3ZibTgzUFQ5Q1JaQ1IvdjlUWjNYSXlkRFIyTm5uL3Y4QUlGOGlndDhFZ2tRSUd3UUdFWUdzRG9Dck5TZ0xnT0FER1FnQkJDOEVOQVFIQXdFSEJnY1JDbEFQRWdkVkJ3TUVIQW9KQXdnREJ3TUNBd01EREFRRkF3c0dBUTRWQlRvREVRY0dCUkFIVndjQ0J4VU5VQVJEQXkwREFRUVJCZzhNT2dRZEpWOGdiUVJxSllESUJZS3dBeG9HZ3YwRFdRY1ZDeGNKRkF3VURHb0dDZ1lhQmxrSEt3VkdDaXdFREFRQkF6RUxMQVFhQmdzRGdLd0dDZ1loUDB3RUxRTjBDRHdERHdNOEJ6Z0lLd1dDL3hFWUNDOFJMUU1nRUNFUGdJd0VncGNaQ3hXSWxBVXZCVHNIQWc0WUNZQ3pMWFFNZ05ZYURBV0Evd1dBM3d6dURRT0VqUU0zQ1lGY0ZJQzRDSURMS2pnRENnWTRDRVlJREFaMEN4NERXZ1JaQ1lDREdCd0tGZ2xNQklDS0JxdWtEQmNFTWFFRWdkb21Cd3dGQllDbEVZRnRFSGdvS2daTUJJQ05CSUMrQXhzRER3MEFCZ0VCQXdFRUFnZ0lDUUlLQlFzQ0RnUVFBUkVDRWdVVEVSUUJGUUlYQWhrTkhBVWRDQ1FCYWdOckFyd0MwUUxVRE5VSjFnTFhBdG9CNEFYaEF1Z0M3aUR3QlBnQytRTDZBdnNCRENjN1BrNVBqNTZlbndZSENUWTlQbGJ6ME5FRUZCZzJOMVpYZjZxdXI3MDE0QktIaVk2ZUJBME9FUklwTVRRNlJVWkpTazVQWkdWY3RyY2JIQWNJQ2dzVUZ6WTVPcWlwMk5rSk41Q1JxQWNLT3o1bWFZK1NiMS91NzFwaW1wc25LRldkb0tHanBLZW9yYnE4eEFZTERCVWRPajlGVWFhbnpNMmdCeGthSWlVK1A4WEdCQ0FqSlNZb016ZzZTRXBNVUZOVlZsaGFYRjVnWTJWbWEzTjRmWCtLcEtxdnNNRFFycTk1ekc1dmsxNGlld1VEQkMwRFpnTUJMeTZBZ2gwRE1ROGNCQ1FKSGdVckJVUUVEaXFBcWdZa0JDUUVLQWcwQ3dHQWtJRTNDUllLQ0lDWU9RTmpDQWt3RmdVaEF4c0ZBVUE0QkVzRkx3UUtCd2tIUUNBbkJBd0pOZ002QlJvSEJBd0hVRWszTXcwekJ5NElDb0VtVWs0b0NDcFdIQlFYQ1U0RUhnOUREaGtIQ2daSUNDY0pkUXMvUVNvR093VUtCbEVHQVFVUUF3V0FpMkllU0FnS2dLWmVJa1VMQ2dZTkV6a0hDallzQkJDQXdEeGtVd3hJQ1FwR1JSdElDRk1kT1lFSFJnb2RBMGRKTndNT0NBb0dPUWNLZ1RZWmdMY0JEeklOZzV0bWRRdUF4SXE4aEMrUDBZSkhvYm1DT1FjcUJBSmdKZ3BHQ2lnRkU0S3dXMlZMQkRrSEVVQUZDd0lPbC9nSWhOWXFDYUwzZ1I4eEF4RUVDSUdNaVFSckJRMERDUWNRazJDQTlncHpDRzRYUm9DYUZBeFhDUm1BaDRGSEE0VkNEeFdGVUN1QTFTMERHZ1FDZ1hBNkJRR0ZBSURYS1V3RUNnUUNneEZFVEQyQXdqd0dBUVJWQlJzMEFvRU9MQVJrREZZS2dLNDRIUTBzQkFrSEFnNEdnSnFEMkFnTkF3MERkQXhaQnd3VURBUTRDQW9HS0FnaVRvRlVEQlVEQXdVSENSa0hCd2tERFFjcGdNc2xDb1FHYkdsaWNtRnllUzlqYjNKbEwzTnlZeTkxYm1samIyUmxMM1Z1YVdOdlpHVmZaR0YwWVM1eWN3Q3ZEeEFBS0FBQUFFc0FBQUFvQUFBQXJ3OFFBQ2dBQUFCWEFBQUFGZ0FBQUs4UEVBQW9BQUFBVWdBQUFENEFBQUFpQUFBQUJBQUFBQVFBQUFBcUFBQUFBQU1BQUlNRUlBQ1JCV0FBWFJPZ0FCSVhvQjRNSU9BZTd5d2dLeW93b0N0dnBtQXNBcWpnTEI3NzRDMEEvcUExbnYvZ05mMEJZVFlCQ3FFMkpBMWhONnNPNFRndkdDRTVNQnhoUnZNZW9VcndhbUZPVDIraFRwMjhJVTlsMGVGUEFOb2hVQURnNFZFdzRXRlQ3T0toVk5EbzRWUWdBQzVWOEFHL1ZRQndBQWNBTFFFQkFRSUJBZ0VCU0Fzd0ZSQUJaUWNDQmdJQ0FRUWpBUjRiV3dzNkNRa0JHQVFCQ1FFREFRVXJBM2NQQVNBM0FRRUJCQWdFQVFNSENnSWRBVG9CQVFFQ0JBZ0JDUUVLQWhvQkFnSTVBUVFDQkFJQ0F3TUJIZ0lEQVFzQ09RRUVCUUVDQkFFVUFoWUdBUUU2QVFFQ0FRUUlBUWNEQ2dJZUFUc0JBUUVNQVFrQktBRURBVGtEQlFNQkJBY0NDd0lkQVRvQkFnRUNBUU1CQlFJSEFnc0NIQUk1QWdFQkFnUUlBUWtCQ2dJZEFVZ0JCQUVDQXdFQkNBRlJBUUlIREFoaUFRSUpDd1pLQWhzQkFRRUJBVGNPQVFVQkFnVUxBU1FKQVdZRUFRWUJBZ0lDR1FJRUF4QUVEUUVDQWdZQkR3RUFBd0FESFFNZEFoNENRQUlCQndnQkFnc0pBUzBEZHdJaUFYWURCQUlKQVFZRDJ3SUNBVG9CQVFjQkFRRUJBZ2dHQ2dJQk1CRS9CREFIQVFFRkFTZ0pEQUlnQkFJQ0FRTTRBUUVDQXdFQkF6b0lBZ0tZQXdFTkFRY0VBUVlCQXdMR09nRUZBQUhESVFBRGpRRmdJQUFHYVFJQUJBRUtJQUpRQWdBQkF3RUVBUmtDQlFHWEFob1NEUUVtQ0JrTExnTXdBUUlFQWdJbkFVTUdBZ0lDQWd3QkNBRXZBVE1CQVFNQ0FnVUNBUUVxQWdnQjdnRUNBUVFCQUFFQUVCQVFBQUlBQWVJQmxRVUFBd0VDQlFRb0F3UUJwUUlBQkFBQ21RdXdBVFlQT0FNeEJBSUNSUU1rQlFFSVBnRU1BalFKQ2dRQ0FWOERBZ0VCQWdZQm9BRURDQlVDT1FJQkFRRUJGZ0VPQndNRnd3Z0NBd0VCRndGUkFRSUdBUUVDQVFFQ0FRTHJBUUlFQmdJQkFoc0NWUWdDQVFFQ2FnRUJBUUlHQVFGbEF3SUVBUVVBQ1FFQzlRRUtBZ0VCQkFHUUJBSUNCQUVnQ2lnR0FnUUlBUWtHQWdNdURRRUNBQWNCQmdFQlVoWUNCd0VDQVFKNkJnTUJBUUlCQndFQlNBSURBUUVCQUFJQUJUc0hBQUUvQkZFQkFBSUFBUUVEQkFVSUNBSUhIZ1NVQXdBM0JESUlBUTRCRmdVQkR3QUhBUkVDQndFQ0FRVUFCd0FFQUFkdEJ3QmdnUEFBVEdGNWIzVjBSWEp5Y0hKcGRtRjBaUUI3Q1hCeWIyUjFZMlZ5Y3dJSWJHRnVaM1ZoWjJVQkJGSjFjM1FBREhCeWIyTmxjM05sWkMxaWVRTUZjblZ6ZEdNZE1TNDBPUzR3SUNobE1UZzROR0U0WlRNZ01qQXlNQzB4TWkweU9Ta0dkMkZzY25WekJqQXVNVGd1TUF4M1lYTnRMV0pwYm1SblpXNFNNQzR5TGpjd0lDaGlOak0xTldNeU56QXAiKTtsZXQgbzthc3luYyBmdW5jdGlvbiBOKEEsSSl7b3x8KG89YXdhaXQoYXN5bmMoKT0+KGF3YWl0IEUoRyksRCkpKCkpO2NvbnN0IGc9by5kZWNvbXByZXNzKEEsSSk7aWYoMD09PWcubGVuZ3RoKXRocm93IEVycm9yKCJGYWlsZWQgdG8gZGVjb2RlIHdpdGggTFpXIGRlY29kZXIuIik7cmV0dXJuIGd9CgogIGNsYXNzIExaV0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBjb25zdHJ1Y3RvcihmaWxlRGlyZWN0b3J5KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIGNvbnN0IHdpZHRoID0gZmlsZURpcmVjdG9yeS5UaWxlV2lkdGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICBjb25zdCBoZWlnaHQgPSBmaWxlRGlyZWN0b3J5LlRpbGVMZW5ndGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aDsKICAgICAgY29uc3QgbmJ5dGVzID0gZmlsZURpcmVjdG9yeS5CaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgICAgdGhpcy5tYXhVbmNvbXByZXNzZWRTaXplID0gd2lkdGggKiBoZWlnaHQgKiBuYnl0ZXM7CiAgICB9CgogICAgYXN5bmMgZGVjb2RlQmxvY2soYnVmZmVyKSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IE4oYnl0ZXMsIHRoaXMubWF4VW5jb21wcmVzc2VkU2l6ZSk7CiAgICAgIHJldHVybiBkZWNvZGVkLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qIC0qLSB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgYy1iYXNpYy1vZmZzZXQ6IDIgLSotIC8KICAvKiB2aW06IHNldCBzaGlmdHdpZHRoPTIgdGFic3RvcD0yIGF1dG9pbmRlbnQgY2luZGVudCBleHBhbmR0YWI6ICovCiAgLyoKICAgICBDb3B5cmlnaHQgMjAxMSBub3RtYXN0ZXJ5ZXQKICAgICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAqLwoKICAvLyAtIFRoZSBKUEVHIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBJVFUgQ0NJVFQgUmVjb21tZW5kYXRpb24gVC44MQogIC8vICAgKHd3dy53My5vcmcvR3JhcGhpY3MvSlBFRy9pdHUtdDgxLnBkZikKICAvLyAtIFRoZSBKRklGIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBKUEVHIEZpbGUgSW50ZXJjaGFuZ2UgRm9ybWF0CiAgLy8gICAod3d3LnczLm9yZy9HcmFwaGljcy9KUEVHL2pmaWYzLnBkZikKICAvLyAtIFRoZSBBZG9iZSBBcHBsaWNhdGlvbi1TcGVjaWZpYyBKUEVHIG1hcmtlcnMgaW4gdGhlIFN1cHBvcnRpbmcgdGhlIERDVCBGaWx0ZXJzCiAgLy8gICBpbiBQb3N0U2NyaXB0IExldmVsIDIsIFRlY2huaWNhbCBOb3RlICM1MTE2CiAgLy8gICAocGFydG5lcnMuYWRvYmUuY29tL3B1YmxpYy9kZXZlbG9wZXIvZW4vcHMvc2RrLzUxMTYuRENUX0ZpbHRlci5wZGYpCgoKICBjb25zdCBkY3RaaWdaYWcgPSBuZXcgSW50MzJBcnJheShbCiAgICAwLAogICAgMSwgOCwKICAgIDE2LCA5LCAyLAogICAgMywgMTAsIDE3LCAyNCwKICAgIDMyLCAyNSwgMTgsIDExLCA0LAogICAgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLAogICAgNDgsIDQxLCAzNCwgMjcsIDIwLCAxMywgNiwKICAgIDcsIDE0LCAyMSwgMjgsIDM1LCA0MiwgNDksIDU2LAogICAgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsCiAgICAyMywgMzAsIDM3LCA0NCwgNTEsIDU4LAogICAgNTksIDUyLCA0NSwgMzgsIDMxLAogICAgMzksIDQ2LCA1MywgNjAsCiAgICA2MSwgNTQsIDQ3LAogICAgNTUsIDYyLAogICAgNjMsCiAgXSk7CgogIGNvbnN0IGRjdENvczEgPSA0MDE3OyAvLyBjb3MocGkvMTYpCiAgY29uc3QgZGN0U2luMSA9IDc5OTsgLy8gc2luKHBpLzE2KQogIGNvbnN0IGRjdENvczMgPSAzNDA2OyAvLyBjb3MoMypwaS8xNikKICBjb25zdCBkY3RTaW4zID0gMjI3NjsgLy8gc2luKDMqcGkvMTYpCiAgY29uc3QgZGN0Q29zNiA9IDE1Njc7IC8vIGNvcyg2KnBpLzE2KQogIGNvbnN0IGRjdFNpbjYgPSAzNzg0OyAvLyBzaW4oNipwaS8xNikKICBjb25zdCBkY3RTcXJ0MiA9IDU3OTM7IC8vIHNxcnQoMikKICBjb25zdCBkY3RTcXJ0MWQyID0gMjg5NjsvLyBzcXJ0KDIpIC8gMgoKICBmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgICBsZXQgayA9IDA7CiAgICBjb25zdCBjb2RlID0gW107CiAgICBsZXQgbGVuZ3RoID0gMTY7CiAgICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgICAgLS1sZW5ndGg7CiAgICB9CiAgICBjb2RlLnB1c2goeyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwoKICAgIGxldCBwID0gY29kZVswXTsKICAgIGxldCBxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvZGVMZW5ndGhzW2ldOyBqKyspIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICAgIHdoaWxlIChwLmluZGV4ID4gMCkgewogICAgICAgICAgcCA9IGNvZGUucG9wKCk7CiAgICAgICAgfQogICAgICAgIHAuaW5kZXgrKzsKICAgICAgICBjb2RlLnB1c2gocCk7CiAgICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICAgIGNvZGUucHVzaChxID0geyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwogICAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgICBwID0gcTsKICAgICAgICB9CiAgICAgICAgaysrOwogICAgICB9CiAgICAgIGlmIChpICsgMSA8IGxlbmd0aCkgewogICAgICAgIC8vIHAgaGVyZSBwb2ludHMgdG8gbGFzdCBjb2RlCiAgICAgICAgY29kZS5wdXNoKHEgPSB7IGNoaWxkcmVuOiBbXSwgaW5kZXg6IDAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb2RlWzBdLmNoaWxkcmVuOwogIH0KCiAgZnVuY3Rpb24gZGVjb2RlU2NhbihkYXRhLCBpbml0aWFsT2Zmc2V0LAogICAgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsCiAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgIHN1Y2Nlc3NpdmVQcmV2LCBzdWNjZXNzaXZlKSB7CiAgICBjb25zdCB7IG1jdXNQZXJMaW5lLCBwcm9ncmVzc2l2ZSB9ID0gZnJhbWU7CgogICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpbml0aWFsT2Zmc2V0OwogICAgbGV0IG9mZnNldCA9IGluaXRpYWxPZmZzZXQ7CiAgICBsZXQgYml0c0RhdGEgPSAwOwogICAgbGV0IGJpdHNDb3VudCA9IDA7CiAgICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgICBpZiAoYml0c0NvdW50ID4gMCkgewogICAgICAgIGJpdHNDb3VudC0tOwogICAgICAgIHJldHVybiAoYml0c0RhdGEgPj4gYml0c0NvdW50KSAmIDE7CiAgICAgIH0KICAgICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgICAgaWYgKGJpdHNEYXRhID09PSAweEZGKSB7CiAgICAgICAgY29uc3QgbmV4dEJ5dGUgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgdW5leHBlY3RlZCBtYXJrZXI6ICR7KChiaXRzRGF0YSA8PCA4KSB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIC8vIHVuc3R1ZmYgMAogICAgICB9CiAgICAgIGJpdHNDb3VudCA9IDc7CiAgICAgIHJldHVybiBiaXRzRGF0YSA+Pj4gNzsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgICBsZXQgbm9kZSA9IHRyZWU7CiAgICAgIGxldCBiaXQ7CiAgICAgIHdoaWxlICgoYml0ID0gcmVhZEJpdCgpKSAhPT0gbnVsbCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbmQtYXNzaWduCiAgICAgICAgbm9kZSA9IG5vZGVbYml0XTsKICAgICAgICBpZiAodHlwZW9mIG5vZGUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBub2RlICE9PSAnb2JqZWN0JykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGh1ZmZtYW4gc2VxdWVuY2UnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiByZWNlaXZlKGluaXRpYWxMZW5ndGgpIHsKICAgICAgbGV0IGxlbmd0aCA9IGluaXRpYWxMZW5ndGg7CiAgICAgIGxldCBuID0gMDsKICAgICAgd2hpbGUgKGxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBiaXQgPSByZWFkQml0KCk7CiAgICAgICAgaWYgKGJpdCA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgbiA9IChuIDw8IDEpIHwgYml0OwogICAgICAgIC0tbGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiBuOwogICAgfQogICAgZnVuY3Rpb24gcmVjZWl2ZUFuZEV4dGVuZChsZW5ndGgpIHsKICAgICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgICAgaWYgKG4gPj0gMSA8PCAobGVuZ3RoIC0gMSkpIHsKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgICByZXR1cm4gbiArICgtMSA8PCBsZW5ndGgpICsgMTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUJhc2VsaW5lKGNvbXBvbmVudCwgenopIHsKICAgICAgY29uc3QgdCA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZURDKTsKICAgICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgICAgY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgICAgenpbMF0gPSBjb21wb25lbnQucHJlZDsKICAgICAgbGV0IGsgPSAxOwogICAgICB3aGlsZSAoayA8IDY0KSB7CiAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgY29uc3QgcyA9IHJzICYgMTU7CiAgICAgICAgY29uc3QgciA9IHJzID4+IDQ7CiAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBrICs9IDE2OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBrICs9IHI7CiAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2tdOwogICAgICAgICAgenpbel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENGaXJzdChjb21wb25lbnQsIHp6KSB7CiAgICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICAgIGNvbnN0IGRpZmYgPSB0ID09PSAwID8gMCA6IChyZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBjb21wb25lbnQucHJlZCArPSBkaWZmOwogICAgICB6elswXSA9IGNvbXBvbmVudC5wcmVkOwogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENTdWNjZXNzaXZlKGNvbXBvbmVudCwgenopIHsKICAgICAgenpbMF0gfD0gcmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmU7CiAgICB9CiAgICBsZXQgZW9icnVuID0gMDsKICAgIGZ1bmN0aW9uIGRlY29kZUFDRmlyc3QoY29tcG9uZW50LCB6eikgewogICAgICBpZiAoZW9icnVuID4gMCkgewogICAgICAgIGVvYnJ1bi0tOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgd2hpbGUgKGsgPD0gZSkgewogICAgICAgIGNvbnN0IHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgIGNvbnN0IHIgPSBycyA+PiA0OwogICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgIGVvYnJ1biA9IHJlY2VpdmUocikgKyAoMSA8PCByKSAtIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgayArPSAxNjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgayArPSByOwogICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICAgIHp6W3pdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgIGxldCBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgICBmdW5jdGlvbiBkZWNvZGVBQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCB6eikgewogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgbGV0IHIgPSAwOwogICAgICB3aGlsZSAoayA8PSBlKSB7CiAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB6elt6XSA8IDAgPyAtMSA6IDE7CiAgICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgICAgY2FzZSAwOiB7IC8vIGluaXRpYWwgc3RhdGUKICAgICAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHMgIT09IDEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBBQ24gZW5jb2RpbmcnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgICAgfQogICAgICAgICAgY2FzZSAxOiAvLyBza2lwcGluZyByIHplcm8gaXRlbXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByLS07CiAgICAgICAgICAgICAgaWYgKHIgPT09IDApIHsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6IC8vIHNldCB2YWx1ZSBmb3IgYSB6ZXJvIGl0ZW0KICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB6elt6XSA9IHN1Y2Nlc3NpdmVBQ05leHRWYWx1ZSA8PCBzdWNjZXNzaXZlOwogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNDogLy8gZW9iCiAgICAgICAgICAgIGlmICh6elt6XSkgewogICAgICAgICAgICAgIHp6W3pdICs9IChyZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZSkgKiBkaXJlY3Rpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGsrKzsKICAgICAgfQogICAgICBpZiAoc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDQpIHsKICAgICAgICBlb2JydW4tLTsKICAgICAgICBpZiAoZW9icnVuID09PSAwKSB7CiAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGdW5jdGlvbiwgbWN1LCByb3csIGNvbCkgewogICAgICBjb25zdCBtY3VSb3cgPSAobWN1IC8gbWN1c1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICAgIGNvbnN0IGJsb2NrUm93ID0gKG1jdVJvdyAqIGNvbXBvbmVudC52KSArIHJvdzsKICAgICAgY29uc3QgYmxvY2tDb2wgPSAobWN1Q29sICogY29tcG9uZW50LmgpICsgY29sOwogICAgICBkZWNvZGVGdW5jdGlvbihjb21wb25lbnQsIGNvbXBvbmVudC5ibG9ja3NbYmxvY2tSb3ddW2Jsb2NrQ29sXSk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZUZ1bmN0aW9uLCBtY3UpIHsKICAgICAgY29uc3QgYmxvY2tSb3cgPSAobWN1IC8gY29tcG9uZW50LmJsb2Nrc1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgYmxvY2tDb2wgPSBtY3UgJSBjb21wb25lbnQuYmxvY2tzUGVyTGluZTsKICAgICAgZGVjb2RlRnVuY3Rpb24oY29tcG9uZW50LCBjb21wb25lbnQuYmxvY2tzW2Jsb2NrUm93XVtibG9ja0NvbF0pOwogICAgfQoKICAgIGNvbnN0IGNvbXBvbmVudHNMZW5ndGggPSBjb21wb25lbnRzLmxlbmd0aDsKICAgIGxldCBjb21wb25lbnQ7CiAgICBsZXQgaTsKICAgIGxldCBqOwogICAgbGV0IGs7CiAgICBsZXQgbjsKICAgIGxldCBkZWNvZGVGbjsKICAgIGlmIChwcm9ncmVzc2l2ZSkgewogICAgICBpZiAoc3BlY3RyYWxTdGFydCA9PT0gMCkgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVEQ0ZpcnN0IDogZGVjb2RlRENTdWNjZXNzaXZlOwogICAgICB9IGVsc2UgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVBQ0ZpcnN0IDogZGVjb2RlQUNTdWNjZXNzaXZlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IGRlY29kZUJhc2VsaW5lOwogICAgfQoKICAgIGxldCBtY3UgPSAwOwogICAgbGV0IG1hcmtlcjsKICAgIGxldCBtY3VFeHBlY3RlZDsKICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgIG1jdUV4cGVjdGVkID0gY29tcG9uZW50c1swXS5ibG9ja3NQZXJMaW5lICogY29tcG9uZW50c1swXS5ibG9ja3NQZXJDb2x1bW47CiAgICB9IGVsc2UgewogICAgICBtY3VFeHBlY3RlZCA9IG1jdXNQZXJMaW5lICogZnJhbWUubWN1c1BlckNvbHVtbjsKICAgIH0KCiAgICBjb25zdCB1c2VkUmVzZXRJbnRlcnZhbCA9IHJlc2V0SW50ZXJ2YWwgfHwgbWN1RXhwZWN0ZWQ7CgogICAgd2hpbGUgKG1jdSA8IG1jdUV4cGVjdGVkKSB7CiAgICAgIC8vIHJlc2V0IGludGVydmFsIHN0dWZmCiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CgogICAgICBpZiAoY29tcG9uZW50c0xlbmd0aCA9PT0gMSkgewogICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbMF07CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTsKICAgICAgICAgICAgY29uc3QgeyBoLCB2IH0gPSBjb21wb25lbnQ7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2OyBqKyspIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgaDsgaysrKSB7CiAgICAgICAgICAgICAgICBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGbiwgbWN1LCBqLCBrKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1jdSsrOwoKICAgICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgb3VyIGV4cGVjdGVkIE1DVSdzLCBzdG9wIGRlY29kaW5nCiAgICAgICAgICBpZiAobWN1ID09PSBtY3VFeHBlY3RlZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGZpbmQgbWFya2VyCiAgICAgIGJpdHNDb3VudCA9IDA7CiAgICAgIG1hcmtlciA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICBpZiAobWFya2VyIDwgMHhGRjAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXJrZXIgd2FzIG5vdCBmb3VuZCcpOwogICAgICB9CgogICAgICBpZiAobWFya2VyID49IDB4RkZEMCAmJiBtYXJrZXIgPD0gMHhGRkQ3KSB7IC8vIFJTVHgKICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQgLSBzdGFydE9mZnNldDsKICB9CgogIGZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgY29uc3QgeyBibG9ja3NQZXJMaW5lLCBibG9ja3NQZXJDb2x1bW4gfSA9IGNvbXBvbmVudDsKICAgIGNvbnN0IHNhbXBsZXNQZXJMaW5lID0gYmxvY2tzUGVyTGluZSA8PCAzOwogICAgY29uc3QgUiA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgIGNvbnN0IHIgPSBuZXcgVWludDhBcnJheSg2NCk7CgogICAgLy8gQSBwb3J0IG9mIHBvcHBsZXIncyBJRENUIG1ldGhvZCB3aGljaCBpbiB0dXJuIGlzIHRha2VuIGZyb206CiAgICAvLyAgIENocmlzdG9waCBMb2VmZmxlciwgQWRyaWFhbiBMaWd0ZW5iZXJnLCBHZW9yZ2UgUy4gTW9zY2h5dHosCiAgICAvLyAgICJQcmFjdGljYWwgRmFzdCAxLUQgRENUIEFsZ29yaXRobXMgd2l0aCAxMSBNdWx0aXBsaWNhdGlvbnMiLAogICAgLy8gICBJRUVFIEludGwuIENvbmYuIG9uIEFjb3VzdGljcywgU3BlZWNoICYgU2lnbmFsIFByb2Nlc3NpbmcsIDE5ODksCiAgICAvLyAgIDk4OC05OTEuCiAgICBmdW5jdGlvbiBxdWFudGl6ZUFuZEludmVyc2UoenosIGRhdGFPdXQsIGRhdGFJbikgewogICAgICBjb25zdCBxdCA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25UYWJsZTsKICAgICAgbGV0IHYwOwogICAgICBsZXQgdjE7CiAgICAgIGxldCB2MjsKICAgICAgbGV0IHYzOwogICAgICBsZXQgdjQ7CiAgICAgIGxldCB2NTsKICAgICAgbGV0IHY2OwogICAgICBsZXQgdjc7CiAgICAgIGxldCB0OwogICAgICBjb25zdCBwID0gZGF0YUluOwogICAgICBsZXQgaTsKCiAgICAgIC8vIGRlcXVhbnQKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyBpKyspIHsKICAgICAgICBwW2ldID0genpbaV0gKiBxdFtpXTsKICAgICAgfQoKICAgICAgLy8gaW52ZXJzZSBEQ1Qgb24gcm93cwogICAgICBmb3IgKGkgPSAwOyBpIDwgODsgKytpKSB7CiAgICAgICAgY29uc3Qgcm93ID0gOCAqIGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsxICsgcm93XSA9PT0gMCAmJiBwWzIgKyByb3ddID09PSAwICYmIHBbMyArIHJvd10gPT09IDAKICAgICAgICAgICYmIHBbNCArIHJvd10gPT09IDAgJiYgcFs1ICsgcm93XSA9PT0gMCAmJiBwWzYgKyByb3ddID09PSAwCiAgICAgICAgICAmJiBwWzcgKyByb3ddID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgNTEyKSA+PiAxMDsKICAgICAgICAgIHBbMCArIHJvd10gPSB0OwogICAgICAgICAgcFsxICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzIgKyByb3ddID0gdDsKICAgICAgICAgIHBbMyArIHJvd10gPSB0OwogICAgICAgICAgcFs0ICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzUgKyByb3ddID0gdDsKICAgICAgICAgIHBbNiArIHJvd10gPSB0OwogICAgICAgICAgcFs3ICsgcm93XSA9IHQ7CiAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgIH0KCiAgICAgICAgLy8gc3RhZ2UgNAogICAgICAgIHYwID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbNCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gcFsyICsgcm93XTsKICAgICAgICB2MyA9IHBbNiArIHJvd107CiAgICAgICAgdjQgPSAoKGRjdFNxcnQxZDIgKiAocFsxICsgcm93XSAtIHBbNyArIHJvd10pKSArIDEyOCkgPj4gODsKICAgICAgICB2NyA9ICgoZGN0U3FydDFkMiAqIChwWzEgKyByb3ddICsgcFs3ICsgcm93XSkpICsgMTI4KSA+PiA4OwogICAgICAgIHY1ID0gcFszICsgcm93XSA8PCA0OwogICAgICAgIHY2ID0gcFs1ICsgcm93XSA8PCA0OwoKICAgICAgICAvLyBzdGFnZSAzCiAgICAgICAgdCA9ICh2MCAtIHYxICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYxICsgMSkgPj4gMTsKICAgICAgICB2MSA9IHQ7CiAgICAgICAgdCA9ICgodjIgKiBkY3RTaW42KSArICh2MyAqIGRjdENvczYpICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gKCh2MiAqIGRjdENvczYpIC0gKHYzICogZGN0U2luNikgKyAxMjgpID4+IDg7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFswICsgcm93XSA9IHYwICsgdjc7CiAgICAgICAgcFs3ICsgcm93XSA9IHYwIC0gdjc7CiAgICAgICAgcFsxICsgcm93XSA9IHYxICsgdjY7CiAgICAgICAgcFs2ICsgcm93XSA9IHYxIC0gdjY7CiAgICAgICAgcFsyICsgcm93XSA9IHYyICsgdjU7CiAgICAgICAgcFs1ICsgcm93XSA9IHYyIC0gdjU7CiAgICAgICAgcFszICsgcm93XSA9IHYzICsgdjQ7CiAgICAgICAgcFs0ICsgcm93XSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGludmVyc2UgRENUIG9uIGNvbHVtbnMKICAgICAgZm9yIChpID0gMDsgaSA8IDg7ICsraSkgewogICAgICAgIGNvbnN0IGNvbCA9IGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsoMSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWygyICogOCkgKyBjb2xdID09PSAwICYmIHBbKDMgKiA4KSArIGNvbF0gPT09IDAKICAgICAgICAgICYmIHBbKDQgKiA4KSArIGNvbF0gPT09IDAgJiYgcFsoNSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWyg2ICogOCkgKyBjb2xdID09PSAwCiAgICAgICAgICAmJiBwWyg3ICogOCkgKyBjb2xdID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIGRhdGFJbltpICsgMF0pICsgODE5MikgPj4gMTQ7CiAgICAgICAgICBwWygwICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDEgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWygzICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDQgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWyg2ICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDcgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29udGludWUKICAgICAgICB9CgogICAgICAgIC8vIHN0YWdlIDQKICAgICAgICB2MCA9ICgoZGN0U3FydDIgKiBwWygwICogOCkgKyBjb2xdKSArIDIwNDgpID4+IDEyOwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbKDQgKiA4KSArIGNvbF0pICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjIgPSBwWygyICogOCkgKyBjb2xdOwogICAgICAgIHYzID0gcFsoNiAqIDgpICsgY29sXTsKICAgICAgICB2NCA9ICgoZGN0U3FydDFkMiAqIChwWygxICogOCkgKyBjb2xdIC0gcFsoNyAqIDgpICsgY29sXSkpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjcgPSAoKGRjdFNxcnQxZDIgKiAocFsoMSAqIDgpICsgY29sXSArIHBbKDcgKiA4KSArIGNvbF0pKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY1ID0gcFsoMyAqIDgpICsgY29sXTsKICAgICAgICB2NiA9IHBbKDUgKiA4KSArIGNvbF07CgogICAgICAgIC8vIHN0YWdlIDMKICAgICAgICB0ID0gKHYwIC0gdjEgKyAxKSA+PiAxOwogICAgICAgIHYwID0gKHYwICsgdjEgKyAxKSA+PiAxOwogICAgICAgIHYxID0gdDsKICAgICAgICB0ID0gKCh2MiAqIGRjdFNpbjYpICsgKHYzICogZGN0Q29zNikgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2MiA9ICgodjIgKiBkY3RDb3M2KSAtICh2MyAqIGRjdFNpbjYpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFsoMCAqIDgpICsgY29sXSA9IHYwICsgdjc7CiAgICAgICAgcFsoNyAqIDgpICsgY29sXSA9IHYwIC0gdjc7CiAgICAgICAgcFsoMSAqIDgpICsgY29sXSA9IHYxICsgdjY7CiAgICAgICAgcFsoNiAqIDgpICsgY29sXSA9IHYxIC0gdjY7CiAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHYyICsgdjU7CiAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHYyIC0gdjU7CiAgICAgICAgcFsoMyAqIDgpICsgY29sXSA9IHYzICsgdjQ7CiAgICAgICAgcFsoNCAqIDgpICsgY29sXSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGNvbnZlcnQgdG8gOC1iaXQgaW50ZWdlcnMKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyArK2kpIHsKICAgICAgICBjb25zdCBzYW1wbGUgPSAxMjggKyAoKHBbaV0gKyA4KSA+PiA0KTsKICAgICAgICBpZiAoc2FtcGxlIDwgMCkgewogICAgICAgICAgZGF0YU91dFtpXSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzYW1wbGUgPiAwWEZGKSB7CiAgICAgICAgICBkYXRhT3V0W2ldID0gMHhGRjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YU91dFtpXSA9IHNhbXBsZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGxldCBibG9ja1JvdyA9IDA7IGJsb2NrUm93IDwgYmxvY2tzUGVyQ29sdW1uOyBibG9ja1JvdysrKSB7CiAgICAgIGNvbnN0IHNjYW5MaW5lID0gYmxvY2tSb3cgPDwgMzsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICBsaW5lcy5wdXNoKG5ldyBVaW50OEFycmF5KHNhbXBsZXNQZXJMaW5lKSk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LmJsb2Nrc1tibG9ja1Jvd11bYmxvY2tDb2xdLCByLCBSKTsKCiAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgY29uc3Qgc2FtcGxlID0gYmxvY2tDb2wgPDwgMzsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDg7IGorKykgewogICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW3NjYW5MaW5lICsgal07CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgewogICAgICAgICAgICBsaW5lW3NhbXBsZSArIGldID0gcltvZmZzZXQrK107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbGluZXM7CiAgfQoKICBjbGFzcyBKcGVnU3RyZWFtUmVhZGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmpmaWYgPSBudWxsOwogICAgICB0aGlzLmFkb2JlID0gbnVsbDsKCiAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0FDID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0RDID0gW107CiAgICAgIHRoaXMucmVzZXRGcmFtZXMoKTsKICAgIH0KCiAgICByZXNldEZyYW1lcygpIHsKICAgICAgdGhpcy5mcmFtZXMgPSBbXTsKICAgIH0KCiAgICBwYXJzZShkYXRhKSB7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAvLyBjb25zdCB7IGxlbmd0aCB9ID0gZGF0YTsKICAgICAgZnVuY3Rpb24gcmVhZFVpbnQxNigpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICAgIG9mZnNldCArPSAyOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkRGF0YUJsb2NrKCkgewogICAgICAgIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggLSAyKTsKICAgICAgICBvZmZzZXQgKz0gYXJyYXkubGVuZ3RoOwogICAgICAgIHJldHVybiBhcnJheTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSkgewogICAgICAgIGxldCBtYXhIID0gMDsKICAgICAgICBsZXQgbWF4ViA9IDA7CiAgICAgICAgbGV0IGNvbXBvbmVudDsKICAgICAgICBsZXQgY29tcG9uZW50SWQ7CiAgICAgICAgZm9yIChjb21wb25lbnRJZCBpbiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgICBpZiAoZnJhbWUuY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShjb21wb25lbnRJZCkpIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gZnJhbWUuY29tcG9uZW50c1tjb21wb25lbnRJZF07CiAgICAgICAgICAgIGlmIChtYXhIIDwgY29tcG9uZW50LmgpIHsKICAgICAgICAgICAgICBtYXhIID0gY29tcG9uZW50Lmg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCBjb21wb25lbnQudikgewogICAgICAgICAgICAgIG1heFYgPSBjb21wb25lbnQudjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBtYXhIKTsKICAgICAgICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBtYXhWKTsKICAgICAgICBmb3IgKGNvbXBvbmVudElkIGluIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgICAgIGlmIChmcmFtZS5jb21wb25lbnRzLmhhc093blByb3BlcnR5KGNvbXBvbmVudElkKSkgewogICAgICAgICAgICBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXTsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyTGluZSA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4KSAqIGNvbXBvbmVudC5oIC8gbWF4SCk7CiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIG1heFYpOwogICAgICAgICAgICBjb25zdCBibG9ja3NQZXJMaW5lRm9yTWN1ID0gbWN1c1BlckxpbmUgKiBjb21wb25lbnQuaDsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uRm9yTWN1ID0gbWN1c1BlckNvbHVtbiAqIGNvbXBvbmVudC52OwogICAgICAgICAgICBjb25zdCBibG9ja3MgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3NQZXJDb2x1bW5Gb3JNY3U7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IFtdOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmxvY2tzUGVyTGluZUZvck1jdTsgaisrKSB7CiAgICAgICAgICAgICAgICByb3cucHVzaChuZXcgSW50MzJBcnJheSg2NCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBibG9ja3MucHVzaChyb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lID0gYmxvY2tzUGVyTGluZTsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrcyA9IGJsb2NrczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgICAgZnJhbWUubWF4ViA9IG1heFY7CiAgICAgICAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICAgICAgICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKICAgICAgfQoKICAgICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIGlmIChmaWxlTWFya2VyICE9PSAweEZGRDgpIHsgLy8gU09JIChTdGFydCBvZiBJbWFnZSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NPSSBub3QgZm91bmQnKTsKICAgICAgfQoKICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoKTsKICAgICAgd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4RkZEOSkgeyAvLyBFT0kgKEVuZCBvZiBpbWFnZSkKICAgICAgICBzd2l0Y2ggKGZpbGVNYXJrZXIpIHsKICAgICAgICAgIGNhc2UgMHhGRjAwOiBicmVhazsKICAgICAgICAgIGNhc2UgMHhGRkUwOiAvLyBBUFAwIChBcHBsaWNhdGlvbiBTcGVjaWZpYykKICAgICAgICAgIGNhc2UgMHhGRkUxOiAvLyBBUFAxCiAgICAgICAgICBjYXNlIDB4RkZFMjogLy8gQVBQMgogICAgICAgICAgY2FzZSAweEZGRTM6IC8vIEFQUDMKICAgICAgICAgIGNhc2UgMHhGRkU0OiAvLyBBUFA0CiAgICAgICAgICBjYXNlIDB4RkZFNTogLy8gQVBQNQogICAgICAgICAgY2FzZSAweEZGRTY6IC8vIEFQUDYKICAgICAgICAgIGNhc2UgMHhGRkU3OiAvLyBBUFA3CiAgICAgICAgICBjYXNlIDB4RkZFODogLy8gQVBQOAogICAgICAgICAgY2FzZSAweEZGRTk6IC8vIEFQUDkKICAgICAgICAgIGNhc2UgMHhGRkVBOiAvLyBBUFAxMAogICAgICAgICAgY2FzZSAweEZGRUI6IC8vIEFQUDExCiAgICAgICAgICBjYXNlIDB4RkZFQzogLy8gQVBQMTIKICAgICAgICAgIGNhc2UgMHhGRkVEOiAvLyBBUFAxMwogICAgICAgICAgY2FzZSAweEZGRUU6IC8vIEFQUDE0CiAgICAgICAgICBjYXNlIDB4RkZFRjogLy8gQVBQMTUKICAgICAgICAgIGNhc2UgMHhGRkZFOiB7IC8vIENPTSAoQ29tbWVudCkKICAgICAgICAgICAgY29uc3QgYXBwRGF0YSA9IHJlYWREYXRhQmxvY2soKTsKCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRTApIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0QSAmJiBhcHBEYXRhWzFdID09PSAweDQ2ICYmIGFwcERhdGFbMl0gPT09IDB4NDkKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgeyAvLyAnSkZJRlx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmpmaWYgPSB7CiAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsgbWFqb3I6IGFwcERhdGFbNV0sIG1pbm9yOiBhcHBEYXRhWzZdIH0sCiAgICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgICAgeERlbnNpdHk6IChhcHBEYXRhWzhdIDw8IDgpIHwgYXBwRGF0YVs5XSwKICAgICAgICAgICAgICAgICAgeURlbnNpdHk6IChhcHBEYXRhWzEwXSA8PCA4KSB8IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgICAgICB0aHVtYldpZHRoOiBhcHBEYXRhWzEyXSwKICAgICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgICB0aHVtYkRhdGE6IGFwcERhdGEuc3ViYXJyYXkoMTQsIDE0ICsgKDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKSksCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUT0RPIEFQUDEgLSBFeGlmCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRUUpIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0MSAmJiBhcHBEYXRhWzFdID09PSAweDY0ICYmIGFwcERhdGFbMl0gPT09IDB4NkYKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSAmJiBhcHBEYXRhWzVdID09PSAwKSB7IC8vICdBZG9iZVx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmFkb2JlID0gewogICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBhcHBEYXRhWzZdLAogICAgICAgICAgICAgICAgICBmbGFnczA6IChhcHBEYXRhWzddIDw8IDgpIHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgICAgZmxhZ3MxOiAoYXBwRGF0YVs5XSA8PCA4KSB8IGFwcERhdGFbMTBdLAogICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkRCOiB7IC8vIERRVCAoRGVmaW5lIFF1YW50aXphdGlvbiBUYWJsZXMpCiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlc0xlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzRW5kID0gcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoICsgb2Zmc2V0IC0gMjsKICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IHF1YW50aXphdGlvblRhYmxlc0VuZCkgewogICAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgICAgICAgICAgICBpZiAoKHF1YW50aXphdGlvblRhYmxlU3BlYyA+PiA0KSA9PT0gMCkgeyAvLyA4IGJpdCB2YWx1ZXMKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgICB0YWJsZURhdGFbel0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCkgPT09IDEpIHsgLy8gMTYgYml0CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RRVDogaW52YWxpZCB0YWJsZSBzcGVjJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzW3F1YW50aXphdGlvblRhYmxlU3BlYyAmIDE1XSA9IHRhYmxlRGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDMDogLy8gU09GMCAoU3RhcnQgb2YgRnJhbWUsIEJhc2VsaW5lIERDVCkKICAgICAgICAgIGNhc2UgMHhGRkMxOiAvLyBTT0YxIChTdGFydCBvZiBGcmFtZSwgRXh0ZW5kZWQgRENUKQogICAgICAgICAgY2FzZSAweEZGQzI6IHsgLy8gU09GMiAoU3RhcnQgb2YgRnJhbWUsIFByb2dyZXNzaXZlIERDVCkKICAgICAgICAgICAgcmVhZFVpbnQxNigpOyAvLyBza2lwIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gewogICAgICAgICAgICAgIGV4dGVuZGVkOiAoZmlsZU1hcmtlciA9PT0gMHhGRkMxKSwKICAgICAgICAgICAgICBwcm9ncmVzc2l2ZTogKGZpbGVNYXJrZXIgPT09IDB4RkZDMiksCiAgICAgICAgICAgICAgcHJlY2lzaW9uOiBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgICBzY2FuTGluZXM6IHJlYWRVaW50MTYoKSwKICAgICAgICAgICAgICBzYW1wbGVzUGVyTGluZTogcmVhZFVpbnQxNigpLAogICAgICAgICAgICAgIGNvbXBvbmVudHM6IHt9LAogICAgICAgICAgICAgIGNvbXBvbmVudHNPcmRlcjogW10sCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgbGV0IGNvbXBvbmVudElkOwogICAgICAgICAgICAvLyBsZXQgbWF4SCA9IDA7CiAgICAgICAgICAgIC8vIGxldCBtYXhWID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICAgIGNvbXBvbmVudElkID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIGNvbnN0IGggPSBkYXRhW29mZnNldCArIDFdID4+IDQ7CiAgICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgICBjb25zdCBxSWQgPSBkYXRhW29mZnNldCArIDJdOwogICAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudHNPcmRlci5wdXNoKGNvbXBvbmVudElkKTsKICAgICAgICAgICAgICBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXSA9IHsKICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgcXVhbnRpemF0aW9uSWR4OiBxSWQsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBvZmZzZXQgKz0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSk7CiAgICAgICAgICAgIHRoaXMuZnJhbWVzLnB1c2goZnJhbWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDNDogeyAvLyBESFQgKERlZmluZSBIdWZmbWFuIFRhYmxlcykKICAgICAgICAgICAgY29uc3QgaHVmZm1hbkxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDI7IGkgPCBodWZmbWFuTGVuZ3RoOykgewogICAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5UYWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgICBsZXQgY29kZUxlbmd0aFN1bSA9IDA7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgaisrLCBvZmZzZXQrKykgewogICAgICAgICAgICAgICAgY29kZUxlbmd0aHNbal0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBodWZmbWFuVmFsdWVzID0gbmV3IFVpbnQ4QXJyYXkoY29kZUxlbmd0aFN1bSk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2RlTGVuZ3RoU3VtOyBqKyssIG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpICs9IDE3ICsgY29kZUxlbmd0aFN1bTsKCiAgICAgICAgICAgICAgaWYgKChodWZmbWFuVGFibGVTcGVjID4+IDQpID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1todWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoCiAgICAgICAgICAgICAgICAgIGNvZGVMZW5ndGhzLCBodWZmbWFuVmFsdWVzLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5odWZmbWFuVGFibGVzQUNbaHVmZm1hblRhYmxlU3BlYyAmIDE1XSA9IGJ1aWxkSHVmZm1hblRhYmxlKAogICAgICAgICAgICAgICAgICBjb2RlTGVuZ3RocywgaHVmZm1hblZhbHVlcywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkREOiAvLyBEUkkgKERlZmluZSBSZXN0YXJ0IEludGVydmFsKQogICAgICAgICAgICByZWFkVWludDE2KCk7IC8vIHNraXAgZGF0YSBsZW5ndGgKICAgICAgICAgICAgdGhpcy5yZXNldEludGVydmFsID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDB4RkZEQTogeyAvLyBTT1MgKFN0YXJ0IG9mIFNjYW4pCiAgICAgICAgICAgIHJlYWRVaW50MTYoKTsgLy8gc2tpcCBsZW5ndGgKICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuZnJhbWVzWzBdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2RhdGFbb2Zmc2V0KytdXTsKICAgICAgICAgICAgICBjb25zdCB0YWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1t0YWJsZVNwZWMgPj4gNF07CiAgICAgICAgICAgICAgY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDID0gdGhpcy5odWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsCiAgICAgICAgICAgICAgZnJhbWUsIGNvbXBvbmVudHMsIHRoaXMucmVzZXRJbnRlcnZhbCwKICAgICAgICAgICAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgICAgICAgICAgICBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA+PiA0LCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiAmIDE1KTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAweEZGRkY6IC8vIEZpbGwgYnl0ZXMKICAgICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0XSAhPT0gMHhGRikgeyAvLyBBdm9pZCBza2lwcGluZyBhIHZhbGlkIG1hcmtlci4KICAgICAgICAgICAgICBvZmZzZXQtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoZGF0YVtvZmZzZXQgLSAzXSA9PT0gMHhGRgogICAgICAgICAgICAgICYmIGRhdGFbb2Zmc2V0IC0gMl0gPj0gMHhDMCAmJiBkYXRhW29mZnNldCAtIDJdIDw9IDB4RkUpIHsKICAgICAgICAgICAgICAvLyBjb3VsZCBiZSBpbmNvcnJlY3QgZW5jb2RpbmcgLS0gbGFzdCAweEZGIGJ5dGUgb2YgdGhlIHByZXZpb3VzCiAgICAgICAgICAgICAgLy8gYmxvY2sgd2FzIGVhdGVuIGJ5IHRoZSBlbmNvZGVyCiAgICAgICAgICAgICAgb2Zmc2V0IC09IDM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIEpQRUcgbWFya2VyICR7ZmlsZU1hcmtlci50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRSZXN1bHQoKSB7CiAgICAgIGNvbnN0IHsgZnJhbWVzIH0gPSB0aGlzOwogICAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyBmcmFtZXMgd2VyZSBkZWNvZGVkJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgIGNvbnNvbGUud2FybignbW9yZSB0aGFuIG9uZSBmcmFtZSBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgICAgIH0KCiAgICAgIC8vIHNldCBlYWNoIGZyYW1lJ3MgY29tcG9uZW50cyBxdWFudGl6YXRpb24gdGFibGUKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZyYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNwID0gdGhpcy5mcmFtZXNbaV0uY29tcG9uZW50czsKICAgICAgICBmb3IgKGNvbnN0IGogb2YgT2JqZWN0LmtleXMoY3ApKSB7CiAgICAgICAgICBjcFtqXS5xdWFudGl6YXRpb25UYWJsZSA9IHRoaXMucXVhbnRpemF0aW9uVGFibGVzW2NwW2pdLnF1YW50aXphdGlvbklkeF07CiAgICAgICAgICBkZWxldGUgY3Bbal0ucXVhbnRpemF0aW9uSWR4OwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgZnJhbWUgPSBmcmFtZXNbMF07CiAgICAgIGNvbnN0IHsgY29tcG9uZW50cywgY29tcG9uZW50c09yZGVyIH0gPSBmcmFtZTsKICAgICAgY29uc3Qgb3V0Q29tcG9uZW50cyA9IFtdOwogICAgICBjb25zdCB3aWR0aCA9IGZyYW1lLnNhbXBsZXNQZXJMaW5lOwogICAgICBjb25zdCBoZWlnaHQgPSBmcmFtZS5zY2FuTGluZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBvbmVudHNPcmRlci5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNvbXBvbmVudHNbY29tcG9uZW50c09yZGVyW2ldXTsKICAgICAgICBvdXRDb21wb25lbnRzLnB1c2goewogICAgICAgICAgbGluZXM6IGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSwKICAgICAgICAgIHNjYWxlWDogY29tcG9uZW50LmggLyBmcmFtZS5tYXhILAogICAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KHdpZHRoICogaGVpZ2h0ICogb3V0Q29tcG9uZW50cy5sZW5ndGgpOwogICAgICBsZXQgb2kgPSAwOwogICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7CiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dENvbXBvbmVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gb3V0Q29tcG9uZW50c1tpXTsKICAgICAgICAgICAgb3V0W29pXSA9IGNvbXBvbmVudC5saW5lc1swIHwgeSAqIGNvbXBvbmVudC5zY2FsZVldWzAgfCB4ICogY29tcG9uZW50LnNjYWxlWF07CiAgICAgICAgICAgICsrb2k7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgfQoKICBjbGFzcyBKcGVnRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgSnBlZ1N0cmVhbVJlYWRlcigpOwogICAgICBpZiAoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKSB7CiAgICAgICAgdGhpcy5yZWFkZXIucGFyc2UoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKTsKICAgICAgfQogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICB0aGlzLnJlYWRlci5yZXNldEZyYW1lcygpOwogICAgICB0aGlzLnJlYWRlci5wYXJzZShuZXcgVWludDhBcnJheShidWZmZXIpKTsKICAgICAgcmV0dXJuIHRoaXMucmVhZGVyLmdldFJlc3VsdCgpLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qISBwYWtvIDIuMC40IGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlY2EvcGFrbyBAbGljZW5zZSAoTUlUIEFORCBabGliKSAqLwogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICAvKiBlc2xpbnQtZGlzYWJsZSBzcGFjZS11bmFyeS1vcHMgKi8KCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLy9jb25zdCBaX0ZJTFRFUkVEICAgICAgICAgID0gMTsKICAvL2NvbnN0IFpfSFVGRk1BTl9PTkxZICAgICAgPSAyOwogIC8vY29uc3QgWl9STEUgICAgICAgICAgICAgICA9IDM7CiAgY29uc3QgWl9GSVhFRCQxICAgICAgICAgICAgICAgPSA0OwogIC8vY29uc3QgWl9ERUZBVUxUX1NUUkFURUdZICA9IDA7CgogIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICBjb25zdCBaX0JJTkFSWSAgICAgICAgICAgICAgPSAwOwogIGNvbnN0IFpfVEVYVCAgICAgICAgICAgICAgICA9IDE7CiAgLy9jb25zdCBaX0FTQ0lJICAgICAgICAgICAgID0gMTsgLy8gPSBaX1RFWFQKICBjb25zdCBaX1VOS05PV04kMSAgICAgICAgICAgICA9IDI7CgogIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBmdW5jdGlvbiB6ZXJvJDEoYnVmKSB7IGxldCBsZW4gPSBidWYubGVuZ3RoOyB3aGlsZSAoLS1sZW4gPj0gMCkgeyBidWZbbGVuXSA9IDA7IH0gfQoKICAvLyBGcm9tIHp1dGlsLmgKCiAgY29uc3QgU1RPUkVEX0JMT0NLID0gMDsKICBjb25zdCBTVEFUSUNfVFJFRVMgPSAxOwogIGNvbnN0IERZTl9UUkVFUyAgICA9IDI7CiAgLyogVGhlIHRocmVlIGtpbmRzIG9mIGJsb2NrIHR5cGUgKi8KCiAgY29uc3QgTUlOX01BVENIJDEgICAgPSAzOwogIGNvbnN0IE1BWF9NQVRDSCQxICAgID0gMjU4OwogIC8qIFRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIG1hdGNoIGxlbmd0aHMgKi8KCiAgLy8gRnJvbSBkZWZsYXRlLmgKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbnRlcm5hbCBjb21wcmVzc2lvbiBzdGF0ZS4KICAgKi8KCiAgY29uc3QgTEVOR1RIX0NPREVTJDEgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCgogIGNvbnN0IExJVEVSQUxTJDEgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KCiAgY29uc3QgTF9DT0RFUyQxICAgICAgID0gTElURVJBTFMkMSArIDEgKyBMRU5HVEhfQ09ERVMkMTsKICAvKiBudW1iZXIgb2YgTGl0ZXJhbCBvciBMZW5ndGggY29kZXMsIGluY2x1ZGluZyB0aGUgRU5EX0JMT0NLIGNvZGUgKi8KCiAgY29uc3QgRF9DT0RFUyQxICAgICAgID0gMzA7CiAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGVzICovCgogIGNvbnN0IEJMX0NPREVTJDEgICAgICA9IDE5OwogIC8qIG51bWJlciBvZiBjb2RlcyB1c2VkIHRvIHRyYW5zZmVyIHRoZSBiaXQgbGVuZ3RocyAqLwoKICBjb25zdCBIRUFQX1NJWkUkMSAgICAgPSAyICogTF9DT0RFUyQxICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwoKICBjb25zdCBNQVhfQklUUyQxICAgICAgPSAxNTsKICAvKiBBbGwgY29kZXMgbXVzdCBub3QgZXhjZWVkIE1BWF9CSVRTIGJpdHMgKi8KCiAgY29uc3QgQnVmX3NpemUgICAgICA9IDE2OwogIC8qIHNpemUgb2YgYml0IGJ1ZmZlciBpbiBiaV9idWYgKi8KCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbnN0YW50cwogICAqLwoKICBjb25zdCBNQVhfQkxfQklUUyA9IDc7CiAgLyogQml0IGxlbmd0aCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JMX0JJVFMgYml0cyAqLwoKICBjb25zdCBFTkRfQkxPQ0sgICA9IDI1NjsKICAvKiBlbmQgb2YgYmxvY2sgbGl0ZXJhbCBjb2RlICovCgogIGNvbnN0IFJFUF8zXzYgICAgID0gMTY7CiAgLyogcmVwZWF0IHByZXZpb3VzIGJpdCBsZW5ndGggMy02IHRpbWVzICgyIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzNfMTAgICA9IDE3OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDMtMTAgdGltZXMgICgzIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzExXzEzOCA9IDE4OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDExLTEzOCB0aW1lcyAgKDcgYml0cyBvZiByZXBlYXQgY291bnQpICovCgogIC8qIGVzbGludC1kaXNhYmxlIGNvbW1hLXNwYWNpbmcsYXJyYXktYnJhY2tldC1zcGFjaW5nICovCiAgY29uc3QgZXh0cmFfbGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggbGVuZ3RoIGNvZGUgKi8KICAgIG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKTsKCiAgY29uc3QgZXh0cmFfZGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggZGlzdGFuY2UgY29kZSAqLwogICAgbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTNdKTsKCiAgY29uc3QgZXh0cmFfYmxiaXRzID0gIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggYml0IGxlbmd0aCBjb2RlICovCiAgICBuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pOwoKICBjb25zdCBibF9vcmRlciA9CiAgICBuZXcgVWludDhBcnJheShbMTYsMTcsMTgsMCw4LDcsOSw2LDEwLDUsMTEsNCwxMiwzLDEzLDIsMTQsMSwxNV0pOwogIC8qIGVzbGludC1lbmFibGUgY29tbWEtc3BhY2luZyxhcnJheS1icmFja2V0LXNwYWNpbmcgKi8KCiAgLyogVGhlIGxlbmd0aHMgb2YgdGhlIGJpdCBsZW5ndGggY29kZXMgYXJlIHNlbnQgaW4gb3JkZXIgb2YgZGVjcmVhc2luZwogICAqIHByb2JhYmlsaXR5LCB0byBhdm9pZCB0cmFuc21pdHRpbmcgdGhlIGxlbmd0aHMgZm9yIHVudXNlZCBiaXQgbGVuZ3RoIGNvZGVzLgogICAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBMb2NhbCBkYXRhLiBUaGVzZSBhcmUgaW5pdGlhbGl6ZWQgb25seSBvbmNlLgogICAqLwoKICAvLyBXZSBwcmUtZmlsbCBhcnJheXMgd2l0aCAwIHRvIGF2b2lkIHVuaW5pdGlhbGl6ZWQgZ2FwcwoKICBjb25zdCBESVNUX0NPREVfTEVOID0gNTEyOyAvKiBzZWUgZGVmaW5pdGlvbiBvZiBhcnJheSBkaXN0X2NvZGUgYmVsb3cgKi8KCiAgLy8gISEhISBVc2UgZmxhdCBhcnJheSBpbnN0ZWFkIG9mIHN0cnVjdHVyZSwgRnJlcSA9IGkqMiwgTGVuID0gaSoyKzEKICBjb25zdCBzdGF0aWNfbHRyZWUgID0gbmV3IEFycmF5KChMX0NPREVTJDEgKyAyKSAqIDIpOwogIHplcm8kMShzdGF0aWNfbHRyZWUpOwogIC8qIFRoZSBzdGF0aWMgbGl0ZXJhbCB0cmVlLiBTaW5jZSB0aGUgYml0IGxlbmd0aHMgYXJlIGltcG9zZWQsIHRoZXJlIGlzIG5vCiAgICogbmVlZCBmb3IgdGhlIExfQ09ERVMgZXh0cmEgY29kZXMgdXNlZCBkdXJpbmcgaGVhcCBjb25zdHJ1Y3Rpb24uIEhvd2V2ZXIKICAgKiBUaGUgY29kZXMgMjg2IGFuZCAyODcgYXJlIG5lZWRlZCB0byBidWlsZCBhIGNhbm9uaWNhbCB0cmVlIChzZWUgX3RyX2luaXQKICAgKiBiZWxvdykuCiAgICovCgogIGNvbnN0IHN0YXRpY19kdHJlZSAgPSBuZXcgQXJyYXkoRF9DT0RFUyQxICogMik7CiAgemVybyQxKHN0YXRpY19kdHJlZSk7CiAgLyogVGhlIHN0YXRpYyBkaXN0YW5jZSB0cmVlLiAoQWN0dWFsbHkgYSB0cml2aWFsIHRyZWUgc2luY2UgYWxsIGNvZGVzIHVzZQogICAqIDUgYml0cy4pCiAgICovCgogIGNvbnN0IF9kaXN0X2NvZGUgICAgPSBuZXcgQXJyYXkoRElTVF9DT0RFX0xFTik7CiAgemVybyQxKF9kaXN0X2NvZGUpOwogIC8qIERpc3RhbmNlIGNvZGVzLiBUaGUgZmlyc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSBkaXN0YW5jZXMKICAgKiAzIC4uIDI1OCwgdGhlIGxhc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSB0b3AgOCBiaXRzIG9mCiAgICogdGhlIDE1IGJpdCBkaXN0YW5jZXMuCiAgICovCgogIGNvbnN0IF9sZW5ndGhfY29kZSAgPSBuZXcgQXJyYXkoTUFYX01BVENIJDEgLSBNSU5fTUFUQ0gkMSArIDEpOwogIHplcm8kMShfbGVuZ3RoX2NvZGUpOwogIC8qIGxlbmd0aCBjb2RlIGZvciBlYWNoIG5vcm1hbGl6ZWQgbWF0Y2ggbGVuZ3RoICgwID09IE1JTl9NQVRDSCkgKi8KCiAgY29uc3QgYmFzZV9sZW5ndGggICA9IG5ldyBBcnJheShMRU5HVEhfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfbGVuZ3RoKTsKICAvKiBGaXJzdCBub3JtYWxpemVkIGxlbmd0aCBmb3IgZWFjaCBjb2RlICgwID0gTUlOX01BVENIKSAqLwoKICBjb25zdCBiYXNlX2Rpc3QgICAgID0gbmV3IEFycmF5KERfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfZGlzdCk7CiAgLyogRmlyc3Qgbm9ybWFsaXplZCBkaXN0YW5jZSBmb3IgZWFjaCBjb2RlICgwID0gZGlzdGFuY2Ugb2YgMSkgKi8KCgogIGZ1bmN0aW9uIFN0YXRpY1RyZWVEZXNjKHN0YXRpY190cmVlLCBleHRyYV9iaXRzLCBleHRyYV9iYXNlLCBlbGVtcywgbWF4X2xlbmd0aCkgewoKICAgIHRoaXMuc3RhdGljX3RyZWUgID0gc3RhdGljX3RyZWU7ICAvKiBzdGF0aWMgdHJlZSBvciBOVUxMICovCiAgICB0aGlzLmV4dHJhX2JpdHMgICA9IGV4dHJhX2JpdHM7ICAgLyogZXh0cmEgYml0cyBmb3IgZWFjaCBjb2RlIG9yIE5VTEwgKi8KICAgIHRoaXMuZXh0cmFfYmFzZSAgID0gZXh0cmFfYmFzZTsgICAvKiBiYXNlIGluZGV4IGZvciBleHRyYV9iaXRzICovCiAgICB0aGlzLmVsZW1zICAgICAgICA9IGVsZW1zOyAgICAgICAgLyogbWF4IG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgdHJlZSAqLwogICAgdGhpcy5tYXhfbGVuZ3RoICAgPSBtYXhfbGVuZ3RoOyAgIC8qIG1heCBiaXQgbGVuZ3RoIGZvciB0aGUgY29kZXMgKi8KCiAgICAvLyBzaG93IGlmIGBzdGF0aWNfdHJlZWAgaGFzIGRhdGEgb3IgZHVtbXkgLSBuZWVkZWQgZm9yIG1vbm9tb3JwaGljIG9iamVjdHMKICAgIHRoaXMuaGFzX3N0cmVlICAgID0gc3RhdGljX3RyZWUgJiYgc3RhdGljX3RyZWUubGVuZ3RoOwogIH0KCgogIGxldCBzdGF0aWNfbF9kZXNjOwogIGxldCBzdGF0aWNfZF9kZXNjOwogIGxldCBzdGF0aWNfYmxfZGVzYzsKCgogIGZ1bmN0aW9uIFRyZWVEZXNjKGR5bl90cmVlLCBzdGF0X2Rlc2MpIHsKICAgIHRoaXMuZHluX3RyZWUgPSBkeW5fdHJlZTsgICAgIC8qIHRoZSBkeW5hbWljIHRyZWUgKi8KICAgIHRoaXMubWF4X2NvZGUgPSAwOyAgICAgICAgICAgIC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgdGhpcy5zdGF0X2Rlc2MgPSBzdGF0X2Rlc2M7ICAgLyogdGhlIGNvcnJlc3BvbmRpbmcgc3RhdGljIHRyZWUgKi8KICB9CgoKCiAgY29uc3QgZF9jb2RlID0gKGRpc3QpID0+IHsKCiAgICByZXR1cm4gZGlzdCA8IDI1NiA/IF9kaXN0X2NvZGVbZGlzdF0gOiBfZGlzdF9jb2RlWzI1NiArIChkaXN0ID4+PiA3KV07CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIE91dHB1dCBhIHNob3J0IExTQiBmaXJzdCBvbiB0aGUgc3RyZWFtLgogICAqIElOIGFzc2VydGlvbjogdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4gcGVuZGluZ0J1Zi4KICAgKi8KICBjb25zdCBwdXRfc2hvcnQgPSAocywgdykgPT4gewogIC8vICAgIHB1dF9ieXRlKHMsICh1Y2gpKCh3KSAmIDB4ZmYpKTsKICAvLyAgICBwdXRfYnl0ZShzLCAodWNoKSgodXNoKSh3KSA+PiA4KSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3ID4+PiA4KSAmIDB4ZmY7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSB2YWx1ZSBvbiBhIGdpdmVuIG51bWJlciBvZiBiaXRzLgogICAqIElOIGFzc2VydGlvbjogbGVuZ3RoIDw9IDE2IGFuZCB2YWx1ZSBmaXRzIGluIGxlbmd0aCBiaXRzLgogICAqLwogIGNvbnN0IHNlbmRfYml0cyA9IChzLCB2YWx1ZSwgbGVuZ3RoKSA9PiB7CgogICAgaWYgKHMuYmlfdmFsaWQgPiAoQnVmX3NpemUgLSBsZW5ndGgpKSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgcy5iaV9idWYgPSB2YWx1ZSA+PiAoQnVmX3NpemUgLSBzLmJpX3ZhbGlkKTsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGggLSBCdWZfc2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGg7CiAgICB9CiAgfTsKCgogIGNvbnN0IHNlbmRfY29kZSA9IChzLCBjLCB0cmVlKSA9PiB7CgogICAgc2VuZF9iaXRzKHMsIHRyZWVbYyAqIDJdLyouQ29kZSovLCB0cmVlW2MgKiAyICsgMV0vKi5MZW4qLyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFJldmVyc2UgdGhlIGZpcnN0IGxlbiBiaXRzIG9mIGEgY29kZSwgdXNpbmcgc3RyYWlnaHRmb3J3YXJkIGNvZGUgKGEgZmFzdGVyCiAgICogbWV0aG9kIHdvdWxkIHVzZSBhIHRhYmxlKQogICAqIElOIGFzc2VydGlvbjogMSA8PSBsZW4gPD0gMTUKICAgKi8KICBjb25zdCBiaV9yZXZlcnNlID0gKGNvZGUsIGxlbikgPT4gewoKICAgIGxldCByZXMgPSAwOwogICAgZG8gewogICAgICByZXMgfD0gY29kZSAmIDE7CiAgICAgIGNvZGUgPj4+PSAxOwogICAgICByZXMgPDw9IDE7CiAgICB9IHdoaWxlICgtLWxlbiA+IDApOwogICAgcmV0dXJuIHJlcyA+Pj4gMTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRmx1c2ggdGhlIGJpdCBidWZmZXIsIGtlZXBpbmcgYXQgbW9zdCA3IGJpdHMgaW4gaXQuCiAgICovCiAgY29uc3QgYmlfZmx1c2ggPSAocykgPT4gewoKICAgIGlmIChzLmJpX3ZhbGlkID09PSAxNikgewogICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICBzLmJpX2J1ZiA9IDA7CiAgICAgIHMuYmlfdmFsaWQgPSAwOwoKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+PSA4KSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWYgJiAweGZmOwogICAgICBzLmJpX2J1ZiA+Pj0gODsKICAgICAgcy5iaV92YWxpZCAtPSA4OwogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wdXRlIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGhzIGZvciBhIHRyZWUgYW5kIHVwZGF0ZSB0aGUgdG90YWwgYml0IGxlbmd0aAogICAqIGZvciB0aGUgY3VycmVudCBibG9jay4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQsIGhlYXBbaGVhcF9tYXhdIGFuZAogICAqICAgIGFib3ZlIGFyZSB0aGUgdHJlZSBub2RlcyBzb3J0ZWQgYnkgaW5jcmVhc2luZyBmcmVxdWVuY3kuCiAgICogT1VUIGFzc2VydGlvbnM6IHRoZSBmaWVsZCBsZW4gaXMgc2V0IHRvIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGgsIHRoZQogICAqICAgICBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgZnJlcXVlbmNpZXMgZm9yIGVhY2ggYml0IGxlbmd0aC4KICAgKiAgICAgVGhlIGxlbmd0aCBvcHRfbGVuIGlzIHVwZGF0ZWQ7IHN0YXRpY19sZW4gaXMgYWxzbyB1cGRhdGVkIGlmIHN0cmVlIGlzCiAgICogICAgIG5vdCBudWxsLgogICAqLwogIGNvbnN0IGdlbl9iaXRsZW4gPSAocywgZGVzYykgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIHRyZWVfZGVzYyAqZGVzYzsgICAgLyogdGhlIHRyZWUgZGVzY3JpcHRvciAqLwogIHsKICAgIGNvbnN0IHRyZWUgICAgICAgICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBtYXhfY29kZSAgICAgICAgPSBkZXNjLm1heF9jb2RlOwogICAgY29uc3Qgc3RyZWUgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2Muc3RhdGljX3RyZWU7CiAgICBjb25zdCBoYXNfc3RyZWUgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICBjb25zdCBleHRyYSAgICAgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iaXRzOwogICAgY29uc3QgYmFzZSAgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2MuZXh0cmFfYmFzZTsKICAgIGNvbnN0IG1heF9sZW5ndGggICAgICA9IGRlc2Muc3RhdF9kZXNjLm1heF9sZW5ndGg7CiAgICBsZXQgaDsgICAgICAgICAgICAgIC8qIGhlYXAgaW5kZXggKi8KICAgIGxldCBuLCBtOyAgICAgICAgICAgLyogaXRlcmF0ZSBvdmVyIHRoZSB0cmVlIGVsZW1lbnRzICovCiAgICBsZXQgYml0czsgICAgICAgICAgIC8qIGJpdCBsZW5ndGggKi8KICAgIGxldCB4Yml0czsgICAgICAgICAgLyogZXh0cmEgYml0cyAqLwogICAgbGV0IGY7ICAgICAgICAgICAgICAvKiBmcmVxdWVuY3kgKi8KICAgIGxldCBvdmVyZmxvdyA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIHdpdGggYml0IGxlbmd0aCB0b28gbGFyZ2UgKi8KCiAgICBmb3IgKGJpdHMgPSAwOyBiaXRzIDw9IE1BWF9CSVRTJDE7IGJpdHMrKykgewogICAgICBzLmJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KCiAgICAvKiBJbiBhIGZpcnN0IHBhc3MsIGNvbXB1dGUgdGhlIG9wdGltYWwgYml0IGxlbmd0aHMgKHdoaWNoIG1heQogICAgICogb3ZlcmZsb3cgaW4gdGhlIGNhc2Ugb2YgdGhlIGJpdCBsZW5ndGggdHJlZSkuCiAgICAgKi8KICAgIHRyZWVbcy5oZWFwW3MuaGVhcF9tYXhdICogMiArIDFdLyouTGVuKi8gPSAwOyAvKiByb290IG9mIHRoZSBoZWFwICovCgogICAgZm9yIChoID0gcy5oZWFwX21heCArIDE7IGggPCBIRUFQX1NJWkUkMTsgaCsrKSB7CiAgICAgIG4gPSBzLmhlYXBbaF07CiAgICAgIGJpdHMgPSB0cmVlW3RyZWVbbiAqIDIgKyAxXS8qLkRhZCovICogMiArIDFdLyouTGVuKi8gKyAxOwogICAgICBpZiAoYml0cyA+IG1heF9sZW5ndGgpIHsKICAgICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgICBvdmVyZmxvdysrOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gYml0czsKICAgICAgLyogV2Ugb3ZlcndyaXRlIHRyZWVbbl0uRGFkIHdoaWNoIGlzIG5vIGxvbmdlciBuZWVkZWQgKi8KCiAgICAgIGlmIChuID4gbWF4X2NvZGUpIHsgY29udGludWU7IH0gLyogbm90IGEgbGVhZiBub2RlICovCgogICAgICBzLmJsX2NvdW50W2JpdHNdKys7CiAgICAgIHhiaXRzID0gMDsKICAgICAgaWYgKG4gPj0gYmFzZSkgewogICAgICAgIHhiaXRzID0gZXh0cmFbbiAtIGJhc2VdOwogICAgICB9CiAgICAgIGYgPSB0cmVlW24gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5vcHRfbGVuICs9IGYgKiAoYml0cyArIHhiaXRzKTsKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiArPSBmICogKHN0cmVlW24gKiAyICsgMV0vKi5MZW4qLyArIHhiaXRzKTsKICAgICAgfQogICAgfQogICAgaWYgKG92ZXJmbG93ID09PSAwKSB7IHJldHVybjsgfQoKICAgIC8vIFRyYWNlKChzdGRlcnIsIlxuYml0IGxlbmd0aCBvdmVyZmxvd1xuIikpOwogICAgLyogVGhpcyBoYXBwZW5zIGZvciBleGFtcGxlIG9uIG9iajIgYW5kIHBpYyBvZiB0aGUgQ2FsZ2FyeSBjb3JwdXMgKi8KCiAgICAvKiBGaW5kIHRoZSBmaXJzdCBiaXQgbGVuZ3RoIHdoaWNoIGNvdWxkIGluY3JlYXNlOiAqLwogICAgZG8gewogICAgICBiaXRzID0gbWF4X2xlbmd0aCAtIDE7CiAgICAgIHdoaWxlIChzLmJsX2NvdW50W2JpdHNdID09PSAwKSB7IGJpdHMtLTsgfQogICAgICBzLmJsX2NvdW50W2JpdHNdLS07ICAgICAgLyogbW92ZSBvbmUgbGVhZiBkb3duIHRoZSB0cmVlICovCiAgICAgIHMuYmxfY291bnRbYml0cyArIDFdICs9IDI7IC8qIG1vdmUgb25lIG92ZXJmbG93IGl0ZW0gYXMgaXRzIGJyb3RoZXIgKi8KICAgICAgcy5ibF9jb3VudFttYXhfbGVuZ3RoXS0tOwogICAgICAvKiBUaGUgYnJvdGhlciBvZiB0aGUgb3ZlcmZsb3cgaXRlbSBhbHNvIG1vdmVzIG9uZSBzdGVwIHVwLAogICAgICAgKiBidXQgdGhpcyBkb2VzIG5vdCBhZmZlY3QgYmxfY291bnRbbWF4X2xlbmd0aF0KICAgICAgICovCiAgICAgIG92ZXJmbG93IC09IDI7CiAgICB9IHdoaWxlIChvdmVyZmxvdyA+IDApOwoKICAgIC8qIE5vdyByZWNvbXB1dGUgYWxsIGJpdCBsZW5ndGhzLCBzY2FubmluZyBpbiBpbmNyZWFzaW5nIGZyZXF1ZW5jeS4KICAgICAqIGggaXMgc3RpbGwgZXF1YWwgdG8gSEVBUF9TSVpFLiAoSXQgaXMgc2ltcGxlciB0byByZWNvbnN0cnVjdCBhbGwKICAgICAqIGxlbmd0aHMgaW5zdGVhZCBvZiBmaXhpbmcgb25seSB0aGUgd3Jvbmcgb25lcy4gVGhpcyBpZGVhIGlzIHRha2VuCiAgICAgKiBmcm9tICdhcicgd3JpdHRlbiBieSBIYXJ1aGlrbyBPa3VtdXJhLikKICAgICAqLwogICAgZm9yIChiaXRzID0gbWF4X2xlbmd0aDsgYml0cyAhPT0gMDsgYml0cy0tKSB7CiAgICAgIG4gPSBzLmJsX2NvdW50W2JpdHNdOwogICAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICAgIG0gPSBzLmhlYXBbLS1oXTsKICAgICAgICBpZiAobSA+IG1heF9jb2RlKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgaWYgKHRyZWVbbSAqIDIgKyAxXS8qLkxlbiovICE9PSBiaXRzKSB7CiAgICAgICAgICAvLyBUcmFjZSgoc3RkZXJyLCJjb2RlICVkIGJpdHMgJWQtPiVkXG4iLCBtLCB0cmVlW21dLkxlbiwgYml0cykpOwogICAgICAgICAgcy5vcHRfbGVuICs9IChiaXRzIC0gdHJlZVttICogMiArIDFdLyouTGVuKi8pICogdHJlZVttICogMl0vKi5GcmVxKi87CiAgICAgICAgICB0cmVlW20gKiAyICsgMV0vKi5MZW4qLyA9IGJpdHM7CiAgICAgICAgfQogICAgICAgIG4tLTsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBHZW5lcmF0ZSB0aGUgY29kZXMgZm9yIGEgZ2l2ZW4gdHJlZSBhbmQgYml0IGNvdW50cyAod2hpY2ggbmVlZCBub3QgYmUKICAgKiBvcHRpbWFsKS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgYml0IGxlbmd0aCBzdGF0aXN0aWNzIGZvcgogICAqIHRoZSBnaXZlbiB0cmVlIGFuZCB0aGUgZmllbGQgbGVuIGlzIHNldCBmb3IgYWxsIHRyZWUgZWxlbWVudHMuCiAgICogT1VUIGFzc2VydGlvbjogdGhlIGZpZWxkIGNvZGUgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cyBvZiBub24KICAgKiAgICAgemVybyBjb2RlIGxlbmd0aC4KICAgKi8KICBjb25zdCBnZW5fY29kZXMgPSAodHJlZSwgbWF4X2NvZGUsIGJsX2NvdW50KSA9PgogIC8vICAgIGN0X2RhdGEgKnRyZWU7ICAgICAgICAgICAgIC8qIHRoZSB0cmVlIHRvIGRlY29yYXRlICovCiAgLy8gICAgaW50IG1heF9jb2RlOyAgICAgICAgICAgICAgLyogbGFyZ2VzdCBjb2RlIHdpdGggbm9uIHplcm8gZnJlcXVlbmN5ICovCiAgLy8gICAgdXNoZiAqYmxfY291bnQ7ICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCAqLwogIHsKICAgIGNvbnN0IG5leHRfY29kZSA9IG5ldyBBcnJheShNQVhfQklUUyQxICsgMSk7IC8qIG5leHQgY29kZSB2YWx1ZSBmb3IgZWFjaCBiaXQgbGVuZ3RoICovCiAgICBsZXQgY29kZSA9IDA7ICAgICAgICAgICAgICAvKiBydW5uaW5nIGNvZGUgdmFsdWUgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgIC8qIGJpdCBpbmRleCAqLwogICAgbGV0IG47ICAgICAgICAgICAgICAgICAgICAgLyogY29kZSBpbmRleCAqLwoKICAgIC8qIFRoZSBkaXN0cmlidXRpb24gY291bnRzIGFyZSBmaXJzdCB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjb2RlIHZhbHVlcwogICAgICogd2l0aG91dCBiaXQgcmV2ZXJzYWwuCiAgICAgKi8KICAgIGZvciAoYml0cyA9IDE7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSAoY29kZSArIGJsX2NvdW50W2JpdHMgLSAxXSkgPDwgMTsKICAgIH0KICAgIC8qIENoZWNrIHRoYXQgdGhlIGJpdCBjb3VudHMgaW4gYmxfY291bnQgYXJlIGNvbnNpc3RlbnQuIFRoZSBsYXN0IGNvZGUKICAgICAqIG11c3QgYmUgYWxsIG9uZXMuCiAgICAgKi8KICAgIC8vQXNzZXJ0IChjb2RlICsgYmxfY291bnRbTUFYX0JJVFNdLTEgPT0gKDE8PE1BWF9CSVRTKS0xLAogICAgLy8gICAgICAgICJpbmNvbnNpc3RlbnQgYml0IGNvdW50cyIpOwogICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5nZW5fY29kZXM6IG1heF9jb2RlICVkICIsIG1heF9jb2RlKSk7CgogICAgZm9yIChuID0gMDsgIG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICBsZXQgbGVuID0gdHJlZVtuICogMiArIDFdLyouTGVuKi87CiAgICAgIGlmIChsZW4gPT09IDApIHsgY29udGludWU7IH0KICAgICAgLyogTm93IHJldmVyc2UgdGhlIGJpdHMgKi8KICAgICAgdHJlZVtuICogMl0vKi5Db2RlKi8gPSBiaV9yZXZlcnNlKG5leHRfY29kZVtsZW5dKyssIGxlbik7CgogICAgICAvL1RyYWNlY3YodHJlZSAhPSBzdGF0aWNfbHRyZWUsIChzdGRlcnIsIlxubiAlM2QgJWMgbCAlMmQgYyAlNHggKCV4KSAiLAogICAgICAvLyAgICAgbiwgKGlzZ3JhcGgobikgPyBuIDogJyAnKSwgbGVuLCB0cmVlW25dLkNvZGUsIG5leHRfY29kZVtsZW5dLTEpKTsKICAgIH0KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgdmFyaW91cyAnY29uc3RhbnQnIHRhYmxlcy4KICAgKi8KICBjb25zdCB0cl9zdGF0aWNfaW5pdCA9ICgpID0+IHsKCiAgICBsZXQgbjsgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgdHJlZSBlbGVtZW50cyAqLwogICAgbGV0IGJpdHM7ICAgICAvKiBiaXQgY291bnRlciAqLwogICAgbGV0IGxlbmd0aDsgICAvKiBsZW5ndGggdmFsdWUgKi8KICAgIGxldCBjb2RlOyAgICAgLyogY29kZSB2YWx1ZSAqLwogICAgbGV0IGRpc3Q7ICAgICAvKiBkaXN0YW5jZSBpbmRleCAqLwogICAgY29uc3QgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy8gZG8gY2hlY2sgaW4gX3RyX2luaXQoKQogICAgLy9pZiAoc3RhdGljX2luaXRfZG9uZSkgcmV0dXJuOwoKICAgIC8qIEZvciBzb21lIGVtYmVkZGVkIHRhcmdldHMsIGdsb2JhbCB2YXJpYWJsZXMgYXJlIG5vdCBpbml0aWFsaXplZDogKi8KICAvKiNpZmRlZiBOT19JTklUX0dMT0JBTF9QT0lOVEVSUwogICAgc3RhdGljX2xfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19sdHJlZTsKICAgIHN0YXRpY19sX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2xiaXRzOwogICAgc3RhdGljX2RfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19kdHJlZTsKICAgIHN0YXRpY19kX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2RiaXRzOwogICAgc3RhdGljX2JsX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2JsYml0czsKICAjZW5kaWYqLwoKICAgIC8qIEluaXRpYWxpemUgdGhlIG1hcHBpbmcgbGVuZ3RoICgwLi4yNTUpIC0+IGxlbmd0aCBjb2RlICgwLi4yOCkgKi8KICAgIGxlbmd0aCA9IDA7CiAgICBmb3IgKGNvZGUgPSAwOyBjb2RlIDwgTEVOR1RIX0NPREVTJDEgLSAxOyBjb2RlKyspIHsKICAgICAgYmFzZV9sZW5ndGhbY29kZV0gPSBsZW5ndGg7CiAgICAgIGZvciAobiA9IDA7IG4gPCAoMSA8PCBleHRyYV9sYml0c1tjb2RlXSk7IG4rKykgewogICAgICAgIF9sZW5ndGhfY29kZVtsZW5ndGgrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAobGVuZ3RoID09IDI1NiwgInRyX3N0YXRpY19pbml0OiBsZW5ndGggIT0gMjU2Iik7CiAgICAvKiBOb3RlIHRoYXQgdGhlIGxlbmd0aCAyNTUgKG1hdGNoIGxlbmd0aCAyNTgpIGNhbiBiZSByZXByZXNlbnRlZAogICAgICogaW4gdHdvIGRpZmZlcmVudCB3YXlzOiBjb2RlIDI4NCArIDUgYml0cyBvciBjb2RlIDI4NSwgc28gd2UKICAgICAqIG92ZXJ3cml0ZSBsZW5ndGhfY29kZVsyNTVdIHRvIHVzZSB0aGUgYmVzdCBlbmNvZGluZzoKICAgICAqLwogICAgX2xlbmd0aF9jb2RlW2xlbmd0aCAtIDFdID0gY29kZTsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBtYXBwaW5nIGRpc3QgKDAuLjMySykgLT4gZGlzdCBjb2RlICgwLi4yOSkgKi8KICAgIGRpc3QgPSAwOwogICAgZm9yIChjb2RlID0gMDsgY29kZSA8IDE2OyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdDsKICAgICAgZm9yIChuID0gMDsgbiA8ICgxIDw8IGV4dHJhX2RiaXRzW2NvZGVdKTsgbisrKSB7CiAgICAgICAgX2Rpc3RfY29kZVtkaXN0KytdID0gY29kZTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGRpc3QgPT0gMjU2LCAidHJfc3RhdGljX2luaXQ6IGRpc3QgIT0gMjU2Iik7CiAgICBkaXN0ID4+PSA3OyAvKiBmcm9tIG5vdyBvbiwgYWxsIGRpc3RhbmNlcyBhcmUgZGl2aWRlZCBieSAxMjggKi8KICAgIGZvciAoOyBjb2RlIDwgRF9DT0RFUyQxOyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdCA8PCA3OwogICAgICBmb3IgKG4gPSAwOyBuIDwgKDEgPDwgKGV4dHJhX2RiaXRzW2NvZGVdIC0gNykpOyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlWzI1NiArIGRpc3QrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAoZGlzdCA9PSAyNTYsICJ0cl9zdGF0aWNfaW5pdDogMjU2K2Rpc3QgIT0gNTEyIik7CgogICAgLyogQ29uc3RydWN0IHRoZSBjb2RlcyBvZiB0aGUgc3RhdGljIGxpdGVyYWwgdHJlZSAqLwogICAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgICAgYmxfY291bnRbYml0c10gPSAwOwogICAgfQoKICAgIG4gPSAwOwogICAgd2hpbGUgKG4gPD0gMTQzKSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICB3aGlsZSAobiA8PSAyNTUpIHsKICAgICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDk7CiAgICAgIG4rKzsKICAgICAgYmxfY291bnRbOV0rKzsKICAgIH0KICAgIHdoaWxlIChuIDw9IDI3OSkgewogICAgICBzdGF0aWNfbHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNzsKICAgICAgbisrOwogICAgICBibF9jb3VudFs3XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjg3KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICAvKiBDb2RlcyAyODYgYW5kIDI4NyBkbyBub3QgZXhpc3QsIGJ1dCB3ZSBtdXN0IGluY2x1ZGUgdGhlbSBpbiB0aGUKICAgICAqIHRyZWUgY29uc3RydWN0aW9uIHRvIGdldCBhIGNhbm9uaWNhbCBIdWZmbWFuIHRyZWUgKGxvbmdlc3QgY29kZQogICAgICogYWxsIG9uZXMpCiAgICAgKi8KICAgIGdlbl9jb2RlcyhzdGF0aWNfbHRyZWUsIExfQ09ERVMkMSArIDEsIGJsX2NvdW50KTsKCiAgICAvKiBUaGUgc3RhdGljIGRpc3RhbmNlIHRyZWUgaXMgdHJpdmlhbDogKi8KICAgIGZvciAobiA9IDA7IG4gPCBEX0NPREVTJDE7IG4rKykgewogICAgICBzdGF0aWNfZHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNTsKICAgICAgc3RhdGljX2R0cmVlW24gKiAyXS8qLkNvZGUqLyA9IGJpX3JldmVyc2UobiwgNSk7CiAgICB9CgogICAgLy8gTm93IGRhdGEgcmVhZHkgYW5kIHdlIGNhbiBpbml0IHN0YXRpYyB0cmVlcwogICAgc3RhdGljX2xfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfbHRyZWUsIGV4dHJhX2xiaXRzLCBMSVRFUkFMUyQxICsgMSwgTF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19kX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2Moc3RhdGljX2R0cmVlLCBleHRyYV9kYml0cywgMCwgICAgICAgICAgRF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19ibF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKG5ldyBBcnJheSgwKSwgZXh0cmFfYmxiaXRzLCAwLCAgICAgICAgIEJMX0NPREVTJDEsIE1BWF9CTF9CSVRTKTsKCiAgICAvL3N0YXRpY19pbml0X2RvbmUgPSB0cnVlOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbml0aWFsaXplIGEgbmV3IGJsb2NrLgogICAqLwogIGNvbnN0IGluaXRfYmxvY2sgPSAocykgPT4gewoKICAgIGxldCBuOyAvKiBpdGVyYXRlcyBvdmVyIHRyZWUgZWxlbWVudHMgKi8KCiAgICAvKiBJbml0aWFsaXplIHRoZSB0cmVlcy4gKi8KICAgIGZvciAobiA9IDA7IG4gPCBMX0NPREVTJDE7ICBuKyspIHsgcy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovID0gMDsgfQogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgIG4rKykgeyBzLmR5bl9kdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CiAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVMkMTsgbisrKSB7IHMuYmxfdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CgogICAgcy5keW5fbHRyZWVbRU5EX0JMT0NLICogMl0vKi5GcmVxKi8gPSAxOwogICAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCB0aGUgYml0IGJ1ZmZlciBhbmQgYWxpZ24gdGhlIG91dHB1dCBvbiBhIGJ5dGUgYm91bmRhcnkKICAgKi8KICBjb25zdCBiaV93aW5kdXAgPSAocykgPT4KICB7CiAgICBpZiAocy5iaV92YWxpZCA+IDgpIHsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+IDApIHsKICAgICAgLy9wdXRfYnl0ZShzLCAoQnl0ZSlzLT5iaV9idWYpOwogICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmOwogICAgfQogICAgcy5iaV9idWYgPSAwOwogICAgcy5iaV92YWxpZCA9IDA7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ29weSBhIHN0b3JlZCBibG9jaywgc3RvcmluZyBmaXJzdCB0aGUgbGVuZ3RoIGFuZCBpdHMKICAgKiBvbmUncyBjb21wbGVtZW50IGlmIHJlcXVlc3RlZC4KICAgKi8KICBjb25zdCBjb3B5X2Jsb2NrID0gKHMsIGJ1ZiwgbGVuLCBoZWFkZXIpID0+CiAgLy9EZWZsYXRlU3RhdGUgKnM7CiAgLy9jaGFyZiAgICAqYnVmOyAgICAvKiB0aGUgaW5wdXQgZGF0YSAqLwogIC8vdW5zaWduZWQgbGVuOyAgICAgLyogaXRzIGxlbmd0aCAqLwogIC8vaW50ICAgICAgaGVhZGVyOyAgLyogdHJ1ZSBpZiBibG9jayBoZWFkZXIgbXVzdCBiZSB3cml0dGVuICovCiAgewogICAgYmlfd2luZHVwKHMpOyAgICAgICAgLyogYWxpZ24gb24gYnl0ZSBib3VuZGFyeSAqLwoKICAgIGlmIChoZWFkZXIpIHsKICAgICAgcHV0X3Nob3J0KHMsIGxlbik7CiAgICAgIHB1dF9zaG9ydChzLCB+bGVuKTsKICAgIH0KICAvLyAgd2hpbGUgKGxlbi0tKSB7CiAgLy8gICAgcHV0X2J5dGUocywgKmJ1ZisrKTsKICAvLyAgfQogICAgcy5wZW5kaW5nX2J1Zi5zZXQocy53aW5kb3cuc3ViYXJyYXkoYnVmLCBidWYgKyBsZW4pLCBzLnBlbmRpbmcpOwogICAgcy5wZW5kaW5nICs9IGxlbjsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wYXJlcyB0byBzdWJ0cmVlcywgdXNpbmcgdGhlIHRyZWUgZGVwdGggYXMgdGllIGJyZWFrZXIgd2hlbgogICAqIHRoZSBzdWJ0cmVlcyBoYXZlIGVxdWFsIGZyZXF1ZW5jeS4gVGhpcyBtaW5pbWl6ZXMgdGhlIHdvcnN0IGNhc2UgbGVuZ3RoLgogICAqLwogIGNvbnN0IHNtYWxsZXIgPSAodHJlZSwgbiwgbSwgZGVwdGgpID0+IHsKCiAgICBjb25zdCBfbjIgPSBuICogMjsKICAgIGNvbnN0IF9tMiA9IG0gKiAyOwogICAgcmV0dXJuICh0cmVlW19uMl0vKi5GcmVxKi8gPCB0cmVlW19tMl0vKi5GcmVxKi8gfHwKICAgICAgICAgICAodHJlZVtfbjJdLyouRnJlcSovID09PSB0cmVlW19tMl0vKi5GcmVxKi8gJiYgZGVwdGhbbl0gPD0gZGVwdGhbbV0pKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZXN0b3JlIHRoZSBoZWFwIHByb3BlcnR5IGJ5IG1vdmluZyBkb3duIHRoZSB0cmVlIHN0YXJ0aW5nIGF0IG5vZGUgaywKICAgKiBleGNoYW5naW5nIGEgbm9kZSB3aXRoIHRoZSBzbWFsbGVzdCBvZiBpdHMgdHdvIHNvbnMgaWYgbmVjZXNzYXJ5LCBzdG9wcGluZwogICAqIHdoZW4gdGhlIGhlYXAgcHJvcGVydHkgaXMgcmUtZXN0YWJsaXNoZWQgKGVhY2ggZmF0aGVyIHNtYWxsZXIgdGhhbiBpdHMKICAgKiB0d28gc29ucykuCiAgICovCiAgY29uc3QgcHFkb3duaGVhcCA9IChzLCB0cmVlLCBrKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgY3RfZGF0YSAqdHJlZTsgIC8qIHRoZSB0cmVlIHRvIHJlc3RvcmUgKi8KICAvLyAgICBpbnQgazsgICAgICAgICAgICAgICAvKiBub2RlIHRvIG1vdmUgZG93biAqLwogIHsKICAgIGNvbnN0IHYgPSBzLmhlYXBba107CiAgICBsZXQgaiA9IGsgPDwgMTsgIC8qIGxlZnQgc29uIG9mIGsgKi8KICAgIHdoaWxlIChqIDw9IHMuaGVhcF9sZW4pIHsKICAgICAgLyogU2V0IGogdG8gdGhlIHNtYWxsZXN0IG9mIHRoZSB0d28gc29uczogKi8KICAgICAgaWYgKGogPCBzLmhlYXBfbGVuICYmCiAgICAgICAgc21hbGxlcih0cmVlLCBzLmhlYXBbaiArIDFdLCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIC8qIEV4aXQgaWYgdiBpcyBzbWFsbGVyIHRoYW4gYm90aCBzb25zICovCiAgICAgIGlmIChzbWFsbGVyKHRyZWUsIHYsIHMuaGVhcFtqXSwgcy5kZXB0aCkpIHsgYnJlYWs7IH0KCiAgICAgIC8qIEV4Y2hhbmdlIHYgd2l0aCB0aGUgc21hbGxlc3Qgc29uICovCiAgICAgIHMuaGVhcFtrXSA9IHMuaGVhcFtqXTsKICAgICAgayA9IGo7CgogICAgICAvKiBBbmQgY29udGludWUgZG93biB0aGUgdHJlZSwgc2V0dGluZyBqIHRvIHRoZSBsZWZ0IHNvbiBvZiBrICovCiAgICAgIGogPDw9IDE7CiAgICB9CiAgICBzLmhlYXBba10gPSB2OwogIH07CgoKICAvLyBpbmxpbmVkIG1hbnVhbGx5CiAgLy8gY29uc3QgU01BTExFU1QgPSAxOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTZW5kIHRoZSBibG9jayBkYXRhIGNvbXByZXNzZWQgdXNpbmcgdGhlIGdpdmVuIEh1ZmZtYW4gdHJlZXMKICAgKi8KICBjb25zdCBjb21wcmVzc19ibG9jayA9IChzLCBsdHJlZSwgZHRyZWUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjb25zdCBjdF9kYXRhICpsdHJlZTsgLyogbGl0ZXJhbCB0cmVlICovCiAgLy8gICAgY29uc3QgY3RfZGF0YSAqZHRyZWU7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICB7CiAgICBsZXQgZGlzdDsgICAgICAgICAgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgICBsZXQgbGM7ICAgICAgICAgICAgIC8qIG1hdGNoIGxlbmd0aCBvciB1bm1hdGNoZWQgY2hhciAoaWYgZGlzdCA9PSAwKSAqLwogICAgbGV0IGx4ID0gMDsgICAgICAgICAvKiBydW5uaW5nIGluZGV4IGluIGxfYnVmICovCiAgICBsZXQgY29kZTsgICAgICAgICAgIC8qIHRoZSBjb2RlIHRvIHNlbmQgKi8KICAgIGxldCBleHRyYTsgICAgICAgICAgLyogbnVtYmVyIG9mIGV4dHJhIGJpdHMgdG8gc2VuZCAqLwoKICAgIGlmIChzLmxhc3RfbGl0ICE9PSAwKSB7CiAgICAgIGRvIHsKICAgICAgICBkaXN0ID0gKHMucGVuZGluZ19idWZbcy5kX2J1ZiArIGx4ICogMl0gPDwgOCkgfCAocy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV0pOwogICAgICAgIGxjID0gcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgbHhdOwogICAgICAgIGx4Kys7CgogICAgICAgIGlmIChkaXN0ID09PSAwKSB7CiAgICAgICAgICBzZW5kX2NvZGUocywgbGMsIGx0cmVlKTsgLyogc2VuZCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgICAgLy9UcmFjZWN2KGlzZ3JhcGgobGMpLCAoc3RkZXJyLCIgJyVjJyAiLCBsYykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBIZXJlLCBsYyBpcyB0aGUgbWF0Y2ggbGVuZ3RoIC0gTUlOX01BVENIICovCiAgICAgICAgICBjb2RlID0gX2xlbmd0aF9jb2RlW2xjXTsKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlICsgTElURVJBTFMkMSArIDEsIGx0cmVlKTsgLyogc2VuZCB0aGUgbGVuZ3RoIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfbGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgbGMgLT0gYmFzZV9sZW5ndGhbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBsYywgZXh0cmEpOyAgICAgICAvKiBzZW5kIHRoZSBleHRyYSBsZW5ndGggYml0cyAqLwogICAgICAgICAgfQogICAgICAgICAgZGlzdC0tOyAvKiBkaXN0IGlzIG5vdyB0aGUgbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgICAgICBjb2RlID0gZF9jb2RlKGRpc3QpOwogICAgICAgICAgLy9Bc3NlcnQgKGNvZGUgPCBEX0NPREVTLCAiYmFkIGRfY29kZSIpOwoKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlLCBkdHJlZSk7ICAgICAgIC8qIHNlbmQgdGhlIGRpc3RhbmNlIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfZGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgZGlzdCAtPSBiYXNlX2Rpc3RbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBkaXN0LCBleHRyYSk7ICAgLyogc2VuZCB0aGUgZXh0cmEgZGlzdGFuY2UgYml0cyAqLwogICAgICAgICAgfQogICAgICAgIH0gLyogbGl0ZXJhbCBvciBtYXRjaCBwYWlyID8gKi8KCiAgICAgICAgLyogQ2hlY2sgdGhhdCB0aGUgb3ZlcmxheSBiZXR3ZWVuIHBlbmRpbmdfYnVmIGFuZCBkX2J1ZitsX2J1ZiBpcyBvazogKi8KICAgICAgICAvL0Fzc2VydCgodUludCkocy0+cGVuZGluZykgPCBzLT5saXRfYnVmc2l6ZSArIDIqbHgsCiAgICAgICAgLy8gICAgICAgInBlbmRpbmdCdWYgb3ZlcmZsb3ciKTsKCiAgICAgIH0gd2hpbGUgKGx4IDwgcy5sYXN0X2xpdCk7CiAgICB9CgogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgbHRyZWUpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3Qgb25lIEh1ZmZtYW4gdHJlZSBhbmQgYXNzaWducyB0aGUgY29kZSBiaXQgc3RyaW5ncyBhbmQgbGVuZ3Rocy4KICAgKiBVcGRhdGUgdGhlIHRvdGFsIGJpdCBsZW5ndGggZm9yIHRoZSBjdXJyZW50IGJsb2NrLgogICAqIElOIGFzc2VydGlvbjogdGhlIGZpZWxkIGZyZXEgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cy4KICAgKiBPVVQgYXNzZXJ0aW9uczogdGhlIGZpZWxkcyBsZW4gYW5kIGNvZGUgYXJlIHNldCB0byB0aGUgb3B0aW1hbCBiaXQgbGVuZ3RoCiAgICogICAgIGFuZCBjb3JyZXNwb25kaW5nIGNvZGUuIFRoZSBsZW5ndGggb3B0X2xlbiBpcyB1cGRhdGVkOyBzdGF0aWNfbGVuIGlzCiAgICogICAgIGFsc28gdXBkYXRlZCBpZiBzdHJlZSBpcyBub3QgbnVsbC4gVGhlIGZpZWxkIG1heF9jb2RlIGlzIHNldC4KICAgKi8KICBjb25zdCBidWlsZF90cmVlID0gKHMsIGRlc2MpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICB0cmVlX2Rlc2MgKmRlc2M7IC8qIHRoZSB0cmVlIGRlc2NyaXB0b3IgKi8KICB7CiAgICBjb25zdCB0cmVlICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBzdHJlZSAgICA9IGRlc2Muc3RhdF9kZXNjLnN0YXRpY190cmVlOwogICAgY29uc3QgaGFzX3N0cmVlID0gZGVzYy5zdGF0X2Rlc2MuaGFzX3N0cmVlOwogICAgY29uc3QgZWxlbXMgICAgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICAgIGxldCBuLCBtOyAgICAgICAgICAvKiBpdGVyYXRlIG92ZXIgaGVhcCBlbGVtZW50cyAqLwogICAgbGV0IG1heF9jb2RlID0gLTE7IC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgbGV0IG5vZGU7ICAgICAgICAgIC8qIG5ldyBub2RlIGJlaW5nIGNyZWF0ZWQgKi8KCiAgICAvKiBDb25zdHJ1Y3QgdGhlIGluaXRpYWwgaGVhcCwgd2l0aCBsZWFzdCBmcmVxdWVudCBlbGVtZW50IGluCiAgICAgKiBoZWFwW1NNQUxMRVNUXS4gVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4KICAgICAqIGhlYXBbMF0gaXMgbm90IHVzZWQuCiAgICAgKi8KICAgIHMuaGVhcF9sZW4gPSAwOwogICAgcy5oZWFwX21heCA9IEhFQVBfU0laRSQxOwoKICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgIGlmICh0cmVlW24gKiAyXS8qLkZyZXEqLyAhPT0gMCkgewogICAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICAgIHMuZGVwdGhbbl0gPSAwOwoKICAgICAgfSBlbHNlIHsKICAgICAgICB0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDA7CiAgICAgIH0KICAgIH0KCiAgICAvKiBUaGUgcGt6aXAgZm9ybWF0IHJlcXVpcmVzIHRoYXQgYXQgbGVhc3Qgb25lIGRpc3RhbmNlIGNvZGUgZXhpc3RzLAogICAgICogYW5kIHRoYXQgYXQgbGVhc3Qgb25lIGJpdCBzaG91bGQgYmUgc2VudCBldmVuIGlmIHRoZXJlIGlzIG9ubHkgb25lCiAgICAgKiBwb3NzaWJsZSBjb2RlLiBTbyB0byBhdm9pZCBzcGVjaWFsIGNoZWNrcyBsYXRlciBvbiB3ZSBmb3JjZSBhdCBsZWFzdAogICAgICogdHdvIGNvZGVzIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeS4KICAgICAqLwogICAgd2hpbGUgKHMuaGVhcF9sZW4gPCAyKSB7CiAgICAgIG5vZGUgPSBzLmhlYXBbKytzLmhlYXBfbGVuXSA9IChtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMCk7CiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gMTsKICAgICAgcy5kZXB0aFtub2RlXSA9IDA7CiAgICAgIHMub3B0X2xlbi0tOwoKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiAtPSBzdHJlZVtub2RlICogMiArIDFdLyouTGVuKi87CiAgICAgIH0KICAgICAgLyogbm9kZSBpcyAwIG9yIDEgc28gaXQgZG9lcyBub3QgaGF2ZSBleHRyYSBiaXRzICovCiAgICB9CiAgICBkZXNjLm1heF9jb2RlID0gbWF4X2NvZGU7CgogICAgLyogVGhlIGVsZW1lbnRzIGhlYXBbaGVhcF9sZW4vMisxIC4uIGhlYXBfbGVuXSBhcmUgbGVhdmVzIG9mIHRoZSB0cmVlLAogICAgICogZXN0YWJsaXNoIHN1Yi1oZWFwcyBvZiBpbmNyZWFzaW5nIGxlbmd0aHM6CiAgICAgKi8KICAgIGZvciAobiA9IChzLmhlYXBfbGVuID4+IDEvKmludCAvMiovKTsgbiA+PSAxOyBuLS0pIHsgcHFkb3duaGVhcChzLCB0cmVlLCBuKTsgfQoKICAgIC8qIENvbnN0cnVjdCB0aGUgSHVmZm1hbiB0cmVlIGJ5IHJlcGVhdGVkbHkgY29tYmluaW5nIHRoZSBsZWFzdCB0d28KICAgICAqIGZyZXF1ZW50IG5vZGVzLgogICAgICovCiAgICBub2RlID0gZWxlbXM7ICAgICAgICAgICAgICAvKiBuZXh0IGludGVybmFsIG5vZGUgb2YgdGhlIHRyZWUgKi8KICAgIGRvIHsKICAgICAgLy9wcXJlbW92ZShzLCB0cmVlLCBuKTsgIC8qIG4gPSBub2RlIG9mIGxlYXN0IGZyZXF1ZW5jeSAqLwogICAgICAvKioqIHBxcmVtb3ZlICoqKi8KICAgICAgbiA9IHMuaGVhcFsxLypTTUFMTEVTVCovXTsKICAgICAgcy5oZWFwWzEvKlNNQUxMRVNUKi9dID0gcy5oZWFwW3MuaGVhcF9sZW4tLV07CiAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMS8qU01BTExFU1QqLyk7CiAgICAgIC8qKiovCgogICAgICBtID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOyAvKiBtID0gbm9kZSBvZiBuZXh0IGxlYXN0IGZyZXF1ZW5jeSAqLwoKICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBuOyAvKiBrZWVwIHRoZSBub2RlcyBzb3J0ZWQgYnkgZnJlcXVlbmN5ICovCiAgICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gbTsKCiAgICAgIC8qIENyZWF0ZSBhIG5ldyBub2RlIGZhdGhlciBvZiBuIGFuZCBtICovCiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gdHJlZVtuICogMl0vKi5GcmVxKi8gKyB0cmVlW20gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgICB0cmVlW24gKiAyICsgMV0vKi5EYWQqLyA9IHRyZWVbbSAqIDIgKyAxXS8qLkRhZCovID0gbm9kZTsKCiAgICAgIC8qIGFuZCBpbnNlcnQgdGhlIG5ldyBub2RlIGluIHRoZSBoZWFwICovCiAgICAgIHMuaGVhcFsxLypTTUFMTEVTVCovXSA9IG5vZGUrKzsKICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCAxLypTTUFMTEVTVCovKTsKCiAgICB9IHdoaWxlIChzLmhlYXBfbGVuID49IDIpOwoKICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOwoKICAgIC8qIEF0IHRoaXMgcG9pbnQsIHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQuIFdlIGNhbiBub3cKICAgICAqIGdlbmVyYXRlIHRoZSBiaXQgbGVuZ3Rocy4KICAgICAqLwogICAgZ2VuX2JpdGxlbihzLCBkZXNjKTsKCiAgICAvKiBUaGUgZmllbGQgbGVuIGlzIG5vdyBzZXQsIHdlIGNhbiBnZW5lcmF0ZSB0aGUgYml0IGNvZGVzICovCiAgICBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIHMuYmxfY291bnQpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTY2FuIGEgbGl0ZXJhbCBvciBkaXN0YW5jZSB0cmVlIHRvIGRldGVybWluZSB0aGUgZnJlcXVlbmNpZXMgb2YgdGhlIGNvZGVzCiAgICogaW4gdGhlIGJpdCBsZW5ndGggdHJlZS4KICAgKi8KICBjb25zdCBzY2FuX3RyZWUgPSAocywgdHJlZSwgbWF4X2NvZGUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjdF9kYXRhICp0cmVlOyAgIC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgIG1pbl9jb3VudCA9IDM7CiAgICB9CiAgICB0cmVlWyhtYXhfY29kZSArIDEpICogMiArIDFdLyouTGVuKi8gPSAweGZmZmY7IC8qIGd1YXJkICovCgogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgIG5leHRsZW4gPSB0cmVlWyhuICsgMSkgKiAyICsgMV0vKi5MZW4qLzsKCiAgICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIGNvbnRpbnVlOwoKICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgIHMuYmxfdHJlZVtjdXJsZW4gKiAyXS8qLkZyZXEqLyArPSBjb3VudDsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CgogICAgICAgIGlmIChjdXJsZW4gIT09IHByZXZsZW4pIHsgcy5ibF90cmVlW2N1cmxlbiAqIDJdLyouRnJlcSovKys7IH0KICAgICAgICBzLmJsX3RyZWVbUkVQXzNfNiAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfM18xMCAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgewogICAgICAgIHMuYmxfdHJlZVtSRVBaXzExXzEzOCAqIDJdLyouRnJlcSovKys7CiAgICAgIH0KCiAgICAgIGNvdW50ID0gMDsKICAgICAgcHJldmxlbiA9IGN1cmxlbjsKCiAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgICAgbWluX2NvdW50ID0gMzsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWF4X2NvdW50ID0gNzsKICAgICAgICBtaW5fY291bnQgPSA0OwogICAgICB9CiAgICB9CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBsaXRlcmFsIG9yIGRpc3RhbmNlIHRyZWUgaW4gY29tcHJlc3NlZCBmb3JtLCB1c2luZyB0aGUgY29kZXMgaW4KICAgKiBibF90cmVlLgogICAqLwogIGNvbnN0IHNlbmRfdHJlZSA9IChzLCB0cmVlLCBtYXhfY29kZSkgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIGN0X2RhdGEgKnRyZWU7IC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICAvKiB0cmVlW21heF9jb2RlKzFdLkxlbiA9IC0xOyAqLyAgLyogZ3VhcmQgYWxyZWFkeSBzZXQgKi8KICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgbWluX2NvdW50ID0gMzsKICAgIH0KCiAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgY3VybGVuID0gbmV4dGxlbjsKICAgICAgbmV4dGxlbiA9IHRyZWVbKG4gKyAxKSAqIDIgKyAxXS8qLkxlbiovOwoKICAgICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgY29udGludWU7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgICAgZG8geyBzZW5kX2NvZGUocywgY3VybGVuLCBzLmJsX3RyZWUpOyB9IHdoaWxlICgtLWNvdW50ICE9PSAwKTsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CiAgICAgICAgaWYgKGN1cmxlbiAhPT0gcHJldmxlbikgewogICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICAgIGNvdW50LS07CiAgICAgICAgfQogICAgICAgIC8vQXNzZXJ0KGNvdW50ID49IDMgJiYgY291bnQgPD0gNiwgIiAzXzY/Iik7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUF8zXzYsIHMuYmxfdHJlZSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfM18xMCwgcy5ibF90cmVlKTsKICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAzLCAzKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfMTFfMTM4LCBzLmJsX3RyZWUpOwogICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDExLCA3KTsKICAgICAgfQoKICAgICAgY291bnQgPSAwOwogICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICBtaW5fY291bnQgPSAzOwoKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICBtYXhfY291bnQgPSA2OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgewogICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3QgdGhlIEh1ZmZtYW4gdHJlZSBmb3IgdGhlIGJpdCBsZW5ndGhzIGFuZCByZXR1cm4gdGhlIGluZGV4IGluCiAgICogYmxfb3JkZXIgb2YgdGhlIGxhc3QgYml0IGxlbmd0aCBjb2RlIHRvIHNlbmQuCiAgICovCiAgY29uc3QgYnVpbGRfYmxfdHJlZSA9IChzKSA9PiB7CgogICAgbGV0IG1heF9ibGluZGV4OyAgLyogaW5kZXggb2YgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgb2Ygbm9uIHplcm8gZnJlcSAqLwoKICAgIC8qIERldGVybWluZSB0aGUgYml0IGxlbmd0aCBmcmVxdWVuY2llcyBmb3IgbGl0ZXJhbCBhbmQgZGlzdGFuY2UgdHJlZXMgKi8KICAgIHNjYW5fdHJlZShzLCBzLmR5bl9sdHJlZSwgcy5sX2Rlc2MubWF4X2NvZGUpOwogICAgc2Nhbl90cmVlKHMsIHMuZHluX2R0cmVlLCBzLmRfZGVzYy5tYXhfY29kZSk7CgogICAgLyogQnVpbGQgdGhlIGJpdCBsZW5ndGggdHJlZTogKi8KICAgIGJ1aWxkX3RyZWUocywgcy5ibF9kZXNjKTsKICAgIC8qIG9wdF9sZW4gbm93IGluY2x1ZGVzIHRoZSBsZW5ndGggb2YgdGhlIHRyZWUgcmVwcmVzZW50YXRpb25zLCBleGNlcHQKICAgICAqIHRoZSBsZW5ndGhzIG9mIHRoZSBiaXQgbGVuZ3RocyBjb2RlcyBhbmQgdGhlIDUrNSs0IGJpdHMgZm9yIHRoZSBjb3VudHMuCiAgICAgKi8KCiAgICAvKiBEZXRlcm1pbmUgdGhlIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzIHRvIHNlbmQuIFRoZSBwa3ppcCBmb3JtYXQKICAgICAqIHJlcXVpcmVzIHRoYXQgYXQgbGVhc3QgNCBiaXQgbGVuZ3RoIGNvZGVzIGJlIHNlbnQuIChhcHBub3RlLnR4dCBzYXlzCiAgICAgKiAzIGJ1dCB0aGUgYWN0dWFsIHZhbHVlIHVzZWQgaXMgNC4pCiAgICAgKi8KICAgIGZvciAobWF4X2JsaW5kZXggPSBCTF9DT0RFUyQxIC0gMTsgbWF4X2JsaW5kZXggPj0gMzsgbWF4X2JsaW5kZXgtLSkgewogICAgICBpZiAocy5ibF90cmVlW2JsX29yZGVyW21heF9ibGluZGV4XSAqIDIgKyAxXS8qLkxlbiovICE9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qIFVwZGF0ZSBvcHRfbGVuIHRvIGluY2x1ZGUgdGhlIGJpdCBsZW5ndGggdHJlZSBhbmQgY291bnRzICovCiAgICBzLm9wdF9sZW4gKz0gMyAqIChtYXhfYmxpbmRleCArIDEpICsgNSArIDUgKyA0OwogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuZHluIHRyZWVzOiBkeW4gJWxkLCBzdGF0ICVsZCIsCiAgICAvLyAgICAgICAgcy0+b3B0X2xlbiwgcy0+c3RhdGljX2xlbikpOwoKICAgIHJldHVybiBtYXhfYmxpbmRleDsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCB0aGUgaGVhZGVyIGZvciBhIGJsb2NrIHVzaW5nIGR5bmFtaWMgSHVmZm1hbiB0cmVlczogdGhlIGNvdW50cywgdGhlCiAgICogbGVuZ3RocyBvZiB0aGUgYml0IGxlbmd0aCBjb2RlcywgdGhlIGxpdGVyYWwgdHJlZSBhbmQgdGhlIGRpc3RhbmNlIHRyZWUuCiAgICogSU4gYXNzZXJ0aW9uOiBsY29kZXMgPj0gMjU3LCBkY29kZXMgPj0gMSwgYmxjb2RlcyA+PSA0LgogICAqLwogIGNvbnN0IHNlbmRfYWxsX3RyZWVzID0gKHMsIGxjb2RlcywgZGNvZGVzLCBibGNvZGVzKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgaW50IGxjb2RlcywgZGNvZGVzLCBibGNvZGVzOyAvKiBudW1iZXIgb2YgY29kZXMgZm9yIGVhY2ggdHJlZSAqLwogIHsKICAgIGxldCByYW5rOyAgICAgICAgICAgICAgICAgICAgLyogaW5kZXggaW4gYmxfb3JkZXIgKi8KCiAgICAvL0Fzc2VydCAobGNvZGVzID49IDI1NyAmJiBkY29kZXMgPj0gMSAmJiBibGNvZGVzID49IDQsICJub3QgZW5vdWdoIGNvZGVzIik7CiAgICAvL0Fzc2VydCAobGNvZGVzIDw9IExfQ09ERVMgJiYgZGNvZGVzIDw9IERfQ09ERVMgJiYgYmxjb2RlcyA8PSBCTF9DT0RFUywKICAgIC8vICAgICAgICAidG9vIG1hbnkgY29kZXMiKTsKICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmJsIGNvdW50czogIikpOwogICAgc2VuZF9iaXRzKHMsIGxjb2RlcyAtIDI1NywgNSk7IC8qIG5vdCArMjU1IGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgc2VuZF9iaXRzKHMsIGRjb2RlcyAtIDEsICAgNSk7CiAgICBzZW5kX2JpdHMocywgYmxjb2RlcyAtIDQsICA0KTsgLyogbm90IC0zIGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgZm9yIChyYW5rID0gMDsgcmFuayA8IGJsY29kZXM7IHJhbmsrKykgewogICAgICAvL1RyYWNldigoc3RkZXJyLCAiXG5ibCBjb2RlICUyZCAiLCBibF9vcmRlcltyYW5rXSkpOwogICAgICBzZW5kX2JpdHMocywgcy5ibF90cmVlW2JsX29yZGVyW3JhbmtdICogMiArIDFdLyouTGVuKi8sIDMpOwogICAgfQogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuYmwgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKCiAgICBzZW5kX3RyZWUocywgcy5keW5fbHRyZWUsIGxjb2RlcyAtIDEpOyAvKiBsaXRlcmFsIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmxpdCB0cmVlOiBzZW50ICVsZCIsIHMtPmJpdHNfc2VudCkpOwoKICAgIHNlbmRfdHJlZShzLCBzLmR5bl9kdHJlZSwgZGNvZGVzIC0gMSk7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ2hlY2sgaWYgdGhlIGRhdGEgdHlwZSBpcyBURVhUIG9yIEJJTkFSWSwgdXNpbmcgdGhlIGZvbGxvd2luZyBhbGdvcml0aG06CiAgICogLSBURVhUIGlmIHRoZSB0d28gY29uZGl0aW9ucyBiZWxvdyBhcmUgc2F0aXNmaWVkOgogICAqICAgIGEpIFRoZXJlIGFyZSBubyBub24tcG9ydGFibGUgY29udHJvbCBjaGFyYWN0ZXJzIGJlbG9uZ2luZyB0byB0aGUKICAgKiAgICAgICAiYmxhY2sgbGlzdCIgKDAuLjYsIDE0Li4yNSwgMjguLjMxKS4KICAgKiAgICBiKSBUaGVyZSBpcyBhdCBsZWFzdCBvbmUgcHJpbnRhYmxlIGNoYXJhY3RlciBiZWxvbmdpbmcgdG8gdGhlCiAgICogICAgICAgIndoaXRlIGxpc3QiICg5IHtUQUJ9LCAxMCB7TEZ9LCAxMyB7Q1J9LCAzMi4uMjU1KS4KICAgKiAtIEJJTkFSWSBvdGhlcndpc2UuCiAgICogLSBUaGUgZm9sbG93aW5nIHBhcnRpYWxseS1wb3J0YWJsZSBjb250cm9sIGNoYXJhY3RlcnMgZm9ybSBhCiAgICogICAiZ3JheSBsaXN0IiB0aGF0IGlzIGlnbm9yZWQgaW4gdGhpcyBkZXRlY3Rpb24gYWxnb3JpdGhtOgogICAqICAgKDcge0JFTH0sIDgge0JTfSwgMTEge1ZUfSwgMTIge0ZGfSwgMjYge1NVQn0sIDI3IHtFU0N9KS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgRnJlcSBvZiBkeW5fbHRyZWUgYXJlIHNldC4KICAgKi8KICBjb25zdCBkZXRlY3RfZGF0YV90eXBlID0gKHMpID0+IHsKICAgIC8qIGJsYWNrX21hc2sgaXMgdGhlIGJpdCBtYXNrIG9mIGJsYWNrLWxpc3RlZCBieXRlcwogICAgICogc2V0IGJpdHMgMC4uNiwgMTQuLjI1LCBhbmQgMjguLjMxCiAgICAgKiAweGYzZmZjMDdmID0gYmluYXJ5IDExMTEwMDExMTExMTExMTExMTAwMDAwMDAxMTExMTExCiAgICAgKi8KICAgIGxldCBibGFja19tYXNrID0gMHhmM2ZmYzA3ZjsKICAgIGxldCBuOwoKICAgIC8qIENoZWNrIGZvciBub24tdGV4dHVhbCAoImJsYWNrLWxpc3RlZCIpIGJ5dGVzLiAqLwogICAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgICBpZiAoKGJsYWNrX21hc2sgJiAxKSAmJiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSkgewogICAgICAgIHJldHVybiBaX0JJTkFSWTsKICAgICAgfQogICAgfQoKICAgIC8qIENoZWNrIGZvciB0ZXh0dWFsICgid2hpdGUtbGlzdGVkIikgYnl0ZXMuICovCiAgICBpZiAocy5keW5fbHRyZWVbOSAqIDJdLyouRnJlcSovICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0vKi5GcmVxKi8gIT09IDAgfHwKICAgICAgICBzLmR5bl9sdHJlZVsxMyAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgIHJldHVybiBaX1RFWFQ7CiAgICB9CiAgICBmb3IgKG4gPSAzMjsgbiA8IExJVEVSQUxTJDE7IG4rKykgewogICAgICBpZiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIFpfVEVYVDsKICAgICAgfQogICAgfQoKICAgIC8qIFRoZXJlIGFyZSBubyAiYmxhY2stbGlzdGVkIiBvciAid2hpdGUtbGlzdGVkIiBieXRlczoKICAgICAqIHRoaXMgc3RyZWFtIGVpdGhlciBpcyBlbXB0eSBvciBoYXMgdG9sZXJhdGVkICgiZ3JheS1saXN0ZWQiKSBieXRlcyBvbmx5LgogICAgICovCiAgICByZXR1cm4gWl9CSU5BUlk7CiAgfTsKCgogIGxldCBzdGF0aWNfaW5pdF9kb25lID0gZmFsc2U7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemUgdGhlIHRyZWUgZGF0YSBzdHJ1Y3R1cmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbS4KICAgKi8KICBjb25zdCBfdHJfaW5pdCQxID0gKHMpID0+CiAgewoKICAgIGlmICghc3RhdGljX2luaXRfZG9uZSkgewogICAgICB0cl9zdGF0aWNfaW5pdCgpOwogICAgICBzdGF0aWNfaW5pdF9kb25lID0gdHJ1ZTsKICAgIH0KCiAgICBzLmxfZGVzYyAgPSBuZXcgVHJlZURlc2Mocy5keW5fbHRyZWUsIHN0YXRpY19sX2Rlc2MpOwogICAgcy5kX2Rlc2MgID0gbmV3IFRyZWVEZXNjKHMuZHluX2R0cmVlLCBzdGF0aWNfZF9kZXNjKTsKICAgIHMuYmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmJsX3RyZWUsIHN0YXRpY19ibF9kZXNjKTsKCiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBmaXJzdCBibG9jayBvZiB0aGUgZmlyc3QgZmlsZTogKi8KICAgIGluaXRfYmxvY2socyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBzdG9yZWQgYmxvY2sKICAgKi8KICBjb25zdCBfdHJfc3RvcmVkX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2sgKi8KICAvL3VsZyBzdG9yZWRfbGVuOyAgIC8qIGxlbmd0aCBvZiBpbnB1dCBibG9jayAqLwogIC8vaW50IGxhc3Q7ICAgICAgICAgLyogb25lIGlmIHRoaXMgaXMgdGhlIGxhc3QgYmxvY2sgZm9yIGEgZmlsZSAqLwogIHsKICAgIHNlbmRfYml0cyhzLCAoU1RPUkVEX0JMT0NLIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOyAgICAvKiBzZW5kIGJsb2NrIHR5cGUgKi8KICAgIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsgLyogd2l0aCBoZWFkZXIgKi8KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCBvbmUgZW1wdHkgc3RhdGljIGJsb2NrIHRvIGdpdmUgZW5vdWdoIGxvb2thaGVhZCBmb3IgaW5mbGF0ZS4KICAgKiBUaGlzIHRha2VzIDEwIGJpdHMsIG9mIHdoaWNoIDcgbWF5IHJlbWFpbiBpbiB0aGUgYml0IGJ1ZmZlci4KICAgKi8KICBjb25zdCBfdHJfYWxpZ24kMSA9IChzKSA9PiB7CiAgICBzZW5kX2JpdHMocywgU1RBVElDX1RSRUVTIDw8IDEsIDMpOwogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgc3RhdGljX2x0cmVlKTsKICAgIGJpX2ZsdXNoKHMpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBEZXRlcm1pbmUgdGhlIGJlc3QgZW5jb2RpbmcgZm9yIHRoZSBjdXJyZW50IGJsb2NrOiBkeW5hbWljIHRyZWVzLCBzdGF0aWMKICAgKiB0cmVlcyBvciBzdG9yZSwgYW5kIG91dHB1dCB0aGUgZW5jb2RlZCBibG9jayB0byB0aGUgemlwIGZpbGUuCiAgICovCiAgY29uc3QgX3RyX2ZsdXNoX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2ssIG9yIE5VTEwgaWYgdG9vIG9sZCAqLwogIC8vdWxnIHN0b3JlZF9sZW47ICAgLyogbGVuZ3RoIG9mIGlucHV0IGJsb2NrICovCiAgLy9pbnQgbGFzdDsgICAgICAgICAvKiBvbmUgaWYgdGhpcyBpcyB0aGUgbGFzdCBibG9jayBmb3IgYSBmaWxlICovCiAgewogICAgbGV0IG9wdF9sZW5iLCBzdGF0aWNfbGVuYjsgIC8qIG9wdF9sZW4gYW5kIHN0YXRpY19sZW4gaW4gYnl0ZXMgKi8KICAgIGxldCBtYXhfYmxpbmRleCA9IDA7ICAgICAgICAvKiBpbmRleCBvZiBsYXN0IGJpdCBsZW5ndGggY29kZSBvZiBub24gemVybyBmcmVxICovCgogICAgLyogQnVpbGQgdGhlIEh1ZmZtYW4gdHJlZXMgdW5sZXNzIGEgc3RvcmVkIGJsb2NrIGlzIGZvcmNlZCAqLwogICAgaWYgKHMubGV2ZWwgPiAwKSB7CgogICAgICAvKiBDaGVjayBpZiB0aGUgZmlsZSBpcyBiaW5hcnkgb3IgdGV4dCAqLwogICAgICBpZiAocy5zdHJtLmRhdGFfdHlwZSA9PT0gWl9VTktOT1dOJDEpIHsKICAgICAgICBzLnN0cm0uZGF0YV90eXBlID0gZGV0ZWN0X2RhdGFfdHlwZShzKTsKICAgICAgfQoKICAgICAgLyogQ29uc3RydWN0IHRoZSBsaXRlcmFsIGFuZCBkaXN0YW5jZSB0cmVlcyAqLwogICAgICBidWlsZF90cmVlKHMsIHMubF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmxpdCBkYXRhOiBkeW4gJWxkLCBzdGF0ICVsZCIsIHMtPm9wdF9sZW4sCiAgICAgIC8vICAgICAgICBzLT5zdGF0aWNfbGVuKSk7CgogICAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgZGF0YTogZHluICVsZCwgc3RhdCAlbGQiLCBzLT5vcHRfbGVuLAogICAgICAvLyAgICAgICAgcy0+c3RhdGljX2xlbikpOwogICAgICAvKiBBdCB0aGlzIHBvaW50LCBvcHRfbGVuIGFuZCBzdGF0aWNfbGVuIGFyZSB0aGUgdG90YWwgYml0IGxlbmd0aHMgb2YKICAgICAgICogdGhlIGNvbXByZXNzZWQgYmxvY2sgZGF0YSwgZXhjbHVkaW5nIHRoZSB0cmVlIHJlcHJlc2VudGF0aW9ucy4KICAgICAgICovCgogICAgICAvKiBCdWlsZCB0aGUgYml0IGxlbmd0aCB0cmVlIGZvciB0aGUgYWJvdmUgdHdvIHRyZWVzLCBhbmQgZ2V0IHRoZSBpbmRleAogICAgICAgKiBpbiBibF9vcmRlciBvZiB0aGUgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgdG8gc2VuZC4KICAgICAgICovCiAgICAgIG1heF9ibGluZGV4ID0gYnVpbGRfYmxfdHJlZShzKTsKCiAgICAgIC8qIERldGVybWluZSB0aGUgYmVzdCBlbmNvZGluZy4gQ29tcHV0ZSB0aGUgYmxvY2sgbGVuZ3RocyBpbiBieXRlcy4gKi8KICAgICAgb3B0X2xlbmIgPSAocy5vcHRfbGVuICsgMyArIDcpID4+PiAzOwogICAgICBzdGF0aWNfbGVuYiA9IChzLnN0YXRpY19sZW4gKyAzICsgNykgPj4+IDM7CgogICAgICAvLyBUcmFjZXYoKHN0ZGVyciwgIlxub3B0ICVsdSglbHUpIHN0YXQgJWx1KCVsdSkgc3RvcmVkICVsdSBsaXQgJXUgIiwKICAgICAgLy8gICAgICAgIG9wdF9sZW5iLCBzLT5vcHRfbGVuLCBzdGF0aWNfbGVuYiwgcy0+c3RhdGljX2xlbiwgc3RvcmVkX2xlbiwKICAgICAgLy8gICAgICAgIHMtPmxhc3RfbGl0KSk7CgogICAgICBpZiAoc3RhdGljX2xlbmIgPD0gb3B0X2xlbmIpIHsgb3B0X2xlbmIgPSBzdGF0aWNfbGVuYjsgfQoKICAgIH0gZWxzZSB7CiAgICAgIC8vIEFzc2VydChidWYgIT0gKGNoYXIqKTAsICJsb3N0IGJ1ZiIpOwogICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7IC8qIGZvcmNlIGEgc3RvcmVkIGJsb2NrICovCiAgICB9CgogICAgaWYgKChzdG9yZWRfbGVuICsgNCA8PSBvcHRfbGVuYikgJiYgKGJ1ZiAhPT0gLTEpKSB7CiAgICAgIC8qIDQ6IHR3byB3b3JkcyBmb3IgdGhlIGxlbmd0aHMgKi8KCiAgICAgIC8qIFRoZSB0ZXN0IGJ1ZiAhPSBOVUxMIGlzIG9ubHkgbmVjZXNzYXJ5IGlmIExJVF9CVUZTSVpFID4gV1NJWkUuCiAgICAgICAqIE90aGVyd2lzZSB3ZSBjYW4ndCBoYXZlIHByb2Nlc3NlZCBtb3JlIHRoYW4gV1NJWkUgaW5wdXQgYnl0ZXMgc2luY2UKICAgICAgICogdGhlIGxhc3QgYmxvY2sgZmx1c2gsIGJlY2F1c2UgY29tcHJlc3Npb24gd291bGQgaGF2ZSBiZWVuCiAgICAgICAqIHN1Y2Nlc3NmdWwuIElmIExJVF9CVUZTSVpFIDw9IFdTSVpFLCBpdCBpcyBuZXZlciB0b28gbGF0ZSB0bwogICAgICAgKiB0cmFuc2Zvcm0gYSBibG9jayBpbnRvIGEgc3RvcmVkIGJsb2NrLgogICAgICAgKi8KICAgICAgX3RyX3N0b3JlZF9ibG9jayQxKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCk7CgogICAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEJDEgfHwgc3RhdGljX2xlbmIgPT09IG9wdF9sZW5iKSB7CgogICAgICBzZW5kX2JpdHMocywgKFNUQVRJQ19UUkVFUyA8PCAxKSArIChsYXN0ID8gMSA6IDApLCAzKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgc3RhdGljX2x0cmVlLCBzdGF0aWNfZHRyZWUpOwoKICAgIH0gZWxzZSB7CiAgICAgIHNlbmRfYml0cyhzLCAoRFlOX1RSRUVTIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICBzZW5kX2FsbF90cmVlcyhzLCBzLmxfZGVzYy5tYXhfY29kZSArIDEsIHMuZF9kZXNjLm1heF9jb2RlICsgMSwgbWF4X2JsaW5kZXggKyAxKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICAgIH0KICAgIC8vIEFzc2VydCAocy0+Y29tcHJlc3NlZF9sZW4gPT0gcy0+Yml0c19zZW50LCAiYmFkIGNvbXByZXNzZWQgc2l6ZSIpOwogICAgLyogVGhlIGFib3ZlIGNoZWNrIGlzIG1hZGUgbW9kIDJeMzIsIGZvciBmaWxlcyBsYXJnZXIgdGhhbiA1MTIgTUIKICAgICAqIGFuZCB1TG9uZyBpbXBsZW1lbnRlZCBvbiAzMiBiaXRzLgogICAgICovCiAgICBpbml0X2Jsb2NrKHMpOwoKICAgIGlmIChsYXN0KSB7CiAgICAgIGJpX3dpbmR1cChzKTsKICAgIH0KICAgIC8vIFRyYWNldigoc3RkZXJyLCJcbmNvbXBybGVuICVsdSglbHUpICIsIHMtPmNvbXByZXNzZWRfbGVuPj4zLAogICAgLy8gICAgICAgcy0+Y29tcHJlc3NlZF9sZW4tNypsYXN0KSk7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2F2ZSB0aGUgbWF0Y2ggaW5mbyBhbmQgdGFsbHkgdGhlIGZyZXF1ZW5jeSBjb3VudHMuIFJldHVybiB0cnVlIGlmCiAgICogdGhlIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkLgogICAqLwogIGNvbnN0IF90cl90YWxseSQxID0gKHMsIGRpc3QsIGxjKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgdW5zaWduZWQgZGlzdDsgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgLy8gICAgdW5zaWduZWQgbGM7ICAgIC8qIG1hdGNoIGxlbmd0aC1NSU5fTUFUQ0ggb3IgdW5tYXRjaGVkIGNoYXIgKGlmIGRpc3Q9PTApICovCiAgewogICAgLy9sZXQgb3V0X2xlbmd0aCwgaW5fbGVuZ3RoLCBkY29kZTsKCiAgICBzLnBlbmRpbmdfYnVmW3MuZF9idWYgKyBzLmxhc3RfbGl0ICogMl0gICAgID0gKGRpc3QgPj4+IDgpICYgMHhmZjsKICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyICsgMV0gPSBkaXN0ICYgMHhmZjsKCiAgICBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBzLmxhc3RfbGl0XSA9IGxjICYgMHhmZjsKICAgIHMubGFzdF9saXQrKzsKCiAgICBpZiAoZGlzdCA9PT0gMCkgewogICAgICAvKiBsYyBpcyB0aGUgdW5tYXRjaGVkIGNoYXIgKi8KICAgICAgcy5keW5fbHRyZWVbbGMgKiAyXS8qLkZyZXEqLysrOwogICAgfSBlbHNlIHsKICAgICAgcy5tYXRjaGVzKys7CiAgICAgIC8qIEhlcmUsIGxjIGlzIHRoZSBtYXRjaCBsZW5ndGggLSBNSU5fTUFUQ0ggKi8KICAgICAgZGlzdC0tOyAgICAgICAgICAgICAvKiBkaXN0ID0gbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgIC8vQXNzZXJ0KCh1c2gpZGlzdCA8ICh1c2gpTUFYX0RJU1QocykgJiYKICAgICAgLy8gICAgICAgKHVzaClsYyA8PSAodXNoKShNQVhfTUFUQ0gtTUlOX01BVENIKSAmJgogICAgICAvLyAgICAgICAodXNoKWRfY29kZShkaXN0KSA8ICh1c2gpRF9DT0RFUywgICJfdHJfdGFsbHk6IGJhZCBtYXRjaCIpOwoKICAgICAgcy5keW5fbHRyZWVbKF9sZW5ndGhfY29kZVtsY10gKyBMSVRFUkFMUyQxICsgMSkgKiAyXS8qLkZyZXEqLysrOwogICAgICBzLmR5bl9kdHJlZVtkX2NvZGUoZGlzdCkgKiAyXS8qLkZyZXEqLysrOwogICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKCiAgLy8jaWZkZWYgVFJVTkNBVEVfQkxPQ0sKICAvLyAgLyogVHJ5IHRvIGd1ZXNzIGlmIGl0IGlzIHByb2ZpdGFibGUgdG8gc3RvcCB0aGUgY3VycmVudCBibG9jayBoZXJlICovCiAgLy8gIGlmICgocy5sYXN0X2xpdCAmIDB4MWZmZikgPT09IDAgJiYgcy5sZXZlbCA+IDIpIHsKICAvLyAgICAvKiBDb21wdXRlIGFuIHVwcGVyIGJvdW5kIGZvciB0aGUgY29tcHJlc3NlZCBsZW5ndGggKi8KICAvLyAgICBvdXRfbGVuZ3RoID0gcy5sYXN0X2xpdCo4OwogIC8vICAgIGluX2xlbmd0aCA9IHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0OwogIC8vCiAgLy8gICAgZm9yIChkY29kZSA9IDA7IGRjb2RlIDwgRF9DT0RFUzsgZGNvZGUrKykgewogIC8vICAgICAgb3V0X2xlbmd0aCArPSBzLmR5bl9kdHJlZVtkY29kZSoyXS8qLkZyZXEqLyAqICg1ICsgZXh0cmFfZGJpdHNbZGNvZGVdKTsKICAvLyAgICB9CiAgLy8gICAgb3V0X2xlbmd0aCA+Pj49IDM7CiAgLy8gICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5sYXN0X2xpdCAldSwgaW4gJWxkLCBvdXQgfiVsZCglbGQlJSkgIiwKICAvLyAgICAvLyAgICAgICBzLT5sYXN0X2xpdCwgaW5fbGVuZ3RoLCBvdXRfbGVuZ3RoLAogIC8vICAgIC8vICAgICAgIDEwMEwgLSBvdXRfbGVuZ3RoKjEwMEwvaW5fbGVuZ3RoKSk7CiAgLy8gICAgaWYgKHMubWF0Y2hlcyA8IChzLmxhc3RfbGl0Pj4xKS8qaW50IC8yKi8gJiYgb3V0X2xlbmd0aCA8IChpbl9sZW5ndGg+PjEpLyppbnQgLzIqLykgewogIC8vICAgICAgcmV0dXJuIHRydWU7CiAgLy8gICAgfQogIC8vICB9CiAgLy8jZW5kaWYKCiAgICByZXR1cm4gKHMubGFzdF9saXQgPT09IHMubGl0X2J1ZnNpemUgLSAxKTsKICAgIC8qIFdlIGF2b2lkIGVxdWFsaXR5IHdpdGggbGl0X2J1ZnNpemUgYmVjYXVzZSBvZiB3cmFwYXJvdW5kIGF0IDY0SwogICAgICogb24gMTYgYml0IG1hY2hpbmVzIGFuZCBiZWNhdXNlIHN0b3JlZCBibG9ja3MgYXJlIHJlc3RyaWN0ZWQgdG8KICAgICAqIDY0Sy0xIGJ5dGVzLgogICAgICovCiAgfTsKCiAgdmFyIF90cl9pbml0XzEgID0gX3RyX2luaXQkMTsKICB2YXIgX3RyX3N0b3JlZF9ibG9ja18xID0gX3RyX3N0b3JlZF9ibG9jayQxOwogIHZhciBfdHJfZmx1c2hfYmxvY2tfMSAgPSBfdHJfZmx1c2hfYmxvY2skMTsKICB2YXIgX3RyX3RhbGx5XzEgPSBfdHJfdGFsbHkkMTsKICB2YXIgX3RyX2FsaWduXzEgPSBfdHJfYWxpZ24kMTsKCiAgdmFyIHRyZWVzID0gewogIAlfdHJfaW5pdDogX3RyX2luaXRfMSwKICAJX3RyX3N0b3JlZF9ibG9jazogX3RyX3N0b3JlZF9ibG9ja18xLAogIAlfdHJfZmx1c2hfYmxvY2s6IF90cl9mbHVzaF9ibG9ja18xLAogIAlfdHJfdGFsbHk6IF90cl90YWxseV8xLAogIAlfdHJfYWxpZ246IF90cl9hbGlnbl8xCiAgfTsKCiAgLy8gTm90ZTogYWRsZXIzMiB0YWtlcyAxMiUgZm9yIGxldmVsIDAgYW5kIDIlIGZvciBsZXZlbCA2LgogIC8vIEl0IGlzbid0IHdvcnRoIGl0IHRvIG1ha2UgYWRkaXRpb25hbCBvcHRpbWl6YXRpb25zIGFzIGluIG9yaWdpbmFsLgogIC8vIFNtYWxsIHNpemUgaXMgcHJlZmVyYWJsZS4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIGNvbnN0IGFkbGVyMzIgPSAoYWRsZXIsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGxldCBzMSA9IChhZGxlciAmIDB4ZmZmZikgfDAsCiAgICAgICAgczIgPSAoKGFkbGVyID4+PiAxNikgJiAweGZmZmYpIHwwLAogICAgICAgIG4gPSAwOwoKICAgIHdoaWxlIChsZW4gIT09IDApIHsKICAgICAgLy8gU2V0IGxpbWl0IH4gdHdpY2UgbGVzcyB0aGFuIDU1NTIsIHRvIGtlZXAKICAgICAgLy8gczIgaW4gMzEtYml0cywgYmVjYXVzZSB3ZSBmb3JjZSBzaWduZWQgaW50cy4KICAgICAgLy8gaW4gb3RoZXIgY2FzZSAlPSB3aWxsIGZhaWwuCiAgICAgIG4gPSBsZW4gPiAyMDAwID8gMjAwMCA6IGxlbjsKICAgICAgbGVuIC09IG47CgogICAgICBkbyB7CiAgICAgICAgczEgPSAoczEgKyBidWZbcG9zKytdKSB8MDsKICAgICAgICBzMiA9IChzMiArIHMxKSB8MDsKICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgIHMxICU9IDY1NTIxOwogICAgICBzMiAlPSA2NTUyMTsKICAgIH0KCiAgICByZXR1cm4gKHMxIHwgKHMyIDw8IDE2KSkgfDA7CiAgfTsKCgogIHZhciBhZGxlcjMyXzEgPSBhZGxlcjMyOwoKICAvLyBOb3RlOiB3ZSBjYW4ndCBnZXQgc2lnbmlmaWNhbnQgc3BlZWQgYm9vc3QgaGVyZS4KICAvLyBTbyB3cml0ZSBjb2RlIHRvIG1pbmltaXplIHNpemUgLSBubyBwcmVnZW5lcmF0ZWQgdGFibGVzCiAgLy8gYW5kIGFycmF5IHRvb2xzIGRlcGVuZGVuY2llcy4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFVzZSBvcmRpbmFyeSBhcnJheSwgc2luY2UgdW50eXBlZCBtYWtlcyBubyBib29zdCBoZXJlCiAgY29uc3QgbWFrZVRhYmxlID0gKCkgPT4gewogICAgbGV0IGMsIHRhYmxlID0gW107CgogICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICBjID0gbjsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCA4OyBrKyspIHsKICAgICAgICBjID0gKChjICYgMSkgPyAoMHhFREI4ODMyMCBeIChjID4+PiAxKSkgOiAoYyA+Pj4gMSkpOwogICAgICB9CiAgICAgIHRhYmxlW25dID0gYzsKICAgIH0KCiAgICByZXR1cm4gdGFibGU7CiAgfTsKCiAgLy8gQ3JlYXRlIHRhYmxlIG9uIGxvYWQuIEp1c3QgMjU1IHNpZ25lZCBsb25ncy4gTm90IGEgcHJvYmxlbS4KICBjb25zdCBjcmNUYWJsZSA9IG5ldyBVaW50MzJBcnJheShtYWtlVGFibGUoKSk7CgoKICBjb25zdCBjcmMzMiA9IChjcmMsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGNvbnN0IHQgPSBjcmNUYWJsZTsKICAgIGNvbnN0IGVuZCA9IHBvcyArIGxlbjsKCiAgICBjcmMgXj0gLTE7CgogICAgZm9yIChsZXQgaSA9IHBvczsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIGNyYyA9IChjcmMgPj4+IDgpIF4gdFsoY3JjIF4gYnVmW2ldKSAmIDB4RkZdOwogICAgfQoKICAgIHJldHVybiAoY3JjIF4gKC0xKSk7IC8vID4+PiAwOwogIH07CgoKICB2YXIgY3JjMzJfMSA9IGNyYzMyOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgdmFyIG1lc3NhZ2VzID0gewogICAgMjogICAgICAnbmVlZCBkaWN0aW9uYXJ5JywgICAgIC8qIFpfTkVFRF9ESUNUICAgICAgIDIgICovCiAgICAxOiAgICAgICdzdHJlYW0gZW5kJywgICAgICAgICAgLyogWl9TVFJFQU1fRU5EICAgICAgMSAgKi8KICAgIDA6ICAgICAgJycsICAgICAgICAgICAgICAgICAgICAvKiBaX09LICAgICAgICAgICAgICAwICAqLwogICAgJy0xJzogICAnZmlsZSBlcnJvcicsICAgICAgICAgIC8qIFpfRVJSTk8gICAgICAgICAoLTEpICovCiAgICAnLTInOiAgICdzdHJlYW0gZXJyb3InLCAgICAgICAgLyogWl9TVFJFQU1fRVJST1IgICgtMikgKi8KICAgICctMyc6ICAgJ2RhdGEgZXJyb3InLCAgICAgICAgICAvKiBaX0RBVEFfRVJST1IgICAgKC0zKSAqLwogICAgJy00JzogICAnaW5zdWZmaWNpZW50IG1lbW9yeScsIC8qIFpfTUVNX0VSUk9SICAgICAoLTQpICovCiAgICAnLTUnOiAgICdidWZmZXIgZXJyb3InLCAgICAgICAgLyogWl9CVUZfRVJST1IgICAgICgtNSkgKi8KICAgICctNic6ICAgJ2luY29tcGF0aWJsZSB2ZXJzaW9uJyAvKiBaX1ZFUlNJT05fRVJST1IgKC02KSAqLwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICB2YXIgY29uc3RhbnRzJDIgPSB7CgogICAgLyogQWxsb3dlZCBmbHVzaCB2YWx1ZXM7IHNlZSBkZWZsYXRlKCkgYW5kIGluZmxhdGUoKSBiZWxvdyBmb3IgZGV0YWlscyAqLwogICAgWl9OT19GTFVTSDogICAgICAgICAwLAogICAgWl9QQVJUSUFMX0ZMVVNIOiAgICAxLAogICAgWl9TWU5DX0ZMVVNIOiAgICAgICAyLAogICAgWl9GVUxMX0ZMVVNIOiAgICAgICAzLAogICAgWl9GSU5JU0g6ICAgICAgICAgICA0LAogICAgWl9CTE9DSzogICAgICAgICAgICA1LAogICAgWl9UUkVFUzogICAgICAgICAgICA2LAoKICAgIC8qIFJldHVybiBjb2RlcyBmb3IgdGhlIGNvbXByZXNzaW9uL2RlY29tcHJlc3Npb24gZnVuY3Rpb25zLiBOZWdhdGl2ZSB2YWx1ZXMKICAgICogYXJlIGVycm9ycywgcG9zaXRpdmUgdmFsdWVzIGFyZSB1c2VkIGZvciBzcGVjaWFsIGJ1dCBub3JtYWwgZXZlbnRzLgogICAgKi8KICAgIFpfT0s6ICAgICAgICAgICAgICAgMCwKICAgIFpfU1RSRUFNX0VORDogICAgICAgMSwKICAgIFpfTkVFRF9ESUNUOiAgICAgICAgMiwKICAgIFpfRVJSTk86ICAgICAgICAgICAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAgICAtMiwKICAgIFpfREFUQV9FUlJPUjogICAgICAtMywKICAgIFpfTUVNX0VSUk9SOiAgICAgICAtNCwKICAgIFpfQlVGX0VSUk9SOiAgICAgICAtNSwKICAgIC8vWl9WRVJTSU9OX0VSUk9SOiAtNiwKCiAgICAvKiBjb21wcmVzc2lvbiBsZXZlbHMgKi8KICAgIFpfTk9fQ09NUFJFU1NJT046ICAgICAgICAgMCwKICAgIFpfQkVTVF9TUEVFRDogICAgICAgICAgICAgMSwKICAgIFpfQkVTVF9DT01QUkVTU0lPTjogICAgICAgOSwKICAgIFpfREVGQVVMVF9DT01QUkVTU0lPTjogICAtMSwKCgogICAgWl9GSUxURVJFRDogICAgICAgICAgICAgICAxLAogICAgWl9IVUZGTUFOX09OTFk6ICAgICAgICAgICAyLAogICAgWl9STEU6ICAgICAgICAgICAgICAgICAgICAzLAogICAgWl9GSVhFRDogICAgICAgICAgICAgICAgICA0LAogICAgWl9ERUZBVUxUX1NUUkFURUdZOiAgICAgICAwLAoKICAgIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICAgIFpfQklOQVJZOiAgICAgICAgICAgICAgICAgMCwKICAgIFpfVEVYVDogICAgICAgICAgICAgICAgICAgMSwKICAgIC8vWl9BU0NJSTogICAgICAgICAgICAgICAgMSwgLy8gPSBaX1RFWFQgKGRlcHJlY2F0ZWQpCiAgICBaX1VOS05PV046ICAgICAgICAgICAgICAgIDIsCgogICAgLyogVGhlIGRlZmxhdGUgY29tcHJlc3Npb24gbWV0aG9kICovCiAgICBaX0RFRkxBVEVEOiAgICAgICAgICAgICAgIDgKICAgIC8vWl9OVUxMOiAgICAgICAgICAgICAgICAgbnVsbCAvLyBVc2UgLTEgb3IgbnVsbCBpbmxpbmUsIGRlcGVuZGluZyBvbiB2YXIgdHlwZQogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBjb25zdCB7IF90cl9pbml0LCBfdHJfc3RvcmVkX2Jsb2NrLCBfdHJfZmx1c2hfYmxvY2ssIF90cl90YWxseSwgX3RyX2FsaWduIH0gPSB0cmVlczsKCgoKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNIOiBaX05PX0ZMVVNIJDIsIFpfUEFSVElBTF9GTFVTSCwgWl9GVUxMX0ZMVVNIOiBaX0ZVTExfRkxVU0gkMSwgWl9GSU5JU0g6IFpfRklOSVNIJDMsIFpfQkxPQ0s6IFpfQkxPQ0skMSwKICAgIFpfT0s6IFpfT0skMywgWl9TVFJFQU1fRU5EOiBaX1NUUkVBTV9FTkQkMywgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDIsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDIsIFpfQlVGX0VSUk9SOiBaX0JVRl9FUlJPUiQxLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBaX0RFRkFVTFRfQ09NUFJFU1NJT04kMSwKICAgIFpfRklMVEVSRUQsIFpfSFVGRk1BTl9PTkxZLCBaX1JMRSwgWl9GSVhFRCwgWl9ERUZBVUxUX1NUUkFURUdZOiBaX0RFRkFVTFRfU1RSQVRFR1kkMSwKICAgIFpfVU5LTk9XTiwKICAgIFpfREVGTEFURUQ6IFpfREVGTEFURUQkMgogIH0gPSBjb25zdGFudHMkMjsKCiAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCgogIGNvbnN0IE1BWF9NRU1fTEVWRUwgPSA5OwogIC8qIE1heGltdW0gdmFsdWUgZm9yIG1lbUxldmVsIGluIGRlZmxhdGVJbml0MiAqLwogIGNvbnN0IE1BWF9XQklUUyQxID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX01FTV9MRVZFTCA9IDg7CgoKICBjb25zdCBMRU5HVEhfQ09ERVMgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCiAgY29uc3QgTElURVJBTFMgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KICBjb25zdCBMX0NPREVTICAgICAgID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwogIC8qIG51bWJlciBvZiBMaXRlcmFsIG9yIExlbmd0aCBjb2RlcywgaW5jbHVkaW5nIHRoZSBFTkRfQkxPQ0sgY29kZSAqLwogIGNvbnN0IERfQ09ERVMgICAgICAgPSAzMDsKICAvKiBudW1iZXIgb2YgZGlzdGFuY2UgY29kZXMgKi8KICBjb25zdCBCTF9DT0RFUyAgICAgID0gMTk7CiAgLyogbnVtYmVyIG9mIGNvZGVzIHVzZWQgdG8gdHJhbnNmZXIgdGhlIGJpdCBsZW5ndGhzICovCiAgY29uc3QgSEVBUF9TSVpFICAgICA9IDIgKiBMX0NPREVTICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwogIGNvbnN0IE1BWF9CSVRTICA9IDE1OwogIC8qIEFsbCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JJVFMgYml0cyAqLwoKICBjb25zdCBNSU5fTUFUQ0ggPSAzOwogIGNvbnN0IE1BWF9NQVRDSCA9IDI1ODsKICBjb25zdCBNSU5fTE9PS0FIRUFEID0gKE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDEpOwoKICBjb25zdCBQUkVTRVRfRElDVCA9IDB4MjA7CgogIGNvbnN0IElOSVRfU1RBVEUgPSA0MjsKICBjb25zdCBFWFRSQV9TVEFURSA9IDY5OwogIGNvbnN0IE5BTUVfU1RBVEUgPSA3MzsKICBjb25zdCBDT01NRU5UX1NUQVRFID0gOTE7CiAgY29uc3QgSENSQ19TVEFURSA9IDEwMzsKICBjb25zdCBCVVNZX1NUQVRFID0gMTEzOwogIGNvbnN0IEZJTklTSF9TVEFURSA9IDY2NjsKCiAgY29uc3QgQlNfTkVFRF9NT1JFICAgICAgPSAxOyAvKiBibG9jayBub3QgY29tcGxldGVkLCBuZWVkIG1vcmUgaW5wdXQgb3IgbW9yZSBvdXRwdXQgKi8KICBjb25zdCBCU19CTE9DS19ET05FICAgICA9IDI7IC8qIGJsb2NrIGZsdXNoIHBlcmZvcm1lZCAqLwogIGNvbnN0IEJTX0ZJTklTSF9TVEFSVEVEID0gMzsgLyogZmluaXNoIHN0YXJ0ZWQsIG5lZWQgb25seSBtb3JlIG91dHB1dCBhdCBuZXh0IGRlZmxhdGUgKi8KICBjb25zdCBCU19GSU5JU0hfRE9ORSAgICA9IDQ7IC8qIGZpbmlzaCBkb25lLCBhY2NlcHQgbm8gbW9yZSBpbnB1dCBvciBvdXRwdXQgKi8KCiAgY29uc3QgT1NfQ09ERSA9IDB4MDM7IC8vIFVuaXggOikgLiBEb24ndCBkZXRlY3QsIHVzZSB0aGlzIGRlZmF1bHQuCgogIGNvbnN0IGVyciA9IChzdHJtLCBlcnJvckNvZGUpID0+IHsKICAgIHN0cm0ubXNnID0gbWVzc2FnZXNbZXJyb3JDb2RlXTsKICAgIHJldHVybiBlcnJvckNvZGU7CiAgfTsKCiAgY29uc3QgcmFuayA9IChmKSA9PiB7CiAgICByZXR1cm4gKChmKSA8PCAxKSAtICgoZikgPiA0ID8gOSA6IDApOwogIH07CgogIGNvbnN0IHplcm8gPSAoYnVmKSA9PiB7CiAgICBsZXQgbGVuID0gYnVmLmxlbmd0aDsgd2hpbGUgKC0tbGVuID49IDApIHsgYnVmW2xlbl0gPSAwOyB9CiAgfTsKCgogIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICBsZXQgSEFTSF9aTElCID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCBzLmhhc2hfc2hpZnQpIF4gZGF0YSkgJiBzLmhhc2hfbWFzazsKICAvLyBUaGlzIGhhc2ggY2F1c2VzIGxlc3MgY29sbGlzaW9ucywgaHR0cHM6Ly9naXRodWIuY29tL25vZGVjYS9wYWtvL2lzc3Vlcy8xMzUKICAvLyBCdXQgYnJlYWtzIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy9sZXQgSEFTSF9GQVNUID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCA4KSArIChwcmV2ID4+IDgpICsgKGRhdGEgPDwgNCkpICYgcy5oYXNoX21hc2s7CiAgbGV0IEhBU0ggPSBIQVNIX1pMSUI7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCBhcyBtdWNoIHBlbmRpbmcgb3V0cHV0IGFzIHBvc3NpYmxlLiBBbGwgZGVmbGF0ZSgpIG91dHB1dCBnb2VzCiAgICogdGhyb3VnaCB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdAogICAqIHRvIGF2b2lkIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5vdXRwdXQgYnVmZmVyIGFuZCBjb3B5aW5nIGludG8gaXQuCiAgICogKFNlZSBhbHNvIHJlYWRfYnVmKCkpLgogICAqLwogIGNvbnN0IGZsdXNoX3BlbmRpbmcgPSAoc3RybSkgPT4gewogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgLy9fdHJfZmx1c2hfYml0cyhzKTsKICAgIGxldCBsZW4gPSBzLnBlbmRpbmc7CiAgICBpZiAobGVuID4gc3RybS5hdmFpbF9vdXQpIHsKICAgICAgbGVuID0gc3RybS5hdmFpbF9vdXQ7CiAgICB9CiAgICBpZiAobGVuID09PSAwKSB7IHJldHVybjsgfQoKICAgIHN0cm0ub3V0cHV0LnNldChzLnBlbmRpbmdfYnVmLnN1YmFycmF5KHMucGVuZGluZ19vdXQsIHMucGVuZGluZ19vdXQgKyBsZW4pLCBzdHJtLm5leHRfb3V0KTsKICAgIHN0cm0ubmV4dF9vdXQgKz0gbGVuOwogICAgcy5wZW5kaW5nX291dCArPSBsZW47CiAgICBzdHJtLnRvdGFsX291dCArPSBsZW47CiAgICBzdHJtLmF2YWlsX291dCAtPSBsZW47CiAgICBzLnBlbmRpbmcgLT0gbGVuOwogICAgaWYgKHMucGVuZGluZyA9PT0gMCkgewogICAgICBzLnBlbmRpbmdfb3V0ID0gMDsKICAgIH0KICB9OwoKCiAgY29uc3QgZmx1c2hfYmxvY2tfb25seSA9IChzLCBsYXN0KSA9PiB7CiAgICBfdHJfZmx1c2hfYmxvY2socywgKHMuYmxvY2tfc3RhcnQgPj0gMCA/IHMuYmxvY2tfc3RhcnQgOiAtMSksIHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0LCBsYXN0KTsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgZmx1c2hfcGVuZGluZyhzLnN0cm0pOwogIH07CgoKICBjb25zdCBwdXRfYnl0ZSA9IChzLCBiKSA9PiB7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGI7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBQdXQgYSBzaG9ydCBpbiB0aGUgcGVuZGluZyBidWZmZXIuIFRoZSAxNi1iaXQgdmFsdWUgaXMgcHV0IGluIE1TQiBvcmRlci4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBzdHJlYW0gc3RhdGUgaXMgY29ycmVjdCBhbmQgdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4KICAgKiBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBwdXRTaG9ydE1TQiA9IChzLCBiKSA9PiB7CgogICAgLy8gIHB1dF9ieXRlKHMsIChCeXRlKShiID4+IDgpKTsKICAvLyAgcHV0X2J5dGUocywgKEJ5dGUpKGIgJiAweGZmKSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IChiID4+PiA4KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGIgJiAweGZmOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZWFkIGEgbmV3IGJ1ZmZlciBmcm9tIHRoZSBjdXJyZW50IGlucHV0IHN0cmVhbSwgdXBkYXRlIHRoZSBhZGxlcjMyCiAgICogYW5kIHRvdGFsIG51bWJlciBvZiBieXRlcyByZWFkLiAgQWxsIGRlZmxhdGUoKSBpbnB1dCBnb2VzIHRocm91Z2gKICAgKiB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdCB0byBhdm9pZAogICAqIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5pbnB1dCBidWZmZXIgYW5kIGNvcHlpbmcgZnJvbSBpdC4KICAgKiAoU2VlIGFsc28gZmx1c2hfcGVuZGluZygpKS4KICAgKi8KICBjb25zdCByZWFkX2J1ZiA9IChzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSA9PiB7CgogICAgbGV0IGxlbiA9IHN0cm0uYXZhaWxfaW47CgogICAgaWYgKGxlbiA+IHNpemUpIHsgbGVuID0gc2l6ZTsgfQogICAgaWYgKGxlbiA9PT0gMCkgeyByZXR1cm4gMDsgfQoKICAgIHN0cm0uYXZhaWxfaW4gLT0gbGVuOwoKICAgIC8vIHptZW1jcHkoYnVmLCBzdHJtLT5uZXh0X2luLCBsZW4pOwogICAgYnVmLnNldChzdHJtLmlucHV0LnN1YmFycmF5KHN0cm0ubmV4dF9pbiwgc3RybS5uZXh0X2luICsgbGVuKSwgc3RhcnQpOwogICAgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMSkgewogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgZWxzZSBpZiAoc3RybS5zdGF0ZS53cmFwID09PSAyKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgc3RybS5uZXh0X2luICs9IGxlbjsKICAgIHN0cm0udG90YWxfaW4gKz0gbGVuOwoKICAgIHJldHVybiBsZW47CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNldCBtYXRjaF9zdGFydCB0byB0aGUgbG9uZ2VzdCBtYXRjaCBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gc3RyaW5nIGFuZAogICAqIHJldHVybiBpdHMgbGVuZ3RoLiBNYXRjaGVzIHNob3J0ZXIgb3IgZXF1YWwgdG8gcHJldl9sZW5ndGggYXJlIGRpc2NhcmRlZCwKICAgKiBpbiB3aGljaCBjYXNlIHRoZSByZXN1bHQgaXMgZXF1YWwgdG8gcHJldl9sZW5ndGggYW5kIG1hdGNoX3N0YXJ0IGlzCiAgICogZ2FyYmFnZS4KICAgKiBJTiBhc3NlcnRpb25zOiBjdXJfbWF0Y2ggaXMgdGhlIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gZm9yIHRoZSBjdXJyZW50CiAgICogICBzdHJpbmcgKHN0cnN0YXJ0KSBhbmQgaXRzIGRpc3RhbmNlIGlzIDw9IE1BWF9ESVNULCBhbmQgcHJldl9sZW5ndGggPj0gMQogICAqIE9VVCBhc3NlcnRpb246IHRoZSBtYXRjaCBsZW5ndGggaXMgbm90IGdyZWF0ZXIgdGhhbiBzLT5sb29rYWhlYWQuCiAgICovCiAgY29uc3QgbG9uZ2VzdF9tYXRjaCA9IChzLCBjdXJfbWF0Y2gpID0+IHsKCiAgICBsZXQgY2hhaW5fbGVuZ3RoID0gcy5tYXhfY2hhaW5fbGVuZ3RoOyAgICAgIC8qIG1heCBoYXNoIGNoYWluIGxlbmd0aCAqLwogICAgbGV0IHNjYW4gPSBzLnN0cnN0YXJ0OyAvKiBjdXJyZW50IHN0cmluZyAqLwogICAgbGV0IG1hdGNoOyAgICAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2hlZCBzdHJpbmcgKi8KICAgIGxldCBsZW47ICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIG9mIGN1cnJlbnQgbWF0Y2ggKi8KICAgIGxldCBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7ICAgICAgICAgICAgICAvKiBiZXN0IG1hdGNoIGxlbmd0aCBzbyBmYXIgKi8KICAgIGxldCBuaWNlX21hdGNoID0gcy5uaWNlX21hdGNoOyAgICAgICAgICAgICAvKiBzdG9wIGlmIG1hdGNoIGxvbmcgZW5vdWdoICovCiAgICBjb25zdCBsaW1pdCA9IChzLnN0cnN0YXJ0ID4gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpID8KICAgICAgICBzLnN0cnN0YXJ0IC0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgOiAwLypOSUwqLzsKCiAgICBjb25zdCBfd2luID0gcy53aW5kb3c7IC8vIHNob3J0Y3V0CgogICAgY29uc3Qgd21hc2sgPSBzLndfbWFzazsKICAgIGNvbnN0IHByZXYgID0gcy5wcmV2OwoKICAgIC8qIFN0b3Agd2hlbiBjdXJfbWF0Y2ggYmVjb21lcyA8PSBsaW1pdC4gVG8gc2ltcGxpZnkgdGhlIGNvZGUsCiAgICAgKiB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nIG9mIHdpbmRvdyBpbmRleCAwLgogICAgICovCgogICAgY29uc3Qgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgIGxldCBzY2FuX2VuZDEgID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgIGxldCBzY2FuX2VuZCAgID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwoKICAgIC8qIFRoZSBjb2RlIGlzIG9wdGltaXplZCBmb3IgSEFTSF9CSVRTID49IDggYW5kIE1BWF9NQVRDSC0yIG11bHRpcGxlIG9mIDE2LgogICAgICogSXQgaXMgZWFzeSB0byBnZXQgcmlkIG9mIHRoaXMgb3B0aW1pemF0aW9uIGlmIG5lY2Vzc2FyeS4KICAgICAqLwogICAgLy8gQXNzZXJ0KHMtPmhhc2hfYml0cyA+PSA4ICYmIE1BWF9NQVRDSCA9PSAyNTgsICJDb2RlIHRvbyBjbGV2ZXIiKTsKCiAgICAvKiBEbyBub3Qgd2FzdGUgdG9vIG11Y2ggdGltZSBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBnb29kIG1hdGNoOiAqLwogICAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICAgIGNoYWluX2xlbmd0aCA+Pj0gMjsKICAgIH0KICAgIC8qIERvIG5vdCBsb29rIGZvciBtYXRjaGVzIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBpbnB1dC4gVGhpcyBpcyBuZWNlc3NhcnkKICAgICAqIHRvIG1ha2UgZGVmbGF0ZSBkZXRlcm1pbmlzdGljLgogICAgICovCiAgICBpZiAobmljZV9tYXRjaCA+IHMubG9va2FoZWFkKSB7IG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsgfQoKICAgIC8vIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplLU1JTl9MT09LQUhFQUQsICJuZWVkIGxvb2thaGVhZCIpOwoKICAgIGRvIHsKICAgICAgLy8gQXNzZXJ0KGN1cl9tYXRjaCA8IHMtPnN0cnN0YXJ0LCAibm8gZnV0dXJlIik7CiAgICAgIG1hdGNoID0gY3VyX21hdGNoOwoKICAgICAgLyogU2tpcCB0byBuZXh0IG1hdGNoIGlmIHRoZSBtYXRjaCBsZW5ndGggY2Fubm90IGluY3JlYXNlCiAgICAgICAqIG9yIGlmIHRoZSBtYXRjaCBsZW5ndGggaXMgbGVzcyB0aGFuIDIuICBOb3RlIHRoYXQgdGhlIGNoZWNrcyBiZWxvdwogICAgICAgKiBmb3IgaW5zdWZmaWNpZW50IGxvb2thaGVhZCBvbmx5IG9jY3VyIG9jY2FzaW9uYWxseSBmb3IgcGVyZm9ybWFuY2UKICAgICAgICogcmVhc29ucy4gIFRoZXJlZm9yZSB1bmluaXRpYWxpemVkIG1lbW9yeSB3aWxsIGJlIGFjY2Vzc2VkLCBhbmQKICAgICAgICogY29uZGl0aW9uYWwganVtcHMgd2lsbCBiZSBtYWRlIHRoYXQgZGVwZW5kIG9uIHRob3NlIHZhbHVlcy4KICAgICAgICogSG93ZXZlciB0aGUgbGVuZ3RoIG9mIHRoZSBtYXRjaCBpcyBsaW1pdGVkIHRvIHRoZSBsb29rYWhlYWQsIHNvCiAgICAgICAqIHRoZSBvdXRwdXQgb2YgZGVmbGF0ZSBpcyBub3QgYWZmZWN0ZWQgYnkgdGhlIHVuaW5pdGlhbGl6ZWQgdmFsdWVzLgogICAgICAgKi8KCiAgICAgIGlmIChfd2luW21hdGNoICsgYmVzdF9sZW5dICAgICAhPT0gc2Nhbl9lbmQgIHx8CiAgICAgICAgICBfd2luW21hdGNoICsgYmVzdF9sZW4gLSAxXSAhPT0gc2Nhbl9lbmQxIHx8CiAgICAgICAgICBfd2luW21hdGNoXSAgICAgICAgICAgICAgICAhPT0gX3dpbltzY2FuXSB8fAogICAgICAgICAgX3dpblsrK21hdGNoXSAgICAgICAgICAgICAgIT09IF93aW5bc2NhbiArIDFdKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8qIFRoZSBjaGVjayBhdCBiZXN0X2xlbi0xIGNhbiBiZSByZW1vdmVkIGJlY2F1c2UgaXQgd2lsbCBiZSBtYWRlCiAgICAgICAqIGFnYWluIGxhdGVyLiAoVGhpcyBoZXVyaXN0aWMgaXMgbm90IGFsd2F5cyBhIHdpbi4pCiAgICAgICAqIEl0IGlzIG5vdCBuZWNlc3NhcnkgdG8gY29tcGFyZSBzY2FuWzJdIGFuZCBtYXRjaFsyXSBzaW5jZSB0aGV5CiAgICAgICAqIGFyZSBhbHdheXMgZXF1YWwgd2hlbiB0aGUgb3RoZXIgYnl0ZXMgbWF0Y2gsIGdpdmVuIHRoYXQKICAgICAgICogdGhlIGhhc2gga2V5cyBhcmUgZXF1YWwgYW5kIHRoYXQgSEFTSF9CSVRTID49IDguCiAgICAgICAqLwogICAgICBzY2FuICs9IDI7CiAgICAgIG1hdGNoKys7CiAgICAgIC8vIEFzc2VydCgqc2NhbiA9PSAqbWF0Y2gsICJtYXRjaFsyXT8iKTsKCiAgICAgIC8qIFdlIGNoZWNrIGZvciBpbnN1ZmZpY2llbnQgbG9va2FoZWFkIG9ubHkgZXZlcnkgOHRoIGNvbXBhcmlzb247CiAgICAgICAqIHRoZSAyNTZ0aCBjaGVjayB3aWxsIGJlIG1hZGUgYXQgc3Ryc3RhcnQrMjU4LgogICAgICAgKi8KICAgICAgZG8gewogICAgICAgIC8qanNoaW50IG5vZW1wdHk6ZmFsc2UqLwogICAgICB9IHdoaWxlIChfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYKICAgICAgICAgICAgICAgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJgogICAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIHNjYW4gPCBzdHJlbmQpOwoKICAgICAgLy8gQXNzZXJ0KHNjYW4gPD0gcy0+d2luZG93Kyh1bnNpZ25lZCkocy0+d2luZG93X3NpemUtMSksICJ3aWxkIHNjYW4iKTsKCiAgICAgIGxlbiA9IE1BWF9NQVRDSCAtIChzdHJlbmQgLSBzY2FuKTsKICAgICAgc2NhbiA9IHN0cmVuZCAtIE1BWF9NQVRDSDsKCiAgICAgIGlmIChsZW4gPiBiZXN0X2xlbikgewogICAgICAgIHMubWF0Y2hfc3RhcnQgPSBjdXJfbWF0Y2g7CiAgICAgICAgYmVzdF9sZW4gPSBsZW47CiAgICAgICAgaWYgKGxlbiA+PSBuaWNlX21hdGNoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc2Nhbl9lbmQxICA9IF93aW5bc2NhbiArIGJlc3RfbGVuIC0gMV07CiAgICAgICAgc2Nhbl9lbmQgICA9IF93aW5bc2NhbiArIGJlc3RfbGVuXTsKICAgICAgfQogICAgfSB3aGlsZSAoKGN1cl9tYXRjaCA9IHByZXZbY3VyX21hdGNoICYgd21hc2tdKSA+IGxpbWl0ICYmIC0tY2hhaW5fbGVuZ3RoICE9PSAwKTsKCiAgICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgICAgcmV0dXJuIGJlc3RfbGVuOwogICAgfQogICAgcmV0dXJuIHMubG9va2FoZWFkOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGaWxsIHRoZSB3aW5kb3cgd2hlbiB0aGUgbG9va2FoZWFkIGJlY29tZXMgaW5zdWZmaWNpZW50LgogICAqIFVwZGF0ZXMgc3Ryc3RhcnQgYW5kIGxvb2thaGVhZC4KICAgKgogICAqIElOIGFzc2VydGlvbjogbG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRAogICAqIE9VVCBhc3NlcnRpb25zOiBzdHJzdGFydCA8PSB3aW5kb3dfc2l6ZS1NSU5fTE9PS0FIRUFECiAgICogICAgQXQgbGVhc3Qgb25lIGJ5dGUgaGFzIGJlZW4gcmVhZCwgb3IgYXZhaWxfaW4gPT0gMDsgcmVhZHMgYXJlCiAgICogICAgcGVyZm9ybWVkIGZvciBhdCBsZWFzdCB0d28gYnl0ZXMgKHJlcXVpcmVkIGZvciB0aGUgemlwIHRyYW5zbGF0ZV9lb2wKICAgKiAgICBvcHRpb24gLS0gbm90IHN1cHBvcnRlZCBoZXJlKS4KICAgKi8KICBjb25zdCBmaWxsX3dpbmRvdyA9IChzKSA9PiB7CgogICAgY29uc3QgX3dfc2l6ZSA9IHMud19zaXplOwogICAgbGV0IHAsIG4sIG0sIG1vcmUsIHN0cjsKCiAgICAvL0Fzc2VydChzLT5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFELCAiYWxyZWFkeSBlbm91Z2ggbG9va2FoZWFkIik7CgogICAgZG8gewogICAgICBtb3JlID0gcy53aW5kb3dfc2l6ZSAtIHMubG9va2FoZWFkIC0gcy5zdHJzdGFydDsKCiAgICAgIC8vIEpTIGludHMgaGF2ZSAzMiBiaXQsIGJsb2NrIGJlbG93IG5vdCBuZWVkZWQKICAgICAgLyogRGVhbCB3aXRoICFAIyQlIDY0SyBsaW1pdDogKi8KICAgICAgLy9pZiAoc2l6ZW9mKGludCkgPD0gMikgewogICAgICAvLyAgICBpZiAobW9yZSA9PSAwICYmIHMtPnN0cnN0YXJ0ID09IDAgJiYgcy0+bG9va2FoZWFkID09IDApIHsKICAgICAgLy8gICAgICAgIG1vcmUgPSB3c2l6ZTsKICAgICAgLy8KICAgICAgLy8gIH0gZWxzZSBpZiAobW9yZSA9PSAodW5zaWduZWQpKC0xKSkgewogICAgICAvLyAgICAgICAgLyogVmVyeSB1bmxpa2VseSwgYnV0IHBvc3NpYmxlIG9uIDE2IGJpdCBtYWNoaW5lIGlmCiAgICAgIC8vICAgICAgICAgKiBzdHJzdGFydCA9PSAwICYmIGxvb2thaGVhZCA9PSAxIChpbnB1dCBkb25lIGEgYnl0ZSBhdCB0aW1lKQogICAgICAvLyAgICAgICAgICovCiAgICAgIC8vICAgICAgICBtb3JlLS07CiAgICAgIC8vICAgIH0KICAgICAgLy99CgoKICAgICAgLyogSWYgdGhlIHdpbmRvdyBpcyBhbG1vc3QgZnVsbCBhbmQgdGhlcmUgaXMgaW5zdWZmaWNpZW50IGxvb2thaGVhZCwKICAgICAgICogbW92ZSB0aGUgdXBwZXIgaGFsZiB0byB0aGUgbG93ZXIgb25lIHRvIG1ha2Ugcm9vbSBpbiB0aGUgdXBwZXIgaGFsZi4KICAgICAgICovCiAgICAgIGlmIChzLnN0cnN0YXJ0ID49IF93X3NpemUgKyAoX3dfc2l6ZSAtIE1JTl9MT09LQUhFQUQpKSB7CgogICAgICAgIHMud2luZG93LnNldChzLndpbmRvdy5zdWJhcnJheShfd19zaXplLCBfd19zaXplICsgX3dfc2l6ZSksIDApOwogICAgICAgIHMubWF0Y2hfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICBzLnN0cnN0YXJ0IC09IF93X3NpemU7CiAgICAgICAgLyogd2Ugbm93IGhhdmUgc3Ryc3RhcnQgPj0gTUFYX0RJU1QgKi8KICAgICAgICBzLmJsb2NrX3N0YXJ0IC09IF93X3NpemU7CgogICAgICAgIC8qIFNsaWRlIHRoZSBoYXNoIHRhYmxlIChjb3VsZCBiZSBhdm9pZGVkIHdpdGggMzIgYml0IHZhbHVlcwogICAgICAgICBhdCB0aGUgZXhwZW5zZSBvZiBtZW1vcnkgdXNhZ2UpLiBXZSBzbGlkZSBldmVuIHdoZW4gbGV2ZWwgPT0gMAogICAgICAgICB0byBrZWVwIHRoZSBoYXNoIHRhYmxlIGNvbnNpc3RlbnQgaWYgd2Ugc3dpdGNoIGJhY2sgdG8gbGV2ZWwgPiAwCiAgICAgICAgIGxhdGVyLiAoVXNpbmcgbGV2ZWwgMCBwZXJtYW5lbnRseSBpcyBub3QgYW4gb3B0aW1hbCB1c2FnZSBvZgogICAgICAgICB6bGliLCBzbyB3ZSBkb24ndCBjYXJlIGFib3V0IHRoaXMgcGF0aG9sb2dpY2FsIGNhc2UuKQogICAgICAgICAqLwoKICAgICAgICBuID0gcy5oYXNoX3NpemU7CiAgICAgICAgcCA9IG47CgogICAgICAgIGRvIHsKICAgICAgICAgIG0gPSBzLmhlYWRbLS1wXTsKICAgICAgICAgIHMuaGVhZFtwXSA9IChtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDApOwogICAgICAgIH0gd2hpbGUgKC0tbik7CgogICAgICAgIG4gPSBfd19zaXplOwogICAgICAgIHAgPSBuOwoKICAgICAgICBkbyB7CiAgICAgICAgICBtID0gcy5wcmV2Wy0tcF07CiAgICAgICAgICBzLnByZXZbcF0gPSAobSA+PSBfd19zaXplID8gbSAtIF93X3NpemUgOiAwKTsKICAgICAgICAgIC8qIElmIG4gaXMgbm90IG9uIGFueSBoYXNoIGNoYWluLCBwcmV2W25dIGlzIGdhcmJhZ2UgYnV0CiAgICAgICAgICAgKiBpdHMgdmFsdWUgd2lsbCBuZXZlciBiZSB1c2VkLgogICAgICAgICAgICovCiAgICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgICAgbW9yZSArPSBfd19zaXplOwogICAgICB9CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfaW4gPT09IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIHNsaWRpbmc6CiAgICAgICAqICAgIHN0cnN0YXJ0IDw9IFdTSVpFK01BWF9ESVNULTEgJiYgbG9va2FoZWFkIDw9IE1JTl9MT09LQUhFQUQgLSAxICYmCiAgICAgICAqICAgIG1vcmUgPT0gd2luZG93X3NpemUgLSBsb29rYWhlYWQgLSBzdHJzdGFydAogICAgICAgKiA9PiBtb3JlID49IHdpbmRvd19zaXplIC0gKE1JTl9MT09LQUhFQUQtMSArIFdTSVpFICsgTUFYX0RJU1QtMSkKICAgICAgICogPT4gbW9yZSA+PSB3aW5kb3dfc2l6ZSAtIDIqV1NJWkUgKyAyCiAgICAgICAqIEluIHRoZSBCSUdfTUVNIG9yIE1NQVAgY2FzZSAobm90IHlldCBzdXBwb3J0ZWQpLAogICAgICAgKiAgIHdpbmRvd19zaXplID09IGlucHV0X3NpemUgKyBNSU5fTE9PS0FIRUFEICAmJgogICAgICAgKiAgIHN0cnN0YXJ0ICsgcy0+bG9va2FoZWFkIDw9IGlucHV0X3NpemUgPT4gbW9yZSA+PSBNSU5fTE9PS0FIRUFELgogICAgICAgKiBPdGhlcndpc2UsIHdpbmRvd19zaXplID09IDIqV1NJWkUgc28gbW9yZSA+PSAyLgogICAgICAgKiBJZiB0aGVyZSB3YXMgc2xpZGluZywgbW9yZSA+PSBXU0laRS4gU28gaW4gYWxsIGNhc2VzLCBtb3JlID49IDIuCiAgICAgICAqLwogICAgICAvL0Fzc2VydChtb3JlID49IDIsICJtb3JlIDwgMiIpOwogICAgICBuID0gcmVhZF9idWYocy5zdHJtLCBzLndpbmRvdywgcy5zdHJzdGFydCArIHMubG9va2FoZWFkLCBtb3JlKTsKICAgICAgcy5sb29rYWhlYWQgKz0gbjsKCiAgICAgIC8qIEluaXRpYWxpemUgdGhlIGhhc2ggdmFsdWUgbm93IHRoYXQgd2UgaGF2ZSBzb21lIGlucHV0OiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0IC0gcy5pbnNlcnQ7CiAgICAgICAgcy5pbnNfaCA9IHMud2luZG93W3N0cl07CgogICAgICAgIC8qIFVQREFURV9IQVNIKHMsIHMtPmluc19oLCBzLT53aW5kb3dbc3RyICsgMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIDFdKTsKICAvLyNpZiBNSU5fTUFUQ0ggIT0gMwogIC8vICAgICAgICBDYWxsIHVwZGF0ZV9oYXNoKCkgTUlOX01BVENILTMgbW9yZSB0aW1lcwogIC8vI2VuZGlmCiAgICAgICAgd2hpbGUgKHMuaW5zZXJ0KSB7CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLT5pbnNfaCwgcy0+d2luZG93W3N0ciArIE1JTl9NQVRDSC0xXSk7ICovCiAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzdHIgKyBNSU5fTUFUQ0ggLSAxXSk7CgogICAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgIHN0cisrOwogICAgICAgICAgcy5pbnNlcnQtLTsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvKiBJZiB0aGUgd2hvbGUgaW5wdXQgaGFzIGxlc3MgdGhhbiBNSU5fTUFUQ0ggYnl0ZXMsIGluc19oIGlzIGdhcmJhZ2UsCiAgICAgICAqIGJ1dCB0aGlzIGlzIG5vdCBpbXBvcnRhbnQgc2luY2Ugb25seSBsaXRlcmFsIGJ5dGVzIHdpbGwgYmUgZW1pdHRlZC4KICAgICAgICovCgogICAgfSB3aGlsZSAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIHMuc3RybS5hdmFpbF9pbiAhPT0gMCk7CgogICAgLyogSWYgdGhlIFdJTl9JTklUIGJ5dGVzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgZGF0YSBoYXZlIG5ldmVyIGJlZW4KICAgICAqIHdyaXR0ZW4sIHRoZW4gemVybyB0aG9zZSBieXRlcyBpbiBvcmRlciB0byBhdm9pZCBtZW1vcnkgY2hlY2sgcmVwb3J0cyBvZgogICAgICogdGhlIHVzZSBvZiB1bmluaXRpYWxpemVkIChvciB1bmluaXRpYWxpc2VkIGFzIEp1bGlhbiB3cml0ZXMpIGJ5dGVzIGJ5CiAgICAgKiB0aGUgbG9uZ2VzdCBtYXRjaCByb3V0aW5lcy4gIFVwZGF0ZSB0aGUgaGlnaCB3YXRlciBtYXJrIGZvciB0aGUgbmV4dAogICAgICogdGltZSB0aHJvdWdoIGhlcmUuICBXSU5fSU5JVCBpcyBzZXQgdG8gTUFYX01BVENIIHNpbmNlIHRoZSBsb25nZXN0IG1hdGNoCiAgICAgKiByb3V0aW5lcyBhbGxvdyBzY2FubmluZyB0byBzdHJzdGFydCArIE1BWF9NQVRDSCwgaWdub3JpbmcgbG9va2FoZWFkLgogICAgICovCiAgLy8gIGlmIChzLmhpZ2hfd2F0ZXIgPCBzLndpbmRvd19zaXplKSB7CiAgLy8gICAgY29uc3QgY3VyciA9IHMuc3Ryc3RhcnQgKyBzLmxvb2thaGVhZDsKICAvLyAgICBsZXQgaW5pdCA9IDA7CiAgLy8KICAvLyAgICBpZiAocy5oaWdoX3dhdGVyIDwgY3VycikgewogIC8vICAgICAgLyogUHJldmlvdXMgaGlnaCB3YXRlciBtYXJrIGJlbG93IGN1cnJlbnQgZGF0YSAtLSB6ZXJvIFdJTl9JTklUCiAgLy8gICAgICAgKiBieXRlcyBvciB1cCB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9IHMud2luZG93X3NpemUgLSBjdXJyOwogIC8vICAgICAgaWYgKGluaXQgPiBXSU5fSU5JVCkKICAvLyAgICAgICAgaW5pdCA9IFdJTl9JTklUOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgY3VyciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciA9IGN1cnIgKyBpbml0OwogIC8vICAgIH0KICAvLyAgICBlbHNlIGlmIChzLT5oaWdoX3dhdGVyIDwgKHVsZyljdXJyICsgV0lOX0lOSVQpIHsKICAvLyAgICAgIC8qIEhpZ2ggd2F0ZXIgbWFyayBhdCBvciBhYm92ZSBjdXJyZW50IGRhdGEsIGJ1dCBiZWxvdyBjdXJyZW50IGRhdGEKICAvLyAgICAgICAqIHBsdXMgV0lOX0lOSVQgLS0gemVybyBvdXQgdG8gY3VycmVudCBkYXRhIHBsdXMgV0lOX0lOSVQsIG9yIHVwCiAgLy8gICAgICAgKiB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9ICh1bGcpY3VyciArIFdJTl9JTklUIC0gcy0+aGlnaF93YXRlcjsKICAvLyAgICAgIGlmIChpbml0ID4gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyKQogIC8vICAgICAgICBpbml0ID0gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgcy0+aGlnaF93YXRlciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciArPSBpbml0OwogIC8vICAgIH0KICAvLyAgfQogIC8vCiAgLy8gIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplIC0gTUlOX0xPT0tBSEVBRCwKICAvLyAgICAibm90IGVub3VnaCByb29tIGZvciBzZWFyY2giKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb3B5IHdpdGhvdXQgY29tcHJlc3Npb24gYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIHRoZSBpbnB1dCBzdHJlYW0sIHJldHVybgogICAqIHRoZSBjdXJyZW50IGJsb2NrIHN0YXRlLgogICAqIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgaW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBkaWN0aW9uYXJ5IHNpbmNlCiAgICogdW5jb21wcmVzc2libGUgZGF0YSBpcyBwcm9iYWJseSBub3QgdXNlZnVsLiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQKICAgKiBvbmx5IGZvciB0aGUgbGV2ZWw9MCBjb21wcmVzc2lvbiBvcHRpb24uCiAgICogTk9URTogdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgb3B0aW1pemVkIHRvIGF2b2lkIGV4dHJhIGNvcHlpbmcgZnJvbQogICAqIHdpbmRvdyB0byBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBkZWZsYXRlX3N0b3JlZCA9IChzLCBmbHVzaCkgPT4gewoKICAgIC8qIFN0b3JlZCBibG9ja3MgYXJlIGxpbWl0ZWQgdG8gMHhmZmZmIGJ5dGVzLCBwZW5kaW5nX2J1ZiBpcyBsaW1pdGVkCiAgICAgKiB0byBwZW5kaW5nX2J1Zl9zaXplLCBhbmQgZWFjaCBzdG9yZWQgYmxvY2sgaGFzIGEgNSBieXRlIGhlYWRlcjoKICAgICAqLwogICAgbGV0IG1heF9ibG9ja19zaXplID0gMHhmZmZmOwoKICAgIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgICAgbWF4X2Jsb2NrX3NpemUgPSBzLnBlbmRpbmdfYnVmX3NpemUgLSA1OwogICAgfQoKICAgIC8qIENvcHkgYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIGlucHV0IHRvIG91dHB1dDogKi8KICAgIGZvciAoOzspIHsKICAgICAgLyogRmlsbCB0aGUgd2luZG93IGFzIG11Y2ggYXMgcG9zc2libGU6ICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSAxKSB7CgogICAgICAgIC8vQXNzZXJ0KHMtPnN0cnN0YXJ0IDwgcy0+d19zaXplK01BWF9ESVNUKHMpIHx8CiAgICAgICAgLy8gIHMtPmJsb2NrX3N0YXJ0ID49IChsb25nKXMtPndfc2l6ZSwgInNsaWRlIHRvbyBsYXRlIik7CiAgLy8gICAgICBpZiAoIShzLnN0cnN0YXJ0IDwgcy53X3NpemUgKyAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSB8fAogIC8vICAgICAgICBzLmJsb2NrX3N0YXJ0ID49IHMud19zaXplKSkgewogIC8vICAgICAgICB0aHJvdyAgbmV3IEVycm9yKCJzbGlkZSB0b28gbGF0ZSIpOwogIC8vICAgICAgfQoKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDAgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMikgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CgogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgIH0KICAgICAgLy9Bc3NlcnQocy0+YmxvY2tfc3RhcnQgPj0gMEwsICJibG9jayBnb25lIik7CiAgLy8gICAgaWYgKHMuYmxvY2tfc3RhcnQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoImJsb2NrIGdvbmUiKTsKCiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICAgIHMubG9va2FoZWFkID0gMDsKCiAgICAgIC8qIEVtaXQgYSBzdG9yZWQgYmxvY2sgaWYgcGVuZGluZ19idWYgd2lsbCBiZSBmdWxsOiAqLwogICAgICBjb25zdCBtYXhfc3RhcnQgPSBzLmJsb2NrX3N0YXJ0ICsgbWF4X2Jsb2NrX3NpemU7CgogICAgICBpZiAocy5zdHJzdGFydCA9PT0gMCB8fCBzLnN0cnN0YXJ0ID49IG1heF9zdGFydCkgewogICAgICAgIC8qIHN0cnN0YXJ0ID09IDAgaXMgcG9zc2libGUgd2hlbiB3cmFwYXJvdW5kIG9uIDE2LWJpdCBtYWNoaW5lICovCiAgICAgICAgcy5sb29rYWhlYWQgPSBzLnN0cnN0YXJ0IC0gbWF4X3N0YXJ0OwogICAgICAgIHMuc3Ryc3RhcnQgPSBtYXhfc3RhcnQ7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwoKCiAgICAgIH0KICAgICAgLyogRmx1c2ggaWYgd2UgbWF5IGhhdmUgdG8gc2xpZGUsIG90aGVyd2lzZSBibG9ja19zdGFydCBtYXkgYmVjb21lCiAgICAgICAqIG5lZ2F0aXZlIGFuZCB0aGUgZGF0YSB3aWxsIGJlIGdvbmU6CiAgICAgICAqLwogICAgICBpZiAocy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQgPj0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpIHsKICAgICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIC8qKiovCiAgICAgIH0KICAgIH0KCiAgICBzLmluc2VydCA9IDA7CgogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQoKICAgIGlmIChzLnN0cnN0YXJ0ID4gcy5ibG9ja19zdGFydCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogIH07CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbXByZXNzIGFzIG11Y2ggYXMgcG9zc2libGUgZnJvbSB0aGUgaW5wdXQgc3RyZWFtLCByZXR1cm4gdGhlIGN1cnJlbnQKICAgKiBibG9jayBzdGF0ZS4KICAgKiBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IHBlcmZvcm0gbGF6eSBldmFsdWF0aW9uIG9mIG1hdGNoZXMgYW5kIGluc2VydHMKICAgKiBuZXcgc3RyaW5ncyBpbiB0aGUgZGljdGlvbmFyeSBvbmx5IGZvciB1bm1hdGNoZWQgc3RyaW5ncyBvciBmb3Igc2hvcnQKICAgKiBtYXRjaGVzLiBJdCBpcyB1c2VkIG9ubHkgZm9yIHRoZSBmYXN0IGNvbXByZXNzaW9uIG9wdGlvbnMuCiAgICovCiAgY29uc3QgZGVmbGF0ZV9mYXN0ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgIC8qIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gKi8KICAgIGxldCBiZmx1c2g7ICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7IC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgICAgfQogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKiBBdCB0aGlzIHBvaW50IHdlIGhhdmUgYWx3YXlzIG1hdGNoX2xlbmd0aCA8IE1JTl9NQVRDSAogICAgICAgKi8KICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMC8qTklMKi8gJiYgKChzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkKSA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkpIHsKICAgICAgICAvKiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgd2UgcHJldmVudCBtYXRjaGVzIHdpdGggdGhlIHN0cmluZwogICAgICAgICAqIG9mIHdpbmRvdyBpbmRleCAwIChpbiBwYXJ0aWN1bGFyIHdlIGhhdmUgdG8gYXZvaWQgYSBtYXRjaAogICAgICAgICAqIG9mIHRoZSBzdHJpbmcgd2l0aCBpdHNlbGYgYXQgdGhlIHN0YXJ0IG9mIHRoZSBpbnB1dCBmaWxlKS4KICAgICAgICAgKi8KICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IGxvbmdlc3RfbWF0Y2gocywgaGFzaF9oZWFkKTsKICAgICAgICAvKiBsb25nZXN0X21hdGNoKCkgc2V0cyBtYXRjaF9zdGFydCAqLwogICAgICB9CiAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvLyBjaGVja19tYXRjaChzLCBzLnN0cnN0YXJ0LCBzLm1hdGNoX3N0YXJ0LCBzLm1hdGNoX2xlbmd0aCk7IC8vIGZvciBkZWJ1ZyBvbmx5CgogICAgICAgIC8qKiogX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggLSBNSU5fTUFUQ0gsIGJmbHVzaCk7ICoqKi8KICAgICAgICBiZmx1c2ggPSBfdHJfdGFsbHkocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKCiAgICAgICAgcy5sb29rYWhlYWQgLT0gcy5tYXRjaF9sZW5ndGg7CgogICAgICAgIC8qIEluc2VydCBuZXcgc3RyaW5ncyBpbiB0aGUgaGFzaCB0YWJsZSBvbmx5IGlmIHRoZSBtYXRjaCBsZW5ndGgKICAgICAgICAgKiBpcyBub3QgdG9vIGxhcmdlLiBUaGlzIHNhdmVzIHRpbWUgYnV0IGRlZ3JhZGVzIGNvbXByZXNzaW9uLgogICAgICAgICAqLwogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSBzLm1heF9sYXp5X21hdGNoLyptYXhfaW5zZXJ0X2xlbmd0aCovICYmIHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgICAgcy5tYXRjaF9sZW5ndGgtLTsgLyogc3RyaW5nIGF0IHN0cnN0YXJ0IGFscmVhZHkgaW4gdGFibGUgKi8KICAgICAgICAgIGRvIHsKICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pOwogICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAgICAgLyoqKi8KICAgICAgICAgICAgLyogc3Ryc3RhcnQgbmV2ZXIgZXhjZWVkcyBXU0laRS1NQVhfTUFUQ0gsIHNvIHRoZXJlIGFyZQogICAgICAgICAgICAgKiBhbHdheXMgTUlOX01BVENIIGJ5dGVzIGFoZWFkLgogICAgICAgICAgICAgKi8KICAgICAgICAgIH0gd2hpbGUgKC0tcy5tYXRjaF9sZW5ndGggIT09IDApOwogICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgIH0gZWxzZQogICAgICAgIHsKICAgICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgICBzLmluc19oID0gcy53aW5kb3dbcy5zdHJzdGFydF07CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0KzFdKTsgKi8KICAgICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyAxXSk7CgogIC8vI2lmIE1JTl9NQVRDSCAhPSAzCiAgLy8gICAgICAgICAgICAgICAgQ2FsbCBVUERBVEVfSEFTSCgpIE1JTl9NQVRDSC0zIG1vcmUgdGltZXMKICAvLyNlbmRpZgogICAgICAgICAgLyogSWYgbG9va2FoZWFkIDwgTUlOX01BVENILCBpbnNfaCBpcyBnYXJiYWdlLCBidXQgaXQgZG9lcyBub3QKICAgICAgICAgICAqIG1hdHRlciBzaW5jZSBpdCB3aWxsIGJlIHJlY29tcHV0ZWQgYXQgbmV4dCBkZWZsYXRlIGNhbGwuCiAgICAgICAgICAgKi8KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogTm8gbWF0Y2gsIG91dHB1dCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCIlYyIsIHMud2luZG93W3Muc3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAoKHMuc3Ryc3RhcnQgPCAoTUlOX01BVENIIC0gMSkpID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDEpOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTYW1lIGFzIGFib3ZlLCBidXQgYWNoaWV2ZXMgYmV0dGVyIGNvbXByZXNzaW9uLiBXZSB1c2UgYSBsYXp5CiAgICogZXZhbHVhdGlvbiBmb3IgbWF0Y2hlczogYSBtYXRjaCBpcyBmaW5hbGx5IGFkb3B0ZWQgb25seSBpZiB0aGVyZSBpcwogICAqIG5vIGJldHRlciBtYXRjaCBhdCB0aGUgbmV4dCB3aW5kb3cgcG9zaXRpb24uCiAgICovCiAgY29uc3QgZGVmbGF0ZV9zbG93ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgICAgLyogaGVhZCBvZiBoYXNoIGNoYWluICovCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAgLyogc2V0IGlmIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkICovCgogICAgbGV0IG1heF9pbnNlcnQ7CgogICAgLyogUHJvY2VzcyB0aGUgaW5wdXQgYmxvY2suICovCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgeyBicmVhazsgfSAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKi8KICAgICAgcy5wcmV2X2xlbmd0aCA9IHMubWF0Y2hfbGVuZ3RoOwogICAgICBzLnByZXZfbWF0Y2ggPSBzLm1hdGNoX3N0YXJ0OwogICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CgogICAgICBpZiAoaGFzaF9oZWFkICE9PSAwLypOSUwqLyAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJgogICAgICAgICAgcy5zdHJzdGFydCAtIGhhc2hfaGVhZCA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKS8qTUFYX0RJU1QocykqLykgewogICAgICAgIC8qIFRvIHNpbXBsaWZ5IHRoZSBjb2RlLCB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nCiAgICAgICAgICogb2Ygd2luZG93IGluZGV4IDAgKGluIHBhcnRpY3VsYXIgd2UgaGF2ZSB0byBhdm9pZCBhIG1hdGNoCiAgICAgICAgICogb2YgdGhlIHN0cmluZyB3aXRoIGl0c2VsZiBhdCB0aGUgc3RhcnQgb2YgdGhlIGlucHV0IGZpbGUpLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgIC8qIGxvbmdlc3RfbWF0Y2goKSBzZXRzIG1hdGNoX3N0YXJ0ICovCgogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSA1ICYmCiAgICAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfRklMVEVSRUQgfHwgKHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2LypUT09fRkFSKi8pKSkgewoKICAgICAgICAgIC8qIElmIHByZXZfbWF0Y2ggaXMgYWxzbyBNSU5fTUFUQ0gsIG1hdGNoX3N0YXJ0IGlzIGdhcmJhZ2UKICAgICAgICAgICAqIGJ1dCB3ZSB3aWxsIGlnbm9yZSB0aGUgY3VycmVudCBtYXRjaCBhbnl3YXkuCiAgICAgICAgICAgKi8KICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYXQgdGhlIHByZXZpb3VzIHN0ZXAgYW5kIHRoZSBjdXJyZW50CiAgICAgICAqIG1hdGNoIGlzIG5vdCBiZXR0ZXIsIG91dHB1dCB0aGUgcHJldmlvdXMgbWF0Y2g6CiAgICAgICAqLwogICAgICBpZiAocy5wcmV2X2xlbmd0aCA+PSBNSU5fTUFUQ0ggJiYgcy5tYXRjaF9sZW5ndGggPD0gcy5wcmV2X2xlbmd0aCkgewogICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgLyogRG8gbm90IGluc2VydCBzdHJpbmdzIGluIGhhc2ggdGFibGUgYmV5b25kIHRoaXMuICovCgogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydC0xLCBzLnByZXZfbWF0Y2gsIHMucHJldl9sZW5ndGgpOwoKICAgICAgICAvKioqX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIDEgLSBzLnByZXZfbWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSAxIC0gcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICAvKiBJbnNlcnQgaW4gaGFzaCB0YWJsZSBhbGwgc3RyaW5ncyB1cCB0byB0aGUgZW5kIG9mIHRoZSBtYXRjaC4KICAgICAgICAgKiBzdHJzdGFydC0xIGFuZCBzdHJzdGFydCBhcmUgYWxyZWFkeSBpbnNlcnRlZC4gSWYgdGhlcmUgaXMgbm90CiAgICAgICAgICogZW5vdWdoIGxvb2thaGVhZCwgdGhlIGxhc3QgdHdvIHN0cmluZ3MgYXJlIG5vdCBpbnNlcnRlZCBpbgogICAgICAgICAqIHRoZSBoYXNoIHRhYmxlLgogICAgICAgICAqLwogICAgICAgIHMubG9va2FoZWFkIC09IHMucHJldl9sZW5ndGggLSAxOwogICAgICAgIHMucHJldl9sZW5ndGggLT0gMjsKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAoKytzLnN0cnN0YXJ0IDw9IG1heF9pbnNlcnQpIHsKICAgICAgICAgICAgLyoqKiBJTlNFUlRfU1RSSU5HKHMsIHMuc3Ryc3RhcnQsIGhhc2hfaGVhZCk7ICoqKi8KICAgICAgICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKTsKICAgICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICAgIC8qKiovCiAgICAgICAgICB9CiAgICAgICAgfSB3aGlsZSAoLS1zLnByZXZfbGVuZ3RoICE9PSAwKTsKICAgICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgICAgIHMuc3Ryc3RhcnQrKzsKCiAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgICAgLyoqKi8KICAgICAgICB9CgogICAgICB9IGVsc2UgaWYgKHMubWF0Y2hfYXZhaWxhYmxlKSB7CiAgICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIG1hdGNoIGF0IHRoZSBwcmV2aW91cyBwb3NpdGlvbiwgb3V0cHV0IGEKICAgICAgICAgKiBzaW5nbGUgbGl0ZXJhbC4gSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYnV0IHRoZSBjdXJyZW50IG1hdGNoCiAgICAgICAgICogaXMgbG9uZ2VyLCB0cnVuY2F0ZSB0aGUgcHJldmlvdXMgbWF0Y2ggdG8gYSBzaW5nbGUgbGl0ZXJhbC4KICAgICAgICAgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydC0xXSwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwoKICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAvKioqIEZMVVNIX0JMT0NLX09OTFkocywgMCkgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAvKioqLwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogVGhlcmUgaXMgbm8gcHJldmlvdXMgbWF0Y2ggdG8gY29tcGFyZSB3aXRoLCB3YWl0IGZvcgogICAgICAgICAqIHRoZSBuZXh0IHN0ZXAgdG8gZGVjaWRlLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGZsdXNoICE9IFpfTk9fRkxVU0gsICJubyBmbHVzaD8iKTsKICAgIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnQtMV0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CgogICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICB9CiAgICBzLmluc2VydCA9IHMuc3Ryc3RhcnQgPCBNSU5fTUFUQ0ggLSAxID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDE7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRm9yIFpfUkxFLCBzaW1wbHkgbG9vayBmb3IgcnVucyBvZiBieXRlcywgZ2VuZXJhdGUgbWF0Y2hlcyBvbmx5IG9mIGRpc3RhbmNlCiAgICogb25lLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4gIChJdCB3aWxsIGJlIHJlZ2VuZXJhdGVkIGlmIHRoaXMgcnVuIG9mCiAgICogZGVmbGF0ZSBzd2l0Y2hlcyBhd2F5IGZyb20gWl9STEUuKQogICAqLwogIGNvbnN0IGRlZmxhdGVfcmxlID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGJmbHVzaDsgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KICAgIGxldCBwcmV2OyAgICAgICAgICAgICAgLyogYnl0ZSBhdCBkaXN0YW5jZSBvbmUgdG8gbWF0Y2ggKi8KICAgIGxldCBzY2FuLCBzdHJlbmQ7ICAgICAgLyogc2NhbiBnb2VzIHVwIHRvIHN0cmVuZCBmb3IgbGVuZ3RoIG9mIHJ1biAqLwoKICAgIGNvbnN0IF93aW4gPSBzLndpbmRvdzsKCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIGxvbmdlc3QgcnVuLCBwbHVzIG9uZSBmb3IgdGhlIHVucm9sbGVkIGxvb3AuCiAgICAgICAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPD0gTUFYX01BVENIKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkIDw9IE1BWF9NQVRDSCAmJiBmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsgYnJlYWs7IH0gLyogZmx1c2ggdGhlIGN1cnJlbnQgYmxvY2sgKi8KICAgICAgfQoKICAgICAgLyogU2VlIGhvdyBtYW55IHRpbWVzIHRoZSBwcmV2aW91cyBieXRlIHJlcGVhdHMgKi8KICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIICYmIHMuc3Ryc3RhcnQgPiAwKSB7CiAgICAgICAgc2NhbiA9IHMuc3Ryc3RhcnQgLSAxOwogICAgICAgIHByZXYgPSBfd2luW3NjYW5dOwogICAgICAgIGlmIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSkgewogICAgICAgICAgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgLypqc2hpbnQgbm9lbXB0eTpmYWxzZSovCiAgICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBzY2FuIDwgc3RyZW5kKTsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUFYX01BVENIIC0gKHN0cmVuZCAtIHNjYW4pOwogICAgICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBzLmxvb2thaGVhZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9Bc3NlcnQoc2NhbiA8PSBzLT53aW5kb3crKHVJbnQpKHMtPndpbmRvd19zaXplLTEpLCAid2lsZCBzY2FuIik7CiAgICAgIH0KCiAgICAgIC8qIEVtaXQgbWF0Y2ggaWYgaGF2ZSBydW4gb2YgTUlOX01BVENIIG9yIGxvbmdlciwgZWxzZSBlbWl0IGxpdGVyYWwgKi8KICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID49IE1JTl9NQVRDSCkgewogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydCwgcy5zdHJzdGFydCAtIDEsIHMubWF0Y2hfbGVuZ3RoKTsKCiAgICAgICAgLyoqKiBfdHJfdGFsbHlfZGlzdChzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCk7CgogICAgICAgIHMubG9va2FoZWFkIC09IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIE5vIG1hdGNoLCBvdXRwdXQgYSBsaXRlcmFsIGJ5dGUgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGb3IgWl9IVUZGTUFOX09OTFksIGRvIG5vdCBsb29rIGZvciBtYXRjaGVzLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4KICAgKiAoSXQgd2lsbCBiZSByZWdlbmVyYXRlZCBpZiB0aGlzIHJ1biBvZiBkZWZsYXRlIHN3aXRjaGVzIGF3YXkgZnJvbSBIdWZmbWFuLikKICAgKi8KICBjb25zdCBkZWZsYXRlX2h1ZmYgPSAocywgZmx1c2gpID0+IHsKCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGhhdmUgYSBsaXRlcmFsIHRvIHdyaXRlLiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsgICAgICAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogT3V0cHV0IGEgbGl0ZXJhbCBieXRlICovCiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0XSkpOwogICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydF0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgcy5zdHJzdGFydCsrOwogICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwogICAgICB9CiAgICB9CiAgICBzLmluc2VydCA9IDA7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KICAgIHJldHVybiBCU19CTE9DS19ET05FOwogIH07CgogIC8qIFZhbHVlcyBmb3IgbWF4X2xhenlfbWF0Y2gsIGdvb2RfbWF0Y2ggYW5kIG1heF9jaGFpbl9sZW5ndGgsIGRlcGVuZGluZyBvbgogICAqIHRoZSBkZXNpcmVkIHBhY2sgbGV2ZWwgKDAuLjkpLiBUaGUgdmFsdWVzIGdpdmVuIGJlbG93IGhhdmUgYmVlbiB0dW5lZCB0bwogICAqIGV4Y2x1ZGUgd29yc3QgY2FzZSBwZXJmb3JtYW5jZSBmb3IgcGF0aG9sb2dpY2FsIGZpbGVzLiBCZXR0ZXIgdmFsdWVzIG1heSBiZQogICAqIGZvdW5kIGZvciBzcGVjaWZpYyBmaWxlcy4KICAgKi8KICBmdW5jdGlvbiBDb25maWcoZ29vZF9sZW5ndGgsIG1heF9sYXp5LCBuaWNlX2xlbmd0aCwgbWF4X2NoYWluLCBmdW5jKSB7CgogICAgdGhpcy5nb29kX2xlbmd0aCA9IGdvb2RfbGVuZ3RoOwogICAgdGhpcy5tYXhfbGF6eSA9IG1heF9sYXp5OwogICAgdGhpcy5uaWNlX2xlbmd0aCA9IG5pY2VfbGVuZ3RoOwogICAgdGhpcy5tYXhfY2hhaW4gPSBtYXhfY2hhaW47CiAgICB0aGlzLmZ1bmMgPSBmdW5jOwogIH0KCiAgY29uc3QgY29uZmlndXJhdGlvbl90YWJsZSA9IFsKICAgIC8qICAgICAgZ29vZCBsYXp5IG5pY2UgY2hhaW4gKi8KICAgIG5ldyBDb25maWcoMCwgMCwgMCwgMCwgZGVmbGF0ZV9zdG9yZWQpLCAgICAgICAgICAvKiAwIHN0b3JlIG9ubHkgKi8KICAgIG5ldyBDb25maWcoNCwgNCwgOCwgNCwgZGVmbGF0ZV9mYXN0KSwgICAgICAgICAgICAvKiAxIG1heCBzcGVlZCwgbm8gbGF6eSBtYXRjaGVzICovCiAgICBuZXcgQ29uZmlnKDQsIDUsIDE2LCA4LCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAgLyogMiAqLwogICAgbmV3IENvbmZpZyg0LCA2LCAzMiwgMzIsIGRlZmxhdGVfZmFzdCksICAgICAgICAgIC8qIDMgKi8KCiAgICBuZXcgQ29uZmlnKDQsIDQsIDE2LCAxNiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAgLyogNCBsYXp5IG1hdGNoZXMgKi8KICAgIG5ldyBDb25maWcoOCwgMTYsIDMyLCAzMiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAvKiA1ICovCiAgICBuZXcgQ29uZmlnKDgsIDE2LCAxMjgsIDEyOCwgZGVmbGF0ZV9zbG93KSwgICAgICAgLyogNiAqLwogICAgbmV3IENvbmZpZyg4LCAzMiwgMTI4LCAyNTYsIGRlZmxhdGVfc2xvdyksICAgICAgIC8qIDcgKi8KICAgIG5ldyBDb25maWcoMzIsIDEyOCwgMjU4LCAxMDI0LCBkZWZsYXRlX3Nsb3cpLCAgICAvKiA4ICovCiAgICBuZXcgQ29uZmlnKDMyLCAyNTgsIDI1OCwgNDA5NiwgZGVmbGF0ZV9zbG93KSAgICAgLyogOSBtYXggY29tcHJlc3Npb24gKi8KICBdOwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgImxvbmdlc3QgbWF0Y2giIHJvdXRpbmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbQogICAqLwogIGNvbnN0IGxtX2luaXQgPSAocykgPT4gewoKICAgIHMud2luZG93X3NpemUgPSAyICogcy53X3NpemU7CgogICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CgogICAgLyogU2V0IHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyczoKICAgICAqLwogICAgcy5tYXhfbGF6eV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2xhenk7CiAgICBzLmdvb2RfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLmdvb2RfbGVuZ3RoOwogICAgcy5uaWNlX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5uaWNlX2xlbmd0aDsKICAgIHMubWF4X2NoYWluX2xlbmd0aCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2NoYWluOwoKICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICBzLmxvb2thaGVhZCA9IDA7CiAgICBzLmluc2VydCA9IDA7CiAgICBzLm1hdGNoX2xlbmd0aCA9IHMucHJldl9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgcy5pbnNfaCA9IDA7CiAgfTsKCgogIGZ1bmN0aW9uIERlZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMuc3RybSA9IG51bGw7ICAgICAgICAgICAgLyogcG9pbnRlciBiYWNrIHRvIHRoaXMgemxpYiBzdHJlYW0gKi8KICAgIHRoaXMuc3RhdHVzID0gMDsgICAgICAgICAgICAvKiBhcyB0aGUgbmFtZSBpbXBsaWVzICovCiAgICB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbDsgICAgICAvKiBvdXRwdXQgc3RpbGwgcGVuZGluZyAqLwogICAgdGhpcy5wZW5kaW5nX2J1Zl9zaXplID0gMDsgIC8qIHNpemUgb2YgcGVuZGluZ19idWYgKi8KICAgIHRoaXMucGVuZGluZ19vdXQgPSAwOyAgICAgICAvKiBuZXh0IHBlbmRpbmcgYnl0ZSB0byBvdXRwdXQgdG8gdGhlIHN0cmVhbSAqLwogICAgdGhpcy5wZW5kaW5nID0gMDsgICAgICAgICAgIC8qIG5iIG9mIGJ5dGVzIGluIHRoZSBwZW5kaW5nIGJ1ZmZlciAqLwogICAgdGhpcy53cmFwID0gMDsgICAgICAgICAgICAgIC8qIGJpdCAwIHRydWUgZm9yIHpsaWIsIGJpdCAxIHRydWUgZm9yIGd6aXAgKi8KICAgIHRoaXMuZ3poZWFkID0gbnVsbDsgICAgICAgICAvKiBnemlwIGhlYWRlciBpbmZvcm1hdGlvbiB0byB3cml0ZSAqLwogICAgdGhpcy5nemluZGV4ID0gMDsgICAgICAgICAgIC8qIHdoZXJlIGluIGV4dHJhLCBuYW1lLCBvciBjb21tZW50ICovCiAgICB0aGlzLm1ldGhvZCA9IFpfREVGTEFURUQkMjsgLyogY2FuIG9ubHkgYmUgREVGTEFURUQgKi8KICAgIHRoaXMubGFzdF9mbHVzaCA9IC0xOyAgIC8qIHZhbHVlIG9mIGZsdXNoIHBhcmFtIGZvciBwcmV2aW91cyBkZWZsYXRlIGNhbGwgKi8KCiAgICB0aGlzLndfc2l6ZSA9IDA7ICAvKiBMWjc3IHdpbmRvdyBzaXplICgzMksgYnkgZGVmYXVsdCkgKi8KICAgIHRoaXMud19iaXRzID0gMDsgIC8qIGxvZzIod19zaXplKSAgKDguLjE2KSAqLwogICAgdGhpcy53X21hc2sgPSAwOyAgLyogd19zaXplIC0gMSAqLwoKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIC8qIFNsaWRpbmcgd2luZG93LiBJbnB1dCBieXRlcyBhcmUgcmVhZCBpbnRvIHRoZSBzZWNvbmQgaGFsZiBvZiB0aGUgd2luZG93LAogICAgICogYW5kIG1vdmUgdG8gdGhlIGZpcnN0IGhhbGYgbGF0ZXIgdG8ga2VlcCBhIGRpY3Rpb25hcnkgb2YgYXQgbGVhc3Qgd1NpemUKICAgICAqIGJ5dGVzLiBXaXRoIHRoaXMgb3JnYW5pemF0aW9uLCBtYXRjaGVzIGFyZSBsaW1pdGVkIHRvIGEgZGlzdGFuY2Ugb2YKICAgICAqIHdTaXplLU1BWF9NQVRDSCBieXRlcywgYnV0IHRoaXMgZW5zdXJlcyB0aGF0IElPIGlzIGFsd2F5cwogICAgICogcGVyZm9ybWVkIHdpdGggYSBsZW5ndGggbXVsdGlwbGUgb2YgdGhlIGJsb2NrIHNpemUuCiAgICAgKi8KCiAgICB0aGlzLndpbmRvd19zaXplID0gMDsKICAgIC8qIEFjdHVhbCBzaXplIG9mIHdpbmRvdzogMip3U2l6ZSwgZXhjZXB0IHdoZW4gdGhlIHVzZXIgaW5wdXQgYnVmZmVyCiAgICAgKiBpcyBkaXJlY3RseSB1c2VkIGFzIHNsaWRpbmcgd2luZG93LgogICAgICovCgogICAgdGhpcy5wcmV2ID0gbnVsbDsKICAgIC8qIExpbmsgdG8gb2xkZXIgc3RyaW5nIHdpdGggc2FtZSBoYXNoIGluZGV4LiBUbyBsaW1pdCB0aGUgc2l6ZSBvZiB0aGlzCiAgICAgKiBhcnJheSB0byA2NEssIHRoaXMgbGluayBpcyBtYWludGFpbmVkIG9ubHkgZm9yIHRoZSBsYXN0IDMySyBzdHJpbmdzLgogICAgICogQW4gaW5kZXggaW4gdGhpcyBhcnJheSBpcyB0aHVzIGEgd2luZG93IGluZGV4IG1vZHVsbyAzMksuCiAgICAgKi8KCiAgICB0aGlzLmhlYWQgPSBudWxsOyAgIC8qIEhlYWRzIG9mIHRoZSBoYXNoIGNoYWlucyBvciBOSUwuICovCgogICAgdGhpcy5pbnNfaCA9IDA7ICAgICAgIC8qIGhhc2ggaW5kZXggb2Ygc3RyaW5nIHRvIGJlIGluc2VydGVkICovCiAgICB0aGlzLmhhc2hfc2l6ZSA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIGluIGhhc2ggdGFibGUgKi8KICAgIHRoaXMuaGFzaF9iaXRzID0gMDsgICAvKiBsb2cyKGhhc2hfc2l6ZSkgKi8KICAgIHRoaXMuaGFzaF9tYXNrID0gMDsgICAvKiBoYXNoX3NpemUtMSAqLwoKICAgIHRoaXMuaGFzaF9zaGlmdCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgYml0cyBieSB3aGljaCBpbnNfaCBtdXN0IGJlIHNoaWZ0ZWQgYXQgZWFjaCBpbnB1dAogICAgICogc3RlcC4gSXQgbXVzdCBiZSBzdWNoIHRoYXQgYWZ0ZXIgTUlOX01BVENIIHN0ZXBzLCB0aGUgb2xkZXN0CiAgICAgKiBieXRlIG5vIGxvbmdlciB0YWtlcyBwYXJ0IGluIHRoZSBoYXNoIGtleSwgdGhhdCBpczoKICAgICAqICAgaGFzaF9zaGlmdCAqIE1JTl9NQVRDSCA+PSBoYXNoX2JpdHMKICAgICAqLwoKICAgIHRoaXMuYmxvY2tfc3RhcnQgPSAwOwogICAgLyogV2luZG93IHBvc2l0aW9uIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGN1cnJlbnQgb3V0cHV0IGJsb2NrLiBHZXRzCiAgICAgKiBuZWdhdGl2ZSB3aGVuIHRoZSB3aW5kb3cgaXMgbW92ZWQgYmFja3dhcmRzLgogICAgICovCgogICAgdGhpcy5tYXRjaF9sZW5ndGggPSAwOyAgICAgIC8qIGxlbmd0aCBvZiBiZXN0IG1hdGNoICovCiAgICB0aGlzLnByZXZfbWF0Y2ggPSAwOyAgICAgICAgLyogcHJldmlvdXMgbWF0Y2ggKi8KICAgIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMDsgICAvKiBzZXQgaWYgcHJldmlvdXMgbWF0Y2ggZXhpc3RzICovCiAgICB0aGlzLnN0cnN0YXJ0ID0gMDsgICAgICAgICAgLyogc3RhcnQgb2Ygc3RyaW5nIHRvIGluc2VydCAqLwogICAgdGhpcy5tYXRjaF9zdGFydCA9IDA7ICAgICAgIC8qIHN0YXJ0IG9mIG1hdGNoaW5nIHN0cmluZyAqLwogICAgdGhpcy5sb29rYWhlYWQgPSAwOyAgICAgICAgIC8qIG51bWJlciBvZiB2YWxpZCBieXRlcyBhaGVhZCBpbiB3aW5kb3cgKi8KCiAgICB0aGlzLnByZXZfbGVuZ3RoID0gMDsKICAgIC8qIExlbmd0aCBvZiB0aGUgYmVzdCBtYXRjaCBhdCBwcmV2aW91cyBzdGVwLiBNYXRjaGVzIG5vdCBncmVhdGVyIHRoYW4gdGhpcwogICAgICogYXJlIGRpc2NhcmRlZC4gVGhpcyBpcyB1c2VkIGluIHRoZSBsYXp5IG1hdGNoIGV2YWx1YXRpb24uCiAgICAgKi8KCiAgICB0aGlzLm1heF9jaGFpbl9sZW5ndGggPSAwOwogICAgLyogVG8gc3BlZWQgdXAgZGVmbGF0aW9uLCBoYXNoIGNoYWlucyBhcmUgbmV2ZXIgc2VhcmNoZWQgYmV5b25kIHRoaXMKICAgICAqIGxlbmd0aC4gIEEgaGlnaGVyIGxpbWl0IGltcHJvdmVzIGNvbXByZXNzaW9uIHJhdGlvIGJ1dCBkZWdyYWRlcyB0aGUKICAgICAqIHNwZWVkLgogICAgICovCgogICAgdGhpcy5tYXhfbGF6eV9tYXRjaCA9IDA7CiAgICAvKiBBdHRlbXB0IHRvIGZpbmQgYSBiZXR0ZXIgbWF0Y2ggb25seSB3aGVuIHRoZSBjdXJyZW50IG1hdGNoIGlzIHN0cmljdGx5CiAgICAgKiBzbWFsbGVyIHRoYW4gdGhpcyB2YWx1ZS4gVGhpcyBtZWNoYW5pc20gaXMgdXNlZCBvbmx5IGZvciBjb21wcmVzc2lvbgogICAgICogbGV2ZWxzID49IDQuCiAgICAgKi8KICAgIC8vIFRoYXQncyBhbGlhcyB0byBtYXhfbGF6eV9tYXRjaCwgZG9uJ3QgdXNlIGRpcmVjdGx5CiAgICAvL3RoaXMubWF4X2luc2VydF9sZW5ndGggPSAwOwogICAgLyogSW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBoYXNoIHRhYmxlIG9ubHkgaWYgdGhlIG1hdGNoIGxlbmd0aCBpcyBub3QKICAgICAqIGdyZWF0ZXIgdGhhbiB0aGlzIGxlbmd0aC4gVGhpcyBzYXZlcyB0aW1lIGJ1dCBkZWdyYWRlcyBjb21wcmVzc2lvbi4KICAgICAqIG1heF9pbnNlcnRfbGVuZ3RoIGlzIHVzZWQgb25seSBmb3IgY29tcHJlc3Npb24gbGV2ZWxzIDw9IDMuCiAgICAgKi8KCiAgICB0aGlzLmxldmVsID0gMDsgICAgIC8qIGNvbXByZXNzaW9uIGxldmVsICgxLi45KSAqLwogICAgdGhpcy5zdHJhdGVneSA9IDA7ICAvKiBmYXZvciBvciBmb3JjZSBIdWZmbWFuIGNvZGluZyovCgogICAgdGhpcy5nb29kX21hdGNoID0gMDsKICAgIC8qIFVzZSBhIGZhc3RlciBzZWFyY2ggd2hlbiB0aGUgcHJldmlvdXMgbWF0Y2ggaXMgbG9uZ2VyIHRoYW4gdGhpcyAqLwoKICAgIHRoaXMubmljZV9tYXRjaCA9IDA7IC8qIFN0b3Agc2VhcmNoaW5nIHdoZW4gY3VycmVudCBtYXRjaCBleGNlZWRzIHRoaXMgKi8KCiAgICAgICAgICAgICAgICAvKiB1c2VkIGJ5IHRyZWVzLmM6ICovCgogICAgLyogRGlkbid0IHVzZSBjdF9kYXRhIHR5cGVkZWYgYmVsb3cgdG8gc3VwcHJlc3MgY29tcGlsZXIgd2FybmluZyAqLwoKICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2x0cmVlW0hFQVBfU0laRV07ICAgLyogbGl0ZXJhbCBhbmQgbGVuZ3RoIHRyZWUgKi8KICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2R0cmVlWzIqRF9DT0RFUysxXTsgLyogZGlzdGFuY2UgdHJlZSAqLwogICAgLy8gc3RydWN0IGN0X2RhdGFfcyBibF90cmVlWzIqQkxfQ09ERVMrMV07ICAvKiBIdWZmbWFuIHRyZWUgZm9yIGJpdCBsZW5ndGhzICovCgogICAgLy8gVXNlIGZsYXQgYXJyYXkgb2YgRE9VQkxFIHNpemUsIHdpdGggaW50ZXJsZWF2ZWQgZmF0YSwKICAgIC8vIGJlY2F1c2UgSlMgZG9lcyBub3Qgc3VwcG9ydCBlZmZlY3RpdmUKICAgIHRoaXMuZHluX2x0cmVlICA9IG5ldyBVaW50MTZBcnJheShIRUFQX1NJWkUgKiAyKTsKICAgIHRoaXMuZHluX2R0cmVlICA9IG5ldyBVaW50MTZBcnJheSgoMiAqIERfQ09ERVMgKyAxKSAqIDIpOwogICAgdGhpcy5ibF90cmVlICAgID0gbmV3IFVpbnQxNkFycmF5KCgyICogQkxfQ09ERVMgKyAxKSAqIDIpOwogICAgemVybyh0aGlzLmR5bl9sdHJlZSk7CiAgICB6ZXJvKHRoaXMuZHluX2R0cmVlKTsKICAgIHplcm8odGhpcy5ibF90cmVlKTsKCiAgICB0aGlzLmxfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgbGl0ZXJhbCB0cmVlICovCiAgICB0aGlzLmRfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgZGlzdGFuY2UgdHJlZSAqLwogICAgdGhpcy5ibF9kZXNjICA9IG51bGw7ICAgICAgICAgLyogZGVzYy4gZm9yIGJpdCBsZW5ndGggdHJlZSAqLwoKICAgIC8vdXNoIGJsX2NvdW50W01BWF9CSVRTKzFdOwogICAgdGhpcy5ibF9jb3VudCA9IG5ldyBVaW50MTZBcnJheShNQVhfQklUUyArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy9pbnQgaGVhcFsyKkxfQ09ERVMrMV07ICAgICAgLyogaGVhcCB1c2VkIHRvIGJ1aWxkIHRoZSBIdWZmbWFuIHRyZWVzICovCiAgICB0aGlzLmhlYXAgPSBuZXcgVWludDE2QXJyYXkoMiAqIExfQ09ERVMgKyAxKTsgIC8qIGhlYXAgdXNlZCB0byBidWlsZCB0aGUgSHVmZm1hbiB0cmVlcyAqLwogICAgemVybyh0aGlzLmhlYXApOwoKICAgIHRoaXMuaGVhcF9sZW4gPSAwOyAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgaGVhcCAqLwogICAgdGhpcy5oZWFwX21heCA9IDA7ICAgICAgICAgICAgICAgLyogZWxlbWVudCBvZiBsYXJnZXN0IGZyZXF1ZW5jeSAqLwogICAgLyogVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4gaGVhcFswXSBpcyBub3QgdXNlZC4KICAgICAqIFRoZSBzYW1lIGhlYXAgYXJyYXkgaXMgdXNlZCB0byBidWlsZCBhbGwgdHJlZXMuCiAgICAgKi8KCiAgICB0aGlzLmRlcHRoID0gbmV3IFVpbnQxNkFycmF5KDIgKiBMX0NPREVTICsgMSk7IC8vdWNoIGRlcHRoWzIqTF9DT0RFUysxXTsKICAgIHplcm8odGhpcy5kZXB0aCk7CiAgICAvKiBEZXB0aCBvZiBlYWNoIHN1YnRyZWUgdXNlZCBhcyB0aWUgYnJlYWtlciBmb3IgdHJlZXMgb2YgZXF1YWwgZnJlcXVlbmN5CiAgICAgKi8KCiAgICB0aGlzLmxfYnVmID0gMDsgICAgICAgICAgLyogYnVmZmVyIGluZGV4IGZvciBsaXRlcmFscyBvciBsZW5ndGhzICovCgogICAgdGhpcy5saXRfYnVmc2l6ZSA9IDA7CiAgICAvKiBTaXplIG9mIG1hdGNoIGJ1ZmZlciBmb3IgbGl0ZXJhbHMvbGVuZ3Rocy4gIFRoZXJlIGFyZSA0IHJlYXNvbnMgZm9yCiAgICAgKiBsaW1pdGluZyBsaXRfYnVmc2l6ZSB0byA2NEs6CiAgICAgKiAgIC0gZnJlcXVlbmNpZXMgY2FuIGJlIGtlcHQgaW4gMTYgYml0IGNvdW50ZXJzCiAgICAgKiAgIC0gaWYgY29tcHJlc3Npb24gaXMgbm90IHN1Y2Nlc3NmdWwgZm9yIHRoZSBmaXJzdCBibG9jaywgYWxsIGlucHV0CiAgICAgKiAgICAgZGF0YSBpcyBzdGlsbCBpbiB0aGUgd2luZG93IHNvIHdlIGNhbiBzdGlsbCBlbWl0IGEgc3RvcmVkIGJsb2NrIGV2ZW4KICAgICAqICAgICB3aGVuIGlucHV0IGNvbWVzIGZyb20gc3RhbmRhcmQgaW5wdXQuICAoVGhpcyBjYW4gYWxzbyBiZSBkb25lIGZvcgogICAgICogICAgIGFsbCBibG9ja3MgaWYgbGl0X2J1ZnNpemUgaXMgbm90IGdyZWF0ZXIgdGhhbiAzMksuKQogICAgICogICAtIGlmIGNvbXByZXNzaW9uIGlzIG5vdCBzdWNjZXNzZnVsIGZvciBhIGZpbGUgc21hbGxlciB0aGFuIDY0Sywgd2UgY2FuCiAgICAgKiAgICAgZXZlbiBlbWl0IGEgc3RvcmVkIGZpbGUgaW5zdGVhZCBvZiBhIHN0b3JlZCBibG9jayAoc2F2aW5nIDUgYnl0ZXMpLgogICAgICogICAgIFRoaXMgaXMgYXBwbGljYWJsZSBvbmx5IGZvciB6aXAgKG5vdCBnemlwIG9yIHpsaWIpLgogICAgICogICAtIGNyZWF0aW5nIG5ldyBIdWZmbWFuIHRyZWVzIGxlc3MgZnJlcXVlbnRseSBtYXkgbm90IHByb3ZpZGUgZmFzdAogICAgICogICAgIGFkYXB0YXRpb24gdG8gY2hhbmdlcyBpbiB0aGUgaW5wdXQgZGF0YSBzdGF0aXN0aWNzLiAoVGFrZSBmb3IKICAgICAqICAgICBleGFtcGxlIGEgYmluYXJ5IGZpbGUgd2l0aCBwb29ybHkgY29tcHJlc3NpYmxlIGNvZGUgZm9sbG93ZWQgYnkKICAgICAqICAgICBhIGhpZ2hseSBjb21wcmVzc2libGUgc3RyaW5nIHRhYmxlLikgU21hbGxlciBidWZmZXIgc2l6ZXMgZ2l2ZQogICAgICogICAgIGZhc3QgYWRhcHRhdGlvbiBidXQgaGF2ZSBvZiBjb3Vyc2UgdGhlIG92ZXJoZWFkIG9mIHRyYW5zbWl0dGluZwogICAgICogICAgIHRyZWVzIG1vcmUgZnJlcXVlbnRseS4KICAgICAqICAgLSBJIGNhbid0IGNvdW50IGFib3ZlIDQKICAgICAqLwoKICAgIHRoaXMubGFzdF9saXQgPSAwOyAgICAgIC8qIHJ1bm5pbmcgaW5kZXggaW4gbF9idWYgKi8KCiAgICB0aGlzLmRfYnVmID0gMDsKICAgIC8qIEJ1ZmZlciBpbmRleCBmb3IgZGlzdGFuY2VzLiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgZF9idWYgYW5kIGxfYnVmIGhhdmUKICAgICAqIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50cy4gVG8gdXNlIGRpZmZlcmVudCBsZW5ndGhzLCBhbiBleHRyYSBmbGFnCiAgICAgKiBhcnJheSB3b3VsZCBiZSBuZWNlc3NhcnkuCiAgICAgKi8KCiAgICB0aGlzLm9wdF9sZW4gPSAwOyAgICAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBvcHRpbWFsIHRyZWVzICovCiAgICB0aGlzLnN0YXRpY19sZW4gPSAwOyAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBzdGF0aWMgdHJlZXMgKi8KICAgIHRoaXMubWF0Y2hlcyA9IDA7ICAgICAgIC8qIG51bWJlciBvZiBzdHJpbmcgbWF0Y2hlcyBpbiBjdXJyZW50IGJsb2NrICovCiAgICB0aGlzLmluc2VydCA9IDA7ICAgICAgICAvKiBieXRlcyBhdCBlbmQgb2Ygd2luZG93IGxlZnQgdG8gaW5zZXJ0ICovCgoKICAgIHRoaXMuYmlfYnVmID0gMDsKICAgIC8qIE91dHB1dCBidWZmZXIuIGJpdHMgYXJlIGluc2VydGVkIHN0YXJ0aW5nIGF0IHRoZSBib3R0b20gKGxlYXN0CiAgICAgKiBzaWduaWZpY2FudCBiaXRzKS4KICAgICAqLwogICAgdGhpcy5iaV92YWxpZCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgdmFsaWQgYml0cyBpbiBiaV9idWYuICBBbGwgYml0cyBhYm92ZSB0aGUgbGFzdCB2YWxpZCBiaXQKICAgICAqIGFyZSBhbHdheXMgemVyby4KICAgICAqLwoKICAgIC8vIFVzZWQgZm9yIHdpbmRvdyBtZW1vcnkgaW5pdC4gV2Ugc2FmZWx5IGlnbm9yZSBpdCBmb3IgSlMuIFRoYXQgbWFrZXMKICAgIC8vIHNlbnNlIG9ubHkgZm9yIHBvaW50ZXJzIGFuZCBtZW1vcnkgY2hlY2sgdG9vbHMuCiAgICAvL3RoaXMuaGlnaF93YXRlciA9IDA7CiAgICAvKiBIaWdoIHdhdGVyIG1hcmsgb2Zmc2V0IGluIHdpbmRvdyBmb3IgaW5pdGlhbGl6ZWQgYnl0ZXMgLS0gYnl0ZXMgYWJvdmUKICAgICAqIHRoaXMgYXJlIHNldCB0byB6ZXJvIGluIG9yZGVyIHRvIGF2b2lkIG1lbW9yeSBjaGVjayB3YXJuaW5ncyB3aGVuCiAgICAgKiBsb25nZXN0IG1hdGNoIHJvdXRpbmVzIGFjY2VzcyBieXRlcyBwYXN0IHRoZSBpbnB1dC4gIFRoaXMgaXMgdGhlbgogICAgICogdXBkYXRlZCB0byB0aGUgbmV3IGhpZ2ggd2F0ZXIgbWFyay4KICAgICAqLwogIH0KCgogIGNvbnN0IGRlZmxhdGVSZXNldEtlZXAgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IDA7CiAgICBzdHJtLmRhdGFfdHlwZSA9IFpfVU5LTk9XTjsKCiAgICBjb25zdCBzID0gc3RybS5zdGF0ZTsKICAgIHMucGVuZGluZyA9IDA7CiAgICBzLnBlbmRpbmdfb3V0ID0gMDsKCiAgICBpZiAocy53cmFwIDwgMCkgewogICAgICBzLndyYXAgPSAtcy53cmFwOwogICAgICAvKiB3YXMgbWFkZSBuZWdhdGl2ZSBieSBkZWZsYXRlKC4uLiwgWl9GSU5JU0gpOyAqLwogICAgfQogICAgcy5zdGF0dXMgPSAocy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEUpOwogICAgc3RybS5hZGxlciA9IChzLndyYXAgPT09IDIpID8KICAgICAgMCAgLy8gY3JjMzIoMCwgWl9OVUxMLCAwKQogICAgOgogICAgICAxOyAvLyBhZGxlcjMyKDAsIFpfTlVMTCwgMCkKICAgIHMubGFzdF9mbHVzaCA9IFpfTk9fRkxVU0gkMjsKICAgIF90cl9pbml0KHMpOwogICAgcmV0dXJuIFpfT0skMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZVJlc2V0ID0gKHN0cm0pID0+IHsKCiAgICBjb25zdCByZXQgPSBkZWZsYXRlUmVzZXRLZWVwKHN0cm0pOwogICAgaWYgKHJldCA9PT0gWl9PSyQzKSB7CiAgICAgIGxtX2luaXQoc3RybS5zdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH07CgoKICBjb25zdCBkZWZsYXRlU2V0SGVhZGVyID0gKHN0cm0sIGhlYWQpID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIGlmIChzdHJtLnN0YXRlLndyYXAgIT09IDIpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIHN0cm0uc3RhdGUuZ3poZWFkID0gaGVhZDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIGNvbnN0IGRlZmxhdGVJbml0MiA9IChzdHJtLCBsZXZlbCwgbWV0aG9kLCB3aW5kb3dCaXRzLCBtZW1MZXZlbCwgc3RyYXRlZ3kpID0+IHsKCiAgICBpZiAoIXN0cm0pIHsgLy8gPT09IFpfTlVMTAogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KICAgIGxldCB3cmFwID0gMTsKCiAgICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTiQxKSB7CiAgICAgIGxldmVsID0gNjsKICAgIH0KCiAgICBpZiAod2luZG93Qml0cyA8IDApIHsgLyogc3VwcHJlc3MgemxpYiB3cmFwcGVyICovCiAgICAgIHdyYXAgPSAwOwogICAgICB3aW5kb3dCaXRzID0gLXdpbmRvd0JpdHM7CiAgICB9CgogICAgZWxzZSBpZiAod2luZG93Qml0cyA+IDE1KSB7CiAgICAgIHdyYXAgPSAyOyAgICAgICAgICAgLyogd3JpdGUgZ3ppcCB3cmFwcGVyIGluc3RlYWQgKi8KICAgICAgd2luZG93Qml0cyAtPSAxNjsKICAgIH0KCgogICAgaWYgKG1lbUxldmVsIDwgMSB8fCBtZW1MZXZlbCA+IE1BWF9NRU1fTEVWRUwgfHwgbWV0aG9kICE9PSBaX0RFRkxBVEVEJDIgfHwKICAgICAgd2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1IHx8IGxldmVsIDwgMCB8fCBsZXZlbCA+IDkgfHwKICAgICAgc3RyYXRlZ3kgPCAwIHx8IHN0cmF0ZWd5ID4gWl9GSVhFRCkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKCiAgICBpZiAod2luZG93Qml0cyA9PT0gOCkgewogICAgICB3aW5kb3dCaXRzID0gOTsKICAgIH0KICAgIC8qIHVudGlsIDI1Ni1ieXRlIHdpbmRvdyBidWcgZml4ZWQgKi8KCiAgICBjb25zdCBzID0gbmV3IERlZmxhdGVTdGF0ZSgpOwoKICAgIHN0cm0uc3RhdGUgPSBzOwogICAgcy5zdHJtID0gc3RybTsKCiAgICBzLndyYXAgPSB3cmFwOwogICAgcy5nemhlYWQgPSBudWxsOwogICAgcy53X2JpdHMgPSB3aW5kb3dCaXRzOwogICAgcy53X3NpemUgPSAxIDw8IHMud19iaXRzOwogICAgcy53X21hc2sgPSBzLndfc2l6ZSAtIDE7CgogICAgcy5oYXNoX2JpdHMgPSBtZW1MZXZlbCArIDc7CiAgICBzLmhhc2hfc2l6ZSA9IDEgPDwgcy5oYXNoX2JpdHM7CiAgICBzLmhhc2hfbWFzayA9IHMuaGFzaF9zaXplIC0gMTsKICAgIHMuaGFzaF9zaGlmdCA9IH5+KChzLmhhc2hfYml0cyArIE1JTl9NQVRDSCAtIDEpIC8gTUlOX01BVENIKTsKCiAgICBzLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHMud19zaXplICogMik7CiAgICBzLmhlYWQgPSBuZXcgVWludDE2QXJyYXkocy5oYXNoX3NpemUpOwogICAgcy5wcmV2ID0gbmV3IFVpbnQxNkFycmF5KHMud19zaXplKTsKCiAgICAvLyBEb24ndCBuZWVkIG1lbSBpbml0IG1hZ2ljIGZvciBKUy4KICAgIC8vcy5oaWdoX3dhdGVyID0gMDsgIC8qIG5vdGhpbmcgd3JpdHRlbiB0byBzLT53aW5kb3cgeWV0ICovCgogICAgcy5saXRfYnVmc2l6ZSA9IDEgPDwgKG1lbUxldmVsICsgNik7IC8qIDE2SyBlbGVtZW50cyBieSBkZWZhdWx0ICovCgogICAgcy5wZW5kaW5nX2J1Zl9zaXplID0gcy5saXRfYnVmc2l6ZSAqIDQ7CgogICAgLy9vdmVybGF5ID0gKHVzaGYgKikgWkFMTE9DKHN0cm0sIHMtPmxpdF9idWZzaXplLCBzaXplb2YodXNoKSsyKTsKICAgIC8vcy0+cGVuZGluZ19idWYgPSAodWNoZiAqKSBvdmVybGF5OwogICAgcy5wZW5kaW5nX2J1ZiA9IG5ldyBVaW50OEFycmF5KHMucGVuZGluZ19idWZfc2l6ZSk7CgogICAgLy8gSXQgaXMgb2Zmc2V0IGZyb20gYHMucGVuZGluZ19idWZgIChzaXplIGlzIGBzLmxpdF9idWZzaXplICogMmApCiAgICAvL3MtPmRfYnVmID0gb3ZlcmxheSArIHMtPmxpdF9idWZzaXplL3NpemVvZih1c2gpOwogICAgcy5kX2J1ZiA9IDEgKiBzLmxpdF9idWZzaXplOwoKICAgIC8vcy0+bF9idWYgPSBzLT5wZW5kaW5nX2J1ZiArICgxK3NpemVvZih1c2gpKSpzLT5saXRfYnVmc2l6ZTsKICAgIHMubF9idWYgPSAoMSArIDIpICogcy5saXRfYnVmc2l6ZTsKCiAgICBzLmxldmVsID0gbGV2ZWw7CiAgICBzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICBzLm1ldGhvZCA9IG1ldGhvZDsKCiAgICByZXR1cm4gZGVmbGF0ZVJlc2V0KHN0cm0pOwogIH07CgogIGNvbnN0IGRlZmxhdGVJbml0ID0gKHN0cm0sIGxldmVsKSA9PiB7CgogICAgcmV0dXJuIGRlZmxhdGVJbml0MihzdHJtLCBsZXZlbCwgWl9ERUZMQVRFRCQyLCBNQVhfV0JJVFMkMSwgREVGX01FTV9MRVZFTCwgWl9ERUZBVUxUX1NUUkFURUdZJDEpOwogIH07CgoKICBjb25zdCBkZWZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgYmVnLCB2YWw7IC8vIGZvciBnemlwIGhlYWRlciB3cml0ZSBvbmx5CgogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlIHx8CiAgICAgIGZsdXNoID4gWl9CTE9DSyQxIHx8IGZsdXNoIDwgMCkgewogICAgICByZXR1cm4gc3RybSA/IGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKSA6IFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgaWYgKCFzdHJtLm91dHB1dCB8fAogICAgICAgICghc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSB8fAogICAgICAgIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIGZsdXNoICE9PSBaX0ZJTklTSCQzKSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIChzdHJtLmF2YWlsX291dCA9PT0gMCkgPyBaX0JVRl9FUlJPUiQxIDogWl9TVFJFQU1fRVJST1IkMik7CiAgICB9CgogICAgcy5zdHJtID0gc3RybTsgLyoganVzdCBpbiBjYXNlICovCiAgICBjb25zdCBvbGRfZmx1c2ggPSBzLmxhc3RfZmx1c2g7CiAgICBzLmxhc3RfZmx1c2ggPSBmbHVzaDsKCiAgICAvKiBXcml0ZSB0aGUgaGVhZGVyICovCiAgICBpZiAocy5zdGF0dXMgPT09IElOSVRfU1RBVEUpIHsKCiAgICAgIGlmIChzLndyYXAgPT09IDIpIHsgLy8gR1pJUCBoZWFkZXIKICAgICAgICBzdHJtLmFkbGVyID0gMDsgIC8vY3JjMzIoMEwsIFpfTlVMTCwgMCk7CiAgICAgICAgcHV0X2J5dGUocywgMzEpOwogICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgcHV0X2J5dGUocywgOCk7CiAgICAgICAgaWYgKCFzLmd6aGVhZCkgeyAvLyBzLT5nemhlYWQgPT0gWl9OVUxMCiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOgogICAgICAgICAgICAgICAgICAgICAgKHMuc3RyYXRlZ3kgPj0gWl9IVUZGTUFOX09OTFkgfHwgcy5sZXZlbCA8IDIgPwogICAgICAgICAgICAgICAgICAgICAgIDQgOiAwKSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBPU19DT0RFKTsKICAgICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAocy5nemhlYWQuaGNyYyA/IDIgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmV4dHJhID8gMCA6IDQpICsKICAgICAgICAgICAgICAgICAgICAgICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmNvbW1lbnQgPyAwIDogMTYpCiAgICAgICAgICApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIChzLmd6aGVhZC50aW1lID4+IDE2KSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gMjQpICYgMHhmZik7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmxldmVsID09PSA5ID8gMiA6CiAgICAgICAgICAgICAgICAgICAgICAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/CiAgICAgICAgICAgICAgICAgICAgICAgNCA6IDApKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMHhmZik7CiAgICAgICAgICBpZiAocy5nemhlYWQuZXh0cmEgJiYgcy5nemhlYWQuZXh0cmEubGVuZ3RoKSB7CiAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDB4ZmYpOwogICAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDgpICYgMHhmZik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcsIDApOwogICAgICAgICAgfQogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gRVhUUkFfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgLy8gREVGTEFURSBoZWFkZXIKICAgICAgewogICAgICAgIGxldCBoZWFkZXIgPSAoWl9ERUZMQVRFRCQyICsgKChzLndfYml0cyAtIDgpIDw8IDQpKSA8PCA4OwogICAgICAgIGxldCBsZXZlbF9mbGFncyA9IC0xOwoKICAgICAgICBpZiAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAwOwogICAgICAgIH0gZWxzZSBpZiAocy5sZXZlbCA8IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHMubGV2ZWwgPT09IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAzOwogICAgICAgIH0KICAgICAgICBoZWFkZXIgfD0gKGxldmVsX2ZsYWdzIDw8IDYpOwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7IGhlYWRlciB8PSBQUkVTRVRfRElDVDsgfQogICAgICAgIGhlYWRlciArPSAzMSAtIChoZWFkZXIgJSAzMSk7CgogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwoKICAgICAgICAvKiBTYXZlIHRoZSBhZGxlcjMyIG9mIHRoZSBwcmVzZXQgZGljdGlvbmFyeTogKi8KICAgICAgICBpZiAocy5zdHJzdGFydCAhPT0gMCkgewogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciAmIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIHN0cm0uYWRsZXIgPSAxOyAvLyBhZGxlcjMyKDBMLCBaX05VTEwsIDApOwogICAgICB9CiAgICB9CgogIC8vI2lmZGVmIEdaSVAKICAgIGlmIChzLnN0YXR1cyA9PT0gRVhUUkFfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLmV4dHJhLyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCgogICAgICAgIHdoaWxlIChzLmd6aW5kZXggPCAocy5nemhlYWQuZXh0cmEubGVuZ3RoICYgMHhmZmZmKSkgewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5leHRyYVtzLmd6aW5kZXhdICYgMHhmZik7CiAgICAgICAgICBzLmd6aW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLm5hbWUvKiAhPSBaX05VTEwqLykgewogICAgICAgIGJlZyA9IHMucGVuZGluZzsgIC8qIHN0YXJ0IG9mIGJ5dGVzIHRvIHVwZGF0ZSBjcmMgKi8KICAgICAgICAvL2ludCB2YWw7CgogICAgICAgIGRvIHsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICB2YWwgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBKUyBzcGVjaWZpYzogbGl0dGxlIG1hZ2ljIHRvIGFkZCB6ZXJvIHRlcm1pbmF0b3IgdG8gZW5kIG9mIHN0cmluZwogICAgICAgICAgaWYgKHMuZ3ppbmRleCA8IHMuZ3poZWFkLm5hbWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhbCA9IHMuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChzLmd6aW5kZXgrKykgJiAweGZmOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKCiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWwgPT09IDApIHsKICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICBzLnN0YXR1cyA9IENPTU1FTlRfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBDT01NRU5UX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5jb21tZW50LyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCiAgICAgICAgLy9pbnQgdmFsOwoKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgICAgdmFsID0gMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gSlMgc3BlY2lmaWM6IGxpdHRsZSBtYWdpYyB0byBhZGQgemVybyB0ZXJtaW5hdG9yIHRvIGVuZCBvZiBzdHJpbmcKICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMHhmZjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCB2YWwpOwogICAgICAgIH0gd2hpbGUgKHZhbCAhPT0gMCk7CgogICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgIH0KICAgICAgICBpZiAodmFsID09PSAwKSB7CiAgICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gSENSQ19TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBIQ1JDX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5oY3JjKSB7CiAgICAgICAgaWYgKHMucGVuZGluZyArIDIgPiBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgfQogICAgICAgIGlmIChzLnBlbmRpbmcgKyAyIDw9IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOyAvL2NyYzMyKDBMLCBaX05VTEwsIDApOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAvLyNlbmRpZgoKICAgIC8qIEZsdXNoIGFzIG11Y2ggcGVuZGluZyBvdXRwdXQgYXMgcG9zc2libGUgKi8KICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgLyogU2luY2UgYXZhaWxfb3V0IGlzIDAsIGRlZmxhdGUgd2lsbCBiZSBjYWxsZWQgYWdhaW4gd2l0aAogICAgICAgICAqIG1vcmUgb3V0cHV0IHNwYWNlLCBidXQgcG9zc2libHkgd2l0aCBib3RoIHBlbmRpbmcgYW5kCiAgICAgICAgICogYXZhaWxfaW4gZXF1YWwgdG8gemVyby4gVGhlcmUgd29uJ3QgYmUgYW55dGhpbmcgdG8gZG8sCiAgICAgICAgICogYnV0IHRoaXMgaXMgbm90IGFuIGVycm9yIHNpdHVhdGlvbiBzbyBtYWtlIHN1cmUgd2UKICAgICAgICAgKiByZXR1cm4gT0sgaW5zdGVhZCBvZiBCVUZfRVJST1IgYXQgbmV4dCBjYWxsIG9mIGRlZmxhdGU6CiAgICAgICAgICovCiAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgfQoKICAgICAgLyogTWFrZSBzdXJlIHRoZXJlIGlzIHNvbWV0aGluZyB0byBkbyBhbmQgYXZvaWQgZHVwbGljYXRlIGNvbnNlY3V0aXZlCiAgICAgICAqIGZsdXNoZXMuIEZvciByZXBlYXRlZCBhbmQgdXNlbGVzcyBjYWxscyB3aXRoIFpfRklOSVNILCB3ZSBrZWVwCiAgICAgICAqIHJldHVybmluZyBaX1NUUkVBTV9FTkQgaW5zdGVhZCBvZiBaX0JVRl9FUlJPUi4KICAgICAgICovCiAgICB9IGVsc2UgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgcmFuayhmbHVzaCkgPD0gcmFuayhvbGRfZmx1c2gpICYmCiAgICAgIGZsdXNoICE9PSBaX0ZJTklTSCQzKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9CVUZfRVJST1IkMSk7CiAgICB9CgogICAgLyogVXNlciBtdXN0IG5vdCBwcm92aWRlIG1vcmUgaW5wdXQgYWZ0ZXIgdGhlIGZpcnN0IEZJTklTSDogKi8KICAgIGlmIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIHN0cm0uYXZhaWxfaW4gIT09IDApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUiQxKTsKICAgIH0KCiAgICAvKiBTdGFydCBhIG5ldyBibG9jayBvciBjb250aW51ZSB0aGUgY3VycmVudCBvbmUuCiAgICAgKi8KICAgIGlmIChzdHJtLmF2YWlsX2luICE9PSAwIHx8IHMubG9va2FoZWFkICE9PSAwIHx8CiAgICAgIChmbHVzaCAhPT0gWl9OT19GTFVTSCQyICYmIHMuc3RhdHVzICE9PSBGSU5JU0hfU1RBVEUpKSB7CiAgICAgIGxldCBic3RhdGUgPSAocy5zdHJhdGVneSA9PT0gWl9IVUZGTUFOX09OTFkpID8gZGVmbGF0ZV9odWZmKHMsIGZsdXNoKSA6CiAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfUkxFID8gZGVmbGF0ZV9ybGUocywgZmx1c2gpIDoKICAgICAgICAgIGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZnVuYyhzLCBmbHVzaCkpOwoKICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfRklOSVNIX1NUQVJURUQgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfRE9ORSkgewogICAgICAgIHMuc3RhdHVzID0gRklOSVNIX1NUQVRFOwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX05FRURfTU9SRSB8fCBic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEKSB7CiAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICAgIC8qIGF2b2lkIEJVRl9FUlJPUiBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgIH0KICAgICAgICByZXR1cm4gWl9PSyQzOwogICAgICAgIC8qIElmIGZsdXNoICE9IFpfTk9fRkxVU0ggJiYgYXZhaWxfb3V0ID09IDAsIHRoZSBuZXh0IGNhbGwKICAgICAgICAgKiBvZiBkZWZsYXRlIHNob3VsZCB1c2UgdGhlIHNhbWUgZmx1c2ggcGFyYW1ldGVyIHRvIG1ha2Ugc3VyZQogICAgICAgICAqIHRoYXQgdGhlIGZsdXNoIGlzIGNvbXBsZXRlLiBTbyB3ZSBkb24ndCBoYXZlIHRvIG91dHB1dCBhbgogICAgICAgICAqIGVtcHR5IGJsb2NrIGhlcmUsIHRoaXMgd2lsbCBiZSBkb25lIGF0IG5leHQgY2FsbC4gVGhpcyBhbHNvCiAgICAgICAgICogZW5zdXJlcyB0aGF0IGZvciBhIHZlcnkgc21hbGwgb3V0cHV0IGJ1ZmZlciwgd2UgZW1pdCBhdCBtb3N0CiAgICAgICAgICogb25lIGVtcHR5IGJsb2NrLgogICAgICAgICAqLwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX0JMT0NLX0RPTkUpIHsKICAgICAgICBpZiAoZmx1c2ggPT09IFpfUEFSVElBTF9GTFVTSCkgewogICAgICAgICAgX3RyX2FsaWduKHMpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChmbHVzaCAhPT0gWl9CTE9DSyQxKSB7IC8qIEZVTExfRkxVU0ggb3IgU1lOQ19GTFVTSCAqLwoKICAgICAgICAgIF90cl9zdG9yZWRfYmxvY2socywgMCwgMCwgZmFsc2UpOwogICAgICAgICAgLyogRm9yIGEgZnVsbCBmbHVzaCwgdGhpcyBlbXB0eSBibG9jayB3aWxsIGJlIHJlY29nbml6ZWQKICAgICAgICAgICAqIGFzIGEgc3BlY2lhbCBtYXJrZXIgYnkgaW5mbGF0ZV9zeW5jKCkuCiAgICAgICAgICAgKi8KICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9GVUxMX0ZMVVNIJDEpIHsKICAgICAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovICAgICAgICAgICAgIC8qIGZvcmdldCBoaXN0b3J5ICovCiAgICAgICAgICAgIHplcm8ocy5oZWFkKTsgLy8gRmlsbCB3aXRoIE5JTCAoPSAwKTsKCiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7IC8qIGF2b2lkIEJVRl9FUlJPUiBhdCBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8vQXNzZXJ0KHN0cm0tPmF2YWlsX291dCA+IDAsICJidWcyIik7CiAgICAvL2lmIChzdHJtLmF2YWlsX291dCA8PSAwKSB7IHRocm93IG5ldyBFcnJvcigiYnVnMiIpO30KCiAgICBpZiAoZmx1c2ggIT09IFpfRklOSVNIJDMpIHsgcmV0dXJuIFpfT0skMzsgfQogICAgaWYgKHMud3JhcCA8PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FTkQkMzsgfQoKICAgIC8qIFdyaXRlIHRoZSB0cmFpbGVyICovCiAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gMTYpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLmFkbGVyID4+IDI0KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDgpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDE2KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCAoc3RybS50b3RhbF9pbiA+PiAyNCkgJiAweGZmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgMHhmZmZmKTsKICAgIH0KCiAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgLyogSWYgYXZhaWxfb3V0IGlzIHplcm8sIHRoZSBhcHBsaWNhdGlvbiB3aWxsIGNhbGwgZGVmbGF0ZSBhZ2FpbgogICAgICogdG8gZmx1c2ggdGhlIHJlc3QuCiAgICAgKi8KICAgIGlmIChzLndyYXAgPiAwKSB7IHMud3JhcCA9IC1zLndyYXA7IH0KICAgIC8qIHdyaXRlIHRoZSB0cmFpbGVyIG9ubHkgb25jZSEgKi8KICAgIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LJDMgOiBaX1NUUkVBTV9FTkQkMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZUVuZCA9IChzdHJtKSA9PiB7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3Qgc3RhdHVzID0gc3RybS5zdGF0ZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSBJTklUX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRVhUUkFfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBOQU1FX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gQ09NTUVOVF9TVEFURSAmJgogICAgICBzdGF0dXMgIT09IEhDUkNfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBCVVNZX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRklOSVNIX1NUQVRFCiAgICApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKTsKICAgIH0KCiAgICBzdHJtLnN0YXRlID0gbnVsbDsKCiAgICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUiQyKSA6IFpfT0skMzsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemVzIHRoZSBjb21wcmVzc2lvbiBkaWN0aW9uYXJ5IGZyb20gdGhlIGdpdmVuIGJ5dGUKICAgKiBzZXF1ZW5jZSB3aXRob3V0IHByb2R1Y2luZyBhbnkgY29tcHJlc3NlZCBvdXRwdXQuCiAgICovCiAgY29uc3QgZGVmbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewoKICAgIGxldCBkaWN0TGVuZ3RoID0gZGljdGlvbmFyeS5sZW5ndGg7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CiAgICBjb25zdCB3cmFwID0gcy53cmFwOwoKICAgIGlmICh3cmFwID09PSAyIHx8ICh3cmFwID09PSAxICYmIHMuc3RhdHVzICE9PSBJTklUX1NUQVRFKSB8fCBzLmxvb2thaGVhZCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KCiAgICAvKiB3aGVuIHVzaW5nIHpsaWIgd3JhcHBlcnMsIGNvbXB1dGUgQWRsZXItMzIgZm9yIHByb3ZpZGVkIGRpY3Rpb25hcnkgKi8KICAgIGlmICh3cmFwID09PSAxKSB7CiAgICAgIC8qIGFkbGVyMzIoc3RybS0+YWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIDApOwogICAgfQoKICAgIHMud3JhcCA9IDA7ICAgLyogYXZvaWQgY29tcHV0aW5nIEFkbGVyLTMyIGluIHJlYWRfYnVmICovCgogICAgLyogaWYgZGljdGlvbmFyeSB3b3VsZCBmaWxsIHdpbmRvdywganVzdCByZXBsYWNlIHRoZSBoaXN0b3J5ICovCiAgICBpZiAoZGljdExlbmd0aCA+PSBzLndfc2l6ZSkgewogICAgICBpZiAod3JhcCA9PT0gMCkgeyAgICAgICAgICAgIC8qIGFscmVhZHkgZW1wdHkgb3RoZXJ3aXNlICovCiAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICAgICAgemVybyhzLmhlYWQpOyAvLyBGaWxsIHdpdGggTklMICg9IDApOwogICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgfQogICAgICAvKiB1c2UgdGhlIHRhaWwgKi8KICAgICAgLy8gZGljdGlvbmFyeSA9IGRpY3Rpb25hcnkuc2xpY2UoZGljdExlbmd0aCAtIHMud19zaXplKTsKICAgICAgbGV0IHRtcERpY3QgPSBuZXcgVWludDhBcnJheShzLndfc2l6ZSk7CiAgICAgIHRtcERpY3Quc2V0KGRpY3Rpb25hcnkuc3ViYXJyYXkoZGljdExlbmd0aCAtIHMud19zaXplLCBkaWN0TGVuZ3RoKSwgMCk7CiAgICAgIGRpY3Rpb25hcnkgPSB0bXBEaWN0OwogICAgICBkaWN0TGVuZ3RoID0gcy53X3NpemU7CiAgICB9CiAgICAvKiBpbnNlcnQgZGljdGlvbmFyeSBpbnRvIHdpbmRvdyBhbmQgaGFzaCAqLwogICAgY29uc3QgYXZhaWwgPSBzdHJtLmF2YWlsX2luOwogICAgY29uc3QgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgIGNvbnN0IGlucHV0ID0gc3RybS5pbnB1dDsKICAgIHN0cm0uYXZhaWxfaW4gPSBkaWN0TGVuZ3RoOwogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uaW5wdXQgPSBkaWN0aW9uYXJ5OwogICAgZmlsbF93aW5kb3cocyk7CiAgICB3aGlsZSAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgIGxldCBzdHIgPSBzLnN0cnN0YXJ0OwogICAgICBsZXQgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgICBkbyB7CiAgICAgICAgLyogVVBEQVRFX0hBU0gocywgcy0+aW5zX2gsIHMtPndpbmRvd1tzdHIgKyBNSU5fTUFUQ0gtMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKTsKCiAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKCiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gc3RyOwogICAgICAgIHN0cisrOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzLnN0cnN0YXJ0ID0gc3RyOwogICAgICBzLmxvb2thaGVhZCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgIGZpbGxfd2luZG93KHMpOwogICAgfQogICAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgcy5pbnNlcnQgPSBzLmxvb2thaGVhZDsKICAgIHMubG9va2FoZWFkID0gMDsKICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgc3RybS5pbnB1dCA9IGlucHV0OwogICAgc3RybS5hdmFpbF9pbiA9IGF2YWlsOwogICAgcy53cmFwID0gd3JhcDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIHZhciBkZWZsYXRlSW5pdF8xID0gZGVmbGF0ZUluaXQ7CiAgdmFyIGRlZmxhdGVJbml0Ml8xID0gZGVmbGF0ZUluaXQyOwogIHZhciBkZWZsYXRlUmVzZXRfMSA9IGRlZmxhdGVSZXNldDsKICB2YXIgZGVmbGF0ZVJlc2V0S2VlcF8xID0gZGVmbGF0ZVJlc2V0S2VlcDsKICB2YXIgZGVmbGF0ZVNldEhlYWRlcl8xID0gZGVmbGF0ZVNldEhlYWRlcjsKICB2YXIgZGVmbGF0ZV8yJDEgPSBkZWZsYXRlJDI7CiAgdmFyIGRlZmxhdGVFbmRfMSA9IGRlZmxhdGVFbmQ7CiAgdmFyIGRlZmxhdGVTZXREaWN0aW9uYXJ5XzEgPSBkZWZsYXRlU2V0RGljdGlvbmFyeTsKICB2YXIgZGVmbGF0ZUluZm8gPSAncGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSc7CgogIC8qIE5vdCBpbXBsZW1lbnRlZAogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVCb3VuZCA9IGRlZmxhdGVCb3VuZDsKICBtb2R1bGUuZXhwb3J0cy5kZWZsYXRlQ29weSA9IGRlZmxhdGVDb3B5OwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQYXJhbXMgPSBkZWZsYXRlUGFyYW1zOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQZW5kaW5nID0gZGVmbGF0ZVBlbmRpbmc7CiAgbW9kdWxlLmV4cG9ydHMuZGVmbGF0ZVByaW1lID0gZGVmbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVUdW5lID0gZGVmbGF0ZVR1bmU7CiAgKi8KCiAgdmFyIGRlZmxhdGVfMSQyID0gewogIAlkZWZsYXRlSW5pdDogZGVmbGF0ZUluaXRfMSwKICAJZGVmbGF0ZUluaXQyOiBkZWZsYXRlSW5pdDJfMSwKICAJZGVmbGF0ZVJlc2V0OiBkZWZsYXRlUmVzZXRfMSwKICAJZGVmbGF0ZVJlc2V0S2VlcDogZGVmbGF0ZVJlc2V0S2VlcF8xLAogIAlkZWZsYXRlU2V0SGVhZGVyOiBkZWZsYXRlU2V0SGVhZGVyXzEsCiAgCWRlZmxhdGU6IGRlZmxhdGVfMiQxLAogIAlkZWZsYXRlRW5kOiBkZWZsYXRlRW5kXzEsCiAgCWRlZmxhdGVTZXREaWN0aW9uYXJ5OiBkZWZsYXRlU2V0RGljdGlvbmFyeV8xLAogIAlkZWZsYXRlSW5mbzogZGVmbGF0ZUluZm8KICB9OwoKICBjb25zdCBfaGFzID0gKG9iaiwga2V5KSA9PiB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICB2YXIgYXNzaWduID0gZnVuY3Rpb24gKG9iaiAvKmZyb20xLCBmcm9tMiwgZnJvbTMsIC4uLiovKSB7CiAgICBjb25zdCBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHdoaWxlIChzb3VyY2VzLmxlbmd0aCkgewogICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7CiAgICAgIGlmICghc291cmNlKSB7IGNvbnRpbnVlOyB9CgogICAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHNvdXJjZSArICdtdXN0IGJlIG5vbi1vYmplY3QnKTsKICAgICAgfQoKICAgICAgZm9yIChjb25zdCBwIGluIHNvdXJjZSkgewogICAgICAgIGlmIChfaGFzKHNvdXJjZSwgcCkpIHsKICAgICAgICAgIG9ialtwXSA9IHNvdXJjZVtwXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07CgoKICAvLyBKb2luIGFycmF5IG9mIGNodW5rcyB0byBzaW5nbGUgYXJyYXkuCiAgdmFyIGZsYXR0ZW5DaHVua3MgPSAoY2h1bmtzKSA9PiB7CiAgICAvLyBjYWxjdWxhdGUgZGF0YSBsZW5ndGgKICAgIGxldCBsZW4gPSAwOwoKICAgIGZvciAobGV0IGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBsZW4gKz0gY2h1bmtzW2ldLmxlbmd0aDsKICAgIH0KCiAgICAvLyBqb2luIGNodW5rcwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkobGVuKTsKCiAgICBmb3IgKGxldCBpID0gMCwgcG9zID0gMCwgbCA9IGNodW5rcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgbGV0IGNodW5rID0gY2h1bmtzW2ldOwogICAgICByZXN1bHQuc2V0KGNodW5rLCBwb3MpOwogICAgICBwb3MgKz0gY2h1bmsubGVuZ3RoOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgdmFyIGNvbW1vbiA9IHsKICAJYXNzaWduOiBhc3NpZ24sCiAgCWZsYXR0ZW5DaHVua3M6IGZsYXR0ZW5DaHVua3MKICB9OwoKICAvLyBTdHJpbmcgZW5jb2RlL2RlY29kZSBoZWxwZXJzCgoKICAvLyBRdWljayBjaGVjayBpZiB3ZSBjYW4gdXNlIGZhc3QgYXJyYXkgdG8gYmluIHN0cmluZyBjb252ZXJzaW9uCiAgLy8KICAvLyAtIGFwcGx5KEFycmF5KSBjYW4gZmFpbCBvbiBBbmRyb2lkIDIuMgogIC8vIC0gYXBwbHkoVWludDhBcnJheSkgY2FuIGZhaWwgb24gaU9TIDUuMSBTYWZhcmkKICAvLwogIGxldCBTVFJfQVBQTFlfVUlBX09LID0gdHJ1ZTsKCiAgdHJ5IHsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSgxKSk7IH0gY2F0Y2ggKF9fKSB7IFNUUl9BUFBMWV9VSUFfT0sgPSBmYWxzZTsgfQoKCiAgLy8gVGFibGUgd2l0aCB1dGY4IGxlbmd0aHMgKGNhbGN1bGF0ZWQgYnkgZmlyc3QgYnl0ZSBvZiBzZXF1ZW5jZSkKICAvLyBOb3RlLCB0aGF0IDUgJiA2LWJ5dGUgdmFsdWVzIGFuZCBzb21lIDQtYnl0ZSB2YWx1ZXMgY2FuIG5vdCBiZSByZXByZXNlbnRlZCBpbiBKUywKICAvLyBiZWNhdXNlIG1heCBwb3NzaWJsZSBjb2RlcG9pbnQgaXMgMHgxMGZmZmYKICBjb25zdCBfdXRmOGxlbiA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgZm9yIChsZXQgcSA9IDA7IHEgPCAyNTY7IHErKykgewogICAgX3V0ZjhsZW5bcV0gPSAocSA+PSAyNTIgPyA2IDogcSA+PSAyNDggPyA1IDogcSA+PSAyNDAgPyA0IDogcSA+PSAyMjQgPyAzIDogcSA+PSAxOTIgPyAyIDogMSk7CiAgfQogIF91dGY4bGVuWzI1NF0gPSBfdXRmOGxlblsyNTRdID0gMTsgLy8gSW52YWxpZCBzZXF1ZW5jZSBzdGFydAoKCiAgLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkgKHR5cGVkLCB3aGVuIHBvc3NpYmxlKQogIHZhciBzdHJpbmcyYnVmID0gKHN0cikgPT4gewogICAgaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PT0gJ2Z1bmN0aW9uJyAmJiBUZXh0RW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlKSB7CiAgICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc3RyKTsKICAgIH0KCiAgICBsZXQgYnVmLCBjLCBjMiwgbV9wb3MsIGksIHN0cl9sZW4gPSBzdHIubGVuZ3RoLCBidWZfbGVuID0gMDsKCiAgICAvLyBjb3VudCBiaW5hcnkgc2l6ZQogICAgZm9yIChtX3BvcyA9IDA7IG1fcG9zIDwgc3RyX2xlbjsgbV9wb3MrKykgewogICAgICBjID0gc3RyLmNoYXJDb2RlQXQobV9wb3MpOwogICAgICBpZiAoKGMgJiAweGZjMDApID09PSAweGQ4MDAgJiYgKG1fcG9zICsgMSA8IHN0cl9sZW4pKSB7CiAgICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgIGlmICgoYzIgJiAweGZjMDApID09PSAweGRjMDApIHsKICAgICAgICAgIGMgPSAweDEwMDAwICsgKChjIC0gMHhkODAwKSA8PCAxMCkgKyAoYzIgLSAweGRjMDApOwogICAgICAgICAgbV9wb3MrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmX2xlbiArPSBjIDwgMHg4MCA/IDEgOiBjIDwgMHg4MDAgPyAyIDogYyA8IDB4MTAwMDAgPyAzIDogNDsKICAgIH0KCiAgICAvLyBhbGxvY2F0ZSBidWZmZXIKICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGJ1Zl9sZW4pOwoKICAgIC8vIGNvbnZlcnQKICAgIGZvciAoaSA9IDAsIG1fcG9zID0gMDsgaSA8IGJ1Zl9sZW47IG1fcG9zKyspIHsKICAgICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgICAgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmIChtX3BvcyArIDEgPCBzdHJfbGVuKSkgewogICAgICAgIGMyID0gc3RyLmNoYXJDb2RlQXQobV9wb3MgKyAxKTsKICAgICAgICBpZiAoKGMyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7CiAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAtIDB4ZDgwMCkgPDwgMTApICsgKGMyIC0gMHhkYzAwKTsKICAgICAgICAgIG1fcG9zKys7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjIDwgMHg4MCkgewogICAgICAgIC8qIG9uZSBieXRlICovCiAgICAgICAgYnVmW2krK10gPSBjOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDgwMCkgewogICAgICAgIC8qIHR3byBieXRlcyAqLwogICAgICAgIGJ1ZltpKytdID0gMHhDMCB8IChjID4+PiA2KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyAmIDB4M2YpOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDEwMDAwKSB7CiAgICAgICAgLyogdGhyZWUgYnl0ZXMgKi8KICAgICAgICBidWZbaSsrXSA9IDB4RTAgfCAoYyA+Pj4gMTIpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjID4+PiA2ICYgMHgzZik7CiAgICAgICAgYnVmW2krK10gPSAweDgwIHwgKGMgJiAweDNmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBmb3VyIGJ5dGVzICovCiAgICAgICAgYnVmW2krK10gPSAweGYwIHwgKGMgPj4+IDE4KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gMTIgJiAweDNmKTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gNiAmIDB4M2YpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjICYgMHgzZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmOwogIH07CgogIC8vIEhlbHBlcgogIGNvbnN0IGJ1ZjJiaW5zdHJpbmcgPSAoYnVmLCBsZW4pID0+IHsKICAgIC8vIE9uIENocm9tZSwgdGhlIGFyZ3VtZW50cyBpbiBhIGZ1bmN0aW9uIGNhbGwgdGhhdCBhcmUgYWxsb3dlZCBpcyBgNjU1MzRgLgogICAgLy8gSWYgdGhlIGxlbmd0aCBvZiB0aGUgYnVmZmVyIGlzIHNtYWxsZXIgdGhhbiB0aGF0LCB3ZSBjYW4gdXNlIHRoaXMgb3B0aW1pemF0aW9uLAogICAgLy8gb3RoZXJ3aXNlIHdlIHdpbGwgdGFrZSBhIHNsb3dlciBwYXRoLgogICAgaWYgKGxlbiA8IDY1NTM0KSB7CiAgICAgIGlmIChidWYuc3ViYXJyYXkgJiYgU1RSX0FQUExZX1VJQV9PSykgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ1Zi5sZW5ndGggPT09IGxlbiA/IGJ1ZiA6IGJ1Zi5zdWJhcnJheSgwLCBsZW4pKTsKICAgICAgfQogICAgfQoKICAgIGxldCByZXN1bHQgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCgogIC8vIGNvbnZlcnQgYXJyYXkgdG8gc3RyaW5nCiAgdmFyIGJ1ZjJzdHJpbmcgPSAoYnVmLCBtYXgpID0+IHsKICAgIGNvbnN0IGxlbiA9IG1heCB8fCBidWYubGVuZ3RoOwoKICAgIGlmICh0eXBlb2YgVGV4dERlY29kZXIgPT09ICdmdW5jdGlvbicgJiYgVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSkgewogICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJ1Zi5zdWJhcnJheSgwLCBtYXgpKTsKICAgIH0KCiAgICBsZXQgaSwgb3V0OwoKICAgIC8vIFJlc2VydmUgbWF4IHBvc3NpYmxlIGxlbmd0aCAoMiB3b3JkcyBwZXIgY2hhcikKICAgIC8vIE5COiBieSB1bmtub3duIHJlYXNvbnMsIEFycmF5IGlzIHNpZ25pZmljYW50bHkgZmFzdGVyIGZvcgogICAgLy8gICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkgdGhhbiBVaW50MTZBcnJheS4KICAgIGNvbnN0IHV0ZjE2YnVmID0gbmV3IEFycmF5KGxlbiAqIDIpOwoKICAgIGZvciAob3V0ID0gMCwgaSA9IDA7IGkgPCBsZW47KSB7CiAgICAgIGxldCBjID0gYnVmW2krK107CiAgICAgIC8vIHF1aWNrIHByb2Nlc3MgYXNjaWkKICAgICAgaWYgKGMgPCAweDgwKSB7IHV0ZjE2YnVmW291dCsrXSA9IGM7IGNvbnRpbnVlOyB9CgogICAgICBsZXQgY19sZW4gPSBfdXRmOGxlbltjXTsKICAgICAgLy8gc2tpcCA1ICYgNiBieXRlIGNvZGVzCiAgICAgIGlmIChjX2xlbiA+IDQpIHsgdXRmMTZidWZbb3V0KytdID0gMHhmZmZkOyBpICs9IGNfbGVuIC0gMTsgY29udGludWU7IH0KCiAgICAgIC8vIGFwcGx5IG1hc2sgb24gZmlyc3QgYnl0ZQogICAgICBjICY9IGNfbGVuID09PSAyID8gMHgxZiA6IGNfbGVuID09PSAzID8gMHgwZiA6IDB4MDc7CiAgICAgIC8vIGpvaW4gdGhlIHJlc3QKICAgICAgd2hpbGUgKGNfbGVuID4gMSAmJiBpIDwgbGVuKSB7CiAgICAgICAgYyA9IChjIDw8IDYpIHwgKGJ1ZltpKytdICYgMHgzZik7CiAgICAgICAgY19sZW4tLTsKICAgICAgfQoKICAgICAgLy8gdGVybWluYXRlZCBieSBlbmQgb2Ygc3RyaW5nPwogICAgICBpZiAoY19sZW4gPiAxKSB7IHV0ZjE2YnVmW291dCsrXSA9IDB4ZmZmZDsgY29udGludWU7IH0KCiAgICAgIGlmIChjIDwgMHgxMDAwMCkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IGM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyAtPSAweDEwMDAwOwogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDB4ZDgwMCB8ICgoYyA+PiAxMCkgJiAweDNmZik7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gMHhkYzAwIHwgKGMgJiAweDNmZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmMmJpbnN0cmluZyh1dGYxNmJ1Ziwgb3V0KTsKICB9OwoKCiAgLy8gQ2FsY3VsYXRlIG1heCBwb3NzaWJsZSBwb3NpdGlvbiBpbiB1dGY4IGJ1ZmZlciwKICAvLyB0aGF0IHdpbGwgbm90IGJyZWFrIHNlcXVlbmNlLiBJZiB0aGF0J3Mgbm90IHBvc3NpYmxlCiAgLy8gLSAodmVyeSBzbWFsbCBsaW1pdHMpIHJldHVybiBtYXggc2l6ZSBhcyBpcy4KICAvLwogIC8vIGJ1ZltdIC0gdXRmOCBieXRlcyBhcnJheQogIC8vIG1heCAgIC0gbGVuZ3RoIGxpbWl0IChtYW5kYXRvcnkpOwogIHZhciB1dGY4Ym9yZGVyID0gKGJ1ZiwgbWF4KSA9PiB7CgogICAgbWF4ID0gbWF4IHx8IGJ1Zi5sZW5ndGg7CiAgICBpZiAobWF4ID4gYnVmLmxlbmd0aCkgeyBtYXggPSBidWYubGVuZ3RoOyB9CgogICAgLy8gZ28gYmFjayBmcm9tIGxhc3QgcG9zaXRpb24sIHVudGlsIHN0YXJ0IG9mIHNlcXVlbmNlIGZvdW5kCiAgICBsZXQgcG9zID0gbWF4IC0gMTsKICAgIHdoaWxlIChwb3MgPj0gMCAmJiAoYnVmW3Bvc10gJiAweEMwKSA9PT0gMHg4MCkgeyBwb3MtLTsgfQoKICAgIC8vIFZlcnkgc21hbGwgYW5kIGJyb2tlbiBzZXF1ZW5jZSwKICAgIC8vIHJldHVybiBtYXgsIGJlY2F1c2Ugd2Ugc2hvdWxkIHJldHVybiBzb21ldGhpbmcgYW55d2F5LgogICAgaWYgKHBvcyA8IDApIHsgcmV0dXJuIG1heDsgfQoKICAgIC8vIElmIHdlIGNhbWUgdG8gc3RhcnQgb2YgYnVmZmVyIC0gdGhhdCBtZWFucyBidWZmZXIgaXMgdG9vIHNtYWxsLAogICAgLy8gcmV0dXJuIG1heCB0b28uCiAgICBpZiAocG9zID09PSAwKSB7IHJldHVybiBtYXg7IH0KCiAgICByZXR1cm4gKHBvcyArIF91dGY4bGVuW2J1Zltwb3NdXSA+IG1heCkgPyBwb3MgOiBtYXg7CiAgfTsKCiAgdmFyIHN0cmluZ3MgPSB7CiAgCXN0cmluZzJidWY6IHN0cmluZzJidWYsCiAgCWJ1ZjJzdHJpbmc6IGJ1ZjJzdHJpbmcsCiAgCXV0Zjhib3JkZXI6IHV0Zjhib3JkZXIKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgZnVuY3Rpb24gWlN0cmVhbSgpIHsKICAgIC8qIG5leHQgaW5wdXQgYnl0ZSAqLwogICAgdGhpcy5pbnB1dCA9IG51bGw7IC8vIEpTIHNwZWNpZmljLCBiZWNhdXNlIHdlIGhhdmUgbm8gcG9pbnRlcnMKICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICAvKiBudW1iZXIgb2YgYnl0ZXMgYXZhaWxhYmxlIGF0IGlucHV0ICovCiAgICB0aGlzLmF2YWlsX2luID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBpbnB1dCBieXRlcyByZWFkIHNvIGZhciAqLwogICAgdGhpcy50b3RhbF9pbiA9IDA7CiAgICAvKiBuZXh0IG91dHB1dCBieXRlIHNob3VsZCBiZSBwdXQgdGhlcmUgKi8KICAgIHRoaXMub3V0cHV0ID0gbnVsbDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwogICAgdGhpcy5uZXh0X291dCA9IDA7CiAgICAvKiByZW1haW5pbmcgZnJlZSBzcGFjZSBhdCBvdXRwdXQgKi8KICAgIHRoaXMuYXZhaWxfb3V0ID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBieXRlcyBvdXRwdXQgc28gZmFyICovCiAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICAvKiBsYXN0IGVycm9yIG1lc3NhZ2UsIE5VTEwgaWYgbm8gZXJyb3IgKi8KICAgIHRoaXMubXNnID0gJycvKlpfTlVMTCovOwogICAgLyogbm90IHZpc2libGUgYnkgYXBwbGljYXRpb25zICovCiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIC8qIGJlc3QgZ3Vlc3MgYWJvdXQgdGhlIGRhdGEgdHlwZTogYmluYXJ5IG9yIHRleHQgKi8KICAgIHRoaXMuZGF0YV90eXBlID0gMi8qWl9VTktOT1dOKi87CiAgICAvKiBhZGxlcjMyIHZhbHVlIG9mIHRoZSB1bmNvbXByZXNzZWQgZGF0YSAqLwogICAgdGhpcy5hZGxlciA9IDA7CiAgfQoKICB2YXIgenN0cmVhbSA9IFpTdHJlYW07CgogIGNvbnN0IHRvU3RyaW5nJDEgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfTk9fRkxVU0g6IFpfTk9fRkxVU0gkMSwgWl9TWU5DX0ZMVVNILCBaX0ZVTExfRkxVU0gsIFpfRklOSVNIOiBaX0ZJTklTSCQyLAogICAgWl9PSzogWl9PSyQyLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQyLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgWl9ERUZBVUxUX1NUUkFURUdZLAogICAgWl9ERUZMQVRFRDogWl9ERUZMQVRFRCQxCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgRGVmbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2RlZmxhdGVdXSwKICAgKiBbW2RlZmxhdGVSYXddXSBhbmQgW1tnemlwXV0uCiAgICoqLwoKICAvKiBpbnRlcm5hbAogICAqIERlZmxhdGUuY2h1bmtzIC0+IEFycmF5CiAgICoKICAgKiBDaHVua3Mgb2Ygb3V0cHV0IGRhdGEsIGlmIFtbRGVmbGF0ZSNvbkRhdGFdXSBub3Qgb3ZlcnJpZGRlbi4KICAgKiovCgogIC8qKgogICAqIERlZmxhdGUucmVzdWx0IC0+IFVpbnQ4QXJyYXkKICAgKgogICAqIENvbXByZXNzZWQgcmVzdWx0LCBnZW5lcmF0ZWQgYnkgZGVmYXVsdCBbW0RlZmxhdGUjb25EYXRhXV0KICAgKiBhbmQgW1tEZWZsYXRlI29uRW5kXV0gaGFuZGxlcnMuIEZpbGxlZCBhZnRlciB5b3UgcHVzaCBsYXN0IGNodW5rCiAgICogKGNhbGwgW1tEZWZsYXRlI3B1c2hdXSB3aXRoIGBaX0ZJTklTSGAgLyBgdHJ1ZWAgcGFyYW0pLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5lcnIgLT4gTnVtYmVyCiAgICoKICAgKiBFcnJvciBjb2RlIGFmdGVyIGRlZmxhdGUgZmluaXNoZWQuIDAgKFpfT0spIG9uIHN1Y2Nlc3MuCiAgICogWW91IHdpbGwgbm90IG5lZWQgaXQgaW4gcmVhbCBsaWZlLCBiZWNhdXNlIGRlZmxhdGUgZXJyb3JzCiAgICogYXJlIHBvc3NpYmxlIG9ubHkgb24gd3Jvbmcgb3B0aW9ucyBvciBiYWQgYG9uRGF0YWAgLyBgb25FbmRgCiAgICogY3VzdG9tIGhhbmRsZXJzLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5tc2cgLT4gU3RyaW5nCiAgICoKICAgKiBFcnJvciBtZXNzYWdlLCBpZiBbW0RlZmxhdGUuZXJyXV0gIT0gMAogICAqKi8KCgogIC8qKgogICAqIG5ldyBEZWZsYXRlKG9wdGlvbnMpCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGRlZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIENyZWF0ZXMgbmV3IGRlZmxhdG9yIGluc3RhbmNlIHdpdGggc3BlY2lmaWVkIHBhcmFtcy4gVGhyb3dzIGV4Y2VwdGlvbgogICAqIG9uIGJhZCBwYXJhbXMuIFN1cHBvcnRlZCBvcHRpb25zOgogICAqCiAgICogLSBgbGV2ZWxgCiAgICogLSBgd2luZG93Qml0c2AKICAgKiAtIGBtZW1MZXZlbGAKICAgKiAtIGBzdHJhdGVneWAKICAgKiAtIGBkaWN0aW9uYXJ5YAogICAqCiAgICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogICAqIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIHRoZXNlLgogICAqCiAgICogQWRkaXRpb25hbCBvcHRpb25zLCBmb3IgaW50ZXJuYWwgbmVlZHM6CiAgICoKICAgKiAtIGBjaHVua1NpemVgIC0gc2l6ZSBvZiBnZW5lcmF0ZWQgZGF0YSBjaHVua3MgKDE2SyBieSBkZWZhdWx0KQogICAqIC0gYHJhd2AgKEJvb2xlYW4pIC0gZG8gcmF3IGRlZmxhdGUKICAgKiAtIGBnemlwYCAoQm9vbGVhbikgLSBjcmVhdGUgZ3ppcCB3cmFwcGVyCiAgICogLSBgaGVhZGVyYCAoT2JqZWN0KSAtIGN1c3RvbSBoZWFkZXIgZm9yIGd6aXAKICAgKiAgIC0gYHRleHRgIChCb29sZWFuKSAtIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQKICAgKiAgIC0gYHRpbWVgIChOdW1iZXIpIC0gbW9kaWZpY2F0aW9uIHRpbWUsIHVuaXggdGltZXN0YW1wCiAgICogICAtIGBvc2AgKE51bWJlcikgLSBvcGVyYXRpb24gc3lzdGVtIGNvZGUKICAgKiAgIC0gYGV4dHJhYCAoQXJyYXkpIC0gYXJyYXkgb2YgYnl0ZXMgd2l0aCBleHRyYSBkYXRhIChtYXggNjU1MzYpCiAgICogICAtIGBuYW1lYCAoU3RyaW5nKSAtIGZpbGUgbmFtZSAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGNvbW1lbnRgIChTdHJpbmcpIC0gY29tbWVudCAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGhjcmNgIChCb29sZWFuKSAtIHRydWUgaWYgaGVhZGVyIGNyYyBzaG91bGQgYmUgYWRkZWQKICAgKgogICAqICMjIyMjIEV4YW1wbGU6CiAgICoKICAgKiBgYGBqYXZhc2NyaXB0CiAgICogY29uc3QgcGFrbyA9IHJlcXVpcmUoJ3Bha28nKQogICAqICAgLCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqICAgLCBjaHVuazIgPSBuZXcgVWludDhBcnJheShbMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsMTldKTsKICAgKgogICAqIGNvbnN0IGRlZmxhdGUgPSBuZXcgcGFrby5EZWZsYXRlKHsgbGV2ZWw6IDN9KTsKICAgKgogICAqIGRlZmxhdGUucHVzaChjaHVuazEsIGZhbHNlKTsKICAgKiBkZWZsYXRlLnB1c2goY2h1bmsyLCB0cnVlKTsgIC8vIHRydWUgLT4gbGFzdCBjaHVuawogICAqCiAgICogaWYgKGRlZmxhdGUuZXJyKSB7IHRocm93IG5ldyBFcnJvcihkZWZsYXRlLmVycik7IH0KICAgKgogICAqIGNvbnNvbGUubG9nKGRlZmxhdGUucmVzdWx0KTsKICAgKiBgYGAKICAgKiovCiAgZnVuY3Rpb24gRGVmbGF0ZSQxKG9wdGlvbnMpIHsKICAgIHRoaXMub3B0aW9ucyA9IGNvbW1vbi5hc3NpZ24oewogICAgICBsZXZlbDogWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgICBtZXRob2Q6IFpfREVGTEFURUQkMSwKICAgICAgY2h1bmtTaXplOiAxNjM4NCwKICAgICAgd2luZG93Qml0czogMTUsCiAgICAgIG1lbUxldmVsOiA4LAogICAgICBzdHJhdGVneTogWl9ERUZBVUxUX1NUUkFURUdZCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBsZXQgb3B0ID0gdGhpcy5vcHRpb25zOwoKICAgIGlmIChvcHQucmF3ICYmIChvcHQud2luZG93Qml0cyA+IDApKSB7CiAgICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogICAgfQoKICAgIGVsc2UgaWYgKG9wdC5nemlwICYmIChvcHQud2luZG93Qml0cyA+IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gPSBuZXcgenN0cmVhbSgpOwogICAgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CgogICAgbGV0IHN0YXR1cyA9IGRlZmxhdGVfMSQyLmRlZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQubGV2ZWwsCiAgICAgIG9wdC5tZXRob2QsCiAgICAgIG9wdC53aW5kb3dCaXRzLAogICAgICBvcHQubWVtTGV2ZWwsCiAgICAgIG9wdC5zdHJhdGVneQogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LJDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgfQoKICAgIGlmIChvcHQuaGVhZGVyKSB7CiAgICAgIGRlZmxhdGVfMSQyLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLCBvcHQuaGVhZGVyKTsKICAgIH0KCiAgICBpZiAob3B0LmRpY3Rpb25hcnkpIHsKICAgICAgbGV0IGRpY3Q7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICAgIGRpY3QgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nJDEuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBkaWN0ID0gbmV3IFVpbnQ4QXJyYXkob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgewogICAgICAgIGRpY3QgPSBvcHQuZGljdGlvbmFyeTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBkaWN0KTsKCiAgICAgIGlmIChzdGF0dXMgIT09IFpfT0skMikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgICAgfQoKICAgICAgdGhpcy5fZGljdF9zZXQgPSB0cnVlOwogICAgfQogIH0KCiAgLyoqCiAgICogRGVmbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcnxTdHJpbmcpOiBpbnB1dCBkYXRhLiBTdHJpbmdzIHdpbGwgYmUKICAgKiAgIGNvbnZlcnRlZCB0byB1dGY4IGJ5dGUgc2VxdWVuY2UuCiAgICogLSBmbHVzaF9tb2RlIChOdW1iZXJ8Qm9vbGVhbik6IDAuLjYgZm9yIGNvcnJlc3BvbmRpbmcgWl9OT19GTFVTSC4uWl9UUkVFIG1vZGVzLgogICAqICAgU2VlIGNvbnN0YW50cy4gU2tpcHBlZCBvciBgZmFsc2VgIG1lYW5zIFpfTk9fRkxVU0gsIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gZGVmbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbRGVmbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IGNvbXByZXNzZWQgY2h1bmtzLiBSZXR1cm5zIGB0cnVlYCBvbiBzdWNjZXNzLiBUaGUgbGFzdCBkYXRhIGJsb2NrIG11c3QKICAgKiBoYXZlIGBmbHVzaF9tb2RlYCBaX0ZJTklTSCAob3IgYHRydWVgKS4gVGhhdCB3aWxsIGZsdXNoIGludGVybmFsIHBlbmRpbmcKICAgKiBidWZmZXJzIGFuZCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dLgogICAqCiAgICogT24gZmFpbCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dIHdpdGggZXJyb3IgY29kZSBhbmQgcmV0dXJuIGZhbHNlLgogICAqCiAgICogIyMjIyMgRXhhbXBsZQogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIHB1c2goY2h1bmssIGZhbHNlKTsgLy8gcHVzaCBvbmUgb2YgZGF0YSBjaHVua3MKICAgKiAuLi4KICAgKiBwdXNoKGNodW5rLCB0cnVlKTsgIC8vIHB1c2ggbGFzdCBjaHVuawogICAqIGBgYAogICAqKi8KICBEZWZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoZGF0YSwgZmx1c2hfbW9kZSkgewogICAgY29uc3Qgc3RybSA9IHRoaXMuc3RybTsKICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CiAgICBsZXQgc3RhdHVzLCBfZmx1c2hfbW9kZTsKCiAgICBpZiAodGhpcy5lbmRlZCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICBpZiAoZmx1c2hfbW9kZSA9PT0gfn5mbHVzaF9tb2RlKSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGU7CiAgICBlbHNlIF9mbHVzaF9tb2RlID0gZmx1c2hfbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIJDIgOiBaX05PX0ZMVVNIJDE7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICBzdHJtLmlucHV0ID0gc3RyaW5ncy5zdHJpbmcyYnVmKGRhdGEpOwogICAgfSBlbHNlIGlmICh0b1N0cmluZyQxLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgLy8gTWFrZSBzdXJlIGF2YWlsX291dCA+IDYgdG8gYXZvaWQgcmVwZWF0aW5nIG1hcmtlcnMKICAgICAgaWYgKChfZmx1c2hfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIIHx8IF9mbHVzaF9tb2RlID09PSBaX0ZVTExfRkxVU0gpICYmIHN0cm0uYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dC5zdWJhcnJheSgwLCBzdHJtLm5leHRfb3V0KSk7CiAgICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBzdGF0dXMgPSBkZWZsYXRlXzEkMi5kZWZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKCiAgICAgIC8vIEVuZGVkID0+IGZsdXNoIGFuZCBmaW5pc2gKICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EJDIpIHsKICAgICAgICBpZiAoc3RybS5uZXh0X291dCA+IDApIHsKICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICB9CiAgICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gc3RhdHVzID09PSBaX09LJDI7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIG91dCBidWZmZXIgZnVsbAogICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIHJlcXVlc3RlZCBhbmQgaGFzIGRhdGEKICAgICAgaWYgKF9mbHVzaF9tb2RlID4gMCAmJiBzdHJtLm5leHRfb3V0ID4gMCkgewogICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmIChzdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkRhdGEoY2h1bmspIC0+IFZvaWQKICAgKiAtIGNodW5rIChVaW50OEFycmF5KTogb3V0cHV0IGRhdGEuCiAgICoKICAgKiBCeSBkZWZhdWx0LCBzdG9yZXMgZGF0YSBibG9ja3MgaW4gYGNodW5rc1tdYCBwcm9wZXJ0eSBhbmQgZ2x1ZQogICAqIHRob3NlIGluIGBvbkVuZGAuIE92ZXJyaWRlIHRoaXMgaGFuZGxlciwgaWYgeW91IG5lZWQgYW5vdGhlciBiZWhhdmlvdXIuCiAgICoqLwogIERlZmxhdGUkMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICB0aGlzLmNodW5rcy5wdXNoKGNodW5rKTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkVuZChzdGF0dXMpIC0+IFZvaWQKICAgKiAtIHN0YXR1cyAoTnVtYmVyKTogZGVmbGF0ZSBzdGF0dXMuIDAgKFpfT0spIG9uIHN1Y2Nlc3MsCiAgICogICBvdGhlciBpZiBub3QuCiAgICoKICAgKiBDYWxsZWQgb25jZSBhZnRlciB5b3UgdGVsbCBkZWZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgRGVmbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LJDIpIHsKICAgICAgdGhpcy5yZXN1bHQgPSBjb21tb24uZmxhdHRlbkNodW5rcyh0aGlzLmNodW5rcyk7CiAgICB9CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CiAgfTsKCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFNlZSBzdGF0ZSBkZWZzIGZyb20gaW5mbGF0ZS5qcwogIGNvbnN0IEJBRCQxID0gMzA7ICAgICAgIC8qIGdvdCBhIGRhdGEgZXJyb3IgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KICBjb25zdCBUWVBFJDEgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCgogIC8qCiAgICAgRGVjb2RlIGxpdGVyYWwsIGxlbmd0aCwgYW5kIGRpc3RhbmNlIGNvZGVzIGFuZCB3cml0ZSBvdXQgdGhlIHJlc3VsdGluZwogICAgIGxpdGVyYWwgYW5kIG1hdGNoIGJ5dGVzIHVudGlsIGVpdGhlciBub3QgZW5vdWdoIGlucHV0IG9yIG91dHB1dCBpcwogICAgIGF2YWlsYWJsZSwgYW4gZW5kLW9mLWJsb2NrIGlzIGVuY291bnRlcmVkLCBvciBhIGRhdGEgZXJyb3IgaXMgZW5jb3VudGVyZWQuCiAgICAgV2hlbiBsYXJnZSBlbm91Z2ggaW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIGFyZSBzdXBwbGllZCB0byBpbmZsYXRlKCksIGZvcgogICAgIGV4YW1wbGUsIGEgMTZLIGlucHV0IGJ1ZmZlciBhbmQgYSA2NEsgb3V0cHV0IGJ1ZmZlciwgbW9yZSB0aGFuIDk1JSBvZiB0aGUKICAgICBpbmZsYXRlIGV4ZWN1dGlvbiB0aW1lIGlzIHNwZW50IGluIHRoaXMgcm91dGluZS4KCiAgICAgRW50cnkgYXNzdW1wdGlvbnM6CgogICAgICAgICAgc3RhdGUubW9kZSA9PT0gTEVOCiAgICAgICAgICBzdHJtLmF2YWlsX2luID49IDYKICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID49IDI1OAogICAgICAgICAgc3RhcnQgPj0gc3RybS5hdmFpbF9vdXQKICAgICAgICAgIHN0YXRlLmJpdHMgPCA4CgogICAgIE9uIHJldHVybiwgc3RhdGUubW9kZSBpcyBvbmUgb2Y6CgogICAgICAgICAgTEVOIC0tIHJhbiBvdXQgb2YgZW5vdWdoIG91dHB1dCBzcGFjZSBvciBlbm91Z2ggYXZhaWxhYmxlIGlucHV0CiAgICAgICAgICBUWVBFIC0tIHJlYWNoZWQgZW5kIG9mIGJsb2NrIGNvZGUsIGluZmxhdGUoKSB0byBpbnRlcnByZXQgbmV4dCBibG9jawogICAgICAgICAgQkFEIC0tIGVycm9yIGluIGJsb2NrIGRhdGEKCiAgICAgTm90ZXM6CgogICAgICAtIFRoZSBtYXhpbXVtIGlucHV0IGJpdHMgdXNlZCBieSBhIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGlzIDE1IGJpdHMgZm9yIHRoZQogICAgICAgIGxlbmd0aCBjb2RlLCA1IGJpdHMgZm9yIHRoZSBsZW5ndGggZXh0cmEsIDE1IGJpdHMgZm9yIHRoZSBkaXN0YW5jZSBjb2RlLAogICAgICAgIGFuZCAxMyBiaXRzIGZvciB0aGUgZGlzdGFuY2UgZXh0cmEuICBUaGlzIHRvdGFscyA0OCBiaXRzLCBvciBzaXggYnl0ZXMuCiAgICAgICAgVGhlcmVmb3JlIGlmIHN0cm0uYXZhaWxfaW4gPj0gNiwgdGhlbiB0aGVyZSBpcyBlbm91Z2ggaW5wdXQgdG8gYXZvaWQKICAgICAgICBjaGVja2luZyBmb3IgYXZhaWxhYmxlIGlucHV0IHdoaWxlIGRlY29kaW5nLgoKICAgICAgLSBUaGUgbWF4aW11bSBieXRlcyB0aGF0IGEgc2luZ2xlIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGNhbiBvdXRwdXQgaXMgMjU4CiAgICAgICAgYnl0ZXMsIHdoaWNoIGlzIHRoZSBtYXhpbXVtIGxlbmd0aCB0aGF0IGNhbiBiZSBjb2RlZC4gIGluZmxhdGVfZmFzdCgpCiAgICAgICAgcmVxdWlyZXMgc3RybS5hdmFpbF9vdXQgPj0gMjU4IGZvciBlYWNoIGxvb3AgdG8gYXZvaWQgY2hlY2tpbmcgZm9yCiAgICAgICAgb3V0cHV0IHNwYWNlLgogICAqLwogIHZhciBpbmZmYXN0ID0gZnVuY3Rpb24gaW5mbGF0ZV9mYXN0KHN0cm0sIHN0YXJ0KSB7CiAgICBsZXQgX2luOyAgICAgICAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS5pbnB1dCAqLwogICAgbGV0IGxhc3Q7ICAgICAgICAgICAgICAgICAgIC8qIGhhdmUgZW5vdWdoIGlucHV0IHdoaWxlIGluIDwgbGFzdCAqLwogICAgbGV0IF9vdXQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ub3V0cHV0ICovCiAgICBsZXQgYmVnOyAgICAgICAgICAgICAgICAgICAgLyogaW5mbGF0ZSgpJ3MgaW5pdGlhbCBzdHJtLm91dHB1dCAqLwogICAgbGV0IGVuZDsgICAgICAgICAgICAgICAgICAgIC8qIHdoaWxlIG91dCA8IGVuZCwgZW5vdWdoIHNwYWNlIGF2YWlsYWJsZSAqLwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBsZXQgZG1heDsgICAgICAgICAgICAgICAgICAgLyogbWF4aW11bSBkaXN0YW5jZSBmcm9tIHpsaWIgaGVhZGVyICovCiAgLy8jZW5kaWYKICAgIGxldCB3c2l6ZTsgICAgICAgICAgICAgICAgICAvKiB3aW5kb3cgc2l6ZSBvciB6ZXJvIGlmIG5vdCB1c2luZyB3aW5kb3cgKi8KICAgIGxldCB3aGF2ZTsgICAgICAgICAgICAgICAgICAvKiB2YWxpZCBieXRlcyBpbiB0aGUgd2luZG93ICovCiAgICBsZXQgd25leHQ7ICAgICAgICAgICAgICAgICAgLyogd2luZG93IHdyaXRlIGluZGV4ICovCiAgICAvLyBVc2UgYHNfd2luZG93YCBpbnN0ZWFkIGB3aW5kb3dgLCBhdm9pZCBjb25mbGljdCB3aXRoIGluc3RydW1lbnRhdGlvbiB0b29scwogICAgbGV0IHNfd2luZG93OyAgICAgICAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgd3NpemUgIT0gMCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uaG9sZCAqLwogICAgbGV0IGJpdHM7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uYml0cyAqLwogICAgbGV0IGxjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ubGVuY29kZSAqLwogICAgbGV0IGRjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uZGlzdGNvZGUgKi8KICAgIGxldCBsbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBsZW5ndGggY29kZXMgKi8KICAgIGxldCBkbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBkaXN0YW5jZSBjb2RlcyAqLwogICAgbGV0IGhlcmU7ICAgICAgICAgICAgICAgICAgIC8qIHJldHJpZXZlZCB0YWJsZSBlbnRyeSAqLwogICAgbGV0IG9wOyAgICAgICAgICAgICAgICAgICAgIC8qIGNvZGUgYml0cywgb3BlcmF0aW9uLCBleHRyYSBiaXRzLCBvciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICB3aW5kb3cgcG9zaXRpb24sIHdpbmRvdyBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2ggbGVuZ3RoLCB1bnVzZWQgYnl0ZXMgKi8KICAgIGxldCBkaXN0OyAgICAgICAgICAgICAgICAgICAvKiBtYXRjaCBkaXN0YW5jZSAqLwogICAgbGV0IGZyb207ICAgICAgICAgICAgICAgICAgIC8qIHdoZXJlIHRvIGNvcHkgbWF0Y2ggZnJvbSAqLwogICAgbGV0IGZyb21fc291cmNlOwoKCiAgICBsZXQgaW5wdXQsIG91dHB1dDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwoKICAgIC8qIGNvcHkgc3RhdGUgdG8gbG9jYWwgdmFyaWFibGVzICovCiAgICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICAvL2hlcmUgPSBzdGF0ZS5oZXJlOwogICAgX2luID0gc3RybS5uZXh0X2luOwogICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgbGFzdCA9IF9pbiArIChzdHJtLmF2YWlsX2luIC0gNSk7CiAgICBfb3V0ID0gc3RybS5uZXh0X291dDsKICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgYmVnID0gX291dCAtIChzdGFydCAtIHN0cm0uYXZhaWxfb3V0KTsKICAgIGVuZCA9IF9vdXQgKyAoc3RybS5hdmFpbF9vdXQgLSAyNTcpOwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBkbWF4ID0gc3RhdGUuZG1heDsKICAvLyNlbmRpZgogICAgd3NpemUgPSBzdGF0ZS53c2l6ZTsKICAgIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgICB3bmV4dCA9IHN0YXRlLnduZXh0OwogICAgc193aW5kb3cgPSBzdGF0ZS53aW5kb3c7CiAgICBob2xkID0gc3RhdGUuaG9sZDsKICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgbGNvZGUgPSBzdGF0ZS5sZW5jb2RlOwogICAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICAgIGxtYXNrID0gKDEgPDwgc3RhdGUubGVuYml0cykgLSAxOwogICAgZG1hc2sgPSAoMSA8PCBzdGF0ZS5kaXN0Yml0cykgLSAxOwoKCiAgICAvKiBkZWNvZGUgbGl0ZXJhbHMgYW5kIGxlbmd0aC9kaXN0YW5jZXMgdW50aWwgZW5kLW9mLWJsb2NrIG9yIG5vdCBlbm91Z2gKICAgICAgIGlucHV0IGRhdGEgb3Igb3V0cHV0IHNwYWNlICovCgogICAgdG9wOgogICAgZG8gewogICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgIH0KCiAgICAgIGhlcmUgPSBsY29kZVtob2xkICYgbG1hc2tdOwoKICAgICAgZG9sZW46CiAgICAgIGZvciAoOzspIHsgLy8gR290byBlbXVsYXRpb24KICAgICAgICBvcCA9IGhlcmUgPj4+IDI0LypoZXJlLmJpdHMqLzsKICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICBvcCA9IChoZXJlID4+PiAxNikgJiAweGZmLypoZXJlLm9wKi87CiAgICAgICAgaWYgKG9wID09PSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBsaXRlcmFsICovCiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgJyVjJ1xuIiA6CiAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAweCUwMnhcbiIsIGhlcmUudmFsKSk7CiAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGhlcmUgJiAweGZmZmYvKmhlcmUudmFsKi87CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKG9wICYgMTYpIHsgICAgICAgICAgICAgICAgICAgICAvKiBsZW5ndGggYmFzZSAqLwogICAgICAgICAgbGVuID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgIG9wICY9IDE1OyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICBpZiAob3ApIHsKICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbiArPSBob2xkICYgKCgxIDw8IG9wKSAtIDEpOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgbGVuZ3RoICV1XG4iLCBsZW4pKTsKICAgICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBoZXJlID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKCiAgICAgICAgICBkb2Rpc3Q6CiAgICAgICAgICBmb3IgKDs7KSB7IC8vIGdvdG8gZW11bGF0aW9uCiAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQvKmhlcmUuYml0cyovOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgIG9wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmYvKmhlcmUub3AqLzsKCiAgICAgICAgICAgIGlmIChvcCAmIDE2KSB7ICAgICAgICAgICAgICAgICAgICAgIC8qIGRpc3RhbmNlIGJhc2UgKi8KICAgICAgICAgICAgICBkaXN0ID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkaXN0ICs9IGhvbGQgJiAoKDEgPDwgb3ApIC0gMSk7CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgICAgICBpZiAoZGlzdCA+IGRtYXgpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgZGlzdGFuY2UgJXVcbiIsIGRpc3QpKTsKICAgICAgICAgICAgICBvcCA9IF9vdXQgLSBiZWc7ICAgICAgICAgICAgICAgIC8qIG1heCBkaXN0YW5jZSBpbiBvdXRwdXQgKi8KICAgICAgICAgICAgICBpZiAoZGlzdCA+IG9wKSB7ICAgICAgICAgICAgICAgIC8qIHNlZSBpZiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICBvcCA9IGRpc3QgLSBvcDsgICAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYWNrIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgaWYgKG9wID4gd2hhdmUpIHsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayc7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKICAvLyNpZmRlZiBJTkZMQVRFX0FMTE9XX0lOVkFMSURfRElTVEFOQ0VfVE9PRkFSX0FSUlIKICAvLyAgICAgICAgICAgICAgICBpZiAobGVuIDw9IG9wIC0gd2hhdmUpIHsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSAwOwogIC8vICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1sZW4pOwogIC8vICAgICAgICAgICAgICAgICAgY29udGludWUgdG9wOwogIC8vICAgICAgICAgICAgICAgIH0KICAvLyAgICAgICAgICAgICAgICBsZW4gLT0gb3AgLSB3aGF2ZTsKICAvLyAgICAgICAgICAgICAgICBkbyB7CiAgLy8gICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IDA7CiAgLy8gICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCA+IHdoYXZlKTsKICAvLyAgICAgICAgICAgICAgICBpZiAob3AgPT09IDApIHsKICAvLyAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAvLyAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tbGVuKTsKICAvLyAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIHRvcDsKICAvLyAgICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZyb20gPSAwOyAvLyB3aW5kb3cgaW5kZXgKICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gc193aW5kb3c7CiAgICAgICAgICAgICAgICBpZiAod25leHQgPT09IDApIHsgICAgICAgICAgIC8qIHZlcnkgY29tbW9uIGNhc2UgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSAtIG9wOwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHduZXh0IDwgb3ApIHsgICAgICAvKiB3cmFwIGFyb3VuZCB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSArIHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gZW5kIG9mIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHduZXh0IDwgbGVuKSB7ICAvKiBzb21lIGZyb20gc3RhcnQgb2Ygd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgICBvcCA9IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgICAgICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAvKiBjb250aWd1b3VzIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICBmcm9tICs9IHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgeyAgICAgICAgIC8qIHNvbWUgZnJvbSB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tKytdOwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgIC8qIHJlc3QgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGxlbiA+IDIpIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAgICAgICAgIC8qIGNvcHkgZGlyZWN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICBkbyB7ICAgICAgICAgICAgICAgICAgICAgICAgLyogbWluaW11bSBsZW5ndGggaXMgdGhyZWUgKi8KICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChsZW4gPiAyKTsKICAgICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKChvcCAmIDY0KSA9PT0gMCkgeyAgICAgICAgICAvKiAybmQgbGV2ZWwgZGlzdGFuY2UgY29kZSAqLwogICAgICAgICAgICAgIGhlcmUgPSBkY29kZVsoaGVyZSAmIDB4ZmZmZikvKmhlcmUudmFsKi8gKyAoaG9sZCAmICgoMSA8PCBvcCkgLSAxKSldOwogICAgICAgICAgICAgIGNvbnRpbnVlIGRvZGlzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOyAvLyBuZWVkIHRvIGVtdWxhdGUgZ290byB2aWEgImNvbnRpbnVlIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsgICAgICAgICAgICAgIC8qIDJuZCBsZXZlbCBsZW5ndGggY29kZSAqLwogICAgICAgICAgaGVyZSA9IGxjb2RlWyhoZXJlICYgMHhmZmZmKS8qaGVyZS52YWwqLyArIChob2xkICYgKCgxIDw8IG9wKSAtIDEpKV07CiAgICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAob3AgJiAzMikgeyAgICAgICAgICAgICAgICAgICAgIC8qIGVuZC1vZi1ibG9jayAqLwogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEUkMTsKICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7IC8vIG5lZWQgdG8gZW11bGF0ZSBnb3RvIHZpYSAiY29udGludWUiCiAgICAgIH0KICAgIH0gd2hpbGUgKF9pbiA8IGxhc3QgJiYgX291dCA8IGVuZCk7CgogICAgLyogcmV0dXJuIHVudXNlZCBieXRlcyAob24gZW50cnksIGJpdHMgPCA4LCBzbyBpbiB3b24ndCBnbyB0b28gZmFyIGJhY2spICovCiAgICBsZW4gPSBiaXRzID4+IDM7CiAgICBfaW4gLT0gbGVuOwogICAgYml0cyAtPSBsZW4gPDwgMzsKICAgIGhvbGQgJj0gKDEgPDwgYml0cykgLSAxOwoKICAgIC8qIHVwZGF0ZSBzdGF0ZSBhbmQgcmV0dXJuICovCiAgICBzdHJtLm5leHRfaW4gPSBfaW47CiAgICBzdHJtLm5leHRfb3V0ID0gX291dDsKICAgIHN0cm0uYXZhaWxfaW4gPSAoX2luIDwgbGFzdCA/IDUgKyAobGFzdCAtIF9pbikgOiA1IC0gKF9pbiAtIGxhc3QpKTsKICAgIHN0cm0uYXZhaWxfb3V0ID0gKF9vdXQgPCBlbmQgPyAyNTcgKyAoZW5kIC0gX291dCkgOiAyNTcgLSAoX291dCAtIGVuZCkpOwogICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgIHJldHVybjsKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgY29uc3QgTUFYQklUUyA9IDE1OwogIGNvbnN0IEVOT1VHSF9MRU5TJDEgPSA4NTI7CiAgY29uc3QgRU5PVUdIX0RJU1RTJDEgPSA1OTI7CiAgLy9jb25zdCBFTk9VR0ggPSAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgQ09ERVMkMSA9IDA7CiAgY29uc3QgTEVOUyQxID0gMTsKICBjb25zdCBESVNUUyQxID0gMjsKCiAgY29uc3QgbGJhc2UgPSBuZXcgVWludDE2QXJyYXkoWyAvKiBMZW5ndGggY29kZXMgMjU3Li4yODUgYmFzZSAqLwogICAgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMywgMTUsIDE3LCAxOSwgMjMsIDI3LCAzMSwKICAgIDM1LCA0MywgNTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwCiAgXSk7CgogIGNvbnN0IGxleHQgPSBuZXcgVWludDhBcnJheShbIC8qIExlbmd0aCBjb2RlcyAyNTcuLjI4NSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNywgMTcsIDE3LCAxNywgMTgsIDE4LCAxOCwgMTgsCiAgICAxOSwgMTksIDE5LCAxOSwgMjAsIDIwLCAyMCwgMjAsIDIxLCAyMSwgMjEsIDIxLCAxNiwgNzIsIDc4CiAgXSk7CgogIGNvbnN0IGRiYXNlID0gbmV3IFVpbnQxNkFycmF5KFsgLyogRGlzdGFuY2UgY29kZXMgMC4uMjkgYmFzZSAqLwogICAgMSwgMiwgMywgNCwgNSwgNywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLAogICAgMjU3LCAzODUsIDUxMywgNzY5LCAxMDI1LCAxNTM3LCAyMDQ5LCAzMDczLCA0MDk3LCA2MTQ1LAogICAgODE5MywgMTIyODksIDE2Mzg1LCAyNDU3NywgMCwgMAogIF0pOwoKICBjb25zdCBkZXh0ID0gbmV3IFVpbnQ4QXJyYXkoWyAvKiBEaXN0YW5jZSBjb2RlcyAwLi4yOSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE3LCAxNywgMTgsIDE4LCAxOSwgMTksIDIwLCAyMCwgMjEsIDIxLCAyMiwgMjIsCiAgICAyMywgMjMsIDI0LCAyNCwgMjUsIDI1LCAyNiwgMjYsIDI3LCAyNywKICAgIDI4LCAyOCwgMjksIDI5LCA2NCwgNjQKICBdKTsKCiAgY29uc3QgaW5mbGF0ZV90YWJsZSA9ICh0eXBlLCBsZW5zLCBsZW5zX2luZGV4LCBjb2RlcywgdGFibGUsIHRhYmxlX2luZGV4LCB3b3JrLCBvcHRzKSA9PgogIHsKICAgIGNvbnN0IGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgLy9oZXJlID0gb3B0cy5oZXJlOyAvKiB0YWJsZSBlbnRyeSBmb3IgZHVwbGljYXRpb24gKi8KCiAgICBsZXQgbGVuID0gMDsgICAgICAgICAgICAgICAvKiBhIGNvZGUncyBsZW5ndGggaW4gYml0cyAqLwogICAgbGV0IHN5bSA9IDA7ICAgICAgICAgICAgICAgLyogaW5kZXggb2YgY29kZSBzeW1ib2xzICovCiAgICBsZXQgbWluID0gMCwgbWF4ID0gMDsgICAgICAgICAgLyogbWluaW11bSBhbmQgbWF4aW11bSBjb2RlIGxlbmd0aHMgKi8KICAgIGxldCByb290ID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciByb290IHRhYmxlICovCiAgICBsZXQgY3VyciA9IDA7ICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgaW5kZXggYml0cyBmb3IgY3VycmVudCB0YWJsZSAqLwogICAgbGV0IGRyb3AgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBiaXRzIHRvIGRyb3AgZm9yIHN1Yi10YWJsZSAqLwogICAgbGV0IGxlZnQgPSAwOyAgICAgICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgcHJlZml4IGNvZGVzIGF2YWlsYWJsZSAqLwogICAgbGV0IHVzZWQgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBlbnRyaWVzIGluIHRhYmxlIHVzZWQgKi8KICAgIGxldCBodWZmID0gMDsgICAgICAgICAgICAgIC8qIEh1ZmZtYW4gY29kZSAqLwogICAgbGV0IGluY3I7ICAgICAgICAgICAgICAvKiBmb3IgaW5jcmVtZW50aW5nIGNvZGUsIGluZGV4ICovCiAgICBsZXQgZmlsbDsgICAgICAgICAgICAgIC8qIGluZGV4IGZvciByZXBsaWNhdGluZyBlbnRyaWVzICovCiAgICBsZXQgbG93OyAgICAgICAgICAgICAgIC8qIGxvdyBiaXRzIGZvciBjdXJyZW50IHJvb3QgZW50cnkgKi8KICAgIGxldCBtYXNrOyAgICAgICAgICAgICAgLyogbWFzayBmb3IgbG93IHJvb3QgYml0cyAqLwogICAgbGV0IG5leHQ7ICAgICAgICAgICAgIC8qIG5leHQgYXZhaWxhYmxlIHNwYWNlIGluIHRhYmxlICovCiAgICBsZXQgYmFzZSA9IG51bGw7ICAgICAvKiBiYXNlIHZhbHVlIHRhYmxlIHRvIHVzZSAqLwogICAgbGV0IGJhc2VfaW5kZXggPSAwOwogIC8vICBsZXQgc2hvZXh0cmE7ICAgIC8qIGV4dHJhIGJpdHMgdGFibGUgdG8gdXNlICovCiAgICBsZXQgZW5kOyAgICAgICAgICAgICAgICAgICAgLyogdXNlIGJhc2UgYW5kIGV4dHJhIGZvciBzeW1ib2wgPiBlbmQgKi8KICAgIGNvbnN0IGNvdW50ID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgLyogbnVtYmVyIG9mIGNvZGVzIG9mIGVhY2ggbGVuZ3RoICovCiAgICBjb25zdCBvZmZzID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgIC8qIG9mZnNldHMgaW4gdGFibGUgZm9yIGVhY2ggbGVuZ3RoICovCiAgICBsZXQgZXh0cmEgPSBudWxsOwogICAgbGV0IGV4dHJhX2luZGV4ID0gMDsKCiAgICBsZXQgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKCiAgICAvKgogICAgIFByb2Nlc3MgYSBzZXQgb2YgY29kZSBsZW5ndGhzIHRvIGNyZWF0ZSBhIGNhbm9uaWNhbCBIdWZmbWFuIGNvZGUuICBUaGUKICAgICBjb2RlIGxlbmd0aHMgYXJlIGxlbnNbMC4uY29kZXMtMV0uICBFYWNoIGxlbmd0aCBjb3JyZXNwb25kcyB0byB0aGUKICAgICBzeW1ib2xzIDAuLmNvZGVzLTEuICBUaGUgSHVmZm1hbiBjb2RlIGlzIGdlbmVyYXRlZCBieSBmaXJzdCBzb3J0aW5nIHRoZQogICAgIHN5bWJvbHMgYnkgbGVuZ3RoIGZyb20gc2hvcnQgdG8gbG9uZywgYW5kIHJldGFpbmluZyB0aGUgc3ltYm9sIG9yZGVyCiAgICAgZm9yIGNvZGVzIHdpdGggZXF1YWwgbGVuZ3Rocy4gIFRoZW4gdGhlIGNvZGUgc3RhcnRzIHdpdGggYWxsIHplcm8gYml0cwogICAgIGZvciB0aGUgZmlyc3QgY29kZSBvZiB0aGUgc2hvcnRlc3QgbGVuZ3RoLCBhbmQgdGhlIGNvZGVzIGFyZSBpbnRlZ2VyCiAgICAgaW5jcmVtZW50cyBmb3IgdGhlIHNhbWUgbGVuZ3RoLCBhbmQgemVyb3MgYXJlIGFwcGVuZGVkIGFzIHRoZSBsZW5ndGgKICAgICBpbmNyZWFzZXMuICBGb3IgdGhlIGRlZmxhdGUgZm9ybWF0LCB0aGVzZSBiaXRzIGFyZSBzdG9yZWQgYmFja3dhcmRzCiAgICAgZnJvbSB0aGVpciBtb3JlIG5hdHVyYWwgaW50ZWdlciBpbmNyZW1lbnQgb3JkZXJpbmcsIGFuZCBzbyB3aGVuIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcyBhcmUgYnVpbHQgaW4gdGhlIGxhcmdlIGxvb3AgYmVsb3csIHRoZSBpbnRlZ2VyIGNvZGVzCiAgICAgYXJlIGluY3JlbWVudGVkIGJhY2t3YXJkcy4KCiAgICAgVGhpcyByb3V0aW5lIGFzc3VtZXMsIGJ1dCBkb2VzIG5vdCBjaGVjaywgdGhhdCBhbGwgb2YgdGhlIGVudHJpZXMgaW4KICAgICBsZW5zW10gYXJlIGluIHRoZSByYW5nZSAwLi5NQVhCSVRTLiAgVGhlIGNhbGxlciBtdXN0IGFzc3VyZSB0aGlzLgogICAgIDEuLk1BWEJJVFMgaXMgaW50ZXJwcmV0ZWQgYXMgdGhhdCBjb2RlIGxlbmd0aC4gIHplcm8gbWVhbnMgdGhhdCB0aGF0CiAgICAgc3ltYm9sIGRvZXMgbm90IG9jY3VyIGluIHRoaXMgY29kZS4KCiAgICAgVGhlIGNvZGVzIGFyZSBzb3J0ZWQgYnkgY29tcHV0aW5nIGEgY291bnQgb2YgY29kZXMgZm9yIGVhY2ggbGVuZ3RoLAogICAgIGNyZWF0aW5nIGZyb20gdGhhdCBhIHRhYmxlIG9mIHN0YXJ0aW5nIGluZGljZXMgZm9yIGVhY2ggbGVuZ3RoIGluIHRoZQogICAgIHNvcnRlZCB0YWJsZSwgYW5kIHRoZW4gZW50ZXJpbmcgdGhlIHN5bWJvbHMgaW4gb3JkZXIgaW4gdGhlIHNvcnRlZAogICAgIHRhYmxlLiAgVGhlIHNvcnRlZCB0YWJsZSBpcyB3b3JrW10sIHdpdGggdGhhdCBzcGFjZSBiZWluZyBwcm92aWRlZCBieQogICAgIHRoZSBjYWxsZXIuCgogICAgIFRoZSBsZW5ndGggY291bnRzIGFyZSB1c2VkIGZvciBvdGhlciBwdXJwb3NlcyBhcyB3ZWxsLCBpLmUuIGZpbmRpbmcKICAgICB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBsZW5ndGggY29kZXMsIGRldGVybWluaW5nIGlmIHRoZXJlIGFyZSBhbnkKICAgICBjb2RlcyBhdCBhbGwsIGNoZWNraW5nIGZvciBhIHZhbGlkIHNldCBvZiBsZW5ndGhzLCBhbmQgbG9va2luZyBhaGVhZAogICAgIGF0IGxlbmd0aCBjb3VudHMgdG8gZGV0ZXJtaW5lIHN1Yi10YWJsZSBzaXplcyB3aGVuIGJ1aWxkaW5nIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcy4KICAgICAqLwoKICAgIC8qIGFjY3VtdWxhdGUgbGVuZ3RocyBmb3IgY29kZXMgKGFzc3VtZXMgbGVuc1tdIGFsbCBpbiAwLi5NQVhCSVRTKSAqLwogICAgZm9yIChsZW4gPSAwOyBsZW4gPD0gTUFYQklUUzsgbGVuKyspIHsKICAgICAgY291bnRbbGVuXSA9IDA7CiAgICB9CiAgICBmb3IgKHN5bSA9IDA7IHN5bSA8IGNvZGVzOyBzeW0rKykgewogICAgICBjb3VudFtsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrOwogICAgfQoKICAgIC8qIGJvdW5kIGNvZGUgbGVuZ3RocywgZm9yY2Ugcm9vdCB0byBiZSB3aXRoaW4gY29kZSBsZW5ndGhzICovCiAgICByb290ID0gYml0czsKICAgIGZvciAobWF4ID0gTUFYQklUUzsgbWF4ID49IDE7IG1heC0tKSB7CiAgICAgIGlmIChjb3VudFttYXhdICE9PSAwKSB7IGJyZWFrOyB9CiAgICB9CiAgICBpZiAocm9vdCA+IG1heCkgewogICAgICByb290ID0gbWF4OwogICAgfQogICAgaWYgKG1heCA9PT0gMCkgeyAgICAgICAgICAgICAgICAgICAgIC8qIG5vIHN5bWJvbHMgdG8gY29kZSBhdCBhbGwgKi8KICAgICAgLy90YWJsZS5vcFtvcHRzLnRhYmxlX2luZGV4XSA9IDY0OyAgLy9oZXJlLm9wID0gKHZhciBjaGFyKTY0OyAgICAvKiBpbnZhbGlkIGNvZGUgbWFya2VyICovCiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7ICAgLy9oZXJlLmJpdHMgPSAodmFyIGNoYXIpMTsKICAgICAgLy90YWJsZS52YWxbb3B0cy50YWJsZV9pbmRleCsrXSA9IDA7ICAgLy9oZXJlLnZhbCA9ICh2YXIgc2hvcnQpMDsKICAgICAgdGFibGVbdGFibGVfaW5kZXgrK10gPSAoMSA8PCAyNCkgfCAoNjQgPDwgMTYpIHwgMDsKCgogICAgICAvL3RhYmxlLm9wW29wdHMudGFibGVfaW5kZXhdID0gNjQ7CiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7CiAgICAgIC8vdGFibGUudmFsW29wdHMudGFibGVfaW5kZXgrK10gPSAwOwogICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9ICgxIDw8IDI0KSB8ICg2NCA8PCAxNikgfCAwOwoKICAgICAgb3B0cy5iaXRzID0gMTsKICAgICAgcmV0dXJuIDA7ICAgICAvKiBubyBzeW1ib2xzLCBidXQgd2FpdCBmb3IgZGVjb2RpbmcgdG8gcmVwb3J0IGVycm9yICovCiAgICB9CiAgICBmb3IgKG1pbiA9IDE7IG1pbiA8IG1heDsgbWluKyspIHsKICAgICAgaWYgKGNvdW50W21pbl0gIT09IDApIHsgYnJlYWs7IH0KICAgIH0KICAgIGlmIChyb290IDwgbWluKSB7CiAgICAgIHJvb3QgPSBtaW47CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGFuIG92ZXItc3Vic2NyaWJlZCBvciBpbmNvbXBsZXRlIHNldCBvZiBsZW5ndGhzICovCiAgICBsZWZ0ID0gMTsKICAgIGZvciAobGVuID0gMTsgbGVuIDw9IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIGxlZnQgPDw9IDE7CiAgICAgIGxlZnQgLT0gY291bnRbbGVuXTsKICAgICAgaWYgKGxlZnQgPCAwKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9ICAgICAgICAvKiBvdmVyLXN1YnNjcmliZWQgKi8KICAgIH0KICAgIGlmIChsZWZ0ID4gMCAmJiAodHlwZSA9PT0gQ09ERVMkMSB8fCBtYXggIT09IDEpKSB7CiAgICAgIHJldHVybiAtMTsgICAgICAgICAgICAgICAgICAgICAgLyogaW5jb21wbGV0ZSBzZXQgKi8KICAgIH0KCiAgICAvKiBnZW5lcmF0ZSBvZmZzZXRzIGludG8gc3ltYm9sIHRhYmxlIGZvciBlYWNoIGxlbmd0aCBmb3Igc29ydGluZyAqLwogICAgb2Zmc1sxXSA9IDA7CiAgICBmb3IgKGxlbiA9IDE7IGxlbiA8IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIG9mZnNbbGVuICsgMV0gPSBvZmZzW2xlbl0gKyBjb3VudFtsZW5dOwogICAgfQoKICAgIC8qIHNvcnQgc3ltYm9scyBieSBsZW5ndGgsIGJ5IHN5bWJvbCBvcmRlciB3aXRoaW4gZWFjaCBsZW5ndGggKi8KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGlmIChsZW5zW2xlbnNfaW5kZXggKyBzeW1dICE9PSAwKSB7CiAgICAgICAgd29ya1tvZmZzW2xlbnNbbGVuc19pbmRleCArIHN5bV1dKytdID0gc3ltOwogICAgICB9CiAgICB9CgogICAgLyoKICAgICBDcmVhdGUgYW5kIGZpbGwgaW4gZGVjb2RpbmcgdGFibGVzLiAgSW4gdGhpcyBsb29wLCB0aGUgdGFibGUgYmVpbmcKICAgICBmaWxsZWQgaXMgYXQgbmV4dCBhbmQgaGFzIGN1cnIgaW5kZXggYml0cy4gIFRoZSBjb2RlIGJlaW5nIHVzZWQgaXMgaHVmZgogICAgIHdpdGggbGVuZ3RoIGxlbi4gIFRoYXQgY29kZSBpcyBjb252ZXJ0ZWQgdG8gYW4gaW5kZXggYnkgZHJvcHBpbmcgZHJvcAogICAgIGJpdHMgb2ZmIG9mIHRoZSBib3R0b20uICBGb3IgY29kZXMgd2hlcmUgbGVuIGlzIGxlc3MgdGhhbiBkcm9wICsgY3VyciwKICAgICB0aG9zZSB0b3AgZHJvcCArIGN1cnIgLSBsZW4gYml0cyBhcmUgaW5jcmVtZW50ZWQgdGhyb3VnaCBhbGwgdmFsdWVzIHRvCiAgICAgZmlsbCB0aGUgdGFibGUgd2l0aCByZXBsaWNhdGVkIGVudHJpZXMuCgogICAgIHJvb3QgaXMgdGhlIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciB0aGUgcm9vdCB0YWJsZS4gIFdoZW4gbGVuIGV4Y2VlZHMKICAgICByb290LCBzdWItdGFibGVzIGFyZSBjcmVhdGVkIHBvaW50ZWQgdG8gYnkgdGhlIHJvb3QgZW50cnkgd2l0aCBhbiBpbmRleAogICAgIG9mIHRoZSBsb3cgcm9vdCBiaXRzIG9mIGh1ZmYuICBUaGlzIGlzIHNhdmVkIGluIGxvdyB0byBjaGVjayBmb3Igd2hlbiBhCiAgICAgbmV3IHN1Yi10YWJsZSBzaG91bGQgYmUgc3RhcnRlZC4gIGRyb3AgaXMgemVybyB3aGVuIHRoZSByb290IHRhYmxlIGlzCiAgICAgYmVpbmcgZmlsbGVkLCBhbmQgZHJvcCBpcyByb290IHdoZW4gc3ViLXRhYmxlcyBhcmUgYmVpbmcgZmlsbGVkLgoKICAgICBXaGVuIGEgbmV3IHN1Yi10YWJsZSBpcyBuZWVkZWQsIGl0IGlzIG5lY2Vzc2FyeSB0byBsb29rIGFoZWFkIGluIHRoZQogICAgIGNvZGUgbGVuZ3RocyB0byBkZXRlcm1pbmUgd2hhdCBzaXplIHN1Yi10YWJsZSBpcyBuZWVkZWQuICBUaGUgbGVuZ3RoCiAgICAgY291bnRzIGFyZSB1c2VkIGZvciB0aGlzLCBhbmQgc28gY291bnRbXSBpcyBkZWNyZW1lbnRlZCBhcyBjb2RlcyBhcmUKICAgICBlbnRlcmVkIGluIHRoZSB0YWJsZXMuCgogICAgIHVzZWQga2VlcHMgdHJhY2sgb2YgaG93IG1hbnkgdGFibGUgZW50cmllcyBoYXZlIGJlZW4gYWxsb2NhdGVkIGZyb20gdGhlCiAgICAgcHJvdmlkZWQgKnRhYmxlIHNwYWNlLiAgSXQgaXMgY2hlY2tlZCBmb3IgTEVOUyBhbmQgRElTVCB0YWJsZXMgYWdhaW5zdAogICAgIHRoZSBjb25zdGFudHMgRU5PVUdIX0xFTlMgYW5kIEVOT1VHSF9ESVNUUyB0byBndWFyZCBhZ2FpbnN0IGNoYW5nZXMgaW4KICAgICB0aGUgaW5pdGlhbCByb290IHRhYmxlIHNpemUgY29uc3RhbnRzLiAgU2VlIHRoZSBjb21tZW50cyBpbiBpbmZ0cmVlcy5oCiAgICAgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgIHN5bSBpbmNyZW1lbnRzIHRocm91Z2ggYWxsIHN5bWJvbHMsIGFuZCB0aGUgbG9vcCB0ZXJtaW5hdGVzIHdoZW4KICAgICBhbGwgY29kZXMgb2YgbGVuZ3RoIG1heCwgaS5lLiBhbGwgY29kZXMsIGhhdmUgYmVlbiBwcm9jZXNzZWQuICBUaGlzCiAgICAgcm91dGluZSBwZXJtaXRzIGluY29tcGxldGUgY29kZXMsIHNvIGFub3RoZXIgbG9vcCBhZnRlciB0aGlzIG9uZSBmaWxscwogICAgIGluIHRoZSByZXN0IG9mIHRoZSBkZWNvZGluZyB0YWJsZXMgd2l0aCBpbnZhbGlkIGNvZGUgbWFya2Vycy4KICAgICAqLwoKICAgIC8qIHNldCB1cCBmb3IgY29kZSB0eXBlICovCiAgICAvLyBwb29yIG1hbiBvcHRpbWl6YXRpb24gLSB1c2UgaWYtZWxzZSBpbnN0ZWFkIG9mIHN3aXRjaCwKICAgIC8vIHRvIGF2b2lkIGRlb3B0cyBpbiBvbGQgdjgKICAgIGlmICh0eXBlID09PSBDT0RFUyQxKSB7CiAgICAgIGJhc2UgPSBleHRyYSA9IHdvcms7ICAgIC8qIGR1bW15IHZhbHVlLS1ub3QgdXNlZCAqLwogICAgICBlbmQgPSAxOTsKCiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IExFTlMkMSkgewogICAgICBiYXNlID0gbGJhc2U7CiAgICAgIGJhc2VfaW5kZXggLT0gMjU3OwogICAgICBleHRyYSA9IGxleHQ7CiAgICAgIGV4dHJhX2luZGV4IC09IDI1NzsKICAgICAgZW5kID0gMjU2OwoKICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAvKiBESVNUUyAqLwogICAgICBiYXNlID0gZGJhc2U7CiAgICAgIGV4dHJhID0gZGV4dDsKICAgICAgZW5kID0gLTE7CiAgICB9CgogICAgLyogaW5pdGlhbGl6ZSBvcHRzIGZvciBsb29wICovCiAgICBodWZmID0gMDsgICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSAqLwogICAgc3ltID0gMDsgICAgICAgICAgICAgICAgICAgIC8qIHN0YXJ0aW5nIGNvZGUgc3ltYm9sICovCiAgICBsZW4gPSBtaW47ICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSBsZW5ndGggKi8KICAgIG5leHQgPSB0YWJsZV9pbmRleDsgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgdG8gZmlsbCBpbiAqLwogICAgY3VyciA9IHJvb3Q7ICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgaW5kZXggYml0cyAqLwogICAgZHJvcCA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgYml0cyB0byBkcm9wIGZyb20gY29kZSBmb3IgaW5kZXggKi8KICAgIGxvdyA9IC0xOyAgICAgICAgICAgICAgICAgICAvKiB0cmlnZ2VyIG5ldyBzdWItdGFibGUgd2hlbiBsZW4gPiByb290ICovCiAgICB1c2VkID0gMSA8PCByb290OyAgICAgICAgICAvKiB1c2Ugcm9vdCB0YWJsZSBlbnRyaWVzICovCiAgICBtYXNrID0gdXNlZCAtIDE7ICAgICAgICAgICAgLyogbWFzayBmb3IgY29tcGFyaW5nIGxvdyAqLwoKICAgIC8qIGNoZWNrIGF2YWlsYWJsZSB0YWJsZSBzcGFjZSAqLwogICAgaWYgKCh0eXBlID09PSBMRU5TJDEgJiYgdXNlZCA+IEVOT1VHSF9MRU5TJDEpIHx8CiAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgLyogcHJvY2VzcyBhbGwgY29kZXMgYW5kIG1ha2UgdGFibGUgZW50cmllcyAqLwogICAgZm9yICg7OykgewogICAgICAvKiBjcmVhdGUgdGFibGUgZW50cnkgKi8KICAgICAgaGVyZV9iaXRzID0gbGVuIC0gZHJvcDsKICAgICAgaWYgKHdvcmtbc3ltXSA8IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSAwOwogICAgICAgIGhlcmVfdmFsID0gd29ya1tzeW1dOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHdvcmtbc3ltXSA+IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSBleHRyYVtleHRyYV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgICAgaGVyZV92YWwgPSBiYXNlW2Jhc2VfaW5kZXggKyB3b3JrW3N5bV1dOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGhlcmVfb3AgPSAzMiArIDY0OyAgICAgICAgIC8qIGVuZCBvZiBibG9jayAqLwogICAgICAgIGhlcmVfdmFsID0gMDsKICAgICAgfQoKICAgICAgLyogcmVwbGljYXRlIGZvciB0aG9zZSBpbmRpY2VzIHdpdGggbG93IGxlbiBiaXRzIGVxdWFsIHRvIGh1ZmYgKi8KICAgICAgaW5jciA9IDEgPDwgKGxlbiAtIGRyb3ApOwogICAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgICBtaW4gPSBmaWxsOyAgICAgICAgICAgICAgICAgLyogc2F2ZSBvZmZzZXQgdG8gbmV4dCB0YWJsZSAqLwogICAgICBkbyB7CiAgICAgICAgZmlsbCAtPSBpbmNyOwogICAgICAgIHRhYmxlW25leHQgKyAoaHVmZiA+PiBkcm9wKSArIGZpbGxdID0gKGhlcmVfYml0cyA8PCAyNCkgfCAoaGVyZV9vcCA8PCAxNikgfCBoZXJlX3ZhbCB8MDsKICAgICAgfSB3aGlsZSAoZmlsbCAhPT0gMCk7CgogICAgICAvKiBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwogICAgICBpbmNyID0gMSA8PCAobGVuIC0gMSk7CiAgICAgIHdoaWxlIChodWZmICYgaW5jcikgewogICAgICAgIGluY3IgPj49IDE7CiAgICAgIH0KICAgICAgaWYgKGluY3IgIT09IDApIHsKICAgICAgICBodWZmICY9IGluY3IgLSAxOwogICAgICAgIGh1ZmYgKz0gaW5jcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBodWZmID0gMDsKICAgICAgfQoKICAgICAgLyogZ28gdG8gbmV4dCBzeW1ib2wsIHVwZGF0ZSBjb3VudCwgbGVuICovCiAgICAgIHN5bSsrOwogICAgICBpZiAoLS1jb3VudFtsZW5dID09PSAwKSB7CiAgICAgICAgaWYgKGxlbiA9PT0gbWF4KSB7IGJyZWFrOyB9CiAgICAgICAgbGVuID0gbGVuc1tsZW5zX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgfQoKICAgICAgLyogY3JlYXRlIG5ldyBzdWItdGFibGUgaWYgbmVlZGVkICovCiAgICAgIGlmIChsZW4gPiByb290ICYmIChodWZmICYgbWFzaykgIT09IGxvdykgewogICAgICAgIC8qIGlmIGZpcnN0IHRpbWUsIHRyYW5zaXRpb24gdG8gc3ViLXRhYmxlcyAqLwogICAgICAgIGlmIChkcm9wID09PSAwKSB7CiAgICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgICB9CgogICAgICAgIC8qIGluY3JlbWVudCBwYXN0IGxhc3QgdGFibGUgKi8KICAgICAgICBuZXh0ICs9IG1pbjsgICAgICAgICAgICAvKiBoZXJlIG1pbiBpcyAxIDw8IGN1cnIgKi8KCiAgICAgICAgLyogZGV0ZXJtaW5lIGxlbmd0aCBvZiBuZXh0IHRhYmxlICovCiAgICAgICAgY3VyciA9IGxlbiAtIGRyb3A7CiAgICAgICAgbGVmdCA9IDEgPDwgY3VycjsKICAgICAgICB3aGlsZSAoY3VyciArIGRyb3AgPCBtYXgpIHsKICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgaWYgKGxlZnQgPD0gMCkgeyBicmVhazsgfQogICAgICAgICAgY3VycisrOwogICAgICAgICAgbGVmdCA8PD0gMTsKICAgICAgICB9CgogICAgICAgIC8qIGNoZWNrIGZvciBlbm91Z2ggc3BhY2UgKi8KICAgICAgICB1c2VkICs9IDEgPDwgY3VycjsKICAgICAgICBpZiAoKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSkgfHwKICAgICAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgLyogcG9pbnQgZW50cnkgaW4gcm9vdCB0YWJsZSB0byBzdWItdGFibGUgKi8KICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICAvKnRhYmxlLm9wW2xvd10gPSBjdXJyOwogICAgICAgIHRhYmxlLmJpdHNbbG93XSA9IHJvb3Q7CiAgICAgICAgdGFibGUudmFsW2xvd10gPSBuZXh0IC0gb3B0cy50YWJsZV9pbmRleDsqLwogICAgICAgIHRhYmxlW2xvd10gPSAocm9vdCA8PCAyNCkgfCAoY3VyciA8PCAxNikgfCAobmV4dCAtIHRhYmxlX2luZGV4KSB8MDsKICAgICAgfQogICAgfQoKICAgIC8qIGZpbGwgaW4gcmVtYWluaW5nIHRhYmxlIGVudHJ5IGlmIGNvZGUgaXMgaW5jb21wbGV0ZSAoZ3VhcmFudGVlZCB0byBoYXZlCiAgICAgYXQgbW9zdCBvbmUgcmVtYWluaW5nIGVudHJ5LCBzaW5jZSBpZiB0aGUgY29kZSBpcyBpbmNvbXBsZXRlLCB0aGUKICAgICBtYXhpbXVtIGNvZGUgbGVuZ3RoIHRoYXQgd2FzIGFsbG93ZWQgdG8gZ2V0IHRoaXMgZmFyIGlzIG9uZSBiaXQpICovCiAgICBpZiAoaHVmZiAhPT0gMCkgewogICAgICAvL3RhYmxlLm9wW25leHQgKyBodWZmXSA9IDY0OyAgICAgICAgICAgIC8qIGludmFsaWQgY29kZSBtYXJrZXIgKi8KICAgICAgLy90YWJsZS5iaXRzW25leHQgKyBodWZmXSA9IGxlbiAtIGRyb3A7CiAgICAgIC8vdGFibGUudmFsW25leHQgKyBodWZmXSA9IDA7CiAgICAgIHRhYmxlW25leHQgKyBodWZmXSA9ICgobGVuIC0gZHJvcCkgPDwgMjQpIHwgKDY0IDw8IDE2KSB8MDsKICAgIH0KCiAgICAvKiBzZXQgcmV0dXJuIHBhcmFtZXRlcnMgKi8KICAgIC8vb3B0cy50YWJsZV9pbmRleCArPSB1c2VkOwogICAgb3B0cy5iaXRzID0gcm9vdDsKICAgIHJldHVybiAwOwogIH07CgoKICB2YXIgaW5mdHJlZXMgPSBpbmZsYXRlX3RhYmxlOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCgoKCgoKICBjb25zdCBDT0RFUyA9IDA7CiAgY29uc3QgTEVOUyA9IDE7CiAgY29uc3QgRElTVFMgPSAyOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfRklOSVNIOiBaX0ZJTklTSCQxLCBaX0JMT0NLLCBaX1RSRUVTLAogICAgWl9PSzogWl9PSyQxLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQxLCBaX05FRURfRElDVDogWl9ORUVEX0RJQ1QkMSwgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDEsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDEsIFpfTUVNX0VSUk9SOiBaX01FTV9FUlJPUiQxLCBaX0JVRl9FUlJPUiwKICAgIFpfREVGTEFURUQKICB9ID0gY29uc3RhbnRzJDI7CgoKICAvKiBTVEFURVMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBjb25zdCAgICBIRUFEID0gMTsgICAgICAgLyogaTogd2FpdGluZyBmb3IgbWFnaWMgaGVhZGVyICovCiAgY29uc3QgICAgRkxBR1MgPSAyOyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1ldGhvZCBhbmQgZmxhZ3MgKGd6aXApICovCiAgY29uc3QgICAgVElNRSA9IDM7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1vZGlmaWNhdGlvbiB0aW1lIChnemlwKSAqLwogIGNvbnN0ICAgIE9TID0gNDsgICAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBmbGFncyBhbmQgb3BlcmF0aW5nIHN5c3RlbSAoZ3ppcCkgKi8KICBjb25zdCAgICBFWExFTiA9IDU7ICAgICAgLyogaTogd2FpdGluZyBmb3IgZXh0cmEgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIEVYVFJBID0gNjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBieXRlcyAoZ3ppcCkgKi8KICBjb25zdCAgICBOQU1FID0gNzsgICAgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGZpbGUgbmFtZSAoZ3ppcCkgKi8KICBjb25zdCAgICBDT01NRU5UID0gODsgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGNvbW1lbnQgKGd6aXApICovCiAgY29uc3QgICAgSENSQyA9IDk7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGhlYWRlciBjcmMgKGd6aXApICovCiAgY29uc3QgICAgRElDVElEID0gMTA7ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpY3Rpb25hcnkgY2hlY2sgdmFsdWUgKi8KICBjb25zdCAgICBESUNUID0gMTE7ICAgICAgLyogd2FpdGluZyBmb3IgaW5mbGF0ZVNldERpY3Rpb25hcnkoKSBjYWxsICovCiAgY29uc3QgICAgICAgIFRZUEUgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCiAgY29uc3QgICAgICAgIFRZUEVETyA9IDEzOyAgICAvKiBpOiBzYW1lLCBidXQgc2tpcCBjaGVjayB0byBleGl0IGluZmxhdGUgb24gbmV3IGJsb2NrICovCiAgY29uc3QgICAgICAgIFNUT1JFRCA9IDE0OyAgICAvKiBpOiB3YWl0aW5nIGZvciBzdG9yZWQgc2l6ZSAobGVuZ3RoIGFuZCBjb21wbGVtZW50KSAqLwogIGNvbnN0ICAgICAgICBDT1BZXyA9IDE1OyAgICAgLyogaS9vOiBzYW1lIGFzIENPUFkgYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgQ09QWSA9IDE2OyAgICAgIC8qIGkvbzogd2FpdGluZyBmb3IgaW5wdXQgb3Igb3V0cHV0IHRvIGNvcHkgc3RvcmVkIGJsb2NrICovCiAgY29uc3QgICAgICAgIFRBQkxFID0gMTc7ICAgICAvKiBpOiB3YWl0aW5nIGZvciBkeW5hbWljIGJsb2NrIHRhYmxlIGxlbmd0aHMgKi8KICBjb25zdCAgICAgICAgTEVOTEVOUyA9IDE4OyAgIC8qIGk6IHdhaXRpbmcgZm9yIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogIGNvbnN0ICAgICAgICBDT0RFTEVOUyA9IDE5OyAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoL2xpdCBhbmQgZGlzdGFuY2UgY29kZSBsZW5ndGhzICovCiAgY29uc3QgICAgICAgICAgICBMRU5fID0gMjA7ICAgICAgLyogaTogc2FtZSBhcyBMRU4gYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgICAgIExFTiA9IDIxOyAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBsZW5ndGgvbGl0L2VvYiBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBMRU5FWFQgPSAyMjsgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoIGV4dHJhIGJpdHMgKi8KICBjb25zdCAgICAgICAgICAgIERJU1QgPSAyMzsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBkaXN0YW5jZSBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBESVNURVhUID0gMjQ7ICAgLyogaTogd2FpdGluZyBmb3IgZGlzdGFuY2UgZXh0cmEgYml0cyAqLwogIGNvbnN0ICAgICAgICAgICAgTUFUQ0ggPSAyNTsgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byBjb3B5IHN0cmluZyAqLwogIGNvbnN0ICAgICAgICAgICAgTElUID0gMjY7ICAgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byB3cml0ZSBsaXRlcmFsICovCiAgY29uc3QgICAgQ0hFQ0sgPSAyNzsgICAgIC8qIGk6IHdhaXRpbmcgZm9yIDMyLWJpdCBjaGVjayB2YWx1ZSAqLwogIGNvbnN0ICAgIExFTkdUSCA9IDI4OyAgICAvKiBpOiB3YWl0aW5nIGZvciAzMi1iaXQgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIERPTkUgPSAyOTsgICAgICAvKiBmaW5pc2hlZCBjaGVjaywgZG9uZSAtLSByZW1haW4gaGVyZSB1bnRpbCByZXNldCAqLwogIGNvbnN0ICAgIEJBRCA9IDMwOyAgICAgICAvKiBnb3QgYSBkYXRhIGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgTUVNID0gMzE7ICAgICAgIC8qIGdvdCBhbiBpbmZsYXRlKCkgbWVtb3J5IGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgU1lOQyA9IDMyOyAgICAgIC8qIGxvb2tpbmcgZm9yIHN5bmNocm9uaXphdGlvbiBieXRlcyB0byByZXN0YXJ0IGluZmxhdGUoKSAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCgogIGNvbnN0IEVOT1VHSF9MRU5TID0gODUyOwogIGNvbnN0IEVOT1VHSF9ESVNUUyA9IDU5MjsKICAvL2NvbnN0IEVOT1VHSCA9ICAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgTUFYX1dCSVRTID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX1dCSVRTID0gTUFYX1dCSVRTOwoKCiAgY29uc3QgenN3YXAzMiA9IChxKSA9PiB7CgogICAgcmV0dXJuICAoKChxID4+PiAyNCkgJiAweGZmKSArCiAgICAgICAgICAgICgocSA+Pj4gOCkgJiAweGZmMDApICsKICAgICAgICAgICAgKChxICYgMHhmZjAwKSA8PCA4KSArCiAgICAgICAgICAgICgocSAmIDB4ZmYpIDw8IDI0KSk7CiAgfTsKCgogIGZ1bmN0aW9uIEluZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMubW9kZSA9IDA7ICAgICAgICAgICAgIC8qIGN1cnJlbnQgaW5mbGF0ZSBtb2RlICovCiAgICB0aGlzLmxhc3QgPSBmYWxzZTsgICAgICAgICAgLyogdHJ1ZSBpZiBwcm9jZXNzaW5nIGxhc3QgYmxvY2sgKi8KICAgIHRoaXMud3JhcCA9IDA7ICAgICAgICAgICAgICAvKiBiaXQgMCB0cnVlIGZvciB6bGliLCBiaXQgMSB0cnVlIGZvciBnemlwICovCiAgICB0aGlzLmhhdmVkaWN0ID0gZmFsc2U7ICAgICAgLyogdHJ1ZSBpZiBkaWN0aW9uYXJ5IHByb3ZpZGVkICovCiAgICB0aGlzLmZsYWdzID0gMDsgICAgICAgICAgICAgLyogZ3ppcCBoZWFkZXIgbWV0aG9kIGFuZCBmbGFncyAoMCBpZiB6bGliKSAqLwogICAgdGhpcy5kbWF4ID0gMDsgICAgICAgICAgICAgIC8qIHpsaWIgaGVhZGVyIG1heCBkaXN0YW5jZSAoSU5GTEFURV9TVFJJQ1QpICovCiAgICB0aGlzLmNoZWNrID0gMDsgICAgICAgICAgICAgLyogcHJvdGVjdGVkIGNvcHkgb2YgY2hlY2sgdmFsdWUgKi8KICAgIHRoaXMudG90YWwgPSAwOyAgICAgICAgICAgICAvKiBwcm90ZWN0ZWQgY29weSBvZiBvdXRwdXQgY291bnQgKi8KICAgIC8vIFRPRE86IG1heSBiZSB7fQogICAgdGhpcy5oZWFkID0gbnVsbDsgICAgICAgICAgIC8qIHdoZXJlIHRvIHNhdmUgZ3ppcCBoZWFkZXIgaW5mb3JtYXRpb24gKi8KCiAgICAvKiBzbGlkaW5nIHdpbmRvdyAqLwogICAgdGhpcy53Yml0cyA9IDA7ICAgICAgICAgICAgIC8qIGxvZyBiYXNlIDIgb2YgcmVxdWVzdGVkIHdpbmRvdyBzaXplICovCiAgICB0aGlzLndzaXplID0gMDsgICAgICAgICAgICAgLyogd2luZG93IHNpemUgb3IgemVybyBpZiBub3QgdXNpbmcgd2luZG93ICovCiAgICB0aGlzLndoYXZlID0gMDsgICAgICAgICAgICAgLyogdmFsaWQgYnl0ZXMgaW4gdGhlIHdpbmRvdyAqLwogICAgdGhpcy53bmV4dCA9IDA7ICAgICAgICAgICAgIC8qIHdpbmRvdyB3cml0ZSBpbmRleCAqLwogICAgdGhpcy53aW5kb3cgPSBudWxsOyAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgbmVlZGVkICovCgogICAgLyogYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmhvbGQgPSAwOyAgICAgICAgICAgICAgLyogaW5wdXQgYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmJpdHMgPSAwOyAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGJpdHMgaW4gImluIiAqLwoKICAgIC8qIGZvciBzdHJpbmcgYW5kIHN0b3JlZCBibG9jayBjb3B5aW5nICovCiAgICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAgICAgLyogbGl0ZXJhbCBvciBsZW5ndGggb2YgZGF0YSB0byBjb3B5ICovCiAgICB0aGlzLm9mZnNldCA9IDA7ICAgICAgICAgICAgLyogZGlzdGFuY2UgYmFjayB0byBjb3B5IHN0cmluZyBmcm9tICovCgogICAgLyogZm9yIHRhYmxlIGFuZCBjb2RlIGRlY29kaW5nICovCiAgICB0aGlzLmV4dHJhID0gMDsgICAgICAgICAgICAgLyogZXh0cmEgYml0cyBuZWVkZWQgKi8KCiAgICAvKiBmaXhlZCBhbmQgZHluYW1pYyBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5jb2RlID0gbnVsbDsgICAgICAgICAgLyogc3RhcnRpbmcgdGFibGUgZm9yIGxlbmd0aC9saXRlcmFsIGNvZGVzICovCiAgICB0aGlzLmRpc3Rjb2RlID0gbnVsbDsgICAgICAgICAvKiBzdGFydGluZyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKi8KICAgIHRoaXMubGVuYml0cyA9IDA7ICAgICAgICAgICAvKiBpbmRleCBiaXRzIGZvciBsZW5jb2RlICovCiAgICB0aGlzLmRpc3RiaXRzID0gMDsgICAgICAgICAgLyogaW5kZXggYml0cyBmb3IgZGlzdGNvZGUgKi8KCiAgICAvKiBkeW5hbWljIHRhYmxlIGJ1aWxkaW5nICovCiAgICB0aGlzLm5jb2RlID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5ubGVuID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBsZW5ndGggY29kZSBsZW5ndGhzICovCiAgICB0aGlzLm5kaXN0ID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5oYXZlID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBjb2RlIGxlbmd0aHMgaW4gbGVuc1tdICovCiAgICB0aGlzLm5leHQgPSBudWxsOyAgICAgICAgICAgICAgLyogbmV4dCBhdmFpbGFibGUgc3BhY2UgaW4gY29kZXNbXSAqLwoKICAgIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApOyAvKiB0ZW1wb3Jhcnkgc3RvcmFnZSBmb3IgY29kZSBsZW5ndGhzICovCiAgICB0aGlzLndvcmsgPSBuZXcgVWludDE2QXJyYXkoMjg4KTsgLyogd29yayBhcmVhIGZvciBjb2RlIHRhYmxlIGJ1aWxkaW5nICovCgogICAgLyoKICAgICBiZWNhdXNlIHdlIGRvbid0IGhhdmUgcG9pbnRlcnMgaW4ganMsIHdlIHVzZSBsZW5jb2RlIGFuZCBkaXN0Y29kZSBkaXJlY3RseQogICAgIGFzIGJ1ZmZlcnMgc28gd2UgZG9uJ3QgbmVlZCBjb2RlcwogICAgKi8KICAgIC8vdGhpcy5jb2RlcyA9IG5ldyBJbnQzMkFycmF5KEVOT1VHSCk7ICAgICAgIC8qIHNwYWNlIGZvciBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5keW4gPSBudWxsOyAgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgbGVuZ3RoL2xpdGVyYWwgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5kaXN0ZHluID0gbnVsbDsgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5zYW5lID0gMDsgICAgICAgICAgICAgICAgICAgLyogaWYgZmFsc2UsIGFsbG93IGludmFsaWQgZGlzdGFuY2UgdG9vIGZhciAqLwogICAgdGhpcy5iYWNrID0gMDsgICAgICAgICAgICAgICAgICAgLyogYml0cyBiYWNrIG9mIGxhc3QgdW5wcm9jZXNzZWQgbGVuZ3RoL2xpdCAqLwogICAgdGhpcy53YXMgPSAwOyAgICAgICAgICAgICAgICAgICAgLyogaW5pdGlhbCBsZW5ndGggb2YgbWF0Y2ggKi8KICB9CgoKICBjb25zdCBpbmZsYXRlUmVzZXRLZWVwID0gKHN0cm0pID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IHN0YXRlLnRvdGFsID0gMDsKICAgIHN0cm0ubXNnID0gJyc7IC8qWl9OVUxMKi8KICAgIGlmIChzdGF0ZS53cmFwKSB7ICAgICAgIC8qIHRvIHN1cHBvcnQgaWxsLWNvbmNlaXZlZCBKYXZhIHRlc3Qgc3VpdGUgKi8KICAgICAgc3RybS5hZGxlciA9IHN0YXRlLndyYXAgJiAxOwogICAgfQogICAgc3RhdGUubW9kZSA9IEhFQUQ7CiAgICBzdGF0ZS5sYXN0ID0gMDsKICAgIHN0YXRlLmhhdmVkaWN0ID0gMDsKICAgIHN0YXRlLmRtYXggPSAzMjc2ODsKICAgIHN0YXRlLmhlYWQgPSBudWxsLypaX05VTEwqLzsKICAgIHN0YXRlLmhvbGQgPSAwOwogICAgc3RhdGUuYml0cyA9IDA7CiAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQgPSBzdGF0ZS5jb2RlczsKICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfTEVOUyk7CiAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfRElTVFMpOwoKICAgIHN0YXRlLnNhbmUgPSAxOwogICAgc3RhdGUuYmFjayA9IC0xOwogICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6IHJlc2V0XG4iKSk7CiAgICByZXR1cm4gWl9PSyQxOwogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgc3RhdGUud3NpemUgPSAwOwogICAgc3RhdGUud2hhdmUgPSAwOwogICAgc3RhdGUud25leHQgPSAwOwogICAgcmV0dXJuIGluZmxhdGVSZXNldEtlZXAoc3RybSk7CgogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQyID0gKHN0cm0sIHdpbmRvd0JpdHMpID0+IHsKICAgIGxldCB3cmFwOwoKICAgIC8qIGdldCB0aGUgc3RhdGUgKi8KICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGV4dHJhY3Qgd3JhcCByZXF1ZXN0IGZyb20gd2luZG93Qml0cyBwYXJhbWV0ZXIgKi8KICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICB3cmFwID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfQogICAgZWxzZSB7CiAgICAgIHdyYXAgPSAod2luZG93Qml0cyA+PiA0KSArIDE7CiAgICAgIGlmICh3aW5kb3dCaXRzIDwgNDgpIHsKICAgICAgICB3aW5kb3dCaXRzICY9IDE1OwogICAgICB9CiAgICB9CgogICAgLyogc2V0IG51bWJlciBvZiB3aW5kb3cgYml0cywgZnJlZSB3aW5kb3cgaWYgZGlmZmVyZW50ICovCiAgICBpZiAod2luZG93Qml0cyAmJiAod2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1KSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIGlmIChzdGF0ZS53aW5kb3cgIT09IG51bGwgJiYgc3RhdGUud2JpdHMgIT09IHdpbmRvd0JpdHMpIHsKICAgICAgc3RhdGUud2luZG93ID0gbnVsbDsKICAgIH0KCiAgICAvKiB1cGRhdGUgc3RhdGUgYW5kIHJlc2V0IHRoZSByZXN0IG9mIGl0ICovCiAgICBzdGF0ZS53cmFwID0gd3JhcDsKICAgIHN0YXRlLndiaXRzID0gd2luZG93Qml0czsKICAgIHJldHVybiBpbmZsYXRlUmVzZXQoc3RybSk7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVJbml0MiA9IChzdHJtLCB3aW5kb3dCaXRzKSA9PiB7CgogICAgaWYgKCFzdHJtKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CiAgICAvL3N0cm0ubXNnID0gWl9OVUxMOyAgICAgICAgICAgICAgICAgLyogaW4gY2FzZSB3ZSByZXR1cm4gYW4gZXJyb3IgKi8KCiAgICBjb25zdCBzdGF0ZSA9IG5ldyBJbmZsYXRlU3RhdGUoKTsKCiAgICAvL2lmIChzdGF0ZSA9PT0gWl9OVUxMKSByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogYWxsb2NhdGVkXG4iKSk7CiAgICBzdHJtLnN0YXRlID0gc3RhdGU7CiAgICBzdGF0ZS53aW5kb3cgPSBudWxsLypaX05VTEwqLzsKICAgIGNvbnN0IHJldCA9IGluZmxhdGVSZXNldDIoc3RybSwgd2luZG93Qml0cyk7CiAgICBpZiAocmV0ICE9PSBaX09LJDEpIHsKICAgICAgc3RybS5zdGF0ZSA9IG51bGwvKlpfTlVMTCovOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZUluaXQgPSAoc3RybSkgPT4gewoKICAgIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKICB9OwoKCiAgLyoKICAgUmV0dXJuIHN0YXRlIHdpdGggbGVuZ3RoIGFuZCBkaXN0YW5jZSBkZWNvZGluZyB0YWJsZXMgYW5kIGluZGV4IHNpemVzIHNldCB0bwogICBmaXhlZCBjb2RlIGRlY29kaW5nLiAgTm9ybWFsbHkgdGhpcyByZXR1cm5zIGZpeGVkIHRhYmxlcyBmcm9tIGluZmZpeGVkLmguCiAgIElmIEJVSUxERklYRUQgaXMgZGVmaW5lZCwgdGhlbiBpbnN0ZWFkIHRoaXMgcm91dGluZSBidWlsZHMgdGhlIHRhYmxlcyB0aGUKICAgZmlyc3QgdGltZSBpdCdzIGNhbGxlZCwgYW5kIHJldHVybnMgdGhvc2UgdGFibGVzIHRoZSBmaXJzdCB0aW1lIGFuZAogICB0aGVyZWFmdGVyLiAgVGhpcyByZWR1Y2VzIHRoZSBzaXplIG9mIHRoZSBjb2RlIGJ5IGFib3V0IDJLIGJ5dGVzLCBpbgogICBleGNoYW5nZSBmb3IgYSBsaXR0bGUgZXhlY3V0aW9uIHRpbWUuICBIb3dldmVyLCBCVUlMREZJWEVEIHNob3VsZCBub3QgYmUKICAgdXNlZCBmb3IgdGhyZWFkZWQgYXBwbGljYXRpb25zLCBzaW5jZSB0aGUgcmV3cml0aW5nIG9mIHRoZSB0YWJsZXMgYW5kIHZpcmdpbgogICBtYXkgbm90IGJlIHRocmVhZC1zYWZlLgogICAqLwogIGxldCB2aXJnaW4gPSB0cnVlOwoKICBsZXQgbGVuZml4LCBkaXN0Zml4OyAvLyBXZSBoYXZlIG5vIHBvaW50ZXJzIGluIEpTLCBzbyBrZWVwIHRhYmxlcyBzZXBhcmF0ZQoKCiAgY29uc3QgZml4ZWR0YWJsZXMgPSAoc3RhdGUpID0+IHsKCiAgICAvKiBidWlsZCBmaXhlZCBodWZmbWFuIHRhYmxlcyBpZiBmaXJzdCBjYWxsIChtYXkgbm90IGJlIHRocmVhZCBzYWZlKSAqLwogICAgaWYgKHZpcmdpbikgewogICAgICBsZW5maXggPSBuZXcgSW50MzJBcnJheSg1MTIpOwogICAgICBkaXN0Zml4ID0gbmV3IEludDMyQXJyYXkoMzIpOwoKICAgICAgLyogbGl0ZXJhbC9sZW5ndGggdGFibGUgKi8KICAgICAgbGV0IHN5bSA9IDA7CiAgICAgIHdoaWxlIChzeW0gPCAxNDQpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyNTYpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA5OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODApIHsgc3RhdGUubGVuc1tzeW0rK10gPSA3OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODgpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CgogICAgICBpbmZ0cmVlcyhMRU5TLCAgc3RhdGUubGVucywgMCwgMjg4LCBsZW5maXgsICAgMCwgc3RhdGUud29yaywgeyBiaXRzOiA5IH0pOwoKICAgICAgLyogZGlzdGFuY2UgdGFibGUgKi8KICAgICAgc3ltID0gMDsKICAgICAgd2hpbGUgKHN5bSA8IDMyKSB7IHN0YXRlLmxlbnNbc3ltKytdID0gNTsgfQoKICAgICAgaW5mdHJlZXMoRElTVFMsIHN0YXRlLmxlbnMsIDAsIDMyLCAgIGRpc3RmaXgsIDAsIHN0YXRlLndvcmssIHsgYml0czogNSB9KTsKCiAgICAgIC8qIGRvIHRoaXMganVzdCBvbmNlICovCiAgICAgIHZpcmdpbiA9IGZhbHNlOwogICAgfQoKICAgIHN0YXRlLmxlbmNvZGUgPSBsZW5maXg7CiAgICBzdGF0ZS5sZW5iaXRzID0gOTsKICAgIHN0YXRlLmRpc3Rjb2RlID0gZGlzdGZpeDsKICAgIHN0YXRlLmRpc3RiaXRzID0gNTsKICB9OwoKCiAgLyoKICAgVXBkYXRlIHRoZSB3aW5kb3cgd2l0aCB0aGUgbGFzdCB3c2l6ZSAobm9ybWFsbHkgMzJLKSBieXRlcyB3cml0dGVuIGJlZm9yZQogICByZXR1cm5pbmcuICBJZiB3aW5kb3cgZG9lcyBub3QgZXhpc3QgeWV0LCBjcmVhdGUgaXQuICBUaGlzIGlzIG9ubHkgY2FsbGVkCiAgIHdoZW4gYSB3aW5kb3cgaXMgYWxyZWFkeSBpbiB1c2UsIG9yIHdoZW4gb3V0cHV0IGhhcyBiZWVuIHdyaXR0ZW4gZHVyaW5nIHRoaXMKICAgaW5mbGF0ZSBjYWxsLCBidXQgdGhlIGVuZCBvZiB0aGUgZGVmbGF0ZSBzdHJlYW0gaGFzIG5vdCBiZWVuIHJlYWNoZWQgeWV0LgogICBJdCBpcyBhbHNvIGNhbGxlZCB0byBjcmVhdGUgYSB3aW5kb3cgZm9yIGRpY3Rpb25hcnkgZGF0YSB3aGVuIGEgZGljdGlvbmFyeQogICBpcyBsb2FkZWQuCgogICBQcm92aWRpbmcgb3V0cHV0IGJ1ZmZlcnMgbGFyZ2VyIHRoYW4gMzJLIHRvIGluZmxhdGUoKSBzaG91bGQgcHJvdmlkZSBhIHNwZWVkCiAgIGFkdmFudGFnZSwgc2luY2Ugb25seSB0aGUgbGFzdCAzMksgb2Ygb3V0cHV0IGlzIGNvcGllZCB0byB0aGUgc2xpZGluZyB3aW5kb3cKICAgdXBvbiByZXR1cm4gZnJvbSBpbmZsYXRlKCksIGFuZCBzaW5jZSBhbGwgZGlzdGFuY2VzIGFmdGVyIHRoZSBmaXJzdCAzMksgb2YKICAgb3V0cHV0IHdpbGwgZmFsbCBpbiB0aGUgb3V0cHV0IGRhdGEsIG1ha2luZyBtYXRjaCBjb3BpZXMgc2ltcGxlciBhbmQgZmFzdGVyLgogICBUaGUgYWR2YW50YWdlIG1heSBiZSBkZXBlbmRlbnQgb24gdGhlIHNpemUgb2YgdGhlIHByb2Nlc3NvcidzIGRhdGEgY2FjaGVzLgogICAqLwogIGNvbnN0IHVwZGF0ZXdpbmRvdyA9IChzdHJtLCBzcmMsIGVuZCwgY29weSkgPT4gewoKICAgIGxldCBkaXN0OwogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGlmIGl0IGhhc24ndCBiZWVuIGRvbmUgYWxyZWFkeSwgYWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB3aW5kb3cgKi8KICAgIGlmIChzdGF0ZS53aW5kb3cgPT09IG51bGwpIHsKICAgICAgc3RhdGUud3NpemUgPSAxIDw8IHN0YXRlLndiaXRzOwogICAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICAgIHN0YXRlLndoYXZlID0gMDsKCiAgICAgIHN0YXRlLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHN0YXRlLndzaXplKTsKICAgIH0KCiAgICAvKiBjb3B5IHN0YXRlLT53c2l6ZSBvciBsZXNzIG91dHB1dCBieXRlcyBpbnRvIHRoZSBjaXJjdWxhciB3aW5kb3cgKi8KICAgIGlmIChjb3B5ID49IHN0YXRlLndzaXplKSB7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIHN0YXRlLndzaXplLCBlbmQpLCAwKTsKICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgfQogICAgZWxzZSB7CiAgICAgIGRpc3QgPSBzdGF0ZS53c2l6ZSAtIHN0YXRlLnduZXh0OwogICAgICBpZiAoZGlzdCA+IGNvcHkpIHsKICAgICAgICBkaXN0ID0gY29weTsKICAgICAgfQogICAgICAvL3ptZW1jcHkoc3RhdGUtPndpbmRvdyArIHN0YXRlLT53bmV4dCwgZW5kIC0gY29weSwgZGlzdCk7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCAtIGNvcHkgKyBkaXN0KSwgc3RhdGUud25leHQpOwogICAgICBjb3B5IC09IGRpc3Q7CiAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgLy96bWVtY3B5KHN0YXRlLT53aW5kb3csIGVuZCAtIGNvcHksIGNvcHkpOwogICAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCksIDApOwogICAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHN0YXRlLnduZXh0ICs9IGRpc3Q7CiAgICAgICAgaWYgKHN0YXRlLnduZXh0ID09PSBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53bmV4dCA9IDA7IH0KICAgICAgICBpZiAoc3RhdGUud2hhdmUgPCBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53aGF2ZSArPSBkaXN0OyB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAwOwogIH07CgoKICBjb25zdCBpbmZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgc3RhdGU7CiAgICBsZXQgaW5wdXQsIG91dHB1dDsgICAgICAgICAgLy8gaW5wdXQvb3V0cHV0IGJ1ZmZlcnMKICAgIGxldCBuZXh0OyAgICAgICAgICAgICAgICAgICAvKiBuZXh0IGlucHV0IElOREVYICovCiAgICBsZXQgcHV0OyAgICAgICAgICAgICAgICAgICAgLyogbmV4dCBvdXRwdXQgSU5ERVggKi8KICAgIGxldCBoYXZlLCBsZWZ0OyAgICAgICAgICAgICAvKiBhdmFpbGFibGUgaW5wdXQgYW5kIG91dHB1dCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGJpdCBidWZmZXIgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgICAvKiBiaXRzIGluIGJpdCBidWZmZXIgKi8KICAgIGxldCBfaW4sIF9vdXQ7ICAgICAgICAgICAgICAvKiBzYXZlIHN0YXJ0aW5nIGF2YWlsYWJsZSBpbnB1dCBhbmQgb3V0cHV0ICovCiAgICBsZXQgY29weTsgICAgICAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIHN0b3JlZCBvciBtYXRjaCBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgZnJvbTsgICAgICAgICAgICAgICAgICAgLyogd2hlcmUgdG8gY29weSBtYXRjaCBieXRlcyBmcm9tICovCiAgICBsZXQgZnJvbV9zb3VyY2U7CiAgICBsZXQgaGVyZSA9IDA7ICAgICAgICAgICAgICAgLyogY3VycmVudCBkZWNvZGluZyB0YWJsZSBlbnRyeSAqLwogICAgbGV0IGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7IC8vIHBha2VkICJoZXJlIiBkZW5vcm1hbGl6ZWQgKEpTIHNwZWNpZmljKQogICAgLy9sZXQgbGFzdDsgICAgICAgICAgICAgICAgICAgLyogcGFyZW50IHRhYmxlIGVudHJ5ICovCiAgICBsZXQgbGFzdF9iaXRzLCBsYXN0X29wLCBsYXN0X3ZhbDsgLy8gcGFrZWQgImxhc3QiIGRlbm9ybWFsaXplZCAoSlMgc3BlY2lmaWMpCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIHRvIGNvcHkgZm9yIHJlcGVhdHMsIGJpdHMgdG8gZHJvcCAqLwogICAgbGV0IHJldDsgICAgICAgICAgICAgICAgICAgIC8qIHJldHVybiBjb2RlICovCiAgICBjb25zdCBoYnVmID0gbmV3IFVpbnQ4QXJyYXkoNCk7ICAgIC8qIGJ1ZmZlciBmb3IgZ3ppcCBoZWFkZXIgY3JjIGNhbGN1bGF0aW9uICovCiAgICBsZXQgb3B0czsKCiAgICBsZXQgbjsgLy8gdGVtcG9yYXJ5IHZhcmlhYmxlIGZvciBORUVEX0JJVFMKCiAgICBjb25zdCBvcmRlciA9IC8qIHBlcm11dGF0aW9uIG9mIGNvZGUgbGVuZ3RocyAqLwogICAgICBuZXcgVWludDhBcnJheShbIDE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTUgXSk7CgoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCAhc3RybS5vdXRwdXQgfHwKICAgICAgICAoIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsgc3RhdGUubW9kZSA9IFRZUEVETzsgfSAgICAvKiBza2lwIGNoZWNrICovCgoKICAgIC8vLS0tIExPQUQoKSAtLS0KICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgYml0cyA9IHN0YXRlLmJpdHM7CiAgICAvLy0tLQoKICAgIF9pbiA9IGhhdmU7CiAgICBfb3V0ID0gbGVmdDsKICAgIHJldCA9IFpfT0skMTsKCiAgICBpbmZfbGVhdmU6IC8vIGdvdG8gZW11bGF0aW9uCiAgICBmb3IgKDs7KSB7CiAgICAgIHN3aXRjaCAoc3RhdGUubW9kZSkgewogICAgICAgIGNhc2UgSEVBRDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwID09PSAwKSB7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFRE87CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTYpOwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKChzdGF0ZS53cmFwICYgMikgJiYgaG9sZCA9PT0gMHg4YjFmKSB7ICAvKiBnemlwIGhlYWRlciAqLwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IDAvKmNyYzMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICAgIC8vPT09IENSQzIoc3RhdGUuY2hlY2ssIGhvbGQpOwogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICAvLz09PS8vCgogICAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IEZMQUdTOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmZsYWdzID0gMDsgICAgICAgICAgIC8qIGV4cGVjdCB6bGliIGhlYWRlciAqLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5kb25lID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIShzdGF0ZS53cmFwICYgMSkgfHwgICAvKiBjaGVjayBpZiB6bGliIGhlYWRlciBhbGxvd2VkICovCiAgICAgICAgICAgICgoKGhvbGQgJiAweGZmKS8qQklUUyg4KSovIDw8IDgpICsgKGhvbGQgPj4gOCkpICUgMzEpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGhlYWRlciBjaGVjayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKChob2xkICYgMHgwZikvKkJJVFMoNCkqLyAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoNCkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSA0OwogICAgICAgICAgYml0cyAtPSA0OwogICAgICAgICAgLy8tLS0vLwogICAgICAgICAgbGVuID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgODsKICAgICAgICAgIGlmIChzdGF0ZS53Yml0cyA9PT0gMCkgewogICAgICAgICAgICBzdGF0ZS53Yml0cyA9IGxlbjsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGxlbiA+IHN0YXRlLndiaXRzKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgd2luZG93IHNpemUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyAhISEgcGFrbyBwYXRjaC4gRm9yY2UgdXNlIGBvcHRpb25zLndpbmRvd0JpdHNgIGlmIHBhc3NlZC4KICAgICAgICAgIC8vIFJlcXVpcmVkIHRvIGFsd2F5cyB1c2UgbWF4IHdpbmRvdyBzaXplIGJ5IGRlZmF1bHQuCiAgICAgICAgICBzdGF0ZS5kbWF4ID0gMSA8PCBzdGF0ZS53Yml0czsKICAgICAgICAgIC8vc3RhdGUuZG1heCA9IDEgPDwgbGVuOwoKICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIHpsaWIgaGVhZGVyIG9rXG4iKSk7CiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSAxLyphZGxlcjMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICBzdGF0ZS5tb2RlID0gaG9sZCAmIDB4MjAwID8gRElDVElEIDogVFlQRTsKICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBGTEFHUzoKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDE2KTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLmZsYWdzID0gaG9sZDsKICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgJiAweGZmKSAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHhlMDAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ3Vua25vd24gaGVhZGVyIGZsYWdzIHNldCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50ZXh0ID0gKChob2xkID4+IDgpICYgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMHhmZjsKICAgICAgICAgICAgaGJ1ZlsxXSA9IChob2xkID4+PiA4KSAmIDB4ZmY7CiAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IFRJTUU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMzIpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50aW1lID0gaG9sZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkM0KHN0YXRlLmNoZWNrLCBob2xkKQogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBoYnVmWzJdID0gKGhvbGQgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbM10gPSAoaG9sZCA+Pj4gMjQpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCA0LCAwKTsKICAgICAgICAgICAgLy89PT0KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IE9TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgT1M6CiAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLnhmbGFncyA9IChob2xkICYgMHhmZik7CiAgICAgICAgICAgIHN0YXRlLmhlYWQub3MgPSAoaG9sZCA+PiA4KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkMyKHN0YXRlLmNoZWNrLCBob2xkKTsKICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWExFTjoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZDsKICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhX2xlbiA9IGhvbGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhID0gbnVsbC8qWl9OVUxMKi87CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhUUkE7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWFRSQToKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICBpZiAoY29weSA+IGhhdmUpIHsgY29weSA9IGhhdmU7IH0KICAgICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgbGVuID0gc3RhdGUuaGVhZC5leHRyYV9sZW4gLSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmhlYWQuZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgLy8gVXNlIHVudHlwZWQgYXJyYXkgZm9yIG1vcmUgY29udmVuaWVudCBwcm9jZXNzaW5nIGxhdGVyCiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheShzdGF0ZS5oZWFkLmV4dHJhX2xlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhLnNldCgKICAgICAgICAgICAgICAgICAgaW5wdXQuc3ViYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgbmV4dCwKICAgICAgICAgICAgICAgICAgICAvLyBleHRyYSBmaWVsZCBpcyBsaW1pdGVkIHRvIDY1NTM2IGJ5dGVzCiAgICAgICAgICAgICAgICAgICAgLy8gLSBubyBuZWVkIGZvciBhZGRpdGlvbmFsIHNpemUgY2hlY2sKICAgICAgICAgICAgICAgICAgICBuZXh0ICsgY29weQogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAvKmxlbiArIGNvcHkgPiBzdGF0ZS5oZWFkLmV4dHJhX21heCAtIGxlbiA/IHN0YXRlLmhlYWQuZXh0cmFfbWF4IDogY29weSwqLwogICAgICAgICAgICAgICAgICBsZW4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAvL3ptZW1jcHkoc3RhdGUuaGVhZC5leHRyYSArIGxlbiwgbmV4dCwKICAgICAgICAgICAgICAgIC8vICAgICAgICBsZW4gKyBjb3B5ID4gc3RhdGUuaGVhZC5leHRyYV9tYXggPwogICAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmhlYWQuZXh0cmFfbWF4IC0gbGVuIDogY29weSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTkFNRTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIE5BTUU6CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDA4MDApIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGNvcHkgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgLy8gVE9ETzogMiBvciAxIGJ5dGVzPwogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQubmFtZV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGF2ZSAtPSBjb3B5OwogICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgIGlmIChsZW4pIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPTU1FTlQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgxMDAwKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQuY29tbV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGlucHV0LCBjb3B5LCBuZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgICAgaWYgKGxlbikgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5jb21tZW50ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm1vZGUgPSBIQ1JDOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgSENSQzoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgaWYgKGhvbGQgIT09IChzdGF0ZS5jaGVjayAmIDB4ZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdoZWFkZXIgY3JjIG1pc21hdGNoJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5oY3JjID0gKChzdGF0ZS5mbGFncyA+PiA5KSAmIDEpOwogICAgICAgICAgICBzdGF0ZS5oZWFkLmRvbmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBESUNUSUQ6CiAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElDVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJQ1Q6CiAgICAgICAgICBpZiAoc3RhdGUuaGF2ZWRpY3QgPT09IDApIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIHJldHVybiBaX05FRURfRElDVCQxOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMS8qYWRsZXIzMigwTCwgWl9OVUxMLCAwKSovOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgaWYgKGZsdXNoID09PSBaX0JMT0NLIHx8IGZsdXNoID09PSBaX1RSRUVTKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgaWYgKHN0YXRlLmxhc3QpIHsKICAgICAgICAgICAgLy8tLS0gQllURUJJVFMoKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gYml0cyAmIDc7CiAgICAgICAgICAgIGJpdHMgLT0gYml0cyAmIDc7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IENIRUNLOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5sYXN0ID0gKGhvbGQgJiAweDAxKS8qQklUUygxKSovOwogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMSkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSAxOwogICAgICAgICAgYml0cyAtPSAxOwogICAgICAgICAgLy8tLS0vLwoKICAgICAgICAgIHN3aXRjaCAoKGhvbGQgJiAweDAzKS8qQklUUygyKSovKSB7CiAgICAgICAgICAgIGNhc2UgMDogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHN0b3JlZCBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgc3RvcmVkIGJsb2NrJXNcbiIsCiAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmxhc3QgPyAiIChsYXN0KSIgOiAiIikpOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZpeGVkIGJsb2NrICovCiAgICAgICAgICAgICAgZml4ZWR0YWJsZXMoc3RhdGUpOwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZml4ZWQgY29kZXMgYmxvY2slc1xuIiwKICAgICAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGFzdCA/ICIgKGxhc3QpIiA6ICIiKSk7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87ICAgICAgICAgICAgIC8qIGRlY29kZSBjb2RlcyAqLwogICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMikgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZHluYW1pYyBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZHluYW1pYyBjb2RlcyBibG9jayVzXG4iLAogICAgICAgICAgICAgIC8vICAgICAgICBzdGF0ZS5sYXN0ID8gIiAobGFzdCkiIDogIiIpKTsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVEFCTEU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGJsb2NrIHR5cGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICB9CiAgICAgICAgICAvLy0tLSBEUk9QQklUUygyKSAtLS0vLwogICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICBiaXRzIC09IDI7CiAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNUT1JFRDoKICAgICAgICAgIC8vLS0tIEJZVEVCSVRTKCkgLS0tLy8gLyogZ28gdG8gYnl0ZSBib3VuZGFyeSAqLwogICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgYml0cyAtPSBiaXRzICYgNzsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIGlmICgoaG9sZCAmIDB4ZmZmZikgIT09ICgoaG9sZCA+Pj4gMTYpIF4gMHhmZmZmKSkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIHN0b3JlZCBibG9jayBsZW5ndGhzJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkICYgMHhmZmZmOwogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHN0b3JlZCBsZW5ndGggJXVcbiIsCiAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZXzsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIENPUFlfOgogICAgICAgICAgc3RhdGUubW9kZSA9IENPUFk7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT1BZOgogICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgeyBjb3B5ID0gaGF2ZTsgfQogICAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgICAgaWYgKGNvcHkgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIC8vLS0tIHptZW1jcHkocHV0LCBuZXh0LCBjb3B5KTsgLS0tCiAgICAgICAgICAgIG91dHB1dC5zZXQoaW5wdXQuc3ViYXJyYXkobmV4dCwgbmV4dCArIGNvcHkpLCBwdXQpOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICBsZWZ0IC09IGNvcHk7CiAgICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgc3RvcmVkIGVuZFxuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTQpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNCkgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubmxlbiA9IChob2xkICYgMHgxZikvKkJJVFMoNSkqLyArIDI1NzsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5kaXN0ID0gKGhvbGQgJiAweDFmKS8qQklUUyg1KSovICsgMTsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5jb2RlID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgNDsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDQpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgIC8vLS0tLy8KICAvLyNpZm5kZWYgUEtaSVBfQlVHX1dPUktBUk9VTkQKICAgICAgICAgIGlmIChzdGF0ZS5ubGVuID4gMjg2IHx8IHN0YXRlLm5kaXN0ID4gMzApIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAndG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAvLyNlbmRpZgogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHRhYmxlIHNpemVzIG9rXG4iKSk7CiAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5MRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgc3RhdGUubmNvZGUpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoMyk7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMykgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5zW29yZGVyW3N0YXRlLmhhdmUrK11dID0gKGhvbGQgJiAweDA3KTsvL0JJVFMoMyk7CiAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgMTkpIHsKICAgICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBXZSBoYXZlIHNlcGFyYXRlIHRhYmxlcyAmIG5vIHBvaW50ZXJzLiAyIGNvbW1lbnRlZCBsaW5lcyBiZWxvdyBub3QgbmVlZGVkLgogICAgICAgICAgLy9zdGF0ZS5uZXh0ID0gc3RhdGUuY29kZXM7CiAgICAgICAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwogICAgICAgICAgLy8gU3dpdGNoIHRvIHVzZSBkeW5hbWljIHRhYmxlCiAgICAgICAgICBzdGF0ZS5sZW5jb2RlID0gc3RhdGUubGVuZHluOwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IDc7CgogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUubGVuYml0cyB9OwogICAgICAgICAgcmV0ID0gaW5mdHJlZXMoQ09ERVMsIHN0YXRlLmxlbnMsIDAsIDE5LCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICBjb2RlIGxlbmd0aHMgb2tcbiIpKTsKICAgICAgICAgIHN0YXRlLmhhdmUgPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPREVMRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgQ09ERUxFTlM6CiAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUubGVuYml0cykqLwogICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgICAgIGlmICgoaGVyZV9iaXRzKSA8PSBiaXRzKSB7IGJyZWFrOyB9CiAgICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA8IDE2KSB7CiAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoaGVyZS5iaXRzKSAtLS0vLwogICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGhlcmVfdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKGhlcmUuYml0cyArIDIpOwogICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDI7CiAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgYml0IGxlbmd0aCByZXBlYXQnOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSAtIDFdOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDMpOy8vQklUUygyKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDIpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoaGVyZV92YWwgPT09IDE3KSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyAzKTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyAzOwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDcpOy8vQklUUygzKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMzsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyA3KTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyA3OwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDExICsgKGhvbGQgJiAweDdmKTsvL0JJVFMoNyk7CiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyg3KSAtLS0vLwogICAgICAgICAgICAgICAgaG9sZCA+Pj49IDc7CiAgICAgICAgICAgICAgICBiaXRzIC09IDc7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlICsgY29weSA+IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCc7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlIChjb3B5LS0pIHsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGxlbjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYW5kbGUgZXJyb3IgYnJlYWtzIGluIHdoaWxlICovCiAgICAgICAgICBpZiAoc3RhdGUubW9kZSA9PT0gQkFEKSB7IGJyZWFrOyB9CgogICAgICAgICAgLyogY2hlY2sgZm9yIGVuZC1vZi1ibG9jayBjb2RlIChiZXR0ZXIgaGF2ZSBvbmUpICovCiAgICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgY29kZSAtLSBtaXNzaW5nIGVuZC1vZi1ibG9jayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIC8qIGJ1aWxkIGNvZGUgdGFibGVzIC0tIG5vdGU6IGRvIG5vdCBjaGFuZ2UgdGhlIGxlbmJpdHMgb3IgZGlzdGJpdHMKICAgICAgICAgICAgIHZhbHVlcyBoZXJlICg5IGFuZCA2KSB3aXRob3V0IHJlYWRpbmcgdGhlIGNvbW1lbnRzIGluIGluZnRyZWVzLmgKICAgICAgICAgICAgIGNvbmNlcm5pbmcgdGhlIEVOT1VHSCBjb25zdGFudHMsIHdoaWNoIGRlcGVuZCBvbiB0aG9zZSB2YWx1ZXMgKi8KICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwoKICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKExFTlMsIHN0YXRlLmxlbnMsIDAsIHN0YXRlLm5sZW4sIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IG9wdHMuYml0czsKICAgICAgICAgIC8vIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwoKICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aHMgc2V0JzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgLy9zdGF0ZS5kaXN0Y29kZS5jb3B5KHN0YXRlLmNvZGVzKTsKICAgICAgICAgIC8vIFN3aXRjaCB0byB1c2UgZHluYW1pYyB0YWJsZQogICAgICAgICAgc3RhdGUuZGlzdGNvZGUgPSBzdGF0ZS5kaXN0ZHluOwogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUuZGlzdGJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKERJU1RTLCBzdGF0ZS5sZW5zLCBzdGF0ZS5ubGVuLCBzdGF0ZS5uZGlzdCwgc3RhdGUuZGlzdGNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAvLyBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQ7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlcyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICdpbmZsYXRlOiAgICAgICBjb2RlcyBva1xuJykpOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87CiAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5fOgogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTjoKICAgICAgICAgIGlmIChoYXZlID49IDYgJiYgbGVmdCA+PSAyNTgpIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIGluZmZhc3Qoc3RybSwgX291dCk7CiAgICAgICAgICAgIC8vLS0tIExPQUQoKSAtLS0KICAgICAgICAgICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgICAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgICAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgICAgICAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgICAgICAgICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICAgICAgICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgICAgICAgICAvLy0tLQoKICAgICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5iYWNrID0gMDsKICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsgIC8qQklUUyhzdGF0ZS5sZW5iaXRzKSovCiAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICBoZXJlX29wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYmIChoZXJlX29wICYgMHhmMCkgPT09IDApIHsKICAgICAgICAgICAgbGFzdF9iaXRzID0gaGVyZV9iaXRzOwogICAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgc3RhdGUubGVuZ3RoID0gaGVyZV92YWw7CiAgICAgICAgICBpZiAoaGVyZV9vcCA9PT0gMCkgewogICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAnJWMnXG4iIDoKICAgICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgMHglMDJ4XG4iLCBoZXJlLnZhbCkpOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTElUOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgMzIpIHsKICAgICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5FWFQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5FWFQ6CiAgICAgICAgICBpZiAoc3RhdGUuZXh0cmEpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoc3RhdGUuZXh0cmEpOwogICAgICAgICAgICBuID0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggKz0gaG9sZCAmICgoMSA8PCBzdGF0ZS5leHRyYSkgLSAxKS8qQklUUyhzdGF0ZS5leHRyYSkqLzsKICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoc3RhdGUuZXh0cmEpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgfQogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGxlbmd0aCAldVxuIiwgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICBzdGF0ZS53YXMgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElTVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJU1Q6CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtob2xkICYgKCgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUuZGlzdGJpdHMpKi8KICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgMHhmZmZmOwoKICAgICAgICAgICAgaWYgKChoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGhlcmVfb3AgJiAweGYwKSA9PT0gMCkgewogICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGxhc3Rfb3AgPSBoZXJlX29wOwogICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmRpc3Rjb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgaWYgKGhlcmVfb3AgJiA2NCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm9mZnNldCA9IGhlcmVfdmFsOwogICAgICAgICAgc3RhdGUuZXh0cmEgPSAoaGVyZV9vcCkgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBESVNURVhUOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUyhzdGF0ZS5leHRyYSk7CiAgICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIHN0YXRlLm9mZnNldCArPSBob2xkICYgKCgxIDw8IHN0YXRlLmV4dHJhKSAtIDEpLypCSVRTKHN0YXRlLmV4dHJhKSovOwogICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhzdGF0ZS5leHRyYSkgLS0tLy8KICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICBiaXRzIC09IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gc3RhdGUuZXh0cmE7CiAgICAgICAgICB9CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBzdGF0ZS5kbWF4KSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgICBkaXN0YW5jZSAldVxuIiwgc3RhdGUub2Zmc2V0KSk7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTUFUQ0g7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBNQVRDSDoKICAgICAgICAgIGlmIChsZWZ0ID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgY29weSA9IF9vdXQgLSBsZWZ0OwogICAgICAgICAgaWYgKHN0YXRlLm9mZnNldCA+IGNvcHkpIHsgICAgICAgICAvKiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5vZmZzZXQgLSBjb3B5OwogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLndoYXZlKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgLy8gKCEpIFRoaXMgYmxvY2sgaXMgZGlzYWJsZWQgaW4gemxpYiBkZWZhdWx0cywKICAvLyBkb24ndCBlbmFibGUgaXQgZm9yIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy8jaWZkZWYgSU5GTEFURV9BTExPV19JTlZBTElEX0RJU1RBTkNFX1RPT0ZBUl9BUlJSCiAgLy8gICAgICAgICAgVHJhY2UoKHN0ZGVyciwgImluZmxhdGUuYyB0b28gZmFyXG4iKSk7CiAgLy8gICAgICAgICAgY29weSAtPSBzdGF0ZS53aGF2ZTsKICAvLyAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgeyBjb3B5ID0gc3RhdGUubGVuZ3RoOyB9CiAgLy8gICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9CiAgLy8gICAgICAgICAgbGVmdCAtPSBjb3B5OwogIC8vICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogIC8vICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgIG91dHB1dFtwdXQrK10gPSAwOwogIC8vICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgLy8gICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgeyBzdGF0ZS5tb2RlID0gTEVOOyB9CiAgLy8gICAgICAgICAgYnJlYWs7CiAgLy8jZW5kaWYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLnduZXh0KSB7CiAgICAgICAgICAgICAgY29weSAtPSBzdGF0ZS53bmV4dDsKICAgICAgICAgICAgICBmcm9tID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZyb20gPSBzdGF0ZS53bmV4dCAtIGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS5sZW5ndGgpIHsgY29weSA9IHN0YXRlLmxlbmd0aDsgfQogICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHN0YXRlLndpbmRvdzsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGNvcHkgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgIGZyb20gPSBwdXQgLSBzdGF0ZS5vZmZzZXQ7CiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgZG8gewogICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSB7IHN0YXRlLm1vZGUgPSBMRU47IH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTElUOgogICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBvdXRwdXRbcHV0KytdID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgbGVmdC0tOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgICBpZiAoc3RhdGUud3JhcCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgLy8gVXNlICd8JyBpbnN0ZWFkIG9mICcrJyB0byBtYWtlIHN1cmUgdGhhdCByZXN1bHQgaXMgc2lnbmVkCiAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgX291dCAtPSBsZWZ0OwogICAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgICBzdGF0ZS50b3RhbCArPSBfb3V0OwogICAgICAgICAgICBpZiAoX291dCkgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9CiAgICAgICAgICAgICAgICAgIC8qVVBEQVRFKHN0YXRlLmNoZWNrLCBwdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgICAgICAgICAgICAoc3RhdGUuZmxhZ3MgPyBjcmMzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX291dCA9IGxlZnQ7CiAgICAgICAgICAgIC8vIE5COiBjcmMzMiBzdG9yZWQgYXMgc2lnbmVkIDMyLWJpdCBpbnQsIHpzd2FwMzIgcmV0dXJucyBzaWduZWQgdG9vCiAgICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgPyBob2xkIDogenN3YXAzMihob2xkKSkgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGRhdGEgY2hlY2snOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIGNoZWNrIG1hdGNoZXMgdHJhaWxlclxuIikpOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUubW9kZSA9IExFTkdUSDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTkdUSDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYmIHN0YXRlLmZsYWdzKSB7CiAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBpZiAoaG9sZCAhPT0gKHN0YXRlLnRvdGFsICYgMHhmZmZmZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBsZW5ndGggbWF0Y2hlcyB0cmFpbGVyXG4iKSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRE9ORTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERPTkU6CiAgICAgICAgICByZXQgPSBaX1NUUkVBTV9FTkQkMTsKICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICBjYXNlIEJBRDoKICAgICAgICAgIHJldCA9IFpfREFUQV9FUlJPUiQxOwogICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgIGNhc2UgTUVNOgogICAgICAgICAgcmV0dXJuIFpfTUVNX0VSUk9SJDE7CiAgICAgICAgY2FzZSBTWU5DOgogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgICAgfQogICAgfQoKICAgIC8vIGluZl9sZWF2ZSA8LSBoZXJlIGlzIHJlYWwgcGxhY2UgZm9yICJnb3RvIGluZl9sZWF2ZSIsIGVtdWxhdGVkIHZpYSAiYnJlYWsgaW5mX2xlYXZlIgoKICAgIC8qCiAgICAgICBSZXR1cm4gZnJvbSBpbmZsYXRlKCksIHVwZGF0aW5nIHRoZSB0b3RhbCBjb3VudHMgYW5kIHRoZSBjaGVjayB2YWx1ZS4KICAgICAgIElmIHRoZXJlIHdhcyBubyBwcm9ncmVzcyBkdXJpbmcgdGhlIGluZmxhdGUoKSBjYWxsLCByZXR1cm4gYSBidWZmZXIKICAgICAgIGVycm9yLiAgQ2FsbCB1cGRhdGV3aW5kb3coKSB0byBjcmVhdGUgYW5kL29yIHVwZGF0ZSB0aGUgd2luZG93IHN0YXRlLgogICAgICAgTm90ZTogYSBtZW1vcnkgZXJyb3IgZnJvbSBpbmZsYXRlKCkgaXMgbm9uLXJlY292ZXJhYmxlLgogICAgICovCgogICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAvLy0tLQoKICAgIGlmIChzdGF0ZS53c2l6ZSB8fCAoX291dCAhPT0gc3RybS5hdmFpbF9vdXQgJiYgc3RhdGUubW9kZSA8IEJBRCAmJgogICAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA8IENIRUNLIHx8IGZsdXNoICE9PSBaX0ZJTklTSCQxKSkpIHsKICAgICAgaWYgKHVwZGF0ZXdpbmRvdyhzdHJtLCBzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCwgX291dCAtIHN0cm0uYXZhaWxfb3V0KSkgOwogICAgfQogICAgX2luIC09IHN0cm0uYXZhaWxfaW47CiAgICBfb3V0IC09IHN0cm0uYXZhaWxfb3V0OwogICAgc3RybS50b3RhbF9pbiArPSBfaW47CiAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgc3RhdGUudG90YWwgKz0gX291dDsKICAgIGlmIChzdGF0ZS53cmFwICYmIF9vdXQpIHsKICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gLypVUERBVEUoc3RhdGUuY2hlY2ssIHN0cm0ubmV4dF9vdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgIChzdGF0ZS5mbGFncyA/IGNyYzMyXzEoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgc3RybS5uZXh0X291dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHN0cm0ubmV4dF9vdXQgLSBfb3V0KSk7CiAgICB9CiAgICBzdHJtLmRhdGFfdHlwZSA9IHN0YXRlLmJpdHMgKyAoc3RhdGUubGFzdCA/IDY0IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLm1vZGUgPT09IFRZUEUgPyAxMjggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA9PT0gTEVOXyB8fCBzdGF0ZS5tb2RlID09PSBDT1BZXyA/IDI1NiA6IDApOwogICAgaWYgKCgoX2luID09PSAwICYmIF9vdXQgPT09IDApIHx8IGZsdXNoID09PSBaX0ZJTklTSCQxKSAmJiByZXQgPT09IFpfT0skMSkgewogICAgICByZXQgPSBaX0JVRl9FUlJPUjsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVFbmQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSAvKnx8IHN0cm0tPnpmcmVlID09IChmcmVlX2Z1bmMpMCovKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQoKICAgIGxldCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBpZiAoc3RhdGUud2luZG93KSB7CiAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICB9CiAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgIHJldHVybiBaX09LJDE7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVHZXRIZWFkZXIgPSAoc3RybSwgaGVhZCkgPT4gewoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIGlmICgoc3RhdGUud3JhcCAmIDIpID09PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CgogICAgLyogc2F2ZSBoZWFkZXIgc3RydWN0dXJlICovCiAgICBzdGF0ZS5oZWFkID0gaGVhZDsKICAgIGhlYWQuZG9uZSA9IGZhbHNlOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewogICAgY29uc3QgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwoKICAgIGxldCBzdGF0ZTsKICAgIGxldCBkaWN0aWQ7CiAgICBsZXQgcmV0OwoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gLyogPT0gWl9OVUxMICovIHx8ICFzdHJtLnN0YXRlIC8qID09IFpfTlVMTCAqLykgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIGlmIChzdGF0ZS53cmFwICE9PSAwICYmIHN0YXRlLm1vZGUgIT09IERJQ1QpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGNvcnJlY3QgZGljdGlvbmFyeSBpZGVudGlmaWVyICovCiAgICBpZiAoc3RhdGUubW9kZSA9PT0gRElDVCkgewogICAgICBkaWN0aWQgPSAxOyAvKiBhZGxlcjMyKDAsIG51bGwsIDApKi8KICAgICAgLyogZGljdGlkID0gYWRsZXIzMihkaWN0aWQsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBkaWN0aWQgPSBhZGxlcjMyXzEoZGljdGlkLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoLCAwKTsKICAgICAgaWYgKGRpY3RpZCAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgICByZXR1cm4gWl9EQVRBX0VSUk9SJDE7CiAgICAgIH0KICAgIH0KICAgIC8qIGNvcHkgZGljdGlvbmFyeSB0byB3aW5kb3cgdXNpbmcgdXBkYXRld2luZG93KCksIHdoaWNoIHdpbGwgYW1lbmQgdGhlCiAgICAgZXhpc3RpbmcgZGljdGlvbmFyeSBpZiBhcHByb3ByaWF0ZSAqLwogICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgaWYgKHJldCkgewogICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICByZXR1cm4gWl9NRU1fRVJST1IkMTsKICAgIH0KICAgIHN0YXRlLmhhdmVkaWN0ID0gMTsKICAgIC8vIFRyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBkaWN0aW9uYXJ5IHNldFxuIikpOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgdmFyIGluZmxhdGVSZXNldF8xID0gaW5mbGF0ZVJlc2V0OwogIHZhciBpbmZsYXRlUmVzZXQyXzEgPSBpbmZsYXRlUmVzZXQyOwogIHZhciBpbmZsYXRlUmVzZXRLZWVwXzEgPSBpbmZsYXRlUmVzZXRLZWVwOwogIHZhciBpbmZsYXRlSW5pdF8xID0gaW5mbGF0ZUluaXQ7CiAgdmFyIGluZmxhdGVJbml0Ml8xID0gaW5mbGF0ZUluaXQyOwogIHZhciBpbmZsYXRlXzIkMSA9IGluZmxhdGUkMjsKICB2YXIgaW5mbGF0ZUVuZF8xID0gaW5mbGF0ZUVuZDsKICB2YXIgaW5mbGF0ZUdldEhlYWRlcl8xID0gaW5mbGF0ZUdldEhlYWRlcjsKICB2YXIgaW5mbGF0ZVNldERpY3Rpb25hcnlfMSA9IGluZmxhdGVTZXREaWN0aW9uYXJ5OwogIHZhciBpbmZsYXRlSW5mbyA9ICdwYWtvIGluZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpJzsKCiAgLyogTm90IGltcGxlbWVudGVkCiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZUNvcHkgPSBpbmZsYXRlQ29weTsKICBtb2R1bGUuZXhwb3J0cy5pbmZsYXRlR2V0RGljdGlvbmFyeSA9IGluZmxhdGVHZXREaWN0aW9uYXJ5OwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVNYXJrID0gaW5mbGF0ZU1hcms7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVByaW1lID0gaW5mbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVTeW5jID0gaW5mbGF0ZVN5bmM7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVN5bmNQb2ludCA9IGluZmxhdGVTeW5jUG9pbnQ7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVVuZGVybWluZSA9IGluZmxhdGVVbmRlcm1pbmU7CiAgKi8KCiAgdmFyIGluZmxhdGVfMSQyID0gewogIAlpbmZsYXRlUmVzZXQ6IGluZmxhdGVSZXNldF8xLAogIAlpbmZsYXRlUmVzZXQyOiBpbmZsYXRlUmVzZXQyXzEsCiAgCWluZmxhdGVSZXNldEtlZXA6IGluZmxhdGVSZXNldEtlZXBfMSwKICAJaW5mbGF0ZUluaXQ6IGluZmxhdGVJbml0XzEsCiAgCWluZmxhdGVJbml0MjogaW5mbGF0ZUluaXQyXzEsCiAgCWluZmxhdGU6IGluZmxhdGVfMiQxLAogIAlpbmZsYXRlRW5kOiBpbmZsYXRlRW5kXzEsCiAgCWluZmxhdGVHZXRIZWFkZXI6IGluZmxhdGVHZXRIZWFkZXJfMSwKICAJaW5mbGF0ZVNldERpY3Rpb25hcnk6IGluZmxhdGVTZXREaWN0aW9uYXJ5XzEsCiAgCWluZmxhdGVJbmZvOiBpbmZsYXRlSW5mbwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBmdW5jdGlvbiBHWmhlYWRlcigpIHsKICAgIC8qIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQgKi8KICAgIHRoaXMudGV4dCAgICAgICA9IDA7CiAgICAvKiBtb2RpZmljYXRpb24gdGltZSAqLwogICAgdGhpcy50aW1lICAgICAgID0gMDsKICAgIC8qIGV4dHJhIGZsYWdzIChub3QgdXNlZCB3aGVuIHdyaXRpbmcgYSBnemlwIGZpbGUpICovCiAgICB0aGlzLnhmbGFncyAgICAgPSAwOwogICAgLyogb3BlcmF0aW5nIHN5c3RlbSAqLwogICAgdGhpcy5vcyAgICAgICAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gZXh0cmEgZmllbGQgb3IgWl9OVUxMIGlmIG5vbmUgKi8KICAgIHRoaXMuZXh0cmEgICAgICA9IG51bGw7CiAgICAvKiBleHRyYSBmaWVsZCBsZW5ndGggKHZhbGlkIGlmIGV4dHJhICE9IFpfTlVMTCkgKi8KICAgIHRoaXMuZXh0cmFfbGVuICA9IDA7IC8vIEFjdHVhbGx5LCB3ZSBkb24ndCBuZWVkIGl0IGluIEpTLAogICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGxlYXZlIGZvciBmZXcgY29kZSBtb2RpZmljYXRpb25zCgogICAgLy8KICAgIC8vIFNldHVwIGxpbWl0cyBpcyBub3QgbmVjZXNzYXJ5IGJlY2F1c2UgaW4ganMgd2Ugc2hvdWxkIG5vdCBwcmVhbGxvY2F0ZSBtZW1vcnkKICAgIC8vIGZvciBpbmZsYXRlIHVzZSBjb25zdGFudCBsaW1pdCBpbiA2NTUzNiBieXRlcwogICAgLy8KCiAgICAvKiBzcGFjZSBhdCBleHRyYSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5leHRyYV9tYXggID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGZpbGUgbmFtZSBvciBaX05VTEwgKi8KICAgIHRoaXMubmFtZSAgICAgICA9ICcnOwogICAgLyogc3BhY2UgYXQgbmFtZSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5uYW1lX21heCAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGNvbW1lbnQgb3IgWl9OVUxMICovCiAgICB0aGlzLmNvbW1lbnQgICAgPSAnJzsKICAgIC8qIHNwYWNlIGF0IGNvbW1lbnQgKG9ubHkgd2hlbiByZWFkaW5nIGhlYWRlcikgKi8KICAgIC8vIHRoaXMuY29tbV9tYXggICA9IDA7CiAgICAvKiB0cnVlIGlmIHRoZXJlIHdhcyBvciB3aWxsIGJlIGEgaGVhZGVyIGNyYyAqLwogICAgdGhpcy5oY3JjICAgICAgID0gMDsKICAgIC8qIHRydWUgd2hlbiBkb25lIHJlYWRpbmcgZ3ppcCBoZWFkZXIgKG5vdCB1c2VkIHdoZW4gd3JpdGluZyBhIGd6aXAgZmlsZSkgKi8KICAgIHRoaXMuZG9uZSAgICAgICA9IGZhbHNlOwogIH0KCiAgdmFyIGd6aGVhZGVyID0gR1poZWFkZXI7CgogIGNvbnN0IHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNILCBaX0ZJTklTSCwKICAgIFpfT0ssIFpfU1RSRUFNX0VORCwgWl9ORUVEX0RJQ1QsIFpfU1RSRUFNX0VSUk9SLCBaX0RBVEFfRVJST1IsIFpfTUVNX0VSUk9SCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgSW5mbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2luZmxhdGVdXQogICAqIGFuZCBbW2luZmxhdGVSYXddXS4KICAgKiovCgogIC8qIGludGVybmFsCiAgICogaW5mbGF0ZS5jaHVua3MgLT4gQXJyYXkKICAgKgogICAqIENodW5rcyBvZiBvdXRwdXQgZGF0YSwgaWYgW1tJbmZsYXRlI29uRGF0YV1dIG5vdCBvdmVycmlkZGVuLgogICAqKi8KCiAgLyoqCiAgICogSW5mbGF0ZS5yZXN1bHQgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKgogICAqIFVuY29tcHJlc3NlZCByZXN1bHQsIGdlbmVyYXRlZCBieSBkZWZhdWx0IFtbSW5mbGF0ZSNvbkRhdGFdXQogICAqIGFuZCBbW0luZmxhdGUjb25FbmRdXSBoYW5kbGVycy4gRmlsbGVkIGFmdGVyIHlvdSBwdXNoIGxhc3QgY2h1bmsKICAgKiAoY2FsbCBbW0luZmxhdGUjcHVzaF1dIHdpdGggYFpfRklOSVNIYCAvIGB0cnVlYCBwYXJhbSkuCiAgICoqLwoKICAvKioKICAgKiBJbmZsYXRlLmVyciAtPiBOdW1iZXIKICAgKgogICAqIEVycm9yIGNvZGUgYWZ0ZXIgaW5mbGF0ZSBmaW5pc2hlZC4gMCAoWl9PSykgb24gc3VjY2Vzcy4KICAgKiBTaG91bGQgYmUgY2hlY2tlZCBpZiBicm9rZW4gZGF0YSBwb3NzaWJsZS4KICAgKiovCgogIC8qKgogICAqIEluZmxhdGUubXNnIC0+IFN0cmluZwogICAqCiAgICogRXJyb3IgbWVzc2FnZSwgaWYgW1tJbmZsYXRlLmVycl1dICE9IDAKICAgKiovCgoKICAvKioKICAgKiBuZXcgSW5mbGF0ZShvcHRpb25zKQogICAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBpbmZsYXRlIG9wdGlvbnMuCiAgICoKICAgKiBDcmVhdGVzIG5ldyBpbmZsYXRvciBpbnN0YW5jZSB3aXRoIHNwZWNpZmllZCBwYXJhbXMuIFRocm93cyBleGNlcHRpb24KICAgKiBvbiBiYWQgcGFyYW1zLiBTdXBwb3J0ZWQgb3B0aW9uczoKICAgKgogICAqIC0gYHdpbmRvd0JpdHNgCiAgICogLSBgZGljdGlvbmFyeWAKICAgKgogICAqIFtodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWRdKGh0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZCkKICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZS4KICAgKgogICAqIEFkZGl0aW9uYWwgb3B0aW9ucywgZm9yIGludGVybmFsIG5lZWRzOgogICAqCiAgICogLSBgY2h1bmtTaXplYCAtIHNpemUgb2YgZ2VuZXJhdGVkIGRhdGEgY2h1bmtzICgxNksgYnkgZGVmYXVsdCkKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIGRvIHJhdyBpbmZsYXRlCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICogQnkgZGVmYXVsdCwgd2hlbiBubyBvcHRpb25zIHNldCwgYXV0b2RldGVjdCBkZWZsYXRlL2d6aXAgZGF0YSBmb3JtYXQgdmlhCiAgICogd3JhcHBlciBoZWFkZXIuCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJykKICAgKiBjb25zdCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqIGNvbnN0IGNodW5rMiA9IG5ldyBVaW50OEFycmF5KFsxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOV0pOwogICAqCiAgICogY29uc3QgaW5mbGF0ZSA9IG5ldyBwYWtvLkluZmxhdGUoeyBsZXZlbDogM30pOwogICAqCiAgICogaW5mbGF0ZS5wdXNoKGNodW5rMSwgZmFsc2UpOwogICAqIGluZmxhdGUucHVzaChjaHVuazIsIHRydWUpOyAgLy8gdHJ1ZSAtPiBsYXN0IGNodW5rCiAgICoKICAgKiBpZiAoaW5mbGF0ZS5lcnIpIHsgdGhyb3cgbmV3IEVycm9yKGluZmxhdGUuZXJyKTsgfQogICAqCiAgICogY29uc29sZS5sb2coaW5mbGF0ZS5yZXN1bHQpOwogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBJbmZsYXRlJDEob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gY29tbW9uLmFzc2lnbih7CiAgICAgIGNodW5rU2l6ZTogMTAyNCAqIDY0LAogICAgICB3aW5kb3dCaXRzOiAxNSwKICAgICAgdG86ICcnCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBjb25zdCBvcHQgPSB0aGlzLm9wdGlvbnM7CgogICAgLy8gRm9yY2Ugd2luZG93IHNpemUgZm9yIGByYXdgIGRhdGEsIGlmIG5vdCBzZXQgZGlyZWN0bHksCiAgICAvLyBiZWNhdXNlIHdlIGhhdmUgbm8gaGVhZGVyIGZvciBhdXRvZGV0ZWN0LgogICAgaWYgKG9wdC5yYXcgJiYgKG9wdC53aW5kb3dCaXRzID49IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyA9IC1vcHQud2luZG93Qml0czsKICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID09PSAwKSB7IG9wdC53aW5kb3dCaXRzID0gLTE1OyB9CiAgICB9CgogICAgLy8gSWYgYHdpbmRvd0JpdHNgIG5vdCBkZWZpbmVkIChhbmQgbW9kZSBub3QgcmF3KSAtIHNldCBhdXRvZGV0ZWN0IGZsYWcgZm9yIGd6aXAvZGVmbGF0ZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+PSAwKSAmJiAob3B0LndpbmRvd0JpdHMgPCAxNikgJiYKICAgICAgICAhKG9wdGlvbnMgJiYgb3B0aW9ucy53aW5kb3dCaXRzKSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAzMjsKICAgIH0KCiAgICAvLyBHemlwIGhlYWRlciBoYXMgbm8gaW5mbyBhYm91dCB3aW5kb3dzIHNpemUsIHdlIGNhbiBkbyBhdXRvZGV0ZWN0IG9ubHkKICAgIC8vIGZvciBkZWZsYXRlLiBTbywgaWYgd2luZG93IHNpemUgbm90IHNldCwgZm9yY2UgaXQgdG8gbWF4IHdoZW4gZ3ppcCBwb3NzaWJsZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+IDE1KSAmJiAob3B0LndpbmRvd0JpdHMgPCA0OCkpIHsKICAgICAgLy8gYml0IDMgKDE2KSAtPiBnemlwcGVkIGRhdGEKICAgICAgLy8gYml0IDQgKDMyKSAtPiBhdXRvZGV0ZWN0IGd6aXAvZGVmbGF0ZQogICAgICBpZiAoKG9wdC53aW5kb3dCaXRzICYgMTUpID09PSAwKSB7CiAgICAgICAgb3B0LndpbmRvd0JpdHMgfD0gMTU7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gICA9IG5ldyB6c3RyZWFtKCk7CiAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKCiAgICBsZXQgc3RhdHVzICA9IGluZmxhdGVfMSQyLmluZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQud2luZG93Qml0cwogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgIH0KCiAgICB0aGlzLmhlYWRlciA9IG5ldyBnemhlYWRlcigpOwoKICAgIGluZmxhdGVfMSQyLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlcik7CgogICAgLy8gU2V0dXAgZGljdGlvbmFyeQogICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IHN0cmluZ3Muc3RyaW5nMmJ1ZihvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IG5ldyBVaW50OEFycmF5KG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfQogICAgICBpZiAob3B0LnJhdykgeyAvL0luIHJhdyBtb2RlIHdlIG5lZWQgdG8gc2V0IHRoZSBkaWN0aW9uYXJ5IGVhcmx5CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gWl9PSykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogSW5mbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcik6IGlucHV0IGRhdGEKICAgKiAtIGZsdXNoX21vZGUgKE51bWJlcnxCb29sZWFuKTogMC4uNiBmb3IgY29ycmVzcG9uZGluZyBaX05PX0ZMVVNILi5aX1RSRUUKICAgKiAgIGZsdXNoIG1vZGVzLiBTZWUgY29uc3RhbnRzLiBTa2lwcGVkIG9yIGBmYWxzZWAgbWVhbnMgWl9OT19GTFVTSCwKICAgKiAgIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gaW5mbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbSW5mbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IG91dHB1dCBjaHVua3MuIFJldHVybnMgYHRydWVgIG9uIHN1Y2Nlc3MuIElmIGVuZCBvZiBzdHJlYW0gZGV0ZWN0ZWQsCiAgICogW1tJbmZsYXRlI29uRW5kXV0gd2lsbCBiZSBjYWxsZWQuCiAgICoKICAgKiBgZmx1c2hfbW9kZWAgaXMgbm90IG5lZWRlZCBmb3Igbm9ybWFsIG9wZXJhdGlvbiwgYmVjYXVzZSBlbmQgb2Ygc3RyZWFtCiAgICogZGV0ZWN0ZWQgYXV0b21hdGljYWxseS4gWW91IG1heSB0cnkgdG8gdXNlIGl0IGZvciBhZHZhbmNlZCB0aGluZ3MsIGJ1dAogICAqIHRoaXMgZnVuY3Rpb25hbGl0eSB3YXMgbm90IHRlc3RlZC4KICAgKgogICAqIE9uIGZhaWwgY2FsbCBbW0luZmxhdGUjb25FbmRdXSB3aXRoIGVycm9yIGNvZGUgYW5kIHJldHVybiBmYWxzZS4KICAgKgogICAqICMjIyMjIEV4YW1wbGUKICAgKgogICAqIGBgYGphdmFzY3JpcHQKICAgKiBwdXNoKGNodW5rLCBmYWxzZSk7IC8vIHB1c2ggb25lIG9mIGRhdGEgY2h1bmtzCiAgICogLi4uCiAgICogcHVzaChjaHVuaywgdHJ1ZSk7ICAvLyBwdXNoIGxhc3QgY2h1bmsKICAgKiBgYGAKICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGRhdGEsIGZsdXNoX21vZGUpIHsKICAgIGNvbnN0IHN0cm0gPSB0aGlzLnN0cm07CiAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplOwogICAgY29uc3QgZGljdGlvbmFyeSA9IHRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5OwogICAgbGV0IHN0YXR1cywgX2ZsdXNoX21vZGUsIGxhc3RfYXZhaWxfb3V0OwoKICAgIGlmICh0aGlzLmVuZGVkKSByZXR1cm4gZmFsc2U7CgogICAgaWYgKGZsdXNoX21vZGUgPT09IH5+Zmx1c2hfbW9kZSkgX2ZsdXNoX21vZGUgPSBmbHVzaF9tb2RlOwogICAgZWxzZSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGUgPT09IHRydWUgPyBaX0ZJTklTSCA6IFpfTk9fRkxVU0g7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHRvU3RyaW5nLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZShzdHJtLCBfZmx1c2hfbW9kZSk7CgogICAgICBpZiAoc3RhdHVzID09PSBaX05FRURfRElDVCAmJiBkaWN0aW9uYXJ5KSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkoc3RybSwgZGljdGlvbmFyeSk7CgogICAgICAgIGlmIChzdGF0dXMgPT09IFpfT0spIHsKICAgICAgICAgIHN0YXR1cyA9IGluZmxhdGVfMSQyLmluZmxhdGUoc3RybSwgX2ZsdXNoX21vZGUpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBaX0RBVEFfRVJST1IpIHsKICAgICAgICAgIC8vIFJlcGxhY2UgY29kZSB3aXRoIG1vcmUgdmVyYm9zZQogICAgICAgICAgc3RhdHVzID0gWl9ORUVEX0RJQ1Q7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTa2lwIHNueWMgbWFya2VycyBpZiBtb3JlIGRhdGEgZm9sbG93cyBhbmQgbm90IHJhdyBtb2RlCiAgICAgIHdoaWxlIChzdHJtLmF2YWlsX2luID4gMCAmJgogICAgICAgICAgICAgc3RhdHVzID09PSBaX1NUUkVBTV9FTkQgJiYKICAgICAgICAgICAgIHN0cm0uc3RhdGUud3JhcCA+IDAgJiYKICAgICAgICAgICAgIGRhdGFbc3RybS5uZXh0X2luXSAhPT0gMCkKICAgICAgewogICAgICAgIGluZmxhdGVfMSQyLmluZmxhdGVSZXNldChzdHJtKTsKICAgICAgICBzdGF0dXMgPSBpbmZsYXRlXzEkMi5pbmZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKICAgICAgfQoKICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICBjYXNlIFpfU1RSRUFNX0VSUk9SOgogICAgICAgIGNhc2UgWl9EQVRBX0VSUk9SOgogICAgICAgIGNhc2UgWl9ORUVEX0RJQ1Q6CiAgICAgICAgY2FzZSBaX01FTV9FUlJPUjoKICAgICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBSZW1lbWJlciByZWFsIGBhdmFpbF9vdXRgIHZhbHVlLCBiZWNhdXNlIHdlIG1heSBwYXRjaCBvdXQgYnVmZmVyIGNvbnRlbnQKICAgICAgLy8gdG8gYWxpZ24gdXRmOCBzdHJpbmdzIGJvdW5kYXJpZXMuCiAgICAgIGxhc3RfYXZhaWxfb3V0ID0gc3RybS5hdmFpbF9vdXQ7CgogICAgICBpZiAoc3RybS5uZXh0X291dCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCB8fCBzdGF0dXMgPT09IFpfU1RSRUFNX0VORCkgewoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CgogICAgICAgICAgICBsZXQgbmV4dF9vdXRfdXRmOCA9IHN0cmluZ3MudXRmOGJvcmRlcihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCk7CgogICAgICAgICAgICBsZXQgdGFpbCA9IHN0cm0ubmV4dF9vdXQgLSBuZXh0X291dF91dGY4OwogICAgICAgICAgICBsZXQgdXRmOHN0ciA9IHN0cmluZ3MuYnVmMnN0cmluZyhzdHJtLm91dHB1dCwgbmV4dF9vdXRfdXRmOCk7CgogICAgICAgICAgICAvLyBtb3ZlIHRhaWwgJiByZWFsaWduIGNvdW50ZXJzCiAgICAgICAgICAgIHN0cm0ubmV4dF9vdXQgPSB0YWlsOwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZSAtIHRhaWw7CiAgICAgICAgICAgIGlmICh0YWlsKSBzdHJtLm91dHB1dC5zZXQoc3RybS5vdXRwdXQuc3ViYXJyYXkobmV4dF9vdXRfdXRmOCwgbmV4dF9vdXRfdXRmOCArIHRhaWwpLCAwKTsKCiAgICAgICAgICAgIHRoaXMub25EYXRhKHV0ZjhzdHIpOwoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0Lmxlbmd0aCA9PT0gc3RybS5uZXh0X291dCA/IHN0cm0ub3V0cHV0IDogc3RybS5vdXRwdXQuc3ViYXJyYXkoMCwgc3RybS5uZXh0X291dCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gTXVzdCByZXBlYXQgaXRlcmF0aW9uIGlmIG91dCBidWZmZXIgaXMgZnVsbAogICAgICBpZiAoc3RhdHVzID09PSBaX09LICYmIGxhc3RfYXZhaWxfb3V0ID09PSAwKSBjb250aW51ZTsKCiAgICAgIC8vIEZpbmFsaXplIGlmIGVuZCBvZiBzdHJlYW0gcmVhY2hlZC4KICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EKSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDApIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgoKICAvKioKICAgKiBJbmZsYXRlI29uRGF0YShjaHVuaykgLT4gVm9pZAogICAqIC0gY2h1bmsgKFVpbnQ4QXJyYXl8U3RyaW5nKTogb3V0cHV0IGRhdGEuIFdoZW4gc3RyaW5nIG91dHB1dCByZXF1ZXN0ZWQsCiAgICogICBlYWNoIGNodW5rIHdpbGwgYmUgc3RyaW5nLgogICAqCiAgICogQnkgZGVmYXVsdCwgc3RvcmVzIGRhdGEgYmxvY2tzIGluIGBjaHVua3NbXWAgcHJvcGVydHkgYW5kIGdsdWUKICAgKiB0aG9zZSBpbiBgb25FbmRgLiBPdmVycmlkZSB0aGlzIGhhbmRsZXIsIGlmIHlvdSBuZWVkIGFub3RoZXIgYmVoYXZpb3VyLgogICAqKi8KICBJbmZsYXRlJDEucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgdGhpcy5jaHVua3MucHVzaChjaHVuayk7CiAgfTsKCgogIC8qKgogICAqIEluZmxhdGUjb25FbmQoc3RhdHVzKSAtPiBWb2lkCiAgICogLSBzdGF0dXMgKE51bWJlcik6IGluZmxhdGUgc3RhdHVzLiAwIChaX09LKSBvbiBzdWNjZXNzLAogICAqICAgb3RoZXIgaWYgbm90LgogICAqCiAgICogQ2FsbGVkIGVpdGhlciBhZnRlciB5b3UgdGVsbCBpbmZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IGNvbW1vbi5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jaHVua3MgPSBbXTsKICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogIH07CgoKICAvKioKICAgKiBpbmZsYXRlKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIERlY29tcHJlc3MgYGRhdGFgIHdpdGggaW5mbGF0ZS91bmd6aXAgYW5kIGBvcHRpb25zYC4gQXV0b2RldGVjdAogICAqIGZvcm1hdCB2aWEgd3JhcHBlciBoZWFkZXIgYnkgZGVmYXVsdC4gVGhhdCdzIHdoeSB3ZSBkb24ndCBwcm92aWRlCiAgICogc2VwYXJhdGUgYHVuZ3ppcGAgbWV0aG9kLgogICAqCiAgICogU3VwcG9ydGVkIG9wdGlvbnMgYXJlOgogICAqCiAgICogLSB3aW5kb3dCaXRzCiAgICoKICAgKiBbaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkXShodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWQpCiAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICoKICAgKiBTdWdhciAob3B0aW9ucyk6CiAgICoKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIHNheSB0aGF0IHdlIHdvcmsgd2l0aCByYXcgc3RyZWFtLCBpZiB5b3UgZG9uJ3Qgd2lzaCB0byBzcGVjaWZ5CiAgICogICBuZWdhdGl2ZSB3aW5kb3dCaXRzIGltcGxpY2l0bHkuCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJyk7CiAgICogY29uc3QgaW5wdXQgPSBwYWtvLmRlZmxhdGUobmV3IFVpbnQ4QXJyYXkoWzEsMiwzLDQsNSw2LDcsOCw5XSkpOwogICAqIGxldCBvdXRwdXQ7CiAgICoKICAgKiB0cnkgewogICAqICAgb3V0cHV0ID0gcGFrby5pbmZsYXRlKGlucHV0KTsKICAgKiB9IGNhdGNoIChlcnIpIHsKICAgKiAgIGNvbnNvbGUubG9nKGVycik7CiAgICogfQogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGluZmxhdG9yID0gbmV3IEluZmxhdGUkMShvcHRpb25zKTsKCiAgICBpbmZsYXRvci5wdXNoKGlucHV0KTsKCiAgICAvLyBUaGF0IHdpbGwgbmV2ZXIgaGFwcGVucywgaWYgeW91IGRvbid0IGNoZWF0IHdpdGggb3B0aW9ucyA6KQogICAgaWYgKGluZmxhdG9yLmVycikgdGhyb3cgaW5mbGF0b3IubXNnIHx8IG1lc3NhZ2VzW2luZmxhdG9yLmVycl07CgogICAgcmV0dXJuIGluZmxhdG9yLnJlc3VsdDsKICB9CgoKICAvKioKICAgKiBpbmZsYXRlUmF3KGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIFRoZSBzYW1lIGFzIFtbaW5mbGF0ZV1dLCBidXQgY3JlYXRlcyByYXcgZGF0YSwgd2l0aG91dCB3cmFwcGVyCiAgICogKGhlYWRlciBhbmQgYWRsZXIzMiBjcmMpLgogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlUmF3JDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgcmV0dXJuIGluZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQoKCiAgLyoqCiAgICogdW5nemlwKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIEp1c3Qgc2hvcnRjdXQgdG8gW1tpbmZsYXRlXV0sIGJlY2F1c2UgaXQgYXV0b2RldGVjdHMgZm9ybWF0CiAgICogYnkgaGVhZGVyLmNvbnRlbnQuIERvbmUgZm9yIGNvbnZlbmllbmNlLgogICAqKi8KCgogIHZhciBJbmZsYXRlXzEkMSA9IEluZmxhdGUkMTsKICB2YXIgaW5mbGF0ZV8yID0gaW5mbGF0ZSQxOwogIHZhciBpbmZsYXRlUmF3XzEkMSA9IGluZmxhdGVSYXckMTsKICB2YXIgdW5nemlwJDEgPSBpbmZsYXRlJDE7CiAgdmFyIGNvbnN0YW50cyA9IGNvbnN0YW50cyQyOwoKICB2YXIgaW5mbGF0ZV8xJDEgPSB7CiAgCUluZmxhdGU6IEluZmxhdGVfMSQxLAogIAlpbmZsYXRlOiBpbmZsYXRlXzIsCiAgCWluZmxhdGVSYXc6IGluZmxhdGVSYXdfMSQxLAogIAl1bmd6aXA6IHVuZ3ppcCQxLAogIAljb25zdGFudHM6IGNvbnN0YW50cwogIH07CgogIGNvbnN0IHsgSW5mbGF0ZSwgaW5mbGF0ZSwgaW5mbGF0ZVJhdywgdW5nemlwIH0gPSBpbmZsYXRlXzEkMTsKICB2YXIgaW5mbGF0ZV8xID0gaW5mbGF0ZTsKCiAgY2xhc3MgRGVmbGF0ZURlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgcmV0dXJuIGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICB9CiAgfQoKICBjbGFzcyBQYWNrYml0c0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgICAgY29uc3Qgb3V0ID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5ieXRlTGVuZ3RoOyArK2kpIHsKICAgICAgICBsZXQgaGVhZGVyID0gZGF0YVZpZXcuZ2V0SW50OChpKTsKICAgICAgICBpZiAoaGVhZGVyIDwgMCkgewogICAgICAgICAgY29uc3QgbmV4dCA9IGRhdGFWaWV3LmdldFVpbnQ4KGkgKyAxKTsKICAgICAgICAgIGhlYWRlciA9IC1oZWFkZXI7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBoZWFkZXI7ICsraikgewogICAgICAgICAgICBvdXQucHVzaChuZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaGVhZGVyOyArK2opIHsKICAgICAgICAgICAgb3V0LnB1c2goZGF0YVZpZXcuZ2V0VWludDgoaSArIGogKyAxKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpICs9IGhlYWRlciArIDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShvdXQpLmJ1ZmZlcjsKICAgIH0KICB9CgogIHZhciBMZXJjRGVjb2RlID0ge2V4cG9ydHM6IHt9fTsKCiAgLyoganNoaW50IGZvcmluOiBmYWxzZSwgYml0d2lzZTogZmFsc2UgKi8KCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAvKgogIENvcHlyaWdodCAyMDE1LTIwMTggRXNyaQoKICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgogIEEgY29weSBvZiB0aGUgbGljZW5zZSBhbmQgYWRkaXRpb25hbCBub3RpY2VzIGFyZSBsb2NhdGVkIHdpdGggdGhlCiAgc291cmNlIGRpc3RyaWJ1dGlvbiBhdDoKCiAgaHR0cDovL2dpdGh1Yi5jb20vRXNyaS9sZXJjLwoKICBDb250cmlidXRvcnM6ICBKb2hhbm5lcyBTY2htaWQsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIENoYXlhbmlrYSBLaGF0dWEsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIFdlbnh1ZSBKdSAoTEVSQyB2MSwgdjIueCkKICAqLwoKICAvKiBDb3B5cmlnaHQgMjAxNS0yMDE4IEVzcmkuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAgQHByZXNlcnZlICovCgogIC8qKgogICAqIGEgbW9kdWxlIGZvciBkZWNvZGluZyBMRVJDIGJsb2JzCiAgICogQG1vZHVsZSBMZXJjCiAgICovCiAgKGZ1bmN0aW9uKCkgewogICAgLy90aGUgb3JpZ2luYWwgTGVyY0RlY29kZSBmb3IgVmVyc2lvbiAxCiAgICB2YXIgTGVyY0RlY29kZSA9IChmdW5jdGlvbigpIHsKCiAgICAgIC8vIFdBUk5JTkc6IFRoaXMgZGVjb2RlciB2ZXJzaW9uIGNhbiBvbmx5IHJlYWQgb2xkIHZlcnNpb24gMSBMZXJjIGJsb2JzLiBVc2Ugd2l0aCBjYXV0aW9uLgoKICAgICAgLy8gTm90ZTogY3VycmVudGx5LCB0aGlzIG1vZHVsZSBvbmx5IGhhcyBhbiBpbXBsZW1lbnRhdGlvbiBmb3IgZGVjb2RpbmcgTEVSQyBkYXRhLCBub3QgZW5jb2RpbmcuIFRoZSBuYW1lIG9mCiAgICAgIC8vIHRoZSBjbGFzcyB3YXMgY2hvc2VuIHRvIGJlIGZ1dHVyZSBwcm9vZi4KCiAgICAgIHZhciBDbnRaSW1hZ2UgPSB7fTsKCiAgICAgIENudFpJbWFnZS5kZWZhdWx0Tm9EYXRhVmFsdWUgPSAtMy40MDI3OTk5Mzg3OTAxNDg0ZSszODsgLy8gc21hbGxlc3QgRmxvYXQzMiB2YWx1ZQoKICAgICAgLyoqCiAgICAgICAqIERlY29kZSBhIExFUkMgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgc29tZSByZXF1aXJlZCBhbmQgb3B0aW9uYWwKICAgICAgICogaW5mb3JtYXRpb24gYWJvdXQgaXQsIHN1Y2ggYXMgdGhlIGltYWdlJ3Mgd2lkdGggYW5kIGhlaWdodC4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gaW5wdXQgVGhlIExFUkMgaW5wdXQgYnl0ZSBzdHJlYW0KICAgICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSBEZWNvZGluZyBvcHRpb25zLCBjb250YWluaW5nIGFueSBvZiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgICAgICAqIEBjb25maWcge251bWJlcn0gW2lucHV0T2Zmc2V0ID0gMF0KICAgICAgICogICAgICAgIFNraXAgdGhlIGZpcnN0IGlucHV0T2Zmc2V0IGJ5dGVzIG9mIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMRVJDIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbi4KICAgICAgICogQGNvbmZpZyB7VWludDhBcnJheX0gW2VuY29kZWRNYXNrID0gbnVsbF0KICAgICAgICogICAgICAgIElmIHNwZWNpZmllZCwgdGhlIGRlY29kZXIgd2lsbCBub3QgcmVhZCBtYXNrIGluZm9ybWF0aW9uIGZyb20gdGhlIGlucHV0IGFuZCB1c2UgdGhlIHNwZWNpZmllZCBlbmNvZGVkCiAgICAgICAqICAgICAgICBtYXNrIGRhdGEgaW5zdGVhZC4gTWFzayBoZWFkZXIvZGF0YSBtdXN0IG5vdCBiZSBwcmVzZW50IGluIHRoZSBMRVJDIGJ5dGUgc3RyZWFtIGluIHRoaXMgY2FzZS4KICAgICAgICogQGNvbmZpZyB7bnVtYmVyfSBbbm9EYXRhVmFsdWUgPSBMZXJjQ29kZS5kZWZhdWx0Tm9EYXRhVmFsdWVdCiAgICAgICAqICAgICAgICBQaXhlbCB2YWx1ZSB0byB1c2UgZm9yIG1hc2tlZCBwaXhlbHMuCiAgICAgICAqIEBjb25maWcge0FycmF5QnVmZmVyVmlld3xBcnJheX0gW3BpeGVsVHlwZSA9IEZsb2F0MzJBcnJheV0KICAgICAgICogICAgICAgIFRoZSBkZXNpcmVkIHR5cGUgb2YgdGhlIHBpeGVsRGF0YSBhcnJheSBpbiB0aGUgcmV0dXJuIHZhbHVlLiBOb3RlIHRoYXQgaXQgaXMgdGhlIGNhbGxlcidzIHJlc3BvbnNpYmlsaXR5IHRvCiAgICAgICAqICAgICAgICBwcm92aWRlIGFuIGFwcHJvcHJpYXRlIG5vRGF0YVZhbHVlIGlmIHRoZSBkZWZhdWx0IHBpeGVsVHlwZSBpcyBvdmVycmlkZGVuLgogICAgICAgKiBAY29uZmlnIHtib29sZWFufSBbcmV0dXJuTWFzayA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGNvbnRhaW4gYSBtYXNrRGF0YSBwcm9wZXJ0eSBvZiB0eXBlIFVpbnQ4QXJyYXkgd2hpY2ggaGFzIG9uZSBlbGVtZW50IHBlcgogICAgICAgKiAgICAgICAgcGl4ZWwsIHRoZSB2YWx1ZSBvZiB3aGljaCBpcyAxIG9yIDAgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhhdCBwaXhlbCdzIGRhdGEgaXMgcHJlc2VudCBvciBtYXNrZWQuIElmIHRoZQogICAgICAgKiAgICAgICAgaW5wdXQgTEVSQyBkYXRhIGRvZXMgbm90IGNvbnRhaW4gYSBtYXNrLCBtYXNrRGF0YSB3aWxsIG5vdCBiZSByZXR1cm5lZC4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkVuY29kZWRNYXNrID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgY29udGFpbiBhIGVuY29kZWRNYXNrRGF0YSBwcm9wZXJ0eSwgd2hpY2ggY2FuIGJlIHBhc3NlZCBpbnRvIGVuY29kZSgpIGFzCiAgICAgICAqICAgICAgICBlbmNvZGVkTWFzay4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkZpbGVJbmZvID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgaGF2ZSBhIGZpbGVJbmZvIHByb3BlcnR5IHRoYXQgY29udGFpbnMgbWV0YWRhdGEgb2J0YWluZWQgZnJvbSB0aGUKICAgICAgICogICAgICAgIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MuCiAgICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtjb21wdXRlVXNlZEJpdERlcHRocyA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIGZpbGVJbmZvIHByb3BlcnR5IGluIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIHRoZSBzZXQgb2YgYWxsIGJsb2NrIGJpdCBkZXB0aHMKICAgICAgICogICAgICAgIGVuY291bnRlcmVkIGR1cmluZyBkZWNvZGluZy4gV2lsbCBvbmx5IGhhdmUgYW4gZWZmZWN0IGlmIHJldHVybkZpbGVJbmZvIG9wdGlvbiBpcyB0cnVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVsRGF0YSwgbWluVmFsdWUsIG1heFZhbHVlLCBub0RhdGFWYWx1ZSwgbWFza0RhdGEsIGVuY29kZWRNYXNrRGF0YSwgZmlsZUluZm99fQogICAgICAgKi8KICAgICAgQ250WkltYWdlLmRlY29kZSA9IGZ1bmN0aW9uKGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIHZhciBza2lwTWFzayA9IG9wdGlvbnMuZW5jb2RlZE1hc2tEYXRhIHx8IChvcHRpb25zLmVuY29kZWRNYXNrRGF0YSA9PT0gbnVsbCk7CiAgICAgICAgdmFyIHBhcnNlZERhdGEgPSBwYXJzZShpbnB1dCwgb3B0aW9ucy5pbnB1dE9mZnNldCB8fCAwLCBza2lwTWFzayk7CgogICAgICAgIHZhciBub0RhdGFWYWx1ZSA9IChvcHRpb25zLm5vRGF0YVZhbHVlICE9PSBudWxsKSA/IG9wdGlvbnMubm9EYXRhVmFsdWUgOiBDbnRaSW1hZ2UuZGVmYXVsdE5vRGF0YVZhbHVlOwoKICAgICAgICB2YXIgdW5jb21wcmVzc2VkRGF0YSA9IHVuY29tcHJlc3NQaXhlbFZhbHVlcyhwYXJzZWREYXRhLCBvcHRpb25zLnBpeGVsVHlwZSB8fCBGbG9hdDMyQXJyYXksCiAgICAgICAgICBvcHRpb25zLmVuY29kZWRNYXNrRGF0YSwgbm9EYXRhVmFsdWUsIG9wdGlvbnMucmV0dXJuTWFzayk7CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICB3aWR0aDogcGFyc2VkRGF0YS53aWR0aCwKICAgICAgICAgIGhlaWdodDogcGFyc2VkRGF0YS5oZWlnaHQsCiAgICAgICAgICBwaXhlbERhdGE6IHVuY29tcHJlc3NlZERhdGEucmVzdWx0UGl4ZWxzLAogICAgICAgICAgbWluVmFsdWU6IHVuY29tcHJlc3NlZERhdGEubWluVmFsdWUsCiAgICAgICAgICBtYXhWYWx1ZTogcGFyc2VkRGF0YS5waXhlbHMubWF4VmFsdWUsCiAgICAgICAgICBub0RhdGFWYWx1ZTogbm9EYXRhVmFsdWUKICAgICAgICB9OwoKICAgICAgICBpZiAodW5jb21wcmVzc2VkRGF0YS5yZXN1bHRNYXNrKSB7CiAgICAgICAgICByZXN1bHQubWFza0RhdGEgPSB1bmNvbXByZXNzZWREYXRhLnJlc3VsdE1hc2s7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5FbmNvZGVkTWFzayAmJiBwYXJzZWREYXRhLm1hc2spIHsKICAgICAgICAgIHJlc3VsdC5lbmNvZGVkTWFza0RhdGEgPSBwYXJzZWREYXRhLm1hc2suYml0c2V0ID8gcGFyc2VkRGF0YS5tYXNrLmJpdHNldCA6IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5GaWxlSW5mbykgewogICAgICAgICAgcmVzdWx0LmZpbGVJbmZvID0gZm9ybWF0RmlsZUluZm8ocGFyc2VkRGF0YSk7CiAgICAgICAgICBpZiAob3B0aW9ucy5jb21wdXRlVXNlZEJpdERlcHRocykgewogICAgICAgICAgICByZXN1bHQuZmlsZUluZm8uYml0RGVwdGhzID0gY29tcHV0ZVVzZWRCaXREZXB0aHMocGFyc2VkRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwoKICAgICAgdmFyIHVuY29tcHJlc3NQaXhlbFZhbHVlcyA9IGZ1bmN0aW9uKGRhdGEsIFR5cGVkQXJyYXlDbGFzcywgbWFza0JpdHNldCwgbm9EYXRhVmFsdWUsIHN0b3JlRGVjb2RlZE1hc2spIHsKICAgICAgICB2YXIgYmxvY2tJZHggPSAwOwogICAgICAgIHZhciBudW1YID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBNYXRoLmZsb29yKGRhdGEud2lkdGggLyBudW1YKTsKICAgICAgICB2YXIgYmxvY2tIZWlnaHQgPSBNYXRoLmZsb29yKGRhdGEuaGVpZ2h0IC8gbnVtWSk7CiAgICAgICAgdmFyIHNjYWxlID0gMiAqIGRhdGEubWF4WkVycm9yOwogICAgICAgIHZhciBtaW5WYWx1ZSA9IE51bWJlci5NQVhfVkFMVUUsIGN1cnJlbnRWYWx1ZTsKICAgICAgICBtYXNrQml0c2V0ID0gbWFza0JpdHNldCB8fCAoKGRhdGEubWFzaykgPyBkYXRhLm1hc2suYml0c2V0IDogbnVsbCk7CgogICAgICAgIHZhciByZXN1bHRQaXhlbHMsIHJlc3VsdE1hc2s7CiAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IFR5cGVkQXJyYXlDbGFzcyhkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIGlmIChzdG9yZURlY29kZWRNYXNrICYmIG1hc2tCaXRzZXQpIHsKICAgICAgICAgIHJlc3VsdE1hc2sgPSBuZXcgVWludDhBcnJheShkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICB2YXIgYmxvY2tEYXRhQnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheShibG9ja1dpZHRoICogYmxvY2tIZWlnaHQpOwoKICAgICAgICB2YXIgeHgsIHl5OwogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDw9IG51bVk7IHkrKykgewogICAgICAgICAgdmFyIHRoaXNCbG9ja0hlaWdodCA9ICh5ICE9PSBudW1ZKSA/IGJsb2NrSGVpZ2h0IDogKGRhdGEuaGVpZ2h0ICUgbnVtWSk7CiAgICAgICAgICBpZiAodGhpc0Jsb2NrSGVpZ2h0ID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPD0gbnVtWDsgeCsrKSB7CiAgICAgICAgICAgIHZhciB0aGlzQmxvY2tXaWR0aCA9ICh4ICE9PSBudW1YKSA/IGJsb2NrV2lkdGggOiAoZGF0YS53aWR0aCAlIG51bVgpOwogICAgICAgICAgICBpZiAodGhpc0Jsb2NrV2lkdGggPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG91dFB0ciA9IHkgKiBkYXRhLndpZHRoICogYmxvY2tIZWlnaHQgKyB4ICogYmxvY2tXaWR0aDsKICAgICAgICAgICAgdmFyIG91dFN0cmlkZSA9IGRhdGEud2lkdGggLSB0aGlzQmxvY2tXaWR0aDsKCiAgICAgICAgICAgIHZhciBibG9jayA9IGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0lkeF07CgogICAgICAgICAgICB2YXIgYmxvY2tEYXRhLCBibG9ja1B0ciwgY29uc3RWYWx1ZTsKICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nIDwgMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGVpdGhlciB1bmNvbXByZXNzZWQgb3IgYml0LXN0dWZmZWQgKGVuY29kaW5ncyAwIGFuZCAxKQogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gYmxvY2sgaXMgdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9jay5yYXdEYXRhOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBibG9jayBpcyBiaXQtc3R1ZmZlZAogICAgICAgICAgICAgICAgdW5zdHVmZihibG9jay5zdHVmZmVkRGF0YSwgYmxvY2suYml0c1BlclBpeGVsLCBibG9jay5udW1WYWxpZFBpeGVscywgYmxvY2sub2Zmc2V0LCBzY2FsZSwgYmxvY2tEYXRhQnVmZmVyLCBkYXRhLnBpeGVscy5tYXhWYWx1ZSk7CiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9ja0RhdGFCdWZmZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJsb2NrUHRyID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGFsbCAwCiAgICAgICAgICAgICAgY29uc3RWYWx1ZSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgLy8gYmxvY2sgaGFzIGNvbnN0YW50IHZhbHVlIChlbmNvZGluZyA9PT0gMykKICAgICAgICAgICAgICBjb25zdFZhbHVlID0gYmxvY2sub2Zmc2V0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbWFza0J5dGU7CiAgICAgICAgICAgIGlmIChtYXNrQml0c2V0KSB7CiAgICAgICAgICAgICAgZm9yICh5eSA9IDA7IHl5IDwgdGhpc0Jsb2NrSGVpZ2h0OyB5eSsrKSB7CiAgICAgICAgICAgICAgICBpZiAob3V0UHRyICYgNykgewogICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA9IG1hc2tCaXRzZXRbb3V0UHRyID4+IDNdOwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA8PD0gb3V0UHRyICYgNzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoeHggPSAwOyB4eCA8IHRoaXNCbG9ja1dpZHRoOyB4eCsrKSB7CiAgICAgICAgICAgICAgICAgIGlmICghKG91dFB0ciAmIDcpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZCBuZXh0IGJ5dGUgZnJvbSBtYXNrCiAgICAgICAgICAgICAgICAgICAgbWFza0J5dGUgPSBtYXNrQml0c2V0W291dFB0ciA+PiAzXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAobWFza0J5dGUgJiAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBwaXhlbCBkYXRhIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gKGJsb2NrLmVuY29kaW5nIDwgMikgPyBibG9ja0RhdGFbYmxvY2tQdHIrK10gOiBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICAgIG1pblZhbHVlID0gbWluVmFsdWUgPiBjdXJyZW50VmFsdWUgPyBjdXJyZW50VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gY3VycmVudFZhbHVlOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHBpeGVsIGRhdGEgbm90IHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG1hc2tCeXRlIDw8PSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gbWFzayBub3QgcHJlc2VudCwgc2ltcGx5IGNvcHkgYmxvY2sgb3ZlcgogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA8IDIpIHsKICAgICAgICAgICAgICAgIC8vIGR1cGxpY2F0aW5nIHRoaXMgY29kZSBibG9jayBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucwogICAgICAgICAgICAgICAgLy8gYmxvY2tEYXRhIGNhc2U6CiAgICAgICAgICAgICAgICBmb3IgKHl5ID0gMDsgeXkgPCB0aGlzQmxvY2tIZWlnaHQ7IHl5KyspIHsKICAgICAgICAgICAgICAgICAgZm9yICh4eCA9IDA7IHh4IDwgdGhpc0Jsb2NrV2lkdGg7IHh4KyspIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBibG9ja0RhdGFbYmxvY2tQdHIrK107CiAgICAgICAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZSA+IGN1cnJlbnRWYWx1ZSA/IGN1cnJlbnRWYWx1ZSA6IG1pblZhbHVlOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBjb25zdFZhbHVlIGNhc2U6CiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG1pblZhbHVlID4gY29uc3RWYWx1ZSA/IGNvbnN0VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgIGZvciAoeXkgPSAwOyB5eSA8IHRoaXNCbG9ja0hlaWdodDsgeXkrKykgewogICAgICAgICAgICAgICAgICBmb3IgKHh4ID0gMDsgeHggPCB0aGlzQmxvY2tXaWR0aDsgeHgrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoYmxvY2suZW5jb2RpbmcgPT09IDEpICYmIChibG9ja1B0ciAhPT0gYmxvY2subnVtVmFsaWRQaXhlbHMpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkJsb2NrIGFuZCBNYXNrIGRvIG5vdCBtYXRjaCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmxvY2tJZHgrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXN1bHRQaXhlbHM6IHJlc3VsdFBpeGVscywKICAgICAgICAgIHJlc3VsdE1hc2s6IHJlc3VsdE1hc2ssCiAgICAgICAgICBtaW5WYWx1ZTogbWluVmFsdWUKICAgICAgICB9OwogICAgICB9OwoKICAgICAgdmFyIGZvcm1hdEZpbGVJbmZvID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiZmlsZUlkZW50aWZpZXJTdHJpbmciOiBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLAogICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5maWxlVmVyc2lvbiwKICAgICAgICAgICJpbWFnZVR5cGUiOiBkYXRhLmltYWdlVHlwZSwKICAgICAgICAgICJoZWlnaHQiOiBkYXRhLmhlaWdodCwKICAgICAgICAgICJ3aWR0aCI6IGRhdGEud2lkdGgsCiAgICAgICAgICAibWF4WkVycm9yIjogZGF0YS5tYXhaRXJyb3IsCiAgICAgICAgICAiZW9mT2Zmc2V0IjogZGF0YS5lb2ZPZmZzZXQsCiAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLm1hc2subnVtQmxvY2tzWCwKICAgICAgICAgICAgIm51bUJsb2Nrc1kiOiBkYXRhLm1hc2subnVtQmxvY2tzWSwKICAgICAgICAgICAgIm51bUJ5dGVzIjogZGF0YS5tYXNrLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLm1hc2subWF4VmFsdWUKICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgInBpeGVscyI6IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAibnVtQmxvY2tzWSI6IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ksCiAgICAgICAgICAgICJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLnBpeGVscy5tYXhWYWx1ZSwKICAgICAgICAgICAgIm5vRGF0YVZhbHVlIjogZGF0YS5ub0RhdGFWYWx1ZQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CgogICAgICB2YXIgY29tcHV0ZVVzZWRCaXREZXB0aHMgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIG51bUJsb2NrcyA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ggKiBkYXRhLnBpeGVscy5udW1CbG9ja3NZOwogICAgICAgIHZhciBiaXREZXB0aHMgPSB7fTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUJsb2NrczsgaSsrKSB7CiAgICAgICAgICB2YXIgYmxvY2sgPSBkYXRhLnBpeGVscy5ibG9ja3NbaV07CiAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDApIHsKICAgICAgICAgICAgYml0RGVwdGhzLmZsb2F0MzIgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICBiaXREZXB0aHNbYmxvY2suYml0c1BlclBpeGVsXSA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaXREZXB0aHNbMF0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGJpdERlcHRocyk7CiAgICAgIH07CgogICAgICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpbnB1dCwgZnAsIHNraXBNYXNrKSB7CiAgICAgICAgdmFyIGRhdGEgPSB7fTsKCiAgICAgICAgLy8gRmlsZSBoZWFkZXIKICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgMTApOwogICAgICAgIGRhdGEuZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIGlmIChkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSAhPT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgIH0KICAgICAgICBmcCArPSAxMDsKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDI0KTsKICAgICAgICBkYXRhLmZpbGVWZXJzaW9uID0gdmlldy5nZXRJbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLmltYWdlVHlwZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5oZWlnaHQgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLndpZHRoID0gdmlldy5nZXRVaW50MzIoMTIsIHRydWUpOwogICAgICAgIGRhdGEubWF4WkVycm9yID0gdmlldy5nZXRGbG9hdDY0KDE2LCB0cnVlKTsKICAgICAgICBmcCArPSAyNDsKCiAgICAgICAgLy8gTWFzayBIZWFkZXIKICAgICAgICBpZiAoIXNraXBNYXNrKSB7CiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBmcCwgMTYpOwogICAgICAgICAgZGF0YS5tYXNrID0ge307CiAgICAgICAgICBkYXRhLm1hc2subnVtQmxvY2tzWSA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm51bUJsb2Nrc1ggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsKICAgICAgICAgIGRhdGEubWFzay5udW1CeXRlcyA9IHZpZXcuZ2V0VWludDMyKDgsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm1heFZhbHVlID0gdmlldy5nZXRGbG9hdDMyKDEyLCB0cnVlKTsKICAgICAgICAgIGZwICs9IDE2OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDApIHsKICAgICAgICAgICAgdmFyIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChkYXRhLndpZHRoICogZGF0YS5oZWlnaHQgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGZwLCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICB2YXIgY250ID0gdmlldy5nZXRJbnQxNigwLCB0cnVlKTsKICAgICAgICAgICAgdmFyIGlwID0gMiwgb3AgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKGNudCA+IDApIHsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2aWV3LmdldFVpbnQ4KGlwKyspOyB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB2YWwgPSB2aWV3LmdldFVpbnQ4KGlwKyspOwogICAgICAgICAgICAgICAgY250ID0gLWNudDsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2YWw7IH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY250ID0gdmlldy5nZXRJbnQxNihpcCwgdHJ1ZSk7CiAgICAgICAgICAgICAgaXAgKz0gMjsKICAgICAgICAgICAgfSB3aGlsZSAoaXAgPCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICBpZiAoKGNudCAhPT0gLTMyNzY4KSB8fCAob3AgPCBiaXRzZXQubGVuZ3RoKSkgewogICAgICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGVuZCBvZiBtYXNrIFJMRSBlbmNvZGluZyI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5tYXNrLmJpdHNldCA9IGJpdHNldDsKICAgICAgICAgICAgZnAgKz0gZGF0YS5tYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoKGRhdGEubWFzay5udW1CeXRlcyB8IGRhdGEubWFzay5udW1CbG9ja3NZIHwgZGF0YS5tYXNrLm1heFZhbHVlKSA9PT0gMCkgeyAgLy8gU3BlY2lhbCBjYXNlLCBhbGwgbm9kYXRhCiAgICAgICAgICAgIGRhdGEubWFzay5iaXRzZXQgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoZGF0YS53aWR0aCAqIGRhdGEuaGVpZ2h0IC8gOCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUGl4ZWwgSGVhZGVyCiAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDE2KTsKICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwogICAgICAgIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1kgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gdmlldy5nZXRVaW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5waXhlbHMubnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5tYXhWYWx1ZSA9IHZpZXcuZ2V0RmxvYXQzMigxMiwgdHJ1ZSk7CiAgICAgICAgZnAgKz0gMTY7CgogICAgICAgIHZhciBudW1CbG9ja3NYID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtQmxvY2tzWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgLy8gdGhlIG51bWJlciBvZiBibG9ja3Mgc3BlY2lmaWVkIGluIHRoZSBoZWFkZXIgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGJsb2NrcyBhdCB0aGUgZW5kIG9mCiAgICAgICAgLy8gZWFjaCByb3cvY29sdW1uIHdpdGggYSBzcGVjaWFsIHdpZHRoL2hlaWdodCB0aGF0IG1ha2UgdGhlIGltYWdlIGNvbXBsZXRlIGluIGNhc2UgdGhlIHdpZHRoIGlzIG5vdAogICAgICAgIC8vIGV2ZW5seSBkaXZpc2libGUgYnkgdGhlIG51bWJlciBvZiBibG9ja3MuCiAgICAgICAgdmFyIGFjdHVhbE51bUJsb2Nrc1ggPSBudW1CbG9ja3NYICsgKChkYXRhLndpZHRoICUgbnVtQmxvY2tzWCkgPiAwID8gMSA6IDApOwogICAgICAgIHZhciBhY3R1YWxOdW1CbG9ja3NZID0gbnVtQmxvY2tzWSArICgoZGF0YS5oZWlnaHQgJSBudW1CbG9ja3NZKSA+IDAgPyAxIDogMCk7CiAgICAgICAgZGF0YS5waXhlbHMuYmxvY2tzID0gbmV3IEFycmF5KGFjdHVhbE51bUJsb2Nrc1ggKiBhY3R1YWxOdW1CbG9ja3NZKTsKICAgICAgICB2YXIgYmxvY2tJID0gMDsKICAgICAgICBmb3IgKHZhciBibG9ja1kgPSAwOyBibG9ja1kgPCBhY3R1YWxOdW1CbG9ja3NZOyBibG9ja1krKykgewogICAgICAgICAgZm9yICh2YXIgYmxvY2tYID0gMDsgYmxvY2tYIDwgYWN0dWFsTnVtQmxvY2tzWDsgYmxvY2tYKyspIHsKCiAgICAgICAgICAgIC8vIEJsb2NrCiAgICAgICAgICAgIHZhciBzaXplID0gMDsKICAgICAgICAgICAgdmFyIGJ5dGVzTGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBmcDsKICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgdmFyIGJsb2NrID0ge307CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0krK10gPSBibG9jazsKICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOyBzaXplKys7CiAgICAgICAgICAgIGJsb2NrLmVuY29kaW5nID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPiAzKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9jay5lbmNvZGluZyArICIpIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDIpIHsKICAgICAgICAgICAgICBmcCsrOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaGVhZGVyQnl0ZSAhPT0gMCkgJiYgKGhlYWRlckJ5dGUgIT09IDIpKSB7CiAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICBibG9jay5vZmZzZXRUeXBlID0gaGVhZGVyQnl0ZTsKICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgYmxvY2sub2Zmc2V0ID0gdmlldy5nZXRJbnQ4KDEpOyBzaXplKys7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEludDE2KDEsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAwKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEZsb2F0MzIoMSwgdHJ1ZSk7IHNpemUgKz0gNDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgb2Zmc2V0IHR5cGUiOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OChzaXplKTsgc2l6ZSsrOwogICAgICAgICAgICAgICAgYmxvY2suYml0c1BlclBpeGVsID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICAgIGJsb2NrLm51bVZhbGlkUGl4ZWxzVHlwZSA9IGhlYWRlckJ5dGU7CiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDgoc2l6ZSk7IHNpemUrKzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyQnl0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDE2KHNpemUsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYmxvY2subnVtVmFsaWRQaXhlbHMgPSB2aWV3LmdldFVpbnQzMihzaXplLCB0cnVlKTsgc2l6ZSArPSA0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgdmFsaWQgcGl4ZWwgY291bnQgdHlwZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZwICs9IHNpemU7CgogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFycmF5QnVmLCBzdG9yZTg7CiAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgIHZhciBudW1QaXhlbHMgPSAoZGF0YS5waXhlbHMubnVtQnl0ZXMgLSAxKSAvIDQ7CiAgICAgICAgICAgICAgaWYgKG51bVBpeGVscyAhPT0gTWF0aC5mbG9vcihudW1QaXhlbHMpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAidW5jb21wcmVzc2VkIGJsb2NrIGhhcyBpbnZhbGlkIGxlbmd0aCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKG51bVBpeGVscyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgbnVtUGl4ZWxzICogNCkpOwogICAgICAgICAgICAgIHZhciByYXdEYXRhID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgYmxvY2sucmF3RGF0YSA9IHJhd0RhdGE7CiAgICAgICAgICAgICAgZnAgKz0gbnVtUGl4ZWxzICogNDsKICAgICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICAgIHZhciBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoYmxvY2subnVtVmFsaWRQaXhlbHMgKiBibG9jay5iaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgYmxvY2suc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIGZwICs9IGRhdGFCeXRlczsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLmVvZk9mZnNldCA9IGZwOwogICAgICAgIHJldHVybiBkYXRhOwogICAgICB9OwoKICAgICAgdmFyIHVuc3R1ZmYgPSBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBkZXN0LCBtYXhWYWx1ZSkgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvOwogICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgdmFyIG4sIGJ1ZmZlcjsKICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgIC8vIGdldCByaWQgb2YgdHJhaWxpbmcgYnl0ZXMgdGhhdCBhcmUgYWxyZWFkeSBwYXJ0IG9mIG5leHQgYmxvY2sKICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwoKICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICB9CiAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICBkZXN0W29dID0gbiA8IG5tYXggPyBvZmZzZXQgKyBuICogc2NhbGUgOiBtYXhWYWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH07CgogICAgICByZXR1cm4gQ250WkltYWdlOwogICAgfSkoKTsKCiAgICAvL3ZlcnNpb24gMi4gU3VwcG9ydHMgMi4xLCAyLjIsIDIuMwogICAgdmFyIExlcmMyRGVjb2RlID0gKGZ1bmN0aW9uKCkgewogICAgICAvLyBOb3RlOiBjdXJyZW50bHksIHRoaXMgbW9kdWxlIG9ubHkgaGFzIGFuIGltcGxlbWVudGF0aW9uIGZvciBkZWNvZGluZyBMRVJDIGRhdGEsIG5vdCBlbmNvZGluZy4gVGhlIG5hbWUgb2YKICAgICAgLy8gdGhlIGNsYXNzIHdhcyBjaG9zZW4gdG8gYmUgZnV0dXJlIHByb29mLCBmb2xsb3dpbmcgTGVyY0RlY29kZS4KCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqIHByaXZhdGUgc3RhdGljIGNsYXNzIGJpdHN1dGZmZXIgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICB2YXIgQml0U3R1ZmZlciA9IHsKICAgICAgICAvL21ldGhvZHMgZW5kaW5nIHdpdGggMiBhcmUgZm9yIHRoZSBuZXcgYnl0ZSBvcmRlciB1c2VkIGJ5IExlcmMyLjMgYW5kIGFib3ZlLgogICAgICAgIC8vb3JpZ2luYWxVbnN0dWZmIGlzIHVzZWQgdG8gdW5wYWNrIEh1ZmZtYW4gY29kZSB0YWJsZS4gY29kZSBpcyBkdXBsaWNhdGVkIHRvIHVuc3R1ZmZ4IGZvciBwZXJmb3JtYW5jZSByZWFzb25zLgogICAgICAgIHVuc3R1ZmY6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMsIGx1dEFyciwgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHMsIG5tYXg7CgogICAgICAgICAgLy8gZ2V0IHJpZCBvZiB0cmFpbGluZyBieXRlcyB0aGF0IGFyZSBhbHJlYWR5IHBhcnQgb2YgbmV4dCBibG9jawogICAgICAgICAgdmFyIG51bUludmFsaWRUYWlsQnl0ZXMgPSBzcmMubGVuZ3RoICogNCAtIE1hdGguY2VpbChiaXRzUGVyUGl4ZWwgKiBudW1QaXhlbHMgLyA4KTsKICAgICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwogICAgICAgICAgaWYgKGx1dEFycikgewogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVzdFtvXSA9IGx1dEFycltuXTsvL29mZnNldCArIGx1dEFycltuXSAqIHNjYWxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy9waXhlbCB2YWx1ZXMgbWF5IGV4Y2VlZCBtYXggZHVlIHRvIHF1YW50aXphdGlvbgogICAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgdW5zdHVmZkxVVDogZnVuY3Rpb24oc3JjLCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG8gPSAwLCBtaXNzaW5nQml0cyA9IDAsIGJpdHNMZWZ0ID0gMCwgbiA9IDA7CiAgICAgICAgICB2YXIgYnVmZmVyOwogICAgICAgICAgdmFyIGRlc3QgPSBbXTsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gKGJpdHNMZWZ0IC0gYml0c1BlclBpeGVsKSkgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9kZXN0LnB1c2gobik7CiAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgZGVzdC51bnNoaWZ0KG9mZnNldCk7Ly8xc3Qgb25lCiAgICAgICAgICByZXR1cm4gZGVzdDsKICAgICAgICB9LAoKICAgICAgICB1bnN0dWZmMjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgbHV0QXJyLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDAsIGJpdFBvcyA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKICAgICAgICAgIGlmIChsdXRBcnIpIHsKICAgICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgPj4+IGJpdFBvcykgJiBiaXRNYXNrKTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgICAgbiB8PSAoYnVmZmVyICYgKCgxIDw8IG1pc3NpbmdCaXRzKSAtIDEpKSA8PCAoYml0c1BlclBpeGVsIC0gbWlzc2luZ0JpdHMpOwogICAgICAgICAgICAgICAgYml0UG9zID0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRlc3Rbb10gPSBsdXRBcnJbbl07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzayk7CiAgICAgICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIHVuc3R1ZmZMVVQyOiBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbyA9IDAsIG1pc3NpbmdCaXRzID0gMCwgYml0c0xlZnQgPSAwLCBuID0gMCwgYml0UG9zID0gMDsKICAgICAgICAgIHZhciBidWZmZXI7CiAgICAgICAgICB2YXIgZGVzdCA9IFtdOwogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2Rlc3QucHVzaChuKTsKICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBkZXN0LnVuc2hpZnQob2Zmc2V0KTsKICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscykgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiAoYml0c0xlZnQgLSBiaXRzUGVyUGl4ZWwpKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjI6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwLCBiaXRQb3MgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHM7CiAgICAgICAgICAvL21pY3JvLW9wdGltaXphdGlvbnMKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqcHJpdmF0ZSBzdGF0aWMgY2xhc3MgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBMZXJjMkhlbHBlcnMgPSB7CiAgICAgICAgSFVGRk1BTl9MVVRfQklUU19NQVg6IDEyLCAvL3VzZSAyXjEyIGx1dCwgdHJlYXQgaXQgbGlrZSBjb25zdGFudAogICAgICAgIGNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzI6IGZ1bmN0aW9uKGlucHV0KSB7CgogICAgICAgICAgdmFyIHN1bTEgPSAweGZmZmYsIHN1bTIgPSAweGZmZmY7CiAgICAgICAgICB2YXIgbGVuID0gaW5wdXQubGVuZ3RoOwogICAgICAgICAgdmFyIHdvcmRzID0gTWF0aC5mbG9vcihsZW4gLyAyKTsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHdoaWxlICh3b3JkcykgewogICAgICAgICAgICB2YXIgdGxlbiA9ICh3b3JkcyA+PSAzNTkpID8gMzU5IDogd29yZHM7CiAgICAgICAgICAgIHdvcmRzIC09IHRsZW47CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBzdW0xICs9IChpbnB1dFtpKytdIDw8IDgpOwogICAgICAgICAgICAgIHN1bTIgKz0gc3VtMSArPSBpbnB1dFtpKytdOwogICAgICAgICAgICB9IHdoaWxlICgtLXRsZW4pOwoKICAgICAgICAgICAgc3VtMSA9IChzdW0xICYgMHhmZmZmKSArIChzdW0xID4+PiAxNik7CiAgICAgICAgICAgIHN1bTIgPSAoc3VtMiAmIDB4ZmZmZikgKyAoc3VtMiA+Pj4gMTYpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGFkZCB0aGUgc3RyYWdnbGVyIGJ5dGUgaWYgaXQgZXhpc3RzCiAgICAgICAgICBpZiAobGVuICYgMSkgewogICAgICAgICAgICBzdW0yICs9IHN1bTEgKz0gKGlucHV0W2ldIDw8IDgpOwogICAgICAgICAgfQogICAgICAgICAgLy8gc2Vjb25kIHJlZHVjdGlvbiBzdGVwIHRvIHJlZHVjZSBzdW1zIHRvIDE2IGJpdHMKICAgICAgICAgIHN1bTEgPSAoc3VtMSAmIDB4ZmZmZikgKyAoc3VtMSA+Pj4gMTYpOwogICAgICAgICAgc3VtMiA9IChzdW0yICYgMHhmZmZmKSArIChzdW0yID4+PiAxNik7CgogICAgICAgICAgcmV0dXJuIChzdW0yIDw8IDE2IHwgc3VtMSkgPj4+IDA7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEhlYWRlckluZm86IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBwdHIsIDYpOwogICAgICAgICAgdmFyIGhlYWRlckluZm8gPSB7fTsKICAgICAgICAgIGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgICAgaWYgKGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcubGFzdEluZGV4T2YoIkxlcmMyIiwgMCkgIT09IDApIHsKICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZmlsZSBpZGVudGlmaWVyIHN0cmluZyAoZXhwZWN0IExlcmMyICk6ICIgKyBoZWFkZXJJbmZvLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgICAgfQogICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgcHRyLCA4KTsKICAgICAgICAgIHZhciBmaWxlVmVyc2lvbiA9IHZpZXcuZ2V0SW50MzIoMCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uID0gZmlsZVZlcnNpb247CiAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgIGhlYWRlckluZm8uY2hlY2tzdW0gPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9ucm93cwogICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2tleXMgc3RhcnQgZnJvbSBoZXJlCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDEyKTsKICAgICAgICAgIGhlYWRlckluZm8uaGVpZ2h0ID0gdmlldy5nZXRVaW50MzIoMCwgdHJ1ZSk7IC8vbnJvd3MKICAgICAgICAgIGhlYWRlckluZm8ud2lkdGggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9uY29scwogICAgICAgICAgcHRyICs9IDg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gNCkgewogICAgICAgICAgICBoZWFkZXJJbmZvLm51bURpbXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGVhZGVySW5mby5udW1EaW1zID0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQwKTsKICAgICAgICAgIGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby5taWNyb0Jsb2NrU2l6ZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmJsb2JTaXplID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uaW1hZ2VUeXBlID0gdmlldy5nZXRJbnQzMigxMiwgdHJ1ZSk7CgogICAgICAgICAgaGVhZGVySW5mby5tYXhaRXJyb3IgPSB2aWV3LmdldEZsb2F0NjQoMTYsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby56TWluID0gdmlldy5nZXRGbG9hdDY0KDI0LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uek1heCA9IHZpZXcuZ2V0RmxvYXQ2NCgzMiwgdHJ1ZSk7CiAgICAgICAgICBwdHIgKz0gNDA7CiAgICAgICAgICBkYXRhLmhlYWRlckluZm8gPSBoZWFkZXJJbmZvOwogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CgogICAgICAgICAgdmFyIGNoZWNrc3VtLCBrZXlMZW5ndGg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICBrZXlMZW5ndGggPSBmaWxlVmVyc2lvbiA+PSA0ID8gNTIgOiA0ODsKICAgICAgICAgICAgY2hlY2tzdW0gPSB0aGlzLmNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzIobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciAtIGtleUxlbmd0aCwgaGVhZGVySW5mby5ibG9iU2l6ZSAtIDE0KSk7CiAgICAgICAgICAgIGlmIChjaGVja3N1bSAhPT0gaGVhZGVySW5mby5jaGVja3N1bSkgewogICAgICAgICAgICAgIHRocm93ICJDaGVja3N1bSBmYWlsZWQuIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgY2hlY2tNaW5NYXhSYW5nZXM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IHRoaXMuZ2V0RGF0YVR5cGVBcnJheShoZWFkZXJJbmZvLmltYWdlVHlwZSk7CiAgICAgICAgICB2YXIgcmFuZ2VCeXRlcyA9IGhlYWRlckluZm8ubnVtRGltcyAqIHRoaXMuZ2V0RGF0YVR5cGVTaXplKGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBtaW5WYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIsIE91dFBpeGVsVHlwZUFycmF5LCByYW5nZUJ5dGVzKTsKICAgICAgICAgIHZhciBtYXhWYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIgKyByYW5nZUJ5dGVzLCBPdXRQaXhlbFR5cGVBcnJheSwgcmFuZ2VCeXRlcyk7CiAgICAgICAgICBkYXRhLnB0ciArPSAoMiAqIHJhbmdlQnl0ZXMpOwogICAgICAgICAgdmFyIGksIGVxdWFsID0gdHJ1ZTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWFkZXJJbmZvLm51bURpbXM7IGkrKykgewogICAgICAgICAgICBpZiAobWluVmFsdWVzW2ldICE9PSBtYXhWYWx1ZXNbaV0pIHsKICAgICAgICAgICAgICBlcXVhbCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBoZWFkZXJJbmZvLm1pblZhbHVlcyA9IG1pblZhbHVlczsKICAgICAgICAgIGhlYWRlckluZm8ubWF4VmFsdWVzID0gbWF4VmFsdWVzOwogICAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgICAgIH0sCgogICAgICAgIHJlYWRTdWJBcnJheTogZnVuY3Rpb24oaW5wdXQsIHB0ciwgT3V0UGl4ZWxUeXBlQXJyYXksIG51bUJ5dGVzKSB7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmF3RGF0YTsKICAgICAgICB9LAoKICAgICAgICByZWFkTWFzazogZnVuY3Rpb24oaW5wdXQsIGRhdGEpIHsKICAgICAgICAgIHZhciBwdHIgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBudW1WYWxpZFBpeGVsID0gaGVhZGVySW5mby5udW1WYWxpZFBpeGVsOwoKICAgICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQpOwogICAgICAgICAgdmFyIG1hc2sgPSB7fTsKICAgICAgICAgIG1hc2subnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICAgIHB0ciArPSA0OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKCgwID09PSBudW1WYWxpZFBpeGVsIHx8IG51bVBpeGVscyA9PT0gbnVtVmFsaWRQaXhlbCkgJiYgMCAhPT0gbWFzay5udW1CeXRlcykgewogICAgICAgICAgICB0aHJvdyAoImludmFsaWQgbWFzayIpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJpdHNldCwgcmVzdWx0TWFzazsKICAgICAgICAgIGlmIChudW1WYWxpZFBpeGVsID09PSAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIG1hc2suYml0c2V0ID0gYml0c2V0OwogICAgICAgICAgICByZXN1bHRNYXNrID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0TWFzayA9IHJlc3VsdE1hc2s7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfS8vID8/Pz8/IGVsc2UgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDAgJiYgZGF0YS5tYXNrLm51bUJ5dGVzPCBkYXRhLm51bVZhbGlkUGl4ZWwpIHsKICAgICAgICAgIGVsc2UgaWYgKG1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIHB0ciwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBjbnQgPSB2aWV3LmdldEludDE2KDAsIHRydWUpOwogICAgICAgICAgICB2YXIgaXAgPSAyLCBvcCA9IDAsIHZhbCA9IDA7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBpZiAoY250ID4gMCkgewogICAgICAgICAgICAgICAgd2hpbGUgKGNudC0tKSB7IGJpdHNldFtvcCsrXSA9IHZpZXcuZ2V0VWludDgoaXArKyk7IH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsID0gdmlldy5nZXRVaW50OChpcCsrKTsKICAgICAgICAgICAgICAgIGNudCA9IC1jbnQ7CiAgICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmFsOyB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNudCA9IHZpZXcuZ2V0SW50MTYoaXAsIHRydWUpOwogICAgICAgICAgICAgIGlwICs9IDI7CiAgICAgICAgICAgIH0gd2hpbGUgKGlwIDwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIGlmICgoY250ICE9PSAtMzI3NjgpIHx8IChvcCA8IGJpdHNldC5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZW5kIG9mIG1hc2sgUkxFIGVuY29kaW5nIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0TWFzayA9IG5ldyBVaW50OEFycmF5KG51bVBpeGVscyk7CiAgICAgICAgICAgIHZhciBtYiA9IDAsIGsgPSAwOwoKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKGsgJiA3KSB7CiAgICAgICAgICAgICAgICBtYiA9IGJpdHNldFtrID4+IDNdOwogICAgICAgICAgICAgICAgbWIgPDw9IGsgJiA3OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1iID0gYml0c2V0W2sgPj4gM107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChtYiAmIDEyOCkgewogICAgICAgICAgICAgICAgcmVzdWx0TWFza1trXSA9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sgPSByZXN1bHRNYXNrOwoKICAgICAgICAgICAgbWFzay5iaXRzZXQgPSBiaXRzZXQ7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CiAgICAgICAgICBkYXRhLm1hc2sgPSBtYXNrOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZERhdGFPbmVTd2VlcDogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBpbWFnZVR5cGUgPSBoZWFkZXJJbmZvLmltYWdlVHlwZTsKICAgICAgICAgIHZhciBudW1CeXRlcyA9IGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCAqIExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKSAqIG51bURpbXM7CiAgICAgICAgICAvL2RhdGEucGl4ZWxzLm51bUJ5dGVzID0gbnVtQnl0ZXM7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmF3RGF0YS5sZW5ndGggPT09IG51bVBpeGVscyAqIG51bURpbXMpIHsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gcmF3RGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgIC8vbWFzawogICAgICAgICAgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogbnVtRGltcyk7CiAgICAgICAgICAgIHZhciB6ID0gMCwgayA9IDAsIGkgPSAwLCBuU3RhcnQgPSAwOwogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICBmb3IgKGk9MDsgaSA8IG51bURpbXM7IGkrKykgewogICAgICAgICAgICAgICAgblN0YXJ0ID0gaSAqIG51bVBpeGVsczsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1tuU3RhcnQgKyBrXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbnVtUGl4ZWxzOyBrKyspIHsKICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1trXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHB0ciArPSBudW1CeXRlczsKICAgICAgICAgIGRhdGEucHRyID0gcHRyOyAgICAgICAvL3JldHVybiBkYXRhOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEh1ZmZtYW5UcmVlOiBmdW5jdGlvbihpbnB1dCwgZGF0YSkgewogICAgICAgICAgdmFyIEJJVFNfTUFYID0gdGhpcy5IVUZGTUFOX0xVVF9CSVRTX01BWDsgLy84IGlzIHNsb3cgZm9yIHRoZSBsYXJnZSB0ZXN0IGltYWdlCiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgY29kZSB0YWJsZQogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDE2KTsKICAgICAgICAgIGRhdGEucHRyICs9IDE2OwogICAgICAgICAgdmFyIHZlcnNpb24gPSB2aWV3LmdldEludDMyKDAsIHRydWUpOwogICAgICAgICAgaWYgKHZlcnNpb24gPCAyKSB7CiAgICAgICAgICAgIHRocm93ICJ1bnN1cHBvcnRlZCBIdWZmbWFuIHZlcnNpb24iOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHNpemUgPSB2aWV3LmdldEludDMyKDQsIHRydWUpOwogICAgICAgICAgdmFyIGkwID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIHZhciBpMSA9IHZpZXcuZ2V0SW50MzIoMTIsIHRydWUpOwogICAgICAgICAgaWYgKGkwID49IGkxKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoaTEgLSBpMCk7CiAgICAgICAgICBMZXJjMkhlbHBlcnMuZGVjb2RlQml0cyhpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyKTsKICAgICAgICAgIHZhciBjb2RlVGFibGUgPSBbXTsgLy9zaXplCiAgICAgICAgICB2YXIgaSwgaiwgaywgbGVuOwoKICAgICAgICAgIGZvciAoaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICAgICAgICBqID0gaSAtIChpIDwgc2l6ZSA/IDAgOiBzaXplKTsvL3dyYXAgYXJvdW5kCiAgICAgICAgICAgIGNvZGVUYWJsZVtqXSA9IHsgZmlyc3Q6IGJsb2NrRGF0YUJ1ZmZlcltpIC0gaTBdLCBzZWNvbmQ6IG51bGwgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YUJ5dGVzID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihkYXRhV29yZHMgKiA0KTsKICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOyAvL211c3Qgc3RhcnQgZnJvbSB4KjQKICAgICAgICAgIHZhciBiaXRQb3MgPSAwLCB3b3JkLCBzcmNQdHIgPSAwOwogICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhWzBdOwogICAgICAgICAgZm9yIChpID0gaTA7IGkgPCBpMTsgaSsrKSB7CiAgICAgICAgICAgIGogPSBpIC0gKGkgPCBzaXplID8gMCA6IHNpemUpOy8vd3JhcCBhcm91bmQKICAgICAgICAgICAgbGVuID0gY29kZVRhYmxlW2pdLmZpcnN0OwogICAgICAgICAgICBpZiAobGVuID4gMCkgewogICAgICAgICAgICAgIGNvZGVUYWJsZVtqXS5zZWNvbmQgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBsZW4pOwoKICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPj0gbGVuKSB7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gbGVuOwogICAgICAgICAgICAgICAgaWYgKGJpdFBvcyA9PT0gMzIpIHsKICAgICAgICAgICAgICAgICAgYml0UG9zID0gMDsKICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBsZW4gLSAzMjsKICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICBjb2RlVGFibGVbal0uc2Vjb25kIHw9IHdvcmQgPj4+ICgzMiAtIGJpdFBvcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy9maW5pc2hlZCByZWFkaW5nIGNvZGUgdGFibGUKCiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIGJ1aWxkaW5nIGx1dAogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgbnVtQml0c0xVVCA9IDAsIG51bUJpdHNMVVRRaWNrID0gMDsKICAgICAgICAgIHZhciB0cmVlID0gbmV3IFRyZWVOb2RlKCk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29kZVRhYmxlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb2RlVGFibGVbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG51bUJpdHNMVVQgPSBNYXRoLm1heChudW1CaXRzTFVULCBjb2RlVGFibGVbaV0uZmlyc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobnVtQml0c0xVVCA+PSBCSVRTX01BWCkgewogICAgICAgICAgICBudW1CaXRzTFVUUWljayA9IEJJVFNfTUFYOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG51bUJpdHNMVVRRaWNrID0gbnVtQml0c0xVVDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChudW1CaXRzTFVUID49IDMwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJXQVJuaW5nLCBsYXJnZSBOVU0gTFVUIEJJVFMgSVMgIiArIG51bUJpdHNMVVQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRlY29kZUx1dCA9IFtdLCBlbnRyeSwgY29kZSwgbnVtRW50cmllcywgamosIGN1cnJlbnRCaXQsIG5vZGU7CiAgICAgICAgICBmb3IgKGkgPSBpMDsgaSA8IGkxOyBpKyspIHsKICAgICAgICAgICAgaiA9IGkgLSAoaSA8IHNpemUgPyAwIDogc2l6ZSk7Ly93cmFwIGFyb3VuZAogICAgICAgICAgICBsZW4gPSBjb2RlVGFibGVbal0uZmlyc3Q7CiAgICAgICAgICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgZW50cnkgPSBbbGVuLCBqXTsKICAgICAgICAgICAgICBpZiAobGVuIDw9IG51bUJpdHNMVVRRaWNrKSB7CiAgICAgICAgICAgICAgICBjb2RlID0gY29kZVRhYmxlW2pdLnNlY29uZCA8PCAobnVtQml0c0xVVFFpY2sgLSBsZW4pOwogICAgICAgICAgICAgICAgbnVtRW50cmllcyA9IDEgPDwgKG51bUJpdHNMVVRRaWNrIC0gbGVuKTsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1FbnRyaWVzOyBrKyspIHsKICAgICAgICAgICAgICAgICAgZGVjb2RlTHV0W2NvZGUgfCBrXSA9IGVudHJ5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vYnVpbGQgdHJlZQogICAgICAgICAgICAgICAgY29kZSA9IGNvZGVUYWJsZVtqXS5zZWNvbmQ7CiAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgIGZvciAoamogPSBsZW4gLSAxOyBqaiA+PSAwOyBqai0tKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRCaXQgPSBjb2RlID4+PiBqaiAmIDE7IC8vbm8gbGVmdCBzaGlmdCBhcyBsZW5ndGggY291bGQgYmUgMzAsMzEKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRCaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW5vZGUucmlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmlnaHQgPSBuZXcgVHJlZU5vZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlZnQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IG5ldyBUcmVlTm9kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChqaiA9PT0gMCAmJiAhbm9kZS52YWwpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLnZhbCA9IGVudHJ5WzFdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkZWNvZGVMdXQ6IGRlY29kZUx1dCwKICAgICAgICAgICAgbnVtQml0c0xVVFFpY2s6IG51bUJpdHNMVVRRaWNrLAogICAgICAgICAgICBudW1CaXRzTFVUOiBudW1CaXRzTFVULAogICAgICAgICAgICB0cmVlOiB0cmVlLAogICAgICAgICAgICBzdHVmZmVkRGF0YTogc3R1ZmZlZERhdGEsCiAgICAgICAgICAgIHNyY1B0cjogc3JjUHRyLAogICAgICAgICAgICBiaXRQb3M6IGJpdFBvcwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICByZWFkSHVmZm1hbjogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgd2lkdGggPSBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgaHVmZm1hbiBzdHJ1Y3R1cmUgaW5mbwogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgaHVmZm1hbkluZm8gPSB0aGlzLnJlYWRIdWZmbWFuVHJlZShpbnB1dCwgZGF0YSk7CiAgICAgICAgICB2YXIgZGVjb2RlTHV0ID0gaHVmZm1hbkluZm8uZGVjb2RlTHV0OwogICAgICAgICAgdmFyIHRyZWUgPSBodWZmbWFuSW5mby50cmVlOwogICAgICAgICAgLy9zdHVmZmVkRGF0YSBpbmNsdWRlcyBodWZmbWFuIGhlYWRlcnMKICAgICAgICAgIHZhciBzdHVmZmVkRGF0YSA9IGh1ZmZtYW5JbmZvLnN0dWZmZWREYXRhOwogICAgICAgICAgdmFyIHNyY1B0ciA9IGh1ZmZtYW5JbmZvLnNyY1B0cjsKICAgICAgICAgIHZhciBiaXRQb3MgPSBodWZmbWFuSW5mby5iaXRQb3M7CiAgICAgICAgICB2YXIgbnVtQml0c0xVVFFpY2sgPSBodWZmbWFuSW5mby5udW1CaXRzTFVUUWljazsKICAgICAgICAgIHZhciBudW1CaXRzTFVUID0gaHVmZm1hbkluZm8ubnVtQml0c0xVVDsKICAgICAgICAgIHZhciBvZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlID09PSAwID8gMTI4IDogMDsKICAgICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICAqICBkZWNvZGUKICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICAgIHZhciBub2RlLCB2YWwsIGRlbHRhLCBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzaywgdmFsVG1wLCB2YWxUbXBRdWljaywgY3VycmVudEJpdDsKICAgICAgICAgIHZhciBpLCBqLCBrLCBpaTsKICAgICAgICAgIHZhciBwcmV2VmFsID0gMDsKICAgICAgICAgIGlmIChiaXRQb3MgPiAwKSB7CiAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgdmFyIGRlbHRhRW5jb2RlID0gZGF0YS5lbmNvZGVNb2RlID09PSAxOwogICAgICAgICAgdmFyIHJlc3VsdFBpeGVsc0FsbERpbSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShudW1QaXhlbHMgKiBudW1EaW1zKTsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSByZXN1bHRQaXhlbHNBbGxEaW07CiAgICAgICAgICB2YXIgaURpbTsKICAgICAgICAgIGZvciAoaURpbSA9IDA7IGlEaW0gPCBoZWFkZXJJbmZvLm51bURpbXM7IGlEaW0rKykgewogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAvL2dldCB0aGUgbWVtIGJsb2NrIG9mIGN1cnJlbnQgZGltZW5zaW9uCiAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KHJlc3VsdFBpeGVsc0FsbERpbS5idWZmZXIsIG51bVBpeGVscyAqIGlEaW0sIG51bVBpeGVscyk7CiAgICAgICAgICAgICAgcHJldlZhbCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEuaGVhZGVySW5mby5udW1WYWxpZFBpeGVsID09PSB3aWR0aCAqIGhlaWdodCkgeyAvL2FsbCB2YWxpZAogICAgICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrLCBrKyspIHsKICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgdmFsVG1wID0gKHdvcmQgPDwgYml0UG9zKSA+Pj4gKDMyIC0gbnVtQml0c0xVVFFpY2spOwogICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVFFpY2spKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZWNvZGVMdXRbdmFsVG1wUXVpY2tdKSAgICAvLyBpZiB0aGVyZSwgbW92ZSB0aGUgY29ycmVjdCBudW1iZXIgb2YgYml0cyBhbmQgZG9uZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgKz0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVswXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVCkpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHRyZWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbnVtQml0c0xVVDsgaWkrKykgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50Qml0ID8gbm9kZS5yaWdodCA6IG5vZGUubGVmdDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5vZGUubGVmdCB8fCBub2RlLnJpZ2h0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgYml0UG9zID0gYml0UG9zICsgaWkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgLT0gMzI7CiAgICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGRlbHRhID0gdmFsIC0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICs9IHByZXZWYWw7ICAgIC8vIHVzZSBvdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcmVzdWx0UGl4ZWxzW2sgLSB3aWR0aF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGVsdGEgJj0gMHhGRjsgLy9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICBwcmV2VmFsID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW2tdID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7IC8vbm90IGFsbCB2YWxpZCwgdXNlIG1hc2sKICAgICAgICAgICAgICBmb3IgKGsgPSAwLCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKywgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUUWljayk7CiAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUUWljaykpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlY29kZUx1dFt2YWxUbXBRdWlja10pICAgIC8vIGlmIHRoZXJlLCBtb3ZlIHRoZSBjb3JyZWN0IG51bWJlciBvZiBiaXRzIGFuZCBkb25lCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyArPSBkZWNvZGVMdXRbdmFsVG1wUXVpY2tdWzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIG51bUJpdHNMVVQpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcFF1aWNrID0gdmFsVG1wOy8vID4+PiBkZWx0YUJpdHM7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaWkgPSAwOyBpaSA8IG51bUJpdHNMVVQ7IGlpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGN1cnJlbnRCaXQgPyBub2RlLnJpZ2h0IDogbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShub2RlLmxlZnQgfHwgbm9kZS5yaWdodCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRQb3MgPSBiaXRQb3MgKyBpaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyAtPSAzMjsKICAgICAgICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBkZWx0YSA9IHZhbCAtIG9mZnNldDsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChqID4gMCAmJiBtYXNrW2sgLSAxXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOyAgICAvLyB1c2Ugb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgPiAwICYmIG1hc2tbayAtIHdpZHRoXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSByZXN1bHRQaXhlbHNbayAtIHdpZHRoXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICY9IDB4RkY7IC8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHByZXZWYWwgPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5wdHIgPSBkYXRhLnB0ciArIChzcmNQdHIgKyAxKSAqIDQgKyAoYml0UG9zID4gMCA/IDQgOiAwKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscyA9IHJlc3VsdFBpeGVsc0FsbERpbTsKICAgICAgICB9LAoKICAgICAgICBkZWNvZGVCaXRzOiBmdW5jdGlvbihpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBvZmZzZXQsIGlEaW0pIHsKICAgICAgICAgIHsKICAgICAgICAgICAgLy9iaXRzdHVmZiBlbmNvZGluZyBpcyAzCiAgICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgICB2YXIgZmlsZVZlcnNpb24gPSBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uOwogICAgICAgICAgICAvL3ZhciBibG9jayA9IHt9OwogICAgICAgICAgICB2YXIgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDUpOy8vdG8gZG8KICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICBibG9ja1B0cisrOwogICAgICAgICAgICB2YXIgYml0czY3ID0gaGVhZGVyQnl0ZSA+PiA2OwogICAgICAgICAgICB2YXIgbiA9IChiaXRzNjcgPT09IDApID8gNCA6IDMgLSBiaXRzNjc7CiAgICAgICAgICAgIHZhciBkb0x1dCA9IChoZWFkZXJCeXRlICYgMzIpID4gMCA/IHRydWUgOiBmYWxzZTsvLzV0aCBiaXQKICAgICAgICAgICAgdmFyIG51bUJpdHMgPSBoZWFkZXJCeXRlICYgMzE7CiAgICAgICAgICAgIHZhciBudW1FbGVtZW50cyA9IDA7CiAgICAgICAgICAgIGlmIChuID09PSAxKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQ4KGJsb2NrUHRyKTsgYmxvY2tQdHIrKzsKICAgICAgICAgICAgfSBlbHNlIGlmIChuID09PSAyKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQxNihibG9ja1B0ciwgdHJ1ZSk7IGJsb2NrUHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobiA9PT0gNCkgewogICAgICAgICAgICAgIG51bUVsZW1lbnRzID0gdmlldy5nZXRVaW50MzIoYmxvY2tQdHIsIHRydWUpOyBibG9ja1B0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93ICJJbnZhbGlkIHZhbGlkIHBpeGVsIGNvdW50IHR5cGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vZml4OiBodWZmbWFuIGNvZGVzIGFyZSBiaXQgc3R1ZmZlZCwgYnV0IG5vdCBib3VuZCBieSBkYXRhJ3MgbWF4IHZhbHVlLCBzbyBuZWVkIHRvIHVzZSBvcmlnaW5hbFVuc3R1ZmYKICAgICAgICAgICAgLy9vZmZzZXQgPSBvZmZzZXQgfHwgMDsKICAgICAgICAgICAgdmFyIHNjYWxlID0gMiAqIGhlYWRlckluZm8ubWF4WkVycm9yOwogICAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEsIGFycmF5QnVmLCBzdG9yZTgsIGRhdGFCeXRlcywgZGF0YVdvcmRzOwogICAgICAgICAgICB2YXIgbHV0QXJyLCBsdXREYXRhLCBsdXRCeXRlcywgYml0c1BlclBpeGVsOwogICAgICAgICAgICB2YXIgek1heCA9IGhlYWRlckluZm8ubnVtRGltcyA+IDEgPyBoZWFkZXJJbmZvLm1heFZhbHVlc1tpRGltXSA6IGhlYWRlckluZm8uek1heDsKICAgICAgICAgICAgaWYgKGRvTHV0KSB7CiAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmx1dCsrOwogICAgICAgICAgICAgIGx1dEJ5dGVzID0gdmlldy5nZXRVaW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYmxvY2tQdHIrKzsKICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoKGx1dEJ5dGVzIC0gMSkgKiBudW1CaXRzIC8gOCk7CiAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKCiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgZGF0YS5wdHIsIGRhdGFCeXRlcykpOwoKICAgICAgICAgICAgICBsdXREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CgogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IDA7CiAgICAgICAgICAgICAgd2hpbGUgKChsdXRCeXRlcyAtIDEpID4+PiBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwobnVtRWxlbWVudHMgKiBiaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICBkYXRhV29yZHMgPSBNYXRoLmNlaWwoZGF0YUJ5dGVzIC8gNCk7CiAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIGRhdGEucHRyLCBkYXRhQnl0ZXMpKTsKICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwogICAgICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgICAgICBsdXRBcnIgPSBCaXRTdHVmZmVyLnVuc3R1ZmZMVVQyKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbHV0QXJyID0gQml0U3R1ZmZlci51bnN0dWZmTFVUKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vbHV0QXJyLnVuc2hpZnQoMCk7CiAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID49IDMpIHsKICAgICAgICAgICAgICAgIC8vQml0U3R1ZmZlci51bnN0dWZmMihibG9jaywgYmxvY2tEYXRhQnVmZmVyLCBoZWFkZXJJbmZvLnpNYXgpOwogICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEJpdFN0dWZmZXIudW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImJpdHN0dWZmZXIiKTsKICAgICAgICAgICAgICBkYXRhLmNvdW50ZXIuYml0c3R1ZmZlcisrOwogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IG51bUJpdHM7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgaWYgKGJpdHNQZXJQaXhlbCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFCeXRlcyA9IE1hdGguY2VpbChudW1FbGVtZW50cyAqIGJpdHNQZXJQaXhlbCAvIDgpOwogICAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgICBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CiAgICAgICAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZjIoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBmYWxzZSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLnVuc3R1ZmYoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgZmFsc2UsIG9mZnNldCwgc2NhbGUsIHpNYXgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIHJlYWRUaWxlczogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciB3aWR0aCA9IGhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgbWljcm9CbG9ja1NpemUgPSBoZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplOwogICAgICAgICAgdmFyIGltYWdlVHlwZSA9IGhlYWRlckluZm8uaW1hZ2VUeXBlOwogICAgICAgICAgdmFyIGRhdGFUeXBlU2l6ZSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBudW1CbG9ja3NYID0gTWF0aC5jZWlsKHdpZHRoIC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgdmFyIG51bUJsb2Nrc1kgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgZGF0YS5waXhlbHMubnVtQmxvY2tzWSA9IG51bUJsb2Nrc1k7CiAgICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gbnVtQmxvY2tzWDsKICAgICAgICAgIGRhdGEucGl4ZWxzLnB0ciA9IDA7CiAgICAgICAgICB2YXIgcm93ID0gMCwgY29sID0gMCwgYmxvY2tZID0gMCwgYmxvY2tYID0gMCwgdGhpc0Jsb2NrSGVpZ2h0ID0gMCwgdGhpc0Jsb2NrV2lkdGggPSAwLCBieXRlc0xlZnQgPSAwLCBoZWFkZXJCeXRlID0gMCwgYml0czY3ID0gMCwgdGVzdENvZGUgPSAwLCBvdXRQdHIgPSAwLCBvdXRTdHJpZGUgPSAwLCBudW1CeXRlcyA9IDAsIGJ5dGVzbGVmdCA9IDAsIHogPSAwLCBibG9ja1B0ciA9IDA7CiAgICAgICAgICB2YXIgdmlldywgYmxvY2ssIGFycmF5QnVmLCBzdG9yZTgsIHJhd0RhdGE7CiAgICAgICAgICB2YXIgYmxvY2tFbmNvZGluZzsKICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobWljcm9CbG9ja1NpemUgKiBtaWNyb0Jsb2NrU2l6ZSk7CiAgICAgICAgICB2YXIgbGFzdEJsb2NrSGVpZ2h0ID0gKGhlaWdodCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBsYXN0QmxvY2tXaWR0aCA9ICh3aWR0aCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBvZmZzZXRUeXBlLCBvZmZzZXQ7CiAgICAgICAgICB2YXIgbnVtRGltcyA9IGhlYWRlckluZm8ubnVtRGltcywgaURpbTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHM7CiAgICAgICAgICBmb3IgKGJsb2NrWSA9IDA7IGJsb2NrWSA8IG51bUJsb2Nrc1k7IGJsb2NrWSsrKSB7CiAgICAgICAgICAgIHRoaXNCbG9ja0hlaWdodCA9IChibG9ja1kgIT09IG51bUJsb2Nrc1kgLSAxKSA/IG1pY3JvQmxvY2tTaXplIDogbGFzdEJsb2NrSGVpZ2h0OwogICAgICAgICAgICBmb3IgKGJsb2NrWCA9IDA7IGJsb2NrWCA8IG51bUJsb2Nrc1g7IGJsb2NrWCsrKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJ5IiArIGJsb2NrWSArICIgeCIgKyBibG9ja1gpOwogICAgICAgICAgICAgIHRoaXNCbG9ja1dpZHRoID0gKGJsb2NrWCAhPT0gbnVtQmxvY2tzWCAtIDEpID8gbWljcm9CbG9ja1NpemUgOiBsYXN0QmxvY2tXaWR0aDsKCiAgICAgICAgICAgICAgb3V0UHRyID0gYmxvY2tZICogd2lkdGggKiBtaWNyb0Jsb2NrU2l6ZSArIGJsb2NrWCAqIG1pY3JvQmxvY2tTaXplOwogICAgICAgICAgICAgIG91dFN0cmlkZSA9IHdpZHRoIC0gdGhpc0Jsb2NrV2lkdGg7CgoKICAgICAgICAgICAgICBmb3IgKGlEaW0gPSAwOyBpRGltIDwgbnVtRGltczsgaURpbSsrKSB7CiAgICAgICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5idWZmZXIsIHdpZHRoICogaGVpZ2h0ICogaURpbSAqIGRhdGFUeXBlU2l6ZSwgd2lkdGggKiBoZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnl0ZXNMZWZ0ID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgICAgIGJsb2NrID0ge307CiAgICAgICAgICAgICAgICBibG9ja1B0ciA9IDA7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OCgwKTsKICAgICAgICAgICAgICAgIGJsb2NrUHRyKys7CiAgICAgICAgICAgICAgICBiaXRzNjcgPSAoaGVhZGVyQnl0ZSA+PiA2KSAmIDB4RkY7CiAgICAgICAgICAgICAgICB0ZXN0Q29kZSA9IChoZWFkZXJCeXRlID4+IDIpICYgMTU7ICAgIC8vIHVzZSBiaXRzIDIzNDUgZm9yIGludGVncml0eSBjaGVjawogICAgICAgICAgICAgICAgaWYgKHRlc3RDb2RlICE9PSAoKChibG9ja1ggKiBtaWNyb0Jsb2NrU2l6ZSkgPj4gMykgJiAxNSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgImludGVncml0eSBpc3N1ZSI7CiAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJsb2NrRW5jb2RpbmcgPSBoZWFkZXJCeXRlICYgMzsKICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID4gMykgewogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9ja0VuY29kaW5nICsgIikiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoYmxvY2tFbmNvZGluZyA9PT0gMikgeyAvL2NvbnN0YW50IDAKICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50Kys7CiAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrRW5jb2RpbmcgPT09IDApIHsgIC8vdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICAgIGRhdGEuY291bnRlci51bmNvbXByZXNzZWQrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgIG51bUJ5dGVzID0gdGhpc0Jsb2NrSGVpZ2h0ICogdGhpc0Jsb2NrV2lkdGggKiBkYXRhVHlwZVNpemU7CiAgICAgICAgICAgICAgICAgIGJ5dGVzbGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cjsKICAgICAgICAgICAgICAgICAgbnVtQnl0ZXMgPSBudW1CeXRlcyA8IGJ5dGVzbGVmdCA/IG51bUJ5dGVzIDogYnl0ZXNsZWZ0OwogICAgICAgICAgICAgICAgICAvL2JpdCBhbGlnbm1lbnQKICAgICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoKG51bUJ5dGVzICUgZGF0YVR5cGVTaXplKSA9PT0gMCA/IG51bUJ5dGVzIDogKG51bUJ5dGVzICsgZGF0YVR5cGVTaXplIC0gbnVtQnl0ZXMgJSBkYXRhVHlwZVNpemUpKTsKICAgICAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICAgIHogPSAwOwogICAgICAgICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tbb3V0UHRyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gcmF3RGF0YVt6KytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7Ly9hbGwgdmFsaWQKICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29sID0gMDsgY29sIDwgdGhpc0Jsb2NrV2lkdGg7IGNvbCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSByYXdEYXRhW3orK107CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSB6ICogZGF0YVR5cGVTaXplOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vMSBvciAzCiAgICAgICAgICAgICAgICAgIG9mZnNldFR5cGUgPSBMZXJjMkhlbHBlcnMuZ2V0RGF0YVR5cGVVc2VkKGltYWdlVHlwZSwgYml0czY3KTsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gTGVyYzJIZWxwZXJzLmdldE9uZVBpeGVsKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldyk7CiAgICAgICAgICAgICAgICAgIGJsb2NrUHRyICs9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUob2Zmc2V0VHlwZSk7CiAgICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID09PSAzKSAvL2NvbnN0YW50IG9mZnNldCB2YWx1ZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50b2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgLy95b3UgY2FuIGRlbGV0ZSB0aGUgZm9sbG93aW5nIHJlc3VsdE1hc2sgY2FzZSBpbiBmYXZvciBvZiBwZXJmb3JtYW5jZSBiZWNhdXNlIHZhbCBpcyBjb25zdGFudCBhbmQgdXNlcnMgdXNlIG5vZGF0YSBtYXNrLCBvdGhlcndpc2Ugbm9kYXRhdmFsdWUgcG9zdCBwcm9jZXNzaW5nIGhhbmRsZXMgaXQgdG9vLgogICAgICAgICAgICAgICAgICAgIC8vd2hpbGUgdGhlIGFib3ZlIHN0YXRlbWVudCBpcyB0cnVlLCB3ZSdyZSBub3QgZG9pbmcgaXQgYXMgd2Ugd2FudCB0byBrZWVwIGludmFsaWQgcGl4ZWwgdmFsdWUgYXQgMCByYXRoZXIgdGhhbiBhcmJpdHJhcnkgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2spIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXNrW291dFB0cl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vYml0c3R1ZmYgZW5jb2RpbmcgaXMgMwogICAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICAgIC8vaGVhdnkgbGlmdGluZwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5kZWNvZGVCaXRzKGlucHV0LCBkYXRhLCBibG9ja0RhdGFCdWZmZXIsIG9mZnNldCwgaURpbSk7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFza1tvdXRQdHJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IGJsb2NrRGF0YUJ1ZmZlcltibG9ja1B0cisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gYmxvY2tEYXRhQnVmZmVyW2Jsb2NrUHRyKytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHJpdmF0ZSBtZXRob2RzIChoZWxwZXIgbWV0aG9kcykKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgZm9ybWF0RmlsZUluZm86IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJmaWxlSWRlbnRpZmllclN0cmluZyI6IGRhdGEuaGVhZGVySW5mby5maWxlSWRlbnRpZmllclN0cmluZywKICAgICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5oZWFkZXJJbmZvLmZpbGVWZXJzaW9uLAogICAgICAgICAgICAiaW1hZ2VUeXBlIjogZGF0YS5oZWFkZXJJbmZvLmltYWdlVHlwZSwKICAgICAgICAgICAgImhlaWdodCI6IGRhdGEuaGVhZGVySW5mby5oZWlnaHQsCiAgICAgICAgICAgICJ3aWR0aCI6IGRhdGEuaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgIm51bVZhbGlkUGl4ZWwiOiBkYXRhLmhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCwKICAgICAgICAgICAgIm1pY3JvQmxvY2tTaXplIjogZGF0YS5oZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplLAogICAgICAgICAgICAiYmxvYlNpemUiOiBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUsCiAgICAgICAgICAgICJtYXhaRXJyb3IiOiBkYXRhLmhlYWRlckluZm8ubWF4WkVycm9yLAogICAgICAgICAgICAicGl4ZWxUeXBlIjogTGVyYzJIZWxwZXJzLmdldFBpeGVsVHlwZShkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlKSwKICAgICAgICAgICAgImVvZk9mZnNldCI6IGRhdGEuZW9mT2Zmc2V0LAogICAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgICAibnVtQnl0ZXMiOiBkYXRhLm1hc2subnVtQnl0ZXMKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgICJwaXhlbHMiOiB7CiAgICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAgICJudW1CbG9ja3NZIjogZGF0YS5waXhlbHMubnVtQmxvY2tzWSwKICAgICAgICAgICAgICAvLyJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAgICJtYXhWYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWF4LAogICAgICAgICAgICAgICJtaW5WYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWluLAogICAgICAgICAgICAgICJub0RhdGFWYWx1ZSI6IGRhdGEubm9EYXRhVmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICBjb25zdHJ1Y3RDb25zdGFudFN1cmZhY2U6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHZhciB2YWwgPSBkYXRhLmhlYWRlckluZm8uek1heDsKICAgICAgICAgIHZhciBudW1EaW1zID0gIGRhdGEuaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQgKiBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxBbGxEaW1zID0gbnVtUGl4ZWxzICogbnVtRGltczsKICAgICAgICAgIHZhciBpPTAsIGsgPSAwLCBuU3RhcnQ9MDsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgIGlmIChudW1EaW1zID4gMSkgewogICAgICAgICAgICAgIGZvciAoaT0wOyBpIDwgbnVtRGltczsgaSsrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBpICogbnVtUGl4ZWxzOwogICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW25TdGFydCArIGtdID0gdmFsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc2tba10pIHsKICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW2tdID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMuZmlsbCkgewogICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5maWxsKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsQWxsRGltczsgaysrKSB7CiAgICAgICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHNba10gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVBcnJheTogZnVuY3Rpb24odCkgewogICAgICAgICAgdmFyIHRwOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdHAgPSBJbnQ4QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSBVaW50OEFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9IEludDE2QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzogLy91c2hvcnQKICAgICAgICAgICAgICB0cCA9IFVpbnQxNkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgdHAgPSBJbnQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgdHAgPSBVaW50MzJBcnJheTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHRwID0gRmxvYXQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDY0QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDMyQXJyYXk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UGl4ZWxUeXBlOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgdHA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL2NoYXIKICAgICAgICAgICAgICB0cCA9ICJTOCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSAiVTgiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9ICJTMTYiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgdHAgPSAiVTE2IjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRwID0gIlMzMiI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICB0cCA9ICJVMzIiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgdHAgPSAiRjMyIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIHRwID0gIkY2NCI7IC8vbm90IHN1cHBvcnRlZAogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRwID0gIkYzMiI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgaXNWYWxpZFBpeGVsVmFsdWU6IGZ1bmN0aW9uKHQsIHZhbCkgewogICAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpc1ZhbGlkOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMTI4ICYmIHZhbCA8PSAxMjc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlICAodW5zaWduZWQgY2hhcikKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDAgJiYgdmFsIDw9IDI1NTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAvL3Nob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMzI3NjggJiYgdmFsIDw9IDMyNzY3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAwICYmIHZhbCA8PSA2NTUzNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OiAvL2ludCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTIxNDc0ODM2NDggJiYgdmFsIDw9IDIxNDc0ODM2NDc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNTogLy91aW5pdCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gMCAmJiB2YWwgPD0gNDI5NDk2NzI5NjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTMuNDAyNzk5OTM4NzkwMTQ4NGUrMzggJiYgdmFsIDw9IDMuNDAyNzk5OTM4NzkwMTQ4NGUrMzg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDVlLTMyNCAmJiB2YWwgPD0gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGlzVmFsaWQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVTaXplOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgcyA9IDA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL3VieXRlCiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgcyA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgcyA9IDI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcyA9IDQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBzID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBzID0gdDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sCgogICAgICAgIGdldERhdGFUeXBlVXNlZDogZnVuY3Rpb24oZHQsIHRjKSB7CiAgICAgICAgICB2YXIgdCA9IGR0OwogICAgICAgICAgc3dpdGNoIChkdCkgewogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgY2FzZSA0OiAvL2xvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSB0YzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOiAvL3VzaG9ydAogICAgICAgICAgICBjYXNlIDU6IC8vdWxvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSAyICogdGM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjogLy9mbG9hdAogICAgICAgICAgICAgIGlmICgwID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmICgxID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IDE7Ly9ieXRlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6IC8vZG91YmxlCiAgICAgICAgICAgICAgaWYgKDAgPT09IHRjKSB7CiAgICAgICAgICAgICAgICB0ID0gZHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IGR0IC0gMiAqIHRjICsgMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0T25lUGl4ZWw6IGZ1bmN0aW9uKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldykgewogICAgICAgICAgdmFyIHRlbXAgPSAwOwogICAgICAgICAgc3dpdGNoIChvZmZzZXRUeXBlKSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDgoYmxvY2tQdHIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50MTYoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDE2KGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEludDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldFVJbnQzMihibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICB0ZW1wID0gdmlldy5nZXRGbG9hdDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIC8vdGVtcCA9IHZpZXcuZ2V0RmxvYXQ2NChibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgLy9ibG9ja1B0ciArPSA4OwogICAgICAgICAgICAgIC8vbGVyYzIgZW5jb2RpbmcgZG9lc250IGhhbmRsZSBmbG9hdCA2NCwgZm9yY2UgdG8gZmxvYXQzMj8/PwogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEZsb2F0NjQoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93ICgidGhlIGRlY29kZXIgZG9lcyBub3QgdW5kZXJzdGFuZCB0aGlzIHBpeGVsIHR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgKnByaXZhdGUgY2xhc3MgZm9yIGEgdHJlZSBub2RlLiBIdWZmbWFuIGNvZGUgaXMgaW4gTGVyYzJIZWxwZXJzCiAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBUcmVlTm9kZSA9IGZ1bmN0aW9uKHZhbCwgbGVmdCwgcmlnaHQpIHsKICAgICAgICB0aGlzLnZhbCA9IHZhbDsKICAgICAgICB0aGlzLmxlZnQgPSBsZWZ0OwogICAgICAgIHRoaXMucmlnaHQgPSByaWdodDsKICAgICAgfTsKCiAgICAgIHZhciBMZXJjMkRlY29kZSA9IHsKICAgICAgICAvKgogICAgICAgICogKioqKioqKipyZW1vdmVkIG9wdGlvbnMgY29tcGFyZWQgdG8gTEVSQzEuIFdlIGNhbiBicmluZyBzb21lIG9mIHRoZW0gYmFjayBpZiBuZWVkZWQuCiAgICAgICAgICogcmVtb3ZlZCBwaXhlbCB0eXBlLiBMRVJDMiBpcyB0eXBlZCBhbmQgZG9lc24ndCByZXF1aXJlIHVzZXIgdG8gZ2l2ZSBwaXhlbCB0eXBlCiAgICAgICAgICogY2hhbmdlZCBlbmNvZGVkTWFza0RhdGEgdG8gbWFza0RhdGEuIExFUkMyICdzIGpzIHZlcnNpb24gbWFrZSBpdCBmYXN0ZXIgdG8gdXNlIG1hc2tEYXRhIGRpcmVjdGx5LgogICAgICAgICAqIHJlbW92ZWQgcmV0dXJuTWFzay4gbWFzayBpcyB1c2VkIGJ5IExFUkMyIGludGVybmFsbHkgYW5kIGlzIGNvc3QgZnJlZS4gSW4gY2FzZSBvZiB1c2VyIGlucHV0IG1hc2ssIGl0J3MgcmV0dXJuZWQgYXMgd2VsbCBhbmQgaGFzIG5lZ2xpYmxlIGNvc3QuCiAgICAgICAgICogcmVtb3ZlZCBub2RhdGF2YWx1ZS4gQmVjYXVzZSBMRVJDMiBwaXhlbHMgYXJlIHR5cGVkLCBub2RhdGF2YWx1ZSB3aWxsIHNhY3JpZnkgYSB1c2VmdWwgdmFsdWUgZm9yIG1hbnkgdHlwZXMgKDhiaXQsIDE2Yml0KSBldGMsCiAgICAgICAgICogICAgICAgdXNlciBoYXMgdG8gYmUga25vd2xlZGdhYmxlIGVub3VnaCBhYm91dCByYXN0ZXIgYW5kIHRoZWlyIGRhdGEgdG8gYXZvaWQgdXNhYmlsaXR5IGlzc3Vlcy4gc28gbm9kYXRhIHZhbHVlIGlzIHNpbXBseSByZW1vdmVkIG5vdy4KICAgICAgICAgKiAgICAgICBXZSBjYW4gYWRkIGl0IGJhY2sgbGF0ZXIgaWYgdGhlaXIncyBhIGNsZWFyIHJlcXVpcmVtZW50LgogICAgICAgICAqIHJlbW92ZWQgZW5jb2RlZE1hc2suIFRoaXMgb3B0aW9uIHdhcyBub3QgaW1wbGVtZW50ZWQgaW4gTGVyY0RlY29kZS4gSXQgY2FuIGJlIGRvbmUgYWZ0ZXIgZGVjb2RpbmcgKGxlc3MgZWZmaWNpZW50KQogICAgICAgICAqIHJlbW92ZWQgY29tcHV0ZVVzZWRCaXREZXB0aHMuCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIHJlc3BvbnNlIGNoYW5nZXMgY29tcGFyZWQgdG8gTEVSQzEKICAgICAgICAgKiAxLiBlbmNvZGVkTWFza0RhdGEgaXMgbm90IGF2YWlsYWJsZQogICAgICAgICAqIDIuIG5vRGF0YVZhbHVlIGlzIG9wdGlvbmFsIChyZXR1cm5zIG9ubHkgaWYgdXNlcidzIG5vRGF0YVZhbHVlIGlzIHdpdGggaW4gdGhlIHZhbGlkIGRhdGEgdHlwZSByYW5nZSkKICAgICAgICAgKiAzLiBtYXNrRGF0YSBpcyBhbHdheXMgYXZhaWxhYmxlCiAgICAgICAgKi8KICAgICAgICAvKioqKioqKioqKioqKioqKioKICAgICAgICAqICBwdWJsaWMgcHJvcGVydGllcwogICAgICAgICoqKioqKioqKioqKioqKioqKi8KICAgICAgICAvL0hVRkZNQU5fTFVUX0JJVFNfTUFYOiAxMiwgLy91c2UgMl4xMiBsdXQsIG5vdCBjb25maWd1cmFibGUKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHVibGljIG1ldGhvZHMKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlIGEgTEVSQzIgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgb3B0aW9uYWwgbWV0YWRhdGEuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBpbnB1dCBUaGUgTEVSQyBpbnB1dCBieXRlIHN0cmVhbQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gb3B0aW9ucyBEZWNvZGluZyBvcHRpb25zCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmlucHV0T2Zmc2V0XSBUaGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHNraXAgaW4gdGhlIGlucHV0IGJ5dGUgc3RyZWFtLiBBIHZhbGlkIExFUkMgZmlsZSBpcyBleHBlY3RlZCBhdCB0aGF0IHBvc2l0aW9uCiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5yZXR1cm5GaWxlSW5mb10gSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGhhdmUgYSBmaWxlSW5mbyBwcm9wZXJ0eSB0aGF0IGNvbnRhaW5zIG1ldGFkYXRhIG9idGFpbmVkIGZyb20gdGhlIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MKICAgICAgICAgKi8KICAgICAgICBkZWNvZGU6IGZ1bmN0aW9uKC8qYnl0ZSBhcnJheSovIGlucHV0LCAvKm9iamVjdCovIG9wdGlvbnMpIHsKICAgICAgICAgIC8vY3VycmVudGx5IHRoZXJlJ3MgYSBidWcgaW4gdGhlIHNwYXJzZSBhcnJheSwgc28gcGxlYXNlIGRvIG5vdCBzZXQgdG8gZmFsc2UKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIG5vRGF0YVZhbHVlID0gb3B0aW9ucy5ub0RhdGFWYWx1ZTsKCiAgICAgICAgICAvL2luaXRpYWxpemUKICAgICAgICAgIHZhciBpID0gMCwgZGF0YSA9IHt9OwogICAgICAgICAgZGF0YS5wdHIgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwoKICAgICAgICAgIC8vIEZpbGUgaGVhZGVyCiAgICAgICAgICBpZiAoIUxlcmMySGVscGVycy5yZWFkSGVhZGVySW5mbyhpbnB1dCwgZGF0YSkpIDsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIGZpbGVWZXJzaW9uID0gaGVhZGVySW5mby5maWxlVmVyc2lvbjsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZUFycmF5KGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKCiAgICAgICAgICAvLyBNYXNrIEhlYWRlcgogICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRNYXNrKGlucHV0LCBkYXRhKTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodCAmJiAhZGF0YS5waXhlbHMucmVzdWx0TWFzaykgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRNYXNrID0gb3B0aW9ucy5tYXNrRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gaGVhZGVySW5mby53aWR0aCAqIGhlYWRlckluZm8uaGVpZ2h0OwogICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KG51bVBpeGVscyAqIGhlYWRlckluZm8ubnVtRGltcyk7CgogICAgICAgICAgZGF0YS5jb3VudGVyID0gewogICAgICAgICAgICBvbmVzd2VlcDogMCwKICAgICAgICAgICAgdW5jb21wcmVzc2VkOiAwLAogICAgICAgICAgICBsdXQ6IDAsCiAgICAgICAgICAgIGJpdHN0dWZmZXI6IDAsCiAgICAgICAgICAgIGNvbnN0YW50OiAwLAogICAgICAgICAgICBjb25zdGFudG9mZnNldDogMAogICAgICAgICAgfTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IDApIHsKICAgICAgICAgICAgLy9ub3QgdGVzdGVkCiAgICAgICAgICAgIGlmIChoZWFkZXJJbmZvLnpNYXggPT09IGhlYWRlckluZm8uek1pbikgLy9jb25zdGFudCBzdXJmYWNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMuY29uc3RydWN0Q29uc3RhbnRTdXJmYWNlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVWZXJzaW9uID49IDQgJiYgTGVyYzJIZWxwZXJzLmNoZWNrTWluTWF4UmFuZ2VzKGlucHV0LCBkYXRhKSkgewogICAgICAgICAgICAgIExlcmMySGVscGVycy5jb25zdHJ1Y3RDb25zdGFudFN1cmZhY2UoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGRhdGEucHRyLCAyKTsKICAgICAgICAgICAgICB2YXIgYlJlYWREYXRhT25lU3dlZXAgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICAgIGRhdGEucHRyKys7CiAgICAgICAgICAgICAgaWYgKGJSZWFkRGF0YU9uZVN3ZWVwKSB7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoIk9uZVN3ZWVwIik7CiAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZERhdGFPbmVTd2VlcChpbnB1dCwgZGF0YSwgT3V0UGl4ZWxUeXBlQXJyYXkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vbGVyYzIuMTogLy9iaXRzdHVmZmluZyArIGx1dAogICAgICAgICAgICAgICAgLy9sZXJjMi4yOiAvL2JpdHN0dWZmaW5nICsgbHV0ICsgaHVmZm1hbgogICAgICAgICAgICAgICAgLy9sZXJjMi4zOiBuZXcgYml0c3R1ZmZlcgogICAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID4gMSAmJiBoZWFkZXJJbmZvLmltYWdlVHlwZSA8PSAxICYmIE1hdGguYWJzKGhlYWRlckluZm8ubWF4WkVycm9yIC0gMC41KSA8IDAuMDAwMDEpIHsKICAgICAgICAgICAgICAgICAgLy90aGlzIGlzIDIueCBwbHVzIDggYml0ICh1bnNpZ25lZCBhbmQgc2lnbmVkKSBkYXRhLCBwb3NzaWJsaXR5IG9mIEh1ZmZtYW4KICAgICAgICAgICAgICAgICAgdmFyIGZsYWdIdWZmbWFuID0gdmlldy5nZXRVaW50OCgxKTsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5lbmNvZGVNb2RlID0gZmxhZ0h1ZmZtYW47CiAgICAgICAgICAgICAgICAgIGlmIChmbGFnSHVmZm1hbiA+IDIgfHwgKGZpbGVWZXJzaW9uIDwgNCAmJiBmbGFnSHVmZm1hbiA+IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgSHVmZm1hbiBmbGFnICIgKyBmbGFnSHVmZm1hbjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZmxhZ0h1ZmZtYW4pIHsvLzEgLSBkZWx0YSBIdWZmbWFuLCAyIC0gSHVmZm1hbgogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkh1ZmZtYW4iKTsKICAgICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZEh1ZmZtYW4oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5yZWFkVGlsZXMoaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vbGVyYzIueCBub24tOCBiaXQgZGF0YQogICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZFRpbGVzKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBkaWZmOwogICAgICAgICAgaWYgKG9wdGlvbnMuaW5wdXRPZmZzZXQpIHsKICAgICAgICAgICAgZGlmZiA9IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSArIG9wdGlvbnMuaW5wdXRPZmZzZXQgLSBkYXRhLnB0cjsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmYpID49IDEpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImluY29ycmVjdCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBvZmZzZXQgIiArIG9wdGlvbnMuaW5wdXRPZmZzZXQgKyAiIGJsb2JzaXplICIgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUgKyAiIGRpZmY6ICIgKyBkaWZmKTsKICAgICAgICAgICAgICBkYXRhLmVvZk9mZnNldCA9IG9wdGlvbnMuaW5wdXRPZmZzZXQgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBkaWZmID0gZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplIC0gZGF0YS5wdHI7CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmKSA+PSAxKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJpbmNvcnJlY3QgZmlyc3QgYmFuZCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBibG9ic2l6ZSAiICsgZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplICsgIiBkaWZmOiAiICsgZGlmZik7CiAgICAgICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgICB3aWR0aDogaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWFkZXJJbmZvLmhlaWdodCwKICAgICAgICAgICAgcGl4ZWxEYXRhOiBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMsCiAgICAgICAgICAgIG1pblZhbHVlOiBoZWFkZXJJbmZvLnpNaW4sCiAgICAgICAgICAgIG1heFZhbHVlOiBoZWFkZXJJbmZvLnpNYXgsCiAgICAgICAgICAgIHZhbGlkUGl4ZWxDb3VudDogaGVhZGVySW5mby5udW1WYWxpZFBpeGVsLAogICAgICAgICAgICBkaW1Db3VudDogaGVhZGVySW5mby5udW1EaW1zLAogICAgICAgICAgICBkaW1TdGF0czogewogICAgICAgICAgICAgIG1pblZhbHVlczogaGVhZGVySW5mby5taW5WYWx1ZXMsCiAgICAgICAgICAgICAgbWF4VmFsdWVzOiBoZWFkZXJJbmZvLm1heFZhbHVlcwogICAgICAgICAgICB9LAogICAgICAgICAgICBtYXNrRGF0YTogZGF0YS5waXhlbHMucmVzdWx0TWFzawogICAgICAgICAgICAvL25vRGF0YVZhbHVlOiBub0RhdGFWYWx1ZQogICAgICAgICAgfTsKCiAgICAgICAgICAvL3dlIHNob3VsZCByZW1vdmUgdGhpcyBpZiB0aGVyZSdzIG5vIGV4aXN0aW5nIGNsaWVudAogICAgICAgICAgLy9vcHRpb25hbCBub0RhdGFWYWx1ZSBwcm9jZXNzaW5nLCBpdCdzIHVzZXIncyByZXNwb25zaWJsaXR5CiAgICAgICAgICBpZiAoZGF0YS5waXhlbHMucmVzdWx0TWFzayAmJiBMZXJjMkhlbHBlcnMuaXNWYWxpZFBpeGVsVmFsdWUoaGVhZGVySW5mby5pbWFnZVR5cGUsIG5vRGF0YVZhbHVlKSkgewogICAgICAgICAgICB2YXIgbWFzayA9IGRhdGEucGl4ZWxzLnJlc3VsdE1hc2s7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1QaXhlbHM7IGkrKykgewogICAgICAgICAgICAgIGlmICghbWFza1tpXSkgewogICAgICAgICAgICAgICAgcmVzdWx0LnBpeGVsRGF0YVtpXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIGlmIChvcHRpb25zLnJldHVybkZpbGVJbmZvKSB7CiAgICAgICAgICAgIHJlc3VsdC5maWxlSW5mbyA9IExlcmMySGVscGVycy5mb3JtYXRGaWxlSW5mbyhkYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0QmFuZENvdW50OiBmdW5jdGlvbigvKmJ5dGUgYXJyYXkqLyBpbnB1dCkgewogICAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHZhciB0ZW1wID0ge307CiAgICAgICAgICB0ZW1wLnB0ciA9IDA7CiAgICAgICAgICB0ZW1wLnBpeGVscyA9IHt9OwogICAgICAgICAgd2hpbGUgKGkgPCBpbnB1dC5ieXRlTGVuZ3RoIC0gNTgpIHsKICAgICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRIZWFkZXJJbmZvKGlucHV0LCB0ZW1wKTsKICAgICAgICAgICAgaSArPSB0ZW1wLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIHRlbXAucHRyID0gaTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gTGVyYzJEZWNvZGU7CiAgICB9KSgpOwoKICAgIHZhciBpc1BsYXRmb3JtTGl0dGxlRW5kaWFuID0gKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IG5ldyBBcnJheUJ1ZmZlcig0KTsKICAgICAgdmFyIGIgPSBuZXcgVWludDhBcnJheShhKTsKICAgICAgdmFyIGMgPSBuZXcgVWludDMyQXJyYXkoYSk7CiAgICAgIGNbMF0gPSAxOwogICAgICByZXR1cm4gYlswXSA9PT0gMTsKICAgIH0pKCk7CgogICAgdmFyIExlcmMgPSB7CiAgICAgIC8qKioqKioqKioqKip3cmFwcGVyKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqCiAgICAgICAqIEEgd3JhcHBlciBmb3IgZGVjb2RpbmcgYm90aCBMRVJDMSBhbmQgTEVSQzIgYnl0ZSBzdHJlYW1zIGNhcGFibGUgb2YgaGFuZGxpbmcgbXVsdGliYW5kIHBpeGVsIGJsb2NrcyBmb3IgdmFyaW91cyBwaXhlbCB0eXBlcy4KICAgICAgICoKICAgICAgICogQGFsaWFzIG1vZHVsZTpMZXJjCiAgICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGlucHV0IFRoZSBMRVJDIGlucHV0IGJ5dGUgc3RyZWFtCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gVGhlIGRlY29kaW5nIG9wdGlvbnMgYmVsb3cgYXJlIG9wdGlvbmFsLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuaW5wdXRPZmZzZXRdIFRoZSBudW1iZXIgb2YgYnl0ZXMgdG8gc2tpcCBpbiB0aGUgaW5wdXQgYnl0ZSBzdHJlYW0uIEEgdmFsaWQgTGVyYyBmaWxlIGlzIGV4cGVjdGVkIGF0IHRoYXQgcG9zaXRpb24uCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5waXhlbFR5cGVdIChMRVJDMSBvbmx5KSBEZWZhdWx0IHZhbHVlIGlzIEYzMi4gVmFsaWQgcGl4ZWwgdHlwZXMgZm9yIGlucHV0IGFyZSBVOC9TOC9TMTYvVTE2L1MzMi9VMzIvRjMyLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubm9EYXRhVmFsdWVdIChMRVJDMSBvbmx5KS4gSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoZSByZXR1cm5lZCBtYXNrIGluc3RlYWQgb2Ygc2V0dGluZyB0aGlzIHZhbHVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVscywgcGl4ZWxUeXBlLCBtYXNrLCBzdGF0aXN0aWNzfX0KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggV2lkdGggb2YgZGVjb2RlZCBpbWFnZS4KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IEhlaWdodCBvZiBkZWNvZGVkIGltYWdlLgogICAgICAgICAqIEBwcm9wZXJ0eSB7YXJyYXl9IHBpeGVscyBbYmFuZDEsIGJhbmQyLCDigKZdIEVhY2ggYmFuZCBpcyBhIHR5cGVkIGFycmF5IG9mIHdpZHRoKmhlaWdodC4KICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGl4ZWxUeXBlIFRoZSB0eXBlIG9mIHBpeGVscyByZXByZXNlbnRlZCBpbiB0aGUgb3V0cHV0LgogICAgICAgICAqIEBwcm9wZXJ0eSB7bWFza30gbWFzayBUeXBlZCBhcnJheSB3aXRoIGEgc2l6ZSBvZiB3aWR0aCpoZWlnaHQsIG9yIG51bGwgaWYgYWxsIHBpeGVscyBhcmUgdmFsaWQuCiAgICAgICAgICogQHByb3BlcnR5IHthcnJheX0gc3RhdGlzdGljcyBbc3RhdGlzdGljc19iYW5kMSwgc3RhdGlzdGljc19iYW5kMiwg4oCmXSBFYWNoIGVsZW1lbnQgaXMgYSBzdGF0aXN0aWNzIG9iamVjdCByZXByZXNlbnRpbmcgbWluIGFuZCBtYXggdmFsdWVzCiAgICAgICoqLwogICAgICBkZWNvZGU6IGZ1bmN0aW9uKGVuY29kZWREYXRhLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKCFpc1BsYXRmb3JtTGl0dGxlRW5kaWFuKSB7CiAgICAgICAgICB0aHJvdyAiQmlnIGVuZGlhbiBzeXN0ZW0gaXMgbm90IHN1cHBvcnRlZC4iOwogICAgICAgIH0KICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgaW5wdXRPZmZzZXQgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgdmFyIGZpbGVJZFZpZXcgPSBuZXcgVWludDhBcnJheShlbmNvZGVkRGF0YSwgaW5wdXRPZmZzZXQsIDEwKTsKICAgICAgICB2YXIgZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIHZhciBsZXJjLCBtYWpvclZlcnNpb247CiAgICAgICAgaWYgKGZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSA9PT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIGxlcmMgPSBMZXJjRGVjb2RlOwogICAgICAgICAgbWFqb3JWZXJzaW9uID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZmlsZUlkZW50aWZpZXJTdHJpbmcuc3Vic3RyaW5nKDAsIDUpID09PSAiTGVyYzIiKSB7CiAgICAgICAgICBsZXJjID0gTGVyYzJEZWNvZGU7CiAgICAgICAgICBtYWpvclZlcnNpb24gPSAyOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBmaWxlSWRlbnRpZmllclN0cmluZzsKICAgICAgICB9CgogICAgICAgIHZhciBpUGxhbmUgPSAwLCBlb2YgPSBlbmNvZGVkRGF0YS5ieXRlTGVuZ3RoIC0gMTAsIGVuY29kZWRNYXNrRGF0YSwgYmFuZE1hc2tzID0gW10sIGJhbmRNYXNrLCBtYXNrRGF0YTsKICAgICAgICB2YXIgZGVjb2RlZFBpeGVsQmxvY2sgPSB7CiAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgIHBpeGVsczogW10sCiAgICAgICAgICBwaXhlbFR5cGU6IG9wdGlvbnMucGl4ZWxUeXBlLAogICAgICAgICAgbWFzazogbnVsbCwKICAgICAgICAgIHN0YXRpc3RpY3M6IFtdCiAgICAgICAgfTsKCiAgICAgICAgd2hpbGUgKGlucHV0T2Zmc2V0IDwgZW9mKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbGVyYy5kZWNvZGUoZW5jb2RlZERhdGEsIHsKICAgICAgICAgICAgaW5wdXRPZmZzZXQ6IGlucHV0T2Zmc2V0LC8vZm9yIGJvdGggbGVyYzEgYW5kIGxlcmMyCiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YTogZW5jb2RlZE1hc2tEYXRhLC8vbGVyYzEgb25seQogICAgICAgICAgICBtYXNrRGF0YTogbWFza0RhdGEsLy9sZXJjMiBvbmx5CiAgICAgICAgICAgIHJldHVybk1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRW5jb2RlZE1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRmlsZUluZm86IHRydWUsLy9mb3IgYm90aCBsZXJjMSBhbmQgbGVyYzIKICAgICAgICAgICAgcGl4ZWxUeXBlOiBvcHRpb25zLnBpeGVsVHlwZSB8fCBudWxsLC8vbGVyYzEgb25seQogICAgICAgICAgICBub0RhdGFWYWx1ZTogb3B0aW9ucy5ub0RhdGFWYWx1ZSB8fCBudWxsLy9sZXJjMSBvbmx5CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpbnB1dE9mZnNldCA9IHJlc3VsdC5maWxlSW5mby5lb2ZPZmZzZXQ7CiAgICAgICAgICBpZiAoaVBsYW5lID09PSAwKSB7CiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YSA9IHJlc3VsdC5lbmNvZGVkTWFza0RhdGE7Ly9sZXJjMQogICAgICAgICAgICBtYXNrRGF0YSA9IHJlc3VsdC5tYXNrRGF0YTsvL2xlcmMyCiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLndpZHRoID0gcmVzdWx0LndpZHRoOwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5oZWlnaHQgPSByZXN1bHQuaGVpZ2h0OwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5kaW1Db3VudCA9IHJlc3VsdC5kaW1Db3VudCB8fCAxOwogICAgICAgICAgICAvL2RlY29kZWRQaXhlbEJsb2NrLmRpbVN0YXRzID0gZGVjb2RlZFBpeGVsQmxvY2suZGltU3RhdHM7CiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnBpeGVsVHlwZSA9IHJlc3VsdC5waXhlbFR5cGUgfHwgcmVzdWx0LmZpbGVJbmZvLnBpeGVsVHlwZTsKICAgICAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2subWFzayA9IHJlc3VsdC5tYXNrRGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYWpvclZlcnNpb24gPjEgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2sgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJhbmRNYXNrcy5wdXNoKHJlc3VsdC5tYXNrRGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaVBsYW5lKys7CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5waXhlbHMucHVzaChyZXN1bHQucGl4ZWxEYXRhKTsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnN0YXRpc3RpY3MucHVzaCh7CiAgICAgICAgICAgIG1pblZhbHVlOiByZXN1bHQubWluVmFsdWUsCiAgICAgICAgICAgIG1heFZhbHVlOiByZXN1bHQubWF4VmFsdWUsCiAgICAgICAgICAgIG5vRGF0YVZhbHVlOiByZXN1bHQubm9EYXRhVmFsdWUsCiAgICAgICAgICAgIGRpbVN0YXRzOiByZXN1bHQuZGltU3RhdHMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB2YXIgaSwgaiwgbnVtUGl4ZWxzOwogICAgICAgIGlmIChtYWpvclZlcnNpb24gPiAxICYmIGJhbmRNYXNrcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBudW1QaXhlbHMgPSBkZWNvZGVkUGl4ZWxCbG9jay53aWR0aCAqIGRlY29kZWRQaXhlbEJsb2NrLmhlaWdodDsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLmJhbmRNYXNrcyA9IGJhbmRNYXNrczsKICAgICAgICAgIG1hc2tEYXRhID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgIG1hc2tEYXRhLnNldChiYW5kTWFza3NbMF0pOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8IGJhbmRNYXNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBiYW5kTWFzayA9IGJhbmRNYXNrc1tpXTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bVBpeGVsczsgaisrKSB7CiAgICAgICAgICAgICAgbWFza0RhdGFbal0gPSBtYXNrRGF0YVtqXSAmIGJhbmRNYXNrW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5tYXNrRGF0YSA9IG1hc2tEYXRhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRlY29kZWRQaXhlbEJsb2NrOwogICAgICB9CiAgICB9OwoKICAgIGlmIChtb2R1bGUuZXhwb3J0cykgey8qIGpzaGludCBpZ25vcmU6bGluZSAqLwogICAgICAvL2NvbW1vbkpTIG1vZHVsZSAxLjAvMS4xLzEuMS4xIHN5c3RlbXMsIHN1Y2ggYXMgbm9kZUpTCiAgICAgIC8vaHR0cDovL3dpa2kuY29tbW9uanMub3JnL3dpa2kvTW9kdWxlcwogICAgICBtb2R1bGUuZXhwb3J0cyA9IExlcmM7LyoganNoaW50IGlnbm9yZTpsaW5lICovCiAgICB9CiAgICBlbHNlIHsKICAgICAgLy9hc3NpZ24gdG8gdGhpcywgbW9zdCBsaWtlbHkgd2luZG93CiAgICAgIHRoaXMuTGVyYyA9IExlcmM7CiAgICB9CgogIH0pKCk7CiAgfShMZXJjRGVjb2RlKSk7CgogIHZhciBMZXJjID0gTGVyY0RlY29kZS5leHBvcnRzOwoKICBjb25zdCBmaWVsZFRhZ05hbWVzID0gewogICAgLy8gVElGRiBCYXNlbGluZQogICAgMHgwMTNCOiAnQXJ0aXN0JywKICAgIDB4MDEwMjogJ0JpdHNQZXJTYW1wbGUnLAogICAgMHgwMTA5OiAnQ2VsbExlbmd0aCcsCiAgICAweDAxMDg6ICdDZWxsV2lkdGgnLAogICAgMHgwMTQwOiAnQ29sb3JNYXAnLAogICAgMHgwMTAzOiAnQ29tcHJlc3Npb24nLAogICAgMHg4Mjk4OiAnQ29weXJpZ2h0JywKICAgIDB4MDEzMjogJ0RhdGVUaW1lJywKICAgIDB4MDE1MjogJ0V4dHJhU2FtcGxlcycsCiAgICAweDAxMEE6ICdGaWxsT3JkZXInLAogICAgMHgwMTIxOiAnRnJlZUJ5dGVDb3VudHMnLAogICAgMHgwMTIwOiAnRnJlZU9mZnNldHMnLAogICAgMHgwMTIzOiAnR3JheVJlc3BvbnNlQ3VydmUnLAogICAgMHgwMTIyOiAnR3JheVJlc3BvbnNlVW5pdCcsCiAgICAweDAxM0M6ICdIb3N0Q29tcHV0ZXInLAogICAgMHgwMTBFOiAnSW1hZ2VEZXNjcmlwdGlvbicsCiAgICAweDAxMDE6ICdJbWFnZUxlbmd0aCcsCiAgICAweDAxMDA6ICdJbWFnZVdpZHRoJywKICAgIDB4MDEwRjogJ01ha2UnLAogICAgMHgwMTE5OiAnTWF4U2FtcGxlVmFsdWUnLAogICAgMHgwMTE4OiAnTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTEwOiAnTW9kZWwnLAogICAgMHgwMEZFOiAnTmV3U3ViZmlsZVR5cGUnLAogICAgMHgwMTEyOiAnT3JpZW50YXRpb24nLAogICAgMHgwMTA2OiAnUGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbicsCiAgICAweDAxMUM6ICdQbGFuYXJDb25maWd1cmF0aW9uJywKICAgIDB4MDEyODogJ1Jlc29sdXRpb25Vbml0JywKICAgIDB4MDExNjogJ1Jvd3NQZXJTdHJpcCcsCiAgICAweDAxMTU6ICdTYW1wbGVzUGVyUGl4ZWwnLAogICAgMHgwMTMxOiAnU29mdHdhcmUnLAogICAgMHgwMTE3OiAnU3RyaXBCeXRlQ291bnRzJywKICAgIDB4MDExMTogJ1N0cmlwT2Zmc2V0cycsCiAgICAweDAwRkY6ICdTdWJmaWxlVHlwZScsCiAgICAweDAxMDc6ICdUaHJlc2hob2xkaW5nJywKICAgIDB4MDExQTogJ1hSZXNvbHV0aW9uJywKICAgIDB4MDExQjogJ1lSZXNvbHV0aW9uJywKCiAgICAvLyBUSUZGIEV4dGVuZGVkCiAgICAweDAxNDY6ICdCYWRGYXhMaW5lcycsCiAgICAweDAxNDc6ICdDbGVhbkZheERhdGEnLAogICAgMHgwMTU3OiAnQ2xpcFBhdGgnLAogICAgMHgwMTQ4OiAnQ29uc2VjdXRpdmVCYWRGYXhMaW5lcycsCiAgICAweDAxQjE6ICdEZWNvZGUnLAogICAgMHgwMUIyOiAnRGVmYXVsdEltYWdlQ29sb3InLAogICAgMHgwMTBEOiAnRG9jdW1lbnROYW1lJywKICAgIDB4MDE1MDogJ0RvdFJhbmdlJywKICAgIDB4MDE0MTogJ0hhbGZ0b25lSGludHMnLAogICAgMHgwMTVBOiAnSW5kZXhlZCcsCiAgICAweDAxNUI6ICdKUEVHVGFibGVzJywKICAgIDB4MDExRDogJ1BhZ2VOYW1lJywKICAgIDB4MDEyOTogJ1BhZ2VOdW1iZXInLAogICAgMHgwMTNEOiAnUHJlZGljdG9yJywKICAgIDB4MDEzRjogJ1ByaW1hcnlDaHJvbWF0aWNpdGllcycsCiAgICAweDAyMTQ6ICdSZWZlcmVuY2VCbGFja1doaXRlJywKICAgIDB4MDE1MzogJ1NhbXBsZUZvcm1hdCcsCiAgICAweDAxNTQ6ICdTTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTU1OiAnU01heFNhbXBsZVZhbHVlJywKICAgIDB4MDIyRjogJ1N0cmlwUm93Q291bnRzJywKICAgIDB4MDE0QTogJ1N1YklGRHMnLAogICAgMHgwMTI0OiAnVDRPcHRpb25zJywKICAgIDB4MDEyNTogJ1Q2T3B0aW9ucycsCiAgICAweDAxNDU6ICdUaWxlQnl0ZUNvdW50cycsCiAgICAweDAxNDM6ICdUaWxlTGVuZ3RoJywKICAgIDB4MDE0NDogJ1RpbGVPZmZzZXRzJywKICAgIDB4MDE0MjogJ1RpbGVXaWR0aCcsCiAgICAweDAxMkQ6ICdUcmFuc2ZlckZ1bmN0aW9uJywKICAgIDB4MDEzRTogJ1doaXRlUG9pbnQnLAogICAgMHgwMTU4OiAnWENsaXBQYXRoVW5pdHMnLAogICAgMHgwMTFFOiAnWFBvc2l0aW9uJywKICAgIDB4MDIxMTogJ1lDYkNyQ29lZmZpY2llbnRzJywKICAgIDB4MDIxMzogJ1lDYkNyUG9zaXRpb25pbmcnLAogICAgMHgwMjEyOiAnWUNiQ3JTdWJTYW1wbGluZycsCiAgICAweDAxNTk6ICdZQ2xpcFBhdGhVbml0cycsCiAgICAweDAxMUY6ICdZUG9zaXRpb24nLAoKICAgIC8vIEVYSUYKICAgIDB4OTIwMjogJ0FwZXJ0dXJlVmFsdWUnLAogICAgMHhBMDAxOiAnQ29sb3JTcGFjZScsCiAgICAweDkwMDQ6ICdEYXRlVGltZURpZ2l0aXplZCcsCiAgICAweDkwMDM6ICdEYXRlVGltZU9yaWdpbmFsJywKICAgIDB4ODc2OTogJ0V4aWYgSUZEJywKICAgIDB4OTAwMDogJ0V4aWZWZXJzaW9uJywKICAgIDB4ODI5QTogJ0V4cG9zdXJlVGltZScsCiAgICAweEEzMDA6ICdGaWxlU291cmNlJywKICAgIDB4OTIwOTogJ0ZsYXNoJywKICAgIDB4QTAwMDogJ0ZsYXNocGl4VmVyc2lvbicsCiAgICAweDgyOUQ6ICdGTnVtYmVyJywKICAgIDB4QTQyMDogJ0ltYWdlVW5pcXVlSUQnLAogICAgMHg5MjA4OiAnTGlnaHRTb3VyY2UnLAogICAgMHg5MjdDOiAnTWFrZXJOb3RlJywKICAgIDB4OTIwMTogJ1NodXR0ZXJTcGVlZFZhbHVlJywKICAgIDB4OTI4NjogJ1VzZXJDb21tZW50JywKCiAgICAvLyBJUFRDCiAgICAweDgzQkI6ICdJUFRDJywKCiAgICAvLyBJQ0MKICAgIDB4ODc3MzogJ0lDQyBQcm9maWxlJywKCiAgICAvLyBYTVAKICAgIDB4MDJCQzogJ1hNUCcsCgogICAgLy8gR0RBTAogICAgMHhBNDgwOiAnR0RBTF9NRVRBREFUQScsCiAgICAweEE0ODE6ICdHREFMX05PREFUQScsCgogICAgLy8gUGhvdG9zaG9wCiAgICAweDg2NDk6ICdQaG90b3Nob3AnLAoKICAgIC8vIEdlb1RpZmYKICAgIDB4ODMwRTogJ01vZGVsUGl4ZWxTY2FsZScsCiAgICAweDg0ODI6ICdNb2RlbFRpZXBvaW50JywKICAgIDB4ODVEODogJ01vZGVsVHJhbnNmb3JtYXRpb24nLAogICAgMHg4N0FGOiAnR2VvS2V5RGlyZWN0b3J5JywKICAgIDB4ODdCMDogJ0dlb0RvdWJsZVBhcmFtcycsCiAgICAweDg3QjE6ICdHZW9Bc2NpaVBhcmFtcycsCgogICAgLy8gTEVSQwogICAgMHhDNUYyOiAnTGVyY1BhcmFtZXRlcnMnLAogIH07CgogIGNvbnN0IGZpZWxkVGFncyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGZpZWxkVGFnTmFtZXMpIHsKICAgIGlmIChmaWVsZFRhZ05hbWVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgZmllbGRUYWdzW2ZpZWxkVGFnTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIFsKICAgIGZpZWxkVGFncy5CaXRzUGVyU2FtcGxlLAogICAgZmllbGRUYWdzLkV4dHJhU2FtcGxlcywKICAgIGZpZWxkVGFncy5TYW1wbGVGb3JtYXQsCiAgICBmaWVsZFRhZ3MuU3RyaXBCeXRlQ291bnRzLAogICAgZmllbGRUYWdzLlN0cmlwT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdHJpcFJvd0NvdW50cywKICAgIGZpZWxkVGFncy5UaWxlQnl0ZUNvdW50cywKICAgIGZpZWxkVGFncy5UaWxlT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdWJJRkRzLAogIF07CgogIGNvbnN0IGZpZWxkVHlwZU5hbWVzID0gewogICAgMHgwMDAxOiAnQllURScsCiAgICAweDAwMDI6ICdBU0NJSScsCiAgICAweDAwMDM6ICdTSE9SVCcsCiAgICAweDAwMDQ6ICdMT05HJywKICAgIDB4MDAwNTogJ1JBVElPTkFMJywKICAgIDB4MDAwNjogJ1NCWVRFJywKICAgIDB4MDAwNzogJ1VOREVGSU5FRCcsCiAgICAweDAwMDg6ICdTU0hPUlQnLAogICAgMHgwMDA5OiAnU0xPTkcnLAogICAgMHgwMDBBOiAnU1JBVElPTkFMJywKICAgIDB4MDAwQjogJ0ZMT0FUJywKICAgIDB4MDAwQzogJ0RPVUJMRScsCiAgICAvLyBJRkQgb2Zmc2V0LCBzdWdnZXN0ZWQgYnkgaHR0cHM6Ly9vd2wucGh5LnF1ZWVuc3UuY2EvfnBoaWwvZXhpZnRvb2wvc3RhbmRhcmRzLmh0bWwKICAgIDB4MDAwRDogJ0lGRCcsCiAgICAvLyBpbnRyb2R1Y2VkIGJ5IEJpZ1RJRkYKICAgIDB4MDAxMDogJ0xPTkc4JywKICAgIDB4MDAxMTogJ1NMT05HOCcsCiAgICAweDAwMTI6ICdJRkQ4JywKICB9OwoKICBjb25zdCBmaWVsZFR5cGVzID0ge307CiAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRUeXBlTmFtZXMpIHsKICAgIGlmIChmaWVsZFR5cGVOYW1lcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIGZpZWxkVHlwZXNbZmllbGRUeXBlTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIGNvbnN0IExlcmNQYXJhbWV0ZXJzID0gewogICAgVmVyc2lvbjogMCwKICAgIEFkZENvbXByZXNzaW9uOiAxLAogIH07CgogIGNvbnN0IExlcmNBZGRDb21wcmVzc2lvbiA9IHsKICAgIE5vbmU6IDAsCiAgICBEZWZsYXRlOiAxLAogIH07CgoKICBjb25zdCBnZW9LZXlOYW1lcyA9IHsKICAgIDEwMjQ6ICdHVE1vZGVsVHlwZUdlb0tleScsCiAgICAxMDI1OiAnR1RSYXN0ZXJUeXBlR2VvS2V5JywKICAgIDEwMjY6ICdHVENpdGF0aW9uR2VvS2V5JywKICAgIDIwNDg6ICdHZW9ncmFwaGljVHlwZUdlb0tleScsCiAgICAyMDQ5OiAnR2VvZ0NpdGF0aW9uR2VvS2V5JywKICAgIDIwNTA6ICdHZW9nR2VvZGV0aWNEYXR1bUdlb0tleScsCiAgICAyMDUxOiAnR2VvZ1ByaW1lTWVyaWRpYW5HZW9LZXknLAogICAgMjA1MjogJ0dlb2dMaW5lYXJVbml0c0dlb0tleScsCiAgICAyMDUzOiAnR2VvZ0xpbmVhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTQ6ICdHZW9nQW5ndWxhclVuaXRzR2VvS2V5JywKICAgIDIwNTU6ICdHZW9nQW5ndWxhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTY6ICdHZW9nRWxsaXBzb2lkR2VvS2V5JywKICAgIDIwNTc6ICdHZW9nU2VtaU1ham9yQXhpc0dlb0tleScsCiAgICAyMDU4OiAnR2VvZ1NlbWlNaW5vckF4aXNHZW9LZXknLAogICAgMjA1OTogJ0dlb2dJbnZGbGF0dGVuaW5nR2VvS2V5JywKICAgIDIwNjA6ICdHZW9nQXppbXV0aFVuaXRzR2VvS2V5JywKICAgIDIwNjE6ICdHZW9nUHJpbWVNZXJpZGlhbkxvbmdHZW9LZXknLAogICAgMjA2MjogJ0dlb2dUT1dHUzg0R2VvS2V5JywKICAgIDMwNzI6ICdQcm9qZWN0ZWRDU1R5cGVHZW9LZXknLAogICAgMzA3MzogJ1BDU0NpdGF0aW9uR2VvS2V5JywKICAgIDMwNzQ6ICdQcm9qZWN0aW9uR2VvS2V5JywKICAgIDMwNzU6ICdQcm9qQ29vcmRUcmFuc0dlb0tleScsCiAgICAzMDc2OiAnUHJvakxpbmVhclVuaXRzR2VvS2V5JywKICAgIDMwNzc6ICdQcm9qTGluZWFyVW5pdFNpemVHZW9LZXknLAogICAgMzA3ODogJ1Byb2pTdGRQYXJhbGxlbDFHZW9LZXknLAogICAgMzA3OTogJ1Byb2pTdGRQYXJhbGxlbDJHZW9LZXknLAogICAgMzA4MDogJ1Byb2pOYXRPcmlnaW5Mb25nR2VvS2V5JywKICAgIDMwODE6ICdQcm9qTmF0T3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODI6ICdQcm9qRmFsc2VFYXN0aW5nR2VvS2V5JywKICAgIDMwODM6ICdQcm9qRmFsc2VOb3J0aGluZ0dlb0tleScsCiAgICAzMDg0OiAnUHJvakZhbHNlT3JpZ2luTG9uZ0dlb0tleScsCiAgICAzMDg1OiAnUHJvakZhbHNlT3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODY6ICdQcm9qRmFsc2VPcmlnaW5FYXN0aW5nR2VvS2V5JywKICAgIDMwODc6ICdQcm9qRmFsc2VPcmlnaW5Ob3J0aGluZ0dlb0tleScsCiAgICAzMDg4OiAnUHJvakNlbnRlckxvbmdHZW9LZXknLAogICAgMzA4OTogJ1Byb2pDZW50ZXJMYXRHZW9LZXknLAogICAgMzA5MDogJ1Byb2pDZW50ZXJFYXN0aW5nR2VvS2V5JywKICAgIDMwOTE6ICdQcm9qQ2VudGVyTm9ydGhpbmdHZW9LZXknLAogICAgMzA5MjogJ1Byb2pTY2FsZUF0TmF0T3JpZ2luR2VvS2V5JywKICAgIDMwOTM6ICdQcm9qU2NhbGVBdENlbnRlckdlb0tleScsCiAgICAzMDk0OiAnUHJvakF6aW11dGhBbmdsZUdlb0tleScsCiAgICAzMDk1OiAnUHJvalN0cmFpZ2h0VmVydFBvbGVMb25nR2VvS2V5JywKICAgIDMwOTY6ICdQcm9qUmVjdGlmaWVkR3JpZEFuZ2xlR2VvS2V5JywKICAgIDQwOTY6ICdWZXJ0aWNhbENTVHlwZUdlb0tleScsCiAgICA0MDk3OiAnVmVydGljYWxDaXRhdGlvbkdlb0tleScsCiAgICA0MDk4OiAnVmVydGljYWxEYXR1bUdlb0tleScsCiAgICA0MDk5OiAnVmVydGljYWxVbml0c0dlb0tleScsCiAgfTsKCiAgY29uc3QgZ2VvS2V5cyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGdlb0tleU5hbWVzKSB7CiAgICBpZiAoZ2VvS2V5TmFtZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICBnZW9LZXlzW2dlb0tleU5hbWVzW2tleV1dID0gcGFyc2VJbnQoa2V5LCAxMCk7CiAgICB9CiAgfQoKICBjbGFzcyBMZXJjRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKCiAgICAgIHRoaXMucGxhbmFyQ29uZmlndXJhdGlvbiA9IHR5cGVvZiBmaWxlRGlyZWN0b3J5LlBsYW5hckNvbmZpZ3VyYXRpb24gIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5QbGFuYXJDb25maWd1cmF0aW9uIDogMTsKICAgICAgdGhpcy5zYW1wbGVzUGVyUGl4ZWwgPSB0eXBlb2YgZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgOiAxOwoKICAgICAgdGhpcy5hZGRDb21wcmVzc2lvbiA9IGZpbGVEaXJlY3RvcnkuTGVyY1BhcmFtZXRlcnNbTGVyY1BhcmFtZXRlcnMuQWRkQ29tcHJlc3Npb25dOwogICAgfQoKICAgIGludGVybGVhdmVQaXhlbHMoYmFuZEludGVybGVhdmVkRGF0YSkgewogICAgICBjb25zdCBwaXhlbEludGVybGVhdmVkRGF0YSA9IG5ldyBiYW5kSW50ZXJsZWF2ZWREYXRhLmNvbnN0cnVjdG9yKGJhbmRJbnRlcmxlYXZlZERhdGEubGVuZ3RoKTsKICAgICAgY29uc3QgbGVuZ3RoUGVyU2FtcGxlID0gYmFuZEludGVybGVhdmVkRGF0YS5sZW5ndGggLyB0aGlzLnNhbXBsZXNQZXJQaXhlbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGhQZXJTYW1wbGU7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zYW1wbGVzUGVyUGl4ZWw7IGorKykgewogICAgICAgICAgcGl4ZWxJbnRlcmxlYXZlZERhdGFbaSAqIHRoaXMuc2FtcGxlc1BlclBpeGVsICsgal0gPSBiYW5kSW50ZXJsZWF2ZWREYXRhW2kgKyBqICogbGVuZ3RoUGVyU2FtcGxlXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHBpeGVsSW50ZXJsZWF2ZWREYXRhOwogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICBzd2l0Y2ggKHRoaXMuYWRkQ29tcHJlc3Npb24pIHsKICAgICAgICBjYXNlIExlcmNBZGRDb21wcmVzc2lvbi5Ob25lOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXJjQWRkQ29tcHJlc3Npb24uRGVmbGF0ZToKICAgICAgICAgIGJ1ZmZlciA9IGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBMRVJDIGFkZGl0aW9uYWwgY29tcHJlc3Npb24gbWV0aG9kIGlkZW50aWZpZXI6ICR7dGhpcy5hZGRDb21wcmVzc2lvbn1gKTsKICAgICAgfQoKICAgICAgY29uc3QgbGVyY1Jlc3VsdCA9IExlcmMuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIGNvbnN0IGxlcmNEYXRhID0gbGVyY1Jlc3VsdC5waXhlbHNbMF07IC8vIGFsd2F5cyBiYW5kLWludGVybGVhdmVkCiAgICAgIGNvbnN0IGRlY29kZWREYXRhID0gdGhpcy5wbGFuYXJDb25maWd1cmF0aW9uID09PSAxID8gdGhpcy5pbnRlcmxlYXZlUGl4ZWxzKGxlcmNEYXRhKSA6IGxlcmNEYXRhOyAvLyB0cmFuc2Zvcm0gdG8gcGl4ZWwtaW50ZXJsZWF2ZWQgaWYgZXhwZWN0ZWQKICAgICAgcmV0dXJuIGRlY29kZWREYXRhLmJ1ZmZlcjsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldERlY29kZXIoZmlsZURpcmVjdG9yeSkgewogICAgc3dpdGNoIChmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9uKSB7CiAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICBjYXNlIDE6IC8vIG5vIGNvbXByZXNzaW9uCiAgICAgICAgcmV0dXJuIG5ldyBSYXdEZWNvZGVyKCk7CiAgICAgIGNhc2UgNTogLy8gTFpXCiAgICAgICAgcmV0dXJuIG5ldyBMWldEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBjYXNlIDY6IC8vIEpQRUcKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29sZCBzdHlsZSBKUEVHIGNvbXByZXNzaW9uIGlzIG5vdCBzdXBwb3J0ZWQuJyk7CiAgICAgIGNhc2UgNzogLy8gSlBFRwogICAgICAgIHJldHVybiBuZXcgSnBlZ0RlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICAgIGNhc2UgODogLy8gRGVmbGF0ZSBhcyByZWNvZ25pemVkIGJ5IEFkb2JlCiAgICAgIGNhc2UgMzI5NDY6IC8vIERlZmxhdGUgR0RBTCBkZWZhdWx0CiAgICAgICAgcmV0dXJuIG5ldyBEZWZsYXRlRGVjb2RlcigpOwogICAgICBjYXNlIDMyNzczOiAvLyBwYWNrYml0cwogICAgICAgIHJldHVybiBuZXcgUGFja2JpdHNEZWNvZGVyKCk7CiAgICAgIGNhc2UgMzQ4ODc6IC8vIExFUkMKICAgICAgICByZXR1cm4gbmV3IExlcmNEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QgaWRlbnRpZmllcjogJHtmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9ufWApOwogICAgfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gZGVjb2RlKGZpbGVEaXJlY3RvcnksIGJ1ZmZlcikgewogICAgY29uc3QgZGVjb2RlciA9IGdldERlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWNvZGVyLmRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpOwogICAgc2VsZi5wb3N0TWVzc2FnZShyZXN1bHQsIFtyZXN1bHRdKTsKICB9CiAgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIikgewogICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IFtuYW1lLCAuLi5hcmdzXSA9IGV2ZW50LmRhdGE7CiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgImRlY29kZSI6CiAgICAgICAgICBkZWNvZGUoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CiAgfQoKfSkoKTsK";typeof window<"u"&&window.Blob&&new Blob([atob(ZP)],{type:"text/javascript;charset=utf-8"});function RP(t){const e=t.length,n=eP(t);return i=>{if(Array.isArray(i))return[...i];const s=Array(e).fill(0);for(const[g,o]of Object.entries(i))s[n(g)]=o;return s}}const jy={u1:"Uint8",u2:"Uint16",u4:"Uint32",f4:"Float32",f8:"Float64",i1:"Int8",i2:"Int16",i4:"Int32"};class _c{constructor(e,n,i){xI(this,"_data");xI(this,"_indexer");xI(this,"_readChunks");this.labels=n,this.tileSize=i,this._indexer=RP(n),this._data=e;const s=e.chunks[this._xIndex],g=e.chunks[this._xIndex-1];this._readChunks=i===s&&i===g}get shape(){return this._data.shape}get dtype(){const e=this._data.dtype.slice(1);if(!(e in jy))throw Error(`Zarr dtype not supported, got ${e}.`);return jy[e]}get _xIndex(){const e=_o(this._data.shape);return this._data.shape.length-(e?2:1)}_chunkIndex(e,n,i){const s=this._indexer(e);return s[this._xIndex]=n,s[this._xIndex-1]=i,s}_getSlices(e,n){const{height:i,width:s}=BI(this),[g,o]=[e*this.tileSize,Math.min((e+1)*this.tileSize,s)],[r,a]=[n*this.tileSize,Math.min((n+1)*this.tileSize,i)];if(g===o||r===a)throw new yg("Tile slice is zero-sized.");return[Yi(g,o),Yi(r,a)]}async getRaster({selection:e}){const n=this._chunkIndex(e,null,null),{data:i,shape:s}=await this._data.getRaw(n),[g,o]=s;return{data:i,width:o,height:g}}async getTile(e){const{x:n,y:i,selection:s,signal:g}=e;let o;if(this._readChunks){const l=this._chunkIndex(s,n,i);o=await this._data.getRawChunk(l,{storeOptions:{signal:g}})}else{const[l,C]=this._getSlices(n,i),c=this._chunkIndex(s,l,C);o=await this._data.getRaw(c)}const{data:r,shape:[a,I]}=o;return{data:r,width:I,height:a}}onTileError(e){if(!(e instanceof yg))throw e}}var FP=(t,e=1,n)=>{if(n={indent:" ",includeEmptyLines:!1,...n},typeof t!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof t}\``);if(typeof e!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof e}\``);if(typeof n.indent!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof n.indent}\``);if(e===0)return t;const i=n.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return t.replace(i,n.indent.repeat(e))};const SP={homedir:""},VP=Object.freeze(Object.defineProperty({__proto__:null,default:SP},Symbol.toStringTag,{value:"Module"})),UP=Sv(VP),qy=UP,$y=/\s+at.*(?:\(|\s)(.*)\)?/,xP=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,WP=typeof qy.homedir>"u"?"":qy.homedir();var wP=(t,e)=>(e=Object.assign({pretty:!1},e),t.replace(/\\/g,"/").split(`
`).filter(n=>{const i=n.match($y);if(i===null||!i[1])return!0;const s=i[1];return s.includes(".app/Contents/Resources/electron.asar")||s.includes(".app/Contents/Resources/default_app.asar")?!1:!xP.test(s)}).filter(n=>n.trim()!=="").map(n=>e.pretty?n.replace($y,(i,s)=>i.replace(s,s.replace(WP,"~"))):n).join(`
`));const NP=FP,TP=wP,EP=t=>t.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,"");class QP extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);e=[...e].map(i=>i instanceof Error?i:i!==null&&typeof i=="object"?Object.assign(new Error(i.message),i):new Error(i));let n=e.map(i=>typeof i.stack=="string"?EP(TP(i.stack)):String(i)).join(`
`);n=`
`+NP(n,4),super(n),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var XP=QP;const YP=XP;var CF=async(t,e,{concurrency:n=1/0,stopOnError:i=!0}={})=>new Promise((s,g)=>{if(typeof e!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(n)||n===1/0)&&n>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${n}\` (${typeof n})`);const o=[],r=[],a=t[Symbol.iterator]();let I=!1,l=!1,C=0,c=0;const A=()=>{if(I)return;const d=a.next(),h=c;if(c++,d.done){l=!0,C===0&&(!i&&r.length!==0?g(new YP(r)):s(o));return}C++,(async()=>{try{const u=await d.value;o[h]=await e(u,h),C--,A()}catch(u){i?(I=!0,g(u)):(r.push(u),C--,A())}})()};for(let d=0;d<n&&(A(),!l);d++);});const _P={...nr.defaultProps,loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}};function HP(t,e,n=[0,0],i=1){const[s,g]=n,o=t*i+s,r=e*i+g;return[s,r,o,g]}function kP(t){const[e]=t,{width:n,height:i}=e.data;return t.forEach(({data:s})=>{if((s==null?void 0:s.width)!==n||(s==null?void 0:s.height)!==i)throw new Error("Grid data is not same shape.")}),{width:n,height:i}}function ev(t){const{loaders:e,selections:n=[]}=t;let{concurrency:i}=t;return i&&n.length>0&&(i=Math.ceil(i/n.length)),CF(e,async g=>{const o=n.map(a=>g.loader.getRaster({selection:a})),r=await Promise.all(o);return{...g,data:{data:r.map(a=>a.data),width:r[0].width,height:r[0].height}}},{concurrency:i})}class Hm extends Un{initializeState(){this.state={gridData:[],width:0,height:0},ev(this.props).then(e=>{const{width:n,height:i}=kP(e);this.setState({gridData:e,width:n,height:i})})}updateState({props:e,oldProps:n,changeFlags:i}){const{propsChanged:s}=i,g=typeof s=="string"&&s.includes("props.loaders"),o=e.selections!==n.selections;(g||o)&&ev(this.props).then(r=>{this.setState({gridData:r})})}getPickingInfo({info:e}){if(!e.coordinate)return e;const n=this.props.spacer||0,{width:i,height:s}=this.state,[g,o]=e.coordinate,r=Math.floor(o/(s+n)),a=Math.floor(g/(i+n));return e.gridCoord={row:r,column:a},e}renderLayers(){const{gridData:e,width:n,height:i}=this.state;if(n===0||i===0)return null;const{rows:s,columns:g,spacer:o=0,id:r=""}=this.props,a=e.map(I=>{const l=I.row*(i+o),C=I.col*(n+o),c={channelData:I.data,bounds:HP(n,i,[C,l]),id:`${r}-GridLayer-${I.row}-${I.col}`,dtype:I.loader.dtype||"Uint16",pickable:!1,extensions:[new bI]};return new nr({...this.props,...c})});if(this.props.pickable){const[I,l]=[0,0],C=s*(i+o),c=g*(n+o),d={data:[{polygon:[[l,I],[c,I],[c,C],[l,C]]}],getPolygon:u=>u.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${r}-GridLayer-picking`},h=new uI({...this.props,...d});a.push(h)}if(this.props.text){const I=new qo({id:`${r}-GridLayer-text`,data:e,getPosition:l=>[l.col*(n+o),l.row*(i+o)],getText:l=>l.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});a.push(I)}return a}}Hm.layerName="GridLayer";Hm.defaultProps=_P;class KP{constructor(e={}){if(!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[n,i]of e)this.onEviction(n,i.value)}_deleteIfExpired(e,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,n.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,n){if(this._deleteIfExpired(e,n)===!1)return n.value}_getItemValue(e,n){return n.expiry?this._getOrDeleteIfExpired(e,n):n.value}_peek(e,n){const i=n.get(e);return this._getItemValue(e,i)}_set(e,n){this.cache.set(e,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,n){this.oldCache.delete(e),this._set(e,n)}*_entriesAscending(){for(const e of this.oldCache){const[n,i]=e;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield e)}for(const e of this.cache){const[n,i]=e;this._deleteIfExpired(n,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const n=this.cache.get(e);return this._getItemValue(e,n)}if(this.oldCache.has(e)){const n=this.oldCache.get(e);if(this._deleteIfExpired(e,n)===!1)return this._moveToRecent(e,n),n.value}}set(e,n,{maxAge:i=this.maxAge}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;this.cache.has(e)?this.cache.set(e,{value:n,expiry:s}):this._set(e,{value:n,expiry:s})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const n=this.cache.delete(e);return n&&this._size--,this.oldCache.delete(e)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],i=n.length-e;i<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(i>0&&this._emitEvictions(n.slice(0,i)),this.oldCache=new Map(n.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[n,i]=e;this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}for(const e of this.oldCache){const[n,i]=e;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}}*entriesDescending(){let e=[...this.cache];for(let n=e.length-1;n>=0;--n){const i=e[n],[s,g]=i;this._deleteIfExpired(s,g)===!1&&(yield[s,g.value])}e=[...this.oldCache];for(let n=e.length-1;n>=0;--n){const i=e[n],[s,g]=i;this.cache.has(s)||this._deleteIfExpired(s,g)===!1&&(yield[s,g.value])}}*entriesAscending(){for(const[e,n]of this._entriesAscending())yield[e,n.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const n of this.oldCache.keys())this.cache.has(n)||e++;return Math.min(this._size+e,this.maxSize)}}class LP{constructor(e,n=100){this.store=e,this.cache=new KP({maxSize:n})}getItem(...e){const[n,i]=e;if(this.cache.has(n))return this.cache.get(n);const s=this.store.getItem(n,i).catch(g=>{throw this.cache.delete(n),g});return this.cache.set(n,s),s}async containsItem(e){return this.cache.has(e)||this.store.containsItem(e)}keys(){return this.store.keys()}deleteItem(e){throw new Error("deleteItem not implemented")}setItem(e,n){throw new Error("setItem not implemented")}}const Ro=6,ci={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},MP=[ci.magenta,ci.green],PP=[ci.red,ci.green,ci.blue],tv=Object.values(ci).slice(0,-2);async function JP(t){let e;if(typeof t=="string"){let n;if(t.endsWith(".json")){const[{ReferenceStore:i},s]=await Promise.all([Ti(()=>import("./index.949b4e0f.js"),[],import.meta.url),fetch(t).then(g=>g.json())]);n=i.fromJSON(s)}else{const i=new URL(t);n=new qR(i.origin),e=i.pathname.slice(1)}return{store:new LP(n),path:e}}return{store:t,path:e}}async function DP(t){const{store:e,path:n}=await JP(t);return wm(e,n).catch(i=>{if(i instanceof li)return EM({store:e});throw i})}const zP=new TextDecoder;function nv(t,e){return t.store.getItem(lg(t.path,e,".zattrs")).then(n=>zP.decode(n)).then(n=>JSON.parse(n))}async function cF(t,e){const{datasets:n}=e[0]||[{path:"0"}],i=await Promise.all(n.map(({path:s})=>t.getItem(s)));if(i.every(s=>s instanceof er))return i;throw Error("Multiscales metadata included a path to a group.")}function km(t){t.startsWith("#")&&(t=t.slice(1));const e=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16);return[e,n,i]}function ka(t){return Array.from({length:t},(e,n)=>n)}function OP(t,e=" "){for(;t.length>0&&e.includes(t.charAt(t.length-1));)t=t.substr(0,t.length-1);return t}function lg(...t){return t.filter(Boolean).map(e=>OP(e,"/")).join("/")}function jP(t,e){return(!e||e.length!=t.shape.length)&&(e=t.shape.slice(0,-2).map((i,s)=>""+s).concat(["y","x"])),e}function Hc(t){const e=[{type:"time",name:"t"},{type:"channel",name:"c"},{type:"space",name:"z"},{type:"space",name:"y"},{type:"space",name:"x"}];function n(s){return s==="t"?"time":s==="c"?"channel":"space"}let i=e;return t[0].axes&&(i=t[0].axes.map(s=>{if(typeof s=="string")return{name:s,type:n(s)};const{name:g,type:o}=s;return{name:g,type:o!=null?o:n(g)}})),i}function kc(t){return t.map(n=>n.name)}function AF(t,e){return e||(t<=Ro?e=Array(t).fill(!0):e=[...Array(Ro).fill(!0),...Array(t-Ro).fill(!1)]),e}function dF(t,e){let n=[];if(t==1)n=[ci.white];else if(t==2)n=MP;else if(t===3)n=PP;else if(t<=Ro)n=tv.slice(0,t);else{n=Array(t).fill(ci.white);const i=e.flatMap((s,g)=>s?g:[]);for(const[s,g]of i.entries())n[g]=tv[s]}return n}function uF(t){const e=t[t.length-1];return e===3||e===4}function Kc(t){const e=uF(t.shape),[n,i]=t.chunks.slice(e?-3:-2),s=Math.min(n,i);return 2**Math.floor(Math.log2(s))}function qP([t,e],[n,i],s,g){const o=(n-g*2)/t,r=(i-g*2)/e;return{zoom:Math.min(s,Math.log2(Math.min(o,r))),target:[t/2,e/2,0]}}function $P(t){return Array.isArray(t)?t.length===16&&t.every(e=>typeof e=="number"):!1}function vI(t){if(!t)return Ee.IDENTITY;const e=new Ee;try{const n=typeof t=="string"?JSON.parse(t):t;if(!$P(n))throw Error("Invalid modelMatrix size. Must be 16.");e.setRowMajor(...n)}catch{const n=`Failed to parse modelMatrix. Got ${JSON.stringify(t)}, using identity.`;console.warn(n)}return e}async function Km(t,e){if(t.dtype==="Uint8")return[0,255];const{data:n}=await t.getRaster({selection:e});let i=1/0,s=-1/0;for(let g=0;g<n.length;g++)n[g]>s&&(s=n[g]),n[g]<i&&(i=n[g]);return i===s&&(i=0,s=1),[i,s]}async function hF(t,e,n,i){const s=i!=null?i:t.shape.map(()=>0);if(t.shape[e]!==n.length)throw new Error("provided visibilities don't match number of channels");return Promise.all(n.map(async(o,r)=>{if(!o)return;const a=[...s];return a[e]=r,Km(t,a)}))}async function eJ(t,e,n){var y,U,V,F;const i=t.acquisition?parseInt(t.acquisition):void 0;let s=[];if(!(n!=null&&n.images))throw Error("Well .zattrs missing images");if(!e.path)throw Error("Cannot inspect zarr path to open well.");const[g,o]=e.path.split("/").filter(Boolean).slice(-2);let{images:r}=n;const a=r.flatMap(W=>W.acquisition?[W.acquisition]:[]);if(a.length>1){const W=e.path.replace(`${g}/${o}`,""),E=await(await wm(e.store,W)).attrs.asObject();s=(U=(y=E==null?void 0:E.plate)==null?void 0:y.acquisitions)!=null?U:[],i&&a.includes(i)&&(r=r.filter(H=>H.acquisition===i))}const I=r.map(W=>W.path),l=Math.ceil(Math.sqrt(I.length)),C=Math.ceil(I.length/l),c=await e.getItem(I[0]).then(W=>W.attrs.asObject());if(!("multiscales"in c))throw Error("Path for image is not valid.");let A=c.multiscales[0].datasets[0].path;const d=I.map(W=>e.getItem(lg(W,A))),h=await Promise.all(d),u=Hc(c.multiscales),m=kc(u),f=Kc(h[0]),p=ka(C).flatMap(W=>ka(l).map(M=>{const E=M+W*l;return{name:String(E),row:W,col:M,loader:new _c(h[E],m,f)}}));let B;"omero"in c?B=Lm(c.omero,u):B=await mF(p[0].loader,m);const G={loaders:p,...B,axis_labels:m,loader:[p[0].loader],model_matrix:vI(t.model_matrix),defaults:{selection:B.defaultSelection,colormap:(V=t.colormap)!=null?V:"",opacity:(F=t.opacity)!=null?F:1},name:`Well ${g}${o}`};return s.length>0&&(G.acquisitions=s,G.acquisitionId=i||-1),G.rows=C,G.columns=l,G.onClick=W=>{let M=W.gridCoord;if(!M)return;const{row:E,column:H}=M;let P;if(typeof t.source=="string"&&e.path&&!isNaN(E)&&!isNaN(H)){const z=E*l+H;P=lg(t.source,I[z])}t.onClick?(delete W.layer,W.imageSource=P,t.onClick(W)):P&&window.open(window.location.origin+window.location.pathname+"?source="+P)},G}async function iv(t,e,n){var y,U;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const i=n.rows.map(V=>V.name),s=n.columns.map(V=>V.name),g=n.wells.map(V=>V.path),o=await nv(e,g[0]);if(!("well"in o))throw Error("Path for image is not valid, not a well.");const r=o.well.images[0].path,a=await e.getItem(lg(g[0],r)).then(V=>V.attrs.asObject());if(!("multiscales"in a))throw Error("Path for image is not valid.");const{datasets:I}=a.multiscales[0],l=I[I.length-1].path;async function C(V){const F=await nv(e,V);return lg(V,F.well.images[0].path)}const c=await Promise.all(g.map(C)),A=([V,F])=>e.getItem(F).then(W=>[V,W]),d=await CF(c.map(V=>[V,lg(V,l)]),A,{concurrency:10}),h=await Promise.all(d),u=Hc(a.multiscales),m=kc(u),f=Kc(h[0][1]),p=h.map(V=>{const[F,W]=V[0].split("/");return{name:`${F}${W}`,row:i.indexOf(F),col:s.indexOf(W),loader:new _c(V[1],m,f)}});let B;"omero"in a?B=Lm(a.omero,u):B=await mF(p[0].loader,m);const G={loaders:p,...B,axis_labels:m,loader:[p[0].loader],model_matrix:vI(t.model_matrix),defaults:{selection:B.defaultSelection,colormap:(y=t.colormap)!=null?y:"",opacity:(U=t.opacity)!=null?U:1},name:n.name||"Plate",rows:i.length,columns:s.length};return G.onClick=V=>{let F=V.gridCoord;if(!F)return;const{row:W,column:M}=F;let E;typeof t.source=="string"&&e.path&&!isNaN(W)&&!isNaN(M)&&(E=lg(t.source,i[W],s[M])),t.onClick?(delete V.layer,V.imageSource=E,t.onClick(V)):E&&window.open(window.location.origin+window.location.pathname+"?source="+E)},G}async function tJ(t,e,n){var c;const{name:i,opacity:s=1,colormap:g=""}=t,o=await cF(e,n.multiscales),r=Hc(n.multiscales),a=kc(r),I=Lm(n.omero,r),l=Kc(o[0]);return{loader:o.map(A=>new _c(A,a,l)),axis_labels:a,model_matrix:vI(t.model_matrix),defaults:{selection:I.defaultSelection,colormap:g,opacity:s},...I,name:(c=I.name)!=null?c:i}}async function mF(t,e){const n=e.indexOf("c"),i=t.shape[n],s=AF(i),g=await hF(t,n,s),o=dF(i,s);return{name:"Image",names:ka(i).map(r=>`channel_${r}`),colors:o,contrast_limits:g,visibilities:s,channel_axis:e.includes("c")?e.indexOf("c"):null,defaultSelection:e.map(()=>0)}}function Lm({rdefs:t,channels:e,name:n},i){var c,A;const s=(c=t.defaultT)!=null?c:0,g=(A=t.defaultZ)!=null?A:0,o=[],r=[],a=[],I=[];e.forEach((d,h)=>{o.push(d.color),r.push([d.window.start,d.window.end]),a.push(d.active),I.push(d.label||""+h)});const l=i.map(d=>d.type=="time"?s:d.name=="z"?g:0),C=i.findIndex(d=>d.type==="channel");return{name:n,names:I,colors:o,contrast_limits:r,visibilities:a,channel_axis:C,defaultSelection:l}}async function nJ(t,e){const{color:n,contrast_limits:i,visibility:s,name:g,colormap:o="",opacity:r=1}=t,a=e[e.length-1],I=Array(e[0].shape.length).fill(0),l=i!=null?i:await(()=>Km(a,I))();return{loader:e,name:g,channel_axis:null,colors:[n!=null?n:ci.white],names:["channel_0"],contrast_limits:[l],visibilities:[s!=null?s:!0],model_matrix:vI(t.model_matrix),defaults:{selection:I,colormap:o,opacity:r},axis_labels:e[0].labels}}async function iJ(t,e,n){const{names:i,contrast_limits:s,name:g,model_matrix:o,opacity:r=1,colormap:a=""}=t;let{visibilities:I,colors:l}=t;const C=e[0].shape[n];for(const A of[s,I,i,l])if(A&&A.length!==C){const d=Object.keys({channelProp:A})[0];throw Error(`channel_axis is length ${C} and provided channel_axis property ${d} is different size.`)}I=I||AF(C),l=l||dF(C,I);const c=s!=null?s:await(()=>hF(e[e.length-1],n,I))();return{loader:e,name:g,channel_axis:n,colors:l,names:i!=null?i:ka(C).map(A=>`channel_${A}`),contrast_limits:c,visibilities:I,model_matrix:vI(o),defaults:{selection:Array(e[0].shape.length).fill(0),colormap:a,opacity:r},axis_labels:e[0].labels}}async function sJ(t){var l;const e=await DP(t.source);let n,i;if(e instanceof Ig){const C=await e.attrs.asObject();if("plate"in C)return iv(t,e,C.plate);if("well"in C)return eJ(t,e,C.well);if("omero"in C)return tJ(t,e,C);if(Object.keys(C).length===0&&e.path){const c=e.path.slice(0,e.path.lastIndexOf("/")),A=await wm(e.store,c),d=await A.attrs.asObject();if("plate"in d)return iv(t,A,d.plate)}if(!("multiscales"in C))throw Error("Group is missing multiscales specification.");n=await cF(e,C.multiscales),C.multiscales[0].axes&&(i=Hc(C.multiscales))}else n=[e];const{channel_axis:s,labels:g}=gJ(t,i,n[0]),o=Kc(n[0]),r=n.map(C=>new _c(C,g,o)),[a]=r;if("channel_axis"in t||s>-1)return t=t,iJ(t,r,Number((l=t.channel_axis)!=null?l:s));if(a.shape.length===2||!("channel_axis"in t))return nJ(t,r);throw Error("Failed to load image.")}function gJ(t,e,n){const i=t.axis_labels,s="channel_axis"in t?Number(t.channel_axis):void 0;if(e){const r=i!=null?i:kc(e),a=s!=null?s:e.findIndex(I=>I.type==="channel");return{labels:r,channel_axis:a}}const g=i!=null?i:jP(n),o=s!=null?s:g.indexOf("c");return{labels:g,channel_axis:o}}function fF(t){var l;const{selection:e,opacity:n,colormap:i}=t.defaults,s=[],g=[],o=[],r=[],a=t.visibilities.flatMap((C,c)=>C?c:[]);for(const C of a.slice(0,Ro)){const c=[...e];Number.isInteger(t.channel_axis)&&(c[t.channel_axis]=C),s.push(c),g.push(km(t.colors[C])),o.push((l=t.contrast_limits[C])!=null?l:[0,255]),r.push(!0)}const I={id:t.id,selections:s,colors:g,contrastLimits:o,contrastLimitsRange:[...o],channelsVisible:r,opacity:n,colormap:i,modelMatrix:t.model_matrix,onClick:t.onClick};return"loaders"in t?{Layer:Hm,layerProps:{...I,loader:t.loader,loaders:t.loaders,columns:t.columns,rows:t.rows},on:!0}:t.loader.length===1?{Layer:yI,layerProps:{...I,loader:t.loader[0]},on:!0}:{Layer:Ym,layerProps:{...I,loader:t.loader},on:!0}}const oJ=Object.freeze(Object.defineProperty({__proto__:null,createSourceData:sJ,initLayerStateFromSource:fF},Symbol.toStringTag,{value:"Module"})),rJ={zoom:0,target:[0,0,0],default:!0},pF=Yn([]),BF=Yn(rJ),bF=o9(pF),yF=t9(t=>Yn({...fF(t),id:t.id}),(t,e)=>t.id===e.id),aJ=Yn(t=>{const e=t(bF);if(e.length===0)return[];const n=e.map(i=>yF(t(i)));return t(u9(n))});function IJ(t){const{loader:e}=t,[n,i]=Array.isArray(e)?[e[0],e.length]:[e,0],s=uF(n.shape);let[g,o]=n.shape.slice(s?-3:-2);return"loaders"in t&&t.rows&&t.columns&&(g=(g+5)*t.rows,o=(o+5)*t.columns),{height:g,width:o,maxZoom:i}}function lJ({layers:t}){var g,o;const[e,n]=Ai(BF),i=Z.exports.useRef(null);if(i.current&&(e==null?void 0:e.default)&&((o=(g=t[0])==null?void 0:g.props)==null?void 0:o.loader)){const{deck:r}=i.current,{width:a,height:I,maxZoom:l}=IJ(t[0].props),C=r.width<400?10:r.width<600?30:50,{zoom:c,target:A}=qP([a,I],[r.width,r.height],l,C);n({zoom:c,target:A})}const s={preserveDrawingBuffer:!0};return k(pL,{ref:i,layers:t,viewState:e,onViewStateChange:r=>n(r.viewState),views:[new rm({id:"ortho",controller:!0})],glOptions:s})}function CJ(){const e=Vn(aJ).map(n=>n.on?new n.Layer(n.layerProps):null);return k(lJ,{layers:e})}var cJ={black:"#000",white:"#fff"};const KC=cJ;var AJ={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"};const fd=AJ;var dJ={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"};const pd=dJ;var uJ={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"};const Bd=uJ;var hJ={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"};const bd=hJ;var mJ={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"};const yd=mJ;var fJ={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"};const vd=fJ;var pJ={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"};const Mm=pJ;function Pm(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(e,t),n)}function BJ(t){t=t.substr(1);var e=new RegExp(".{1,".concat(t.length>=6?2:1,"}"),"g"),n=t.match(e);return n&&n[0].length===1&&(n=n.map(function(i){return i+i})),n?"rgb".concat(n.length===4?"a":"","(").concat(n.map(function(i,s){return s<3?parseInt(i,16):Math.round(parseInt(i,16)/255*1e3)/1e3}).join(", "),")"):""}function bJ(t){t=Gg(t);var e=t,n=e.values,i=n[0],s=n[1]/100,g=n[2]/100,o=s*Math.min(g,1-g),r=function(C){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(C+i/30)%12;return g-o*Math.max(Math.min(c-3,9-c,1),-1)},a="rgb",I=[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)];return t.type==="hsla"&&(a+="a",I.push(n[3])),Lc({type:a,values:I})}function Gg(t){if(t.type)return t;if(t.charAt(0)==="#")return Gg(BJ(t));var e=t.indexOf("("),n=t.substring(0,e);if(["rgb","rgba","hsl","hsla"].indexOf(n)===-1)throw new Error(Va(3,t));var i=t.substring(e+1,t.length-1).split(",");return i=i.map(function(s){return parseFloat(s)}),{type:n,values:i}}function Lc(t){var e=t.type,n=t.values;return e.indexOf("rgb")!==-1?n=n.map(function(i,s){return s<3?parseInt(i,10):i}):e.indexOf("hsl")!==-1&&(n[1]="".concat(n[1],"%"),n[2]="".concat(n[2],"%")),"".concat(e,"(").concat(n.join(", "),")")}function yJ(t,e){var n=sv(t),i=sv(e);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)}function sv(t){t=Gg(t);var e=t.type==="hsl"?Gg(bJ(t)).values:t.values;return e=e.map(function(n){return n/=255,n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function Is(t,e){return t=Gg(t),e=Pm(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.values[3]=e,Lc(t)}function vF(t,e){if(t=Gg(t),e=Pm(e),t.type.indexOf("hsl")!==-1)t.values[2]*=1-e;else if(t.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)t.values[n]*=1-e;return Lc(t)}function GF(t,e){if(t=Gg(t),e=Pm(e),t.type.indexOf("hsl")!==-1)t.values[2]+=(100-t.values[2])*e;else if(t.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)t.values[n]+=(255-t.values[n])*e;return Lc(t)}var ts=["xs","sm","md","lg","xl"];function vJ(t){var e=t.values,n=e===void 0?{xs:0,sm:600,md:960,lg:1280,xl:1920}:e,i=t.unit,s=i===void 0?"px":i,g=t.step,o=g===void 0?5:g,r=Ve(t,["values","unit","step"]);function a(A){var d=typeof n[A]=="number"?n[A]:A;return"@media (min-width:".concat(d).concat(s,")")}function I(A){var d=ts.indexOf(A)+1,h=n[ts[d]];if(d===ts.length)return a("xs");var u=typeof h=="number"&&d>0?h:A;return"@media (max-width:".concat(u-o/100).concat(s,")")}function l(A,d){var h=ts.indexOf(d);return h===ts.length-1?a(A):"@media (min-width:".concat(typeof n[A]=="number"?n[A]:A).concat(s,") and ")+"(max-width:".concat((h!==-1&&typeof n[ts[h+1]]=="number"?n[ts[h+1]]:d)-o/100).concat(s,")")}function C(A){return l(A,A)}function c(A){return n[A]}return L({keys:ts,values:n,up:a,down:I,between:l,only:C,width:c},r)}function GJ(t,e,n){var i;return L({gutters:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return console.warn(["Material-UI: theme.mixins.gutters() is deprecated.","You can use the source of the mixin directly:",`
      paddingLeft: theme.spacing(2),
      paddingRight: theme.spacing(2),
      [theme.breakpoints.up('sm')]: {
        paddingLeft: theme.spacing(3),
        paddingRight: theme.spacing(3),
      },
      `].join(`
`)),L({paddingLeft:e(2),paddingRight:e(2)},g,ee({},t.up("sm"),L({paddingLeft:e(3),paddingRight:e(3)},g[t.up("sm")])))},toolbar:(i={minHeight:56},ee(i,"".concat(t.up("xs")," and (orientation: landscape)"),{minHeight:48}),ee(i,t.up("sm"),{minHeight:64}),i)},n)}var gv={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:KC.white,default:Mm[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Gd={text:{primary:KC.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:Mm[800],default:"#303030"},action:{active:KC.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function ov(t,e,n,i){var s=i.light||i,g=i.dark||i*1.5;t[e]||(t.hasOwnProperty(n)?t[e]=t[n]:e==="light"?t.light=GF(t.main,s):e==="dark"&&(t.dark=vF(t.main,g)))}function ZJ(t){var e=t.primary,n=e===void 0?{light:Bd[300],main:Bd[500],dark:Bd[700]}:e,i=t.secondary,s=i===void 0?{light:pd.A200,main:pd.A400,dark:pd.A700}:i,g=t.error,o=g===void 0?{light:fd[300],main:fd[500],dark:fd[700]}:g,r=t.warning,a=r===void 0?{light:vd[300],main:vd[500],dark:vd[700]}:r,I=t.info,l=I===void 0?{light:bd[300],main:bd[500],dark:bd[700]}:I,C=t.success,c=C===void 0?{light:yd[300],main:yd[500],dark:yd[700]}:C,A=t.type,d=A===void 0?"light":A,h=t.contrastThreshold,u=h===void 0?3:h,m=t.tonalOffset,f=m===void 0?.2:m,p=Ve(t,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function B(V){var F=yJ(V,Gd.text.primary)>=u?Gd.text.primary:gv.text.primary;return F}var G=function(F){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500,M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:700;if(F=L({},F),!F.main&&F[W]&&(F.main=F[W]),!F.main)throw new Error(Va(4,W));if(typeof F.main!="string")throw new Error(Va(5,JSON.stringify(F.main)));return ov(F,"light",M,f),ov(F,"dark",E,f),F.contrastText||(F.contrastText=B(F.main)),F},y={dark:Gd,light:gv},U=Wo(L({common:KC,type:d,primary:G(n),secondary:G(s,"A400","A200","A700"),error:G(o),warning:G(a),info:G(l),success:G(c),grey:Mm,contrastThreshold:u,getContrastText:B,augmentColor:G,tonalOffset:f},y[d]),p);return U}function ZF(t){return Math.round(t*1e5)/1e5}function RJ(t){return ZF(t)}var rv={textTransform:"uppercase"},av='"Roboto", "Helvetica", "Arial", sans-serif';function FJ(t,e){var n=typeof e=="function"?e(t):e,i=n.fontFamily,s=i===void 0?av:i,g=n.fontSize,o=g===void 0?14:g,r=n.fontWeightLight,a=r===void 0?300:r,I=n.fontWeightRegular,l=I===void 0?400:I,C=n.fontWeightMedium,c=C===void 0?500:C,A=n.fontWeightBold,d=A===void 0?700:A,h=n.htmlFontSize,u=h===void 0?16:h,m=n.allVariants,f=n.pxToRem,p=Ve(n,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]),B=o/14,G=f||function(V){return"".concat(V/u*B,"rem")},y=function(F,W,M,E,H){return L({fontFamily:s,fontWeight:F,fontSize:G(W),lineHeight:M},s===av?{letterSpacing:"".concat(ZF(E/W),"em")}:{},H,m)},U={h1:y(a,96,1.167,-1.5),h2:y(a,60,1.2,-.5),h3:y(l,48,1.167,0),h4:y(l,34,1.235,.25),h5:y(l,24,1.334,0),h6:y(c,20,1.6,.15),subtitle1:y(l,16,1.75,.15),subtitle2:y(c,14,1.57,.1),body1:y(l,16,1.5,.15),body2:y(l,14,1.43,.15),button:y(c,14,1.75,.4,rv),caption:y(l,12,1.66,.4),overline:y(l,12,2.66,1,rv)};return Wo(L({htmlFontSize:u,pxToRem:G,round:RJ,fontFamily:s,fontSize:o,fontWeightLight:a,fontWeightRegular:l,fontWeightMedium:c,fontWeightBold:d},U),p,{clone:!1})}var SJ=.2,VJ=.14,UJ=.12;function ze(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(SJ,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(VJ,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(UJ,")")].join(",")}var xJ=["none",ze(0,2,1,-1,0,1,1,0,0,1,3,0),ze(0,3,1,-2,0,2,2,0,0,1,5,0),ze(0,3,3,-2,0,3,4,0,0,1,8,0),ze(0,2,4,-1,0,4,5,0,0,1,10,0),ze(0,3,5,-1,0,5,8,0,0,1,14,0),ze(0,3,5,-1,0,6,10,0,0,1,18,0),ze(0,4,5,-2,0,7,10,1,0,2,16,1),ze(0,5,5,-3,0,8,10,1,0,3,14,2),ze(0,5,6,-3,0,9,12,1,0,3,16,2),ze(0,6,6,-3,0,10,14,1,0,4,18,3),ze(0,6,7,-4,0,11,15,1,0,4,20,3),ze(0,7,8,-4,0,12,17,2,0,5,22,4),ze(0,7,8,-4,0,13,19,2,0,5,24,4),ze(0,7,9,-4,0,14,21,2,0,5,26,4),ze(0,8,9,-5,0,15,22,2,0,6,28,5),ze(0,8,10,-5,0,16,24,2,0,6,30,5),ze(0,8,11,-5,0,17,26,2,0,6,32,5),ze(0,9,11,-5,0,18,28,2,0,7,34,6),ze(0,9,12,-6,0,19,29,2,0,7,36,6),ze(0,10,13,-6,0,20,31,3,0,8,38,7),ze(0,10,13,-6,0,21,33,3,0,8,40,7),ze(0,10,14,-6,0,22,35,3,0,8,42,7),ze(0,11,14,-7,0,23,36,3,0,9,44,8),ze(0,11,15,-7,0,24,38,3,0,9,46,8)];const WJ=xJ;var wJ={borderRadius:4};const NJ=wJ;function RF(t){if(Array.isArray(t))return t}function TJ(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],s=!0,g=!1,o,r;try{for(n=n.call(t);!(s=(o=n.next()).done)&&(i.push(o.value),!(e&&i.length===e));s=!0);}catch(a){g=!0,r=a}finally{try{!s&&n.return!=null&&n.return()}finally{if(g)throw r}}return i}}function FF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mc(t,e){return RF(t)||TJ(t,e)||Fh(t,e)||FF()}function EJ(t){var e=t.spacing||8;return typeof e=="number"?function(n){return e*n}:Array.isArray(e)?function(n){return e[n]}:typeof e=="function"?e:function(){}}function QJ(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:8;if(t.mui)return t;var e=EJ({spacing:t}),n=function(){for(var s=arguments.length,g=new Array(s),o=0;o<s;o++)g[o]=arguments[o];return g.length===0?e(1):g.length===1?e(g[0]):g.map(function(r){if(typeof r=="string")return r;var a=e(r);return typeof a=="number"?"".concat(a,"px"):a}).join(" ")};return Object.defineProperty(n,"unit",{get:function(){return t}}),n.mui=!0,n}var Iv={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},m0={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function lv(t){return"".concat(Math.round(t),"ms")}const XJ={easing:Iv,duration:m0,create:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["all"],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.duration,s=i===void 0?m0.standard:i,g=n.easing,o=g===void 0?Iv.easeInOut:g,r=n.delay,a=r===void 0?0:r;return Ve(n,["duration","easing","delay"]),(Array.isArray(e)?e:[e]).map(function(I){return"".concat(I," ").concat(typeof s=="string"?s:lv(s)," ").concat(o," ").concat(typeof a=="string"?a:lv(a))}).join(",")},getAutoHeightDuration:function(e){if(!e)return 0;var n=e/36;return Math.round((4+15*Math.pow(n,.25)+n/5)*10)}};var YJ={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};const SF=YJ;function VF(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.breakpoints,n=e===void 0?{}:e,i=t.mixins,s=i===void 0?{}:i,g=t.palette,o=g===void 0?{}:g,r=t.spacing,a=t.typography,I=a===void 0?{}:a,l=Ve(t,["breakpoints","mixins","palette","spacing","typography"]),C=ZJ(o),c=vJ(n),A=QJ(r),d=Wo({breakpoints:c,direction:"ltr",mixins:GJ(c,A,s),overrides:{},palette:C,props:{},shadows:WJ,typography:FJ(C,I),spacing:A,shape:NJ,transitions:XJ,zIndex:SF},l),h=arguments.length,u=new Array(h>1?h-1:0),m=1;m<h;m++)u[m-1]=arguments[m];return d=u.reduce(function(f,p){return Wo(f,p)},d),d}var _J=VF();const UF=_J;function Jm(){var t=gI()||UF;return t}function Bt(t,e){return Xs(t,L({defaultTheme:UF},e))}function Jn(t){if(typeof t!="string")throw new Error(Va(7));return t.charAt(0).toUpperCase()+t.slice(1)}function f0(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(function(i,s){return s==null?i:function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];i.apply(this,r),s.apply(this,r)}},function(){})}var HJ=function(e){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:e.typography.pxToRem(24),transition:e.transitions.create("fill",{duration:e.transitions.duration.shorter})},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorAction:{color:e.palette.action.active},colorError:{color:e.palette.error.main},colorDisabled:{color:e.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:e.typography.pxToRem(20)},fontSizeLarge:{fontSize:e.typography.pxToRem(35)}}},xF=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.classes,g=e.className,o=e.color,r=o===void 0?"inherit":o,a=e.component,I=a===void 0?"svg":a,l=e.fontSize,C=l===void 0?"medium":l,c=e.htmlColor,A=e.titleAccess,d=e.viewBox,h=d===void 0?"0 0 24 24":d,u=Ve(e,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return Z.exports.createElement(I,L({className:Se(s.root,g,r!=="inherit"&&s["color".concat(Jn(r))],C!=="default"&&C!=="medium"&&s["fontSize".concat(Jn(C))]),focusable:"false",viewBox:h,color:c,"aria-hidden":A?void 0:!0,role:A?"img":void 0,ref:n},u),i,A?Z.exports.createElement("title",null,A):null)});xF.muiName="SvgIcon";const Cv=Bt(HJ,{name:"MuiSvgIcon"})(xF);function Li(t,e){var n=function(s,g){return Ne.createElement(Cv,L({ref:g},s),t)};return n.muiName=Cv.muiName,Ne.memo(Ne.forwardRef(n))}function WF(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:166,n;function i(){for(var s=arguments.length,g=new Array(s),o=0;o<s;o++)g[o]=arguments[o];var r=this,a=function(){t.apply(r,g)};clearTimeout(n),n=setTimeout(a,e)}return i.clear=function(){clearTimeout(n)},i}function Kn(t){return t&&t.ownerDocument||document}function wF(t){var e=Kn(t);return e.defaultView||window}function LC(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function NF(t){var e=t.controlled,n=t.default;t.name,t.state;var i=Z.exports.useRef(e!==void 0),s=i.current,g=Z.exports.useState(n),o=g[0],r=g[1],a=s?e:o,I=Z.exports.useCallback(function(l){s||r(l)},[]);return[a,I]}var kJ=typeof window<"u"?Z.exports.useLayoutEffect:Z.exports.useEffect;function Wt(t){var e=Z.exports.useRef(t);return kJ(function(){e.current=t}),Z.exports.useCallback(function(){return e.current.apply(void 0,arguments)},[])}function Pt(t,e){return Z.exports.useMemo(function(){return t==null&&e==null?null:function(n){LC(t,n),LC(e,n)}},[t,e])}var Pc=!0,p0=!1,cv=null,KJ={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function LJ(t){var e=t.type,n=t.tagName;return!!(n==="INPUT"&&KJ[e]&&!t.readOnly||n==="TEXTAREA"&&!t.readOnly||t.isContentEditable)}function MJ(t){t.metaKey||t.altKey||t.ctrlKey||(Pc=!0)}function Zd(){Pc=!1}function PJ(){this.visibilityState==="hidden"&&p0&&(Pc=!0)}function JJ(t){t.addEventListener("keydown",MJ,!0),t.addEventListener("mousedown",Zd,!0),t.addEventListener("pointerdown",Zd,!0),t.addEventListener("touchstart",Zd,!0),t.addEventListener("visibilitychange",PJ,!0)}function DJ(t){var e=t.target;try{return e.matches(":focus-visible")}catch{}return Pc||LJ(e)}function zJ(){p0=!0,window.clearTimeout(cv),cv=window.setTimeout(function(){p0=!1},100)}function TF(){var t=Z.exports.useCallback(function(e){var n=ki.exports.findDOMNode(e);n!=null&&JJ(n.ownerDocument)},[]);return{isFocusVisible:DJ,onBlurVisible:zJ,ref:t}}function OJ(t){return RF(t)||KZ(t)||Fh(t)||FF()}const Av={disabled:!1},MC=Ne.createContext(null);var Lr="unmounted",qs="exited",$s="entering",qg="entered",B0="exiting",Mi=function(t){Ic(e,t);function e(i,s){var g;g=t.call(this,i,s)||this;var o=s,r=o&&!o.isMounting?i.enter:i.appear,a;return g.appearStatus=null,i.in?r?(a=qs,g.appearStatus=$s):a=qg:i.unmountOnExit||i.mountOnEnter?a=Lr:a=qs,g.state={status:a},g.nextCallback=null,g}e.getDerivedStateFromProps=function(s,g){var o=s.in;return o&&g.status===Lr?{status:qs}:null};var n=e.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(s){var g=null;if(s!==this.props){var o=this.state.status;this.props.in?o!==$s&&o!==qg&&(g=$s):(o===$s||o===qg)&&(g=B0)}this.updateStatus(!1,g)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var s=this.props.timeout,g,o,r;return g=o=r=s,s!=null&&typeof s!="number"&&(g=s.exit,o=s.enter,r=s.appear!==void 0?s.appear:o),{exit:g,enter:o,appear:r}},n.updateStatus=function(s,g){s===void 0&&(s=!1),g!==null?(this.cancelNextCallback(),g===$s?this.performEnter(s):this.performExit()):this.props.unmountOnExit&&this.state.status===qs&&this.setState({status:Lr})},n.performEnter=function(s){var g=this,o=this.props.enter,r=this.context?this.context.isMounting:s,a=this.props.nodeRef?[r]:[wl.findDOMNode(this),r],I=a[0],l=a[1],C=this.getTimeouts(),c=r?C.appear:C.enter;if(!s&&!o||Av.disabled){this.safeSetState({status:qg},function(){g.props.onEntered(I)});return}this.props.onEnter(I,l),this.safeSetState({status:$s},function(){g.props.onEntering(I,l),g.onTransitionEnd(c,function(){g.safeSetState({status:qg},function(){g.props.onEntered(I,l)})})})},n.performExit=function(){var s=this,g=this.props.exit,o=this.getTimeouts(),r=this.props.nodeRef?void 0:wl.findDOMNode(this);if(!g||Av.disabled){this.safeSetState({status:qs},function(){s.props.onExited(r)});return}this.props.onExit(r),this.safeSetState({status:B0},function(){s.props.onExiting(r),s.onTransitionEnd(o.exit,function(){s.safeSetState({status:qs},function(){s.props.onExited(r)})})})},n.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(s,g){g=this.setNextCallback(g),this.setState(s,g)},n.setNextCallback=function(s){var g=this,o=!0;return this.nextCallback=function(r){o&&(o=!1,g.nextCallback=null,s(r))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},n.onTransitionEnd=function(s,g){this.setNextCallback(g);var o=this.props.nodeRef?this.props.nodeRef.current:wl.findDOMNode(this),r=s==null&&!this.props.addEndListener;if(!o||r){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],I=a[0],l=a[1];this.props.addEndListener(I,l)}s!=null&&setTimeout(this.nextCallback,s)},n.render=function(){var s=this.state.status;if(s===Lr)return null;var g=this.props,o=g.children;g.in,g.mountOnEnter,g.unmountOnExit,g.appear,g.enter,g.exit,g.timeout,g.addEndListener,g.onEnter,g.onEntering,g.onEntered,g.onExit,g.onExiting,g.onExited,g.nodeRef;var r=lc(g,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Ne.createElement(MC.Provider,{value:null},typeof o=="function"?o(s,r):Ne.cloneElement(Ne.Children.only(o),r))},e}(Ne.Component);Mi.contextType=MC;Mi.propTypes={};function Pg(){}Mi.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Pg,onEntering:Pg,onEntered:Pg,onExit:Pg,onExiting:Pg,onExited:Pg};Mi.UNMOUNTED=Lr;Mi.EXITED=qs;Mi.ENTERING=$s;Mi.ENTERED=qg;Mi.EXITING=B0;const EF=Mi;function Dm(t,e){var n=function(g){return e&&Z.exports.isValidElement(g)?e(g):g},i=Object.create(null);return t&&Z.exports.Children.map(t,function(s){return s}).forEach(function(s){i[s.key]=n(s)}),i}function jJ(t,e){t=t||{},e=e||{};function n(l){return l in e?e[l]:t[l]}var i=Object.create(null),s=[];for(var g in t)g in e?s.length&&(i[g]=s,s=[]):s.push(g);var o,r={};for(var a in e){if(i[a])for(o=0;o<i[a].length;o++){var I=i[a][o];r[i[a][o]]=n(I)}r[a]=n(a)}for(o=0;o<s.length;o++)r[s[o]]=n(s[o]);return r}function Cg(t,e,n){return n[e]!=null?n[e]:t.props[e]}function qJ(t,e){return Dm(t.children,function(n){return Z.exports.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Cg(n,"appear",t),enter:Cg(n,"enter",t),exit:Cg(n,"exit",t)})})}function $J(t,e,n){var i=Dm(t.children),s=jJ(e,i);return Object.keys(s).forEach(function(g){var o=s[g];if(!!Z.exports.isValidElement(o)){var r=g in e,a=g in i,I=e[g],l=Z.exports.isValidElement(I)&&!I.props.in;a&&(!r||l)?s[g]=Z.exports.cloneElement(o,{onExited:n.bind(null,o),in:!0,exit:Cg(o,"exit",t),enter:Cg(o,"enter",t)}):!a&&r&&!l?s[g]=Z.exports.cloneElement(o,{in:!1}):a&&r&&Z.exports.isValidElement(I)&&(s[g]=Z.exports.cloneElement(o,{onExited:n.bind(null,o),in:I.props.in,exit:Cg(o,"exit",t),enter:Cg(o,"enter",t)}))}}),s}var eD=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},tD={component:"div",childFactory:function(e){return e}},zm=function(t){Ic(e,t);function e(i,s){var g;g=t.call(this,i,s)||this;var o=g.handleExited.bind(Bu(g));return g.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},g}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(s,g){var o=g.children,r=g.handleExited,a=g.firstRender;return{children:a?qJ(s,r):$J(s,o,r),firstRender:!1}},n.handleExited=function(s,g){var o=Dm(this.props.children);s.key in o||(s.props.onExited&&s.props.onExited(g),this.mounted&&this.setState(function(r){var a=L({},r.children);return delete a[s.key],{children:a}}))},n.render=function(){var s=this.props,g=s.component,o=s.childFactory,r=lc(s,["component","childFactory"]),a=this.state.contextValue,I=eD(this.state.children).map(o);return delete r.appear,delete r.enter,delete r.exit,g===null?Ne.createElement(MC.Provider,{value:a},I):Ne.createElement(MC.Provider,{value:a},Ne.createElement(g,r,I))},e}(Ne.Component);zm.propTypes={};zm.defaultProps=tD;const nD=zm;var iD=function(e){return e.scrollTop};function PC(t,e){var n=t.timeout,i=t.style,s=i===void 0?{}:i;return{duration:s.transitionDuration||typeof n=="number"?n:n[e.mode]||0,delay:s.transitionDelay}}var sD=function(e){return{root:{height:0,overflow:"hidden",transition:e.transitions.create("height")},entered:{height:"auto",overflow:"visible"},hidden:{visibility:"hidden"},wrapper:{display:"flex"},wrapperInner:{width:"100%"}}},QF=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.classes,g=e.className,o=e.collapsedHeight,r=e.collapsedSize,a=r===void 0?"0px":r,I=e.component,l=I===void 0?"div":I,C=e.disableStrictModeCompat,c=C===void 0?!1:C,A=e.in,d=e.onEnter,h=e.onEntered,u=e.onEntering,m=e.onExit,f=e.onExited,p=e.onExiting,B=e.style,G=e.timeout,y=G===void 0?m0.standard:G,U=e.TransitionComponent,V=U===void 0?EF:U,F=Ve(e,["children","classes","className","collapsedHeight","collapsedSize","component","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),W=Jm(),M=Z.exports.useRef(),E=Z.exports.useRef(null),H=Z.exports.useRef(),P=typeof(o||a)=="number"?"".concat(o||a,"px"):o||a;Z.exports.useEffect(function(){return function(){clearTimeout(M.current)}},[]);var z=W.unstable_strictMode&&!c,re=Z.exports.useRef(null),ue=Pt(n,z?re:void 0),ie=function(D){return function(ge,te){if(D){var he=z?[re.current,ge]:[ge,te],ae=Mc(he,2),Be=ae[0],Ge=ae[1];Ge===void 0?D(Be):D(Be,Ge)}}},ce=ie(function(_,D){_.style.height=P,d&&d(_,D)}),x=ie(function(_,D){var ge=E.current?E.current.clientHeight:0,te=PC({style:B,timeout:y},{mode:"enter"}),he=te.duration;if(y==="auto"){var ae=W.transitions.getAutoHeightDuration(ge);_.style.transitionDuration="".concat(ae,"ms"),H.current=ae}else _.style.transitionDuration=typeof he=="string"?he:"".concat(he,"ms");_.style.height="".concat(ge,"px"),u&&u(_,D)}),S=ie(function(_,D){_.style.height="auto",h&&h(_,D)}),w=ie(function(_){var D=E.current?E.current.clientHeight:0;_.style.height="".concat(D,"px"),m&&m(_)}),T=ie(f),Y=ie(function(_){var D=E.current?E.current.clientHeight:0,ge=PC({style:B,timeout:y},{mode:"exit"}),te=ge.duration;if(y==="auto"){var he=W.transitions.getAutoHeightDuration(D);_.style.transitionDuration="".concat(he,"ms"),H.current=he}else _.style.transitionDuration=typeof te=="string"?te:"".concat(te,"ms");_.style.height=P,p&&p(_)}),Q=function(D,ge){var te=z?D:ge;y==="auto"&&(M.current=setTimeout(te,H.current||0))};return Z.exports.createElement(V,L({in:A,onEnter:ce,onEntered:S,onEntering:x,onExit:w,onExited:T,onExiting:Y,addEndListener:Q,nodeRef:z?re:void 0,timeout:y==="auto"?null:y},F),function(_,D){return Z.exports.createElement(l,L({className:Se(s.root,s.container,g,{entered:s.entered,exited:!A&&P==="0px"&&s.hidden}[_]),style:L({minHeight:P},B),ref:ue},D),Z.exports.createElement("div",{className:s.wrapper,ref:E},Z.exports.createElement("div",{className:s.wrapperInner},i)))})});QF.muiSupportAuto=!0;const gD=Bt(sD,{name:"MuiCollapse"})(QF);var oD=function(e){var n={};return e.shadows.forEach(function(i,s){n["elevation".concat(s)]={boxShadow:i}}),L({root:{backgroundColor:e.palette.background.paper,color:e.palette.text.primary,transition:e.transitions.create("box-shadow")},rounded:{borderRadius:e.shape.borderRadius},outlined:{border:"1px solid ".concat(e.palette.divider)}},n)},rD=Z.exports.forwardRef(function(e,n){var i=e.classes,s=e.className,g=e.component,o=g===void 0?"div":g,r=e.square,a=r===void 0?!1:r,I=e.elevation,l=I===void 0?1:I,C=e.variant,c=C===void 0?"elevation":C,A=Ve(e,["classes","className","component","square","elevation","variant"]);return Z.exports.createElement(o,L({className:Se(i.root,s,c==="outlined"?i.outlined:i["elevation".concat(l)],!a&&i.rounded),ref:n},A))});const GI=Bt(oD,{name:"MuiPaper"})(rD);var aD=Z.exports.createContext({});const XF=aD;var ID=function(e){var n={duration:e.transitions.duration.shortest};return{root:{position:"relative",transition:e.transitions.create(["margin"],n),"&:before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:e.palette.divider,transition:e.transitions.create(["opacity","background-color"],n)},"&:first-child":{"&:before":{display:"none"}},"&$expanded":{margin:"16px 0","&:first-child":{marginTop:0},"&:last-child":{marginBottom:0},"&:before":{opacity:0}},"&$expanded + &":{"&:before":{display:"none"}},"&$disabled":{backgroundColor:e.palette.action.disabledBackground}},rounded:{borderRadius:0,"&:first-child":{borderTopLeftRadius:e.shape.borderRadius,borderTopRightRadius:e.shape.borderRadius},"&:last-child":{borderBottomLeftRadius:e.shape.borderRadius,borderBottomRightRadius:e.shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},expanded:{},disabled:{}}},lD=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.classes,g=e.className,o=e.defaultExpanded,r=o===void 0?!1:o,a=e.disabled,I=a===void 0?!1:a,l=e.expanded,C=e.onChange,c=e.square,A=c===void 0?!1:c,d=e.TransitionComponent,h=d===void 0?gD:d,u=e.TransitionProps,m=Ve(e,["children","classes","className","defaultExpanded","disabled","expanded","onChange","square","TransitionComponent","TransitionProps"]),f=NF({controlled:l,default:r,name:"Accordion",state:"expanded"}),p=Mc(f,2),B=p[0],G=p[1],y=Z.exports.useCallback(function(E){G(!B),C&&C(E,!B)},[B,C,G]),U=Z.exports.Children.toArray(i),V=OJ(U),F=V[0],W=V.slice(1),M=Z.exports.useMemo(function(){return{expanded:B,disabled:I,toggle:y}},[B,I,y]);return Z.exports.createElement(GI,L({className:Se(s.root,g,B&&s.expanded,I&&s.disabled,!A&&s.rounded),ref:n,square:A},m),Z.exports.createElement(XF.Provider,{value:M},F),Z.exports.createElement(h,L({in:B,timeout:"auto"},u),Z.exports.createElement("div",{"aria-labelledby":F.props.id,id:F.props["aria-controls"],role:"region"},W)))});const CD=Bt(ID,{name:"MuiAccordion"})(lD);var cD=function(e){return{root:{display:"flex",padding:e.spacing(1,2,2)}}},AD=Z.exports.forwardRef(function(e,n){var i=e.classes,s=e.className,g=Ve(e,["classes","className"]);return Z.exports.createElement("div",L({className:Se(i.root,s),ref:n},g))});const dD=Bt(cD,{name:"MuiAccordionDetails"})(AD);var uD=typeof window>"u"?Z.exports.useEffect:Z.exports.useLayoutEffect;function hD(t){var e=t.classes,n=t.pulsate,i=n===void 0?!1:n,s=t.rippleX,g=t.rippleY,o=t.rippleSize,r=t.in,a=t.onExited,I=a===void 0?function(){}:a,l=t.timeout,C=Z.exports.useState(!1),c=C[0],A=C[1],d=Se(e.ripple,e.rippleVisible,i&&e.ripplePulsate),h={width:o,height:o,top:-(o/2)+g,left:-(o/2)+s},u=Se(e.child,c&&e.childLeaving,i&&e.childPulsate),m=Wt(I);return uD(function(){if(!r){A(!0);var f=setTimeout(m,l);return function(){clearTimeout(f)}}},[m,r,l]),Z.exports.createElement("span",{className:d,style:h},Z.exports.createElement("span",{className:u}))}var b0=550,mD=80,fD=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(b0,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(b0,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}},pD=Z.exports.forwardRef(function(e,n){var i=e.center,s=i===void 0?!1:i,g=e.classes,o=e.className,r=Ve(e,["center","classes","className"]),a=Z.exports.useState([]),I=a[0],l=a[1],C=Z.exports.useRef(0),c=Z.exports.useRef(null);Z.exports.useEffect(function(){c.current&&(c.current(),c.current=null)},[I]);var A=Z.exports.useRef(!1),d=Z.exports.useRef(null),h=Z.exports.useRef(null),u=Z.exports.useRef(null);Z.exports.useEffect(function(){return function(){clearTimeout(d.current)}},[]);var m=Z.exports.useCallback(function(G){var y=G.pulsate,U=G.rippleX,V=G.rippleY,F=G.rippleSize,W=G.cb;l(function(M){return[].concat(cc(M),[Z.exports.createElement(hD,{key:C.current,classes:g,timeout:b0,pulsate:y,rippleX:U,rippleY:V,rippleSize:F})])}),C.current+=1,c.current=W},[g]),f=Z.exports.useCallback(function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0,V=y.pulsate,F=V===void 0?!1:V,W=y.center,M=W===void 0?s||y.pulsate:W,E=y.fakeElement,H=E===void 0?!1:E;if(G.type==="mousedown"&&A.current){A.current=!1;return}G.type==="touchstart"&&(A.current=!0);var P=H?null:u.current,z=P?P.getBoundingClientRect():{width:0,height:0,left:0,top:0},re,ue,ie;if(M||G.clientX===0&&G.clientY===0||!G.clientX&&!G.touches)re=Math.round(z.width/2),ue=Math.round(z.height/2);else{var ce=G.touches?G.touches[0]:G,x=ce.clientX,S=ce.clientY;re=Math.round(x-z.left),ue=Math.round(S-z.top)}if(M)ie=Math.sqrt((2*Math.pow(z.width,2)+Math.pow(z.height,2))/3),ie%2===0&&(ie+=1);else{var w=Math.max(Math.abs((P?P.clientWidth:0)-re),re)*2+2,T=Math.max(Math.abs((P?P.clientHeight:0)-ue),ue)*2+2;ie=Math.sqrt(Math.pow(w,2)+Math.pow(T,2))}G.touches?h.current===null&&(h.current=function(){m({pulsate:F,rippleX:re,rippleY:ue,rippleSize:ie,cb:U})},d.current=setTimeout(function(){h.current&&(h.current(),h.current=null)},mD)):m({pulsate:F,rippleX:re,rippleY:ue,rippleSize:ie,cb:U})},[s,m]),p=Z.exports.useCallback(function(){f({},{pulsate:!0})},[f]),B=Z.exports.useCallback(function(G,y){if(clearTimeout(d.current),G.type==="touchend"&&h.current){G.persist(),h.current(),h.current=null,d.current=setTimeout(function(){B(G,y)});return}h.current=null,l(function(U){return U.length>0?U.slice(1):U}),c.current=y},[]);return Z.exports.useImperativeHandle(n,function(){return{pulsate:p,start:f,stop:B}},[p,f,B]),Z.exports.createElement("span",L({className:Se(g.root,o),ref:u},r),Z.exports.createElement(nD,{component:null,exit:!0},I))});const BD=Bt(fD,{flip:!1,name:"MuiTouchRipple"})(Z.exports.memo(pD));var bD={root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},yD=Z.exports.forwardRef(function(e,n){var i=e.action,s=e.buttonRef,g=e.centerRipple,o=g===void 0?!1:g,r=e.children,a=e.classes,I=e.className,l=e.component,C=l===void 0?"button":l,c=e.disabled,A=c===void 0?!1:c,d=e.disableRipple,h=d===void 0?!1:d,u=e.disableTouchRipple,m=u===void 0?!1:u,f=e.focusRipple,p=f===void 0?!1:f,B=e.focusVisibleClassName,G=e.onBlur,y=e.onClick,U=e.onFocus,V=e.onFocusVisible,F=e.onKeyDown,W=e.onKeyUp,M=e.onMouseDown,E=e.onMouseLeave,H=e.onMouseUp,P=e.onTouchEnd,z=e.onTouchMove,re=e.onTouchStart,ue=e.onDragLeave,ie=e.tabIndex,ce=ie===void 0?0:ie,x=e.TouchRippleProps,S=e.type,w=S===void 0?"button":S,T=Ve(e,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),Y=Z.exports.useRef(null);function Q(){return ki.exports.findDOMNode(Y.current)}var _=Z.exports.useRef(null),D=Z.exports.useState(!1),ge=D[0],te=D[1];A&&ge&&te(!1);var he=TF(),ae=he.isFocusVisible,Be=he.onBlurVisible,Ge=he.ref;Z.exports.useImperativeHandle(i,function(){return{focusVisible:function(){te(!0),Y.current.focus()}}},[]),Z.exports.useEffect(function(){ge&&p&&!h&&_.current.pulsate()},[h,p,ge]);function pe(de,Dt){var rr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:m;return Wt(function(Ks){Dt&&Dt(Ks);var mn=rr;return!mn&&_.current&&_.current[de](Ks),!0})}var at=pe("start",M),Ie=pe("stop",ue),Ze=pe("stop",H),Vt=pe("stop",function(de){ge&&de.preventDefault(),E&&E(de)}),et=pe("start",re),tt=pe("stop",P),Ue=pe("stop",z),ve=pe("stop",function(de){ge&&(Be(de),te(!1)),G&&G(de)},!1),Xe=Wt(function(de){Y.current||(Y.current=de.currentTarget),ae(de)&&(te(!0),V&&V(de)),U&&U(de)}),Je=function(){var Dt=Q();return C&&C!=="button"&&!(Dt.tagName==="A"&&Dt.href)},_t=Z.exports.useRef(!1),Ut=Wt(function(de){p&&!_t.current&&ge&&_.current&&de.key===" "&&(_t.current=!0,de.persist(),_.current.stop(de,function(){_.current.start(de)})),de.target===de.currentTarget&&Je()&&de.key===" "&&de.preventDefault(),F&&F(de),de.target===de.currentTarget&&Je()&&de.key==="Enter"&&!A&&(de.preventDefault(),y&&y(de))}),Pi=Wt(function(de){p&&de.key===" "&&_.current&&ge&&!de.defaultPrevented&&(_t.current=!1,de.persist(),_.current.stop(de,function(){_.current.pulsate(de)})),W&&W(de),y&&de.target===de.currentTarget&&Je()&&de.key===" "&&!de.defaultPrevented&&y(de)}),It=C;It==="button"&&T.href&&(It="a");var Fe={};It==="button"?(Fe.type=w,Fe.disabled=A):((It!=="a"||!T.href)&&(Fe.role="button"),Fe["aria-disabled"]=A);var xn=Pt(s,n),gt=Pt(Ge,Y),Wn=Pt(xn,gt),wn=Z.exports.useState(!1),sr=wn[0],gr=wn[1];Z.exports.useEffect(function(){gr(!0)},[]);var or=sr&&!h&&!A;return Z.exports.createElement(It,L({className:Se(a.root,I,ge&&[a.focusVisible,B],A&&a.disabled),onBlur:ve,onClick:y,onFocus:Xe,onKeyDown:Ut,onKeyUp:Pi,onMouseDown:at,onMouseLeave:Vt,onMouseUp:Ze,onDragLeave:Ie,onTouchEnd:tt,onTouchMove:Ue,onTouchStart:et,ref:Wn,tabIndex:A?-1:ce},Fe,T),r,or?Z.exports.createElement(BD,L({ref:_,center:o},x)):null)});const YF=Bt(bD,{name:"MuiButtonBase"})(yD);var vD=function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:Is(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:Is(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:Is(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}},GD=Z.exports.forwardRef(function(e,n){var i=e.edge,s=i===void 0?!1:i,g=e.children,o=e.classes,r=e.className,a=e.color,I=a===void 0?"default":a,l=e.disabled,C=l===void 0?!1:l,c=e.disableFocusRipple,A=c===void 0?!1:c,d=e.size,h=d===void 0?"medium":d,u=Ve(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return Z.exports.createElement(YF,L({className:Se(o.root,r,I!=="default"&&o["color".concat(Jn(I))],C&&o.disabled,h==="small"&&o["size".concat(Jn(h))],{start:o.edgeStart,end:o.edgeEnd}[s]),centerRipple:!0,focusRipple:!A,disabled:C,ref:n},u),Z.exports.createElement("span",{className:o.label},g))});const _i=Bt(vD,{name:"MuiIconButton"})(GD);var ZD=function(e){var n={duration:e.transitions.duration.shortest};return{root:{display:"flex",minHeight:8*6,transition:e.transitions.create(["min-height","background-color"],n),padding:e.spacing(0,2),"&:hover:not($disabled)":{cursor:"pointer"},"&$expanded":{minHeight:64},"&$focused, &$focusVisible":{backgroundColor:e.palette.action.focus},"&$disabled":{opacity:e.palette.action.disabledOpacity}},expanded:{},focused:{},focusVisible:{},disabled:{},content:{display:"flex",flexGrow:1,transition:e.transitions.create(["margin"],n),margin:"12px 0","&$expanded":{margin:"20px 0"}},expandIcon:{transform:"rotate(0deg)",transition:e.transitions.create("transform",n),"&:hover":{backgroundColor:"transparent"},"&$expanded":{transform:"rotate(180deg)"}}}},RD=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.classes,g=e.className,o=e.expandIcon,r=e.focusVisibleClassName,a=e.IconButtonProps,I=a===void 0?{}:a,l=e.onClick,C=Ve(e,["children","classes","className","expandIcon","focusVisibleClassName","IconButtonProps","onClick"]),c=Z.exports.useContext(XF),A=c.disabled,d=A===void 0?!1:A,h=c.expanded,u=c.toggle,m=function(p){u&&u(p),l&&l(p)};return Z.exports.createElement(YF,L({focusRipple:!1,disableRipple:!0,disabled:d,component:"div","aria-expanded":h,className:Se(s.root,g,d&&s.disabled,h&&s.expanded),focusVisibleClassName:Se(s.focusVisible,s.focused,r),onClick:m,ref:n},C),Z.exports.createElement("div",{className:Se(s.content,h&&s.expanded)},i),o&&Z.exports.createElement(_i,L({className:Se(s.expandIcon,h&&s.expanded),edge:"end",component:"div",tabIndex:null,role:null,"aria-hidden":!0},I),o))});const FD=Bt(ZD,{name:"MuiAccordionSummary"})(RD);var SD=function(e){return{root:{margin:0},body2:e.typography.body2,body1:e.typography.body1,caption:e.typography.caption,button:e.typography.button,h1:e.typography.h1,h2:e.typography.h2,h3:e.typography.h3,h4:e.typography.h4,h5:e.typography.h5,h6:e.typography.h6,subtitle1:e.typography.subtitle1,subtitle2:e.typography.subtitle2,overline:e.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorTextPrimary:{color:e.palette.text.primary},colorTextSecondary:{color:e.palette.text.secondary},colorError:{color:e.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}},dv={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},VD=Z.exports.forwardRef(function(e,n){var i=e.align,s=i===void 0?"inherit":i,g=e.classes,o=e.className,r=e.color,a=r===void 0?"initial":r,I=e.component,l=e.display,C=l===void 0?"initial":l,c=e.gutterBottom,A=c===void 0?!1:c,d=e.noWrap,h=d===void 0?!1:d,u=e.paragraph,m=u===void 0?!1:u,f=e.variant,p=f===void 0?"body1":f,B=e.variantMapping,G=B===void 0?dv:B,y=Ve(e,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),U=I||(m?"p":G[p]||dv[p])||"span";return Z.exports.createElement(U,L({className:Se(g.root,o,p!=="inherit"&&g[p],a!=="initial"&&g["color".concat(Jn(a))],h&&g.noWrap,A&&g.gutterBottom,m&&g.paragraph,s!=="inherit"&&g["align".concat(Jn(s))],C!=="initial"&&g["display".concat(Jn(C))]),ref:n},y))});const Ln=Bt(SD,{name:"MuiTypography"})(VD);var _F=Z.exports.createContext();function UD(){return Z.exports.useContext(_F)}const HF=_F;function xD(){return Z.exports.useContext(HF)}function WD(t){return t=typeof t=="function"?t():t,ki.exports.findDOMNode(t)}var Rd=typeof window<"u"?Z.exports.useLayoutEffect:Z.exports.useEffect,wD=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.container,g=e.disablePortal,o=g===void 0?!1:g,r=e.onRendered,a=Z.exports.useState(null),I=a[0],l=a[1],C=Pt(Z.exports.isValidElement(i)?i.ref:null,n);return Rd(function(){o||l(WD(s)||document.body)},[s,o]),Rd(function(){if(I&&!o)return LC(n,I),function(){LC(n,null)}},[n,I,o]),Rd(function(){r&&(I||o)&&r()},[r,I,o]),o?Z.exports.isValidElement(i)?Z.exports.cloneElement(i,{ref:C}):i:I&&ki.exports.createPortal(i,I)});const ND=wD;function TD(){var t=document.createElement("div");t.style.width="99px",t.style.height="99px",t.style.position="absolute",t.style.top="-9999px",t.style.overflow="scroll",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e}function ED(t){var e=Kn(t);return e.body===t?wF(e).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function da(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function uv(t){return parseInt(window.getComputedStyle(t)["padding-right"],10)||0}function hv(t,e,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],s=arguments.length>4?arguments[4]:void 0,g=[e,n].concat(cc(i)),o=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(t.children,function(r){r.nodeType===1&&g.indexOf(r)===-1&&o.indexOf(r.tagName)===-1&&da(r,s)})}function Fd(t,e){var n=-1;return t.some(function(i,s){return e(i)?(n=s,!0):!1}),n}function QD(t,e){var n=[],i=[],s=t.container,g;if(!e.disableScrollLock){if(ED(s)){var o=TD();n.push({value:s.style.paddingRight,key:"padding-right",el:s}),s.style["padding-right"]="".concat(uv(s)+o,"px"),g=Kn(s).querySelectorAll(".mui-fixed"),[].forEach.call(g,function(l){i.push(l.style.paddingRight),l.style.paddingRight="".concat(uv(l)+o,"px")})}var r=s.parentElement,a=r.nodeName==="HTML"&&window.getComputedStyle(r)["overflow-y"]==="scroll"?r:s;n.push({value:a.style.overflow,key:"overflow",el:a}),a.style.overflow="hidden"}var I=function(){g&&[].forEach.call(g,function(C,c){i[c]?C.style.paddingRight=i[c]:C.style.removeProperty("padding-right")}),n.forEach(function(C){var c=C.value,A=C.el,d=C.key;c?A.style.setProperty(d,c):A.style.removeProperty(d)})};return I}function XD(t){var e=[];return[].forEach.call(t.children,function(n){n.getAttribute&&n.getAttribute("aria-hidden")==="true"&&e.push(n)}),e}var YD=function(){function t(){Tx(this,t),this.modals=[],this.containers=[]}return vh(t,[{key:"add",value:function(n,i){var s=this.modals.indexOf(n);if(s!==-1)return s;s=this.modals.length,this.modals.push(n),n.modalRef&&da(n.modalRef,!1);var g=XD(i);hv(i,n.mountNode,n.modalRef,g,!0);var o=Fd(this.containers,function(r){return r.container===i});return o!==-1?(this.containers[o].modals.push(n),s):(this.containers.push({modals:[n],container:i,restore:null,hiddenSiblingNodes:g}),s)}},{key:"mount",value:function(n,i){var s=Fd(this.containers,function(o){return o.modals.indexOf(n)!==-1}),g=this.containers[s];g.restore||(g.restore=QD(g,i))}},{key:"remove",value:function(n){var i=this.modals.indexOf(n);if(i===-1)return i;var s=Fd(this.containers,function(r){return r.modals.indexOf(n)!==-1}),g=this.containers[s];if(g.modals.splice(g.modals.indexOf(n),1),this.modals.splice(i,1),g.modals.length===0)g.restore&&g.restore(),n.modalRef&&da(n.modalRef,!0),hv(g.container,n.mountNode,n.modalRef,g.hiddenSiblingNodes,!1),this.containers.splice(s,1);else{var o=g.modals[g.modals.length-1];o.modalRef&&da(o.modalRef,!1)}return i}},{key:"isTopModal",value:function(n){return this.modals.length>0&&this.modals[this.modals.length-1]===n}}]),t}();function _D(t){var e=t.children,n=t.disableAutoFocus,i=n===void 0?!1:n,s=t.disableEnforceFocus,g=s===void 0?!1:s,o=t.disableRestoreFocus,r=o===void 0?!1:o,a=t.getDoc,I=t.isEnabled,l=t.open,C=Z.exports.useRef(),c=Z.exports.useRef(null),A=Z.exports.useRef(null),d=Z.exports.useRef(),h=Z.exports.useRef(null),u=Z.exports.useCallback(function(p){h.current=ki.exports.findDOMNode(p)},[]),m=Pt(e.ref,u),f=Z.exports.useRef();return Z.exports.useEffect(function(){f.current=l},[l]),!f.current&&l&&typeof window<"u"&&(d.current=a().activeElement),Z.exports.useEffect(function(){if(!!l){var p=Kn(h.current);!i&&h.current&&!h.current.contains(p.activeElement)&&(h.current.hasAttribute("tabIndex")||h.current.setAttribute("tabIndex",-1),h.current.focus());var B=function(){var V=h.current;if(V!==null){if(!p.hasFocus()||g||!I()||C.current){C.current=!1;return}h.current&&!h.current.contains(p.activeElement)&&h.current.focus()}},G=function(V){g||!I()||V.keyCode!==9||p.activeElement===h.current&&(C.current=!0,V.shiftKey?A.current.focus():c.current.focus())};p.addEventListener("focus",B,!0),p.addEventListener("keydown",G,!0);var y=setInterval(function(){B()},50);return function(){clearInterval(y),p.removeEventListener("focus",B,!0),p.removeEventListener("keydown",G,!0),r||(d.current&&d.current.focus&&d.current.focus(),d.current=null)}}},[i,g,r,I,l]),Z.exports.createElement(Z.exports.Fragment,null,Z.exports.createElement("div",{tabIndex:0,ref:c,"data-test":"sentinelStart"}),Z.exports.cloneElement(e,{ref:m}),Z.exports.createElement("div",{tabIndex:0,ref:A,"data-test":"sentinelEnd"}))}var mv={root:{zIndex:-1,position:"fixed",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},HD=Z.exports.forwardRef(function(e,n){var i=e.invisible,s=i===void 0?!1:i,g=e.open,o=Ve(e,["invisible","open"]);return g?Z.exports.createElement("div",L({"aria-hidden":!0,ref:n},o,{style:L({},mv.root,s?mv.invisible:{},o.style)})):null});const kD=HD;function KD(t){return t=typeof t=="function"?t():t,ki.exports.findDOMNode(t)}function LD(t){return t.children?t.children.props.hasOwnProperty("in"):!1}var MD=new YD,PD=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}},JD=Z.exports.forwardRef(function(e,n){var i=gI(),s=WZ({name:"MuiModal",props:L({},e),theme:i}),g=s.BackdropComponent,o=g===void 0?kD:g,r=s.BackdropProps,a=s.children,I=s.closeAfterTransition,l=I===void 0?!1:I,C=s.container,c=s.disableAutoFocus,A=c===void 0?!1:c,d=s.disableBackdropClick,h=d===void 0?!1:d,u=s.disableEnforceFocus,m=u===void 0?!1:u,f=s.disableEscapeKeyDown,p=f===void 0?!1:f,B=s.disablePortal,G=B===void 0?!1:B,y=s.disableRestoreFocus,U=y===void 0?!1:y,V=s.disableScrollLock,F=V===void 0?!1:V,W=s.hideBackdrop,M=W===void 0?!1:W,E=s.keepMounted,H=E===void 0?!1:E,P=s.manager,z=P===void 0?MD:P,re=s.onBackdropClick,ue=s.onClose,ie=s.onEscapeKeyDown,ce=s.onRendered,x=s.open,S=Ve(s,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),w=Z.exports.useState(!0),T=w[0],Y=w[1],Q=Z.exports.useRef({}),_=Z.exports.useRef(null),D=Z.exports.useRef(null),ge=Pt(D,n),te=LD(s),he=function(){return Kn(_.current)},ae=function(){return Q.current.modalRef=D.current,Q.current.mountNode=_.current,Q.current},Be=function(){z.mount(ae(),{disableScrollLock:F}),D.current.scrollTop=0},Ge=Wt(function(){var Xe=KD(C)||he().body;z.add(ae(),Xe),D.current&&Be()}),pe=Z.exports.useCallback(function(){return z.isTopModal(ae())},[z]),at=Wt(function(Xe){_.current=Xe,Xe&&(ce&&ce(),x&&pe()?Be():da(D.current,!0))}),Ie=Z.exports.useCallback(function(){z.remove(ae())},[z]);if(Z.exports.useEffect(function(){return function(){Ie()}},[Ie]),Z.exports.useEffect(function(){x?Ge():(!te||!l)&&Ie()},[x,Ie,te,l,Ge]),!H&&!x&&(!te||T))return null;var Ze=function(){Y(!1)},Vt=function(){Y(!0),l&&Ie()},et=function(Je){Je.target===Je.currentTarget&&(re&&re(Je),!h&&ue&&ue(Je,"backdropClick"))},tt=function(Je){Je.key!=="Escape"||!pe()||(ie&&ie(Je),p||(Je.stopPropagation(),ue&&ue(Je,"escapeKeyDown")))},Ue=PD(i||{zIndex:SF}),ve={};return a.props.tabIndex===void 0&&(ve.tabIndex=a.props.tabIndex||"-1"),te&&(ve.onEnter=f0(Ze,a.props.onEnter),ve.onExited=f0(Vt,a.props.onExited)),Z.exports.createElement(ND,{ref:at,container:C,disablePortal:G},Z.exports.createElement("div",L({ref:ge,onKeyDown:tt,role:"presentation"},S,{style:L({},Ue.root,!x&&T?Ue.hidden:{},S.style)}),M?null:Z.exports.createElement(o,L({open:x,onClick:et},r)),Z.exports.createElement(_D,{disableEnforceFocus:m,disableAutoFocus:A,disableRestoreFocus:U,getDoc:he,isEnabled:pe,open:x},Z.exports.cloneElement(a,ve))))});const DD=JD;var zD=function(e){return{root:{height:1,margin:0,border:"none",flexShrink:0,backgroundColor:e.palette.divider},absolute:{position:"absolute",bottom:0,left:0,width:"100%"},inset:{marginLeft:72},light:{backgroundColor:Is(e.palette.divider,.08)},middle:{marginLeft:e.spacing(2),marginRight:e.spacing(2)},vertical:{height:"100%",width:1},flexItem:{alignSelf:"stretch",height:"auto"}}},OD=Z.exports.forwardRef(function(e,n){var i=e.absolute,s=i===void 0?!1:i,g=e.classes,o=e.className,r=e.component,a=r===void 0?"hr":r,I=e.flexItem,l=I===void 0?!1:I,C=e.light,c=C===void 0?!1:C,A=e.orientation,d=A===void 0?"horizontal":A,h=e.role,u=h===void 0?a!=="hr"?"separator":void 0:h,m=e.variant,f=m===void 0?"fullWidth":m,p=Ve(e,["absolute","classes","className","component","flexItem","light","orientation","role","variant"]);return Z.exports.createElement(a,L({className:Se(g.root,o,f!=="fullWidth"&&g[f],s&&g.absolute,l&&g.flexItem,c&&g.light,d==="vertical"&&g.vertical),role:u,ref:n},p))});const an=Bt(zD,{name:"MuiDivider"})(OD);function kF(t){var e=t.props,n=t.states,i=t.muiFormControl;return n.reduce(function(s,g){return s[g]=e[g],i&&typeof e[g]>"u"&&(s[g]=i[g]),s},{})}function hl(t,e){return parseInt(t[e],10)||0}var jD=typeof window<"u"?Z.exports.useLayoutEffect:Z.exports.useEffect,qD={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}},$D=Z.exports.forwardRef(function(e,n){var i=e.onChange,s=e.rows,g=e.rowsMax,o=e.rowsMin,r=e.maxRows,a=e.minRows,I=a===void 0?1:a,l=e.style,C=e.value,c=Ve(e,["onChange","rows","rowsMax","rowsMin","maxRows","minRows","style","value"]),A=r||g,d=s||o||I,h=Z.exports.useRef(C!=null),u=h.current,m=Z.exports.useRef(null),f=Pt(n,m),p=Z.exports.useRef(null),B=Z.exports.useRef(0),G=Z.exports.useState({}),y=G[0],U=G[1],V=Z.exports.useCallback(function(){var W=m.current,M=window.getComputedStyle(W),E=p.current;E.style.width=M.width,E.value=W.value||e.placeholder||"x",E.value.slice(-1)===`
`&&(E.value+=" ");var H=M["box-sizing"],P=hl(M,"padding-bottom")+hl(M,"padding-top"),z=hl(M,"border-bottom-width")+hl(M,"border-top-width"),re=E.scrollHeight-P;E.value="x";var ue=E.scrollHeight-P,ie=re;d&&(ie=Math.max(Number(d)*ue,ie)),A&&(ie=Math.min(Number(A)*ue,ie)),ie=Math.max(ie,ue);var ce=ie+(H==="border-box"?P+z:0),x=Math.abs(ie-re)<=1;U(function(S){return B.current<20&&(ce>0&&Math.abs((S.outerHeightStyle||0)-ce)>1||S.overflow!==x)?(B.current+=1,{overflow:x,outerHeightStyle:ce}):S})},[A,d,e.placeholder]);Z.exports.useEffect(function(){var W=WF(function(){B.current=0,V()});return window.addEventListener("resize",W),function(){W.clear(),window.removeEventListener("resize",W)}},[V]),jD(function(){V()}),Z.exports.useEffect(function(){B.current=0},[C]);var F=function(M){B.current=0,u||V(),i&&i(M)};return Z.exports.createElement(Z.exports.Fragment,null,Z.exports.createElement("textarea",L({value:C,onChange:F,ref:f,rows:d,style:L({height:y.outerHeightStyle,overflow:y.overflow?"hidden":null},l)},c)),Z.exports.createElement("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:p,tabIndex:-1,style:L({},qD.shadow,l)}))});const ez=$D;function fv(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function tz(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return t&&(fv(t.value)&&t.value!==""||e&&fv(t.defaultValue)&&t.defaultValue!=="")}var nz=function(e){var n=e.palette.type==="light",i={color:"currentColor",opacity:n?.42:.5,transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},s={opacity:"0 !important"},g={opacity:n?.42:.5};return{"@global":{"@keyframes mui-auto-fill":{},"@keyframes mui-auto-fill-cancel":{}},root:L({},e.typography.body1,{color:e.palette.text.primary,lineHeight:"1.1876em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center","&$disabled":{color:e.palette.text.disabled,cursor:"default"}}),formControl:{},focused:{},disabled:{},adornedStart:{},adornedEnd:{},error:{},marginDense:{},multiline:{padding:"".concat(8-2,"px 0 ").concat(8-1,"px"),"&$marginDense":{paddingTop:4-1}},colorSecondary:{},fullWidth:{width:"100%"},input:{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"".concat(8-2,"px 0 ").concat(8-1,"px"),border:0,boxSizing:"content-box",background:"none",height:"1.1876em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{"-webkit-appearance":"none"},"label[data-shrink=false] + $formControl &":{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&:-ms-input-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":g,"&:focus::-moz-placeholder":g,"&:focus:-ms-input-placeholder":g,"&:focus::-ms-input-placeholder":g},"&$disabled":{opacity:1},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},inputMarginDense:{paddingTop:4-1},inputMultiline:{height:"auto",resize:"none",padding:0},inputTypeSearch:{"-moz-appearance":"textfield","-webkit-appearance":"textfield"},inputAdornedStart:{},inputAdornedEnd:{},inputHiddenLabel:{}}},iz=typeof window>"u"?Z.exports.useEffect:Z.exports.useLayoutEffect,sz=Z.exports.forwardRef(function(e,n){var i=e["aria-describedby"],s=e.autoComplete,g=e.autoFocus,o=e.classes,r=e.className;e.color;var a=e.defaultValue,I=e.disabled,l=e.endAdornment;e.error;var C=e.fullWidth,c=C===void 0?!1:C,A=e.id,d=e.inputComponent,h=d===void 0?"input":d,u=e.inputProps,m=u===void 0?{}:u,f=e.inputRef;e.margin;var p=e.multiline,B=p===void 0?!1:p,G=e.name,y=e.onBlur,U=e.onChange,V=e.onClick,F=e.onFocus,W=e.onKeyDown,M=e.onKeyUp,E=e.placeholder,H=e.readOnly,P=e.renderSuffix,z=e.rows,re=e.rowsMax,ue=e.rowsMin,ie=e.maxRows,ce=e.minRows,x=e.startAdornment,S=e.type,w=S===void 0?"text":S,T=e.value,Y=Ve(e,["aria-describedby","autoComplete","autoFocus","classes","className","color","defaultValue","disabled","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","rowsMax","rowsMin","maxRows","minRows","startAdornment","type","value"]),Q=m.value!=null?m.value:T,_=Z.exports.useRef(Q!=null),D=_.current,ge=Z.exports.useRef(),te=Z.exports.useCallback(function(It){},[]),he=Pt(m.ref,te),ae=Pt(f,he),Be=Pt(ge,ae),Ge=Z.exports.useState(!1),pe=Ge[0],at=Ge[1],Ie=UD(),Ze=kF({props:e,muiFormControl:Ie,states:["color","disabled","error","hiddenLabel","margin","required","filled"]});Ze.focused=Ie?Ie.focused:pe,Z.exports.useEffect(function(){!Ie&&I&&pe&&(at(!1),y&&y())},[Ie,I,pe,y]);var Vt=Ie&&Ie.onFilled,et=Ie&&Ie.onEmpty,tt=Z.exports.useCallback(function(It){tz(It)?Vt&&Vt():et&&et()},[Vt,et]);iz(function(){D&&tt({value:Q})},[Q,tt,D]);var Ue=function(Fe){if(Ze.disabled){Fe.stopPropagation();return}F&&F(Fe),m.onFocus&&m.onFocus(Fe),Ie&&Ie.onFocus?Ie.onFocus(Fe):at(!0)},ve=function(Fe){y&&y(Fe),m.onBlur&&m.onBlur(Fe),Ie&&Ie.onBlur?Ie.onBlur(Fe):at(!1)},Xe=function(Fe){if(!D){var xn=Fe.target||ge.current;if(xn==null)throw new Error(Va(1));tt({value:xn.value})}for(var gt=arguments.length,Wn=new Array(gt>1?gt-1:0),wn=1;wn<gt;wn++)Wn[wn-1]=arguments[wn];m.onChange&&m.onChange.apply(m,[Fe].concat(Wn)),U&&U.apply(void 0,[Fe].concat(Wn))};Z.exports.useEffect(function(){tt(ge.current)},[]);var Je=function(Fe){ge.current&&Fe.currentTarget===Fe.target&&ge.current.focus(),V&&V(Fe)},_t=h,Ut=L({},m,{ref:Be});typeof _t!="string"?Ut=L({inputRef:Be,type:w},Ut,{ref:null}):B?z&&!ie&&!ce&&!re&&!ue?_t="textarea":(Ut=L({minRows:z||ce,rowsMax:re,maxRows:ie},Ut),_t=ez):Ut=L({type:w},Ut);var Pi=function(Fe){tt(Fe.animationName==="mui-auto-fill-cancel"?ge.current:{value:"x"})};return Z.exports.useEffect(function(){Ie&&Ie.setAdornedStart(Boolean(x))},[Ie,x]),Z.exports.createElement("div",L({className:Se(o.root,o["color".concat(Jn(Ze.color||"primary"))],r,Ze.disabled&&o.disabled,Ze.error&&o.error,c&&o.fullWidth,Ze.focused&&o.focused,Ie&&o.formControl,B&&o.multiline,x&&o.adornedStart,l&&o.adornedEnd,Ze.margin==="dense"&&o.marginDense),onClick:Je,ref:n},Y),x,Z.exports.createElement(HF.Provider,{value:null},Z.exports.createElement(_t,L({"aria-invalid":Ze.error,"aria-describedby":i,autoComplete:s,autoFocus:g,defaultValue:a,disabled:Ze.disabled,id:A,onAnimationStart:Pi,name:G,placeholder:E,readOnly:H,required:Ze.required,rows:z,value:Q,onKeyDown:W,onKeyUp:M},Ut,{className:Se(o.input,m.className,Ze.disabled&&o.disabled,B&&o.inputMultiline,Ze.hiddenLabel&&o.inputHiddenLabel,x&&o.inputAdornedStart,l&&o.inputAdornedEnd,w==="search"&&o.inputTypeSearch,Ze.margin==="dense"&&o.inputMarginDense),onBlur:ve,onChange:Xe,onFocus:Ue}))),l,P?P(L({},Ze,{startAdornment:x})):null)});const gz=Bt(nz,{name:"MuiInputBase"})(sz);var oz=[0,1,2,3,4,5,6,7,8,9,10],rz=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12];function az(t,e,n){var i={};rz.forEach(function(s){var g="grid-".concat(n,"-").concat(s);if(s===!0){i[g]={flexBasis:0,flexGrow:1,maxWidth:"100%"};return}if(s==="auto"){i[g]={flexBasis:"auto",flexGrow:0,maxWidth:"none"};return}var o="".concat(Math.round(s/12*1e8)/1e6,"%");i[g]={flexBasis:o,flexGrow:0,maxWidth:o}}),n==="xs"?L(t,i):t[e.breakpoints.up(n)]=i}function Sd(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=parseFloat(t);return"".concat(n/e).concat(String(t).replace(String(n),"")||"px")}function Iz(t,e){var n={};return oz.forEach(function(i){var s=t.spacing(i);s!==0&&(n["spacing-".concat(e,"-").concat(i)]={margin:"-".concat(Sd(s,2)),width:"calc(100% + ".concat(Sd(s),")"),"& > $item":{padding:Sd(s,2)}})}),n}var lz=function(e){return L({root:{},container:{boxSizing:"border-box",display:"flex",flexWrap:"wrap",width:"100%"},item:{boxSizing:"border-box",margin:"0"},zeroMinWidth:{minWidth:0},"direction-xs-column":{flexDirection:"column"},"direction-xs-column-reverse":{flexDirection:"column-reverse"},"direction-xs-row-reverse":{flexDirection:"row-reverse"},"wrap-xs-nowrap":{flexWrap:"nowrap"},"wrap-xs-wrap-reverse":{flexWrap:"wrap-reverse"},"align-items-xs-center":{alignItems:"center"},"align-items-xs-flex-start":{alignItems:"flex-start"},"align-items-xs-flex-end":{alignItems:"flex-end"},"align-items-xs-baseline":{alignItems:"baseline"},"align-content-xs-center":{alignContent:"center"},"align-content-xs-flex-start":{alignContent:"flex-start"},"align-content-xs-flex-end":{alignContent:"flex-end"},"align-content-xs-space-between":{alignContent:"space-between"},"align-content-xs-space-around":{alignContent:"space-around"},"justify-content-xs-center":{justifyContent:"center"},"justify-content-xs-flex-end":{justifyContent:"flex-end"},"justify-content-xs-space-between":{justifyContent:"space-between"},"justify-content-xs-space-around":{justifyContent:"space-around"},"justify-content-xs-space-evenly":{justifyContent:"space-evenly"}},Iz(e,"xs"),e.breakpoints.keys.reduce(function(n,i){return az(n,e,i),n},{}))},Cz=Z.exports.forwardRef(function(e,n){var i=e.alignContent,s=i===void 0?"stretch":i,g=e.alignItems,o=g===void 0?"stretch":g,r=e.classes,a=e.className,I=e.component,l=I===void 0?"div":I,C=e.container,c=C===void 0?!1:C,A=e.direction,d=A===void 0?"row":A,h=e.item,u=h===void 0?!1:h,m=e.justify,f=e.justifyContent,p=f===void 0?"flex-start":f,B=e.lg,G=B===void 0?!1:B,y=e.md,U=y===void 0?!1:y,V=e.sm,F=V===void 0?!1:V,W=e.spacing,M=W===void 0?0:W,E=e.wrap,H=E===void 0?"wrap":E,P=e.xl,z=P===void 0?!1:P,re=e.xs,ue=re===void 0?!1:re,ie=e.zeroMinWidth,ce=ie===void 0?!1:ie,x=Ve(e,["alignContent","alignItems","classes","className","component","container","direction","item","justify","justifyContent","lg","md","sm","spacing","wrap","xl","xs","zeroMinWidth"]),S=Se(r.root,a,c&&[r.container,M!==0&&r["spacing-xs-".concat(String(M))]],u&&r.item,ce&&r.zeroMinWidth,d!=="row"&&r["direction-xs-".concat(String(d))],H!=="wrap"&&r["wrap-xs-".concat(String(H))],o!=="stretch"&&r["align-items-xs-".concat(String(o))],s!=="stretch"&&r["align-content-xs-".concat(String(s))],(m||p)!=="flex-start"&&r["justify-content-xs-".concat(String(m||p))],ue!==!1&&r["grid-xs-".concat(String(ue))],F!==!1&&r["grid-sm-".concat(String(F))],U!==!1&&r["grid-md-".concat(String(U))],G!==!1&&r["grid-lg-".concat(String(G))],z!==!1&&r["grid-xl-".concat(String(z))]);return Z.exports.createElement(l,L({className:S,ref:n},x))}),cz=Bt(lz,{name:"MuiGrid"})(Cz);const Oe=cz;function y0(t){return"scale(".concat(t,", ").concat(Math.pow(t,2),")")}var Az={entering:{opacity:1,transform:y0(1)},entered:{opacity:1,transform:"none"}},KF=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.disableStrictModeCompat,g=s===void 0?!1:s,o=e.in,r=e.onEnter,a=e.onEntered,I=e.onEntering,l=e.onExit,C=e.onExited,c=e.onExiting,A=e.style,d=e.timeout,h=d===void 0?"auto":d,u=e.TransitionComponent,m=u===void 0?EF:u,f=Ve(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),p=Z.exports.useRef(),B=Z.exports.useRef(),G=Jm(),y=G.unstable_strictMode&&!g,U=Z.exports.useRef(null),V=Pt(i.ref,n),F=Pt(y?U:void 0,V),W=function(ce){return function(x,S){if(ce){var w=y?[U.current,x]:[x,S],T=Mc(w,2),Y=T[0],Q=T[1];Q===void 0?ce(Y):ce(Y,Q)}}},M=W(I),E=W(function(ie,ce){iD(ie);var x=PC({style:A,timeout:h},{mode:"enter"}),S=x.duration,w=x.delay,T;h==="auto"?(T=G.transitions.getAutoHeightDuration(ie.clientHeight),B.current=T):T=S,ie.style.transition=[G.transitions.create("opacity",{duration:T,delay:w}),G.transitions.create("transform",{duration:T*.666,delay:w})].join(","),r&&r(ie,ce)}),H=W(a),P=W(c),z=W(function(ie){var ce=PC({style:A,timeout:h},{mode:"exit"}),x=ce.duration,S=ce.delay,w;h==="auto"?(w=G.transitions.getAutoHeightDuration(ie.clientHeight),B.current=w):w=x,ie.style.transition=[G.transitions.create("opacity",{duration:w,delay:S}),G.transitions.create("transform",{duration:w*.666,delay:S||w*.333})].join(","),ie.style.opacity="0",ie.style.transform=y0(.75),l&&l(ie)}),re=W(C),ue=function(ce,x){var S=y?ce:x;h==="auto"&&(p.current=setTimeout(S,B.current||0))};return Z.exports.useEffect(function(){return function(){clearTimeout(p.current)}},[]),Z.exports.createElement(m,L({appear:!0,in:o,nodeRef:y?U:void 0,onEnter:E,onEntered:H,onEntering:M,onExit:z,onExited:re,onExiting:P,addEndListener:ue,timeout:h==="auto"?null:h},f),function(ie,ce){return Z.exports.cloneElement(i,L({style:L({opacity:0,transform:y0(.75),visibility:ie==="exited"&&!o?"hidden":void 0},Az[ie],A,i.props.style),ref:F},ce))})});KF.muiSupportAuto=!0;const dz=KF;var uz=function(e){var n=e.palette.type==="light",i=n?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{position:"relative"},formControl:{"label + &":{marginTop:16}},focused:{},disabled:{},colorSecondary:{"&$underline:after":{borderBottomColor:e.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(e.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(i),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):before":{borderBottom:"2px solid ".concat(e.palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(i)}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{},marginDense:{},multiline:{},fullWidth:{},input:{},inputMarginDense:{},inputMultiline:{},inputTypeSearch:{}}},LF=Z.exports.forwardRef(function(e,n){var i=e.disableUnderline,s=e.classes,g=e.fullWidth,o=g===void 0?!1:g,r=e.inputComponent,a=r===void 0?"input":r,I=e.multiline,l=I===void 0?!1:I,C=e.type,c=C===void 0?"text":C,A=Ve(e,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return Z.exports.createElement(gz,L({classes:L({},s,{root:Se(s.root,!i&&s.underline),underline:null}),fullWidth:o,inputComponent:a,multiline:l,ref:n,type:c},A))});LF.muiName="Input";const Om=Bt(uz,{name:"MuiInput"})(LF);function pv(t,e){var n=0;return typeof e=="number"?n=e:e==="center"?n=t.height/2:e==="bottom"&&(n=t.height),n}function Bv(t,e){var n=0;return typeof e=="number"?n=e:e==="center"?n=t.width/2:e==="right"&&(n=t.width),n}function bv(t){return[t.horizontal,t.vertical].map(function(e){return typeof e=="number"?"".concat(e,"px"):e}).join(" ")}function hz(t,e){for(var n=e,i=0;n&&n!==t;)n=n.parentElement,i+=n.scrollTop;return i}function Vd(t){return typeof t=="function"?t():t}var mz={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},fz=Z.exports.forwardRef(function(e,n){var i=e.action,s=e.anchorEl,g=e.anchorOrigin,o=g===void 0?{vertical:"top",horizontal:"left"}:g,r=e.anchorPosition,a=e.anchorReference,I=a===void 0?"anchorEl":a,l=e.children,C=e.classes,c=e.className,A=e.container,d=e.elevation,h=d===void 0?8:d,u=e.getContentAnchorEl,m=e.marginThreshold,f=m===void 0?16:m,p=e.onEnter,B=e.onEntered,G=e.onEntering,y=e.onExit,U=e.onExited,V=e.onExiting,F=e.open,W=e.PaperProps,M=W===void 0?{}:W,E=e.transformOrigin,H=E===void 0?{vertical:"top",horizontal:"left"}:E,P=e.TransitionComponent,z=P===void 0?dz:P,re=e.transitionDuration,ue=re===void 0?"auto":re,ie=e.TransitionProps,ce=ie===void 0?{}:ie,x=Ve(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),S=Z.exports.useRef(),w=Z.exports.useCallback(function(ae){if(I==="anchorPosition")return r;var Be=Vd(s),Ge=Be&&Be.nodeType===1?Be:Kn(S.current).body,pe=Ge.getBoundingClientRect(),at=ae===0?o.vertical:"center";return{top:pe.top+pv(pe,at),left:pe.left+Bv(pe,o.horizontal)}},[s,o.horizontal,o.vertical,r,I]),T=Z.exports.useCallback(function(ae){var Be=0;if(u&&I==="anchorEl"){var Ge=u(ae);if(Ge&&ae.contains(Ge)){var pe=hz(ae,Ge);Be=Ge.offsetTop+Ge.clientHeight/2-pe||0}}return Be},[o.vertical,I,u]),Y=Z.exports.useCallback(function(ae){var Be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return{vertical:pv(ae,H.vertical)+Be,horizontal:Bv(ae,H.horizontal)}},[H.horizontal,H.vertical]),Q=Z.exports.useCallback(function(ae){var Be=T(ae),Ge={width:ae.offsetWidth,height:ae.offsetHeight},pe=Y(Ge,Be);if(I==="none")return{top:null,left:null,transformOrigin:bv(pe)};var at=w(Be),Ie=at.top-pe.vertical,Ze=at.left-pe.horizontal,Vt=Ie+Ge.height,et=Ze+Ge.width,tt=wF(Vd(s)),Ue=tt.innerHeight-f,ve=tt.innerWidth-f;if(Ie<f){var Xe=Ie-f;Ie-=Xe,pe.vertical+=Xe}else if(Vt>Ue){var Je=Vt-Ue;Ie-=Je,pe.vertical+=Je}if(Ze<f){var _t=Ze-f;Ze-=_t,pe.horizontal+=_t}else if(et>ve){var Ut=et-ve;Ze-=Ut,pe.horizontal+=Ut}return{top:"".concat(Math.round(Ie),"px"),left:"".concat(Math.round(Ze),"px"),transformOrigin:bv(pe)}},[s,I,w,T,Y,f]),_=Z.exports.useCallback(function(){var ae=S.current;if(!!ae){var Be=Q(ae);Be.top!==null&&(ae.style.top=Be.top),Be.left!==null&&(ae.style.left=Be.left),ae.style.transformOrigin=Be.transformOrigin}},[Q]),D=function(Be,Ge){G&&G(Be,Ge),_()},ge=Z.exports.useCallback(function(ae){S.current=ki.exports.findDOMNode(ae)},[]);Z.exports.useEffect(function(){F&&_()}),Z.exports.useImperativeHandle(i,function(){return F?{updatePosition:function(){_()}}:null},[F,_]),Z.exports.useEffect(function(){if(!!F){var ae=WF(function(){_()});return window.addEventListener("resize",ae),function(){ae.clear(),window.removeEventListener("resize",ae)}}},[F,_]);var te=ue;ue==="auto"&&!z.muiSupportAuto&&(te=void 0);var he=A||(s?Kn(Vd(s)).body:void 0);return Z.exports.createElement(DD,L({container:he,open:F,ref:n,BackdropProps:{invisible:!0},className:Se(C.root,c)},x),Z.exports.createElement(z,L({appear:!0,in:F,onEnter:p,onEntered:B,onExit:y,onExited:U,onExiting:V,timeout:te},ce,{onEntering:f0(D,ce.onEntering)}),Z.exports.createElement(GI,L({elevation:h,ref:ge},M,{className:Se(C.paper,M.className)}),l)))});const jm=Bt(mz,{name:"MuiPopover"})(fz);var pz=Z.exports.forwardRef(function(e,n){var i=e.classes,s=e.className,g=e.disabled,o=e.IconComponent,r=e.inputRef,a=e.variant,I=a===void 0?"standard":a,l=Ve(e,["classes","className","disabled","IconComponent","inputRef","variant"]);return Z.exports.createElement(Z.exports.Fragment,null,Z.exports.createElement("select",L({className:Se(i.root,i.select,i[I],s,g&&i.disabled),disabled:g,ref:r||n},l)),e.multiple?null:Z.exports.createElement(o,{className:Se(i.icon,i["icon".concat(Jn(I))],g&&i.disabled)}))});const Bz=pz,bz=Li(Z.exports.createElement("path",{d:"M7 10l5 5 5-5z"}));var yz=function(e){return{root:{},select:{"-moz-appearance":"none","-webkit-appearance":"none",userSelect:"none",borderRadius:0,minWidth:16,cursor:"pointer","&:focus":{backgroundColor:e.palette.type==="light"?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"},"&$disabled":{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:e.palette.background.paper},"&&":{paddingRight:24}},filled:{"&&":{paddingRight:32}},outlined:{borderRadius:e.shape.borderRadius,"&&":{paddingRight:32}},selectMenu:{height:"auto",minHeight:"1.1876em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},disabled:{},icon:{position:"absolute",right:0,top:"calc(50% - 12px)",pointerEvents:"none",color:e.palette.action.active,"&$disabled":{color:e.palette.action.disabled}},iconOpen:{transform:"rotate(180deg)"},iconFilled:{right:7},iconOutlined:{right:7},nativeInput:{bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%"}}},vz=Z.exports.createElement(Om,null),MF=Z.exports.forwardRef(function(e,n){var i=e.children,s=e.classes,g=e.IconComponent,o=g===void 0?bz:g,r=e.input,a=r===void 0?vz:r,I=e.inputProps;e.variant;var l=Ve(e,["children","classes","IconComponent","input","inputProps","variant"]),C=xD(),c=kF({props:e,muiFormControl:C,states:["variant"]});return Z.exports.cloneElement(a,L({inputComponent:Bz,inputProps:L({children:i,classes:s,IconComponent:o,variant:c.variant,type:void 0},I,a?a.props.inputProps:{}),ref:n},l))});MF.muiName="Select";const qm=Bt(yz,{name:"MuiNativeSelect"})(MF);var Gz=function(e){return{thumb:{"&$open":{"& $offset":{transform:"scale(1) translateY(-10px)"}}},open:{},offset:L({zIndex:1},e.typography.body2,{fontSize:e.typography.pxToRem(12),lineHeight:1.2,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),top:-34,transformOrigin:"bottom center",transform:"scale(0)",position:"absolute"}),circle:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"currentColor",transform:"rotate(-45deg)"},label:{color:e.palette.primary.contrastText,transform:"rotate(45deg)"}}};function Zz(t){var e=t.children,n=t.classes,i=t.className,s=t.open,g=t.value,o=t.valueLabelDisplay;return o==="off"?e:Z.exports.cloneElement(e,{className:Se(e.props.className,(s||o==="on")&&n.open,n.thumb)},Z.exports.createElement("span",{className:Se(n.offset,i)},Z.exports.createElement("span",{className:n.circle},Z.exports.createElement("span",{className:n.label},g))))}const Rz=Bt(Gz,{name:"PrivateValueLabel"})(Zz);function Ud(t,e){return t-e}function xd(t,e,n){return Math.min(Math.max(e,t),n)}function yv(t,e){var n=t.reduce(function(s,g,o){var r=Math.abs(e-g);return s===null||r<s.distance||r===s.distance?{distance:r,index:o}:s},null),i=n.index;return i}function ml(t,e){if(e.current!==void 0&&t.changedTouches){for(var n=0;n<t.changedTouches.length;n+=1){var i=t.changedTouches[n];if(i.identifier===e.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:t.clientX,y:t.clientY}}function fl(t,e,n){return(t-e)*100/(n-e)}function Fz(t,e,n){return(n-e)*t+e}function Sz(t){if(Math.abs(t)<1){var e=t.toExponential().split("e-"),n=e[0].split(".")[1];return(n?n.length:0)+parseInt(e[1],10)}var i=t.toString().split(".")[1];return i?i.length:0}function vv(t,e,n){var i=Math.round((t-n)/e)*e+n;return Number(i.toFixed(Sz(e)))}function Gv(t){var e=t.values,n=t.source,i=t.newValue,s=t.index;if(e[s]===i)return n;var g=e.slice();return g[s]=i,g}function pl(t){var e=t.sliderRef,n=t.activeIndex,i=t.setActive;(!e.current.contains(document.activeElement)||Number(document.activeElement.getAttribute("data-index"))!==n)&&e.current.querySelector('[role="slider"][data-index="'.concat(n,'"]')).focus(),i&&i(n)}var Bl={horizontal:{offset:function(e){return{left:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},"horizontal-reverse":{offset:function(e){return{right:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},vertical:{offset:function(e){return{bottom:"".concat(e,"%")}},leap:function(e){return{height:"".concat(e,"%")}}}},Zv=function(e){return e},Vz=function(e){return{root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:e.palette.type==="light"?GF(e.palette.primary.main,.62):vF(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(Is(e.palette.primary.main,.16)),"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(Is(e.palette.primary.main,.16))},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(Is(e.palette.secondary.main,.16))},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(Is(e.palette.secondary.main,.16))}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:L({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}},Uz=Z.exports.forwardRef(function(e,n){var i=e["aria-label"],s=e["aria-labelledby"],g=e["aria-valuetext"],o=e.classes,r=e.className,a=e.color,I=a===void 0?"primary":a,l=e.component,C=l===void 0?"span":l,c=e.defaultValue,A=e.disabled,d=A===void 0?!1:A,h=e.getAriaLabel,u=e.getAriaValueText,m=e.marks,f=m===void 0?!1:m,p=e.max,B=p===void 0?100:p,G=e.min,y=G===void 0?0:G,U=e.name,V=e.onChange,F=e.onChangeCommitted,W=e.onMouseDown,M=e.orientation,E=M===void 0?"horizontal":M,H=e.scale,P=H===void 0?Zv:H,z=e.step,re=z===void 0?1:z,ue=e.ThumbComponent,ie=ue===void 0?"span":ue,ce=e.track,x=ce===void 0?"normal":ce,S=e.value,w=e.ValueLabelComponent,T=w===void 0?Rz:w,Y=e.valueLabelDisplay,Q=Y===void 0?"off":Y,_=e.valueLabelFormat,D=_===void 0?Zv:_,ge=Ve(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]),te=Jm(),he=Z.exports.useRef(),ae=Z.exports.useState(-1),Be=ae[0],Ge=ae[1],pe=Z.exports.useState(-1),at=pe[0],Ie=pe[1],Ze=NF({controlled:S,default:c,name:"Slider"}),Vt=Mc(Ze,2),et=Vt[0],tt=Vt[1],Ue=Array.isArray(et),ve=Ue?et.slice().sort(Ud):[et];ve=ve.map(function(oe){return xd(oe,y,B)});var Xe=f===!0&&re!==null?cc(Array(Math.floor((B-y)/re)+1)).map(function(oe,le){return{value:y+re*le}}):f||[],Je=TF(),_t=Je.isFocusVisible,Ut=Je.onBlurVisible,Pi=Je.ref,It=Z.exports.useState(-1),Fe=It[0],xn=It[1],gt=Z.exports.useRef(),Wn=Pt(Pi,gt),wn=Pt(n,Wn),sr=Wt(function(oe){var le=Number(oe.currentTarget.getAttribute("data-index"));_t(oe)&&xn(le),Ie(le)}),gr=Wt(function(){Fe!==-1&&(xn(-1),Ut()),Ie(-1)}),or=Wt(function(oe){var le=Number(oe.currentTarget.getAttribute("data-index"));Ie(le)}),de=Wt(function(){Ie(-1)}),Dt=te.direction==="rtl",rr=Wt(function(oe){var le=Number(oe.currentTarget.getAttribute("data-index")),De=ve[le],qe=(B-y)/10,We=Xe.map(function(wg){return wg.value}),zt=We.indexOf(De),Ye,xg=Dt?"ArrowLeft":"ArrowRight",Ji=Dt?"ArrowRight":"ArrowLeft";switch(oe.key){case"Home":Ye=y;break;case"End":Ye=B;break;case"PageUp":re&&(Ye=De+qe);break;case"PageDown":re&&(Ye=De-qe);break;case xg:case"ArrowUp":re?Ye=De+re:Ye=We[zt+1]||We[We.length-1];break;case Ji:case"ArrowDown":re?Ye=De-re:Ye=We[zt-1]||We[0];break;default:return}if(oe.preventDefault(),re&&(Ye=vv(Ye,re,y)),Ye=xd(Ye,y,B),Ue){var Wg=Ye;Ye=Gv({values:ve,source:et,newValue:Ye,index:le}).sort(Ud),pl({sliderRef:gt,activeIndex:Ye.indexOf(Wg)})}tt(Ye),xn(le),V&&V(oe,Ye),F&&F(oe,Ye)}),Ks=Z.exports.useRef(),mn=E;Dt&&E!=="vertical"&&(mn+="-reverse");var Ls=function(le){var De=le.finger,qe=le.move,We=qe===void 0?!1:qe,zt=le.values,Ye=le.source,xg=gt.current,Ji=xg.getBoundingClientRect(),Wg=Ji.width,wg=Ji.height,ZI=Ji.bottom,RI=Ji.left,fi;mn.indexOf("vertical")===0?fi=(ZI-De.y)/wg:fi=(De.x-RI)/Wg,mn.indexOf("-reverse")!==-1&&(fi=1-fi);var ot;if(ot=Fz(fi,y,B),re)ot=vv(ot,re,y);else{var Di=Xe.map(function(Oc){return Oc.value}),Ms=yv(Di,ot);ot=Di[Ms]}ot=xd(ot,y,B);var Tn=0;if(Ue){We?Tn=Ks.current:Tn=yv(zt,ot);var lr=ot;ot=Gv({values:zt,source:Ye,newValue:ot,index:Tn}).sort(Ud),Tn=ot.indexOf(lr),Ks.current=Tn}return{newValue:ot,activeIndex:Tn}},Nn=Wt(function(oe){var le=ml(oe,he);if(!!le){var De=Ls({finger:le,move:!0,values:ve,source:et}),qe=De.newValue,We=De.activeIndex;pl({sliderRef:gt,activeIndex:We,setActive:Ge}),tt(qe),V&&V(oe,qe)}}),mi=Wt(function(oe){var le=ml(oe,he);if(!!le){var De=Ls({finger:le,values:ve,source:et}),qe=De.newValue;Ge(-1),oe.type==="touchend"&&Ie(-1),F&&F(oe,qe),he.current=void 0;var We=Kn(gt.current);We.removeEventListener("mousemove",Nn),We.removeEventListener("mouseup",mi),We.removeEventListener("touchmove",Nn),We.removeEventListener("touchend",mi)}}),ar=Wt(function(oe){oe.preventDefault();var le=oe.changedTouches[0];le!=null&&(he.current=le.identifier);var De=ml(oe,he),qe=Ls({finger:De,values:ve,source:et}),We=qe.newValue,zt=qe.activeIndex;pl({sliderRef:gt,activeIndex:zt,setActive:Ge}),tt(We),V&&V(oe,We);var Ye=Kn(gt.current);Ye.addEventListener("touchmove",Nn),Ye.addEventListener("touchend",mi)});Z.exports.useEffect(function(){var oe=gt.current;oe.addEventListener("touchstart",ar);var le=Kn(oe);return function(){oe.removeEventListener("touchstart",ar),le.removeEventListener("mousemove",Nn),le.removeEventListener("mouseup",mi),le.removeEventListener("touchmove",Nn),le.removeEventListener("touchend",mi)}},[mi,Nn,ar]);var Jc=Wt(function(oe){W&&W(oe),oe.preventDefault();var le=ml(oe,he),De=Ls({finger:le,values:ve,source:et}),qe=De.newValue,We=De.activeIndex;pl({sliderRef:gt,activeIndex:We,setActive:Ge}),tt(qe),V&&V(oe,qe);var zt=Kn(gt.current);zt.addEventListener("mousemove",Nn),zt.addEventListener("mouseup",mi)}),Ir=fl(Ue?ve[0]:y,y,B),Dc=fl(ve[ve.length-1],y,B)-Ir,zc=L({},Bl[mn].offset(Ir),Bl[mn].leap(Dc));return Z.exports.createElement(C,L({ref:wn,className:Se(o.root,o["color".concat(Jn(I))],r,d&&o.disabled,Xe.length>0&&Xe.some(function(oe){return oe.label})&&o.marked,x===!1&&o.trackFalse,E==="vertical"&&o.vertical,x==="inverted"&&o.trackInverted),onMouseDown:Jc},ge),Z.exports.createElement("span",{className:o.rail}),Z.exports.createElement("span",{className:o.track,style:zc}),Z.exports.createElement("input",{value:ve.join(","),name:U,type:"hidden"}),Xe.map(function(oe,le){var De=fl(oe.value,y,B),qe=Bl[mn].offset(De),We;return x===!1?We=ve.indexOf(oe.value)!==-1:We=x==="normal"&&(Ue?oe.value>=ve[0]&&oe.value<=ve[ve.length-1]:oe.value<=ve[0])||x==="inverted"&&(Ue?oe.value<=ve[0]||oe.value>=ve[ve.length-1]:oe.value>=ve[0]),Z.exports.createElement(Z.exports.Fragment,{key:oe.value},Z.exports.createElement("span",{style:qe,"data-index":le,className:Se(o.mark,We&&o.markActive)}),oe.label!=null?Z.exports.createElement("span",{"aria-hidden":!0,"data-index":le,style:qe,className:Se(o.markLabel,We&&o.markLabelActive)},oe.label):null)}),ve.map(function(oe,le){var De=fl(oe,y,B),qe=Bl[mn].offset(De);return Z.exports.createElement(T,{key:le,valueLabelFormat:D,valueLabelDisplay:Q,className:o.valueLabel,value:typeof D=="function"?D(P(oe),le):D,index:le,open:at===le||Be===le||Q==="on",disabled:d},Z.exports.createElement(ie,{className:Se(o.thumb,o["thumbColor".concat(Jn(I))],Be===le&&o.active,d&&o.disabled,Fe===le&&o.focusVisible),tabIndex:d?null:0,role:"slider",style:qe,"data-index":le,"aria-label":h?h(le):i,"aria-labelledby":s,"aria-orientation":E,"aria-valuemax":P(B),"aria-valuemin":P(y),"aria-valuenow":P(oe),"aria-valuetext":u?u(P(oe),le):g,onKeyDown:rr,onFocus:sr,onBlur:gr,onMouseOver:or,onMouseLeave:de}))}))});const $m=Bt(Vz,{name:"MuiSlider"})(Uz),PF=Li(Z.exports.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})),xz=Li(Z.exports.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"})),JF=Li(Z.exports.createElement("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),Wz=Li(Z.exports.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),wz=Li(Z.exports.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),DF=Li(Z.exports.createElement("path",{d:"M19 13H5v-2h14v2z"})),Nz=Li(Z.exports.createElement("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})),Tz=Li(Z.exports.createElement("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"}));function Ez({sourceAtom:t,layerAtom:e}){const n=Vn(t),[i,s]=Ai(e),g=o=>{o.stopPropagation(),s(r=>{const a=!r.on;return{...r,on:a}})};return k(_i,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:g,style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${i.on?1:.5})`},children:i.on?k(Nz,{}):k(Tz,{})})}const Qz=Xs({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(FD);function Xz({sourceAtom:t,layerAtom:e,name:n}){const s=`layer-controller-${Vn(t).id}`;return k(Qz,{"aria-controls":s,id:s,children:Ke("div",{style:{display:"flex",flexDirection:"row"},children:[k(Ez,{sourceAtom:t,layerAtom:e}),k(Ln,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function Yz({sourceAtom:t}){const e=Vn(t),{acquisitionId:n,acquisitions:i}=e;return i?k(ks,{children:k(Oe,{children:Ke(qm,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:g=>{let o=g.target.value;const r=new URL(window.location.href);o==="-1"?r.searchParams.delete("acquisition"):r.searchParams.set("acquisition",o),window.location.href=decodeURIComponent(r.href)},value:n,children:[k("option",{value:"-1",children:"Filter by Acquisition"},"-1"),i.map(g=>(g=g,Ke("option",{value:g.id,children:["Acquisition: ",g.name]},g.id)))]})})}):null}function _z({sourceAtom:t,layerAtom:e}){const[n,i]=Ai(t),[s,g]=Ai(e),[o,r]=Z.exports.useState(null),a=d=>{r(d.currentTarget)},I=()=>{r(null)},l=async d=>{I();const h=+d.target.value,u=[...n.defaults.selection];n.channel_axis&&(u[n.channel_axis]=h);let m;if(n.contrast_limits[h])m=n.contrast_limits[h];else{const{loader:f}=s.layerProps,p=Array.isArray(f)?f[f.length-1]:f;m=await Km(p,u),i(B=>{const G=[...B.contrast_limits];return G[h]=m,{...B,contrast_limits:G}})}g(f=>{const{layerProps:p}=f,B=[...p.selections,u],G=[...p.colors,km(n.colors[h])],y=[...p.contrastLimitsRange,m],U=[...p.channelsVisible,!0];return{...f,layerProps:{...p,selections:B,colors:G,contrastLimits:y,contrastLimitsRange:[...y],channelsVisible:U}}})},{names:C}=n,c=Boolean(o),A=c?`layer-${n.id}-add-channel`:void 0;return Ke(ks,{children:[k(_i,{onClick:a,"aria-describedby":A,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:s.layerProps.selections.length===Ro,children:k(PF,{})}),k(jm,{id:A,open:c,anchorEl:o,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:Ke(GI,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[k(Ln,{variant:"caption",children:"selection: "}),k(an,{}),Ke(qm,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:l,children:[k("option",{"aria-label":"None",value:"",children:"None"}),C.map((d,h)=>k("option",{value:h,children:d},d))]})]})})]})}const Hz=Xs({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})($m);function kz({layerAtom:t}){const[e,n]=Ai(t),i=(s,g)=>{const o=g;n(r=>({...r,layerProps:{...r.layerProps,opacity:o}}))};return k(Hz,{value:e.layerProps.opacity,onChange:i,min:0,max:1,step:.01})}const Kz=Xs({root:{width:"5.5em",fontSize:"0.7em"}})(Om);function Lz({sourceAtom:t,layerAtom:e,axisIndex:n,max:i}){const s=Vn(t),[g,o]=Ai(e),[r,a]=Z.exports.useState(null),I=h=>{a(h.currentTarget)},l=()=>{a(null)},C=h=>{let u=+h.target.value;u<0&&(u=0),u>i&&(u=i),o(m=>{let f={...m.layerProps};return f.selections=f.selections.map(p=>{let B=[...p];return B[n]=u,B}),{...m,layerProps:f}})},c=Boolean(r),A=c?`${n}-index-${s.id}-options`:void 0,d=g.layerProps.selections[0]?g.layerProps.selections[0][n]:1;return Ke(ks,{children:[k(_i,{onClick:I,"aria-describedby":A,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:k(JF,{})}),k(jm,{id:A,open:c,anchorEl:r,onClose:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:Ke(GI,{style:{padding:"0px 4px",marginBottom:4},children:[k(Ln,{variant:"caption",children:"Index:"}),k(an,{}),k(Kz,{value:d,onChange:C,type:"number",id:"max",fullWidth:!1}),k(an,{})]})})]})}const Mz=Xs({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})($m);function Pz({sourceAtom:t,layerAtom:e,axisIndex:n,max:i}){const[s,g]=Ai(e),o=Vn(t),{axis_labels:r}=o;let a=r[n];(a==="t"||a==="z")&&(a=a.toUpperCase());const[I,l]=Z.exports.useState(0);return Z.exports.useEffect(()=>{l(s.layerProps.selections[0]?s.layerProps.selections[0][n]:1)},[s.layerProps.selections]),Ke(ks,{children:[Ke(Oe,{children:[Ke(Oe,{container:!0,justifyContent:"space-between",children:[k(Oe,{item:!0,xs:10,children:k("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:Ke(Ln,{variant:"caption",noWrap:!0,children:[a,": ",I,"/",i]})})}),k(Oe,{item:!0,xs:1,children:k(Lz,{sourceAtom:t,layerAtom:e,axisIndex:n,max:i})})]}),k(Oe,{container:!0,justifyContent:"space-between",children:k(Oe,{item:!0,xs:12,children:k(Mz,{value:I,onChange:(A,d)=>{l(d)},onChangeCommitted:()=>{g(A=>{let d={...A.layerProps};return d.selections=d.selections.map(h=>{let u=[...h];return u[n]=I,u}),{...A,layerProps:d}})},min:0,max:i,step:1})})})]}),k(an,{})]})}function Jz({sourceAtom:t,layerAtom:e}){const n=Vn(t),{axis_labels:i,channel_axis:s,loader:g}=n,o=i.slice(0,-2).map((r,a)=>[r,a,g[0].shape[a]]).filter(r=>r[1]===s?!1:r[2]>1).map(([r,a,I])=>k(Pz,{sourceAtom:t,layerAtom:e,axisIndex:a,max:I-1},r));return o.length===0?null:Ke(ks,{children:[k(Oe,{children:o}),k(an,{})]})}const Dz=Vh(()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}})),zz=Object.entries(ci).map(([t,e])=>[t,km(e)]);function Oz({handleChange:t}){const e=Dz();return k("div",{className:e.container,"aria-label":"color-swatch",children:zz.map(([n,i])=>k(_i,{className:e.button,onClick:()=>t(i),children:k(xz,{fontSize:"small",style:{color:`rgb(${i})`}})},n))})}const Rv=Xs({root:{width:"5.5em",fontSize:"0.7em"}})(Om);function jz({sourceAtom:t,layerAtom:e,channelIndex:n}){const i=Vn(t),[s,g]=Ai(e),[o,r]=Z.exports.useState(null),{channel_axis:a,names:I}=i,l=B=>{r(B.currentTarget)},C=()=>{r(null)},c=B=>{g(G=>{const y=[...G.layerProps.colors];return y[n]=B,{...G,layerProps:{...G.layerProps,colors:y}}})},A=B=>{const G=B.target.id;let y=+B.target.value;y<0&&(y=0),g(U=>{const V=[...U.layerProps.contrastLimitsRange],F=[...U.layerProps.contrastLimits],[W,M]=V[n],[E,H]=F[n],[P,z]=G==="min"?[y,M]:[W,y];return P>E&&(F[n]=[P,H]),z<H&&(F[n]=[E,z]),V[n]=[P,z],{...U,layerProps:{...U.layerProps,contrastLimits:F,contrastLimitsRange:V}}})},d=()=>{g(B=>{const{layerProps:G}=B,y=[...G.colors],U=[...G.contrastLimits],V=[...G.contrastLimitsRange],F=[...G.selections],W=[...G.channelsVisible];return y.splice(n,1),U.splice(n,1),V.splice(n,1),F.splice(n,1),W.splice(n,1),{...B,layerProps:{...G,colors:y,selections:F,channelsVisible:W,contrastLimits:U,contrastLimitsRange:V}}})},h=B=>{g(G=>{const y=[...G.layerProps.selections],U=[...y[n]];return Number.isInteger(a)&&(U[a]=+B.target.value,y[n]=U),{...G,layerProps:{...G.layerProps,selections:y}}})},u=Boolean(o),m=u?`channel-${n}-${i.name}-options`:void 0,[f,p]=s.layerProps.contrastLimitsRange[n];return Ke(ks,{children:[k(_i,{onClick:l,"aria-describedby":m,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:k(JF,{})}),k(jm,{id:m,open:u,anchorEl:o,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:Ke(GI,{style:{padding:"0px 4px",marginBottom:4},children:[Ke("div",{style:{display:"flex",justifyContent:"space-between"},children:[k(Ln,{variant:"caption",children:"remove:"}),k(_i,{onClick:d,children:k(DF,{})})]}),k(an,{}),k(Ln,{variant:"caption",children:"selection:"}),k(an,{}),k(qm,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${i.name}-channel-select`,onChange:h,value:s.layerProps.selections[n][a],children:I.map((B,G)=>Ke("option",{value:G,children:["(",G,") ",B]},B))}),k(an,{}),k(Ln,{variant:"caption",children:"contrast limits:"}),k(an,{}),k(Rv,{value:f,onChange:A,type:"number",id:"min",fullWidth:!1}),k(Rv,{value:p,onChange:A,type:"number",id:"max",fullWidth:!1}),k(an,{}),k(Ln,{variant:"caption",children:"color:"}),k(an,{}),k("div",{style:{display:"flex",justifyContent:"center"},children:k(Oz,{handleChange:c})})]})})]})}function qz({sourceAtom:t,layerAtom:e,channelIndex:n}){const i=Vn(t),[s,g]=Ai(e),o=(p,B)=>{g(G=>{const y=[...G.layerProps.contrastLimits];return y[n]=B,{...G,layerProps:{...G.layerProps,contrastLimits:y}}})},r=()=>{g(p=>{const B=[...p.layerProps.channelsVisible];return B[n]=!B[n],{...p,layerProps:{...p.layerProps,channelsVisible:B}}})},a=s.layerProps,I=[...a.contrastLimits[n]],l=`rgb(${a.colormap?[255,255,255]:a.colors[n]})`,C=a.channelsVisible[n],[c,A]=a.contrastLimitsRange[n],{channel_axis:d,names:h}=i,u=a.selections[n],m=Number.isInteger(d)?u[d]:0,f=h[m];return Ke(ks,{children:[Ke(Oe,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[k(Oe,{item:!0,xs:10,children:k("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:k(Ln,{variant:"caption",noWrap:!0,children:f})})}),k(Oe,{item:!0,xs:1,children:k(jz,{sourceAtom:t,layerAtom:e,channelIndex:n})})]}),Ke(Oe,{container:!0,justifyContent:"space-between",children:[k(Oe,{item:!0,xs:2,children:k(_i,{style:{color:l,backgroundColor:"transparent",padding:0,zIndex:2},onClick:r,children:C?k(Wz,{}):k(wz,{})})}),k(Oe,{item:!0,xs:10,children:k($m,{value:I,onChange:o,min:c,max:A,step:.01,style:{padding:"10px 0px 5px 0px",color:l}})})]})]})}const $z=Xs({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(dD);function e8({sourceAtom:t,layerAtom:e}){const i=Vn(e).layerProps.selections.length;return k($z,{children:Ke(Oe,{container:!0,direction:"column",children:[k(Yz,{sourceAtom:t,layerAtom:e}),k(Oe,{children:Ke(Oe,{container:!0,justifyContent:"space-between",children:[k(Oe,{item:!0,xs:3,children:k(Ln,{variant:"caption",children:"opacity:"})}),k(Oe,{item:!0,xs:8,children:k(kz,{sourceAtom:t,layerAtom:e})})]})}),k(an,{}),k(Jz,{sourceAtom:t,layerAtom:e}),Ke(Oe,{container:!0,justifyContent:"space-between",children:[k(Oe,{item:!0,xs:3,children:k(Ln,{variant:"caption",children:"channels:"})}),k(Oe,{item:!0,xs:1,children:k(_z,{sourceAtom:t,layerAtom:e})})]}),k(an,{}),k(Oe,{children:ka(i).map(s=>k(qz,{sourceAtom:t,layerAtom:e,channelIndex:s},s))})]})})}const t8=Xs({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(CD);function n8({sourceAtom:t}){const e=Vn(t),n=yF(e),{name:i=""}=e;return Ke(t8,{defaultExpanded:!0,children:[k(Xz,{sourceAtom:t,layerAtom:n,name:i}),k(e8,{sourceAtom:t,layerAtom:n})]})}const i8=Vh({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function s8(){const t=Vn(bF),[e,n]=Z.exports.useReducer(s=>!s,!1),i=i8();return k("div",{className:i.root,style:{padding:`0px 5px ${e?0:5}px 5px`},children:Ke(Oe,{container:!0,direction:"column",alignItems:"flex-start",children:[k(_i,{style:{backgroundColor:"transparent",padding:0},onClick:n,children:e?k(PF,{}):k(DF,{})}),k("div",{className:i.scroll,style:{display:e?"none":"flex"},children:t.map(s=>k(n8,{sourceAtom:s},`${s}`))})]})})}const zF="0.3.0";function g8(){const t=Mp(pF),e=Mp(BF);async function n(i){const{createSourceData:s}=await Ti(()=>Promise.resolve().then(()=>oJ),void 0,import.meta.url),g=Math.random().toString(36).slice(2),o=await s(i);t(r=>(o.name||(o.name=`image_${Object.keys(r).length}`),[...r,{id:g,...o}]))}return Z.exports.useEffect(()=>{const i=new URLSearchParams(window.location.search);if(i.has("source")){const s={};for(const[r,a]of i)s[r]=a;s.source=decodeURIComponent(s.source),n(s);const g=new URL(window.location.href);g.searchParams.set("source",s.source);const o=decodeURIComponent(g.toString());window.location.href!==o&&window.history.pushState(null,"",o)}},[]),Z.exports.useEffect(()=>{async function i(){const{imjoyRPC:s}=await Ti(()=>import("./index.01e90947.js").then(a=>a.i),[],import.meta.url),g=await s.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:zF}),o=async a=>n(a),r=async a=>e(a);g.export({add_image:o,set_view_state:r})}window.self!==window.top&&i()},[]),Ke(ks,{children:[k(s8,{}),k(CJ,{})]})}var ef={};Object.defineProperty(ef,"__esModule",{value:!0});var v0=ef.default=void 0,o8={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},r8=o8;v0=ef.default=r8;const a8=VF({palette:{type:"dark",primary:v0,secondary:v0},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}}),bl=new Map;function ir(t,e){JL(t,()=>{if(!bl.has(t)){const i=e().then(s=>s.default).catch(s=>{throw bl.delete(t),s});bl.set(t,i)}return bl.get(t)})}ir("lz4",()=>Ti(()=>import("./lz4.87389b44.js"),[],import.meta.url));ir("gzip",()=>Ti(()=>import("./gzip.87321722.js"),["gzip.87321722.js","pako.esm-856454b6.df899be9.js"],import.meta.url));ir("zlib",()=>Ti(()=>import("./zlib.c77211ff.js"),["zlib.c77211ff.js","pako.esm-856454b6.df899be9.js"],import.meta.url));ir("zstd",()=>Ti(()=>import("./zstd.d76669c6.js"),[],import.meta.url));ir("blosc",()=>Ti(()=>import("./blosc.4ec40f1c.js"),[],import.meta.url));ir("jpeg2k",()=>Ti(()=>import("./jpeg2k.ef190c07.js"),[],import.meta.url));console.log(`vizarr v${zF}: https://github.com/hms-dbmi/vizarr`);wl.render(k(Ox,{theme:a8,children:k(h3,{children:k(g8,{})})}),document.getElementById("root"));
