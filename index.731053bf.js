var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&i(e,n,t[n]);if(o)for(var n of o(t))a.call(t,n)&&i(e,n,t[n]);return e},s=(e,o)=>t(e,n(o));import{X as c,C as d,p as u,S as p,T as h,Q as m,o as f,a as g,b as y,Z as w,H as x,M as b,c as v,G as _,d as P,I as A,e as I,s as S,w as C,f as O,u as k,j as E,g as z,r as j,D as L,O as M,h as $,V as F,i as R,k as V,A as N,l as D,m as T,F as B,n as q,N as W,q as U,P as G,t as H,v as J,x as Z,y as K,z as X,B as Y,L as Q,R as ee,E as te,J as ne,K as oe,U as re,W as ae,Y as ie,_ as le,$ as se,a0 as ce,a1 as de,a2 as ue}from"./vendor.c0a62344.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const pe={},he=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in pe)return;pe[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e())):e()},me=s(l({},c.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function fe(e,t,n=[0,0],o=1){const[r,a]=n;return[r,t*o+a,e*o+r,a]}function ge(e){const{loaders:t,loaderSelection:n=[]}=e;let{concurrency:o}=e;o&&n.length>0&&(o=Math.ceil(o/n.length));return u(t,(async e=>{const t=n.map((t=>e.loader.getRaster({selection:t}))),o=await Promise.all(t);return s(l({},e),{data:{data:o.map((e=>e.data)),width:o[0].width,height:o[0].height}})}),{concurrency:o})}class ye extends d{initializeState(){this.state={gridData:[],width:0,height:0},ge(this.props).then((e=>{const{width:t,height:n}=function(e){const[t]=e,{width:n,height:o}=t.data;return e.forEach((({data:e})=>{if((null==e?void 0:e.width)!==n||(null==e?void 0:e.height)!==o)throw new Error("Grid data is not same shape.")})),{width:n,height:o}}(e);this.setState({gridData:e,width:t,height:n})}))}updateState({props:e,oldProps:t,changeFlags:n}){const{propsChanged:o}=n,r="string"==typeof o&&o.includes("props.loaders"),a=e.loaderSelection!==t.loaderSelection;(r||a)&&ge(this.props).then((e=>{this.setState({gridData:e})}))}getPickingInfo({info:e}){if(!e.coordinate)return e;const t=this.props.spacer||0,{width:n,height:o}=this.state,[r,a]=e.coordinate,i=Math.floor(a/(o+t)),l=Math.floor(r/(n+t));return e.gridCoord={row:i,column:l},e}renderLayers(){const{gridData:e,width:t,height:n}=this.state;if(0===t||0===n)return null;const{rows:o,columns:r,spacer:a=0,id:i=""}=this.props,s=e.map((e=>{const o=e.row*(n+a),r=e.col*(t+a),s={channelData:e.data,bounds:fe(t,n,[r,o]),id:`${i}-GridLayer-${e.row}-${e.col}`,dtype:e.loader.dtype||"Uint16",pickable:!1};return new c(l(l({},this.props),s))}));if(this.props.pickable){const[e,c]=[0,0],d=o*(n+a),u=r*(t+a),h={data:[{polygon:[[c,e],[u,e],[u,d],[c,d]]}],getPolygon:e=>e.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${i}-GridLayer-picking`},m=new p(l(l({},this.props),h));s.push(m)}if(this.props.text){const o=new h({id:`${i}-GridLayer-text`,data:e,getPosition:e=>[e.col*(t+a),e.row*(n+a)],getText:e=>e.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});s.push(o)}return s}}ye.layerName="GridLayer",ye.defaultProps=me;class we{constructor(e,t=100){var n,o;i(this,"symbol"!=typeof(n="cache")?n+"":n,o),this.store=e,this.cache=new m({maxSize:t})}getItem(...e){const[t,n]=e;if(this.cache.has(t))return this.cache.get(t);const o=this.store.getItem(t,n).catch((e=>{throw this.cache.delete(t),e}));return this.cache.set(t,o),o}async containsItem(e){return this.cache.has(e)||this.store.containsItem(e)}keys(){return this.store.keys()}deleteItem(e){throw new Error("deleteItem not implemented")}setItem(e,t){throw new Error("setItem not implemented")}}const xe={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},be=[xe.magenta,xe.green],ve=[xe.red,xe.green,xe.blue],_e=Object.values(xe).slice(0,-2);async function Pe(e){const{store:t,path:n}=await async function(e){let t;if("string"==typeof e){let n;if(e.endsWith(".json")){const[{ReferenceStore:t},o]=await Promise.all([he((()=>import("./index.157d23f4.js")),[]),fetch(e).then((e=>e.json()))]);n=t.fromJSON(o)}else{const o=new URL(e);n=new x(o.origin),t=o.pathname.slice(1)}return{store:new we(n),path:t}}return{store:e,path:t}}(e);return f(t,n).catch((e=>{if(e instanceof g)return y({store:t});throw e}))}const Ae=new TextDecoder;function Ie(e,t){return e.store.getItem(ke(e.path,t,".zattrs")).then((e=>Ae.decode(e))).then((e=>JSON.parse(e)))}async function Se(e,t){const{datasets:n}=t[0]||[{path:"0"}],o=await Promise.all(n.map((({path:t})=>e.getItem(t))));if(o.every((e=>e instanceof w)))return o;throw Error("Multiscales metadata included a path to a group.")}function Ce(e){e.startsWith("#")&&(e=e.slice(1));return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Oe(e){return Array.from({length:e},((e,t)=>t))}function ke(...e){return e.filter(Boolean).map((e=>function(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}(e,"/"))).join("/")}function Ee(e,t){return t||(t=e<=6?Array(e).fill(!0):[...Array(6).fill(!0),...Array(e-6).fill(!1)]),t}function ze(e,t){let n=[];if(1==e)n=[xe.white];else if(2==e)n=be;else if(3===e)n=ve;else if(e<=6)n=_e.slice(0,e);else{n=Array(e).fill(xe.white);const o=t.flatMap(((e,t)=>e?t:[]));for(const[e,t]of o.entries())n[t]=_e[e]}return n}function je(e){const t=e[e.length-1];return 3===t||4===t}function Le(e){const t=je(e.shape),[n,o]=e.chunks.slice(t?-3:-2),r=Math.min(n,o);return 2**Math.floor(Math.log2(r))}function Me(e){if(!e)return new b;const t=new b;try{const o="string"==typeof e?JSON.parse(e):e;if(n=o,!Array.isArray(n)||16!==n.length||!n.every((e=>"number"==typeof e)))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...o)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(t)}var n;return t}async function $e(e,t){if("Uint8"===e.dtype)return[0,255];const{data:n}=await e.getRaster({selection:t});let o=1/0,r=-1/0;for(let a=0;a<n.length;a++)n[a]>r&&(r=n[a]),n[a]<o&&(o=n[a]);return o===r&&(o=0,r=1),[o,r]}async function Fe(e,t,n,o){const r=null!=o?o:e.shape.map((()=>0));if(e.shape[t]!==n.length)throw new Error("provided visibilities don't match number of channels");return Promise.all(n.map((async(n,o)=>{if(!n)return;const a=[...r];return a[t]=o,$e(e,a)})))}async function Re(e,t,n){var o,r;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const a=n.rows.map((e=>e.name)),i=n.columns.map((e=>e.name)),c=n.wells.map((e=>e.path)),d=await Ie(t,c[0]);if(!("well"in d))throw Error("Path for image is not valid, not a well.");const p=d.well.images[0].path,h=await t.getItem(ke(c[0],p)).then((e=>e.attrs.asObject()));if(!("multiscales"in h))throw Error("Path for image is not valid.");const{datasets:m}=h.multiscales[0],f=m[m.length-1].path;const g=await Promise.all(c.map((async function(e){return ke(e,(await Ie(t,e)).well.images[0].path)}))),y=await u(g.map((e=>[e,ke(e,f)])),(([e,n])=>t.getItem(n).then((t=>[e,t]))),{concurrency:10}),w=await Promise.all(y),x=De(h.multiscales),b=Le(w[0][1]),_=w.map((e=>{const[t,n]=e[0].split("/");return{name:`${t}${n}`,row:a.indexOf(t),col:i.indexOf(n),loader:new v(e[1],x,b)}}));let P;P="omero"in h?Ne(h.omero,x):await Ve(_[0].loader,x);const A=s(l({loaders:_},P),{axis_labels:x,loader:[_[0].loader],model_matrix:Me(e.model_matrix),defaults:{selection:P.defaultSelection,colormap:null!=(o=e.colormap)?o:"",opacity:null!=(r=e.opacity)?r:1},name:n.name||"Plate",rows:a.length,columns:i.length});return A.onClick=n=>{let o=n.gridCoord;if(!o)return;const{row:r,column:l}=o;let s;"string"!=typeof e.source||!t.path||isNaN(r)||isNaN(l)||(s=ke(e.source,a[r],i[l])),e.onClick?(delete n.layer,n.imageSource=s,e.onClick(n)):s&&window.open(window.location.origin+window.location.pathname+"?source="+s)},A}async function Ve(e,t){const n=t.indexOf("c"),o=e.shape[n],r=Ee(o),a=await Fe(e,n,r),i=ze(o,r);return{name:"Image",names:Oe(o).map((e=>`channel_${e}`)),colors:i,contrast_limits:a,visibilities:r,channel_axis:t.includes("c")?t.indexOf("c"):null,defaultSelection:t.map((()=>0))}}function Ne({rdefs:e,channels:t,name:n},o){var r,a;const i=null!=(r=e.defaultT)?r:0,l=null!=(a=e.defaultZ)?a:0,s=[],c=[],d=[],u=[];t.forEach((e=>{s.push(e.color),c.push([e.window.start,e.window.end]),d.push(e.active),u.push(e.label)}));const p=o.map((e=>"t"==e?i:"z"==e?l:0));return{name:n,names:u,colors:s,contrast_limits:c,visibilities:d,channel_axis:o.includes("c")?o.indexOf("c"):null,defaultSelection:p}}function De(e){return e[0].axes||["t","c","z","y","x"]}function Te(e){var t;const{loader:n,channel_axis:o,colors:r,visibilities:a,contrast_limits:i,model_matrix:l,defaults:s,loaders:c,rows:d,columns:u,onClick:p}=e,{selection:h,opacity:m,colormap:f}=s,g=function(e){return e.loaders?ye:e.loader.length>1?P:A}(e),y=[],w=[],x=[],b=[],v=a.flatMap(((e,t)=>e?t:[]));for(const P of v){const e=[...h];Number.isInteger(o)&&(e[o]=P),y.push(e),w.push(Ce(r[P])),x.push(null!=(t=i[P])?t:[0,255]),b.push(!0)}const _=[...x];return{Layer:g,layerProps:{loader:1===n.length?n[0]:n,loaders:c,rows:d,columns:u,loaderSelection:y,colorValues:w,sliderValues:_,contrastLimits:x,channelIsOn:b,opacity:m,colormap:f,modelMatrix:l,onClick:p},on:!0}}var Be=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:async function(e){var t;const n=await Pe(e.source);let o;if(n instanceof _){const t=await n.attrs.asObject();if("plate"in t)return Re(e,n,t.plate);if("well"in t)return async function(e,t,n){var o,r,a,i;const c=e.acquisition?parseInt(e.acquisition):void 0;let d=[];if(!(null==n?void 0:n.images))throw Error("Well .zattrs missing images");if(!t.path)throw Error("Cannot inspect zarr path to open well.");const[u,p]=t.path.split("/").filter(Boolean).slice(-2);let{images:h}=n;const m=h.flatMap((e=>e.acquisition?[e.acquisition]:[]));if(m.length>1){const e=t.path.replace(`${u}/${p}`,""),n=await f(t.store,e),a=await n.attrs.asObject();d=null!=(r=null==(o=null==a?void 0:a.plate)?void 0:o.acquisitions)?r:[],c&&m.includes(c)&&(h=h.filter((e=>e.acquisition===c)))}const g=h.map((e=>e.path)),y=Math.ceil(Math.sqrt(g.length)),w=Math.ceil(g.length/y),x=await t.getItem(g[0]).then((e=>e.attrs.asObject()));if(!("multiscales"in x))throw Error("Path for image is not valid.");let b=x.multiscales[0].datasets[0].path;const _=g.map((e=>t.getItem(ke(e,b)))),P=await Promise.all(_),A=De(x.multiscales),I=Le(P[0]),S=Oe(w).flatMap((e=>Oe(y).map((t=>{const n=t+e*y;return{name:String(n),row:e,col:t,loader:new v(P[n],A,I)}}))));let C;C="omero"in x?Ne(x.omero,A):await Ve(S[0].loader,A);const O=s(l({loaders:S},C),{axis_labels:A,loader:[S[0].loader],model_matrix:Me(e.model_matrix),defaults:{selection:C.defaultSelection,colormap:null!=(a=e.colormap)?a:"",opacity:null!=(i=e.opacity)?i:1},name:`Well ${u}${p}`});return d.length>0&&(O.acquisitions=d,O.acquisitionId=c||-1),O.rows=w,O.columns=y,O.onClick=n=>{let o=n.gridCoord;if(!o)return;const{row:r,column:a}=o;let i;if("string"==typeof e.source&&t.path&&!isNaN(r)&&!isNaN(a)){const t=r*y+a;i=ke(e.source,g[t])}e.onClick?(delete n.layer,n.imageSource=i,e.onClick(n)):i&&window.open(window.location.origin+window.location.pathname+"?source="+i)},O}(e,n,t.well);if("omero"in t)return async function(e,t,n){var o;const{name:r,opacity:a=1,colormap:i=""}=e,c=await Se(t,n.multiscales),d=De(n.multiscales),u=Ne(n.omero,d),p=Le(c[0]),h=c.map((e=>new v(e,d,p)));return s(l({loader:h,axis_labels:d,model_matrix:Me(e.model_matrix),defaults:{selection:u.defaultSelection,colormap:i,opacity:a}},u),{name:null!=(o=u.name)?o:r})}(e,n,t);if(0===Object.keys(t).length&&n.path){const t=n.path.slice(0,n.path.lastIndexOf("/")),o=await f(n.store,t),r=await o.attrs.asObject();if("plate"in r)return Re(e,o,r.plate)}if(!("multiscales"in t))throw Error("Group is missing multiscales specification.");o=await Se(n,t.multiscales),e.axis_labels||(e.axis_labels=t.multiscales[0].axes)}else o=[n];const r=function(e,t){t&&t.length==e.shape.length||(t=e.shape.slice(0,-2).map(((e,t)=>""+t)).concat(["y","x"]));return t}(o[0],e.axis_labels),a=Le(o[0]),i=o.map((e=>new v(e,r,a))),[c]=i;if("channel_axis"in e||r.includes("c"))return async function(e,t,n){const{names:o,contrast_limits:r,name:a,model_matrix:i,opacity:l=1,colormap:s=""}=e;let{visibilities:c,colors:d}=e;const u=t[0].shape[n];for(const h of[r,c,o,d])if(h&&h.length!==u){const e=Object.keys({channelProp:h})[0];throw Error(`channel_axis is length ${u} and provided channel_axis property ${e} is different size.`)}c=c||Ee(u),d=d||ze(u,c);const p=null!=r?r:await Fe(t[t.length-1],n,c);return{loader:t,name:a,channel_axis:n,colors:d,names:null!=o?o:Oe(u).map((e=>`channel_${e}`)),contrast_limits:p,visibilities:c,model_matrix:Me(i),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:s,opacity:l},axis_labels:t[0].labels}}(e=e,i,Number(null!=(t=e.channel_axis)?t:r.indexOf("c")));if(2===c.shape.length||!("channel_axis"in e))return async function(e,t){const{color:n,contrast_limits:o,visibility:r,name:a,colormap:i="",opacity:l=1}=e,s=null!=o?o:await $e(t[t.length-1],[0,0,0]);return{loader:t,name:a,channel_axis:null,colors:[null!=n?n:xe.white],names:["channel_0"],contrast_limits:[s],visibilities:[null==r||r],model_matrix:Me(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:i,opacity:l},axis_labels:t[0].labels}}(e,i);throw Error("Failed to load image.")},initLayerStateFromSource:Te});const qe=I([]),We=I({zoom:0,target:[0,0,0],default:!0}),Ue=S(qe),Ge=O((e=>I(s(l({},Te(e)),{id:e.id}))),((e,t)=>e.id===t.id)),He=I((e=>{const t=e(Ue);if(0===t.length)return[];const n=t.map((t=>Ge(e(t))));return e(C(n))}));function Je({layers:e}){var t,n;const[o,r]=z(We),a=j.exports.useRef(null);if(a.current&&(null==o?void 0:o.default)&&(null==(n=null==(t=e[0])?void 0:t.props)?void 0:n.loader)){const{deck:t}=a.current,{width:n,height:o,maxZoom:i}=function(e){const{loader:t,rows:n,columns:o}=e,[r,a]=Array.isArray(t)?[t[0],t.length]:[t,0],i=je(r.shape);let[l,s]=r.shape.slice(i?-3:-2);if(n&&o){const e=5;l=(l+e)*n,s=(s+e)*o}return{height:l,width:s,maxZoom:a}}(e[0].props),l=t.width<400?10:t.width<600?30:50,{zoom:s,target:c}=function([e,t],[n,o],r,a){const i=(n-2*a)/e,l=(o-2*a)/t;return{zoom:Math.min(r,Math.log2(Math.min(i,l))),target:[e/2,t/2,0]}}([n,o],[t.width,t.height],i,l);r({zoom:s,target:c})}return E(L,{ref:a,layers:e,viewState:o,onViewStateChange:e=>r(e.viewState),views:[new M({id:"ortho",controller:!0})]})}function Ze(){const e=k(He).map((e=>e.on?new e.Layer(e.layerProps):null));return E(Je,{layers:e})}function Ke({sourceAtom:e,layerAtom:t}){const n=k(e),[o,r]=z(t);return E($,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:e=>{e.stopPropagation(),r((e=>{const t=!e.on;return s(l({},e),{on:t})}))},style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${o.on?1:.5})`},children:o.on?E(F,{}):E(R,{})})}const Xe=V({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(N);function Ye({sourceAtom:e,layerAtom:t,name:n}){const o=`layer-controller-${k(e).id}`;return E(Xe,{"aria-controls":o,id:o,children:D("div",{style:{display:"flex",flexDirection:"row"},children:[E(Ke,{sourceAtom:e,layerAtom:t}),E(T,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function Qe({sourceAtom:e}){const t=k(e),{acquisitionId:n,acquisitions:o}=t;if(!o)return null;return E(B,{children:E(q,{children:D(W,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:e=>{let t=e.target.value;const n=new URL(window.location.href);"-1"===t?n.searchParams.delete("acquisition"):n.searchParams.set("acquisition",t),window.location.href=decodeURIComponent(n.href)},value:n,children:[E("option",{value:"-1",children:"Filter by Acquisition"},"-1"),o.map((e=>D("option",{value:(e=e).id,children:["Acquisition: ",e.name]},e.id)))]})})})}function et({sourceAtom:e,layerAtom:t}){const[n,o]=z(e),[r,a]=z(t),[i,c]=j.exports.useState(null),d=()=>{c(null)},{names:u}=n,p=Boolean(i),h=p?`layer-${n.id}-add-channel`:void 0;return D(B,{children:[E($,{onClick:e=>{c(e.currentTarget)},"aria-describedby":h,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:6===r.layerProps.loaderSelection.length,children:E(U,{})}),E(G,{id:h,open:p,anchorEl:i,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[E(T,{variant:"caption",children:"selection: "}),E(J,{}),D(W,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:async e=>{const{defaults:{selection:t},channel_axis:i,colors:c,contrast_limits:u}=n;d();const p=+e.target.value,h=[...t];let m;if(i&&(h[i]=p),u[p])m=u[p];else{const{loader:e}=r.layerProps,t=Array.isArray(e)?e[e.length-1]:e;m=await $e(t,h),o((e=>{const t=[...e.contrast_limits];return t[p]=m,s(l({},e),{contrast_limits:t})}))}a((e=>{const{layerProps:t}=e,n=[...t.loaderSelection,h],o=[...t.colorValues,Ce(c[p])],r=[...t.sliderValues,m],a=[...r],i=[...t.channelIsOn,!0];return s(l({},e),{layerProps:s(l({},t),{loaderSelection:n,colorValues:o,sliderValues:r,contrastLimits:a,channelIsOn:i})})}))},children:[E("option",{"aria-label":"None",value:"",children:"None"}),u.map(((e,t)=>E("option",{value:t,children:e},e)))]})]})})]})}const tt=V({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Z);function nt({layerAtom:e}){const[t,n]=z(e);return E(tt,{value:t.layerProps.opacity,onChange:(e,t)=>{const o=t;n((e=>s(l({},e),{layerProps:s(l({},e.layerProps),{opacity:o})})))},min:0,max:1,step:.01})}const ot=V({root:{width:"5.5em",fontSize:"0.7em"}})(K);function rt({sourceAtom:e,layerAtom:t,axisIndex:n,max:o}){const r=k(e),[a,i]=z(t),[c,d]=j.exports.useState(null),u=Boolean(c),p=u?`${n}-index-${r.id}-options`:void 0,h=a.layerProps.loaderSelection[0]?a.layerProps.loaderSelection[0][n]:1;return D(B,{children:[E($,{onClick:e=>{d(e.currentTarget)},"aria-describedby":p,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(X,{})}),E(G,{id:p,open:u,anchorEl:c,onClose:()=>{d(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4},children:[E(T,{variant:"caption",children:"Index:"}),E(J,{}),E(ot,{value:h,onChange:e=>{let t=+e.target.value;t<0&&(t=0),t>o&&(t=o),i((e=>{let o=l({},e.layerProps);return o.loaderSelection=o.loaderSelection.map((e=>{let o=[...e];return o[n]=t,o})),s(l({},e),{layerProps:o})}))},type:"number",id:"max",fullWidth:!1}),E(J,{})]})})]})}const at=V({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(Z);function it({sourceAtom:e,layerAtom:t,axisIndex:n,max:o}){const[r,a]=z(t),i=k(e),{axis_labels:c}=i;let d=c[n];"t"!==d&&"z"!==d||(d=d.toUpperCase());const[u,p]=j.exports.useState(0);j.exports.useEffect((()=>{p(r.layerProps.loaderSelection[0]?r.layerProps.loaderSelection[0][n]:1)}),[r.layerProps.loaderSelection]);return D(B,{children:[D(q,{children:[D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:D(T,{variant:"caption",noWrap:!0,children:[d,": ",u,"/",o]})})}),E(q,{item:!0,xs:1,children:E(rt,{sourceAtom:e,layerAtom:t,axisIndex:n,max:o})})]}),E(q,{container:!0,justifyContent:"space-between",children:E(q,{item:!0,xs:12,children:E(at,{value:u,onChange:(e,t)=>{p(t)},onChangeCommitted:()=>{a((e=>{let t=l({},e.layerProps);return t.loaderSelection=t.loaderSelection.map((e=>{let t=[...e];return t[n]=u,t})),s(l({},e),{layerProps:t})}))},min:0,max:o,step:1})})})]}),E(J,{})]})}function lt({sourceAtom:e,layerAtom:t}){const n=k(e),{axis_labels:o,channel_axis:r,loader:a}=n,i=o.slice(0,-2).map(((e,t)=>[e,t,a[0].shape[t]])).filter((e=>e[1]!==r&&e[2]>1)).map((([n,o,r])=>E(it,{sourceAtom:e,layerAtom:t,axisIndex:o,max:r-1},n)));return 0===i.length?null:D(B,{children:[E(q,{children:i}),E(J,{})]})}const st=Y((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}}))),ct=Object.entries(xe).map((([e,t])=>[e,Ce(t)]));function dt({handleChange:e}){const t=st();return E("div",{className:t.container,"aria-label":"color-swatch",children:ct.map((([n,o])=>E($,{className:t.button,onClick:()=>e(o),children:E(Q,{fontSize:"small",style:{color:`rgb(${o})`}})},n)))})}const ut=V({root:{width:"5.5em",fontSize:"0.7em"}})(K);function pt({sourceAtom:e,layerAtom:t,channelIndex:n}){const o=k(e),[r,a]=z(t),[i,c]=j.exports.useState(null),{channel_axis:d,names:u}=o,p=e=>{const t=e.target.id;let o=+e.target.value;o<0&&(o=0),a((e=>{const r=[...e.layerProps.contrastLimits],a=[...e.layerProps.sliderValues],[i,c]=r[n],[d,u]=a[n],[p,h]="min"===t?[o,c]:[i,o];return p>d&&(a[n]=[p,u]),h<u&&(a[n]=[d,h]),r[n]=[p,h],s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:a,contrastLimits:r})})}))},h=Boolean(i),m=h?`channel-${n}-${o.name}-options`:void 0,[f,g]=r.layerProps.contrastLimits[n];return D(B,{children:[E($,{onClick:e=>{c(e.currentTarget)},"aria-describedby":m,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:E(X,{})}),E(G,{id:m,open:h,anchorEl:i,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:D(H,{style:{padding:"0px 4px",marginBottom:4},children:[D("div",{style:{display:"flex",justifyContent:"space-between"},children:[E(T,{variant:"caption",children:"remove:"}),E($,{onClick:()=>{a((e=>{const{layerProps:t}=e,o=[...t.colorValues],r=[...t.sliderValues],a=[...t.contrastLimits],i=[...t.loaderSelection],c=[...t.channelIsOn];return o.splice(n,1),r.splice(n,1),a.splice(n,1),i.splice(n,1),c.splice(n,1),s(l({},e),{layerProps:s(l({},t),{colorValues:o,sliderValues:r,loaderSelection:i,channelIsOn:c,contrastLimits:a})})}))},children:E(ee,{})})]}),E(J,{}),E(T,{variant:"caption",children:"selection:"}),E(J,{}),E(W,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${o.name}-channel-select`,onChange:e=>{a((t=>{const o=[...t.layerProps.loaderSelection],r=[...o[n]];return Number.isInteger(d)&&(r[d]=+e.target.value,o[n]=r),s(l({},t),{layerProps:s(l({},t.layerProps),{loaderSelection:o})})}))},value:r.layerProps.loaderSelection[n][d],children:u.map(((e,t)=>D("option",{value:t,children:["(",t,") ",e]},e)))}),E(J,{}),E(T,{variant:"caption",children:"contrast limits:"}),E(J,{}),E(ut,{value:f,onChange:p,type:"number",id:"min",fullWidth:!1}),E(ut,{value:g,onChange:p,type:"number",id:"max",fullWidth:!1}),E(J,{}),E(T,{variant:"caption",children:"color:"}),E(J,{}),E("div",{style:{display:"flex",justifyContent:"center"},children:E(dt,{handleChange:e=>{a((t=>{const o=[...t.layerProps.colorValues];return o[n]=e,s(l({},t),{layerProps:s(l({},t.layerProps),{colorValues:o})})}))}})})]})})]})}function ht({sourceAtom:e,layerAtom:t,channelIndex:n}){const o=k(e),[r,a]=z(t),{sliderValues:i,colorValues:c,contrastLimits:d,channelIsOn:u,colormap:p,loaderSelection:h}=r.layerProps,m=[...i[n]],f=`rgb(${p?[255,255,255]:c[n]})`,g=u[n],[y,w]=d[n],{channel_axis:x,names:b}=o,v=h[n],_=b[Number.isInteger(x)?v[x]:0];return D(B,{children:[D(q,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[E(q,{item:!0,xs:10,children:E("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:E(T,{variant:"caption",noWrap:!0,children:_})})}),E(q,{item:!0,xs:1,children:E(pt,{sourceAtom:e,layerAtom:t,channelIndex:n})})]}),D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:2,children:E($,{style:{color:f,backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{a((e=>{const t=[...e.layerProps.channelIsOn];return t[n]=!t[n],s(l({},e),{layerProps:s(l({},e.layerProps),{channelIsOn:t})})}))},children:E(g?te:ne,{})})}),E(q,{item:!0,xs:10,children:E(Z,{value:m,onChange:(e,t)=>{a((e=>{const o=[...e.layerProps.sliderValues];return o[n]=t,s(l({},e),{layerProps:s(l({},e.layerProps),{sliderValues:o})})}))},min:y,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:f}})})]})]})}const mt=V({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(oe);function ft({sourceAtom:e,layerAtom:t}){const n=k(t).layerProps.loaderSelection.length;return E(mt,{children:D(q,{container:!0,direction:"column",children:[E(Qe,{sourceAtom:e,layerAtom:t}),E(q,{children:D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:3,children:E(T,{variant:"caption",children:"opacity:"})}),E(q,{item:!0,xs:8,children:E(nt,{sourceAtom:e,layerAtom:t})})]})}),E(J,{}),E(lt,{sourceAtom:e,layerAtom:t}),D(q,{container:!0,justifyContent:"space-between",children:[E(q,{item:!0,xs:3,children:E(T,{variant:"caption",children:"channels:"})}),E(q,{item:!0,xs:1,children:E(et,{sourceAtom:e,layerAtom:t})})]}),E(J,{}),E(q,{children:Oe(n).map((n=>E(ht,{sourceAtom:e,layerAtom:t,channelIndex:n},n)))})]})})}const gt=V({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(re);function yt({sourceAtom:e}){const t=k(e),n=Ge(t),{name:o=""}=t;return D(gt,{defaultExpanded:!0,children:[E(Ye,{sourceAtom:e,layerAtom:n,name:o}),E(ft,{sourceAtom:e,layerAtom:n})]})}const wt=Y({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function xt(){const e=k(Ue),[t,n]=j.exports.useReducer((e=>!e),!1),o=wt();return E("div",{className:o.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:D(q,{container:!0,direction:"column",alignItems:"flex-start",children:[E($,{style:{backgroundColor:"transparent",padding:0},onClick:n,children:E(t?U:ee,{})}),E("div",{className:o.scroll,style:{display:t?"none":"flex"},children:e.map((e=>E(yt,{sourceAtom:e},`${e}`)))})]})})}function bt(){const e=ae(qe),t=ae(We);async function n(t){const{createSourceData:n}=await he((()=>Promise.resolve().then((function(){return Be}))),void 0),o=Math.random().toString(36).slice(2),r=await n(t);e((e=>(r.name||(r.name=`image_${Object.keys(e).length}`),[...e,l({id:o},r)])))}return j.exports.useEffect((()=>{const e=new URLSearchParams(window.location.search);if(e.has("source")){const t={};for(const[n,a]of e)t[n]=a;t.source=decodeURIComponent(t.source),n(t);const o=new URL(window.location.href);o.searchParams.set("source",t.source);const r=decodeURIComponent(o.toString());window.location.href!==r&&window.history.pushState(null,"",r)}}),[]),j.exports.useEffect((()=>{window.self!==window.top&&async function(){const{imjoyRPC:e}=await he((()=>import("./index.ecf68b74.js").then((function(e){return e.i}))),[]);(await e.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:"0.3.0"})).export({add_image:async e=>n(e),set_view_state:async e=>t(e)})}()}),[]),D(B,{children:[E(xt,{}),E(Ze,{})]})}var vt=ie({palette:{type:"dark",primary:le,secondary:le},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const _t=new Map;function Pt(e,t){se(e,(()=>{if(!_t.has(e)){const n=t().then((e=>e.default)).catch((t=>{throw _t.delete(e),t}));_t.set(e,n)}return _t.get(e)}))}Pt("lz4",(()=>he((()=>import("./lz4.90bd37fe.js")),["lz4.90bd37fe.js","utils-6b0080f1.f4680ab2.js"]))),Pt("gzip",(()=>he((()=>import("./gzip.2d512667.js")),["gzip.2d512667.js","pako.esm-9240ff4b.6c52ac68.js"]))),Pt("zlib",(()=>he((()=>import("./zlib.3b3d5619.js")),["zlib.3b3d5619.js","pako.esm-9240ff4b.6c52ac68.js"]))),Pt("zstd",(()=>he((()=>import("./zstd.73353642.js")),["zstd.73353642.js","utils-6b0080f1.f4680ab2.js"]))),Pt("blosc",(()=>he((()=>import("./blosc.0f249b18.js")),["blosc.0f249b18.js","utils-6b0080f1.f4680ab2.js"]))),Pt("jpeg2k",(()=>he((()=>import("./jpeg2k.effd323e.js")),[]))),console.log("vizarr v0.3.0: https://github.com/hms-dbmi/vizarr"),ce.render(E(de,{theme:vt,children:E(ue,{children:E(bt,{})})}),document.getElementById("root"));
